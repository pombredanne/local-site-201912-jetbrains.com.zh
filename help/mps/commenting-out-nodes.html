<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>注释节点-帮助| MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Commenting+out+nodes.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="commenting-out-nodes.xml" data-toc="Commenting+out+nodes.html">注释掉节点</h1>   <h2 id="genericsupportforcommentingoutnodesinmps">通用支持注释掉MPS中的节点</h2>   <p id="7740b60d">MPS提供了一种注释模型中节点的通用方法。在以前的版本中，必须通过节点属性或专用注释节点以所有语言分别实现此功能。从MPS 3.3开始，有关被注释掉的节点的信息以通用方式存储在模型中。<i id="cca5409f">smodel</i>语言默认情况下会忽略注释掉的节点，因此您的查询不必显式过滤掉注释掉的节点。<br>另外，通过单击“ <i id="18ae54aa">Control / Cmd + /</i> ”，已创建操作以注释/取消注释节点。</p>   <aside class="tip sideblock" rel="7740b60d" id="c22a9f27" data-title="">      <p id="9b7e55e6">您可以观看<a href="https://youtu.be/mZv7PQH8nsY" rel="noopener noreferrer" data-external="true" target="_blank">有关通用注释</a>的<a href="https://youtu.be/mZv7PQH8nsY" rel="noopener noreferrer" data-external="true" target="_blank">简短屏幕广播，</a>该<a href="https://youtu.be/mZv7PQH8nsY" rel="noopener noreferrer" data-external="true" target="_blank">注释</a>解释了该功能并描述了自定义选项。</p>   </aside>   <h3 id="howtouseit">如何使用它</h3>   <aside class="warning " rel="howtouseit" id="601cdff6" data-title="">      <p id="8e79945b">在以前的MPS语言版本中，作者必须提供自己的语言注释功能的实现。因此，旧的语言特定功能可能会与MPS 3.3的新通用功能发生冲突，特别是键盘快捷键<i id="1ad98a59">Control / Cmd + /</i>现在已由通用注释操作采取，不适用于特定实现，如果他们以前使用过此键盘快捷键。建议语言作者：</p>      <ol class="list _decimal"><li class="list__item" id="326f05fc"><p>选择其他按键组合以触发特定的注释掉/取消注释功能</p></li><li class="list__item" id="2a66b837"><p>弃用自定义注释功能</p></li><li class="list__item" id="4846b9c5"><p>自定义通用注释功能</p></li><li class="list__item" id="a1681aa5"><p>提供一种迁移，该迁移可自动将自定义注释功能的用法替换为通用注释</p></li><li class="list__item" id="3e7f23aa"><p>最终删除了自定义注释功能</p></li></ol>      <p id="aca17d6d">MPS 3.3中提供了半自动迁移过程，可帮助您轻松迁移。请在下面查看“ <a href="">从自定义注释功能迁移”</a> 。</p>      <p id="8ee29074"> </p>   </aside>   <p id="3696f889"> </p>   <p id="72ce6c5b">您可以选择MPS中除根以外的任何节点，然后按<i id="537acaa2">Control / Cmd + /</i> 。该节点将被注释掉。让我们看一些例子：</p>   <p id="558df4ed">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/mps-comment1.png"><img alt="mps comment1" title="mps comment1" src="/help/img/idea/2019.2/mps-comment1.png" id="386df42f" width="500" height="514"></a></figure>   <p></p>   <p id="ea09546d">您选择或将光标指向的节点将被注释掉。每个单个非根节点都可以被注释掉-无论它是占据整行，多行还是嵌套在像表达式一样的层次结构中。</p>   <p id="5edb6127">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/mps-comment2.png"><img alt="mps comment2" title="mps comment2" src="/help/img/idea/2019.2/mps-comment2.png" id="a6e3ea49" width="580" height="512"></a></figure>      <br>       <figure><a class="lightbox" href="/help/img/idea/2019.2/Comment3.png"><img alt="评论3" title="评论3" src="/help/img/idea/2019.2/Comment3.png" id="fb2a6af6" width="580" height="514"></a></figure>   <p></p>   <p id="6e9256b3">如果注释掉一个节点，则将其从模型中的位置上物理移除。如果注释掉的节点占据了请求的子链接，则提供一个空单元格，以便用户可以填写新的子值。<br>       </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Comment4.png"><img alt="评论4" title="评论4" src="/help/img/idea/2019.2/Comment4.png" id="85baf63f" width="900" height="510"></a></figure>   <p></p>   <p id="b34bd297">例如，在<i id="f645682d">BaseLanguage中</i> ，这为您提供了Java解析器所不能提供的可能性。您可以注释掉IfStatements条件：</p>   <p id="74e7d1e0">      </p><figure><img alt="评论5" title="评论5" src="/help/img/idea/2019.2/Comment5.png" id="5c9316f5" width="280" height="53"></figure>   <p></p>   <p id="8f3645ef">方法参数：</p>   <p id="1a8b24c7">      </p><figure><img alt="评论6" title="评论6" src="/help/img/idea/2019.2/Comment6.png" id="46e7b647" width="405" height="63"></figure>   <p></p>   <p id="f2736029">或变量类型：</p>   <p id="dd26ea23">      <img alt="评论7" title="评论7" src="/help/img/idea/2019.2/Comment7.png" id="52c01830" width="205" height="22" class="inline-icon-205">      <br>再举一个例子，编辑器定义语言允许您注释掉一个编辑器单元，例如：</p>   <p id="c08b4f8e">      <img alt="评论8" title="评论8" src="/help/img/idea/2019.2/Comment8.png" id="4c33a861" width="429" height="23" class="inline-icon-429">   </p>   <aside class="tip sideblock" rel="c08b4f8e" id="50987394" data-title="">      <p id="1f3df0f6">要取消注释已注释掉的节点，只需在其上按Control / Cmd + /。</p>   </aside>   <h3 id="smartcommentingout">聪明地注释掉</h3>   <p id="1ceb4847">注释和取消注释操作在其中具有一定的智能，以便确定要注释/取消注释的节点。</p>   <ul class="list _ul"><li class="list__item" id="286e4a82"><p>如果选择一个节点或一组节点，则该一个或多个节点将被注释掉/未注释</p></li><li class="list__item" id="5a43849f"><p>如果未选择任何节点，则编辑器将尝试注释掉/取消注释当前的“行”-为此，将在插入符下的节点中开始搜索以标识最接近的祖先垂直集合和插入符下的节点的祖先（该成员是成员）此垂直收藏集中的评论/未评论</p></li></ul>   <aside class="tip sideblock" rel="1b84fc65" id="b1ec5bd8" data-title="">      <p id="63d5ef6a">您可能会更精细地控制检测插入符号下节点的祖先线的机制-只需为单元格集合上的<i id="08af969b">COMMENT</i>动作定义一个处理程序，如下所示：</p>      <p id="b9acddf6">         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/commentLine2.png"><img alt="commentLine2" title="commentLine2" src="/help/img/idea/2019.2/commentLine2.png" id="69fba7e5" width="100" height="1040"></a></figure>      <p></p>      <p id="81be21b1">         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/commentLine3.png"><img alt="commentLine3" title="commentLine3" src="/help/img/idea/2019.2/commentLine3.png" id="d7b46a06" width="100" height="636"></a></figure>      <p></p>   </aside>   <h3 id="howdoesitworkinthemodel">它如何在模型中工作</h3>   <p id="d6fc3fcb">注释掉节点后，会将其作为子项（包装）放置在称为<i id="a58b2c49">BaseCommentAttribute</i>的特殊子项属性中。然后，此属性的实例将附加到已注释节点的前父节点中的已注释节点链接。<i id="8ec8ec0e">ChildAttribute</i>与<i id="5f211ada">LinkAttribute</i>概念相同，不同之处在于<i id="d9f27a89">ChildAttribute</i>附加到聚合链接。因此，注释的节点不会像通常的子节点那样存储，并且它们不会出现对子角色的常规查询。同样， <i id="26b87218">node.children</i>操作将忽略注释掉的节点。使用<i id="425f0b36">node.childrenAndChildAttributes <role></role></i>从评论中收集孩子。<i id="9ef726ce">node.descendants</i>操作当前返回注释掉的节点，在MPS的未来版本中可能会更改以使其与<i id="07b9af32">node.children</i>操作保持一致。</p>   <p id="38a70f0d">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Comment9.png"><img alt="评论9" title="评论9" src="/help/img/idea/2019.2/Comment9.png" id="198d0d40" width="600" height="1088"></a></figure>   <p></p>   <p id="f29593a9">MPS编辑器了解注释，它将以此角色绘制子节点以及注释掉的节点。</p>   <aside class="tip sideblock" rel="f29593a9" id="cfb568e9" data-title="">      <p id="d5a7d4e5"><i id="8a7ee69f">BaseCommentAttribute</i>批注来自<i id="82c92f3d">jetbrains.mps.lang.core</i> ，因此需要在包含注释节点的模型中在使用的语言中列出该语言。</p>   </aside>   <h3 id="queryingforcommentednodes">查询注释的节点</h3>   <p id="2600e27d"><i id="d17408eb">smodel</i>语言为您提供了查询已注释节点的选项。您可以对任何属性使用相同的语法，只是<i id="fe487574">comment</i>属性允许包含链接进行参数化。例如，如果一个<i id="0468174e">节点</i>有一个名为<i id="a962ff6e">commands</i>的子级集合，则查询子级是否被注释掉的任何<i id="ce171bfb">命令</i>看起来像：</p>   <div class="code-block" data-lang="none">node。@ <commands>comment.isNotEmpty</commands></div>   <h3 id="customization">客制化</h3>   <p id="c91656db">默认情况下，每个注释的节点都用<i id="0ef2b40d">/ * * /</i>包围。您可以通过为概念定义自定义的<b id="b5448402">注释编辑器</b>来覆盖注释掉的节点的外观。只需使用提示<i id="a5af2175">注释</i>定义通常的编辑器：</p>   <p id="6b058f24">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Comment10.png"><img alt="评论10" title="评论10" src="/help/img/idea/2019.2/Comment10.png" id="62f25eb2" width="300" height="482"></a></figure>   <p></p>   <aside class="tip sideblock" rel="6b058f24" id="a2a90055" data-title="">      <p id="f7d2f1e8">为了使<b id="fce9dcce">注释</b>提示可用，您的编辑器模型需要导入<i id="2e2ef1c8">jetbrains.mps.lang.core.editor</i>模型。</p>   </aside>   <p id="b0e5ae47">编辑器的样式应更改，以便用户可以轻松地在视觉上区分注释的代码。</p>   <p id="597e0e71">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Commentx1.png"><img alt="评论x1" title="评论x1" src="/help/img/idea/2019.2/Commentx1.png" id="e363f704" width="500" height="486"></a></figure>   <p></p>   <p id="55fd72fc">您可以重新使用使用灰色和斜体样式的预定义<i id="fe87d04b">注释</i>样式，也可以为注释掉的节点创建自己的样式。</p>   <p id="2c16e2d3">      <b id="3f8c4c12">注意：</b>注释节点的子节点应使用其通常的编辑器绘制，因此您需要删除子单元格中的注释提示：</p>   <p id="55e4be38">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Comment11.png"><img alt="评论11" title="评论11" src="/help/img/idea/2019.2/Comment11.png" id="2068ec7c" width="500" height="1398"></a></figure>   <p></p>   <h3 id="easiercustomization">轻松定制</h3>   <p id="abfd26e3"><b id="a33c25ae">下一个适用的编辑器</b>单元为您提供了一种更方便的方法来自定义注释掉的节点的外观-您可以使用单个自定义的注释编辑器来解决层次结构中的多个概念。</p>   <p id="f7fca0b3">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Commxy1.png"><img alt="Commxy1" title="Commxy1" src="/help/img/idea/2019.2/Commxy1.png" id="fdcc6d7d" width="500" height="284"></a></figure>      <br>   <p></p>   <p id="3777f4b4"><b id="297628ac">下一个适用的编辑器</b>单元仅删除<b id="eca6a07d">注释</b>提示并重定向请求以查找概念的原始编辑器（ <i id="1280e33e">IfStatement</i> ）。这避免了重复编辑器定义的需要。如果您为通用的超级概念定义了与<b id="bdf54fd7">注释</b>提示绑定的单个编辑器，则可以进一步简化该任务-这样，所有子概念都将获得自定义的注释编辑器。</p>   <h3 id="commentingout/uncommentingnodesfromcode">从代码中注释掉/取消注释节点</h3>   <p id="9f79167e">从<i id="92edb4b8">jetbrains.mps.editor.runtime</i>的<i id="9d10de3a">CommentUtil</i>类可用于注释掉和代码取消注释节点，如行动，意图或键映射。这为您提供了进一步定制被注释掉的节点的行为的选项。</p>   <p id="d465057c"><i id="f39603d2">CellAction_CommentOrUncomment</i>及其继承者类来自同一包。它们为您提供了一种方法，可以简单地注释节点并恢复选择或取消注释该节点（如果当前已注释）。</p>   <h3 id="thecommenteditoraction">评论编辑器动作</h3>   <p id="c1719ecf">还可以在节点级别上定制对注释/取消注释操作的响应。您可以在单元格的操作图中为<b id="14235974">COMMENT</b>操作设置处理程序：</p>   <p id="495712af">      </p><figure><img alt="禁用评论" title="禁用评论" src="/help/img/idea/2019.2/disable_commenting.png" id="3d2faf43" width="700" height="538"></figure>   <p></p>   <p id="5e676aaa">例如，如果我们要防止用户注释机器人的Kaja <i id="2330e92c">While</i>语句中的条件，则可以将上述操作映射附加到表示<i id="cfec0478">条件</i>的While编辑器的单元格中<b id="99901ac0">：</b>   </p>   <p id="cf3122eb">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Comment13.png"><img alt="评论13" title="评论13" src="/help/img/idea/2019.2/Comment13.png" id="76ee42b4" width="500" height="910"></a></figure>   <p></p>   <p id="324afc0a">由于<b id="44e6fef6">COMMENT</b>操作是自定义的，它将执行指示的操作。</p>   <p id="04b0c032">仅当选择了<i id="3180af04">条件</i>节点时，该操作才起作用。</p>   <p id="edf5f82d">由于我们使用<i id="3fda923b">节点</i>作为参数创建<i id="5428c151">CellAction_CommentOrUncommentNode</i> ，其中<i id="ca5d2bdb">节点</i>为<i id="f72279a7">While</i>语句，因此该操作将处理<i id="2d835225">While</i>语句：</p>   <p id="22426872">1）如果未评论，则该操作将其注释掉。</p>   <p id="c039f7ff">2）如果将其注释掉，则该操作将取消注释。</p>   <p id="132ef460">因此，该<i id="f71c728f">条件</i>的注释将被禁用。</p>      <h2 id="migratingawayfromyourcustomcommentingoutfunctionality">从您的自定义注释功能迁移</h2>   <p id="be6de068">在MPS 3.3之前的版本中，语言作者必须自己为每种语言实现注释功能。在MPS 3.3中，自定义功能可能是多余的，应该由MPS提供的通用功能替换，也许需要如上所述的一些自定义。旧的自定义注释功能的现有用法应迁移到通用版本，这应分几个步骤完成：</p>   <ol class="list _decimal"><li class="list__item" id="89fd173f"><p>用于注释的旧概念应被弃用</p></li><li class="list__item" id="fb9eb6e9"><p>您的键盘快捷键，操作和注释/取消注释的意图应被弃用或删除</p></li><li class="list__item" id="15654f3e"><p>您可能希望通过定义附加到“注释”编辑器提示的自定义编辑器来自定义注释掉的节点的外观（如上所述）</p></li><li class="list__item" id="ea7b0784"><p>您可能还希望在某些编辑器单元上禁用通用注释掉功能（如上所述）</p></li><li class="list__item" id="7d090746"><p>您可能需要提供一个迁移，该迁移会将用户代码中旧的自定义注释节点的用法自动转换为以通用方式注释的节点。这可以完全手动完成，也可以在MPS的帮助下完成。<br>      </p></li></ol>   <h3 id="mps-assistedmigration">MPS协助的迁移</h3>   <p id="7647e92f">MPS可以根据您的指示为您创建一个<i id="98db5617">Migration</i> ，使用<i id="12ce104b">IOldCommentAnnotation</i>和<i id="c273908f">IOldCommentContainer可以</i>代表哪些概念代表了旧的自定义注释。由于过去有两种创建自定义注释的典型方法，因此需要两个接口：</p>   <ul class="list _ul"><li class="list__item" id="ccd40ca9"><p>         <i id="47a605cc">IOldCommentAnnotation-</i>应该由<i id="e4ec5f1e">NodeAttribute</i>来实现，该<i id="e4ec5f1e">属性</i>指示已注释掉节点，如果使用了属性注释已注释掉的节点<br>      </p></li><li class="list__item" id="f4a58344"><p>         <i id="cef178d4">IOldCommentContainer-</i>如果注释的节点由专用概念（例如<i id="d62f16f8">SingleLineComment）表示</i> ，则这些专用概念应使用此概念接口进行标记</p></li></ul>   <p id="102a6585">这些标记概念接口来自<i id="6f861f18">jetbrains.mps.lang.core</i> ，因此需要使用您的语言来扩展此语言才能使用它们。一旦添加了注释，将在这些概念的节点上停止通用注释功能，以支持旧的自定义注释功能。</p>   <p id="dd23698e">此外，旧注释掉的概念将在其上报告警告- <b id="494b1253">应迁移旧注释容器</b>或<b id="494b1253">应迁移</b> <b id="7d403d8d">旧注释注释</b> 。这些警告的快速修复将创建必要的迁移，以将您的旧的自定义注释方案轻松地转换为通用方案。只需触发快速修复程序，检查生成的迁移，然后迁移您的项目即可。</p>   <h3 id="fullymanualmigration">完全手动迁移</h3>   <p id="7d7450a7">您可以完全手动创建迁移。通常，迁移所需要做的就是找到所有以旧的自定义方式注释掉的节点，取消注释，并在每个节点上调用<i id="15fb1666">CommentUtil.comment（）</i>以新的方式注释掉它。<i id="6e8e2a52">CommentUtil</i>类来自<i id="ca1aad6e">jetbrains.mps.editor.runtime</i> 。</p>   <p id="e4b7d4ee">通用注释掉功能使用附加在注释掉的节点的父节点上的<i id="cd19ce98">BaseCommentAttribute</i>注释标记注释掉的节点，保留注释掉的节点的原始角色并且来自<i id="b347cf02">jetbrains.mps.lang.core</i> ，因此该语言需要用于包含注释节点的模型。自动迁移应将这种语言依赖性添加到所有更改的模型中。您可以从<i id="732ab84d">ReplaceSingleLineCommentsWithGenericComments</i>迁移中获得启发，该迁移在<i id="96b77aa8">BaseLanguage中</i>迁移了<i id="4dddfcb9">SingleLineComment</i>节点：</p>   <p id="87d09f1d">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Mig1.png"><img alt="Mig1" title="Mig1" src="/help/img/idea/2019.2/Mig1.png" id="1f3a7082" width="900" height="978"></a></figure>   <p></p>   <p id="0964b089">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Mig2.png"><img alt="Mig2" title="Mig2" src="/help/img/idea/2019.2/Mig2.png" id="ed90aefd" width="500" height="354"></a></figure>      <br>   <p></p>   <p id="057dcb77">      <br>   </p>   <p id="b959e826"> </p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="requirement-tracking-language.html">需求跟踪语言</a> <a class="navigation-links__next" href="common-language-patterns.html">通用语言模式</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>