<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>编辑器语言生成API-帮助|帮助MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Editor+language+generation+API.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="editor-language-generation-api.xml" data-toc="Editor+language+generation+API.html">编辑器语言生成API</h1>   <p id="92f807b9">编辑器语言应该被众多MPS用户扩展，因此我们为编辑器语言设计了生成器，以使其易于使用-直观的模板，人类可读的生成代码以及在生成时比运行时更多地使用元信息。 -时间。如果您的任何一种语言都扩展了编辑器语言以提供新的单元格类型，那么本文档适合您。</p>   <h3 id="api: editorcell contract">API：EditorCell合同</h3>   <p id="cd5c9f80"><i id="7f28e4fe">EditorCell.setBig（）/。getBig（）</i>方法的<i id="7f28e4fe">约定</i>略有更改。请检查javadoc以获取详细信息。</p>   <h3 id="api:editorcellfactory isnowavailableonlywithin updatesession">API：EditorCellFactory现在仅在UpdateSession中可用</h3>   <p id="33726b14">我们使<i id="436d4e5a">EditorCellFactory</i>实例由当前<i id="d7ca7f24">UpdateSession</i>控制。同时，我们在<i id="99c8807d">EditorCellFactory</i>实现中放入了一些缓存，在某些情况下使编辑器的构建过程更快。不推荐使用<i id="665fa41f">EditorContext.getCellFactory（）</i>方法，并将在下一版本中将其删除。</p>   <h3 id="languageruntime: abstracteditorbuilder">语言运行时：AbstractEditorBuilder</h3>   <p id="8097ad4f">      引入了<i id="3b743690">AbstractEditorBuilder</i>运行时类，并且应将其用作包含单元工厂方法的任何类的公共超类。此类实现通用的实用程序方法，并提供对编辑器单元格创建过程的通用上下文参数的访问，例如：</p>   <ul class="list _ul"><li class="list__item" id="54e535b7"><p>editorContext</p></li><li class="list__item" id="c60e7e34"><p>节点</p></li><li class="list__item" id="2fbdb723"><p>细胞工厂</p></li><li class="list__item" id="759ae4aa"><p>更新会话</p></li></ul>   <p id="06e0719d">      <i id="bbfda8d7">AbstractEditorBuilder</i>用于捕获单元格创建过程的某些上下文，并在此上下文中执行后续的单元工厂方法。</p>   <h3 id="generator: editorbuilder classes">生成器：EditorBuilder类</h3>   <p id="323f0fcd">现在将为每个可用的编辑器声明层次结构生成一个单独的<i id="25bffe8f">AbstractEditorBuilder</i>类子类，作为根类：</p>   <ul class="list _ul"><li class="list__item" id="005559af">         <i id="0078e854">ConceptEditorDeclaration.cellModel</i>      </li><li class="list__item" id="ef3298fa">         <i id="31b2f03b">ConceptEditorDeclaration.inspectedCellModel</i>      </li><li class="list__item" id="6dc4fa69">         <i id="1bea3fd0">EditorComponentDeclaration</i>      </li><li class="list__item" id="2f575100">         <i id="b40fd2b3">InlineEditorComponent</i>      </li></ul>   <p id="89e81562">MPS编辑器生成器将继续创建类，实现<i id="112eba8b">ConceptEditor</i>和<i id="581a7cc6">ConceptEditorComponent</i> 。这些类以前被用作单元工厂方法的容器。在新版本的MPS中，这些类用作描述符，以提供对上下文提示信息的访问并实例化实际的<i id="963a3605">EditorBuilder</i> 。描述符类可以由<i id="28e0836a">EditorCellFactory</i>实现缓存。</p>   <h3 id="contextualparametersavailableforcellbuilders">上下文参数可用于单元格生成器</h3>   <p id="45944b9a">作为<i id="75bb1a1b">AbstractEditorBuilder</i>子类的一部分生成的代码可以通过使用<i id="baacf563">AbstractEditorBuilder</i>类的现有方法来访问上下文参数。除此之外，所有可用的元信息都用于生成私有字段，这些私有字段的类型比<i id="e3107840">AbstractEditorBuilder</i>的方法签名中可用的类型更多。目前， <i id="29cc1a70">AbstractEditorBuilder的</i>每个子类都将拥有私有<i id="f445b0fd">节点<theconcept>myNode</theconcept></i>字段，其中<i id="52103d46">TheConcept</i>是与此<i id="6215c3d9">AbstractEditorBuilder</i>关联的实际概念。这意味着任何单元工厂方法都可以使用此类私有字段，以便获得对上下文节点的类型化访问，并使用s模型语言直接访问上下文节点中的可用属性，链接和其他信息。</p>   <h3 id="cellfactorycontextclass">CellFactoryContextClass</h3>   <p id="19fcaaab">      <i id="b23746a8">CellFactoryContextClass</i>是一个方便的实用程序类，为模板提供必要的上下文，生成包含在所生成的<i id="321f8866">AbstractEditorBuilder</i>子类之一中的代码。通过将该类用作上下文类模板，作者将自动获得所有可用的方法和字段，MPS平台将支持代码生成环境，因此不再需要为每个编辑器模板重建它。同时， <i id="423f5bba">CellFactoryContextClass</i>可用作标记界面突出显示模板，它将为其中一个<i id="a066f6a8">EditorBuilders</i>生成代码，从而简化了查找此类代码并在将来提供支持的过程。</p>   <h3 id="genericcellcreationcontext">GenericCellCreationContext</h3>   <p id="a3cfac7d"><i id="68a416c3">GenericCellCreationContext</i>接口提供了上下文信息的有限子集，该信息始终可用于作为<i id="c35b1fe0">EditorBuilders</i>的一部分或从单独的类调用的代码，这些代码作为单元创建（编辑器更新）过程的一部分执行。在这种情况下，当模板作者要在<i id="74f392fc">EditorBuilders</i>生成过程和其他地方重用同一模板时，应将此接口用作模板上下文，而不是<i id="b63c2c5b">CellFactoryContextClass</i> 。例如，查询方法可以在<i id="d2f10844">EditorBuilders</i>内部或某些样式类中生成。</p>   <h3 id="newsignaturefor createcell() methods">createCell（）方法的新签名</h3>   <p id="f13e807d">在MPS的早期版本中，始终使用两个附加参数指定单元格创建的上下文来生成单元格工厂方法： <i id="c0fe2591">EditorContext</i>和<i id="cd109bf4">node <></i> 。从现在开始，不再需要指定这些参数-生成的代码始终可以通过调用包含的<i id="eda837b9">EditorBuilder</i>类的方法来访问此信息（以及任何其他上下文信息）。新的编辑器生成器将生成不带任何参数的单元格工厂方法。</p>   <h3 id="automaticmigrationscriptfornew createcell() methods">新的createCell（）方法的自动迁移脚本</h3>   <p id="76e916f0">为了与现有生成器兼容，我们提供了一个迁移脚本，用于修补可用模板，并引入新的<i id="9ab8f8ac">createCell（）</i>方法，该方法委托给旧模板（带有两个附加参数）作为后备。我们建议先执行此脚本，然后检查所有修改并验证修改后的生成器是否仍能正常工作。提供的自动迁移仅支持最常见的情况，因此在某些特定情况下，您可能需要手动修改生成器以使其再次运行。生成兼容性方法的<i id="1a036879">模板</i>称为<i id="1a036879">template_cellFactoryCompatibility</i> 。如果以后修改生成器以直接生成新的<i id="e1b12f5c">createCellMethods</i> ，则应删除对<i id="77fcb719">template_cellFactoryCompatibility的</i>所有调用。我们建议您查看当前MPS版本范围内的所有现有生成器和修补程序过时的模板，这些模板会生成旧的<i id="9eb35a02">createCell（...）</i>方法-我们将在下一版本中删除兼容性模板。</p>   <h3 id="mappinglabels">映射标签</h3>   <p id="47f1d1f1">在编辑器生成器（ <i id="8ac1c470">MAPPING_main</i> ）中引入了一些映射标签，它们可用于简化代码生成：</p>   <h4 id="cellfactory.class.concept">cellFactory.class.concept</h4>   <p id="f4b3bfb0">      <i id="003a7724">cellFactory.class.concept：ConceptEditorDeclaration-> ClassConcept</i>   </p>   <p id="14226989">此标签显示为<i id="2848522a">ConceptEditorDeclaration.cellModel</i>的<i id="ac658d6e">EditorBuilder</i>生成的Java类。   </p>   <h4 id="cellfactory.class.inspector">cellFactory.class.inspector</h4>   <p id="0e6c9650">      <i id="4b0c0c6b">cellFactory.class.inspector：ConceptEditorDeclaration-> ClassConcept</i>   </p>   <p id="7acec185">此标签显示为<i id="571913de">ConceptEditorDeclaration.inspectedCellModel</i>的<i id="a417876e">EditorBuilder</i>生成的Java类。   </p>   <h4 id="cellfactory.class.component">cellFactory.class.component</h4>   <p id="a5a98502">      <i id="2377f2eb">cellFactory.class.component：EditorComponentDeclaration-> ClassConcept</i>   </p>   <p id="6707d488">该标签公开了一个Java类， <i id="5fe03ca8">该类</i>是为<i id="e99fee10">EditorComponentDeclaration</i>的<i id="5fe03ca8">EditorBuilder</i>生成的   </p>   <h4 id="cellfactory.constructor">cellFactory.constructor</h4>   <p id="58b1ffda">      <i id="90adfff7">cellFactory.constructor：EditorCellModel-> ConstructorDeclaration</i>   </p>   <p id="4ceb0954">用于标记生成的<i id="1ea30761">EditorBuilder</i>类的构造函数。</p>   <h4 id="cellfactory.factorymethod">cellFactory.factoryMethod</h4>   <p id="dc37075e">      <i id="56dc832e">cellFactory.factoryMethod：EditorCellModel-> InstanceMethodDeclaration</i>   </p>   <p id="1fb3eb89">替换旧的<i id="12456073">cellFactoryMethod</i>标签，其中包含新的<i id="1ae3e730">cellFactory</i>方法。这个标签应该被用来代替<i id="67f6a156">cellFactoryMethod</i>以使他们产生新的<i id="f8bcf510">cellFactory</i>方法从现有的模板修改的时刻。</p>   <h4 id="generated.constructor">生成的构造函数</h4>   <p id="0f173b68">      <i id="4f4b58e0">generate.constructor： <no input="" concept="">-> ConstructorDeclaration</no></i>   </p>   <p id="ea45a2cc">该标签可以与现有的<i id="19e2163e">generateClass</i> one一起使用，以标记生成的构造函数实例。此标签可用于避免在<i id="0b7eeb2c">节点</i>内定位第一个构造函数实例的丑陋代码<i id="0b7eeb2c"><classconcept></classconcept></i> ，从<i id="a2bb5eea">generateClass</i>映射返回。</p>   <h3 id="celllayoutconstructorswitchintroduced">引入了CellLayoutConstructor开关</h3>   <p id="7ccd2f46">此模板开关用于在创建收集单元时实例化适当的单元布局。<i id="f4a7ccfd">EditorCell_Collection</i>类中以前使用的静态<i id="0870366b">createxxx（）</i>方法已被弃用，并将被删除。</p>   <h3 id="newgeneratorforrefcellcellprovidersub-classes">RefCellCellProvider子类的新生成器</h3>   <p id="579d99a7"><i id="2686a0f1">CellModel_RefCell</i>的生成器已被修改。<i id="d8c059fd">RefCellCellProvider</i>的新生成的匿名内部类不使用<i id="30e37cec">RefCellCellProvider.createRefCell（）</i>运行时方法内的逻辑。在生成时可用的元信息可用于创建此方法的完整内容。如果确实在生成器中生成<i id="ea9b6b54">RefCellCellProvider的</i>子类，则应考虑查看这些位置并将模板与MPS中的模板对齐。</p>   <h3 id="inlinecellproviderreplacedwitheditorbuildersub-class">InlineCellProvider替换为EditorBuilder子类</h3>   <p id="5338ad4b">      MPS生成器不再使用<i id="a7eb72d5">InlineCellProvider</i> 。MPS而是使用<i id="f1421663">AbstractEditorBuilder</i>的生成的子类。尽管如此，我们还是修改了<i id="ed35f097">InlineCellProvider</i>内部的一些约束以使生命周期更加透明。如果您仍在使用它，建议您检查javadoc中的<i id="fecb790a">InlineCellProvider</i> 。</p>   <h3 id="editorstylesgenerator">编辑器样式生成器</h3>   <p id="b92e0bad">将为<i id="4996f7ef">StyleSheet</i>和<i id="f3bfe508">StyleKeyPack</i>实例中的每个条目生成一个单独的静态内部类。提供的<i id="fb45340f">applyStyleClass</i>模板可用于正确实例化并调用新的<i id="405766c8">Style</i>类。旧版静态。在下一发行版中应删除<i id="5a9953ba">applyxxx（）</i>方法。</p>   <h3 id="styleclassitem constraintsmodification">StyleClassItem约束修改</h3>   <p id="32f48f9b">我们从<i id="f6e00fd3">StyleClassItem</i>概念中删除了<i id="17670201">canBeChild</i>约束。这些约束条件与所述节点的<i id="7ab43d67">canBeParent</i>约束取代，含有<i id="61f0a59b">StyleClassItem。</i>除此之外， <i id="0b9f0c5e">isApplicableToCell（node <editorcellmodel>cellModel）</editorcellmodel></i>行为方法已被弃用，不再使用。相反，我们引入了以下方法：</p>   <ul class="list _ul"><li class="list__item" id="74973803">         <i id="4fd1bcb4">isApplicableToCellConcept（）</i>      </li><li class="list__item" id="e004bdbb">         <i id="0bad7aad">isApplicableForLayout（）</i>      </li><li class="list__item" id="390f5e74">         <i id="135638a8">isApplicableInLayout（）</i>      </li></ul>   <p id="16c19fa1">如果您要使用自己的语言实现任何自定义<i id="b97cb73c">StyleClassItem</i> ，建议您检查<i id="c2f323a4">StyleClassItem</i>行为方法的javadoc。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="diagramming-editor.html">图表编辑器</a> <a class="navigation-links__next" href="constraints.html">约束</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>