<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>生成器语言-帮助| MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Generator+Language.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="generator-language.xml" data-toc="Generator+Language.html">生成器语言</h1>   <h2 id="generatorlanguagereference">生成器语言参考</h2>   <p id="9aef4956">      </p><ul data-skip-index="skip"><li class="list__item"><a href="#generatorlanguagereference">生成器语言参考</a></li><li class="list__item"><a href="#mappingconfiguration">映射配置</a></li><li class="list__item"><a href="#generatorrule">发电机规则</a></li><li class="list__item"><a href="#roottemplate">根模板</a></li><li class="list__item"><a href="#externaltemplate">外部模板</a></li><li class="list__item"><a href="#mappinglabel">映射标签</a></li><li class="list__item"><a href="#macro">巨集</a></li><li class="list__item"><a href="#templateswitch">模板切换</a></li><li class="list__item"><a href="#generationcontext(operations)">生成上下文（操作）</a></li><li class="list__item"><a href="#findingoutputnode">查找输出节点</a></li><li class="list__item"><a href="#generatinguniquename">产生唯一名称</a></li><li class="list__item"><a href="#templateparameters">模板参数</a></li><li class="list__item"><a href="#gettingcontextualinfo">获取上下文信息</a></li><li class="list__item"><a href="#transferringuserdata">传输用户数据</a></li><li class="list__item"><a href="#logging">记录中</a></li><li class="list__item"><a href="#utilities(re-usablecode)">实用程序（可重复使用的代码）</a></li><li class="list__item"><a href="#mappingscript">映射脚本</a></li></ul>   <p></p>   <h3 id="mappingconfiguration">映射配置</h3>   <p id="6c215532">映射配置是生成器规则，映射标签声明以及对预处理和后期处理脚本的引用的容器。生成器模型可以包含任意数量的映射配置-如果涉及拥有的生成器模块，则它们都将参与生成过程。映射配置还充当可在映射优先级规则中引用的最小生成器单元。</p>   <h3 id="generatorrule">发电机规则</h3>   <p id="5c976e0c">生成器规则指定输入节点到输出节点的转换（ <i id="ef2e7176">条件根规则</i>除外，该<i id="ef2e7176">条件根规则</i>不具有输入节点，仅在输出模型中创建一个新节点）。所有规则都由两部分组成-前提和结果（ <i id="0e6784bc">遗弃的根规则</i>除外，后者没有结果，只是忽略输入节点）。任何生成器规则都可以通过映射标签进行标记。</p>   <p id="a3620022">所有生成器规则的功能均具有以下参数：</p>   <ul class="list _ul"><li class="list__item" id="02da48eb"><p>         <b id="971ffad0">node-</b>当前输入节点（除<i id="781ee4d4">条件根规则中</i>的条件函数以外的所有节点）</p></li><li class="list__item" id="edf8ad72"><p>         <b id="089ab2d1">genContext-</b>生成上下文-允许搜索输出节点，生成唯一名称等</p></li></ul>   <p id="6ced92ca">生成器规则：</p>   <div class="table-wrapper"><table class=" wide" width="100%" id="54662b2f"><thead><tr id="489c0ecd" class="ijRowHead"><th id="afaad0fe">            <p id="fa6f15fe">规则</p>         </th><th id="d361b726">            <p id="ee88de3f">描述</p>         </th><th id="10ddeb0a">            <p id="864b3302">前提</p>         </th><th id="becd489e">            <p id="e46d4fa5">后果</p>         </th></tr></thead><tbody><tr id="e9e38b3e" class="ijRowOdd"><td id="229c5eab">            <p id="291a5bbb">条件根规则</p>         </td><td id="82338796">            <p id="4ff250e4">在输出模型中生成一个根节点。在单个生成步骤中仅应用了一次（最大值）。</p>         </td><td id="88775320">            <p id="886bcc27">               <b id="84d2b204">条件</b>函数（可选），缺少条件函数等效于始终返回<i id="fe83dbae">true</i>的函数。</p>         </td><td id="3b113de1">            <p id="b0227e70">根模板（参考）</p>         </td></tr><tr id="2134fca7" class="ijRowEven"><td id="6d6f30ef">            <p id="4e6a15fd">根映射规则</p>         </td><td id="a8a47229">            <p id="5e0d0300">在输出模型中生成一个根节点。</p>         </td><td id="d2c98f00">            <p id="0e405304">               <b id="215c7ae9">概念</b> -适用的概念（输入节点的概念）<br>               <b id="9721ae84">继承者</b> -如果为<i id="c3084999">true，</i>则该规则适用于指定的概念及其所有子概念。如果为<i id="23875bc4">false</i> （默认），则子概念不适用。<br>               <b id="9aa51dd0">条件</b>函数（可选）-请参见上面的<i id="030be25b">条件根规则</i> 。<br>               <b id="93db5a74">保持输入根</b> -如果为<i id="b6cb81f4">false，</i>则将删除输入根节点（如果它是根节点）。如果为<i id="9401b080">true，</i>则将输入根复制到输出模型。</p>         </td><td id="f08332d9">            <p id="cff2db64">根模板（参考）</p>         </td></tr><tr id="4122633e" class="ijRowOdd"><td id="9d4c81fc">            <p id="b06fa24d">编织规则</p>         </td><td id="052edd3f">            <p id="9d588fce">允许将其他子节点插入输出模型。织造规则在生成微步骤的最后，即map_src和参考解析之前进行处理。该规则将应用于指定概念的每个输入节点。插入的父节点应由<b id="0c25c2b2">上下文</b>功能提供。<br></p>         </td><td id="e414e07a">            <p id="e6b98b2a">               <b id="3246c873">概念</b> -与上述相同<br>               <b id="3f349188">继承者</b> -与上面相同<br>               <b id="82e80df2">条件</b>函数（可选）-与上面相同</p>         </td><td id="9dcab157">            <ul class="list _ul"><li class="list__item" id="577345eb"><p>外部模板（参考）</p></li><li class="list__item" id="e7e6cb44"><p>编织每个</p></li><li class="list__item" id="d94fed34"><p>context-用于计算（父）输出节点的函数，该规则所生成的输出节点将插入该（父）输出节点。</p></li><li class="list__item" id="f6075e72"><p>锚（可在<b id="f54b16a4">Inspector中使用</b> ）-指定<b id="cf318d94">上下文</b>集合中的节点，应在该节点之前插入节点， <b id="f063e3eb">null</b>表示在集合末尾插入</p></li></ul>         </td></tr><tr id="b28ea221" class="ijRowEven"><td id="b6d6e896">            <p id="33b3b19d">归约法则</p>         </td><td id="9e5ff19f">            <p id="a68d3dd9">在将该节点复制到输出模型时对其进行变换。</p>         </td><td id="5a52441f">            <p id="09bce8b9">               <b id="22198ad9">概念</b> -与上述相同<br>               <b id="9654611a">继承者</b> -与上面相同<br>               <b id="c6d9da7b">条件</b>函数（可选）-与上面相同</p>         </td><td id="e3de6556">            <ul class="list _ul"><li class="list__item" id="e1ac08a7"><p>外部模板（参考）</p></li><li class="list__item" id="f7e6ccdc"><p>内联模板</p></li><li class="list__item" id="743dbfed"><p>在线开关</p></li><li class="list__item" id="a798c980"><p>驳回最高规则</p></li><li class="list__item" id="3dac25a6"><p>放弃输入</p></li></ul>         </td></tr><tr id="5010f1d9" class="ijRowOdd"><td id="9146914b">            <p id="81473dbb">模式规则</p>         </td><td id="7ef7a12b">            <p id="28d8b3dd">转换与模式匹配的输入节点。</p>         </td><td id="f192237e">            <p id="964ed8d7">               <b id="47276080">模式</b> - <a href="pattern.html">模式表达</a>                <br>               <b id="da617ea0">条件</b>函数（可选）-与上面相同</p>         </td><td id="163ac972">            <ul class="list _ul"><li class="list__item" id="e22926e9"><p>外部模板（参考）</p></li><li class="list__item" id="5cd3cde0"><p>内联模板</p></li><li class="list__item" id="ca1c2006"><p>驳回最高规则</p></li><li class="list__item" id="4e737c6d"><p>放弃输入</p></li></ul>         </td></tr><tr id="9580c9c4" class="ijRowEven"><td id="51f8cbfa">            <p id="b993dac1">放弃根治</p>         </td><td id="ec99793d">            <p id="95089a81">允许删除输入根节点，否则将其复制到输出模型中。</p>         </td><td id="eba71ff1">            <p id="ec957f29">               <b id="87ce2f96">适用的概念</b> （包括其所有子概念）<br>               <b id="a37c0aa9">条件</b>函数（可选）-与上面相同</p>         </td><td id="540ee627">            <p id="30846222">不适用</p>         </td></tr><tr id="5163143a" class="ijRowOdd"><td id="0ba85f13"><p>放置属性规则</p></td><td id="58e1c0b0"><p>对于转换后的节点，控制从输入节点复制哪些属性</p></td><td id="9da9ff27"><p>            <b id="49d9ba32">概念</b> -属性节点的<b id="49d9ba32">概念</b> （的子概念<code class="code">jetbrains.mps.lang.core.structure.Attribute</code> ）<br>            <b id="d137bda0">继承者</b> -如果为<i id="a22a9f71">true，</i>则该规则适用于指定的概念及其所有子概念。如果为<i id="ed7524e9">false</i> （默认），则子概念不适用。<br>            <b id="b903004b">条件</b>函数（可选）-触发规则的进一步限制</p></td><td id="7a0b33d3">            <p id="3880d937">不适用</p>            <p id="78d1dc68">规则匹配时不复制属性</p>         </td></tr></tbody></table></div>   <p id="8ebd3308">规则后果：</p>   <div class="table-wrapper"><table class=" wide" width="100%" id="5efb461c"><thead><tr id="f3ed78fa" class="ijRowHead"><th id="97bbb1ef">            <p id="5639cb5e">后果</p>         </th><th id="b9d510b5">            <p id="a83ae2e6">用法</p>         </th><th id="b9a407c6">            <p id="20cf2bcb">描述</p>         </th></tr></thead><tbody><tr id="62a9fb05" class="ijRowOdd"><td id="e1957dde">            <p id="9b458ae0">根模板（参考）</p>         </td><td id="c5b1636a">            <ul class="list _ul"><li class="list__item" id="9ec1b394"><p>条件根规则</p></li><li class="list__item" id="3b6094dd"><p>（根）映射规则</p></li></ul>         </td><td id="c7c00fd8">            <p id="05d2f984">应用根模板</p>         </td></tr><tr id="d060d082" class="ijRowEven"><td id="cd853c34">            <p id="acbaa21d">外部模板（参考）</p>         </td><td id="c7f3529c">            <ul class="list _ul"><li class="list__item" id="48fb05d1"><p>编织规则</p></li><li class="list__item" id="5af50c75"><p>归约法则</p></li><li class="list__item" id="aa61d9a6"><p>模式规则</p></li></ul>         </td><td id="90910ae5">            <p id="a1f2a8f8">应用外部模板。如果需要，应传递参数，它们可以是以下之一：</p>            <ul class="list _ul"><li class="list__item" id="1d2df96c"><p>模式捕获的变量（以＃号开头）</p></li><li class="list__item" id="3cc7c75d"><p>整数或字符串文字</p></li><li class="list__item" id="5634a3a7"><p>                  <i id="d6b1fe41">null</i> ， <i id="8ada948a">true</i> ， <i id="b9208b83">false</i>               </p></li><li class="list__item" id="ac68d4be"><p>查询功能</p></li></ul>         </td></tr><tr id="07476d2d" class="ijRowOdd"><td id="87ace375">            <p id="395910d8">编织每个</p>         </td><td id="f0e93788">            <p id="58b81f40">编织规则</p>         </td><td id="bebbfc6a">            <p id="d3f24fd2">将外部模板应用于一组输入节点。<br>编织每个结果包括：</p>            <ul class="list _ul"><li class="list__item" id="a93d71a2"><p>                  <b id="1951e247">foreach</b>函数-返回输入节点序列</p></li><li class="list__item" id="80177e8c"><p>外部模板上的参考</p></li></ul>         </td></tr><tr id="77cea119" class="ijRowEven"><td id="2ba5a983">            <p id="a175c6f6">内联模板</p>         </td><td id="0d7e0a87">            <ul class="list _ul"><li class="list__item" id="5cba7585"><p>归约法则</p></li><li class="list__item" id="f84fc602"><p>模式规则</p></li></ul>         </td><td id="a302e5ae">            <p id="4b4c4c84">应用此处编写的模板代码。</p>         </td></tr><tr id="eede2f91" class="ijRowOdd"><td id="36f7c11d">            <p id="2f9d59a4">在线开关</p>         </td><td id="e66d360e">            <p id="3a425221">归约法则</p>         </td><td id="e3655cb9">            <p id="9d4898e5">由<b id="de5976e7">条件情况</b>集和<b id="f59883b5">默认情况组成</b> 。<br>每个案例都指定一个后果，可以是以下情况之一：</p>            <ul class="list _ul"><li class="list__item" id="e2b5beaf"><p>外部模板（参考）</p></li><li class="list__item" id="e951b140"><p>内联模板</p></li><li class="list__item" id="6f0e0887"><p>驳回最高规则</p></li><li class="list__item" id="2b6e707b"><p>放弃输入</p></li></ul>         </td></tr><tr id="70fbd5ca" class="ijRowEven"><td id="064ec853">            <p id="4a2633ca">驳回最高规则</p>         </td><td id="850aeea9">            <ul class="list _ul"><li class="list__item" id="88f597b7"><p>归约法则</p></li><li class="list__item" id="d17de417"><p>模式规则</p></li></ul>         </td><td id="ae457630">            <p id="fc93ec16">通过尝试将输入节点复制到输出模型，将所有归约转换丢弃到此转换序列已开始的位置。输入节点将“按原样”复制（除非适用其他缩减规则）。用户还可以指定错误，警告或信息消息。</p>         </td></tr><tr id="8d9e1681" class="ijRowOdd"><td id="37767a83">            <p id="aed6bc98">放弃输入</p>         </td><td id="b7cfbc39">            <ul class="list _ul"><li class="list__item" id="b08ff670"><p>归约法则</p></li><li class="list__item" id="65502d61"><p>模式规则</p></li></ul>         </td><td id="0961565c">            <p id="4d0d5954">防止将输入节点复制到输出模型中。</p>         </td></tr></tbody></table></div>   <h3 id="roottemplate">根模板</h3>   <p id="5ec5a81d">根模板用于条件根规则和（根）映射规则。Generator语言没有为根模板定义特定的概念。生成器语言定义了一种特殊的注释- <i id="f7c05a43">根模板标头</i> ，该<i id="f7c05a43">标头</i>会自动添加到每个新的根模板中。根模板头用于指定预期的<b id="ac68461d">输入</b>概念（即输入节点的概念）。MPS使用此设置对根模板中使用的各种宏功能执行代码的静态类型检查。</p>   <aside class="warning " rel="5ec5a81d" id="6777392e" data-title="">      <p id="d5f5132a">从技术上讲，在生成器模型中创建时，输出语言中的任何根节点都可以被视为根模板。但是，生成器将不带注释的根节点视为辅助效用节点，例如用于指定参考目标，因此不考虑将其用于目标语言评估。显示警告，并提供快速修复程序，以将<i id="45861f6c">根模板标头</i>注释添加到缺少该模板的根模板中。我们强烈建议语言设计人员修复其模板，并始终创建包含注释的新根模板。</p>               <br>         </aside>   <p id="3027a4b4"> </p>   <h3 id="externaltemplate">外部模板</h3>   <p id="aaa1fe1d">外部模板是生成器语言中定义的概念。它用于编织规则和归约规则。</p>   <p id="49820f58">在外部模板中，用户指定模板<b id="920e2f96">名称</b> ， <b id="c3e20f78">输入</b>概念， <b id="f2755a99">参数</b>和<b id="2fd06f2b">内容节点</b> 。</p>   <p id="7e1e84b7">内容节点可以是输出语言中的任何节点。外部模板中的实际模板代码被<b id="6c793934">模板片段</b> “标签”包围（模板片段也是一种特殊的注释概念）。模板片段之外的代码用作实际模板代码（模板片段）的框架（或上下文），并且被生成器忽略。在用于编织规则的外部模板中，需要模板的上下文节点（它是规则的<i id="74ae5b0a">上下文节点</i>的设计时表示），而用于简化规则的模板可以只是一个与上下文无关的模板片段。归约规则的外部模板必须恰好包含一个模板片段，而编织规则的模板可以包含多个模板片段。</p>   <p id="88a1689a">模板片段具有<b id="d167253f">映射标签</b>属性，该属性在“ <b id="8b10a982">检查器”视图中进行</b>编辑。</p>   <h3 id="mappinglabel">映射标签</h3>   <p id="62fa0056">映射标签在映射配置中声明，并且存储到该声明的引用用于标记生成器规则，宏和模板片段。这样的标记允许通过已知的输入节点找到输出节点。</p>   <p id="274b3f7a">特性：</p>   <ul class="list _ul"><li class="list__item" id="92fa1a32">         <b id="7493f5a4">名称</b>      </li><li class="list__item" id="c19fb951"><p>         <b id="abe937fb">输入概念</b> （可选）-由标记的规则，宏或模板片段执行的转换的输入节点的预期概念</p></li><li class="list__item" id="fd5067a0"><p>         <b id="63f669a2">输出概念</b> （可选）-由标记的规则，宏或模板片段执行的转换的输出节点的预期概念</p></li></ul>   <p id="2e8f055c">MPS利用输入/输出概念设置在<i id="3bd2d8a8">get output ...</i>操作中执行静态类型检查。</p>   <h3 id="macro">巨集</h3>   <p id="36c417a4">宏是一种特殊的注释概念，可以附加到模板代码中的任何节点。宏将动态方面带入了其他基于静态模板的模型转换中。</p>   <p id="3647df4f">属性宏和参考宏分别附加到属性单元和参考单元，而节点宏（具有多种变化-LOOP，IF等）被附加到代表单元编辑器中整个节点的单元。使用检查器视图编辑宏的所有属性。</p>   <p id="a80c0c01">所有宏都具有<b id="1deef302">映射标签</b>属性-引用映射标签声明。另外，所有宏都可以通过各种宏功能进行参数化-取决于宏的类型。任何宏功能至少具有以下三个参数：</p>   <ul class="list _ul"><li class="list__item" id="e67d6e27"><p>         <b id="91c64801">node-</b>当前输入节点；</p></li><li class="list__item" id="4e9370df"><p>         <b id="94fe7ec0">genContext-</b>生成上下文-允许搜索输出节点，生成唯一名称等。</p></li><li class="list__item" id="842eedba"><p>         <b id="e959fa0b">operationContext</b> - <i id="140e9bb7">jetbrains.mps.smodel的实例<i id="140e9bb7">。IOperationContext</i>接口（很少使用）。</i></p></li></ul><i id="140e9bb7">   <p id="7a729dbc">许多类型的宏具有<b id="ebb2cd23">映射节点</b> （或多个<b id="9efae5e6">映射节点</b> ）功能。此函数计算新的输入节点-替代当前输入节点。如果<b id="72d2d56c">映射节点</b>函数返回null或<b id="ed6e53c6">映射节点</b>函数返回空<i id="cfc61cb8">序列</i> ，则生成器将完全跳过此宏。即在此位置将不会生成任何输出。</p>   <div class="table-wrapper"><table class=" wide" width="100%" id="00a79da9"><thead><tr id="b4864c6b" class="ijRowHead"><th id="abdf8a5b">            <p id="548f1f28">巨集</p>         </th><th id="574120fc">            <p id="7683df5a">描述</p>         </th><th id="7f725bb5">            <p id="8e66a663">属性（如果上面没有提到）</p>         </th></tr></thead><tbody><tr id="82e368e0" class="ijRowOdd"><td id="ddfb0cc4">            <p id="1121f4dd">属性宏</p>         </td><td id="a8e46be9">            <p id="6e162711">计算属性的值。</p>         </td><td id="39b07249">            <p id="7c5b299a">               <b id="3f6cd185">值</b>函数：</p>            <ul class="list _ul"><li class="list__item" id="89b1f040"><p>返回类型-字符串，布尔值或整数-取决于属性类型。</p></li><li class="list__item" id="f346a3d0"><p>参数-标准+ <b id="3b55ee6a">templateValue-</b>宏包装的模板代码中的值。</p></li></ul>         </td></tr><tr id="b682f7c2" class="ijRowEven"><td id="4228529d">            <p id="36214a59">参考宏</p>         </td><td id="0c2666d5">            <p id="2b90e68e">计算输出模型中的参照节点。<br>通常已经生成输出模型（树）时，在生成微步骤的末尾执行。<br>如果用户代码试图获取引用的目标，也可以更早执行。</p>            <p id="c3eb253e">参考宏支持<code class="code">SNodeReference</code>作为新目标的规范。这样，模板在应用后就无需访问目标的节点模型。</p>         </td><td id="804cc49d">            <p id="618b5a06">               <b id="14be0849">参考</b>功能：</p>            <ul class="list _ul"><li class="list__item" id="9d3879b8">返回类型<ul class="list _ul"><li class="list__item" id="6bbbffa2"><p>节点（类型取决于引用链接声明）</p></li><li class="list__item" id="b8f4de41">                        <code class="code">SNodeReference</code>                     </li><li class="list__item" id="11ca245a"><p>标识目标节点的字符串。</p></li></ul>               </li><li class="list__item" id="eb61b7a2"><p>参数-标准+ <b id="869d9be0">outputNode-</b>引用链接的源（在输出模型中）。</p></li></ul>         </td></tr><tr id="2c4925ab" class="ijRowOdd"><td id="0e4c245f">            <p id="7070b190">如果</p>         </td><td id="15aa82d8">            <p id="f454563f">仅当条件为true时，才会应用包装的模板代码。否则，将忽略模板代码，并应用“替代结果”（如果有）。</p>         </td><td id="3da92d8e">            <p id="fc228daf">               <b id="f96b4d28">条件</b>函数<br>                <b id="4c352b76">替代</b>结果（可选）-以下任一项：</p>            <ul class="list _ul"><li class="list__item" id="8c5c814f"><p>外部模板（参考）</p></li><li class="list__item" id="cd2bf114"><p>内联模板</p></li><li class="list__item" id="6338e411"><p>放弃输入</p></li><li class="list__item" id="3cd4c466"><p>驳回最高规则</p></li></ul>         </td></tr><tr id="148f5374" class="ijRowEven"><td id="26cd3ea9">            <p id="735a2692">环</p>         </td><td id="08ea72dd">            <p id="4dedecda">计算新的输入节点，并将包装后的模板应用于每个输入节点。</p>         </td><td id="4ee82428">            <p id="7fa14221">               <b id="efe6b270">映射节点</b>功能</p>         </td></tr><tr id="4b703340" class="ijRowOdd"><td id="642b7c56">            <p id="ba5eaf95">包括</p>         </td><td id="2a9a08fd">            <p id="161e658b">包装的模板代码将被忽略（它仅用作INCLUDE宏的锚点），而是将使用可重用的外部模板。</p>            <p id="cd2ea74c">空输入使INCLUDE实际上无效。</p>         </td><td id="710b25ca">            <p id="ade929b5">               <b id="de995b52">映射节点</b>功能（可选）<br>                <b id="69ad83c4">包含模板</b> -引用可重用的外部模板</p>         </td></tr><tr id="9ec8ff95" class="ijRowEven"><td id="4835c811">            <p id="9f460793">呼叫</p>         </td><td id="c5e4d11c">            <p id="6e83f9bd">调用模板，并用模板调用的结果替换包装的模板代码。支持带有参数的模板。</p>            <p id="ba91b23f">空输入节点是可容忍的，在这种情况下，模板将被完全忽略，即，当输入/映射的节点为空时，CALL会产生空的节点集合。</p>         </td><td id="215b028a">            <p id="9044897c">               <b id="470652e2">映射节点</b>功能（可选）<br>                <b id="bba269e5">呼叫模板</b> -引用可重用的外部模板<br>                <br>                <i id="270e7f2f">论点</i> -其中之一</p>            <ul class="list _ul"><li class="list__item" id="62db099b"><p>模式捕获变量</p></li><li class="list__item" id="662c2079"><p>整数或字符串文字</p></li><li class="list__item" id="030315a6"><p>                  <i id="d39d8613">null</i> ， <i id="6e4719cd">true</i> ， <i id="ce12b6a2">false</i>               </p></li><li class="list__item" id="9ae3e9e8"><p>查询功能</p></li></ul>         </td></tr><tr id="47bfa8e7" class="ijRowOdd"><td id="bed85735">            <p id="80a1cbdd">开关</p>         </td><td id="82d13170">            <p id="811ae36d">提供一种在模板代码中给定位置进行许多替代转换的方法。<br>如果没有适用于任何切换情况并且未在<a href="#templateswitch">#template switch中</a>指定默认结果，则将应用包装的模板代码。</p>            <p id="508e0bbb">对于空输入节点，SWITCH可能会响应一条消息（连同其规则一起指定），忽略锚定模板节点，并且SWITCH宏不会产生任何结果。</p>         </td><td id="cd1a1851">            <p id="43238ef8">               <b id="2fff27e7">映射节点</b>功能（可选）<br>               <b id="c243bb41">模板开关</b> -引用模板开关</p>         </td></tr><tr id="5e7ee197" class="ijRowEven"><td id="8577e36b">            <p id="d865a6c9">复制SRC</p>         </td><td id="9e862b05">            <p id="3bedfb12">将输入节点复制到输出模型。包装的模板代码将被忽略。</p>         </td><td id="87a1de2b">            <p id="456540dc">               <b id="e32c779e">映射节点</b>功能-计算要复制的输入节点。</p>         </td></tr><tr id="9ec8c8a1" class="ijRowOdd"><td id="70b18abf">            <p id="1020c67f">复制SRCL</p>         </td><td id="7dbd50e9">            <p id="ab79b0f3">将输入节点复制到输出模型。包装的模板代码将被忽略。<br>只能用于具有多个聚合基数的孩子。</p>         </td><td id="5b00ff8a">            <p id="71a9451d">               <b id="8002e225">映射节点</b>功能-计算要复制的输入节点。</p>         </td></tr><tr id="c31f610c" class="ijRowEven"><td id="aa390411">            <p id="ac821eb3">MAP-SRC</p>         </td><td id="a860efc3">            <p id="5cfb4907">多功能宏，可用于：</p>            <ul class="list _ul"><li class="list__item" id="c00bdc3e"><p>用映射标签标记模板代码；</p></li><li class="list__item" id="edb6d025"><p>用一个新的输入节点替换当前的输入节点；</p></li><li class="list__item" id="12e21963"><p>执行基于非模板的转换；</p></li><li class="list__item" id="5fd64982"><p>由于某种原因访问输出节点。<br>MAP-SRC宏在生成器微步骤的末尾执行-在所有节点和属性宏之后，但在运行任何引用宏之前。</p></li></ul>         </td><td id="bf507a01">            <p id="b2ad8391">               <b id="1cb79c1d">映射节点</b>功能（可选）<br>               <b id="34e39bd6">映射功能</b>函数（可选）-执行基于非模板的转换。<br>如果定义，则包装的模板代码将被忽略。<br>参数：standard + <b id="84f5d608">parentOutputNode-</b>输出模型中的父节点。<br>               <b id="3f507ee3">后处理</b>功能（可选）-允许访问输出节点。<br>参数：standard + <b id="63c200e6">outputNode</b>            </p>         </td></tr><tr id="58dd8d31" class="ijRowOdd"><td id="b7e43ae3">            <p id="40250624">MAP-SRCL</p>         </td><td id="f1a1b071">            <p id="87813b12">与MAP-SRC相同，但可以处理许多新的输入节点（类似于LOOP宏）</p>         </td><td id="39e2f1d3">            <p id="78509947">               <b id="faf705db">映射节点</b>功能<br>               <b id="b3ad3ab5">映射</b>功能（可选）<br>               <b id="2c0a5e13">后处理</b>功能（可选）</p>         </td></tr><tr id="e1debaf8" class="ijRowEven"><td id="db15f52d">            <p id="3bea004a">编织</p>         </td><td id="ce991121">            <p id="cc578590">允许以类似的<b id="afbdedbd">编织规则</b>将其他子节点插入输出模型。包装在<b id="cba21122">WEAVE宏中</b> （或由<b id="00b25fa1">use输入</b>功能提供）的节点将具有提供的模板，并且将插入生成的节点。</p>         </td><td id="c04638a2">            <p id="222b19a6">               <b id="6143e84c">使用输入</b>函数返回节点集合以将宏应用于<br>               <b id="16f64be9">编织</b>对模板的引用，以编织到作为输入提供的节点中</p>         </td></tr><tr id="0f195cde" class="ijRowOdd"><td id="30a46cf2">            <p id="4d655e69">VAR</p>         </td><td id="cec9b3ef">            <p id="cba5de65">将一个或多个命名值引入生成器上下文，然后可以从<i id="30f4c2f3">genContext</i>对象获得该<i id="30f4c2f3">值</i> 。存储的变量是只读的，并且位于VAR宏范围内的生成器上下文中。</p>         </td><td id="0a5c48a5">            <p id="cbf69186">每个变量具有以下参数：<br>                <b id="c713494e">输入</b>存储值的可选<i id="fc3c29b1">BaseLanguage</i>类型，默认为从<i id="df01110a">value</i>函数推断的类型。<br>                <b id="dff63f1a">值</b>函数-返回要存储在变量中的值。<br>            </p>         </td></tr></tbody></table></div>      <aside class="tip sideblock" rel="83b162c6" id="4a5110c7" data-title="">      <p id="be5322f1">仅在BaseLanguage中支持按标识符进行引用解析。<br>类和类构造函数的标识符字符串可能需要（如果类不在同一输出模型中）在类名称前面的方括号中的包名称：<br>         <i id="45b0e358">[package.name] ClassName</i>      </p>   </aside>      <h3 id="templateswitch">模板切换</h3>   <p id="d857a036">模板开关与SWITCH宏（ <i id="745ca0d6">TemplateSwitchMacro</i>概念）配对使用。单个模板开关可以在许多不同的SWITCH宏中重复使用。模板开关由一组案例和一个默认案例组成。每个开关案例都是简化规则，即模板开关包含简化规则列表。</p>   <p id="22f76842"><b id="40702c88">默认情况下的</b>后果可能是以下<b id="40702c88">情况</b>之一：</p>   <ul class="list _ul"><li class="list__item" id="ed981588"><p>外部模板（参考）</p></li><li class="list__item" id="b9a2baf6"><p>内联模板</p></li><li class="list__item" id="02877d85"><p>放弃输入</p></li><li class="list__item" id="21ead204"><p>驳回最高规则<br>..或可以省略。在这种情况下，将应用由相应的SWITCH宏包围的模板代码。</p></li></ul>   <p id="9b0fbcc4">模板开关可以通过<b id="11c34a14">extends</b>属性继承其他开关的归约规则。生成器执行SWITCH宏时，它将尝试查找最特定的模板开关（作用域内可用）。因此，实际执行的模板切换不一定是在SWITCH宏的<b id="65cb259f">模板切换</b>属性中定义的<b id="65cb259f">模板切换</b> 。</p>   <p id="95eb8b4c">通过<b id="bee3259b">null输入消息</b>属性，用户可以指定<b id="d8a6de48">错误，警告</b>或<b id="1d2447dd">信息</b>消息，如果SWITCH-macro中的<b id="65295055">映射节点</b>函数返回null（默认情况下不显示任何消息，并且宏将被完全跳过）。</p>   <p id="c8919317">模板开关可以接受参数，与模板声明相同。参数化开关的使用要求在<b id="b860cad6"><i id="7ed46fa7">SWITCH</i></b>宏中提供参数。的<code class="code">TemplateSwitchMacro</code>概念支持带或不带参数的开关。</p>      <h3 id="generationcontext(operations)">生成上下文（操作）</h3>   <p id="36bb0b0c">生成上下文（宏函数和规则函数中的<i id="0e631596">genContext</i>参数）允许在输出模型中查找节点，生成唯一的名称并提供其他有用的功能。</p>   <p id="ae510ea4">生成上下文不仅可以在生成器模型中使用，而且可以在实用程序模型中用作<b id="24ac6910">gencontext</b>类型的变量。</p>   <p id="f98cffa1">genContext的操作使用熟悉的点符号调用： <i id="9994255c">genContext.operation</i>   </p>   <h4 id="findingoutputnode">查找输出节点</h4>   <div class="table-wrapper"><table width="100%" id="98666edb"><thead><tr id="3ff8e2ff" class="ijRowHead"><th id="98ec43d4">            <p id="40dfaa81">               <i id="3a78daf3">获取<mapping label>模型（ <model>）的</model></mapping label>输出</i>            </p>         </th><th id="880be717">            <p id="df6221f9">返回由指定模型中带标签的<i id="6798cde9">条件根规则</i>生成的输出节点。<br>如果有多个匹配的输出节点，则发出错误。</p>         </th></tr></thead><tbody><tr id="f4d216ee" class="ijRowOdd"><td id="9aeda987">            <p id="007ea93c">               <i id="538362a8">获得<mapping label>（ <input node>）的</input node></mapping label>输出</i>            </p>         </td><td id="b4cc68e1">            <p id="27461a20">返回通过标记的生成器规则，宏或模板片段从<i id="78d7e362">输入</i>节点生成的输出节点。<br>如果有多个匹配的输出节点，则发出错误。</p>         </td></tr><tr id="125379a7" class="ijRowEven"><td id="abda5b57">            <p id="580c1118">               <i id="045f84a4"><mapping label="">为（ <input node>）</input node></mapping>选择输出</i>            </p>         </td><td id="7b60957d">            <p id="1e12bebb">仅在引用宏的<b id="4b0a609f">引用</b>函数的上下文中使用，并且仅当所需的输出节点是该引用宏正在解析的引用的目标时才使用。<br>返回通过标记的生成器规则，宏或模板片段从<i id="4d41d0c0">输入</i>节点生成的输出节点。此操作与上一个操作之间的区别在于，该操作可以自动解决<i id="0fae9cb8">多输出节点</i>冲突-它选择输出节点，该节点在给定上下文中可见。</p>         </td></tr><tr id="497daf69" class="ijRowOdd"><td id="e59c190a">            <p id="2ab098b8">               <i id="e7316f4a">获取<mapping label>（ <input node>）的</input node></mapping label>输出列表</i>            </p>         </td><td id="13764b08">            <p id="2d559375">返回通过标记的生成器规则，宏或模板片段从<i id="25f9e477">输入</i>节点生成的输出节点的列表。</p>         </td></tr><tr id="77869bb1" class="ijRowEven"><td id="36b6af56">            <p id="93594442">               <i id="56ef3ecc">获取（的复制输出<input node="">）</i>            </p>         </td><td id="2a9fa1b5">            <p id="04a25940">返回已通过复制输入节点创建的输出节点。如果在复制过程中减少了输入节点，但<i id="909da079">输出节点</i>的概念相同（即未将其减少为完全不同的东西），则仍将其视为“复制”。<br>如果有多个匹配的输出节点，则发出错误。</p>         </td></tr></tbody></table></div>   <h4 id="generatinguniquename">产生唯一名称</h4>   <p id="50ef2e34">      <i id="7dc66c47">来自的唯一名称<base name="">在上下文中<node></node></i>   </p>   <p id="46d85b69">在整个生成过程中确保唯一性。<br>与使用该服务未生成的名称相冲突仍然是可能的。</p>   <p id="053bb51c"><b id="80ea22d9">上下文节点</b>是可选的，尽管我们建议对其进行指定以确保生成的稳定性。如果指定，则MPS会尽最大努力在作用域（通常是根节点）中生成“包含”的名称。然后，当重新计算名称时（由于输入模型或生成器模型中的更改），这不会影响范围之外的其他名称。</p>   <h4 id="templateparameters">模板参数</h4>   <div class="table-wrapper"><table width="100%" id="8e9b87b8"><thead><tr id="f12456e3" class="ijRowHead"><th id="2922546b">            <p id="5586a562">               <i id="2df97108">#patternvar</i>            </p>         </th><th id="7f010001">            <p id="8d6316b2">捕获的模式变量的值<br>仅在规则后果中可用</p>         </th></tr></thead><tbody><tr id="3a1048d5" class="ijRowOdd"><td id="a3a0edbd">            <p id="3b3ff936">               <i id="c0b46c9a">参数</i>            </p>         </td><td id="3ab1a12c">            <p id="b3f489a8">模板参数的值<br>仅在外部模板中可用</p>         </td></tr></tbody></table></div>   <h4 id="gettingcontextualinfo">获取上下文信息</h4>   <div class="table-wrapper"><table width="100%" id="f006b0e6"><thead><tr id="780a7f29" class="ijRowHead"><th id="665ec79d">            <p id="a336fb14">               <i id="ff8ba850">inputModel</i>            </p>         </th><th id="b83aaefd">            <p id="34256283">当前输入模型</p>         </th></tr></thead><tbody><tr id="01e6efe5" class="ijRowOdd"><td id="b7ead5e5">            <p id="6129cb4a">               <i id="b37296d0">原始模型</i>            </p>         </td><td id="690f293e">            <p id="be2eb35c">原始输入模型</p>         </td></tr><tr id="d53067ed" class="ijRowEven"><td id="a234879f">            <p id="67940c9d">               <i id="d85dae18">outputModel</i>            </p>         </td><td id="f7a23679">            <p id="fce6466f">当前输出模型</p>         </td></tr><tr id="2b440fc8" class="ijRowOdd"><td id="2df6bc0b">            <p id="eee0356e">               <span class="text-line-through" id="55583523">                  <i id="6d2d2b97">templateNode</i>               </span>            </p>         </td><td id="06f7ad26">            <p id="d872d149">宏包围的模板代码。<br>仅用于宏功能</p>            <p id="fc7e7bad">                <i id="1d5d63d6"></i>            </p>            <p id="8eff533a">主要缺陷是此操作暗含解释模板。生成模板时没有模板模型。</p>            <p id="4e0b7f7c">此外，该操作的约定是模糊的（即，它在模板调用的参数查询的上下文中给出了什么）。</p>         </td></tr><tr id="0d86bea0" class="ijRowEven"><td id="14a43e5b">            <p id="ef2bd265">               <i id="2e085427">得到前一个输入<mapping label=""></mapping></i>            </p>         </td><td id="301cbf12">            <p id="a9341c68">返回输入节点，该输入节点已用于封装被标记的宏包围的模板代码。<br>它仅用于宏功能。</p>         </td></tr></tbody></table></div>   <h4 id="transferringuserdata">传输用户数据</h4>   <p id="f1c881be">在生成过程中，MPS维护三个用户对象映射，每个映射具有不同的生命周期：</p>   <ul class="list _ul"><li class="list__item" id="86f94188"><p>         <b id="49709351">会话对象</b> -在整个生成会话中保留；</p></li><li class="list__item" id="fd642267"><p>         <b id="b119b9bf">步骤对象</b> -通过单个生成步骤保存；</p></li><li class="list__item" id="15621817"><p>         <b id="caa36b97">瞬态对象</b> -仅在微步中存活。</p></li></ul>   <p id="23b0ad97">开发人员可以使用数组（方括号）表示法访问用户对象图：</p>   <div class="code-block" data-lang="none">会话对象[ <key>]步骤对象[ <key>]临时对象[ <key>]</key></key></key></div>   <p id="875be905">键可以是任何对象（ <i id="4329aa54">java.lang。对象</i> ）。</p>   <aside class="tip sideblock" rel="875be905" id="8a4f87ce" data-title="">      <p id="8eb3ffef">会话和步骤对象不能用于跨步骤和微步骤传递与特定输入节点关联的数据，因为输入节点及其ID均不能用作键（输出节点始终具有不同的ID）。<br>要传递此类数据，您应该使用在<i id="eb187076">jetbrains.mps.smodel</i>类中定义的<i id="eb187076">putUserObject</i>和<i id="d77a8103">getUserObject</i>方法<i id="afa4c068">。SNode</i> 。<br>数据将被传输到输入节点的所有输出副本。如果在复制节点时发生了轻微的减少（即不更改节点概念），数据也将被传输到输出节点。</p>   </aside>   <h4 id="logging">记录中</h4>   <div class="code-block" data-lang="none">显示信息<message text="">-> <node>显示错误<message text="">-> <node>显示警告<message text="">-> <node>
</node></message></node></message></node></message></div>   <p id="6bb8ad58">在MPS消息视图中创建消息。如果指定了<i id="d7603d97">node</i>参数，则单击消息将导航到该节点。如果出现<b id="d8d11fd3">错误</b>消息，MPS还将输出一些其他诊断信息。</p>   <h4 id="utilities(re-usablecode)">实用程序（可重复使用的代码）</h4>   <p id="df30fe8f">如果您有重复的代码（在规则，宏等中），并且想说，将其提取为可重用的静态方法，则必须在单独的非生成器模型中创建此类。</p>   <p id="d586c042">如果您在生成器模型中（即在具有“ generator”构造型的模型中）创建实用程序类，则它将被视为根模板（未使用），并且不会从中生成任何代码。</p>   <h3 id="mappingscript">映射脚本</h3>   <p id="c85cb6ac">映射脚本是用户代码，可以在模型转换之前（预处理脚本）或在模型转换之后（后处理脚本）执行。应该在<a href="#mappingconfiguration">#Mapping Configuration中</a>引用它，以将其作为生成步骤的一部分进行调用。映射脚本提供了执行基于非模板的模型转换的功能。</p>   <p id="67e8bb1a">预处理脚本通常还用于从输入模型中收集某些信息，这些信息以后可在基于模板的转换过程中使用。脚本收集的信息将另存为瞬态，步进或会话对象。</p>   <p id="5870cf41">脚本样本：</p>   <div class="code-block" data-lang="none">映射脚本myPreProcessingScript脚本类型：预处理输入模型修改模型：false（模型，genContext，operationContext）-> void {for（节点<myconcept>te：model.nodes（MyConcept））{genContext.transient对象[MyConceptUtil。KEY_ID] =...。; }}</myconcept></div>   <p id="d1385a55">特性：</p>   <div class="table-wrapper"><table width="100%" id="d6993741"><thead><tr id="718207db" class="ijRowHead"><th id="34a141e1">            <p id="65149197">               <i id="eedfe044">脚本种类</i>            </p>         </th><th id="a607b7af">            <ul class="list _ul"><li class="list__item" id="d42ff1cc"><p>                  <i id="23d8b0ae">预处理输入模型</i> -在基于模板的转换之前，在生成步骤的开始执行脚本；</p></li><li class="list__item" id="7c4ab72b"><p>                  <i id="069da0e9">后处理输出模型</i> -在基于模板的转换之后，在生成步骤的最后执行脚本。</p></li></ul>         </th></tr></thead><tbody><tr id="85c33a88" class="ijRowOdd"><td id="cd25dae6">            <p id="cb13c893">               <i id="c7bb37a1">修改模型</i>            </p>         </td><td id="3ae4137a">            <p id="9a5ac78e">仅在<i id="2ba0ee38">脚本种类=预处理输入模型时</i>可用                <br>如果设置为<i id="26d42257">true</i>且输入模型是原始输入模型，则MPS将在应用脚本之前创建一个瞬态输入模型。<br>如果设置为<i id="f4bc78a3">false</i>但脚本尝试修改输入模型，则MPS将发出错误。</p>         </td></tr></tbody></table></div>   <p id="7d3f8555">代码上下文：</p>   <div class="table-wrapper"><table width="100%" id="41b91e2d"><thead><tr id="1b2c18d3" class="ijRowHead"><th id="c5c458d1">            <p id="0a356c4b">               <i id="3700420f">模型</i>            </p>         </th><th id="b89bec6f">            <p id="63e7dce9">当前模型</p>         </th></tr></thead><tbody><tr id="013d47b7" class="ijRowOdd"><td id="58538ca1">            <p id="65e84c28">               <i id="c3da0625">genContext</i>            </p>         </td><td id="d9134651">            <p id="3fbcbfe3">生成上下文，用于访问临时/会话或步骤对象。</p>         </td></tr><tr id="7d5e99f8" class="ijRowEven"><td id="56105c4c">            <p id="0a08bebf">               <span class="text-line-through" id="4f6bec9a">                  <i id="eb6ed860">调用上下文</i>               </span>            </p>         </td><td id="ae92cde0">            <p id="c678ba17">操作上下文（ <i id="da9e7827">jetbrains.mps.smodel。与模块关联的IOperationContext</i> Java接口）-原始输入模型的所有者</p>            <p id="822362ce">               <i id="b80c609a"></i>            </p>         </td></tr></tbody></table></div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="mps-generator.html">生成</a> <a class="navigation-links__next" href="the-generator-algorithm.html">器生成器算法</a></div></i></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>