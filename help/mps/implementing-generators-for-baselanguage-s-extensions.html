<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>为BaseLanguage扩展实现生成器-帮助|帮助MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Implementing+generators+for+BaseLanguage%27s+extensions.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="implementing-generators-for-baselanguage-s-extensions.xml" data-toc="Implementing+generators+for+BaseLanguage%27s+extensions.html">为BaseLanguage的扩展实现生成器</h1>   <p id="61ea68f2"> </p>   <p id="14054f7f">本文展示了一种惯用的方式，用于为使用lvalue-expressions操作的BaseLanguage扩展编写生成器。我们说如果可以在赋值表达式的左侧使用BaseLanguage表达式，则该表达式为<i id="283971e2">lvalue</i> 。在行为方面，引入此类表达式的概念应覆盖实例方法<i id="bf6d24ff">Expression＃isLValue（）</i>或静态方法<i id="e4bb952b">Expression＃lvalue（）</i> 。</p>   <p id="5e803941">该研究包括两种独立的语言，这两种语言都是BaseLanguage的小扩展。可以在MPS发行版的BlReference示例项目中找到源代码。</p>   <h4 id="jetbrains.mps.baselanguage.box">jetbrains.mps.baseLanguage.box</h4>   <p id="717c29c2">用这种语言，我们展示了生成自定义BaseLanguage扩展的方法，该扩展引入了新的左值表达式。所提出的技术可用于生成诸如<i id="49ebb933">smodel属性访问</i>或自定义集合的<i id="82d1f23d">index访问元素之</i>类的表达式。</p>   <p id="c44b3abf">框BaseLanguage的扩展引入了一个新的“框”类型，该类型包装一个变量并提供对该变量的读写操作。整个语言包含三个概念：</p>   <ul class="list _ul"><li class="list__item" id="718ddb99"><p>         表示模型中“框”类型的<i id="abfa1d93">BoxType</i> 。</p></li><li class="list__item" id="175514f7"><p>         可在新表达式中用于创建“ box”实例的<i id="da658ee4">BoxCreator</i></p></li><li class="list__item" id="69dba041"><p>         <i id="eedd4bc9">Box_ValueOperation</i> ，当其操作数为“ box”类型时，可用作点表达式的操作。</p></li></ul>   <p id="3dba6a5b">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-10-25-36.png"><img alt="image2018 11 12 10 25 36" title="image2018 11 12 10 25 36" src="/help/img/idea/2019.2/image2018-11-12-10-25-36.png" id="a46944a6" width="500" height="236"></a></figure>   <p></p>   <p id="0e837ecf">我们将使用“值”操作的点表达式视为lvalue-expression，因此在<i id="2701acc8">Box_ValueOperation</i>的行为方面重写<i id="47acaf5b">IOperation＃lvalue（）</i>方法。重写此方法后，可以在赋值的左侧使用带“值”操作的点表达式。此外，此操作可用于复合分配（例如+ =，-=）以及递增和递减操作。我们的最终目标是为<i id="87c1802e">Box_ValueOperation</i>概念编写一个生成器。</p>   <p id="099a2694">天真的方法是手动处理所有可能的情况，在这些情况下，具有“值”运算的点表达式将被聚合，并为每种情况生成适当的Java代码。但是，这种方法不足，因为要处理的案件太多。同样，使用这种方法，当表达式与来自BaseLanguage的独立扩展的某些表达式聚合时，我们将无法处理这种情况。</p>   <p id="95007c10">一种替代方法是将我们的表达式转换为另一个已经存在的左值表达式。有几种Java语言可用的左值表达式，我们可以将表达式转换成这些值-变量引用，字段访问操作或通过索引操作访问数组的元素。不幸的是，并非所有自定义的左值表达式都可以轻松转换为Java左值表达式。</p>   <p id="7a5054c4">例如，如果在运行时使用具有两种方法（即<i id="99551a95">getValue</i>和<i id="f338b494">setValue）的</i> <i id="b4b6a7f9">Box</i>接口表示“ box”类型，则很难将“ value”操作转换为Java lvalue-expression <i id="f338b494">。</i> 为了克服这个问题，我们可以使用BaseLanguage的生成时概念“通用左值表达式”，可以将表达式转换为该概念：</p>   <p id="18aab05c">      </p><figure><img alt="genxx1" title="genxx1" src="/help/img/idea/2019.2/genxx1.png" id="69b933be" width="500" height="364"></figure>   <p></p>   <p id="a6e81740">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-11-36-58.png"><img alt="image2018 11 12 11 36 58" title="image2018 11 12 11 36 58" src="/help/img/idea/2019.2/image2018-11-12-11-36-58.png" id="de362060" width="300" height="714"></a></figure>   <p></p>   <p id="4778e219">“通用左值表达式”由两个强制性角色组成： <i id="9003b57a">类型</i>和<i id="c84c7e32">引用。</i>前一个角色指定我们原始的左值表达式的类型，而后一个角色指定<i id="56d1506f">jetbrains.mps.references类型的<i id="56d1506f">表达式。参考<t>。</t></i>此类型提供两种方法： <i id="fa6872ed">#get（）</i>以便从评估变量中读取值，而<i id="21b00a62">#set（）</i> -为评估变量分配新值。</i></p><i id="56d1506f">   <p id="9ff161ab">“通用左值表达式”还包含两个可选角色： <i id="150095ae">获取值</i>和<i id="2fd86662">分配值</i> 。这些表达式用于简化生成的代码并减少<i id="e507f810">Reference</i>的内存分配<i id="e507f810"><t></t></i>执行期间的对象。当生成的表达式不在左值位置使用而第二个表达式仅在生成的表达式在赋值的左侧角色中使用时，使用第一个表达式。请注意，在赋值表达式中有一个特殊的“值”关键字，该关键字应在表达式中仅使用一次。</p>   <h4 id="jetbrains.mps.baselanguage.date">jetbrains.mps.baseLanguage.date</h4>   <p id="d2b62d98">在此示例语言中，我们展示了如何生成自定义BaseLanguage扩展，这些扩展引入新表达式或自定义现有表达式，这些表达式以某种角色聚合左值表达式。</p>   <p id="15892886">日期BaseLanguage的扩展引入了新的“日期”类型以及对“日期”实例的一些操作。</p>   <p id="dbf058d6">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-10-45-48.png"><img alt="image2018 11 12 10 45 48" title="image2018 11 12 10 45 48" src="/help/img/idea/2019.2/image2018-11-12-10-45-48.png" id="75840739" width="500" height="202"></a></figure>   <p></p>   <p id="f60e0338">在运行时，我们将用<i id="40e04d77">java.time表示“日期”类型<i id="40e04d77">。本地日期：</i>   </i></p><i id="40e04d77">   <p id="0f61e210">      <i id="8472e68f"></i>   </p>   <p id="97e073b6">“ date”扩展名重载了“ date”和“ int”实例的<i id="7726fe71">加号运算符</i> ，以便此操作将天（其量从右子表达式评估）加到从左子表达式评估的日期。在生成时，我们将此plus运算符转换为一个简单的静态方法调用：</p>   <p id="de425a8b">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-10-59-49.png"><img alt="image2018 11 12 10 59 49" title="image2018 11 12 10 59 49" src="/help/img/idea/2019.2/image2018-11-12-10-59-49.png" id="b12ff692" width="900" height="202"></a></figure>   <p></p>   <p id="ae62a57d">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-11-31-48.png"><img alt="image2018 11 12 11 31 48" title="image2018 11 12 11 31 48" src="/help/img/idea/2019.2/image2018-11-12-11-31-48.png" id="f8976aee" width="500" height="110"></a></figure>   <p></p>   <p id="a1a3d98e">为了使扩展一致，我们还希望重载plus赋值表达式，就像重载plus运算符一样。<i id="8842aa30">plus运算符</i>与<i id="5eeb38e3">plus赋值表达式</i>之间的一个显着区别是，在<i id="f19c8849">plus赋值中</i> ，左子表达式应为左值，因此必须将该表达式评估为一个变量，我们可以将其赋给计算值。但是，在Java中，我们无法通过方法调用传递变量，因此我们无法将表达式转换为仅方法调用。</p>   <p id="e12ba232">为了解决这个问题，MPS提供了“ @byRef”生成时间概念。该表达式包装了一个左值表达式，并在生成过程<i id="95ae4dd7">中将其转换为<i id="95ae4dd7">jetbrains.mps.references表达式<i id="95ae4dd7">。参考<t> </t></i>类型。给定这种类型的实例，您可以对从包装的左值表达式求值的变量产生get＆set操作。</i></i></p><i id="95ae4dd7"><i id="95ae4dd7">   <p id="add44544">使用“ @byRef”表达式，可以通过以下方式轻松生成plus赋值表达式：</p>   <p id="53fdc9a1">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-11-33-15.png"><img alt="image2018 11 12 11 33 15" title="image2018 11 12 11 33 15" src="/help/img/idea/2019.2/image2018-11-12-11-33-15.png" id="2d1ab4f2" width="900" height="194"></a></figure>   <p></p>   <p id="ddc6272f">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-11-34-3.png"><img alt="image2018 11 12 11 34 3" title="image2018 11 12 11 34 3" src="/help/img/idea/2019.2/image2018-11-12-11-34-3.png" id="b8a6cdee" width="600" height="182"></a></figure>   <p></p>   <h4 id="acompositionof independent extensions ">独立扩展的组成</h4>   <p id="60e34567">上面显示的两个扩展名互不依赖。它们的两个生成器均使用BaseLanguage提供的生成时间概念进行设计。这些生成时工具本身可使生成器更加一致，并且包含更少的样板代码。除此之外，扩展（其生成器以所示方式设计）可以安全地彼此聚合，而不会相互依赖：</p>   <p id="c93c140c">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/image2018-11-12-11-51-17.png"><img alt="image2018 11 12 11 51 17" title="image2018 11 12 11 51 17" src="/help/img/idea/2019.2/image2018-11-12-11-51-17.png" id="7d51cbbd" width="500" height="240"></a></figure>   <p></p>   <p id="cf33c0ef"> </p>   <p id="b9926120"> </p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="mps-java-compatibility.html">MPS Java兼容性</a> <a class="navigation-links__next" href="closures.html">关闭</a></div></i></i></i></i></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>