<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>自定义持久性食谱-帮助|帮助MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Custom+Persistence+Cookbook.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="custom-persistence-cookbook.xml" data-toc="Custom+Persistence+Cookbook.html">自定义持久性食谱</h1>   <p id="441f356c">本文档将使用MPS附带的<b id="c3b46924">xmlPersistence</b>示例来教您如何定义，部署和使用自己的持久性格式。</p>   <h2 id="whatiscustompersistence?">什么是自定义持久性？</h2>   <p id="58f4a3b3">MPS通常以其自己的基于XML的格式保存模型。但是，在某些情况下，您可能想以自己的格式加载或保存模型文件。<br>例如，假设我们要利用MPS来描述一种现有的语言。例如， <i id="bbfe9b08">BaseLanguage</i>是对Java的很好描述。在这种情况下，应该可以从MPS中访问为该原始语言编写的库。语言的<b id="bb54769c">存根</b>方面有助于为此类库创建<b id="c38284db">存根模型</b> 。然后，将存根模型用于引用MPS之外的代码。<br>另一个有用的示例-如果只需要使用MPS编辑器编辑自己的DSL文件，则MPS所需的全部就是将其存储为文本格式，以便可以在任何文本编辑器中对其进行编辑将很有用。</p>   <h2 id="lookaroundthesampleproject">看看示例项目</h2>   <p id="b9b9e3c7">如果打开<b id="648428c0">xmlPersistence</b>示例项目，您将获得三个主要解决方案，每个解决方案在难题中均扮演着各自的角色。</p>   <p id="cc4599cf">      </p><figure><img alt="cp1" title="cp1" src="/help/img/idea/2019.2/cp1.png" id="ab0d2986" width="479" height="375"></figure>      <br><i id="bebfef5d">xmlPersistence</i>模块定义实际的持久性逻辑， <i id="54154311">xmlPersistence.build</i>包含构建脚本，而<i id="1a4ae44b">xmlPersistence.ideaPlugin</i>包含自定义插件描述符。尽管构建脚本通常通常会自己提供一个合理的插件描述符，但这一次我们需要自定义描述符，因此我们将其明确包含在项目中。<p></p>   <h2 id="definethepersistenceformat">定义持久性格式</h2>   <p id="aaf9c00c"><i id="585031d6">xmlPersistence</i>模块实现了持久性逻辑。MPS中的持久性类型是在<b id="a189bd6d">每个模型级别上设置的</b> 。在我们简化的情况下，该示例可以将模型（仅限于<i id="4388e851">jetbrains.mps.core.xml</i>语言的单个<i id="ed34dce7">XMLFile</i>根元素） <i id="4388e851">存储</i>到纯XML文档中。实际的XML解析逻辑位于<i id="b6cc326a">XmlConverter</i>类中，而<i id="d55c5686">XmlModelPersistence</i>类则实现了用于连接MPS内部工作的基本接口。</p>   <p id="72f1652f">      </p><figure><img alt="cp2" title="cp2" src="/help/img/idea/2019.2/cp2.png" id="37b5f683" width="369" height="142"></figure>      <br><i id="0182b25c">getFormatTitle（）</i>方法在这里值得特别提及，因为它返回的字符串将用于表示未来用户的存储格式。<p></p>   <p id="c703bb54">另外， <i id="e6fc75a9">getFileExtension（）</i>方法将为<i id="5d1958c2">.xml</i>文件注册我们的自定义持久性。</p>   <h3 id="pluginid">插件ID</h3>   <p id="dd028bf7">还要注意，该模块在其模块属性的“ <i id="bcf83578">想法插件”</i>选项卡中设置了<b id="6b838fe7">插件ID</b> ：</p>   <p id="df2b9cdc">      </p><figure><img alt="cp3" title="cp3" src="/help/img/idea/2019.2/cp3.png" id="a4833c60" width="630" height="436"></figure>   <p></p>   <p id="a68ba02a">该标识符必须与<i id="a81b2f39">xmlPersistence.ideaPlugin</i>解决方案内的插件（xml）描述符中声明的插件标识符匹配。我们将<i id="3e568f5b">idea</i>插件标识符添加到<i id="3e568f5b">xmlPersistence</i>解决方案的属性中，以指定该解决方案是插件的一部分，因此可以引用（或在运行时加载）任何插件的类。</p>   <h2 id="buildthempsplugin">编译MPS插件</h2>   <p id="4820c894"><i id="a2c63693">xmlPersistencePlugin</i>构建脚本是一个标准构建脚本，它将三个模块<i id="a2c63693">压缩</i>到一个IDEA / MPS插件中。</p>   <p id="9c57a898">      </p><figure><img alt="cp4" title="cp4" src="/help/img/idea/2019.2/cp4.png" id="80c79309" width="1117" height="922"></figure>   <p></p>   <aside class="tip sideblock" rel="9c57a898" id="5043d5d8" data-title="">      <p id="dd773d3d">确保在<b id="4a659f52">宏</b>部分中指定的路径正确指向您的MPS和IntelliJ IDEA安装文件夹。</p>   </aside>   <p id="9dd76f91"><i id="5ebf695a">插件</i>描述符提供了标准的插件信息，并注册了我们的<i id="555b7e8c">jetbrains.mps.persistence。XmlModelPersistence</i>类作为mps <i id="346474d4">。ModelFactoryProvider。</i> 这是需要我们提供显式插件描述符的额外位。</p>   <p id="a6c635cc">      </p><figure><img alt="cp5" title="cp5" src="/help/img/idea/2019.2/cp5.png" id="89bba9fe" width="1278" height="383"></figure>   <p></p>   <p id="8565f169">重建后，您应该能够运行构建脚本并生成插件：</p>   <p id="00fa6b76">      </p><figure><img alt="cp6" title="cp6" src="/help/img/idea/2019.2/cp6.png" id="9b8c7a78" width="542" height="481"></figure>   <p></p>   <p id="737004d5">这将创建插件，以便我们可以将其分发给用户。</p>   <h2 id="buildtheintellijideaplugin">构建IntelliJ IDEA插件</h2>   <p id="f1e65350">构建IntelliJ IDEA插件与构建MPS插件并没有太大区别。你只需要改变从<i id="ca6813ca">MPS</i>依赖于<i id="8633af56">mpsPlugin</i>在构建脚本文件并设定工件位置，无论您的MPS IDEA插件已经被部署。</p><figure><img alt="cp7" title="cp7" src="/help/img/idea/2019.2/cp7.png" id="b4d7ca04" width="780" height="330"></figure>   <p></p>   <p id="25dccf1e">重建项目并运行构建脚本后，您将获得一个插件以部署到IDEA中。</p>   <h2 id="usingthecustompersistenceplugininmps">在MPS中使用自定义持久性插件</h2>   <p id="7ec91242">将生成的插件安装到MPS之后，在创建新模型时，您可以为其指定<i id="0ef66a54">XML文件</i>持久性提供程序：</p>   <p id="a456b9fd">      </p><figure><img alt="cp8" title="cp8" src="/help/img/idea/2019.2/cp8.png" id="74a54ae8" width="689" height="328"></figure>   <p></p>   <p id="51b09ced">就像我们在<i id="ce494e16">XmlModelPersistence.createEmpty（）</i>方法中指定的<i id="ce494e16">那样</i> ，新模型将添加<i id="9e37e651">jetbrains.mps.core.xml</i>语言作为使用的语言， <i id="9e37e651">并向其中</i>添加一个空的根节点：<br>       </p><figure><img alt="cp9" title="cp9" src="/help/img/idea/2019.2/cp9.png" id="6c126225" width="635" height="451"></figure>      <br>       <figure><img alt="cp10" title="cp10" src="/help/img/idea/2019.2/cp10.png" id="73393a04" width="359" height="179"></figure>   <p></p>   <p id="df0734ac">无论您在根节点中键入什么内容，都将立即保存到相应的xml文件中。在编辑器中打开后，对基础xml文件的更改将反映在模型中。<br>       </p><figure><img alt="cp11" title="cp11" src="/help/img/idea/2019.2/cp11.png" id="6f111c4e" width="301" height="182"></figure>       <figure><img alt="cp12" title="cp12" src="/help/img/idea/2019.2/cp12.png" id="91a1e1ef" width="481" height="191"></figure>   <p></p>   <h2 id="usingthecustompersistenceplugininintellijidea">在IntelliJ IDEA中使用自定义持久性插件</h2>   <p id="3142b4b4">IDEA插件还允许使用基于MPS的投影编辑器来编辑XML文档，并将其持久化为纯XML文件。由于.xml文件与IDEA中的XML编辑器相关联，因此当单击XML文件时，我们将打开默认的IDEA编辑器。</p><figure><img alt="cp20" title="cp20" src="/help/img/idea/2019.2/cp20.png" id="80f02cfc" width="486" height="134"></figure>   <p></p>   <p id="37d2cc9b">但是，由于<i id="39e255b7">sample.xml</i>文件位于已配置的MPS模型根目录下，因此MPS将调用我们的自定义持久性插件，并从中构建模型。当您按<i id="04637a76">Control + N / Cmd + N</i>按名称打开一个类时，您可以选择打开示例模型：<br>       </p><figure><img alt="cp21" title="cp21" src="/help/img/idea/2019.2/cp21.png" id="0d7b5146" width="444" height="122"></figure>   <p></p>   <p id="bc9c5f20">然后，您可以在投影编辑器中对其进行编辑，并将您的更改保存到原始xml文件中：<br>       </p><figure><img alt="cp22" title="cp22" src="/help/img/idea/2019.2/cp22.png" id="bc4a8e76" width="354" height="162"></figure>   <p></p>   <aside class="tip sideblock" rel="bc9c5f20" id="ca40ada9" data-title="">      <p id="b70c1613">目前，MPS不允许您自定义IntelliJ IDEA中新创建的模型的持久性存储类型。新模型始终接收默认的MPS持久性类型。但是，如果MPS复制到已配置的模型根目录中，则可以使用任何受支持的持久性类型打开现有模型。</p>   </aside>   <h2 id="debuggingtheplugin">调试插件</h2>   <p id="89e0231d">当您想直接在MPS中立即测试新的持久性实现时，MPS还可为您提供帮助。您只需在<i id="e17f150e">“</i> <i id="39d89678">部署插件”</i>模板上创建<i id="e17f150e">“运行配置”</i>即可：</p>   <p id="657ec703">      </p><figure><img alt="cp13" title="cp13" src="/help/img/idea/2019.2/cp13.png" id="715b89c0" width="792" height="283"></figure>      <br>然后，指定您的插件（在重建项目并重新运行构建脚本之后），以由<i id="7635230e">运行配置</i>部署：<p></p>   <p id="e02b1ed9">      </p><figure><img alt="cp14" title="cp14" src="/help/img/idea/2019.2/cp14.png" id="806c318b" width="1105" height="727"></figure>   <p></p>   <p id="6911f711">最后，您运行配置以将插件安装到MPS中（MPS将重新启动）：<br>       </p><figure><img alt="cp15" title="cp15" src="/help/img/idea/2019.2/cp15.png" id="c05947ef" width="1072" height="676"></figure>   <p></p>   <p id="f3d24727">完成此步骤后，您将能够对模型使用自定义持久性提供程序，并测试其行为是否符合预期。</p>   <p id="14a158dd">该插件将安装到中<i id="4375a5b9">。您的个人文件夹的MPS3x</i>子目录在Windows或<i id="ed74be31">$ HOME /库/ Application Support / MPS3x</i>在Mac上。您可以通过<i id="54978836">插件管理器</i> UI或通过手动删除插件来卸载或禁用插件。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="custom-language-aspect-cookbook.html">自定义语言方面的食谱</a> <a class="navigation-links__next" href="regular-expressions.html">正则表达式</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>