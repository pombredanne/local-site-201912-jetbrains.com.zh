<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>发电机用户指南Demo2-帮助| MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Generator+User+Guide+Demo2.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="generator-user-guide-demo2.xml" data-toc="Generator+User+Guide+Demo2.html">发电机用户指南Demo2</h1>   <h2 id="generatoruserguidedemo2">发电机用户指南演示2</h2>   <p id="357287f2">在本演示中，我们将再次生成Java Swing应用程序，但是与以前的演示1不同，这次它将是<b id="c12ddc7e">每个输入模型一个Java应用程序</b> （在演示1中，我们为每个输入XML文档生成了一个单独的Java应用程序）。Demo 2创建的单个Java应用程序将包含输入模型的所有XML <i id="b0a2c0a7">文档</i>中提到的所有组件。</p>         <a name="new_language"></a>      <h2 id="newlanguage">新语言</h2>   <p id="1f667ac0">我们需要先进行一些技术设置：</p>   <ul class="list _ul"><li class="list__item" id="da190338"><p>创建一种新语言：“ generator_demo.demoLang2”</p></li><li class="list__item" id="be6df3f3"><p>在语言属性对话框中，添加对'jetbrains.mps.sampleXML'和'jetbrains.mps.baseLanguage'的<b id="fa926652">扩展依赖</b>项</p></li><li class="list__item" id="f88232a8"><p>如果尚未自动创建该语言的新生成器（有关详细信息，请参见《 <a href="generator-user-guide-demo1.html">生成器用户指南Demo1</a> 》）。</p></li></ul>   <p id="444c4ae0">由于我们要生成的代码与演示1中的代码几乎相同，因此我们将从<i id="74edc69a">demoLang1</i>生成器中复制应用程序类模板：</p>   <ul class="list _ul"><li class="list__item" id="3449556a"><p>转到<i id="747feb72">demoLang1中的</i>模型“ main @ generator”      </p></li><li class="list__item" id="e1c2f58e"><p>在项目树中选择“ map_Document”模板并将其复制到剪贴板</p></li><li class="list__item" id="fb75c086">返回<i id="b874b99b">demoLang2中的</i>模型“ main @ generator”（在树中选择该模型）并从剪贴板粘贴<aside class="note " rel="b874b99b" id="ae969dd6" data-title="">            <p id="1ad9db0a">“导入和语言”对话框将提供一些额外的模型到我们的新<i id="77ade041">demoLang2</i>生成器模型中。<br>接受<i id="b1946157">demoLang1中</i>除模型'main @ generator' <i id="b1946157">以外的所有内容</i> （我们的新生成器将不依赖于<i id="8af61e71">demoLang1</i>生成器）：</p>            <ul class="list _ul"><li class="list__item" id="54b1895e"><p>取消选中<i id="98e7b737">demoLang1</i>生成器模型</p></li><li class="list__item" id="020cb567"><p>按<i id="5ff1bf19">确定</i>               </p></li></ul>            <p id="6ee70e6d">               </p><figure><img alt="gdb1" title="gdb1" src="/help/img/idea/2019.2/gdb1.png" id="dad6e3ef" width="526" height="478"></figure>            <p></p>         </aside>      </li><li class="list__item" id="9cf7ade9"><p>以相同的方式将模板开关'switch_JComponentByElementName'从<i id="4fb9fc42">demoLang1复制</i>到<i id="cae8a471">demoLang2</i>生成器模型</p></li></ul>   <h2 id="conditionalrootrule">条件根规则</h2>   <p id="439879e8">MPS中代码生成的过程可以视为一系列模型到模型的转换。一种语言的AST逐渐转换为另一种语言的概念表示的AST。在每个步骤中，将一种语言的各个概念翻译（还原）为另一种语言的概念。<i id="f6a652d0">条件根规则</i>有些特殊，因为它从零开始创建新节点。它使用此规则中引用的模板在输出模型中生成一个全新的根节点，而输入模型中没有任何原始节点。</p>   <ul class="list _ul"><li class="list__item" id="5bb4f3da"><p>转到demoLang2生成器并在编辑器中打开映射配置“ main”</p></li><li class="list__item" id="50c33544"><p>添加新的<i id="d4c62e55">条件根规则</i> （当光标位于<b id="65ac1f1e">条件根规则</b>部分中时，按<i id="6712a965">Insert</i>或<i id="1260ed85">Enter</i> ）</p></li><li class="list__item" id="f1b195a8"><p>引用“ map_Document”模板，以便此模板用于生成结果类</p></li></ul>   <p id="8a9347a6">      </p><figure><img alt="gdb2" title="gdb2" src="/help/img/idea/2019.2/gdb2.png" id="d3084ab5" width="887" height="535"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="20b6df3a"><p>打开“ map_Document”模板（按<i id="6d4d21b5">Control + <left-click></left-click></i>或<i id="879b006d">Cmd + <left-click></left-click></i>在编辑器中的引用上），因此我们可以对其进行一些调整以使其在更改的上下文中起作用</p></li></ul>   <p id="f29cc87d">      </p><figure><img alt="gdb3" title="gdb3" src="/help/img/idea/2019.2/gdb3.png" id="78cd16a4" width="812" height="604"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="bb67df6c"><p>在模板标题中删除提及<i id="31957235">文档的内容</i> -在光标位于“文档”一词上时按<i id="ac8cf772">Del</i>键（我们在“条件根规则”中使用了此模板，该条件不再将<i id="2f58a201">文档</i>作为模板的输入传递）</p></li><li class="list__item" id="30c61860"><p>从类名中删除属性宏，因为现在我们只有一个类，我们可以对其名称进行硬编码</p></li><li class="list__item" id="445ca195"><p>将生成的类重命名为“ <b id="84fcd46a">DemoApp</b> ”</p></li><li class="list__item" id="22351ca9"><p>打开<i id="72c6c307">SWITCH</i>宏的<i id="2e769c04">检查器</i> ，然后通过按<i id="75a07204">Control + Space</i>来解析对<i id="8daaca1e">template_switch</i>的引用      </p></li></ul>   <h2 id="loop-macro">宏循环</h2>   <p id="f0756b94">“ DemoApp”模板中的SWITCH-macro期望输入中包含XML <i id="ded54475">文档</i> ，因为这是我们在演示1中实现的方式。然后，提取<i id="65abb87c">文档的</i>根元素，并对其应用模板开关。但是，输入模型中可能有多个<i id="76265092">文档</i> （实际上，在我们的演示应用程序中将有两个<i id="76265092">文档</i> -一个按钮和一个标签），因此我们需要按顺序逐步处理它们并生成适当的“ <i id="ee85608b">container.add（null） ;</i> “每个<i id="4dc5dff9">文件的</i>声明。<br>为了为SWITCH-macro提供单个<i id="755bfec8">Document</i>节点，我们将包装' <i id="a1f017f1">container.add（..）;</i> '在LOOP宏内的语句：</p>   <ul class="list _ul"><li class="list__item" id="d404bb54">在模板代码中，选择语句<i id="e67caf73">'container.add（$ SWITCH $ [null]）;</i> '（将光标置于语句内，使用<i id="82c21cfd">Ctrl / Cmd + W</i>扩展块选择）</li><li class="list__item" id="b7398b15"><p>按<i id="16410090">Ctrl-Shift + M</i>添加节点宏</p></li><li class="list__item" id="656c39d5"><p>从自动完成菜单中选择<i id="14eebdcc">$ LOOP $</i> （ <i id="1fcb15c8">Ctrl + Space</i> ）</p></li><li class="list__item" id="b6d05003"><p>在LOOP的<b id="34496ddf">映射节点</b>函数中输入代码，如下所示</p></li></ul>   <p id="8e2f64f1">      </p><figure><img alt="gdb4" title="gdb4" src="/help/img/idea/2019.2/gdb4.png" id="822c2c86" width="749" height="520"></figure>   <p></p>   <p id="7edb1123"><b id="06b029a8">映射的节点</b>函数将在输入模型中找到所有<i id="582cd832">Document</i> ，并将这些<i id="a8b94469">Document</i>的<i id="0afa9d4e">序列</i>返回给生成器（ <b id="4dcaf8d5">return</b>语句在<i id="e0b59238">BaseLanguage中</i>可以省略）。<br>然后，生成器将遍历此序列，创建“ container.add（..）;”语句对于每个<i id="a78bb434">文档</i>和逐渐通过每个<i id="637508e6">文献</i>作为输入节点至开关的宏。</p>   <p id="44df004e">而已。与往常一样，最后一步是按<i id="408c5e0a">Shift-F9键</i>来<b id="4162d1ed">生成generator</b> 。</p>         <a name="first_test"></a>      <h2 id="runningfirsttest">运行首次测试</h2>   <p id="b795eb63">为了测试demoLang2生成器，我们需要与演示1完全相同的输入，除了我们要在生成时“使用”不同的语言。</p>   <ul class="list _ul"><li class="list__item" id="4789e22d"><p>转到“ test_models”解决方案中的“ test1”模型（在项目树中选择它）</p></li><li class="list__item" id="b31910f2"><p>在弹出菜单中选择“ <i id="d1cdb094">克隆模型</i> ”</p></li><li class="list__item" id="eec19115"><p>输入新的模型名称：“ generator_demo.test2”</p></li><li class="list__item" id="d1934af2">在“ test2”模型的属性对话框中的“ <b id="13313cd8">参与生成</b>的<b id="13313cd8">语言”</b>部分中：<ul class="list _ul"><li class="list__item" id="e3b407db"><p>删除'generator_demo。L1'语言</p></li><li class="list__item" id="9e124ba4"><p>添加'generator_demo。L2'语言</p></li></ul>	     </li></ul>   <p id="21334420">生成“ test2”模型并预览生成的源。</p>   <h2 id="abandonrootrule">放弃根治</h2>   <p id="ed67ee49">请注意，生成的输出还包含两个“生成的” XML文件：Button.xml和Label.xml。MPS在先前的演示1中没有生成那些XML文件。为什么在此演示中这样做？</p>   <p id="9997e90b">因为在演示1中，我们已使用根映射规则定义了输入<i id="5f47e2a5">文档</i>到输出<i id="0d5c84f2">类的</i>显式映射，所以消耗了输入，并且未生成xml文件。<br>在演示2中，我们<b id="77af7707">没有将</b>输入<i id="d1badec8">文档</i> <b id="77af7707">显式映射</b>到任何输出根，因此它们保留在模型中，直到文本生成阶段为止，该阶段将它们转换为xml文件。</p>      <p id="5b823882">为了防止将<i id="df9c9d1e">文档</i>复制到输出模型，我们将使用“ <b id="f87e6198">放弃根规则”</b> 。</p>   <ul class="list _ul"><li class="list__item" id="52f91373"><p>返回demoLang2生成器并在编辑器中打开映射配置“ main”</p></li><li class="list__item" id="ab3d809d"><p>添加新的“放弃根目录”规则-在光标位于“ <b id="78b1cb87">放弃根目录”</b>部分中时按“ <i id="acb2a91d">插入”</i></p></li><li class="list__item" id="a5efc9fd"><p>选择“ <i id="c22c6354">文档</i> ”作为规则应用的概念</p></li></ul>   <p id="fb3914ff">      </p><figure><img alt="gdb5" title="gdb5" src="/help/img/idea/2019.2/gdb5.png" id="380fa665" width="740" height="351"></figure>   <p></p>   <p id="4e72a66b">重建项目后，您将不再在输出中获取xml文件。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-user-guide-demo1.html">发电机用户指南Demo1</a> <a class="navigation-links__next" href="generator-user-guide-demo3.html">发电机用户指南Demo3</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>