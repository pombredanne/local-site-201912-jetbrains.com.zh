<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>构建口译食谱-帮助|帮助MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Building+an+interpreter+cookbook.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="building-an-interpreter-cookbook.xml" data-toc="Building+an+interpreter+cookbook.html">编写口译食谱</h1>   <p id="9ca99d1b">检出<i id="b5384b97">Shapes</i>示例项目，该示例项目自3.1版起与MPS捆绑在一起。它可以在编辑器中做一些花哨的技巧。</p>   <aside class="tip sideblock" rel="9ca99d1b" id="4c54188d" data-title="">      <p id="94e78ced">MPS首次运行时将自动安装示例项目，它们应位于<i id="91e2a3a6">$ USER_HOME</i> <i id="67ee8bfa">/ MPSSamples中</i> 。</p>   </aside>   <p id="47274b50">默认情况下，编辑器显示普通代码，该代码由一些命令组成，这些命令可在画布上绘制给定大小和颜色的视觉形状。</p>   <p id="e29f0444">      </p><figure><img alt="I1" title="I1" src="/help/img/idea/2019.2/I1.png" id="f129c714" width="411" height="117"></figure>   <p></p>   <p id="c7b88744">该代码可以生成到Java中并运行。这将启动一个新的Java进程，该进程运行刚刚从上面的代码生成的应用程序：</p>   <p id="c91f54f1">      </p><figure><img alt="I4" title="I4" src="/help/img/idea/2019.2/I4.png" id="b2bccbc4" width="477" height="548"></figure>   <p></p>   <p id="12cd66cb">      </p><figure><img alt="I5" title="I5" src="/help/img/idea/2019.2/I5.png" id="c70a3f49" width="501" height="523"></figure>   <p></p>   <p id="274151a9">但是，MPS也可以解释代码而无需生成Java。只需<i id="c0ec5ade">按Alt +输入</i>代码中的任意位置以调用“ <i id="0c7b06d9">意图”</i>弹出菜单，然后选择“预览场景”。您将获得一个包含场景的新框架，该框架正在解释代码：</p>   <p id="0ee6ea4f">      </p><figure><img alt="I6" title="I6" src="/help/img/idea/2019.2/I6.png" id="d301d5e7" width="420" height="147"></figure>   <p></p>   <p id="122b6e34">      </p><figure><img alt="I7" title="I7" src="/help/img/idea/2019.2/I7.png" id="50676e08" width="605" height="322"></figure>   <p></p>   <h2 id="instantpreview">即时预览</h2>   <p id="bbbfae3b">有了解释代码的能力，编辑器现在可以通过编辑器将解释器的结果提供给开发人员。它既可以解释单个形状，也可以在定义每个形状的代码旁边的编辑器中绘制它们：</p>   <p id="96c3713a">      </p><figure><img alt="I2" title="I2" src="/help/img/idea/2019.2/I2.png" id="1084dba7" width="559" height="443"></figure>   <p></p>   <p id="4e662ecd">或者可以在代码旁边绘制整个场景，并立即对代码进行更改。</p>   <p id="6eb39893">      </p><figure><img alt="I3" title="I3" src="/help/img/idea/2019.2/I3.png" id="f471ee9f" width="951" height="595"></figure>   <p></p>   <p id="a9b14f67">要自己尝试这些功能，请右键单击编辑器，选择“推送编辑器提示”，然后选择将向编辑器指示的提示，您要启用哪些预览功能：</p>   <p id="936651e2">      </p><figure><img alt="I8" title="I8" src="/help/img/idea/2019.2/I8.png" id="e34fec61" width="482" height="492"></figure>   <p></p>   <p id="3f432716">      </p><figure><img alt="I9" title="I9" src="/help/img/idea/2019.2/I9.png" id="aefe011f" width="357" height="386"></figure>      <br>这是一个快速的预告片，现在我们可以看看如何在您的语言中构建如此简单的口译功能。<p></p>   <h2 id="defininganinterpreter">定义口译员</h2>   <p id="9523f07b">MPS主要专注于代码生成。表示为AST的程序被转换为目标语言的代码，然后可以对其进行编译和运行。但是，在某些情况下，直接解释您的代码可能是一个更好的选择。您可以为开发人员提供某种代码预览功能，从而为他们的代码更改提供即时反馈。您可以检测并报告仅在运行时显示的错误，或者您可以通过绕过生成和编译阶段来加快代码运行-修复周期的周转。</p>   <p id="e85b9cab">MPS目前没有任何用于构建口译员的基础结构，但是您语言的“ <i id="0ae881bd">行为”</i>方面使您可以自行构建口译员。理想情况下，就像使用代码生成器一样，您将创建一个包含解释器运行时类的运行时解决方案。语言概念的“ <i id="c9d9b473">行为”</i>方面将与分类为在AST中正确导航并解释模式中的所有节点的运行时配合。</p>   <p id="cf005431">我们将看看<i id="54ef736f">Shapes</i>语言是如何解释其代码的。</p>   <h3 id="awhole-sceneinterpreter">全场景翻译</h3>   <p id="3bfcea79">让我们从用户通过<i id="c50c365e">Intention</i>显式调用解释器的场景开始。首先，需要创建意图：</p>   <p id="438fb83e">      </p><figure><img alt="I10" title="I10" src="/help/img/idea/2019.2/I10.png" id="a80e5da6" width="1012" height="293"></figure>   <p></p>   <p id="e9dc5689">意图调用<i id="77a03e6f">画布</i>节点，其在<i id="c276cd33">画布</i>的<i id="50fb3b49">行为</i>方面所定义的<i id="b17897cc">解释（）</i>方法。</p>   <p id="edb375f8">      </p><figure><img alt="I21" title="I21" src="/help/img/idea/2019.2/I21.png" id="7c895dfa" width="553" height="251"></figure>      <br>该方法将构建一个新的<i id="515514e4">Frame</i> ，该<i id="515514e4">Frame</i>将使用自定义的<i id="9816fb2d">paintComponent（）</i>方法保存面板。该面板正被其他预览功能重用，因此已将其提取到单独的帮助程序类<i id="5005fc95">PreviewFactory中</i> 。对于平凡的情况，应该将类放入运行时解决方案中，但是在这里，我们只是将其直接放入语言的“ <i id="069a292e">行为”</i>方面。<p></p>   <p id="fd039a05">  </p><figure><img alt="I22" title="I22" src="/help/img/idea/2019.2/I22.png" id="82e68322" width="1137" height="369"></figure>      <br>使用以下代码遍历当前模型： <i id="d318e2f3">thisCanvas.shapes.forEach（{〜it => it.drawShape（graphics）}）;</i> 。这就是解释发生的地方。<i id="23043000">drawShape（）</i>方法由每个<i id="adb978ca">Shape子</i>概念实现，以便它们可以在屏幕上呈现。注意，遍历代码被包装在<i id="6736d5af">ReadAction中</i> ，以确保对模型具有读取权限。<p></p>   <p id="177a1924"><i id="22c2706d">drawShape（）</i>方法必须由所有<i id="0434b80f">Shapes</i>实现<i id="0434b80f">：</i>   </p>   <p id="ec66bfa2">      </p><figure><img alt="I12" title="I12" src="/help/img/idea/2019.2/I12.png" id="41d5089b" width="861" height="218"></figure>      <br>       <figure><img alt="I13" title="I13" src="/help/img/idea/2019.2/I13.png" id="b2fd0a63" width="879" height="236"></figure>      <br>       <figure><img alt="I14" title="I14" src="/help/img/idea/2019.2/I14.png" id="742a0a4c" width="991" height="228"></figure>   <p></p>   <p id="18783427">这足以使我们的小口译员动起来。</p>   <h3 id="shapepreview">形状预览</h3>   <p id="73a66892">要在代码中在其定义旁边预览各个形状，我们需要更改编辑器或使用不同的<i id="c0e6c8b8">编辑器提示</i>定义一个新形状，以使其包含包含形状可视化效果的<i id="97e040eb">swing组件</i> 。在该示例中，我们选择利用多个投影（请参见“ <a href="http://www.youtube.com/watch?v=j1iPF2JjzuU" rel="noopener noreferrer" data-external="true" target="_blank">多个投影”视频，</a>以了解多个投影在MPS中的工作方式），因此我们创建了一个新编辑器，并在标头中指定了<i id="3ac5af77">ShapePreview</i>提示。仅当用户启用<i id="58a5f4cc">ShapePreview</i>提示时，才会使用此编辑器，而不使用默认的纯文本提示。</p>   <p id="ebb0b006">      </p><figure><img alt="I16" title="I16" src="/help/img/idea/2019.2/I16.png" id="36a2193e" width="749" height="456"></figure>   <p></p>   <p id="e5ecea93"><i id="f3430f55">swing组件</i>定义了一个<i id="bfdb86ba">JPanel</i> ，它在<i id="4374fa2e">paintComponent（）</i>方法中获得了对模型的读取锁定，然后在特定位置绘制当前<i id="ddae62ec">Shape</i>节点。请注意，新的<i id="e10c6ae3">drawShapeAt（）</i>方法已添加到<i id="6078e5b7">Shapes中，</i>以忽略<i id="03617d23">Shapes</i>在画布中的定义位置来绘制<i id="03617d23">Shapes</i> 。</p>   <p id="18957f5a">      </p><figure><img alt="I17" title="I17" src="/help/img/idea/2019.2/I17.png" id="58804cd1" width="564" height="318"></figure>   <p></p>   <h3 id="scenepreview">场景预览</h3>   <p id="b0f150c7">要预览整个场景，我们需要为<i id="c8e96125">Canvas</i>概念创建一个新的编辑器，并将其挂钩到<i id="1faffcbe">ScenePreview</i>编辑器提示。</p>   <p id="de4c2cc4">      </p><figure><img alt="I23" title="I23" src="/help/img/idea/2019.2/I23.png" id="f0729ba4" width="615" height="353"></figure>   <p></p>   <p id="c503fd14"><i id="ed596304">swing组件</i>单元格包含一个自定义的<i id="aac24067">JPanel</i> ，它由<i id="d31d8994">PreviewFactory</i>类再次创建，就像我们先前在对显式用户请求进行解释时一样。</p>   <p id="496f3622">现在就是这样。我希望你喜欢它。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="cookbook-type-system.html">食谱-类型系统</a> <a class="navigation-links__next" href="custom-language-aspect-cookbook.html">自定义语言方面的食谱</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>