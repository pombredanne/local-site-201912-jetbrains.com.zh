<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>发电机用户指南Demo1-帮助| MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Generator+User+Guide+Demo1.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="generator-user-guide-demo1.xml" data-toc="Generator+User+Guide+Demo1.html">发电机用户指南Demo1</h1>   <h2 id="generatoruserguidedemo1">发电机用户指南演示1</h2>   <p id="bb83f53f">在此演示中，我们将创建一个生成器，该生成器将为每个输入的XML文档生成一个Java应用程序。</p>   <p id="4154a79d">我们将在之前创建的解决方案“ <i id="2509bdd6">test_models</i> ”中重用<i id="d8d4e5bd">“ generator_demo.test1</i> ”模型。该模型使用' <i id="7469fab2">jetbrains.mps.sampleXML</i> '语言，并包含两个XML文档<i id="7469fab2">-'Button</i> '和'Label'。<br>我们将对每个这些文档应用根映射规则，以生成输出Java应用程序。在应用程序的main方法中，生成的代码将实例化一个swing框架并将请求的swing组件添加到其内容窗格中。该组件将是JButton或JLabel，具体取决于输入文档中根元素的名称。</p>   <p id="20923560">因此，我们的“按钮” XML文档将转换为Java应用程序，该应用程序将在框架内显示一个按钮。</p>   <h2 id="newlanguage">新语言</h2>   <p id="08dfa43a">首先要做的是创建一种语言，该语言将使用新的生成器来增强<i id="0a63f563">simpleXML</i> 。现在，我们需要生成Java代码，而不是生成XML。</p>   <ul class="list _ul"><li class="list__item" id="57cf7b03"><p>在项目的弹出菜单中选择“ <i id="62b80ff8">新建”->“语言”</i></p></li><li class="list__item" id="fbd5c56e"><p>输入语言名称：“ generator_demo.demoLang1”</p></li></ul>   <p id="be34b02c">      </p><figure><img alt="gda1" title="gda1" src="/help/img/idea/2019.2/gda1.png" id="31beae22" width="498" height="328"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="1ad75ebf"><p>在<i id="d1f01e83">demoLang1</i>语言属性对话框的<i id="9c0abc06">Dependencies</i>部分中，将'jetbrains.mps.sampleXML'和'jetbrains.mps.baseLanguage'语言作为<b id="d1620649">扩展语言添加</b>到</p></li></ul>   <p id="6cf61d2d">      </p><figure><img alt="gdx" title="gdx" src="/help/img/idea/2019.2/gdx.png" id="54e44add" width="668" height="470"></figure>   <p></p>   <h2 id="newgenerator">新发电机</h2>   <p id="f8c5a22a">MPS已在' <i id="28bf797a">generator_demo.demoLang1</i> '语言内部创建了一个空的生成器模块，以及一个包含空<b id="c5f6597e">映射配置</b>节点'main'的<b id="42e6d9d6">生成器模型</b> 'main @ generator'。如果不是这样，您可以通过上下文菜单轻松地为“ <i id="01780848">generator_demo.demoLang1</i> ”语言创建它们。</p>   <p id="16c39540">      </p><figure><img alt="gda3" title="gda3" src="/help/img/idea/2019.2/gda3.png" id="3d933789" width="361" height="354"></figure>   <p></p>   <p id="6779efc8">映射配置充当生成器的“入口点”，在其中声明所有<b id="5a526623">生成器规则</b>并从中可以引用<b id="02ad4481">模板</b> 。模板包含目标代码段以及声明的占位符，用于从输入模型中填充值。模板是MPS模型到模型转换过程的核心。</p>   <p id="8dfdaf11">通过<b id="e7106bce">模型原型</b> “ generator”（在模型名称中的符号“ @”之后显示），MPS可以从常规模型中识别出发电机模型。生成器模型中的任何节点都将解释为<b id="683cfd9a">模板，</b>除非该节点是<b id="e6d18355">生成器语言</b>本身的一部分。</p>   <p id="19d30bc2">例如，映射配置节点是生成器语言的一部分（“ MappingConfiguration”概念以语言“ jetbrains.mps.lang.generator”声明）。<br>我们将在下一步中创建的<b id="1f3ae5d4">类</b>节点不是生成器语言的一部分，因此将在生成器中用作模板。</p>   <h2 id="rootmappingrule">根映射规则</h2>   <p id="c9ba6f15">让我们创建第一个规则，该规则将为每个输入的XML文档生成一个Java应用程序类。</p>   <ul class="list _ul"><li class="list__item" id="90dbf1b8"><p>在编辑器中打开名为“ main”的映射配置</p></li><li class="list__item" id="6f4c3b9e"><p>在“ <b id="6bf3c9d1">根映射规则”</b>部分中添加新规则（在该部分中按“ <i id="e82aa995">插入”</i>或“ <i id="acdf0937">Enter</i> ”）</p></li><li class="list__item" id="3d45bd9e"><p>选择规则的适用概念：“文档”</p></li></ul>   <p id="3a1b84a2">      </p><figure><img alt="gda4" title="gda4" src="/help/img/idea/2019.2/gda4.png" id="c6597b24" width="926" height="317"></figure>   <p></p>   <p id="581c5687">当我们要为每个输入<i id="6755a014">Document</i>生成一个类时，必须在映射规则中指定的该规则的模板将是<i id="41ec5868">Class-即BaseLanguage中</i>定义的“ <i id="1654df0b">ClassConcept</i> ”概念的<i id="41ec5868">实例</i> 。</p>   <p id="4fdf5fb4">创建该模板的最简单方法是应用意图（请参见编辑器左边缘的？）：</p>   <ul class="list _ul"><li class="list__item" id="392b1943"><p>当光标位于红色字段“ <no template="">”时，</no>按<i id="d4747e18">Alt-Enter</i></p></li><li class="list__item" id="e842de12"><p>选择<i id="6c821f04">新的根模板</i>      </p></li><li class="list__item" id="459284e1"><p>选择<i id="3a4f542d">班级</i> 。</p></li><li class="list__item" id="d5da21ba"><p>在编辑器中打开新创建的类（在引用上使用<i id="39f253cd">Ctrl +左键单击</i>或<i id="4ceb76f4">Ctrl + B</i> ）</p></li></ul>   <p id="e1f14512">      </p><figure><img alt="gda5" title="gda5" src="/help/img/idea/2019.2/gda5.png" id="f14859ae" width="623" height="147"></figure>      <br>       <figure><img alt="gda6" title="gda6" src="/help/img/idea/2019.2/gda6.png" id="61641e6e" width="546" height="116"></figure>      <br>       <figure><img alt="gda7" title="gda7" src="/help/img/idea/2019.2/gda7.png" id="8d30fa4c" width="388" height="169"></figure>   <p></p>   <h2 id="property-macro">财产宏</h2>   <p id="74450088">需要使用输入模型中的值对模板进行参数化，以使其具有良好的效果。MPS为您提供了几种类型的宏，可以将输入模型中的值连接到模板中。我们将首先使用Property-macros来在生成时计算输出模型节点的属性值。</p>   <p id="85cb28ee">让我们从一个非常琐碎的东西开始-我们想要生成一个与输入<i id="912c819c">Document</i>的名称相同的名称的输出类。<br>因此，我们将为输出类的名称创建一个属性宏：</p>   <ul class="list _ul"><li class="list__item" id="5655ff11"><p>将光标放在类名的内部</p></li><li class="list__item" id="b77446a2"><p>按<i id="1d9179f1">Ctrl-Shift + M</i>并在菜单中选择<i id="b42b6004">属性宏</i></p></li><li class="list__item" id="fe490306"><p>或者，您可以通过<i id="2fed6b2f">Alt + Enter</i>命令使用“ <i id="12d70eb2">意图</i> ”</p></li><li class="list__item" id="08270616"><p>在编辑器中选择宏节点（呈现为“ $”符号），并为其打开检查器窗口（ <i id="3f87dfa3">Alt-Shift + I</i> ）</p></li><li class="list__item" id="202c5eb6"><p>输入<b id="5b785a4b">值</b>函数的代码，该函数将在生成类时计算该类的实际名称</p></li><li class="list__item" id="17f18f30"><p>该函数可以通过<i id="a5aaf70d">node</i>参数引用原始<i id="f3b562ab">Document</i>节点</p></li><li class="list__item" id="67826ccd"><p>在我们的情况下，此<b id="8220a361">值</b>函数将返回原始文档的名称</p></li></ul>   <p id="c0dc2177">      </p><figure><img alt="gda8" title="gda8" src="/help/img/idea/2019.2/gda8.png" id="c5ce53e9" width="893" height="453"></figure>   <p></p>   <aside class="tip sideblock" rel="c0dc2177" id="0ab2d260" data-title="">      <p id="5be9b03b">在这种情况下， <i id="5c56ccce">节点的</i>类型为'node <document>'（要找出节点<document>的类型，请在代码中选择它，然后按<i id="6b47e25a">Ctrl-Shift + T</i> ）。MPS知道输入节点的类型，因为此模板的头显式指定了Document作为模板输入。</document></document></p>   </aside>   <h2 id="themain()method">main（）方法</h2>   <p id="d9b7c399">由于我们计划在生成的代码中使用Java Swing组件，因此我们需要将“ java.awt”和“ javax.swing”包的MPS <b id="e9064040">java_stub</b>模型导入生成器模型。</p>      <ul class="list _ul"><li class="list__item" id="7b027253"><p>按<i id="e17cb9c6">Ctrl-M</i> （导入模型）</p></li><li class="list__item" id="9061632e"><p>选择'java.awt@java_stub'模型</p></li><li class="list__item" id="5148ca0c"><p>再次按<i id="32a83de6">Ctrl-M</i></p></li><li class="list__item" id="cda60303"><p>选择'javax.swing@java_stub'模型</p></li></ul>   <p id="b663d88d">      </p><figure><img alt="gda9" title="gda9" src="/help/img/idea/2019.2/gda9.png" id="048ba71a" width="718" height="399"></figure>      <br>有了导入，我们现在可以创建<i id="12e63a2b">main（）</i>方法。键入“ psvm”将触发自动操作，该操作会为您插入一个空的<i id="d9988335">main</i>方法。另外，您也可以自己输入方法签名。<p></p>   <p id="e3ea873a">      </p><figure><img alt="gda10" title="gda10" src="/help/img/idea/2019.2/gda10.png" id="485bb09b" width="738" height="367"></figure>   <p></p>   <p id="6eb8b28e">如果您偶然尝试输入'String []'-不要惊慌，您并不孤单。<a href="mps-faq.html">帮助在这里</a>   </p>   <h2 id="switch-macro">开关宏</h2>   <p id="9310bea0">您可能想知道为什么我们将<b id="b2040bca">null</b>传递给<i id="63be025d">container.add（）</i>方法，而根据输入XML <i id="b174dcf1">Document中</i>的实际值，我们需要传递新的<b id="1f45c073">Button</b>或<b id="ed5e276e">Label</b> 。这是我们在此模板中要做的最后一件事-用创建摆动组件的表达式替换“ container.add（ <b id="aa719542">null</b> ）”表达式中的“ null”参数。<br>如果输入文档中的根元素名为“ button”，则将生成“ new JButton（）”表达式；如果根元素名为“ label”，则将生成“ new JLabel（）”表达式。</p>   <p id="f90202fc">要执行此替换，我们将把'null'参数包装到<b id="38de62d5">SWITCH-macro中</b> 。<br>SWITCH宏将“包装的”模板节点替换为新节点。根据在关联的<b id="771f7685">模板开关中</b>满足哪种情况条件来创建替换节点。</p>   <p id="75e11fa3">首先，让我们创建一个名为'switch_JComponentByElementName'的新<b id="a0327f6d">模板开关</b> 。</p>   <p id="8cd38642">      </p><figure><img alt="gda11" title="gda11" src="/help/img/idea/2019.2/gda11.png" id="b3505d2d" width="961" height="253"></figure>      <br>要开始输入<b id="64720101">条件</b>代码，请按<i id="8f859b59">插入</i>      <br><t...t>下一个屏幕截图上的' <t...t>'内容称为<b id="debf584e">嵌入式模板</b> 。另请参见屏幕截图下方的注释。<p></p>   <p id="6ec55a7b">      </p><figure><img alt="gda12" title="gda12" src="/help/img/idea/2019.2/gda12.png" id="a5c1b07c" width="1084" height="465"></figure>      <br>而已。我们正在测试元素的名称。如果是“按钮”，我们将生成“新的JButton（）”。同样，如果它是'label'，我们将生成'new JLabel（）'。如果它既不是“按钮”也不是“标签”，则将引发错误。<p></p>   <aside class="note " rel="6ec55a7b" id="4fa75a75" data-title="">      <p id="f34a8d29">创建在线模板，例如<i id="6b830248"><t new="" jbutton()="" t=""></t></i>这不是一件容易的事。<br>如果您偶然发现该问题，请考虑以下图表。<br>          </p><figure><img alt="开关中的gd1内联宏" title="开关中的gd1内联宏" src="/help/img/idea/2019.2/gd1-inline-macro-in-switch.PNG" id="18fb32a7" width="796" height="694"></figure>      <p></p>   </aside>   <p id="7d5b913d">现在，我们准备将SWITCH-macro附加到'container.add（ <b id="196902bb">null</b> ）'表达式中的'null'参数节点。</p>   <ul class="list _ul"><li class="list__item" id="6226d5dc"><p>返回“文档”模板中的“ main（）”方法</p></li><li class="list__item" id="b444ddca"><p>在“ container.add（ <b id="3b456303">null</b> ）”表达式中选择“ null”节点</p></li><li class="list__item" id="90ef2491"><p>按<i id="ccd4d6fa">Ctrl-Shift-M</i>添加一个抽象节点宏</p></li><li class="list__item" id="f268ae4f"><p>按<i id="e7ea1671">Ctrl + Space</i>调用完成菜单，然后选择<i id="cef015dc">$ SWITCH $</i>      </p></li><li class="list__item" id="d8a417ff"><p>转到$ SWITCH $宏的检查器</p></li><li class="list__item" id="65e7d7f6"><p>在<b id="86a3af68">映射的节点</b>功能中输入代码（请参见下文）（按<i id="99f33d1f">Insert</i>键开始输入），以设置要在其上做出有关开关决定的节点</p></li><li class="list__item" id="b038aa8c"><p>引用我们之前创建的“ switch_JComponentByElementName”模板切换节点，以将切换过程引用到</p></li></ul>   <p id="9920c0a6">      </p><figure><img alt="gda13" title="gda13" src="/help/img/idea/2019.2/gda13.png" id="1b508626" width="933" height="540"></figure>      <br><b id="2e6e3e7b">映射节点</b>功能做什么，为什么我们需要它？<p></p>   <p id="89f1e7e1">到目前为止，我们在<i id="93d3e301">map_Document</i>模板内的输入节点是<i id="9b0b4081">Document</i> 。但是模板开关' <i id="eeada236">switch_JComponentByElementName</i> '期望<i id="4a8dec3f">元素</i>作为输入，而不是<i id="ae6b93c0">Document</i> 。因此，我们必须用新的输入节点（ <i id="118f8fe9">元素）</i>替换输入节点（ <i id="a6632c48">文档）</i> 。表达式' <i id="d1438400">node.rootElement</i> '返回当前输入文档的根元素。根元素将成为适用于<i id="aaa17d4f">模板开关</i>的新输入节点。</p>   <aside class="tip sideblock" rel="89f1e7e1" id="d8adc4ec" data-title="">      <p id="c7332644">“ rootElement”是孩子的角色。您可以通过在“ rootElement”上按<i id="d7a0fc6f">Ctrl +左键单击</i>或<i id="9556fb0f">Ctrl + B</i>导航到子链接声明。</p>   </aside>   <h2 id="gettingreadyforthefirsttest">为第一次测试做好准备</h2>   <p id="e9315502">重要的是要记住，您对生成器模型所做的任何更改仅在生成生成器后才对其他模块可见。进行更改后，您最后的操作应该始终是相同的： <b id="f6d353d6">生成generator</b> 。<br>生成器中只有一个模型，因此在完成模板编辑后，请按<i id="a57cdc3f">Shift + Control + F9</i>或Shift + <i id="ec27383f">Cmd + F9</i> （制作模型）。</p>   <h2 id="generatingtestmodel">生成测试模型</h2>   <p id="f0795184">让我们回到“ test_models”解决方案中的“ test1”模型。该解决方案包含多个XML文档，我们刚刚在demoLang1中定义了XML节点的语义。不幸的是，MPS无法在不先告知的情况下将这两部分结合起来。MPS不了解模型“ test1”现在是用两种语言编写的：sampleXML和demoLang1，因为我们没有在“ test1”中的任何地方显式使用demoLang1。</p>   <p id="b07d021b">由于demoLang1本身没有定义任何概念，因此我们不能真正使用demoLang1模型'test1'，因此我们将明确告诉MPS在模型'test1'的生成过程中包括demoLang1生成器。</p>   <aside class="tip sideblock" rel="b07d021b" id="dfd5b9ce" data-title="">      <p id="ab3d460b">这是MPS通常不需要的额外步骤。像demoLang1这样的纯虚拟语言在语言开发中不是很常见。通常，语言定义了自己的概念集以及这些概念的语义。如果在解决方案模型中使用了这些概念（它们的实例），则MPS会自动启用语言的生成器。我们将在演示6中看到一个示例。</p>   </aside>   <ul class="list _ul"><li class="list__item" id="9ec7da59"><p>模型“ test1”的打开属性</p></li><li class="list__item" id="a4546974"><p>添加语言“ generator_demo”。L1'到“ <b id="e00505c0">生成时使用</b>的<b id="e00505c0">语言”</b>部分</p></li></ul>   <p id="05385b49">      </p><figure><img alt="gda14" title="gda14" src="/help/img/idea/2019.2/gda14.png" id="c2523bd3" width="674" height="507"></figure>      <br>在“ test1”模型的弹出菜单中运行“ <i id="0a0d5cdc">预览生成的文件”</i>命令。MPS将生成两个Java文件，并在编辑器中显示它们：<p></p>   <div class="code-block" data-lang="none">$ PROJECT_HOME \ MPS_generator_demo \ solutions \ test_models \ source_gen \ generator_demo \ test1 \ Button.java $ PROJECT_HOME \ MPS_generator_demo \ solutions \ test_models \ source_gen \ generator_demo \ test1 \ Label.java</div>   <p id="5321b7f6">MPS也可以编译生成的Java源代码转换成Java字节码作为<i id="7b88ecca">补充</i>的一部分或“测试1”模式的<i id="c448df13">重建</i> 。要启用生成的源代码的Java编译，您需要在'test_models'解决方案中添加对<b id="4e8cfc6f">JDK</b>的依赖：</p>   <p id="363a3543">      </p><figure><img alt="gda15" title="gda15" src="/help/img/idea/2019.2/gda15.png" id="2833ffac" width="635" height="461"></figure>   <p></p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-demos.html">发电机演示</a> <a class="navigation-links__next" href="generator-user-guide-demo2.html">发电机用户指南Demo2</a></div></t...t></t...t></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>