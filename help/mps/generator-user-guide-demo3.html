<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Generator User Guide Demo3 - Help | MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Generator+User+Guide+Demo3.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Default</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_jbuilder">JBuilder</option><option data-group="primary" value="primary_mac_os_x">Mac OS X</option><option data-group="primary" value="primary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default">Default</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_jbuilder">JBuilder</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Generator+User+Guide+Demo3.html" id="generator-user-guide-demo3.xml">Generator User Guide Demo3</h1>   <h2 id="generatoruserguidedemo3">Generator User Guide Demo 3</h2>   <p id="66eea4da">In Demo 2 we were generating java statements like:</p>   <div class="code-block" data-lang="none">container.add(new JButton());</div>   <p id="4fa0960f">to create a Swing component and add it to the application's content pane.</p>   <p id="47773613">In Demo 3 we are going to add support for component properties, which will require generation of more complex initialization code - not just a constructor invocation.&nbsp;Moreover, the generated property initialization code is going to be different for different types of components.<br>Therefore we will choose a generation strategy that is capable of handling such requirements.</p>   <h2 id="newlanguage">New Language</h2>   <p id="54124966">Again, we need to setup a new language and copy some of the Demo 2 generator artifacts to it.</p>   <ul class="list _ul"><li class="list__item" id="5fa4fdf2"><p>create a new language: 'generator_demo.demoLang3'</p></li><li class="list__item" id="0fd6841c"><p>in the language properties dialog add an&nbsp;<b id="385a364f">extended dependency</b>&nbsp;on 'jetbrains.mps.sampleXML' as well as on 'jetbrains.mps.baseLanguage'</p></li><li class="list__item" id="88ae874f"><p>create a new generator for this language, if it does not exist (see <a href="generator-user-guide-demo1.html">Generator User Guide Demo1</a> for details)</p></li><li class="list__item" id="1739751c"><p>delete the mapping configuration 'main' from the <i id="ac03f64e">demoLang3</i> generator (as in Demo 2, we will copy all needed parts from the <i id="13851740">demoLang2</i> generator to the&nbsp;<i id="71dfa2cc">demoLang3</i> generator)</p></li><li class="list__item" id="74cce474">copy-paste the mapping configuration 'main' from the&nbsp;<i id="4e212dd8">demoLang2</i> generator to the <i id="b1a20f60">demoLang3</i> generator<aside class="note " data-title="" rel="b1a20f60" id="6c256af5">            <p id="cd72bf97">See <a href="generator-user-guide-demo2.html#new_language">Generator User Guide Demo2</a> for details.</p>         </aside>      </li><li class="list__item" id="d4f2d976"><p>copy-paste the 'DemoApp' template&nbsp;from the&nbsp;<i id="90365726">demoLang2</i> generator to the <i id="5e8302b9">demoLang3</i> generator</p></li></ul>   <h2 id="addcontent(container)">addContent(container)</h2>   <p id="d199a917">The generator will resemble in many aspects the one we created in Demo 2. So we'll be using the&nbsp;<i id="bfb560b7">conditional root rule</i>&nbsp;to insert the&nbsp;<i id="dfab4338">DemoApp</i>&nbsp;class into the output model. Initially, we need to make some tweaks to the <i id="57197169">DemoApp</i>&nbsp;class.</p>   <ul class="list _ul"><li class="list__item" id="6765ac89"><p>open the 'DemoApp' template</p></li><li class="list__item" id="04dea00f"><p>add a static void method 'addContent(Container)'</p></li><li class="list__item" id="bbe07bc6"><p>in the 'main()' method find the statement:<div class="code-block" data-lang="none">$LOOP$[container.add($SWITCH$[null]);</div>      </p></li><li class="list__item" id="1215a9e2"><p>replace the statement above with the statement below:<div class="code-block" data-lang="none">addContent(container);</div>      </p></li></ul>   <p id="29b094b8">      <figure><img alt="gdc1" title="gdc1" src="/help/img/idea/2019.2/gdc1.png" id="0eb319a7" width="842" height="387"></figure>   </p>   <p id="02b99d7c">Now, the <i id="ad843174">addContent()</i>&nbsp;method is supposed to add all components to the <i id="3fdc803d">JFrame</i>. So it will call <i id="ac447946">container.add()</i>&nbsp;and pass in initialized visual components in turn - one for each input XML <i id="2a42037d">Document</i>. So we'll add a dummy method that we can use in the code and have the generator replace it with real component initialization code.</p>   <p id="347d9bdf">       <figure><img alt="gdc3" title="gdc3" src="/help/img/idea/2019.2/gdc3.png" id="844c6b7f" width="582" height="331"></figure>   </p>   <h2 id="generatingcomponents">Generating components</h2>   <p id="bfbd7bc1">In order to have a component initialization method generated for each input <i id="8eca9778">Element</i>, we will wrap the <i id="afbcd7d7">component()</i>&nbsp;method declaration with a <i id="f9084d8e">LOOP</i>&nbsp;macro. The <i id="593f121a">LOOP</i>&nbsp;macro will iterate over all <i id="650ef362">Elements</i>&nbsp;in the input model and generate a method for each of them.</p>   <p id="2cfd184a">      <figure><img alt="gdc4" title="gdc4" src="/help/img/idea/2019.2/gdc4.png" id="39e17684" width="735" height="303"></figure>   </p>   <p id="8bac85ff">Similarly, we need to call these generated methods for each input <i id="0ea85983">Element</i>&nbsp;and add the returned components into the container, so we need to use another <i id="750dcbe2">LOOP</i>&nbsp;macro around the call to the <i id="910a71df">container.add(component());</i>&nbsp;method inside the <i id="38658a8b">addContent()</i>&nbsp;method.</p>   <p id="11475864">      <figure><img alt="gdc5" title="gdc5" src="/help/img/idea/2019.2/gdc5.png" id="c2418331" width="733" height="307"></figure>   </p>   <p id="7bb8a88a">Last but not the least, we have to replace the call to the dummy&nbsp;<i id="d6b93b8b">component()</i>&nbsp;method with a call to the real generated method <b id="0a84d28f">corresponding to the same</b> input <i id="4446cb8a">Element</i>. So select <i id="853fa994">component</i>&nbsp;(without the ending parentheses) and hit <i id="4f62be24">Control + Shift + M</i>&nbsp;to insert a <i id="1095a0c0">reference macro</i>.</p>   <p id="e520b0f1">      <figure><img alt="gdc6" title="gdc6" src="/help/img/idea/2019.2/gdc6.png" id="6713d30d" width="841" height="310"></figure>   </p>   <p id="e97214f9">This is where we can't move forward just yet. We have no clue how to resolve the method declaration corresponding to the current node so that we could refer to it from the reference macro. We will employ <i id="b58b388c">mapping labels</i>&nbsp;at this stage. They will serve as registries for method declarations, accessible by the <i id="d49d1c77">Element</i>&nbsp;that they were created for. So our <i id="b6beb201">reference macro</i>&nbsp;will be able to retrieve the corresponding method declaration from there.</p>   <p id="8a877e6b">To define a mapping label, go back to the 'main' mapping configuration:</p>   <p id="6cc9dc6b">      <figure><img alt="gdc7" title="gdc7" src="/help/img/idea/2019.2/gdc7.png" id="247dc1a6" width="564" height="282"></figure>   </p>   <aside class="tip sideblock" data-title="" rel="6cc9dc6b" id="579392db">      <p id="830198dd">Mapping label's&nbsp;<b id="75086c71">input concept</b>&nbsp;and&nbsp;<b id="95bcbb24">output concept</b>&nbsp;are optional parameters which are used to provide static type checking in expressions which are making use of mapping label to find output node.<br>In our case we are going to attach the mapping label to rules, which generate <i id="7aecf8f6">StaticMethodDeclaration</i>.&nbsp;That's why we have chosen <i id="b3dc4c49">StaticMethodDeclaration</i> as the label's output concept.<br>The expression (we will use it soon):</p>      <div class="code-block" data-lang="none">genContext.get output "method"</div>      <p id="6731e002">will then have type: 'node&lt;StaticMethodDeclarationt&gt;'.<br>The fact that the 'get output' expression has type, provides no benefits for us in this particular case, but in general it is a very helpful feature.</p>   </aside>   <p id="dcda3b5e">Now, back to <i id="989b0980">DempApp</i>, we can finish the reference macro:</p>   <p id="eefedea8">      <figure><img alt="gdc9" title="gdc9" src="/help/img/idea/2019.2/gdc9.png" id="d0660edc" width="867" height="370"></figure>   </p>   <p id="bc5a4058">      <figure><img alt="gdc10" title="gdc10" src="/help/img/idea/2019.2/gdc10.png" id="a6bec507" width="780" height="161"></figure>   </p>   <p id="e59d3895">Obviously now we need to complete the generation of method declarations and properly store them in the <i id="f66ccf60">method</i>&nbsp;mapping label.</p>   <h2 id="insertingcomponents">Inserting components</h2>   <p id="8b2f0133">Just like in Demo 2, we'll use a <i id="2b66c98a">SWITCH</i>&nbsp;macro to accommodate for different types of <i id="1e3c296b">Elements</i>&nbsp;when generating the methods for them. So right-click on the generator model and choose <i id="6097b755">New -&gt; template switch</i>. Depending on the <i id="5591c9cc">name</i>&nbsp;of the <i id="943d86ba">Element</i>, we either generate code for a button or for a label.</p>   <p id="acd7f628">      <figure><img alt="gdc11" title="gdc11" src="/help/img/idea/2019.2/gdc11.png" id="59a94438" width="1150" height="405"></figure>   </p>   <p id="84dd1545">This time, since the generated code is more complex, in-line templates would not be enough to capture the logic, so we need standalone templates for both generating a button and a label - named <i id="b131ddb9">insert_Button</i>&nbsp;and <i id="99178e13">insert_Label</i>&nbsp;respectively. Create them by right-clicking on the generator model and choosing <i id="3a101e3c">New -&gt;&nbsp;template declaration</i>.</p>   <p id="40067c30">Templates are snippets of the code to generate, parametrized with values calculated from the input model. In our case, we need to generate a new static method that will be added to the <i id="880e23d0">DemoApp</i>&nbsp;class and will have a signature compatible with the <i id="6afdc6ce">component()</i>&nbsp;method declared in the <i id="386863a7">DemoApp</i>&nbsp;class template. So what we'll do now for a button is to create a dummy class with a static method in it. This static method will be made a <i id="41313ee5">template&nbsp;fragment</i>, so that only the method and not the whole class will be inserted into the target model.</p>   <p id="c05d3825">First, choose <i id="ba3c34ef">ClassConcept</i>&nbsp;as the content node:</p>   <p id="74a4e6b5">       <figure><img alt="gdc12" title="gdc12" src="/help/img/idea/2019.2/gdc12.png" id="9c69e050" width="549" height="249"></figure>      <br>Enter the code below declaring the static method with the signature that we want.<br>      <figure><img alt="gdc13" title="gdc13" src="/help/img/idea/2019.2/gdc13.png" id="cc9a56ac" width="477" height="239"></figure>      <br>Now select the whole method declaration, hit <i id="ce4cb76b">Alt + Enter</i>&nbsp;and pick <i id="0ecdd5df">Create Template Fragment</i>&nbsp;from the menu. This will indicate that it is only our method declaration that should be used as a template. The surrounding class serves merely as context for the method.<br>      <figure><img alt="gdc14" title="gdc14" src="/help/img/idea/2019.2/gdc14.png" id="19d667f3" width="566" height="452"></figure>      <br>This is the time when we register all methods generated with this template into the <i id="5d5a7f98">method</i>&nbsp;mapping label, so that we can retrieve these later when generating calls to these methods. Simply enter the desired <i id="742087bf">mapping label</i>&nbsp;in the <i id="ae9936a7">Inspector</i>&nbsp;window for the <i id="e1e8b84d">template fragment</i>&nbsp;(the &lt;TF visual element).<br>      <figure><img alt="gdc15" title="gdc15" src="/help/img/idea/2019.2/gdc15.png" id="596259a7" width="631" height="358"></figure>      <br>At the moment we are generating methods for all input <i id="0d83fc9b">Elements</i>&nbsp;with identical name - <i id="45987ca5">createComponent</i>, which would cause Java compile-time troubles, if we have more than one <i id="2eabc35a">Element</i>&nbsp;in the input model. We need to give each generated method a unique name and we'll do it through a <i id="961316c1">property macro</i>.</p>   <p id="a830d535">      <figure><img alt="gdc16" title="gdc16" src="/help/img/idea/2019.2/gdc16.png" id="98f594a1" width="785" height="283"></figure>   </p>   <p id="0a157c27">We're using the <i id="2adca677">genContext</i>&nbsp;capabilities to generate unique identifiers. The&nbsp;<b id="a05653e7">         <i id="d6196181">templateValue</i>      </b>&nbsp;parameter is going to be "createComponent" (i.e. the method's name as written in template).</p>   <p id="07f596c8">Now, please, create <i id="2ba8fe8d">template declaration</i>&nbsp;for creating a <i id="4d01b0f2">JLabel</i>.</p>   <p id="940a2226">Once done, we should be able to complete the <i id="7230f8ea">SWITCH template</i>&nbsp;declaration.<br>      <figure><img alt="gdc18" title="gdc18" src="/help/img/idea/2019.2/gdc18.png" id="03a99084" width="861" height="403"></figure>   </p>   <p id="701dcf8d">After fixing the <i id="6cd3f9bd">SWITCH macro</i>&nbsp;in the <i id="199144b5">DempApp</i>&nbsp;class template and making the language, we should be able to give our new generator a first try.<br>      <figure><img alt="gdc19" title="gdc19" src="/help/img/idea/2019.2/gdc19.png" id="c1bcdf73" width="607" height="516"></figure>   </p>   <h2 id="newtestmodel">New Test Model</h2>   <p id="5dc34c6f">Let's create a new input test model:</p>   <ul class="list _ul"><li class="list__item" id="7e138015"><p>go to the 'test_models' solution</p></li><li class="list__item" id="9ecc9f74"><p>clone the model 'test2' to model 'test3'</p></li><li class="list__item" id="6bf1d1b9"><p>in the model properties dialog replace 'engaged on generation' language demoLang2 -&gt; demoLang3 (see <a href="generator-user-guide-demo2.html#first_test">Generator User Guide Demo2</a> for details)</p></li><li class="list__item" id="ad7b6ea8"><p>open the 'Button' document (from model 'test3') in the editor</p></li><li class="list__item" id="f81c59f9"><p>add an attribute 'text="Hello"' to the 'button' element</p></li><li class="list__item" id="3aadf3af"><p>add an attribute 'enabled="false"' to the 'button' element</p></li></ul>   <p id="fec5bb9c">      <figure><img alt="gdcb" title="gdcb" src="/help/img/idea/2019.2/gdcb.png" id="68cc411f" width="487" height="95"></figure>   </p>   <ul class="list _ul"><li class="list__item" id="8141ee03"><p>add an attribute 'text="world!"' to the 'label' element in the 'Label' document</p></li><li class="list__item" id="cf2c3acd"><p>add an attribute 'background="orange"' to the 'label' element in the 'Label' document</p></li></ul>   <p id="7ddbe83c">      <figure><img alt="gdcl" title="gdcl" src="/help/img/idea/2019.2/gdcl.png" id="1eedb031" width="525" height="98"></figure>      <br>When you hit <i id="eaafe457">Preview generated code</i>, you should get a valid Java application.</p>   <p id="80a60613">d <figure><img alt="gdc20" title="gdc20" src="/help/img/idea/2019.2/gdc20.png" id="2e165720" width="409" height="610"></figure>      <br>Notice the uniqueness of the <i id="c40b6fd5">createComponent()</i>&nbsp;methods.</p>   <p id="e7cf29cb">Now, let's define the semantics for the extra XML attributes.</p>   <h2 id="addingan$if$macro">Adding an $IF$ macro</h2>   <p id="34ca70fc">Let's focus on the <i id="1d17daeb">insert_Button</i>&nbsp;and <i id="830771dc">insert_Label</i>&nbsp;templates. These define the code that will initialize the Swing components based on the values specified in the input XML <i id="9c2bb330">Element</i>. So far we ignore all the attributes in the input model, but this will change now. Focusing on <i id="95a6917f">insert_Label</i>&nbsp;for now, if the input <i id="fc4b58d5">Element</i> has an attribute called&nbsp;'text', we will generate a statement:</p>   <div class="code-block" data-lang="none">component.setText( _text_ )</div>   <p id="43bf226f">where&nbsp;<i id="9014dd41">text</i>&nbsp;is the string specified in the 'text' attribute of the input <i id="dc4c04f1">Element</i>.</p>   <ul class="list _ul"><li class="list__item" id="009ff610"><p>at the top specify <i id="4764f4d5">Element</i>&nbsp;as the <b id="6901754c">input</b>&nbsp;of the template so that MPS can type-check code involving the template's current <i id="9400d25a">node</i>      </p></li><li class="list__item" id="2fc68615"><p>enter the following code in the body of the 'createComponent()' method</p></li><li class="list__item" id="ab7d15bb"><p>create IF-macro around the 'component.setText("text");' statement (select whole&nbsp; &nbsp;statement, press&nbsp;<i id="9194b9be">Ctrl-Shift+M</i>)</p></li><li class="list__item" id="7df050b6"><p>enter the code into the&nbsp;<b id="ad02fabf">condition</b>&nbsp;function of IF-macro, which will check the presence of the 'text' attribute</p></li></ul>   <p id="e859c907">      <figure><img alt="gdc21" title="gdc21" src="/help/img/idea/2019.2/gdc21.png" id="cee49376" width="925" height="461"></figure>      <br>      <a name="property_macro_in_if_macro"></a>      <br>   </p>   <ul class="list _ul"><li class="list__item" id="1794f6f7"><p>create property-macro inside the string literal "text", because we need to parametrize the value with the actual attribute value from the input model</p></li><li class="list__item" id="d4c5558f"><p>in the&nbsp;<b id="02fb51bb">value</b>&nbsp;function of the property-macro enter code that returns the value of the 'text' attribute of the input <i id="fc5a6e89">Element</i>      </p></li></ul>   <p id="82fef9f9">      <figure><img alt="gdc22" title="gdc22" src="/help/img/idea/2019.2/gdc22.png" id="4800c4ca" width="771" height="269"></figure>   </p>   <p id="6e276677">The same steps should now be repeated to the&nbsp;<i id="4c2eac38">insert_Button</i>&nbsp;template.</p>   <h2 id="reusabletemplate">Reusable template</h2>   <p id="7fcf943a">We can go on adding in the same manner support for more and more component properties, but this way we are going to end up with a lot of duplicated code in our templates.</p>   <p id="6ca55f79">A better idea is to create one template containing some common code and re-use it in template of each component.&nbsp;For example, let's add support for the property 'enabled'. We'll&nbsp;create a "shared" template and re-use it in other templates using the&nbsp;<b id="2e904e79">CALL macro</b>:</p>   <ul class="list _ul"><li class="list__item" id="0cba705b"><p>go to the 'main@generator' model in demoLang3 generator (select in project tree)</p></li><li class="list__item" id="1e5d8585"><p>create new&nbsp;<b id="dcb295bf">template declaration</b>&nbsp;node using&nbsp;<i id="1599c8a3">Create Root Node</i>&nbsp;in model popup menu</p></li><li class="list__item" id="3665bb5c"><p>name it 'include_ComponentProperties'</p></li><li class="list__item" id="c4871e21"><p>choose&nbsp;<b id="dfa3ac62">input</b>&nbsp;-&nbsp;<i id="062244d6">Element</i>      </p></li><li class="list__item" id="a6d2f3bc"><p>choose StatementList as the template's&nbsp;<b id="05cba98d">content node</b>:</p></li><li class="list__item" id="3607404b">         <figure><img alt="gdc23" title="gdc23" src="/help/img/idea/2019.2/gdc23.png" id="84000f6e" width="694" height="255"></figure>      </li><li class="list__item" id="a48fad88">in the statement list create a variable declaration:<div class="code-block" data-lang="none">JComponent component = null;</div>         <br>         <aside class="note " data-title="" rel="a48fad88" id="3af570ad">            <p id="8550d86a">The name of variable is important - generator will resolve references by this name.</p>         </aside>         <br>      </li><li class="list__item" id="a6549e2f"><p>add a block-statement (press&nbsp;<i id="ee944078">&lt;Enter&gt;</i>&nbsp;after the variable declaration, type '{', press&nbsp;<i id="d820662a">Ctrl+&lt;space&gt;</i>&nbsp;to auto-complete)</p></li><li class="list__item" id="d46ca456"><p>create a statement:<div class="code-block" data-lang="none">component.setEnabled(false);</div>inside the block-statement</p></li><li class="list__item" id="263a6f8f"><p>mark the block-statement (i.e. excluding the declaration of the <i id="1ef7d2cf">component</i>&nbsp;variable)&nbsp;as a&nbsp;<b id="638c71f8">template fragment</b>:</p></li><li class="list__item" id="18103e89">         <figure><img alt="gdc24" title="gdc24" src="/help/img/idea/2019.2/gdc24.png" id="9d5eec7c" width="419" height="203"></figure>         <aside class="tip sideblock" data-title="" rel="9d5eec7c" id="7e83dca9">            <p id="a9ad6d64">We don't really have to use a block statement, but choosing so will make it easy for us to add more statements to this template fragment in the future.</p>         </aside>      </li></ul>   <h2 id="map_src-macro">MAP_SRC-macro</h2>   <p id="256b15bc">As&nbsp;<a href="#property_macro_in_if_macro">Generator User Guide Demo3</a>&nbsp;of the 'text' property, the 'setEnabled()' method call generation should be conditional - this statement should only be generated if the input element posses the attribute 'enabled'.</p>   <p id="327b93e5">This time, to achieve the conditional generation, instead of an IF-macro we will use a&nbsp;<b id="2b31c5a6">MAP_SRC-macro</b>.&nbsp;As we will see, MAP_SRC-macros have several advantages over IF-macros in this case.</p>   <ul class="list _ul"><li class="list__item" id="406c2fb4"><p>create a MAP_SRC-macro (it should wrap the whole statement &nbsp;)</p></li><li class="list__item" id="7e07a0b7"><p>enter code in the macro's&nbsp;<b id="85775cb9">mapped node</b>&nbsp;function as shown:</p></li></ul>   <p id="a2792ae5">      <figure><img alt="gdc25" title="gdc25" src="/help/img/idea/2019.2/gdc25.png" id="a76ee6cf" width="845" height="299"></figure>   </p>   <p id="cbafb7dc">The&nbsp;<b id="6fe268ad">mapped node</b>&nbsp;function returns the node for the 'enabled' attribute, if present, and&nbsp;<i id="28f0ffe3">null</i>&nbsp;otherwise. If the&nbsp;<b id="1030f6ca">mapped node</b>&nbsp;function in a MAP_SRC-macro returns&nbsp;<i id="907f71d9">null</i>, the generator then ignores the node wrapped by this macro (just like an <i id="2e61bc7a">If macro</i>&nbsp;would).<br>However, if the mapped node is not&nbsp;<i id="24ba0028">null</i>, then it becomes the current&nbsp;<b id="37d829ee">input node</b>, while processing the wrapped template code.&nbsp;This helps us get hold of the attribute making creation of the property-macro a bit easier compared to using an&nbsp;IF-macro - we don't have to find the 'enabled' attribute again, this attribute is already our&nbsp;<b id="c2f0afcc">input node</b>.</p>   <p id="3159c2c1">Now, to set the correct value to the template:</p>   <ul class="list _ul"><li class="list__item" id="c4a19938"><p>attach a property-macro to the boolean constant 'false'</p></li><li class="list__item" id="0dfd6fa4"><p>enter the code into its&nbsp;<b id="e55f7e01">value</b>&nbsp;function (note that this time the&nbsp;<b id="6d8d6a20">value</b>&nbsp;function expects a boolean return value):</p></li></ul>   <p id="386a6748">      <figure><img alt="gdc26" title="gdc26" src="/help/img/idea/2019.2/gdc26.png" id="dee963f5" width="728" height="262"></figure>   </p>   <h2 id="include-macro">The CALL-macro</h2>   <p id="32d92754">We will use the CALL macro to specify places in code, into which we want to insert the 'component.setEnabled(..);' statement during&nbsp;generation.</p>   <ul class="list _ul"><li class="list__item" id="604280f3"><p>open the 'insert_Button' template in the editor</p></li><li class="list__item" id="6c6b71d0"><p>insert a new empty line&nbsp;just after the statement<div class="code-block" data-lang="none">component.setText("text");</div>         <br>      </p></li><li class="list__item" id="4326f776"><p>insert&nbsp;the CALL node macro on the empty line (<i id="da97f5f5">Control + Shift + M</i>)</p></li><li class="list__item" id="9e2f04af"><p>make a reference to the 'include_ComponentProperties' template in the macro's inspector:</p></li><li class="list__item" id="406fc55e">         <figure><img alt="gdc27" title="gdc27" src="/help/img/idea/2019.2/gdc27.png" id="413fedac" width="1382" height="1064"></figure>      </li><li class="list__item" id="e4693af6"><p>create a similar macro in the 'insert_Label' template</p></li><li class="list__item" id="23efc420"><p>re-generate generator model (<i id="e2b144c1">Shift+F9</i>)<br>&nbsp;</p></li></ul>   <h2 id="testingwhatwehave">Testing what we have</h2>   <p id="839a3c05">Generating code for the 'test3' model will render a valid Java application:</p>   <p id="978014ae">       <figure><img alt="gdc28" title="gdc28" src="/help/img/idea/2019.2/gdc28.png" id="8e340634" width="422" height="661"></figure>      <br>We correctly get the <i id="8f4c9e86">setEnabled()</i>&nbsp;method generated only for the button, but not for the label.</p>   <h2 id="reference-macro(resolvingbyname)">Reference-macro (Resolving by Name)</h2>   <aside class="tip sideblock" data-title="" rel="reference-macro(resolvingbyname)" id="df727129">      <p id="69da95a2">A method-call node or variable-usage node contains a reference to a method or a variable declaration.</p>   </aside>   <p id="3cea755e">In many cases reference cannot be resolved automatically and this is where&nbsp;<b id="90389c76">reference-macros</b>&nbsp;come in handy.</p>   <p id="0d32e083">For example, let's add support for the 'background'&nbsp;property&nbsp;into our generator:</p>   <ul class="list _ul"><li class="list__item" id="8ab3bc68"><p>open the 'include_ComponentProperties' template</p></li><li class="list__item" id="1a514d65"><p>add a block-statement just after the 'component.setEnabled(false);' statement</p></li><li class="list__item" id="35aee733"><p>enter the following code inside that block-statement:<div class="code-block" data-lang="none">
component.setOpaque(true);
component.setBackground(Color.black);
</div>         <br>      </p></li><li class="list__item" id="769891a4"><p>wrap the block-statement in a MAP_SRC-macro</p></li><li class="list__item" id="fbc35587"><p>enter the code into the macro's&nbsp;<b id="f9727ac7">mapped node</b>&nbsp;function as shown:</p></li></ul>   <p id="74970c02">      <figure><img alt="gdc29" title="gdc29" src="/help/img/idea/2019.2/gdc29.png" id="5cb36a02" width="871" height="489"></figure>   </p>   <ul class="list _ul"><li class="list__item" id="cb0a2eae"><p>attach a&nbsp;<b id="741c555f">reference-macro</b>&nbsp;to the static field reference 'black' (in 'Color.black' expression), since we need to parametrize the color depending on the actual value of the 'background' attribute of the input XML&nbsp;<i id="d1048447">Element</i>.</p></li><li class="list__item" id="68c140ed"><p>enter the following code inside the&nbsp;<b id="dccd0e02">referent</b>&nbsp;function:</p></li></ul>   <p id="242899eb">      <figure><img alt="gdc30" title="gdc30" src="/help/img/idea/2019.2/gdc30.png" id="9b855dae" width="1077" height="310"></figure>   </p>   <p id="d5ab580e">In this example, the&nbsp;<b id="4b9f1813">referent</b>&nbsp;function has combined return type:</p>   <div class="code-block" data-lang="none">JOIN(node&lt;StaticFieldDeclaration&gt; | String)</div>   <p id="0b67a0b0">having the eithor-or semantics. That means that we have two alternatives for what to return from the function:</p>   <ol class="list _decimal"><li class="list__item" id="7973e666"><p>we can find a suitable static field declaration in class 'Color' and return that node</p></li><li class="list__item" id="260eb8db"><p>or we can return a&nbsp;<b id="fa7b1685">reference info</b>&nbsp;string - a name of static field declaration (name of color) and let it up to MPS to find the static field for us</p></li></ol>   <p id="c74a3ace">The 2nd option, of course, is much more attractive. Thus we are returning a value of the 'background' attribute - the name of the desired color.</p>   <h2 id="thefinaltest">The final test</h2>   <p id="ac0160e2">Now, after a language rebuild the 'test3' model will be generated into a Java application that now takes into account all the input element's attributes.</p>   <p id="e47991d4">       <figure><img alt="gdc31" title="gdc31" src="/help/img/idea/2019.2/gdc31.png" id="a077bf04" width="416" height="709"></figure>   </p><div class="last-modified" data-skip-index="skip">Last modified: 30 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-user-guide-demo2.html">Generator User Guide Demo2</a><a class="navigation-links__next" href="generator-user-guide-demo4.html">Generator User Guide Demo4</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>