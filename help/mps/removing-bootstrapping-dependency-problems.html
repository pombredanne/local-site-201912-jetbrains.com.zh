<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Removing bootstrapping dependency problems - Help | MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Removing+bootstrapping+dependency+problems.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Default</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_jbuilder">JBuilder</option><option data-group="primary" value="primary_mac_os_x">Mac OS X</option><option data-group="primary" value="primary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default">Default</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_jbuilder">JBuilder</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Removing+bootstrapping+dependency+problems.html" id="removing-bootstrapping-dependency-problems.xml">Removing bootstrapping dependency problems</h1>   <h2 id="definition:">Definition:</h2>   <p id="e233c0c5">Whenever you have</p>   <ul class="list _ul"><li class="list__item" id="184c958e"><p>a language that uses itself or</p></li><li class="list__item" id="878125ca"><p>a solution that uses a language and that language requires (i.e. indirectly or directly depends on) the same solution in order to work</p></li></ul>   <p id="b82cdf57">you have bootstrapping dependency problem.</p>   <h2 id="whyisthisaproblem">Why is this a problem</h2>   <ul class="list _ul"><li class="list__item" id="22d9e2fd"><p>you cannot rebuild the whole project from the ground up using build scripts</p></li><li class="list__item" id="99162429"><p>you are forced to keep generated artifacts in the VCS repository</p></li></ul>   <p id="bb230607">This bootstrapping dependency circle prevents your project from ever being rebuilt from the ground up completely. Instead, building your language requires the previous version of your solution build artifacts to have been generated. Similarly, building your solution requires the language to have been built first. Thus you cannot rebuild your whole project with a single command, you need to keep generated artifacts in VCS and the dependency structure of your project contains loops.&nbsp;</p>   <p id="6f27a9f6">The <b id="01f27ee4">build scripts</b> in MPS 2.5.4 and beyond <b id="c42dcdb8">can generate MPS code</b> and so you no longer depend on the MPS workbench for code generation. Bootstrapping dependencies in the project structure, however, stand in the way.&nbsp;</p>   <h2 id="thedetectionandeliminationtoolchaininmps">The detection and elimination toolchain in MPS</h2>   <p id="35dc6a98">We consider the inability to fully regenerate projects to be a serious issue. Serious enough so that we decided to provide tools that detect and help you eliminate all such dependencies in MPS starting with version 2.5.4. Nothing changes for rebuilding your projects in MPS. However, when <b id="ba4dde0f">rebuilding build scripts</b>, MPS will detect and report circular dependencies between languages and modules that use them <b id="b78b838f">as errors</b>.</p>   <p id="e8fedb4c">When rebuilding a build script, you may get error reports like:</p>   <p id="5d7d2233">      <figure><img alt="mps error" title="mps error" src="/help/img/idea/2019.2/mps-error.png" id="33ec9d5a" width="961" height="299"></figure>   </p>   <p id="11f09e71">The output text contains a hint for solving the issue: <i id="d5611c31">right click on a module -&gt; Analyze -&gt; Analyze Module Dependencies</i>   </p>   <p id="eb9b91fb">      <figure><img alt="depViewer" title="depViewer" src="/help/img/idea/2019.2/depViewer.png" id="63a67d4d" width="963" height="384"></figure>   </p>   <p id="cf6e79f3">You will get the analyzer report panel displaying module dependencies. The gray <i id="b3ea6099">(bootstrap dependency)</i>&nbsp;indicator will highlight all problematic bootstrapping dependencies so you can quickly spot them. After selecting one in the left panel,&nbsp;the right panel will further detail the dependency circle. You see the dependency of the module on the language is listed, followed by the dependency of the language on the module. Now you can choose, which of the two dependency directions you want to remove in order to fix the problem.</p>   <h2 id="fixingtheproblem">Fixing the problem</h2>   <p id="8fc55d70">Essentially, you need to break the dependency cycles. The first attempt you should make is to invoke <i id="d6ac48d3">Optimize Imports</i>. If the dependencies between modules were only declared but not really used in code, this will remove them and potentially solve the bootstrapping problem. If the problem remains, you'll have to play around with the analyzer a bit more.</p>   <p id="c9fac0da">      <figure><img alt="Editor113" title="Editor113" src="/help/img/idea/2019.2/Editor113.png" id="c67c8f7c" width="391" height="349"></figure>   </p>   <h3 id="analyzingthebootstrappingdependencies">Analyzing the bootstrapping dependencies</h3>   <p id="d5f736a7">Imagine, for example, that we are fixing a frequent problem of a language uses itself for its own definition - a bootstrapping language.</p>   <p id="46808227">      <figure><img alt="selfDependency1" title="selfDependency1" src="/help/img/idea/2019.2/selfDependency1.png" id="793d5b54" width="724" height="269"></figure>   </p>   <p id="0d55fbf9">We are only seeing a single problematic dependency direction in the right panel.</p>   <p id="ded2f3be">      <figure><img alt="selfDependencyMenu" title="selfDependencyMenu" src="/help/img/idea/2019.2/selfDependencyMenu.png" id="2a1bddaa" width="721" height="268"></figure>   </p>   <p id="de491e4a">With the&nbsp;<i id="81e7f376">Show Usages</i>&nbsp;pop-up menu command we get a third panel, which lists all the concrete occurrences in code, where the dependency is needed.</p>   <p id="831ae9ba">      <figure><img alt="quotation" title="quotation" src="/help/img/idea/2019.2/quotation.png" id="e0342c9b" width="866" height="299"></figure>   </p>   <p id="1715d903">Unfortunately, you'll have to decide yourself, which ones to remove and how. This will be a manual process.</p>   <h2 id="typicalcasesofbootstrappingdependencies">Typical cases of bootstrapping dependencies</h2>   <h4 id="case1:self-referingquotations">Case 1: Self-refering quotations</h4>   <p id="fcbbc754">A very frequent example of a mistake that leads to a self-reference in a language is using the language in quotations, for example to define its own type-system rules. You declare your own type and then instantiate this type in the type-system aspect through quotation.&nbsp;Now the language needs itself to have been built in order to build.</p>   <p id="16a70192">      <figure><img alt="H1" title="H1" src="/help/img/idea/2019.2/H1.png" id="7b946f75" width="428" height="244"></figure>   </p>   <p id="2dc2ea56">      <i id="8e62daec">Light quotations</i>&nbsp;should&nbsp;be used in such situations instead of&nbsp;<i id="ca8e9f3d">quotations</i>. They provide lightweight quotation-like functionality without the need to use the editors of the nodes in quotation. For <i id="eda85d7e">Light quotations</i>&nbsp;to create appropriate nodes you need to supply the concept name and the required features.</p>   <p id="e21b2fe1">A handy intention for quick conversion from <i id="75048b5d">quotation</i>&nbsp;to a&nbsp;<i id="3c161e39">Light quotation</i>&nbsp;is also available.</p>   <p id="ed18882d">      <figure><img alt="H3" title="H3" src="/help/img/idea/2019.2/H3.png" id="02cb605f" width="296" height="64"></figure>   </p>   <p id="7ce633d4">      <i id="c87f23af">Light quotations</i>&nbsp;compared to&nbsp;<i id="98e9fde7">quotations</i>&nbsp;are slightly less convenient, but they avoids the bootstrapping problem. You may also favor them to quotations to better express your intent, when you need to combine quotations and anti-quotations heavily.</p>   <p id="06527d8d">      <figure><img alt="Editor112" title="Editor112" src="/help/img/idea/2019.2/Editor112.png" id="d6604a34" width="617" height="318"></figure>   </p>   <h4 id="case2:alanguageusesitselfinanaccessorymodel">Case 2: A language uses itself in an accessory model</h4>   <p id="7dc8de04">Languages can contain accessory models. If these accessory models use the containing language and they have not selected the "do not generate flag", we get a circular dependency between the accessory model and the owning language. Such a language cannot be rebuilt from scratch, since the accessory model needs to be generated together with the language.</p>   <p id="a6c6db7f">The solution to the problem is to move the accessory model to a separate solution. It is possible in MPS to have an accessory model&nbsp;reside&nbsp;outside of a language.</p>   <h4 id="case3:alanguageusesitselfinsidepatterns&nbsp;createdbyjetbrains.mps.lang.pattern">Case 3: A language uses itself inside patterns created by jetbrains.mps.lang.pattern</h4>   <p id="63ea3997">This problem is similar to the one&nbsp;with quotations. It does not prohibit rebuilding a&nbsp;language from scratch, but the cyclic dependency stays anyway.&nbsp;Currently, there is no straightforward solutions to that other than avoiding using the language inside patterns or <a href="">allowing for bootstrapping dependencies in build scripts</a>.</p>   <h4 id="case4:aruntimesolutionofalanguageusestheverysamelanguage">Case 4: A runtime solution of a language uses the very same language</h4>   <aside class="tip sideblock" data-title="" rel="case4:aruntimesolutionofalanguageusestheverysamelanguage" id="a1ad9df4">      <p id="9f5c12a2">This one is not really a bootstrapping problem and will not prevent your build scripts from being build, however, it should still be considered to be a problematic and discouraged project dependency structure.</p>   </aside>   <p id="8cb67d84">A runtime solution for a&nbsp;<b id="df9eaaef">language A</b>&nbsp;typically contains the code executed by whatever gets generated from the models that use the&nbsp;<b id="71527564">language A</b>. So the runtime solution code logically belongs to the same abstraction level as the generated code, that is one level below the&nbsp;<b id="0ad58389">language A</b>&nbsp;level. It&nbsp;is a good practice to separate the lower-level code from the higher-level&nbsp;code and organize your project hierarchically.</p>   <p id="b5926f1c">The solution to the&nbsp;problem is to move the usages of&nbsp;<b id="e1be8110">language A</b>&nbsp;away from the runtime solution into another, separate module.</p>   <h2 id="whatelseneedstobedone">What else needs to be done</h2>   <p id="2ab531be">After attacking all problems individually, you need to optimize imports in your project and invoke the <i id="a5e4f1fd">Reload modules from disk</i>&nbsp;intention in the build script. This will clean up the dependency structure and allow your project to be fully rebuilt again.</p>   <p id="087f7c24">      <figure><img alt="Editor113" title="Editor113" src="/help/img/idea/2019.2/Editor113.png" id="5ad4ac06" width="391" height="349"></figure>   </p>   <p id="720ede76">      <figure><img alt="Editor114" title="Editor114" src="/help/img/idea/2019.2/Editor114.png" id="00e2926e" width="811" height="291"></figure>      <br>    </p>   <h2 id="aquickwaytosuppresstheproblem&nbsp;">A quick way to suppress the problem  </h2>   <p id="e43ef42c">A quick and dirty trick to suppress the error is to set the&nbsp;<i id="9d724b93">bootstrap</i>&nbsp;property in the MPS settings section of the build script to <i id="a30ebc68">true</i>.</p>   <p id="794817dc">      <figure><img alt="bootstrap2" title="bootstrap2" src="/help/img/idea/2019.2/bootstrap2.png" id="fb1d4fab" width="565" height="492"></figure>   </p>   <p id="5ca60617">Consider this to be a last resort way to temporarily enable building your project. Proper solutions with eliminating all offending bootstrapping dependencies should be preferred.</p><div class="last-modified" data-skip-index="skip">Last modified: 30 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="building-standalone-ides-for-your-languages.html">Building standalone IDEs for your languages</a><a class="navigation-links__next" href="removing-sources-from-generated-code.html">Removing sources from generated code</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>