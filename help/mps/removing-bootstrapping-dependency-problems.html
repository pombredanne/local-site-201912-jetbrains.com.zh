<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>消除引导依赖性问题-帮助|帮助MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Removing+bootstrapping+dependency+problems.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="removing-bootstrapping-dependency-problems.xml" data-toc="Removing+bootstrapping+dependency+problems.html">消除引导依赖性问题</h1>   <h2 id="definition:">定义：</h2>   <p id="e233c0c5">每当你有</p>   <ul class="list _ul"><li class="list__item" id="184c958e"><p>使用自己的语言或</p></li><li class="list__item" id="878125ca"><p>使用一种语言并且该语言需要（即间接或直接依赖）相同解决方案才能工作的解决方案</p></li></ul>   <p id="b82cdf57">您有引导依赖问题。</p>   <h2 id="whyisthisaproblem">为什么这是个问题</h2>   <ul class="list _ul"><li class="list__item" id="22d9e2fd"><p>您无法使用构建脚本从头开始重建整个项目</p></li><li class="list__item" id="99162429"><p>您被迫将生成的工件保留在VCS存储库中</p></li></ul>   <p id="bb230607">这个自举依赖环阻止了您的项目从头开始完全重建。相反，构建语言需要生成解决方案构建工件的先前版本。同样，构建解决方案需要首先构建语言。因此，您无法使用单个命令来重建整个项目，您需要将生成的工件保留在VCS中，并且项目的依赖结构包含循环。</p>   <p id="6f27a9f6">MPS 2.5.4及更高<b id="01f27ee4">版本</b>中的<b id="01f27ee4">构建脚本</b> <b id="c42dcdb8">可以生成MPS代码</b> ，因此您不再依赖MPS工作台来生成代码。但是，引导项目结构中的依赖项会遇到麻烦。</p>   <h2 id="thedetectionandeliminationtoolchaininmps">MPS中的检测和消除工具链</h2>   <p id="35dc6a98">我们认为无法完全重新生成项目是一个严重的问题。足够严重，因此我们决定提供工具来检测并帮助您消除从2.5.4版开始的MPS中的所有此类依赖性。在MPS中重建项目没有任何变化。但是，当<b id="ba4dde0f">重建构建脚本时</b> ，MPS将检测并报告将它们<b id="b78b838f">用作错误的</b>语言和模块之间的循环依赖关系。</p>   <p id="e8fedb4c">重建构建脚本时，您可能会收到以下错误报告：</p>   <p id="5d7d2233">      </p><figure><img alt="mps错误" title="mps错误" src="/help/img/idea/2019.2/mps-error.png" id="33ec9d5a" width="961" height="299"></figure>   <p></p>   <p id="11f09e71">输出文本包含解决该问题的提示： <i id="d5611c31">右键单击模块->分析->分析模块依赖关系</i>   </p>   <p id="eb9b91fb">      </p><figure><img alt="depViewer" title="depViewer" src="/help/img/idea/2019.2/depViewer.png" id="63a67d4d" width="963" height="384"></figure>   <p></p>   <p id="cf6e79f3">您将获得显示模块相关性的分析器报告面板。灰色<i id="b3ea6099">（引导程序依赖性）</i>指示器将突出显示所有有问题的引导程序依赖性，因此您可以快速发现它们。在左侧面板中选择一个后，右侧面板将进一步详细说明依赖项圈。您会看到模块对语言的依赖关系，然后是语言对模块的依赖关系。现在，您可以选择要删除的两个依赖关系方向中的哪一个，以解决此问题。</p>   <h2 id="fixingtheproblem">解决问题</h2>   <p id="8fc55d70">本质上，您需要打破依赖性循环。您应该首先尝试调用<i id="d6ac48d3">Optimize Imports</i> 。如果仅声明模块之间的依赖关系，而未在代码中真正使用它们，则这将删除它们，并有可能解决引导问题。如果问题仍然存在，您将不得不多使用分析仪。</p>   <p id="c9fac0da">      </p><figure><img alt="编辑器113" title="编辑器113" src="/help/img/idea/2019.2/Editor113.png" id="c67c8f7c" width="391" height="349"></figure>   <p></p>   <h3 id="analyzingthebootstrappingdependencies">分析自举依赖性</h3>   <p id="d5f736a7">例如，想象一下，我们正在解决一种常见的语言问题，即使用自身来定义自己的语言-一种引导语言。</p>   <p id="46808227">      </p><figure><img alt="selfDependency1" title="selfDependency1" src="/help/img/idea/2019.2/selfDependency1.png" id="793d5b54" width="724" height="269"></figure>   <p></p>   <p id="0d55fbf9">我们在右侧面板中仅看到一个有问题的依赖关系方向。</p>   <p id="ded2f3be">      </p><figure><img alt="selfDependencyMenu" title="selfDependencyMenu" src="/help/img/idea/2019.2/selfDependencyMenu.png" id="2a1bddaa" width="721" height="268"></figure>   <p></p>   <p id="de491e4a">使用“ <i id="81e7f376">显示用法”</i>弹出菜单命令，我们获得了第三个面板，该面板列出了代码中所有需要依赖的具体实例。</p>   <p id="831ae9ba">      </p><figure><img alt="报价单" title="报价单" src="/help/img/idea/2019.2/quotation.png" id="e0342c9b" width="866" height="299"></figure>   <p></p>   <p id="1715d903">不幸的是，您必须决定自己，删除哪些以及如何删除。这将是一个手动过程。</p>   <h2 id="typicalcasesofbootstrappingdependencies">自举依赖项的典型情况</h2>   <h4 id="case1:self-referingquotations">情况1：自引用报价</h4>   <p id="fcbbc754">导致某种语言自我引用的错误的一个非常常见的例子是使用该语言的引号，例如定义其自己的类型系统规则。您声明自己的类型，然后通过引用在类型系统方面实例化此类型。现在，语言本身需要进行构建才能构建。</p>   <p id="16a70192">      </p><figure><img alt="H1" title="H1" src="/help/img/idea/2019.2/H1.png" id="7b946f75" width="428" height="244"></figure>   <p></p>   <p id="2dc2ea56">      在这种情况下，应使用<i id="8e62daec">轻引号</i>代替<i id="ca8e9f3d">引号</i> 。它们提供了类似报价的轻量级功能，而无需使用报价中的节点编辑器。为了用<i id="eda85d7e">Light引用</i>创建适当的节点，您需要提供概念名称和所需的功能。</p>   <p id="e21b2fe1">还提供了方便的从<i id="75048b5d">报价单</i>到<i id="3c161e39">报价单</i>快速转换的意图。</p>   <p id="ed18882d">      </p><figure><img alt="H3" title="H3" src="/help/img/idea/2019.2/H3.png" id="02cb605f" width="296" height="64"></figure>   <p></p>   <p id="7ce633d4">      相比<i id="98e9fde7">报价</i> <i id="c87f23af">光报价</i>略有不太方便，但他们避免了引导问题。当您需要大量结合使用引号和反引号时，您可能还希望它们使用引号来更好地表达您的意图。</p>   <p id="06527d8d">      </p><figure><img alt="编辑器112" title="编辑器112" src="/help/img/idea/2019.2/Editor112.png" id="d6604a34" width="617" height="318"></figure>   <p></p>   <h4 id="case2:alanguageusesitselfinanaccessorymodel">情况2：一种语言在附件模型中使用自己</h4>   <p id="7dc8de04">语言可以包含附件模型。如果这些附件模型使用包含的语言，并且它们尚未选择“不生成标志”，则将在附件模型和所属语言之间获得循环依赖关系。由于需要与该语言一起生成附件模型，因此无法从头开始重建这种语言。</p>   <p id="a6c6db7f">该问题的解决方案是将附件模型移至单独的解决方案。在MPS中，可以使附件模型驻留在语言之外。</p>   <h4 id="case3:alanguageusesitselfinsidepatterns createdbyjetbrains.mps.lang.pattern">情况3：一种语言在jetbrains.mps.lang.pattern创建的模式内使用自己</h4>   <p id="63ea3997">此问题类似于带有引号的问题。它不禁止从头开始重建语言，但是循环依存性仍然存在。当前，除了避免在模式中使用该语言或<a href="">允许在构建脚本中引导依赖项之外，</a>没有其他直接的解决方案。</p>   <h4 id="case4:aruntimesolutionofalanguageusestheverysamelanguage">情况4：一种语言的运行时解决方案使用完全相同的语言</h4>   <aside class="tip sideblock" rel="case4:aruntimesolutionofalanguageusestheverysamelanguage" id="a1ad9df4" data-title="">      <p id="9f5c12a2">这实际上不是一个引导问题，并且不会阻止构建脚本的生成，但是，仍应将其视为有问题且不鼓励的项目依赖关系结构。</p>   </aside>   <p id="8cb67d84"><b id="df9eaaef">语言</b> A的运行时解决方案通常包含由使用<b id="71527564">语言A</b>的模型生成的任何内容执行的代码。因此，运行时解决方案代码在逻辑上与所生成的代码属于同一抽象级别，即比<b id="0ad58389">语言A</b>级别低<b id="0ad58389">一个</b>级别。将低级代码与高级代码分开并按层次组织项目是一个好习惯。</p>   <p id="b5926f1c">该问题的解决方案是将<b id="e1be8110">语言A</b>的用法从运行时解决方案转移到另一个单独的模块中。</p>   <h2 id="whatelseneedstobedone">还有什么需要做的</h2>   <p id="2ab531be">单独解决所有问题之后，您需要优化项目中的导入，并在构建脚本中<i id="a5e4f1fd">从磁盘</i>意图调用<i id="a5e4f1fd">Reload模块</i> 。这将清理依赖关系结构，并允许再次完全重建您的项目。</p>   <p id="087f7c24">      </p><figure><img alt="编辑器113" title="编辑器113" src="/help/img/idea/2019.2/Editor113.png" id="5ad4ac06" width="391" height="349"></figure>   <p></p>   <p id="720ede76">      </p><figure><img alt="编辑器114" title="编辑器114" src="/help/img/idea/2019.2/Editor114.png" id="00e2926e" width="811" height="291"></figure>      <br>    <p></p>   <h2 id="aquickwaytosuppresstheproblem ">快速解决问题的方法</h2>   <p id="e43ef42c">抑制错误的一种快速而肮脏的技巧是将构建脚本的MPS设置部分中的<i id="9d724b93">bootstrap</i>属性设置为<i id="a30ebc68">true</i> 。</p>   <p id="794817dc">      </p><figure><img alt="bootstrap2" title="bootstrap2" src="/help/img/idea/2019.2/bootstrap2.png" id="fb1d4fab" width="565" height="492"></figure>   <p></p>   <p id="5ca60617">认为这是暂时启用构建项目的不得已的方法。消除所有有害的引导依赖关系的正确解决方案应该是首选。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="building-standalone-ides-for-your-languages.html">为您的语言构建独立的IDE</a> <a class="navigation-links__next" href="removing-sources-from-generated-code.html">从生成的代码中删除源</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>