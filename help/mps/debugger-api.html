<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Debugger API - Help | MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Debugger+API.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Default</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_jbuilder">JBuilder</option><option data-group="primary" value="primary_mac_os_x">Mac OS X</option><option data-group="primary" value="primary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default">Default</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_jbuilder">JBuilder</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Debugger+API.html" id="debugger-api.xml">Debugger API</h1>   <p id="572366b6">MPS provides a java api for creating a debugger engine to work with MPS.</p>   <p id="b23032fd">      <ul data-skip-index="skip"><li class="list__item"><a href="#wheretostart">Where to start</a></li><li class="list__item"><a href="#keyclasses">Key classes</a></li><li class="list__item"><a href="#valuesandwatchables">Values and watchables</a></li><li class="list__item"><a href="#sourcepositionandipositionprovider">SourcePosition and IPositionProvider</a></li><li class="list__item"><a href="#traceinforesourceprovider">TraceInfoResourceProvider</a></li><li class="list__item"><a href="#finalremarks">Final remarks</a></li></ul>   </p>   <h3 id="wheretostart">Where to start</h3>   <p id="e9833a95">A good way to start writing a custom debugger engine is to study the <b id="17e5a825">Java Debugger</b> plugin implementation in MPS. The source code is located in solutions <i id="3fa1f6bc">jetbrains.mps.debugger.java.api</i> and <i id="3624f795">jetbrains.mps.debugger.java.runtime</i>. The Debugger API itself can be found in <i id="0d58e4ce">jetbrains.mps.debugger.api.api</i>. Solution <i id="7ff38b47">jetbrains.mps.debugger.api.runtime</i> can be studied to understand how api classes are used in MPS, but classes from this solution should not be referenced from a custom debugger code. Both Debugger API and Java Debugger are packaged as IDEA plugins for MPS, and so should be every custom implementation of Debugger API. Implementing a debugger for MPS requires some knowledge of Intellij IDEA, so <a href="http://confluence.jetbrains.com/display/IDEADEV/PluginDevelopment" data-external="true" target="_blank" rel="noopener noreferrer">Intellij IDEA Plugin Development page</a> should also be studied. And there is of course a <a href="build-language.html">Build Language Guide</a> to help with plugin packaging.</p>   <h3 id="keyclasses">Key classes</h3>   <p id="1704a963">Interface <i id="8b281180">jetbrains.mps.debug.api.IDebugger</i> represent a debugger as a whole. It should be registered in a <i id="f7ca7759">jetbrains.mps.debug.api.Debuggers</i> application component. There is a default implementation, <i id="b66915f2">AbstractDebugger</i>. <i id="61b92ce0">IDebugger</i> implementation is required to provide 2 things: a way to start an application under debugger and a way to create breakpoints. For that MPS Debugger API has 2 interfaces:</p>   <ol class="list _decimal"><li class="list__item" id="7ebf6390"><p>         <i id="0e5702fe">jetbrains.mps.debug.api.AbstractDebugSessionCreator</i> â€“ its main job is to start an application under debug and create an instance of <i id="604aaeaf">AbstractDebugSession</i>, which corresponds to a single application, executed under debug. A state of debugger (either running or paused on a breakpoint or other) is represented by <i id="adc880d5">jetbrains.mps.debug.api.AbstractUiState</i>. When a debug session transfers from one state to another, a new instance of <i id="318b572c">AbstractUiState</i> should be created and set to <i id="57bd52f8">AbstractDebugSession</i>. <i id="00fa050f">AbstractUiState</i> holds the information about current threads and stack frames, visible variables, and so on.</p></li><li class="list__item" id="79a7442d"><p>         <i id="e1b44417">jetbrains.mps.debug.api.breakpoints.IBreakpointsProvider</i> is responsible for creating breakpoints, providing editing ui and persisting breakpoints state to and from xml. A breakpoint class should implement <i id="dd74d920">IBreakpoint</i>. <i id="5b5f8872">AbstractBreakpoint</i> is a base class to extend. For breakpoints that can be set on some location (which basically means "on a node", like a breakpoint on line of code) exists an interface <i id="9948c851">ILocationBreakpoint</i>. Each breakpoint is of some kind (<i id="905e3119">IBreakpointKind</i>), for example there can be kinds for line breakpoints, field breakpoints or exception breakpoints.</p></li></ol>   <h4 id="valuesandwatchables">Values and watchables</h4>   <p id="6c57b1b8">      <i id="75608a20">jetbrains.mps.debug.api.programState</i> package contains a number of interfaces to reflect a state of the program. When paused on a breakpoint <i id="cd05a560">AbstractUiState</i> has a list of threads that are running in an application (interface <i id="e79dcfc9">IThread</i>). Each thread has a list of stack frames (<i id="482705dd">IStackFrame</i>), and each stack frame has a list of watchables (<i id="4a7f2306">IWatchable</i>) visible there. A watchable can be a local variable, or "this" object or a "static context". Each watchable has one value (<i id="1c75ccb4">IValue</i>). In turn, each value can have a number of watchables. For example, java local variable is a watchable, an object assigned to this variable is a value, and fields that this object has are watchables, and so on. This tree like structure is what is shown in "Variables" section of the "Debug" tool window.</p>   <h4 id="sourcepositionandipositionprovider">SourcePosition and IPositionProvider</h4>   <p id="c08f388e">      <i id="ca5cc445">jetbrains.mps.debug.api.source.IPositionProvider</i> is an interface to customize the way source code (text) is mapped into a location inside of MPS (a text file or a node). It calculates an instance of <i id="9a25d0c2">jetbrains.mps.debug.api.source.SourcePosition</i> for a location either given by an instance of a <i id="90f598c9">ILocation</i> interface or by name of a unit name, filename and line number. There are two predefined providers: <i id="c40f3567">jetbrains.mps.debug.api.source.NodePositionProvider</i> and <i id="b8cbb989">jetbrains.mps.debug.api.source.TextPositionProvider</i>. They are responsible for finding a node or a text position for a location.</p>   <p id="ce7fd526">      <i id="db18d670">SourcePosition</i> is a class that contains a position inside MPS. This class has two implementations: <i id="70b1c095">jetbrains.mps.debug.api.source.NodeSourcePosition</i> (contains a pointer to a node) and <i id="37e95190">jetbrains.mps.debug.api.source.TextSourcePosition</i> (contains a text file). Default line highlighting in MPS supports only these two kinds of positions.</p>   <p id="370d9985">Providers are registered in <i id="cadb30f7">jetbrains.mps.debug.api.source.PositionProvider</i> class. Each provider has a key, associated with it, which tell whether this provider returns a <i id="e13ee364">NodeSourcePosition</i> or a <i id="018dc453">TextSourcePosition</i>. Also, a provider accepts a specific <i id="f80e8950">DebugSession</i>, and only providers that are shipped with the MPS debugger by default can accept all sessions.</p>   <p id="69ad05f6">Here is an example of a position provider:</p>   <div class="code-block" data-lang="none">/*
NodePositionProvider is extended here in order to provide NodeSourcePosition.
It is not necessary to extend one of the default providers.
*/
public class MyCustomNodePositionProvider extends NodePositionProvider { 
  private final Project myProject; 
   
  public MyCustomNodePositionProvider(Project project) { 
    myProject = project; 
  } 
   
  @Nullable() 
  @Override 
  public node&lt;&gt; getNode(@NonNls string unitName, @NonNls string fileName, int position) { 
    node&lt;&gt; node = ... (some code that calculates a node);
    return node;
  } 
   
  public void init() {
    // call this method on your debugger initialization
    PositionProvider.getInstance(myProject).addProvider(this, NodeSourcePosition.class.getName()); 
  } 
   
  public void dispose() { 
    // call this method on your debugger disposal
    PositionProvider.getInstance(myProject).removeProvider(this); 
  } 
   
  @Override 
  public boolean accepts(AbstractDebugSession session) { 
    // it is necessary to override this method and to accept only AbstractDebugSession instances that are created by your debugger
    return session instanceof MyCustomDebugSession; 
  } 
}</div>   <h4 id="traceinforesourceprovider">TraceInfoResourceProvider</h4>   <p id="a1c84bba">      <i id="ea2ea2d6">jetbrains.mps.generator.traceInfo.TraceInfoCache.TraceInfoResourceProvider</i> is an interface that allows to customse how paths to the <i id="3068c055">trace.info</i> files are calculated for a module. As an example, modules that are written in <i id="109ce970">BaseLanguage</i> have their <i id="8e689a50">trace.info</i> files in classpath. The instance of an interface is given a module and a name of resource to find (for example, "<i id="52f9cafb">jetbrains/mps/core/util/trace.info</i>" if a caller needs a location of a <i id="344b791c">trace.info</i> file for a model <i id="4859967c">jetbrains.mps.core.util</i>) and should return an instance of <i id="2dee5e2a">java.net.URL</i>. <i id="0d700ee4">TraceInfoResourceProviders</i> are registered/unregistered in <i id="be31d25f">TraceInfoCache</i> instance using <i id="b03e474a">addResourceProvider/removeResourceProvider</i> methods.</p>   <h3 id="finalremarks">Final remarks</h3>   <ol class="list _decimal"><li class="list__item" id="46f03fa9">Variables tree in debugger tool window now uses a background thread for its updates. Several methods in the API provide support for that::<ul class="list _ul"><li class="list__item" id="c462fdf4"><p>               <i id="c4fb3bc6">IValue.initSubvalues()</i> method, which is called in the background thread and should perform all the calculations necessary for acquiring subvalues of this value. The&nbsp;<i id="b1bae12c">IValue.getSubvalues()</i>&nbsp;method is only supposed to return the data, which have been calculated in the <i id="3cf353f0">initSubvalues()</i> method before.</p></li><li class="list__item" id="09de4f4f"><p>The<i id="5b2f7629"> AbstractUiState.invokeEvaluation()</i> method, which is used by the debugger api to invoke all evaluation code (i.e. the code, which does some calculations inside the debugged program; specifically this method is used to invoke <i id="4441d564">IValue.initSubvalues()</i>). By default this method just schedules the command to one of the threads in the thread pool, but one can override it for some custom behavior.</p></li></ul>      </li></ol><div class="last-modified" data-skip-index="skip">Last modified: 30 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="debugger.html">Debugger</a><a class="navigation-links__next" href="using-mps-debugger.html">Using the MPS Debugger</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>