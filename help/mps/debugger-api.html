<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>调试器API-帮助| MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Debugger+API.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="debugger-api.xml" data-toc="Debugger+API.html">调试器API</h1>   <p id="572366b6">MPS提供了一个Java API，用于创建可与MPS配合使用的调试器引擎。</p>   <p id="b23032fd">      </p><ul data-skip-index="skip"><li class="list__item"><a href="#wheretostart">从哪儿开始</a></li><li class="list__item"><a href="#keyclasses">重点班</a></li><li class="list__item"><a href="#valuesandwatchables">价值观和观察力</a></li><li class="list__item"><a href="#sourcepositionandipositionprovider">SourcePosition和IPositionProvider</a></li><li class="list__item"><a href="#traceinforesourceprovider">TraceInfoResourceProvider</a></li><li class="list__item"><a href="#finalremarks">结束语</a></li></ul>   <p></p>   <h3 id="wheretostart">从哪儿开始</h3>   <p id="e9833a95">开始编写自定义调试器引擎的一种好方法是研究MPS中的<b id="17e5a825">Java Debugger</b>插件实现。源代码位于解决方案<i id="3fa1f6bc">jetbrains.mps.debugger.java.api</i>和<i id="3624f795">jetbrains.mps.debugger.java.runtime中</i> 。调试器API本身可以在<i id="0d58e4ce">jetbrains.mps.debugger.api.api中</i>找到。可以研究解决方案<i id="7ff38b47">jetbrains.mps.debugger.api.runtime</i>来了解MPS中如何使用api类，但是不应从自定义调试器代码中引用此解决方案中的类。Debugger API和Java Debugger都打包为MPS的IDEA插件，因此，调试器API的每个自定义实现也应如此。为MPS实施调试器需要Intellij IDEA的一些知识，因此也应研究<a href="http://confluence.jetbrains.com/display/IDEADEV/PluginDevelopment" rel="noopener noreferrer" data-external="true" target="_blank">Intellij IDEA插件开发页面</a> 。当然，还有《 <a href="build-language.html">构建语言指南》</a>可以帮助插件打包。</p>   <h3 id="keyclasses">重点班</h3>   <p id="1704a963">接口<i id="8b281180">jetbrains.mps.debug.api。IDebugger</i>代表整个调试器。它应该在<i id="f7ca7759">jetbrains.mps.debug.api中注册<i id="f7ca7759">。调试器</i>应用程序组件。有一个默认的实现<i id="b66915f2">AbstractDebugger</i> 。<i id="61b92ce0">IDebugger</i>实现需要提供两件事：在调试器下启动应用程序的方法和创建断点的方法。为此，MPS Debugger API具有2个接口：</i></p><i id="f7ca7759">   <ol class="list _decimal"><li class="list__item" id="7ebf6390"><p>         <i id="0e5702fe">jetbrains.mps.debug.api。AbstractDebugSessionCreator</i> –其主要工作是在调试下启动应用程序，并创建<i id="604aaeaf">AbstractDebugSession</i>的实例，该实例对应于在调试下执行的单个应用程序。<i id="adc880d5">jetbrains.mps.debug.api表示调试器的状态（在断点或其他位置运行或暂停） <i id="adc880d5">。AbstractUiState</i> 。当调试会话从一种状态转移到另一种状态时，应创建一个<i id="318b572c">AbstractUiState</i>的新实例并将其设置为<i id="57bd52f8">AbstractDebugSession</i> 。<i id="00fa050f">AbstractUiState</i>保存有关当前线程和堆栈帧，可见变量等的信息。</i></p></li><li class="list__item" id="79a7442d"><p><i id="adc880d5">         <i id="e1b44417">jetbrains.mps.debug.api.breakpoints。IBreakpointsProvider</i>负责创建断点，提供编辑ui并在与XML之间的断点状态持久化。断点类应实现<i id="dd74d920">IBreakpoint</i> 。<i id="5b5f8872">AbstractBreakpoint</i>是要扩展的基类。对于可以在某个位置设置的断点（基本上意味着“在节点上”，如代码行上的断点），存在一个接口<i id="9948c851">ILocationBreakpoint</i> 。每个断点都是某种类型（ <i id="905e3119">IBreakpointKind</i> ），例如，行断点，字段断点或异常断点可以有多种。</i></p></li></ol><i id="adc880d5">   <h4 id="valuesandwatchables">价值观和观察力</h4>   <p id="6c57b1b8">      <i id="75608a20">jetbrains.mps.debug.api.programState</i>程序包包含许多接口，以反映程序的状态。当暂停在断点上时， <i id="cd05a560">AbstractUiState</i>包含一个在应用程序中运行的线程的列表（接口<i id="e79dcfc9">IThread</i> ）。每个线程都有一个堆栈框架列表（ <i id="482705dd">IStackFrame</i> ），每个堆栈框架都有一个可见的可观察<i id="4a7f2306">对象</i>列表（ <i id="4a7f2306">IWatchable</i> ）。监视对象可以是局部变量，也可以是“此”对象或“静态上下文”。每个<i id="1c75ccb4">监视对象</i>都有一个值（ <i id="1c75ccb4">IValue</i> ）。反过来，每个值可以具有多个监视对象。例如，java局部变量是可监视的，分配给该变量的对象是一个值，而该对象具有的字段是监视的，依此类推。这种树状结构就是“调试”工具窗口的“变量”部分中显示的结构。</p>   <h4 id="sourcepositionandipositionprovider">SourcePosition和IPositionProvider</h4>   <p id="c08f388e">      <i id="ca5cc445">jetbrains.mps.debug.api.source。IPositionProvider</i>是用于自定义将源代码（文本）映射到MPS内部位置（文本文件或节点）的方式的接口。它计算<i id="9a25d0c2">jetbrains.mps.debug.api.source的实例<i id="9a25d0c2">。由<i id="90f598c9">ILocation</i>接口的实例提供的位置或由单元名称，文件名和行号提供的位置的SourcePosition</i> 。有两个预定义的提供程序： <i id="c40f3567">jetbrains.mps.debug.api.source。NodePositionProvider</i>和<i id="b8cbb989">jetbrains.mps.debug.api.source。TextPositionProvider</i> 。他们负责查找位置的节点或文本位置。</i></p><i id="9a25d0c2">   <p id="ce7fd526">      <i id="db18d670">SourcePosition</i>是一个类，其中包含MPS中的位置。此类具有两个实现： <i id="70b1c095">jetbrains.mps.debug.api.source。NodeSourcePosition</i> （包含指向节点的指针）和<i id="37e95190">jetbrains.mps.debug.api.source。TextSourcePosition</i> （包含文本文件）。MPS中的默认行突出显示仅支持这两种位置。</p>   <p id="370d9985">提供程序已在<i id="cadb30f7">jetbrains.mps.debug.api.source中注册<i id="cadb30f7">。PositionProvider</i>类。每个供应商有一个键，与之相关联的，这告诉该提供商是否返回<i id="e13ee364">NodeSourcePosition</i>或<i id="018dc453">TextSourcePosition。</i>另外，提供程序接受特定的<i id="f80e8950">DebugSession</i> ，并且默认情况下，只有MPS调试器随附的提供程序才能接受所有会话。</i></p><i id="cadb30f7">   <p id="69ad05f6">这是职位提供者的示例：</p>   <div class="code-block" data-lang="none">/ * NodePositionProvider在此处进行了扩展，以提供NodeSourcePosition。不必扩展默认提供程序之一。* /公共类MyCustomNodePositionProvider扩展了NodePositionProvider {private final Project myProject; public MyCustomNodePositionProvider（Project project）{myProject = project; } @Nullable（）@Override public node <> getNode（@NonNls字符串unitName，@NonNls字符串fileName，整数位置）{node <> node = ...（一些计算节点的代码）；返回节点； } public void init（）{//在调试器初始化时调用此方法PositionProvider.getInstance（myProject）.addProvider（this，NodeSourcePosition.class.getName（））; } public void dispose（）{//在调试器处置位置调用此方法PositionProvider.getInstance（myProject）.removeProvider（this）; } @Override public boolean accepts（AbstractDebugSession session）{//必须重写此方法，并且只接受由调试器创建的AbstractDebugSession实例，该实例由MyCustomDebugSession返回会话instance; }}</div>   <h4 id="traceinforesourceprovider">TraceInfoResourceProvider</h4>   <p id="a1c84bba">      <i id="ea2ea2d6">jetbrains.mps.generator.traceInfo.TraceInfoCache。TraceInfoResourceProvider</i>是一个接口，可用于定制如何为模块计算<i id="3068c055">trace.info</i>文件的路径。例如，以<i id="109ce970">BaseLanguage</i>编写的模块在类路径中具有<i id="8e689a50">trace.info</i>文件。为接口的实例提供了一个模块和一个要查找的资源名称（例如，如果调用者需要模型<i id="4859967c">jetbrains</i>的<i id="344b791c">trace.info</i>文件的位置， <i id="344b791c">则为</i> “ <i id="52f9cafb">jetbrains / mps / core / util / trace.info</i> ”） <i id="4859967c">。 mps.core.util</i> ），并且应返回<i id="2dee5e2a">java.net的实例<i id="2dee5e2a">。网址</i> 。使用<i id="b03e474a">addResourceProvider / removeResourceProvider</i>方法<i id="0d700ee4">TraceInfoResourceProviders</i>注册/注销在<i id="be31d25f">TraceInfoCache</i>实例。</i></p><i id="2dee5e2a">   <h3 id="finalremarks">结束语</h3>   <ol class="list _decimal"><li class="list__item" id="46f03fa9">调试器工具窗口中的变量树现在使用后台线程进行更新。API中的几种方法对此提供了支持：<ul class="list _ul"><li class="list__item" id="c462fdf4"><p>               <i id="c4fb3bc6">IValue.initSubvalues（）</i>方法，该方法在后台线程中调用，并应执行获取该值的子值所需的所有计算。<i id="b1bae12c">IValue.getSubvalues（）</i>方法仅应返回之前在<i id="3cf353f0">initSubvalues（）</i>方法中计算出的数据。</p></li><li class="list__item" id="09de4f4f"><p>调试器api使用<i id="5b2f7629">AbstractUiState.invokeEvaluation（）</i>方法来调用所有评估代码（即该代码，该代码在调试程序中进行一些计算；特别是，此方法用于调用<i id="4441d564">IValue.initSubvalues（）</i> ）。默认情况下，此方法仅将命令调度到线程池中的一个线程，但是对于某些自定义行为，该方法可以覆盖该命令。</p></li></ul>      </li></ol><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="debugger.html">调试器</a> <a class="navigation-links__next" href="using-mps-debugger.html">使用MPS调试</a></div></i></i></i></i></i></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>