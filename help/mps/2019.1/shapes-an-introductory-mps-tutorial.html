<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Shapes - an introductory MPS tutorial - Help | MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Shapes+-+an+introductory+MPS+tutorial.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Shapes+-+an+introductory+MPS+tutorial.html" id="shapes-an-introductory-mps-tutorial.xml">Shapes - an introductory MPS tutorial</h1>   <p id="269a9c18">If you're new to MPS and want to try it out quickly, this is the right tutorial for you. Within <b id="8ab0e044">two hours</b>&nbsp;you'll get a new language and functional code that uses that language. In the tutorial you'll start from scratch and by walking along a safe and a convenient path you'll design the core elements of a new language. We'll avoid advanced concepts, complicated constructs and dark corners in order to get to the finish line quickly. At the end you'll know what MPS is all about and what principles it builds on.</p>   <p id="dfb16a93">So, please fasten your seat belts. We're in for a fast ride.</p>   <aside class="tip sideblock" data-title="" rel="dfb16a93" id="9105295b">      <p id="0dd7b750">You may also <a href="http://www.youtube.com/watch?v=Mb1QzHx83M4" data-external="true" target="_blank" rel="noopener noreferrer">watch this tutorial on-line</a> as a screen-cast. Please check it out.</p>   </aside>         <ul data-skip-index="skip"><li class="list__item"><a href="#prerequisities">Prerequisities</a></li><li class="list__item"><a href="#goal">Goal</a></li><li class="list__item"><a href="#createanewproject">Create a new project</a></li><li class="list__item"><a href="#languagesandprogramsunderthehood">Languages and programs under the hood</a></li><li class="list__item"><a href="#graphicalshape">Graphical shape</a></li><li class="list__item"><a href="#circle">Circle</a></li><li class="list__item"><a href="#square">Square</a></li><li class="list__item"><a href="#canvas">Canvas</a></li><li class="list__item"><a href="#anearlytestride">An early test ride</a></li><li class="list__item"><a href="#editors">Editors</a></li><li class="list__item"><a href="#shape">Shape</a></li><li class="list__item"><a href="#circle">Circle</a></li><li class="list__item"><a href="#square">Square</a></li><li class="list__item"><a href="#canvas">Canvas</a></li><li class="list__item"><a href="#thesecondrun">The second run</a></li><li class="list__item"><a href="#coloring">Coloring</a></li><li class="list__item"><a href="#conceptforcolors">Concept for colors</a></li><li class="list__item"><a href="#pre-definedcolors">Pre-defined colors</a></li><li class="list__item"><a href="#createcolors">Create colors</a></li><li class="list__item"><a href="#thefirsttouchondependencies">The first touch on dependencies</a></li><li class="list__item"><a href="#conceptforcolorreference">Concept for color reference</a></li><li class="list__item"><a href="#updatingshape">Updating Shape</a></li><li class="list__item"><a href="#embeddingtheeditorcomponent">Embedding the editor component</a></li><li class="list__item"><a href="#athirdrun">A third run</a></li><li class="list__item"><a href="#generator">Generator</a></li><li class="list__item"><a href="#parametrizingthetemplate">Parametrizing the template</a></li><li class="list__item"><a href="#drawingshapes">Drawing shapes</a></li><li class="list__item"><a href="#generatingcircles">Generating circles</a></li><li class="list__item"><a href="#parametrization">Parametrization</a></li><li class="list__item"><a href="#reducingsquares">Reducing Squares</a></li><li class="list__item"><a href="#generatingcode">Generating code</a></li><li class="list__item"><a href="#amorerobustgenerationforsquares">A more robust generation for Squares</a></li><li class="list__item"><a href="#runningthecode">Running the code</a></li><li class="list__item"><a href="#analternativegenerator-generatingxml">An alternative generator - generating XML</a></li><li class="list__item"><a href="#whattodonext">What to do next</a></li></ul>      <h2 id="prerequisities">Prerequisities</h2>   <p id="af85ae8e">We'll assume you've gone through the initial parts of the <a href="fast-track-to-mps.html">Fast Track to MPS Tutorial</a>&nbsp;and so are familiar with the MPS environment, understand the concept of a language and a solution and can <a href="commanding-the-editor.html">command the MPS projectional editor</a>. If, not, please consider spending the first 30 minutes or so of your time to check it out. Especially these keyboard shortcuts are key to your survival:</p>   <ul class="list _ul"><li class="list__item" id="6041899b"><p>         <i id="0b394e23">Control + Space</i>&nbsp;- to complete an incomplete word or to turn an invalid (red) identifier into a correct (black) one</p></li><li class="list__item" id="31ed2664"><p>         <i id="25ad0cf6">Alt + Enter</i>&nbsp;- to display a pop-up menu with handy options applicable at the current editor position</p></li><li class="list__item" id="b301dff2"><p>         <i id="67c240ca">Control/Cmd + Up-Arrow/Down-Arrow</i>&nbsp;- Expand/shrink the region of selected text</p></li><li class="list__item" id="8265a7c2"><p>         <i id="97bc0ff5">Tab</i>&nbsp;- to navigate around editable elements in the editor</p></li><li class="list__item" id="4d2e9d2c"><p>         <i id="51fabb4f">Control/Cmd + Z</i>&nbsp;- Undo</p></li></ul>   <p id="4ddd0f93">We also assume you've installed MPS and you have it running in front of you. So now we can set off.</p>   <aside class="tip sideblock" data-title="" rel="4ddd0f93" id="5e12874a">      <p id="6018e63d">The result of this tutorial has been bundled as a sample project with MPS distributions. If you get stuck at any moment, feel free to open it from <i id="b4cda9c8">your home folder/MPSSamples</i> in MPS and look at the implementation. Try to avoid copy-pasting, though, since you wouldn't learn much that way. (BTW, the sample also contains additional features explained in the <a href="building-an-interpreter-cookbook.html">Building an interpreter cookbook</a>, which you can have some fun with later.)</p>   </aside>   <h2 id="goal">Goal</h2>   <p id="a3a46e84">You're going to implement a sample language for specifying graphical shapes. The language will allow its users to lay out visual two-dimensional shapes on a flat canvas. The definition will be then translated into a Java Swing application, which will visualize the layout on the screen.</p>         <figure><img alt="Tut1" title="Tut1" src="/help/img/idea/2019.1/Tut1.png" id="1940a187" width="373" height="69"></figure>      <br>       <figure><img alt="Tut2" title="Tut2" src="/help/img/idea/2019.1/Tut2.png" id="9969e067" width="500" height="451"></figure>      <p id="423e94c1">The language could enable non-programmers to build Java applications without any knowledge of Java, Swing or the 2D Graphics API. You, on the other hand, will play the role of a language designer, who will prepare such an easy-to-use language building on his or her knowledge of Java. You automate the work of a UI programmer by providing a language and a generator that cover some of the cases that a UI programmer currently has to solve manually.<br> If you are not versed in Java or Swing, do not worry too much too early. We assumed this possibility and made the tutorial to guide you carefully. You'll be able to pass easily, you'll see.</p>   <h2 id="createanewproject">Create a new project</h2>   <p id="703532f0">We'll start with a fresh project. On the welcome screen you click on <i id="3d828786">Create&nbsp;New Project</i> and then follow the wizard.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/welcome20173.png"><img alt="welcome20173" title="welcome20173" src="/help/img/idea/2019.1/welcome20173.png" id="8a5e8f1d" width="500" height="962"></a></figure>            <figure><a class="lightbox" href="/help/img/idea/2019.1/Sh2.png"><img alt="Sh2" title="Sh2" src="/help/img/idea/2019.1/Sh2.png" id="a30338ea" width="500" height="604"></a></figure>      <p id="9fc38f74">You'll get an empty project containing and empty <i id="ca3a6457">Language Definition</i>&nbsp;and an empty <i id="b55b0200">Solution</i>.</p>   <p id="4c41f3f8">      <figure><img alt="Sh4" title="Sh4" src="/help/img/idea/2019.1/Sh4.png" id="f7e0941b" width="983" height="627"></figure>      <br>       <i id="99487172">Solutions</i>&nbsp;hold your programs. To write these programs, you use languages, either defined in the same project or imported ones. In our tutorial will first define a language and than use it to write code that we can execute.</p>   <h2 id="languagesandprogramsunderthehood">Languages and programs under the hood</h2>   <p id="2e62d09a">First, here's a bit of background knowledge that you should know before going on. This is a piece of code that you will be able to create once you implement the Shapes language fully.<br>       <figure><img alt="Tut1" title="Tut1" src="/help/img/idea/2019.1/Tut1.png" id="fe5e4fd5" width="373" height="69"></figure>   </p>   <p id="254fac9b">The language that we're building must allow for painting definitions, which consist of individual commands, each on a separate line and each defining a single shape to draw. Our language needs to cover each such command with a <i id="5ad775e7">Concept</i>. <i id="03b7a859">Concepts</i>&nbsp;define the abstract syntax of a language, i.e. the set of allowed language logical constructs. A program then consists of <i id="16df549a">Abstract Syntax Trees</i>, which hold instances of these <i id="98baa2d1">Concepts</i>.</p>         <figure><img alt="Sh5" title="Sh5" src="/help/img/idea/2019.1/Sh5.png" id="7668a142" width="500" height="472"></figure>      <p id="5120c1e6">The AST of the short program above shows the abstract syntax - it consists of <i id="2b7124fc">Nodes</i>, each <i id="d8931900">Node</i>&nbsp;is an instance of a <i id="fd0c0df2">Concept</i>&nbsp;that the language defines. <i id="38f5da3d">Concepts</i> define properties, children and references and <i id="3912d9db">Nodes</i>&nbsp;then give the concrete values.</p>   <p id="72f0c8a5">To wrap up the little theory here:</p>   <ul class="list _ul"><li class="list__item" id="8a51415b"><p>         <i id="97aad149">Languages</i>&nbsp;consist of <i id="e142edef">Concepts</i>      </p></li><li class="list__item" id="2e29932e"><p>         <i id="004ed3b8">Concepts</i>&nbsp;define the logical (abstract) elements with their <i id="b566abed">properties</i>, <i id="9472a77b">children</i>&nbsp;and <i id="6f2de5bf">references</i>      </p></li><li class="list__item" id="e5b234ad"><p>         <i id="f4973214">Programs (solutions)</i>&nbsp;consist of ASTs, which consist of <i id="d295ba2c">Nodes</i>      </p></li><li class="list__item" id="e96e1d56"><p>         <i id="a43f6143">Nodes</i>&nbsp;are instances of <i id="ea9fdaa0">Concepts</i>&nbsp;giving concrete values to&nbsp;<i id="0784a2a7">properties</i>,&nbsp;<i id="b971e2bf">children</i>&nbsp;and&nbsp;<i id="c71a06ee">references</i>&nbsp;of their&nbsp;<i id="c7d6caad">Concepts</i>      </p></li></ul>   <h2 id="graphicalshape">Graphical shape</h2>   <p id="7fba6069">Our language is going to be pretty straightforward. We'll need only a few concepts:</p>   <ul class="list _ul"><li class="list__item" id="249c7b22"><p>         <i id="fa62f1fd">Canvas</i>&nbsp;- to define the top-most node representing the whole <b id="07745b37">Painting definition</b>&nbsp;and holding all <i id="0869a415">Shapes</i>      </p></li><li class="list__item" id="d0b6a0a8"><p>         <i id="1e764f73">Shape</i>&nbsp;- representing a command to draw a shape on the <i id="8bf7c2ec">Canvas</i>, it will serve as a common <i id="05cd6a7a">super-concept</i>&nbsp;to all concrete shapes, such as a circle or a square</p></li><li class="list__item" id="931dafa7"><p>         <i id="1f36a82e">Circle</i>&nbsp;- representing a command to draw a circle</p></li><li class="list__item" id="5f7295c1"><p>         <i id="43d943db">Square</i>&nbsp;- representing a command to draw a square</p></li><li class="list__item" id="945ee749"><p>         <i id="04725109">ColorReference</i>&nbsp;- representing one of several pre-defined Colors defined in <i id="38020f88">java.awt.Color</i>      </p></li></ul>   <p id="623bd004">We'll start our practical exercise with the <i id="579bc2db">Shape</i>&nbsp;concept. Just like in object-oriented programming, <i id="8594e27f">Concepts</i>&nbsp;can extends one another and thus inherit the capabilities of their <i id="bf06cae4">super-concept</i>. The <i id="76b8bae5">Shape</i>&nbsp;concept will serve as such a common <i id="90c61ca9">super-concept</i>, holding the <i id="c974e081">color</i>&nbsp;property, since all shapes in our language will need the <i id="a4c61eca">color</i>&nbsp;property, so we can conveniently inherit it.</p>         <figure><img alt="Sh6" title="Sh6" src="/help/img/idea/2019.1/Sh6.png" id="45e8130a" width="987" height="627"></figure>      <p id="004ce16c">Right-click on the <i id="10972c08">Structure</i>&nbsp;aspect of the language and create a new <i id="97796fd2">Concept</i>. You'll get a new <i id="e8aa0c8d">Concept</i>&nbsp;definition open in the editor.</p>         <figure><img alt="Sh7" title="Sh7" src="/help/img/idea/2019.1/Sh7.png" id="a7262abf" width="986" height="625"></figure>      <p id="629ba944">We should give the <i id="286555ff">Concept</i>&nbsp;a descriptive name, <i id="818d88d3">Shape</i>&nbsp;in our case will work fine.<br>So just type&nbsp;<b id="7a747596">Shape</b> where MPS indicates a missing name - the red&nbsp;<i id="c96202bc">&lt;no name&gt;</i> field.</p>         <figure><img alt="Sh8" title="Sh8" src="/help/img/idea/2019.1/Sh8.png" id="87ebdc33" width="986" height="624"></figure>      <p id="04253a6b">We created the <i id="c6b80b40">Shape</i>&nbsp;concept as a common <i id="9702dc6a">super-concept</i>&nbsp;for all shapes in our language and by itself <i id="a6faa751">Shape</i>&nbsp;will not be used directly in ASTs. We'll mark <i id="ff938ce0">Shape</i>&nbsp;<b id="47fa2c54">abstract</b>&nbsp;to indicate explicitly that no instances (<i id="c41a79b2">nodes</i>) of <i id="637579ac">Shape</i>&nbsp;can be created.</p>   <aside class="tip sideblock" data-title="" rel="04253a6b" id="b0100eaa">      <p id="064f3d96">If you misspelled the name of the concept and decide to change it, just go ahead and change it. Renaming things in MPS is just as easy.</p>   </aside>   <p id="9a4e0596">It is the time to practice the <i id="f7b3474e">Alt + Enter</i>&nbsp;keyboard shortcut now.</p>   <p id="58efb2ba">Can you see the light-bulb symbol on the first line of the concept declaration? (You may need to move your cursor to the first line for the light-bulb to show up. It is a bit shy.) The light-bulb is hiding a contextual menu with tips of what you can possibly do to your code at the cursor position.&nbsp;<i id="8ce48030">Alt + Enter</i> gives you access to the light-bulb menu (we call it&nbsp;<b id="7c3f68a6">Intentions menu</b>) from the keyboard.</p>   <p id="3ccfcdb4">      <figure><img alt="Sh17" title="Sh17" src="/help/img/idea/2019.1/Sh17.png" id="a3af7452" width="421" height="245"></figure>       <figure><img alt="Sh18" title="Sh18" src="/help/img/idea/2019.1/Sh18.png" id="ae31970c" width="409" height="243"></figure>      <br> When positioned on the name of the <i id="269bbfad">Concept</i>, the <i id="aac7a13b">Alt + Enter</i>&nbsp;keyboard shortcut brings up a contextual pop-up menu, which gives you the option to apply the "Make Abstract" intention to the <i id="574a1809">Concept</i>. Once you choose that option, the concept is marked as <b id="f594938f">abstract</b>. Now we could add properties, children and references that should be shared by all sub-concepts of <i id="1c4bde91">Shape</i>, but we will leave that for later to make our learning curve flat.</p>   <p id="0def103c">That's our first concept! Hurray! Time to add another one. How about <i id="18642fe6">Circle</i>? Sure, by right-clicking on the <i id="9671f118">Structure</i>&nbsp;aspect we create another <i id="962df037">Concept</i>&nbsp;and give it a name - <i id="84fe105a">Circle</i>.</p>   <h2 id="circle">Circle</h2>   <p id="07067e02">Following the same steps, you need to right-click on the <i id="f2d81aed">Structure</i>&nbsp;aspect of the language and add a new concept. Name it <i id="d87d33e1">Circle</i>.</p>         <figure><img alt="Sh9" title="Sh9" src="/help/img/idea/2019.1/Sh9.png" id="c0a239e1" width="985" height="624"></figure>      <p id="2a2bbb66">Circles should inherit capabilities from <i id="e6449564">Shape</i>, so we need to indicate than in the <b id="7ebe205a">extends</b>&nbsp;clause. Position the cursor at the beginning of the cell holding the "BaseConcept" text and hit the most useful keyboard shortcut in MPS - <i id="13d9bdbd">Control + Space</i>&nbsp;- to invoke code completion.&nbsp;MPS will show you a list of options applicable as replacements for the "BaseConcept" text. We need to select&nbsp;<i id="39b5524e">Shape</i>&nbsp;here to make&nbsp;<i id="d0e529ea">Circle</i>&nbsp;extend&nbsp;<i id="316120c9">Shape</i>.<br>       <figure><img alt="Sh10" title="Sh10" src="/help/img/idea/2019.1/Sh10.png" id="744533b2" width="988" height="624"></figure>   </p>   <p id="97ce100f">If you do not see&nbsp;<i id="6b04386b">Shape</i> in the completion menu, it is because your cursor in not on the first position of the word.</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 10 42 17" title="Sni mek obrazovky 2018 12 06 v 10 42 17" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-10-42-17.png" id="b1a3adcd" width="500" height="496"></figure>      <p id="19c183ff">The characters to the left of the cursor are used as a filter to show only options that match the these characters. The further to the right your cursor goes, the fewer options will be displayed in the completion menu.</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 10 41 46" title="Sni mek obrazovky 2018 12 06 v 10 41 46" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-10-41-46.png" id="cf2bb9cd" width="500" height="318"></figure>      <p id="3f18bb6d">You have to move your cursor with the left arrow or, if you press&nbsp;<i id="aa29a0b1">Control + Space</i> again, MPS will move the cursor to the very left of the current word for you.</p>         <br>       <figure><img alt="Sh11" title="Sh11" src="/help/img/idea/2019.1/Sh11.png" id="6a7042ac" width="986" height="627"></figure>      <p id="f06b9627">So this is our first concrete concept that will be used by users of our language. To give the concept a nice textual representation in code-completion dialogs and enable MPS to be smart about creating an instance of <i id="935900bd">Circle</i>&nbsp;whenever the user types "circle", you need to give the concept an alias 'circle'.</p>         <figure><img alt="Sh12" title="Sh12" src="/help/img/idea/2019.1/Sh12.png" id="87a0373b" width="410" height="285"></figure>      <aside class="tip sideblock" data-title="" rel="211b33d9" id="fbff4abe">      <p id="543b6c7c">Notice the <b id="b1792d1e">Tab</b> key can help you navigate around editable elements in the editor. Use the <b id="59b2d55f">Tab</b> key frequently.</p>   </aside>   <p id="eb82ab67">Each circle needs to specify its coordinates on the screen and its radius. We'll create properties that will hold these integer values. Navigate to the <b id="70ba5f8c">properties</b>&nbsp;section, place the cursor on the "&lt;&lt; ... &gt;&gt;" symbol that represents an empty collection of values and press <i id="b556c533">Enter</i>. This will create an empty property.</p>   <p id="a6c9645b">      <figure><img alt="Sh13" title="Sh13" src="/help/img/idea/2019.1/Sh13.png" id="f11d32d1" width="431" height="308"></figure>       <figure><img alt="Sh14" title="Sh14" src="/help/img/idea/2019.1/Sh14.png" id="a922c9ca" width="419" height="299"></figure>      <br> You give the property a name "x", then hit <b id="9215d389">Tab</b> and provide the type of the property - "integer". While typing "integer" you may hit the <i id="f1eb484c">Control + Space</i>&nbsp;keyboard shortcut to have the name of the type completed by MPS.</p>   <p id="f104ad65">      <figure><img alt="Sh15" title="Sh15" src="/help/img/idea/2019.1/Sh15.png" id="8bca9acd" width="431" height="289"></figure>       <figure><img alt="Sh16" title="Sh16" src="/help/img/idea/2019.1/Sh16.png" id="7d3a7e31" width="423" height="319"></figure>      <br> Then add properties for "Y" and "radius" and you'll be done with your first concrete concept.</p>   <h2 id="square">Square</h2>   <p id="1f747cba">Now you should try yourself to create a concept for square. Simply repeat the steps we did for <i id="9ac8408e">Circle</i>, just create different properties - <i id="507852d3">upperLeftX</i> and&nbsp;<i id="77ac9412">upperLeftY</i>&nbsp;to hold the coordinates of the upper-left corner followed by <i id="1a84206e">size</i>&nbsp;to specify the length of the sides of the square. Ultimately you should get to this:</p>         <figure><img alt="Sh19" title="Sh19" src="/help/img/idea/2019.1/Sh19.png" id="22bbd9fe" width="985" height="627"></figure>      <p id="a755a20c">Do not forget to extend the&nbsp;<i id="df93f9ef">Shape</i> concept on the first line. You may have noticed that while the completion menu (<i id="7f6cefe6">Control + Space</i>) is displayed, you can still type characters and they will be used to filter out the entries available in the completion menu.</p>   <h2 id="canvas">Canvas</h2>   <p id="620c3838">Having created two shapes we can move on to defining a concept to hold them all in a painting. We'll create another concept, called <i id="aace81ad">Canvas</i>, that will represent a scene composed of shapes. The user will be able to create multiple scenes (<i id="4964bec7">Canvasses</i>), which will be mutually independent and will not share shapes. Each <i id="2a612ed7">Canvas</i>&nbsp;will hold a&nbsp;name and a list of shapes that it contains.</p>   <p id="bcb34fa1">So yet again right-click on the <i id="7d31707b">Structure</i>&nbsp;aspect of the language to create a new concept and give it a name <i id="5704a4ae">Canvas</i>.</p>         <figure><img alt="Sh20" title="Sh20" src="/help/img/idea/2019.1/Sh20.png" id="b57576f3" width="987" height="625"></figure>      <aside class="tip sideblock" data-title="" rel="c9b39f5f" id="2f621327">      <p id="257a1cbe">Notice that unlike&nbsp;<i id="a921bb52">Circle</i>&nbsp;or&nbsp;<i id="d4782417">Square</i>,&nbsp;<i id="5add2b4f">Canvas</i>&nbsp;<b id="c6194654">does not extend</b>&nbsp;<i id="3878b795">Shape</i>, but&nbsp;<i id="c4645fe3">BaseConcept</i>.&nbsp;<i id="eb9ec618">Canvas</i>&nbsp;is not supposed to be drawn nor placed on other&nbsp;<i id="89b5a638">Canvasses</i>, so it should not extend&nbsp;<i id="d8c6e917">Shape</i>.</p>   </aside>   <p id="0debf6ba">Navigate (using <b id="dfcc16da">Tab</b>) to the "&lt;none&gt;" text in the <b id="523e6b81">implements</b>&nbsp;section and specify <i id="d14d34c1">INamedConcept</i>&nbsp;(either type it in or use <i id="ea567679">Control + Space</i>). <i id="ea18aa72">INamedConcept</i> is a <i id="534e5732">Concept Interface</i>&nbsp;that <i id="7840acf1">Canvas</i>&nbsp;will now implement. <i id="cdc20e04">Concept Interfaces</i>, just like <i id="860798de">Concepts</i>, add new capabilities to <i id="4a3aca67">Concepts</i>&nbsp;that implement them. <i id="e18affb2">INamedConcept</i>&nbsp;in our case enriches <i id="efb4c32c">Canvas</i>&nbsp;with the <i id="987c00e9">name</i>&nbsp;property, so <i id="ec01892f">Canvas</i>&nbsp;instances (called&nbsp;<i id="193705a3">Nodes</i>) will have a <i id="bdca1fdb">name</i>&nbsp;property so the user can easily distinguish between them.</p>   <p id="2f4d9e83">      <figure><a class="lightbox" href="/help/img/idea/2019.1/Sh21.png"><img alt="Sh21" title="Sh21" src="/help/img/idea/2019.1/Sh21.png" id="28d49c87" width="500" height="267"></a></figure>       <figure><a class="lightbox" href="/help/img/idea/2019.1/Sh23.png"><img alt="Sh23" title="Sh23" src="/help/img/idea/2019.1/Sh23.png" id="f4e97ff7" width="500" height="255"></a></figure>      <br> Since <i id="6b3439a5">Canvas</i>&nbsp;will represent the painting scene and will by itself not be part of any other concept (it will not have any parent in the model), we mark it that&nbsp;<b id="f7d40bab">instances can be root</b>. This will allow <i id="3c99e205">Canvas</i>&nbsp;instances to be the roots of ASTs.</p>   <p id="0b5d8e8d">To indicate that <i id="cd988e35">Canvasses</i>&nbsp;may hold <i id="9e2e3873">Shapes</i>, we'll create a child collection of <b id="4681b10b">shapes</b>. Again, hit <i id="81557cfa">Enter</i>&nbsp;in the "&lt;&lt; ... &gt;&gt;" cell of the <b id="addb66cd">children</b>&nbsp;section, type in the name of the child and the type of nodes it may hold. Do not forget about the*&nbsp;*<i id="b4080cf3">Control + Space</i>&nbsp;key shortcut to bring up the code-completion dialog.</p>         <figure><img alt="Sh24" title="Sh24" src="/help/img/idea/2019.1/Sh24.png" id="f3f122d3" width="426" height="257"></figure>       <figure><img alt="Sh25" title="Sh25" src="/help/img/idea/2019.1/Sh25.png" id="83d3accd" width="499" height="307"></figure>      <p id="18ef857c">You should end up with a concepts definition like this:<br>       <figure><img alt="Sh26" title="Sh26" src="/help/img/idea/2019.1/Sh26.png" id="fd119b69" width="447" height="274"></figure>   </p>   <p id="f58977db">Now we've created enough concepts to have a minimalistic language ready for use. Let's give it a try.</p>   <h2 id="anearlytestride">An early test ride</h2>   <p id="ac524cef">We need to build the language before we can use it. In the future, after you've made a change to your language definition, please remember to repeat the process of "Rebuild" in so that the change could take effect. Right-click on the top-most node (the very most root, representing the whole project, <b id="2fc4b13c">including the Language and the Solution</b>) in the <i id="520c0f42">Project View</i>&nbsp;and choose <b id="a558049a">Rebuild Project</b>.</p>         <figure><img alt="Sh35" title="Sh35" src="/help/img/idea/2019.1/Sh35.png" id="c0a0ba72" width="986" height="626"></figure>      <p id="24103727">Once built, the language will be available for use in the model inside the sandbox&nbsp;<i id="22da7e78">Solution</i>. Simply create a new <i id="200ee45c">Canvas</i>&nbsp;by right-clicking on the model and choosing the root concept to instantiate. Notice, the root concepts are those that show up in this menu and can be instantiated at the top-most level within a model.<br>       <figure><img alt="Sh27" title="Sh27" src="/help/img/idea/2019.1/Sh27.png" id="f4b34570" width="711" height="271"></figure>   </p>   <p id="4acf3296">Now give the <i id="4e0ecbe0">Canvas</i>&nbsp;instance a name and&nbsp;you've got your first painting. You can start using the concepts defined in the language to place visual shapes on the canvas.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Sh28.png"><img alt="Sh28" title="Sh28" src="/help/img/idea/2019.1/Sh28.png" id="a12ffa33" width="900" height="1250"></a></figure>      <br>       <figure><img alt="Sh29" title="Sh29" src="/help/img/idea/2019.1/Sh29.png" id="859a4b3a" width="499" height="167"></figure>      <aside class="tip sideblock" data-title="" rel="69b5e721" id="eccd340d">      <p id="0ce4cff3">The editing experience of our language as well as the layout is at this stage using some defaults, which we will change soon to get more customized look of the code.</p>   </aside>   <p id="3dc18a03">Again, <i id="a6cfaa5d">Control + Space</i> is the&nbsp;&nbsp;keyboard shortcut to use heavily here. Use it each time you hesitate what to time. Notice that the code-completion dialog offers us the two types of shapes that we have created in the language.<br>       <figure><img alt="Sh30" title="Sh30" src="/help/img/idea/2019.1/Sh30.png" id="ecaf0f17" width="520" height="229"></figure>   </p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Sh31.png"><img alt="Sh31" title="Sh31" src="/help/img/idea/2019.1/Sh31.png" id="c32a661f" width="500" height="456"></a></figure>            <figure><img alt="Sh32" title="Sh32" src="/help/img/idea/2019.1/Sh32.png" id="6b7d4888" width="509" height="219"></figure>      <p id="8f0b3fd8">      <br> You can insert additional shapes by pressing <i id="8fa79c67">Enter</i>&nbsp;at the end of the last shape in the list of shapes, which in our case is the closing "}" symbol for the "circle". Notice that&nbsp;<i id="ed29fd6f">Control + Space</i> can spare you typing the names of the shapes.</p>         <figure><img alt="Sh33" title="Sh33" src="/help/img/idea/2019.1/Sh33.png" id="92185d9c" width="526" height="258"></figure>       <figure><img alt="Sh34" title="Sh34" src="/help/img/idea/2019.1/Sh34.png" id="b27902e7" width="491" height="291"></figure>      <p id="7213a4fe">Cool! I hope you're celebrating your success properly. Now, how about tuning those editors to make the code look better on the screen?</p>   <h2 id="editors">Editors</h2>   <p id="caa8daa9">MPS uses a projectional editor. You might have noticed that already by feeling that the editor behaves slightly differently from what you would have expected. Unlike text-based languages, MPS never represents code as plain text. Instead, code in MPS means AST - Abstract Syntax Tree. Always.</p>   <p id="046f6b58">This comes with huge benefits for language design, language composability and non-parseable notations, which you can read more about in the MPS documentation.</p>   <p id="c7b9fdcc">Here we should focus on the editing aspect of projectional languages. Since plain-text editors cannot represent ASTs reliably and since editing ASTs directly would be highly inconvenient, projectional languages have to provide editors for all <i id="8a224eca">Concepts</i>&nbsp;that are part of the language. Sometimes even multiple alternative editors for a single <i id="a9ea8a47">Concept</i>, but that's not our goal here.&nbsp;MPS can do a good job in many cases to provide a default editor for <i id="a4e4a220">Concepts</i>&nbsp;that do not have one. This is very nice for language prototyping. For convenient use by an end-user we, however, should spend some time preparing an explicit editor.</p>   <h3 id="shape">Shape</h3>   <p id="46e68de2">The <i id="280ab78c">Shape</i>&nbsp;concept does not need an editor, since it is an <b id="3f6fe1be">abstract</b>&nbsp;concept. So we will leave this one untouched.</p>   <h3 id="circle">Circle</h3>   <p id="36a144c8">For <i id="f6b930ea">Circle</i>&nbsp;we could create an editor that nicely places all necessary properties on a single line. We'll open the <i id="46af620b">Circle</i>&nbsp;concept in the editor, click the green '+' button in the lower left corner and pick <i id="06d3d2ee">Editor -&gt; Concept Editor</i>.</p>   <p id="7ef7614a">      <figure><img alt="Sh9a" title="Sh9a" src="/help/img/idea/2019.1/Sh9a.png" id="5844b504" width="985" height="624"></figure>      <br>       <figure><img alt="Sh36" title="Sh36" src="/help/img/idea/2019.1/Sh36.png" id="9fad06ab" width="342" height="144"></figure>      <br> You'll get an empty editor definition for the <i id="2d309e2d">Circle</i>&nbsp;concept. Remember, <i id="513eb542">Control + Space</i>&nbsp;will be needed heavily to edit things here.</p>         <figure><img alt="Sh37" title="Sh37" src="/help/img/idea/2019.1/Sh37.png" id="038bbe99" width="544" height="161"></figure>      <p id="3df54d2b">The editor for a concept in MPS consists of visual cells, each of which represents some piece of information belonging to the underlying concept. As nodes are composed hierarchically in an AST, so are their editors composed on the screen with sub-nodes' editors nested inside their ancestors' ones.</p>   <p id="ead27eb1">For <i id="121cd713">Circle</i>, we'd like to show value of all the properties (<i id="f681f9f2">x</i>, <i id="66e23dd0">y</i>, <i id="8250409e">radius</i>) plus some arbitrary text around them, all on a single line.<br> So first we'll choose a layout for these cells - <i id="0631674e">indent layout</i>&nbsp;will work just fine here. So hit <i id="89aef7ae">Control + Space</i>&nbsp;in the red cell and pick it up from the list. You may speed the search up by typing a square bracket followed by a minus symbol.<br>       <figure><img alt="Sh38" title="Sh38" src="/help/img/idea/2019.1/Sh38.png" id="9a8f4244" width="862" height="285"></figure>   </p>   <p id="e8801cfa">Now type "circle" to enter constant text that will be placed at the beginning of the line.<br>       <figure><img alt="Sh39" title="Sh39" src="/help/img/idea/2019.1/Sh39.png" id="2e941080" width="347" height="149"></figure>   </p>   <p id="19940efd">Hit <i id="3946ee85">Enter</i>&nbsp;to create a new cell. Type "x:" to mark that the following cell contains the value of the <i id="1e0c90a3">x</i>&nbsp;property.</p>         <figure><img alt="Sh40" title="Sh40" src="/help/img/idea/2019.1/Sh40.png" id="c3af0616" width="382" height="150"></figure>       <figure><img alt="Sh41" title="Sh41" src="/help/img/idea/2019.1/Sh41.png" id="d4440d45" width="388" height="157"></figure>      <p id="80e34389">Hit <i id="ae0515ca">Enter</i> again to create a new cell. Remember to press&nbsp;<i id="0c1fe344">Enter</i> first each time you want to add a new cell and then select the kind of cell to insert from the completion menu (<i id="7d4196f3">Control + Space</i>).</p>   <p id="54ada04a">Now you have to pick the <i id="632a6394">x</i>&nbsp;property from the code-completion menu to bind the cell to the right property.&nbsp;<b id="62944ca3">Do not just type&nbsp;{x}</b>, use&nbsp;<i id="8aa5dbf0">Control + Space</i> to display the completion menu and select the <i id="c517de19">x</i> property from the menu:&nbsp;</p>         <figure><img alt="Sh42" title="Sh42" src="/help/img/idea/2019.1/Sh42.png" id="0dfd9361" width="511" height="206"></figure>      <p id="a7c4759a">Now you can continue on your own to insert cells holding constant text and well as values of the <i id="3de9455d">y</i>&nbsp;and <i id="bb63746a">radius</i>&nbsp;properties. Remember, <i id="ed4ff493">Enter</i>&nbsp;will insert new cells, <i id="11542f75">Control + Space</i>&nbsp;will bring up the code-completion menu.&nbsp;You should end up with an editor like this.</p>         <figure><img alt="Sh43" title="Sh43" src="/help/img/idea/2019.1/Sh43.png" id="bfbbcb99" width="506" height="155"></figure>      <h3 id="square">Square</h3>   <p id="47bdcd18">      <i id="fc084d37">Square</i> also needs an editor. Open the <i id="63d3e174">Square</i>&nbsp;concept in the editor, hit the '+' symbol in the lower left corner and create a new <i id="9e448318">Concept Editor</i>. Following the instructions in the previous section, enter the editor definition as follows:</p>   <p id="d206b995">      <figure><img alt="Sh44" title="Sh44" src="/help/img/idea/2019.1/Sh44.png" id="cbee7c2a" width="615" height="155"></figure>      <br> You can certainly do this on your own.</p>   <h3 id="canvas">Canvas</h3>   <p id="56e3a956">The editor for the&nbsp;<i id="f0037cef">Canvas</i>&nbsp;concept will be slightly different, since it holds a collection of shapes that all need to be given some space on the screen. <i id="1a3f6ca1">Canvas</i> thus spreads across multiple lines, each line will show one shape from the <i id="21f927ca">Canvas</i>' collection of shapes. You, however, start in the same way as before, open the <i id="87acb3f3">Canvas</i>&nbsp;concept,&nbsp;hit the '+' symbol to create a new <i id="a43cd8f5">Concept Editor</i>, insert an <i id="cdb19e58">indent layout</i>&nbsp;and enter some text to get the following:</p>   <p id="49286d01">      <figure><img alt="Sh45" title="Sh45" src="/help/img/idea/2019.1/Sh45.png" id="a793872c" width="579" height="143"></figure>      <br> Now bind the red cell to the <i id="976c5226">name</i>&nbsp;property. Since the property is inherited from the <i id="e5ccfc87">INamedConcept</i> concept interface, it will be&nbsp;further down in the completion menu (<i id="34278dd6">Control + Space)</i>, but it is surely there.</p>         <figure><img alt="Sh46" title="Sh46" src="/help/img/idea/2019.1/Sh46.png" id="09d06bb6" width="467" height="134"></figure>      <p id="69dc229a">You ensure that you have inserted the&nbsp;<i id="2913c71b">name</i> property correctly if you can see the curly braces wrapping it. (Beware, you are not supposed to insert these curly braces yourself, they are added by MPS for all property cells.)<br> The following cell will hold a collection of shapes that have been added to the <i id="bd70a2d9">Canvas</i>. Note how we compose editors here - <i id="880f8de0">Canvas</i>&nbsp;only marks an area, in which individual shapes should be edited, and leaves that up to the shapes how they use that area.<br> Since the shapes should be organized vertically, each on a single line, you should pick <i id="46063353">vertical collection layout</i>&nbsp;from the completion menu.</p>         <figure><img alt="Sh47" title="Sh47" src="/help/img/idea/2019.1/Sh47.png" id="692d463f" width="1040" height="291"></figure>      <p id="2a5e636a">Be careful here. If you have selected a different layout than <b id="404c1d64">vertical</b>, the shapes will not be nicely organised one below another, but perhaps one next to another on the same line, which, while quite innovative, may not be the most intuitive way to use your language..</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 14 51 05" title="Sni mek obrazovky 2018 12 06 v 14 51 05" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-14-51-05.png" id="2e888348" width="500" height="294"></figure>      <p id="b5664f6e">You need to bind the red cell to the <i id="3bf2ca29">shapes</i>&nbsp;child collection of <i id="1fed8684">Canvas</i>.</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 14 51 26" title="Sni mek obrazovky 2018 12 06 v 14 51 26" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-14-51-26.png" id="5935d9cb" width="500" height="292"></figure>      <p id="f127a689">      <br>      <figure><img alt="Sni mek obrazovky 2018 12 06 v 14 51 50" title="Sni mek obrazovky 2018 12 06 v 14 51 50" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-14-51-50.png" id="353168bd" width="500" height="294"></figure>      <br> Now, to place the collection below the name of the <i id="4899cdc4">Canvas</i>, you should use the <i id="f2455ad3">Alt + Enter</i>&nbsp;shortcut (or the <b id="e437d744">light-bulb</b> symbol) the bring up the <b id="adfa09b5">intention</b> pop up menu and pick "Add On New Line".</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 14 52 08" title="Sni mek obrazovky 2018 12 06 v 14 52 08" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-14-52-08.png" id="4ca4f0ea" width="500" height="334"></figure>      <p id="29d2cd65">If you accidentally press "Add New Line", undo that action with&nbsp;<i id="dfe12935">Control/Cmd + Z</i>      <i id="39863095">.</i>      <br> You'll get the final editor definition:</p>         <figure><img alt="Sni mek obrazovky 2018 12 06 v 14 52 24" title="Sni mek obrazovky 2018 12 06 v 14 52 24" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-06-v-14-52-24.png" id="3ab89fe0" width="500" height="420"></figure>      <p id="260f6e86">If you version looks different, there may be several reasons:</p>   <ul class="list _ul"><li class="list__item" id="7c801ebd"><p>You inserted the&nbsp;<i id="ba1293b8">name</i> property from the completion menu. If you only typed "name", the cell is most likely not bound to the&nbsp;<i id="7a30b26e">name</i> property and will only be ever showing the text "name" when used.</p></li><li class="list__item" id="1c292a65"><p>You set the "Add On New Line" intention. If you accidentally chose "Add New Line" instead, the&nbsp;<i id="273e4b1a">shapes</i> cell will not be drawn below the "Painting ..." first line, but next to it.</p></li><li class="list__item" id="ea0c68c1"><p>If you set the "Add On New Line" property on a different cell that the&nbsp;<i id="5cb33b77">shapes</i> cell, the layout will also look different from the expected one.</p></li><li class="list__item" id="5380e55b"><p>You chose a different layout for the <i id="3d7f553a">shapes</i> collection than vertical. Different layouts use different symbols. Vertical uses "(&gt;", while "(-" and "(/" belong to the indent and horizontal layouts, respectively.</p></li></ul>   <p id="2b7a7f99">In all these cases repetitive&nbsp;<b id="a7fae890">Undo</b>       <i id="6329b7af">(Control/Cmd + Z)</i> will help.</p>   <h2 id="thesecondrun">The second run</h2>   <p id="2c19ae08">Now you can rebuild the project again (right-click on the very top node in the <i id="14525121">Project View</i>) and look at the sandbox code in &nbsp;<i id="70959808">MyDrawing</i>.</p>   <p id="752774e8">      <figure><img alt="Sh53" title="Sh53" src="/help/img/idea/2019.1/Sh53.png" id="2c4dee7d" width="663" height="224"></figure>      <br> Look how the code layout changed:</p>         <figure><img alt="Sh54" title="Sh54" src="/help/img/idea/2019.1/Sh54.png" id="f0e195be" width="588" height="113"></figure>      <p id="5b83392a">It is the same code (AST), but it is organized on the screen differently. While previously it was an ugly tree-like text with lots of curly braces, now the code reflects the editor definition that we provided to MPS.</p>   <p id="71907f0e">If your view is different, revisit the three editors. Given that they are fairly small, feel free to delete then and do them over, if needed. You can delete a whole editor definition if you locate it in the <b id="02b4fb6e">Project view</b> under the&nbsp;<b id="2998159e">Editor</b> aspect model and press&nbsp;<i id="3c3ec597">Delete</i> or right-click and choose delete in the context menu. Alternatively, you may keep pressing the&nbsp;<i id="51934a97">Delete</i> and&nbsp;<i id="2d8000b2">Backspace</i> buttons inside the editor definition until you remove all the suspiciously looking code.</p>   <h2 id="coloring">Coloring</h2>   <p id="12ef4b1a">Now we should come back to <i id="1ae796d8">Shape</i>&nbsp;and add support for colors. Since both <i id="e1c96804">Circle</i>&nbsp;and <i id="3917fb73">Square</i>&nbsp;extend <i id="2ca48dd6">Shape</i>, they will both inherit the&nbsp;color.</p>   <aside class="tip sideblock" data-title="" rel="12ef4b1a" id="b172319a">      <p id="950aa5c1">If for any reason you need to jump ahead to the generator, now is a good time to do so. You'll just need to ignore all the places where we refer to colors in the generator chapter.</p>   </aside>   <p id="67aa0332">Since we would like to allow the users of our language to pick the color for the shape from a list of pre-defined colors, we can't just use a textual property to hold the color value. Instead we'll add a reference to <i id="f1b409fe">Shape</i>&nbsp;and have this reference point to one of the pre-defined color constants. Let's start with creating such constants that will represent pre-defined colors.</p>   <h3 id="conceptforcolors">Concept for colors</h3>   <p id="18ebf9ee">One way would be to use MPS enums to define the colors. This would, however, not allow users to define their own colors. All the colors would be defined in the enum that would be a part of the Shapes language. Instead, we will use full a blown concept for colors and nodes of that concept will define the individual colors. These color nodes can be defined as part of the language (inside so called accessory models) or directly in user models next to instances of the&nbsp;<i id="af4b67d7">Canvas</i> concept.</p>   <p id="0f77eb9d">First we're going to create a concept that will represent a color constant. We'll call it&nbsp;<i id="e6d50245">Color</i> and it will be rootable, so that we can place it inside models:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx1.png"><img alt="Shx1" title="Shx1" src="/help/img/idea/2019.1/Shx1.png" id="7c2f34b5" width="900" height="1248"></a></figure>      <p id="0ad20b83">An editor is also needed:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx2.png"><img alt="Shx2" title="Shx2" src="/help/img/idea/2019.1/Shx2.png" id="4422b5a3" width="900" height="1246"></a></figure>      <h3 id="pre-definedcolors">Pre-defined colors</h3>   <p id="20fff9a6">Now, <b id="a7099b3c">rebuild</b> your project. The <i id="3251672b">Color</i> concept that we have just added needs to be compiled, so that we can use it to create some colors. We need to provide concrete nodes of the&nbsp;<i id="c019ef35">Color</i> concept, which will represent the individual color constants and which the user of our language will be able to refer to from their&nbsp;<i id="cd02a5c6">Canvasses</i>. We will utilize&nbsp;<b id="713ef46c">Accessory models</b> for this.&nbsp;<b id="67767f3e">Accessory models</b> are models inside a language definition that hold arbitrary nodes, which become part of the language and are visible to the language users.</p>   <p id="0b930a35">So first, we need to create an&nbsp;<b id="6e6fdcb0">Accessory model</b>&nbsp;in the language:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx7.png"><img alt="Shx7" title="Shx7" src="/help/img/idea/2019.1/Shx7.png" id="135fda03" width="500" height="660"></a></figure>      <p id="fdda3d3e">The model demands a name. Please make sure the&nbsp;<b id="7993fd74">stereotype</b> box is empty, if it is not disabled by MPS:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx8.png"><img alt="Shx8" title="Shx8" src="/help/img/idea/2019.1/Shx8.png" id="3be2167a" width="500" height="470"></a></figure>      <p id="cdde07ff">The&nbsp;<b id="2d291dff">Shapes</b> language, which declares the&nbsp;<i id="d78c5daf">Color</i> concept, is the only language that we need imported in the accessory model:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx10.png"><img alt="Shx10" title="Shx10" src="/help/img/idea/2019.1/Shx10.png" id="64da3ff8" width="300" height="856"></a></figure>      <p id="6927e6ea">Switch to the&nbsp;<b id="d93dbb68">Used Languages</b> tab. It is either empty or contains a devkit that we can leave in the list. Click the&nbsp;<b id="bf8f10db">plus</b> symbol and select the&nbsp;<i id="ad66e0d4">Shapes</i> language from the list. The language must have been added to the list of used languages.</p>   <p id="211de1fc">Then switch to the&nbsp;<b id="316751fa">Advanced</b> tab and select the&nbsp;<b id="d8a1640d">Do Not Generate</b> checkbox:</p>         <b id="3189c2d4">         <figure><img alt="GenShap" title="GenShap" src="/help/img/idea/2019.1/GenShap.png" id="7b206c66" width="500" height="736"></figure>      </b>      <p id="e4a45e8e">Then click&nbsp;<b id="efca0386">OK</b>&nbsp;to close the dialog.</p>   <h3 id="createcolors">Create colors</h3>   <p id="1774bc1e">Now you should be able to create color constants in the newly created accessory model:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx11.png"><img alt="Shx11" title="Shx11" src="/help/img/idea/2019.1/Shx11.png" id="136b8eb0" width="500" height="792"></a></figure>      <p id="e9572bf3">If you do not see&nbsp;<i id="55fca423">Color</i> in the&nbsp;<b id="148ad50e">New</b> menu, you most likely forgot to rebuild the language. Or, you have missed the&nbsp;<b id="dea01652">can be root</b> property of the&nbsp;<i id="87ae7939">Color</i> concept, which has to be set to&nbsp;<b id="d88f84b6">true</b>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx12.png"><img alt="Shx12" title="Shx12" src="/help/img/idea/2019.1/Shx12.png" id="31c43bb6" width="900" height="1244"></a></figure>      <h3 id="thefirsttouchondependencies">The first touch on dependencies</h3>   <p id="4c4d2036">A crucial piece of knowledge in MPS is how to handle dependencies and imported languages.&nbsp;To display the dependencies of a module or a model, you have to navigate to it in the left-hand side <b id="532226a4">Project View</b>&nbsp;panel (<i id="d6192da0">Alt/Cmd + 1</i> to open the panel). Try that for the&nbsp;<i id="d9703e1c">Shapes</i> language. Select it in the tree:</p>   <p id="79fc9c44">      <figure><img alt="Sh70" title="Sh70" src="/help/img/idea/2019.1/Sh70.png" id="7d526fc4" width="314" height="320"></figure>      <br> Hit&nbsp;<i id="3ed5df4d">Alt + Enter</i>&nbsp;(or right-click on it and choose <b id="1d38d1d6">Module/Model Properties</b>) and you'll get a dialog with the properties of the module/model. The&nbsp;<i id="15349be2">Dependencies</i>&nbsp;tab shows the modules/models that the current module/model depends on (aka import in Java, require in Ruby, etc.).</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx100.png"><img alt="Shx100" title="Shx100" src="/help/img/idea/2019.1/Shx100.png" id="ae88594f" width="500" height="968"></a></figure>      <p id="bf035ab8">Yours is most likely empty now. You add elements using the '+' button. In the small search dialog type a few characters of the name of the desired dependency to narrow down the search and hit&nbsp;<i id="12aa0122">Enter</i>&nbsp;when you locate the correct one.</p>         <figure><img alt="Sh72" title="Sh72" src="/help/img/idea/2019.1/Sh72.png" id="382ed6b0" width="352" height="267"></figure>      <p id="edc706e4">In the&nbsp;<i id="45277991">Used Languages</i> section you indicate, which languages (syntaxes) you want to be able to use in your module/model.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx101.png"><img alt="Shx101" title="Shx101" src="/help/img/idea/2019.1/Shx101.png" id="d1516a93" width="500" height="964"></a></figure>      <p id="b17a6cdd">We do not need to change anything here, so let's continue by clicking the <b id="d4f0557d">OK</b> button.</p>   <aside class="tip sideblock" data-title="" rel="b17a6cdd" id="88215c61">      <p id="c563cae0">If you, at any point when working with MPS, cannot type the code that we propose in the tutorial, most likely you have not properly set the dependencies. So please pay attention to the places, where the tutorial mentions dependencies and suggest that you should add a dependency or import a language.</p>   </aside>   <h3 id="conceptforcolorreference">Concept for color reference</h3>   <p id="1fe05535">Now our language needs a way to indicate the desired color of a shape in our code. Thus <i id="b6f36b04">Shape</i> should be referring to one of the color constants in the <b id="e7de9f0a">accessory model</b> of the <b id="50237af4">Shapes</b> language. MPS will automatically populate the completion menu with all available color constants, whenever the user is about to specify a color for a <i id="e50df1fc">Shape</i>.</p>   <p id="97399980">Create a new concept in the&nbsp;<b id="c53758e5">Structure</b> aspect model and name it <i id="f4183d19">ColorReference</i>:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx3.png"><img alt="Shx3" title="Shx3" src="/help/img/idea/2019.1/Shx3.png" id="ce14137a" width="900" height="1252"></a></figure>      <p id="e8a87681">      <i id="70ff37e3">ColorReference</i>&nbsp;keeps a reference (a pointer going across the AST hierarchy) pointing to a single color constant (node of the <i id="46c6d4d6">Color</i> concept).</p>   <p id="38db28a4">In order to display and edit the colors we also need an editor for <i id="2411202e">ColorReference</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx4.png"><img alt="Shx4" title="Shx4" src="/help/img/idea/2019.1/Shx4.png" id="15a0aab2" width="900" height="1252"></a></figure>      <p id="d1de55ff">The reference should simply display the name of the color constant that it refers to, so we pick <i id="b407b5d9">target</i>&nbsp;from the code-completion menu and specify that the <i id="c51334c4">name</i>&nbsp;property&nbsp;of the color constant is what we want to show to the user.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx5.png"><img alt="Shx5" title="Shx5" src="/help/img/idea/2019.1/Shx5.png" id="b3694c8a" width="900" height="1242"></a></figure>      <p id="a55afab8">You should get an editor definition as follows:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx6.png"><img alt="Shx6" title="Shx6" src="/help/img/idea/2019.1/Shx6.png" id="fa1b630f" width="900" height="1248"></a></figure>      <h3 id="updatingshape">Updating Shape</h3>   <p id="ecfb1e25">The <i id="684ec266">Shape</i>&nbsp;concept is a good place to put our new <i id="93ae2ae1">ColorReference</i>, since both <i id="7e6be75d">Circle</i>&nbsp;and&nbsp;<i id="e307967e">Square</i>&nbsp;will inherit it. Open it in the editor an make the change:</p>   <p id="60f8b6f9">      <figure><img alt="Sh96" title="Sh96" src="/help/img/idea/2019.1/Sh96.png" id="53f63b07" width="672" height="580"></figure>      <br>       <i id="60bbd76c">Shape</i>&nbsp;may also define an <b id="ad64a960">editor component</b>&nbsp;to define the editor for the color and <i id="7018ab66">Circle</i>&nbsp;as well as <i id="7dabe6a1">Square</i>&nbsp;will be able to reuse that <b id="ae04de44">editor component</b>&nbsp;in their editors thus avoiding duplication.</p>   <p id="e37b2d13">Hit the '+' symbol and create a new <i id="c47c8f1d">Editor Component</i>.</p>   <p id="e5791fab">      <figure><img alt="Sh97" title="Sh97" src="/help/img/idea/2019.1/Sh97.png" id="2e2902c0" width="343" height="109"></figure>      <br>       <figure><img alt="Sh98" title="Sh98" src="/help/img/idea/2019.1/Sh98.png" id="e8c63d20" width="672" height="214"></figure>      <br> The editor component definition a language that you are already familiar with and so you will be easily able to specify an indent layout, define a constant text cell followed by a cell bound to the <i id="ed576e45">color</i>&nbsp;property.</p>   <h2 id="embeddingtheeditorcomponent">Embedding the editor component</h2>   <p id="ed514ac1">The editor component defined for <i id="2a82d99e">Shape</i>&nbsp;should now be added into the editors for <i id="ea3d7213">Circle</i>&nbsp;and <i id="d778450d">Square</i>.</p>   <p id="2689215b">      <figure><img alt="Sh99" title="Sh99" src="/help/img/idea/2019.1/Sh99.png" id="3b0de2b8" width="679" height="301"></figure>      <br>       <figure><img alt="Sh100" title="Sh100" src="/help/img/idea/2019.1/Sh100.png" id="794f7ffe" width="671" height="173"></figure>      <br>       <figure><img alt="Sh101" title="Sh101" src="/help/img/idea/2019.1/Sh101.png" id="4f370f10" width="671" height="205"></figure>      <br> The <b id="65291a4b">editor component</b>&nbsp;becomes just another cell in the editor's layout.</p>   <h2 id="athirdrun">A third run</h2>   <p id="4510e741">Now it is the best time to rebuild the language. Right-click on the Language node in the <i id="8ef38dd3">Project View</i>&nbsp;and select "Rebuild Language".</p>   <aside class="tip sideblock" data-title="" rel="4510e741" id="ba7648b5">      <p id="a27bb0c1">If you rebuilt the whole project instead of just the Language here, you'd get a couple of errors, since the Solution now misses the newly defined color properties. We'll add those instantly.</p>   </aside>   <p id="75ed1745">Opening the <i id="a54ffeae">MyDrawing</i>&nbsp;program should show you the empty cells for colors in red. Try <i id="e1151267">Control + Space</i>&nbsp;in them and you will get a list of colors that you can pick from.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx13.png"><img alt="Shx13" title="Shx13" src="/help/img/idea/2019.1/Shx13.png" id="d82daa81" width="900" height="1248"></a></figure>      <p id="3f3cd087">      <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx14.png"><img alt="Shx14" title="Shx14" src="/help/img/idea/2019.1/Shx14.png" id="d016f540" width="500" height="240"></a></figure>      <br>      <br> Now our language is fully defined. We can create a&nbsp;<i id="68dbb2a5">Canvas</i>&nbsp;and add <i id="fc1dee77">Circles</i>&nbsp;and <i id="e8478603">Squares</i>&nbsp;to it, specifying their positions, sizes and colors. That's quite an achievement for such a short time.</p>   <p id="777627e9">What we're missing yet is the translation of these programs into Java, so that we could run them and see the shapes nicely drawn on the screen. If you continue you'll soon realize that we're almost there.</p>   <h2 id="generator">Generator</h2>   <p id="af661a33">Our language now needs a generator so that we could generate code that could be compiled and run. We will choose <i id="74425fa1">BaseLanguage</i> as the target for our DSL. <i id="c9ca8be7">BaseLanguage</i> is a copy of Java distributed with MPS and so it can be easily transformed into textual Java sources for the Java compiler to compile into binaries. We could possibly choose any other target platform and language, provided you plug-in a definition of that target language into your project.</p>   <p id="a96fe91b">The generator will be very straightforward and will only need a few rules and a single mapping configuration.</p>         <figure><img alt="Tg1" title="Tg1" src="/help/img/idea/2019.1/Tg1.png" id="32f4b31a" width="986" height="625"></figure>      <p id="a9cfcdcd">Your language already contains a skeleton of an empty generator. You can open the mapping configuration, that will specifying what rule to apply when. We will be adding configuration entries here gradually.</p>   <p id="a8be72ca">Here's the idea behind the generator that we will implement:</p>   <ul class="list _ul"><li class="list__item" id="ed2e3898"><p>A <i id="c4278b43">Canvas</i>&nbsp;gets translated into a Java class, which will extend Java's <i id="de72fc8b">JFrame</i>&nbsp;class and hold a <i id="4961f7bb">JPanel</i>&nbsp;that all the shapes will be drawn on</p></li><li class="list__item" id="d22b475a"><p>Each <i id="ba957501">Shape</i>&nbsp;gets translated into a method call on the <i id="d92e2505">Graphics</i>&nbsp;object to draw the shape on the <i id="540adaea">JPanel</i>      </p></li><li class="list__item" id="78ed5532"><p>A <i id="08735679">ColorReference</i>&nbsp;gets translated into a reference to the appropriate color constant in the <i id="af0baaf4">java.awt.Color</i>&nbsp;class.</p></li></ul>   <p id="b2b2ac72">Let's start with the class for <i id="66525061">Canvas</i>. You need to add a new entry in the <i id="d3129eb6">root mapping roles</i>, since <i id="68f0c4d1">Canvas</i>&nbsp;is a root concept. Hit&nbsp;<i id="aaf3daf7">Enter</i> to insert a new empty rule:</p>         <figure><img alt="Tg2" title="Tg2" src="/help/img/idea/2019.1/Tg2.png" id="0b52dd4c" width="988" height="623"></figure>      <p id="50fb01ad">You need to use an&nbsp;<b id="d3b56bc5">Intention</b> (<i id="104fa027">Alt + Enter)</i>&nbsp;the be able to select "New Root Template" from the pop-up menu.</p>   <p id="eb512af4">This rule defines that a&nbsp;<i id="98261220">Canvas</i>&nbsp;node should be replaced with a Java class. The template defines with what class:<br>       <figure><img alt="Tg3" title="Tg3" src="/help/img/idea/2019.1/Tg3.png" id="1b07db28" width="634" height="337"></figure>   </p>   <p id="706a1c52">The root template should be generating a Java class, so you need to pick "class".</p>         <figure><img alt="Tg4" title="Tg4" src="/help/img/idea/2019.1/Tg4.png" id="2ee63be9" width="364" height="147"></figure>      <p id="516b5366">This is the finishes root mapping rule. The <i id="a106eadd">map_Canvas</i>&nbsp;is a name of the root template that was created in the generator. You should open it up so we could make changes to it.<br>       <figure><img alt="Tg5" title="Tg5" src="/help/img/idea/2019.1/Tg5.png" id="61b403d2" width="986" height="625"></figure>   </p>   <p id="cd3526e2">First we need to set the dependencies of the <b id="8aed572b">generator module</b>&nbsp;to depend on the <b id="9acb2c6f">JDK</b> module. Without this dependency you would not be able to compile your sandbox eventually.</p>   <p id="412b6ecd">      <b id="48398c3d">Note:</b>&nbsp;Remember,&nbsp;<i id="65c479d2">Alt + Enter</i>&nbsp;will bring up the properties of the node selected in the left-hand&nbsp;<i id="ad1803d3">Project View</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shxx4.png"><img alt="Shxx4" title="Shxx4" src="/help/img/idea/2019.1/Shxx4.png" id="f7f5e02c" width="900" height="1406"></a></figure>      <p id="783b7d25">Second,&nbsp;the&nbsp;<b id="00fea851">generator model</b>&nbsp;must depend on <i id="77e2e134">java.swing</i> and <i id="31b106d8">java.awt</i>, as specified below. Without these dependencies you would not be able to type the Java Swing code needed to implement the generator templates:</p>   <p id="885500a9">&nbsp;</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shxx3.png"><img alt="Shxx3" title="Shxx3" src="/help/img/idea/2019.1/Shxx3.png" id="c20d6355" width="900" height="1322"></a></figure>      <p id="2ea94b29">With the dependencies you can start typing the Java code that will be part of the generated Java class. We will then parametrize the code with values from the <i id="6b4dc6dd">Canvas</i>, to make it reflect the user's intent.</p>   <p id="be70e438">The class needs to extend <i id="255b40be">JFrame</i>.</p>         <figure><img alt="Tg8" title="Tg8" src="/help/img/idea/2019.1/Tg8.png" id="0dae92d3" width="458" height="139"></figure>      <p id="54b0a4aa">Now you'll add the <i id="150146c9">main</i>&nbsp;method to get a runnable Java class. You can use the "psvm" live template to enter the method quickly.</p>         <figure><img alt="Tg9" title="Tg9" src="/help/img/idea/2019.1/Tg9.png" id="5ab13726" width="454" height="174"></figure>            <figure><img alt="Tg10" title="Tg10" src="/help/img/idea/2019.1/Tg10.png" id="5ebfa9e8" width="406" height="178"></figure>      <p id="93b39f33">Inside the method, we'll need to instantiate&nbsp;<i id="4137881b">map_Canvas</i>.</p>         <figure><img alt="Tg11" title="Tg11" src="/help/img/idea/2019.1/Tg11.png" id="3c426abc" width="424" height="215"></figure>      <p id="d67d0c34">We'll also need a method to initialize the frame. Type "method" and use <i id="42b07500">Control + Space</i>&nbsp;to complete the method definition:</p>         <figure><img alt="Tg12" title="Tg12" src="/help/img/idea/2019.1/Tg12.png" id="3778b51e" width="509" height="251"></figure>      <p id="c89146e0">Call the method <i id="5a6483d0">Initialize()</i>&nbsp;and make sure that <b id="106f918f">the method is called</b> from <i id="a93c86a1">main</i>.</p>         <figure><img alt="Tg13" title="Tg13" src="/help/img/idea/2019.1/Tg13.png" id="c6b0c5f6" width="423" height="260"></figure>      <aside class="tip sideblock" data-title="" rel="8f0594d0" id="14ceb13c">      <p id="280f7002">Notice the <i id="b5382a53">canvas.initialize()</i> call in the <i id="da6c422a">main()</i> method. Have you added it?</p>   </aside>   <p id="373562c7">All the shapes will be drawn on a <i id="b68383a0">JPanel</i>, so we now need to add one as a field.</p>         <figure><img alt="Tg14" title="Tg14" src="/help/img/idea/2019.1/Tg14.png" id="4dd2cc15" width="511" height="258"></figure>            <figure><img alt="Tg15" title="Tg15" src="/help/img/idea/2019.1/Tg15.png" id="ae8f7b4e" width="410" height="278"></figure>      <p id="e907ecac">Notice, we use an <b id="d2612ef6">anonymous inner class</b> to be able to customize the <i id="a9e6f7c6">JPanel</i>&nbsp;a bit.</p>   <p id="02e9c083">      <b id="bb6a211c">Important:</b>&nbsp;To create an anonymous inner class in BaseLanguage, position your cursor right after <i id="3f55a00c">new JPanel()</i>&nbsp;and before the ending semicolon. Then hit the "{" (left curly brace) key and MPS will add the ending "}" symbol. Now keep the cursor between these "{" and "}" symbols to add methods to the panel's anonymous inner class.</p>   <p id="1472bbb3">We'll override the <i id="b522156b">paintComponent</i>&nbsp;method of <i id="596b6a1c">JPanel</i>, because this is the method where Java allows us to easily draw the shapes on the <i id="8a777e92">JPanel</i>. Hit <i id="6d7cf22c">Control/Cmd + O</i>,&nbsp;while the cursor is inside the <i id="07575224">JPanel</i>'s anonymous class body between the "{" and "}" symbols,&nbsp;to invoke the <b id="63906be5">Override method dialog</b>&nbsp;for the <i id="e9c2015a">JPanel</i>&nbsp;and select the <b id="43842e7b">paintComponent</b>&nbsp;method.</p>         <figure><img alt="Tg16" title="Tg16" src="/help/img/idea/2019.1/Tg16.png" id="dff4f9d5" width="502" height="471"></figure>      <p id="211c8dd5">Make sure your <i id="c3b88e87">paintComponent()</i>&nbsp;method is correctly nested inside the <i id="14d10e1c">JPanel</i>'s anonymous inner class as displayed in the screen-shots. Also make sure it is called <b id="3c8b5aaf">paintComponent</b>, not <b id="a8315255">paintComponents</b>.</p>   <p id="b7793c83">Enter the following code into the method:<br>       <figure><img alt="Tg17" title="Tg17" src="/help/img/idea/2019.1/Tg17.png" id="b4e00daf" width="505" height="337"></figure>   </p>   <p id="5da7cfd3">Now, please, fill in the&nbsp;<i id="96fdac7c">initialize</i>&nbsp;method and we have a template ready:</p>         <figure><img alt="Tg18" title="Tg18" src="/help/img/idea/2019.1/Tg18.png" id="22459815" width="547" height="422"></figure>      <h3 id="parametrizingthetemplate">Parametrizing the template</h3>   <p id="88795257">The code in template currently does not use any values from the input model. It simply hardcodes the code and so the code generated by the template will always be the same, no matter what shapes are created in the user model. This has to change. The template must react to the input model and the generated code must reflect the shapes, their sizes and colors. The properties and children of <i id="74530574">Canvas</i>&nbsp;should be inserted into the template through <b id="915318b7">macros</b>. MPS gives you three types of macros:</p>   <ul class="list _ul"><li class="list__item" id="08c0cf7d"><p>         <b id="9f7449fb">property macros</b>&nbsp;- to insert properties from the input model</p></li><li class="list__item" id="91fbe0ae"><p>         <b id="55f4c609">node macros</b>&nbsp;- to replace nodes in the template with nodes from the input model</p></li><li class="list__item" id="b0bb6eef"><p>         <b id="a43aa780">reference macros</b>&nbsp;- to adjust references in the template to point to nodes in the input model</p></li></ul>   <p id="2c9068d7">We'll gradually use all of these.</p>   <p id="2ecb6812">To start with, we'll customize the name of the generated class and the <b id="35a4fb90">Title</b>&nbsp;of the frame with the <b id="07b65929">name</b>&nbsp;of the <i id="5fba5cb2">Canvas</i>. Place the cursor on the name of the class - <i id="fe56cdb5">map_Canvas</i>&nbsp;and hit <i id="3624ef17">Alt + Enter</i>.</p>   <p id="bd48a3e9">      <figure><img alt="Tg19" title="Tg19" src="/help/img/idea/2019.1/Tg19.png" id="3b7a1ae2" width="490" height="194"></figure>      <br>       <figure><img alt="Tg20" title="Tg20" src="/help/img/idea/2019.1/Tg20.png" id="b0156208" width="605" height="277"></figure>      <br> Now select the <b id="799e38e0">node.name</b>&nbsp;property macro from the pop-up menu.</p>         <figure><img alt="Tg21" title="Tg21" src="/help/img/idea/2019.1/Tg21.png" id="6e8a06a2" width="987" height="628"></figure>      <p id="9e02acfd">The "map_Canvas" text is now wrapped (annotated) with a <b id="cd41aa79">property macro</b>, which changes the <b id="159ee4ec">name</b> property to the <b id="0f5908d6">name</b>&nbsp;of the <i id="e97da90c">Canvas</i>. The <b id="67ccbe46">Inspector</b> panel (<i id="37202af0">Alt + 2</i>) can be used to enter or modify the property macro, as well. Currently it returns the value of <i id="ae523d56">node.name</i>, which is the name of the current&nbsp;<i id="b2b1dec5">Canvas</i>.</p>   <p id="7cbf7fb1">Now you can wrap the "Title" text to customize the title of the frame. Using the <i id="74c2dc2b">Control/Cmd + Up Arrow</i>&nbsp;key shortcut select the text "Title" <b id="791545e4">without</b> the surrounding " characters and with <i id="3313f72c">Alt + Enter</i>&nbsp;insert the correct property macro:</p>         <figure><img alt="Tg22" title="Tg22" src="/help/img/idea/2019.1/Tg22.png" id="263e0354" width="603" height="368"></figure>      <p id="c164b31f">The code should now look like this:</p>         <figure><img alt="Tg23" title="Tg23" src="/help/img/idea/2019.1/Tg23.png" id="40cf135e" width="987" height="626"></figure>      <h3 id="drawingshapes">Drawing shapes</h3>   <p id="e66fcf96">Our template assumes the code that draws shapes should be placed inside the <i id="257a6752">paintComponent</i>&nbsp;method of the <i id="ff008881">JPanel</i>&nbsp;field. The statement "System.out.println("Draw here");" serves as a placeholder for the real code that will draw all shapes. We will use the <b id="08cdcf2c">COPY_SRC</b>&nbsp;macro to replace the placeholder statement with a statement that draws a single shape and we'll leverage the&nbsp;<b id="a127fb76">LOOP</b>&nbsp;macro to repeat that for all shapes defined in the current <i id="fe5a3e94">Canvas</i>.</p>   <p id="dba35914">Now, please select the placeholder statement <b id="c9331bcf">including its closing semicolon</b> using the <i id="6210d28d">Control/Cmd + Up Arrow</i>&nbsp;key shortcut, hit <i id="17069139">Alt + Enter</i>&nbsp;and choose the appropriate&nbsp;<b id="738b88c4">Node macro</b>&nbsp;option to insert a <b id="85bdcf30">LOOP macro</b>&nbsp;to loop through all the child <i id="05df3d9b">Shapes</i>&nbsp;of the current <i id="04392eaf">Canvas</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shxx1.png"><img alt="Shxx1" title="Shxx1" src="/help/img/idea/2019.1/Shxx1.png" id="de5098a1" width="500" height="878"></a></figure>      <p id="7e85de65">Again, the <b id="f2fcbef4">Inspector</b>&nbsp;(<i id="e56ec4c8">Alt + 2</i>) shows the binding code.</p>         <figure><img alt="Tg25" title="Tg25" src="/help/img/idea/2019.1/Tg25.png" id="c076c9cc" width="987" height="625"></figure>      <p id="eba2dec3">If the&nbsp;<b id="7048322a">LOOP macro</b> is underlined in red, most likely you did not select the whole line before applying the intention. Undo, select the whole line including the semicolon and apply the <b id="94124a6e">Add LOOP macro</b> intention again.<br> The <b id="aa4d1c82">LOOP macro</b>&nbsp;will repeat the "System.out.println("Draw here");" statement for each shape listed in <i id="0d806530">node.shapes</i>.</p>   <p id="4fa72a1d">We, however, need to have the&nbsp;"System.out.println("Draw here");" statements replaced with code that draws each of these shapes. The <b id="e35b3837">COPY_SRC macro</b>&nbsp;will do just that. Please, select the whole statement within the <b id="52025a72">LOOP macro</b>&nbsp;again, <b id="6461bc84">including the semicolon</b>, hit <i id="34c2bed3">Alt + Enter</i>&nbsp;and choose <b id="b12fb691">Node macro</b>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shxx2.png"><img alt="Shxx2" title="Shxx2" src="/help/img/idea/2019.1/Shxx2.png" id="92a55f54" width="500" height="642"></a></figure>      <p id="0184c709">Type in <b id="a5d216b1">COPY_SRC</b>&nbsp;(<i id="8cfc7d58">Control + Space</i>) and you get a macro that will replace&nbsp;"System.out.println("Draw here");" with the current shape for all shapes that the <b id="949f511e">LOOP macro</b>&nbsp;provides.</p>         <figure><img alt="Tg27" title="Tg27" src="/help/img/idea/2019.1/Tg27.png" id="17942ad9" width="478" height="231"></figure>      <br>       <figure><img alt="Tg28" title="Tg28" src="/help/img/idea/2019.1/Tg28.png" id="20c7a151" width="498" height="343"></figure>      <p id="08b805dc">Make sure your&nbsp;<i id="e88ccbd1">COPY_SRC</i> macro wraps the whole statement, including the semicolon, like it is displayed in the picture. If not, undo, select the whole statement and insert the&nbsp;<i id="9848cb52">COPY_SRC</i> macro again.</p>   <h3 id="generatingcircles">Generating circles</h3>   <p id="64098c77">Now we get <i id="c91a5282">Canvas</i>&nbsp;to be translated into a Java class and we also made a place for <i id="a623bd1d">Shapes</i>&nbsp;to add the code that will draw them. The time is up for us to define the actual translation rules for <i id="ba49a454">Shapes</i>&nbsp;themselves, so that we get a "graphics.drawCircle()" method inserted in the generated code as a replacement for the <i id="fb7c313d">Circle</i>&nbsp;shape. You need to open the <i id="07a7cb2c">main</i>&nbsp;mapping configuration and add a new entry to the "reduction rules" section:</p>   <p id="6945fd1f">      <figure><img alt="Tg29" title="Tg29" src="/help/img/idea/2019.1/Tg29.png" id="1a07a6ee" width="986" height="625"></figure>      <br>       <i id="25bb8443">Alt + Enter</i>&nbsp;to create a new template:</p>         <figure><img alt="Tg30" title="Tg30" src="/help/img/idea/2019.1/Tg30.png" id="9ade25fc" width="581" height="191"></figure>      <p id="758cc7a8">The new <i id="3b9540d8">reduct_Circle</i>&nbsp;template will show up in the left-hand <b id="3a85ea63">Project View</b>.</p>   <p id="3e81190a">      <figure><img alt="Tg31" title="Tg31" src="/help/img/idea/2019.1/Tg31.png" id="9b9069c8" width="985" height="623"></figure>      <br> You may also create a reduction rule for <i id="a298d65f">Square</i>:</p>   <p id="6588b950">      <figure><img alt="Tg32" title="Tg32" src="/help/img/idea/2019.1/Tg32.png" id="342d01b3" width="986" height="627"></figure>      <br> Open the <i id="ad9eec47">reduce_Circle</i>&nbsp;template. We now need to specify the Java code that will replace <i id="3d2161bf">Circles</i>. Remember, that the Java code will be placed in <i id="165df35f">map_Canvas</i>&nbsp;inside the <i id="c8c1f334">paintComponent</i>&nbsp;method.</p>         <figure><img alt="Tg33" title="Tg33" src="/help/img/idea/2019.1/Tg33.png" id="6d46af27" width="987" height="624"></figure>      <p id="5523113d">First, we'll enter a <i id="bbc023ac">BlockStatement</i>, that will wrap our template:<br>       <figure><img alt="Tg34" title="Tg34" src="/help/img/idea/2019.1/Tg34.png" id="a79402da" width="449" height="212"></figure>   </p>   <p id="20849c91">We will need a local variable of the <i id="ccf7aa45">Graphics</i>&nbsp;type as a place holder for the <i id="66f6c82d">paintComponent</i>&nbsp;parameter of the same name. And yet again a <i id="f369ff91">BlockStatement</i>.</p>         <figure><img alt="Tg35" title="Tg35" src="/help/img/idea/2019.1/Tg35.png" id="7b27fd8f" width="240" height="186"></figure>      <br>       <figure><img alt="Tg36" title="Tg36" src="/help/img/idea/2019.1/Tg36.png" id="5c4247a1" width="488" height="286"></figure>            <figure><img alt="Tg37" title="Tg37" src="/help/img/idea/2019.1/Tg37.png" id="f97a0152" width="312" height="220"></figure>      <p id="93d58c10">To draw a circle in Java, we'll use the <i id="877e2fc6">Graphics</i>&nbsp;object to set the color first and that invoke its <i id="89a22fbc">drawOval</i>&nbsp;method. Please enter the code below:</p>   <p id="45d4953f">      <figure><img alt="Tg41" title="Tg41" src="/help/img/idea/2019.1/Tg41.png" id="c2483113" width="327" height="125"></figure>      <br>       <figure><img alt="Tg38" title="Tg38" src="/help/img/idea/2019.1/Tg38.png" id="7a17458b" width="495" height="379"></figure>      <br> Then use <i id="d57868b1">Control/Cmd / Up Arraw</i>&nbsp;to select the inner <i id="d0a3e11e">BlockStatement</i>, hit <i id="13eb7b77">Alt + Enter</i>&nbsp;(<b id="70ed726d">light-bulb</b>) and pick "Create Template Fragment" from the intentions menu. This will mark the selected fragment of the code as the actual template, which will eventually be placed into <i id="c6f34517">map_Canvas</i>   </p>         <figure><img alt="Tg39" title="Tg39" src="/help/img/idea/2019.1/Tg39.png" id="fda27a90" width="441" height="230"></figure>      <p id="8889314e">&nbsp;</p>   <aside class="tip sideblock" data-title="" rel="8889314e" id="9aa290a4">      <p id="0cadf3e5">The <i id="0f526f93">graphics</i>&nbsp;local variable needs our special attention. The current template as we've built is so far relies on <b id="aa785909">naming match</b>&nbsp;between the <i id="d7a67ec5">reduce_Circle</i>&nbsp;template, which refers to the <i id="1d44c4ab">graphics</i>&nbsp;local variable,&nbsp;and the <i id="190c597f">map_Canvas</i>&nbsp;template, which defined a <i id="bb38697f">graphics</i>&nbsp;method parameter in the <i id="25357ed1">paintComponent</i>&nbsp;method. This is a working solution, which, however, is quite fragile. Renaming either of the two <i id="051ce66c">graphics</i>&nbsp;variables will result in broken generated code. Will implement a more robust solution for <b id="9a7a456d">Squares</b>&nbsp;right below the solution for <b id="db6afdc6">Circle</b>.</p>   </aside>   <h3 id="parametrization">Parametrization</h3>   <p id="1bb40e62">The code now needs to be parametrized with actual values from the <i id="becf976d">Circle</i>&nbsp;node.<br>       <figure><img alt="Tg42" title="Tg42" src="/help/img/idea/2019.1/Tg42.png" id="0d6303b0" width="597" height="319"></figure>      <br> The first value "10" should be replaced with the <i id="2efcbe85">x</i>&nbsp;coordinate of the <i id="6db7113f">Circle</i>&nbsp;node. A <b id="f791cb0e">property macro</b>&nbsp;will do that. Similarly the second value "10" should be replaced with the <i id="2f33b319">y</i>&nbsp;coordinate.</p>         <figure><img alt="Tg43" title="Tg43" src="/help/img/idea/2019.1/Tg43.png" id="0a43da5f" width="637" height="310"></figure>      <p id="b9b1fae9">The <b id="21a2dfff">third</b> and <b id="674ea978">fourth</b> values "10" should both be replaced with the <i id="b4813203">radius</i>&nbsp;value of the <i id="785e16ba">circle</i>&nbsp;node.</p>         <figure><img alt="Tg44" title="Tg44" src="/help/img/idea/2019.1/Tg44.png" id="f4b73eb5" width="669" height="402"></figure>      <aside class="tip sideblock" data-title="" rel="0005232f" id="a477f1fa">      <p id="1ea83b3e">The <i id="bdd0851a">drawOval()</i> method's third and fourth parameters specify the oval's <b id="799abdd3">width</b> and <b id="be09443f">height</b>, respectively. Since we want to draw a <b id="a3475605">circle</b>, we need to provide the same values for both arguments. This is why the property macros for the <b id="1dedffd4">third</b> and <b id="86280269">fourth</b> parameters both specify <i id="76a6fece">node.radius</i>.</p>   </aside>   <p id="f531268a">Finally, the "Color.red" color placeholder reference should be replaced with the actual target of the <i id="95c6868f">color</i>&nbsp;reference of the&nbsp;<i id="656abb81">Circle</i>&nbsp;node. We will use a <b id="c7ac981c">reference macro</b>&nbsp;to replace the references. Please put the cursor on the "red" word and hit <i id="a59dff63">Alt + Enter</i>.<br>       <figure><img alt="Tg45" title="Tg45" src="/help/img/idea/2019.1/Tg45.png" id="d94fc242" width="604" height="349"></figure>   </p>   <p id="e1e11ba6">The reference macro will replace the reference to&nbsp;<b id="eb989890">red</b> with a reference to a node that we specify in the&nbsp;<b id="48821bed">Inspector</b> window:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx102.png"><img alt="Shx102" title="Shx102" src="/help/img/idea/2019.1/Shx102.png" id="2d6e3c6d" width="900" height="1242"></a></figure>      <p id="ab5fa93d">The&nbsp;<b id="98aafb87">referent</b> function returns either a <i id="f1f3b0f0">string</i> value (a name of the desired declaration to refer to) or&nbsp;<i id="8d68e0ae">node&lt;StaticFieldDeclaration&gt;</i> (a node representing a <i id="bfa08d5d">StaticFieldDeclaration</i>), because&nbsp;<b id="2df64957">red</b> itself is a reference to&nbsp;<i id="706ff60d">node&lt;StaticFieldDeclaration&gt;</i>. In fact, all color constants in the&nbsp;<i id="ae4c8086">java.awt.Color</i> class are declared as StaticFieldDeclarations.</p>   <aside class="tip sideblock" data-title="" rel="ab5fa93d" id="a84eefcd">      <p id="09ae9e74">You may try yourself opening the <i id="87990ff9">java.awt.Color</i>&nbsp;(Control/Cmd + N, type "Color", maybe also check the "Include stubs and non-project models" checkbox) class and check that, for example, the "white" constant is a <i id="da57bc9f">StaticFieldDeclaration</i>. <figure><img alt="additional1" title="additional1" src="/help/img/idea/2019.1/additional1.png" id="e183843e" width="598" height="373"></figure>      </p>   </aside>   <p id="c0a11465">So our task inside the reference macro will be to retrieve the <i id="261a67ab">StaticFieldDeclaration</i> from within the&nbsp;<i id="91dbe6f1">Color</i> class that corresponds with the color that the <i id="eace8e65">Circle</i> has set as its <i id="e05c28b2">color</i> child. We will do this programmatically and so we will need to set dependencies on the right modules and models, which will allow us to write the required code.</p>   <p id="892cd4e9">First, the generator module has to depend on <i id="f40efe4d">BaseLanguage</i> in order to be able to refer to the <i id="be447842">StaticFieldDeclaration</i> concept, which is declared in that language:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx104.png"><img alt="Shx104" title="Shx104" src="/help/img/idea/2019.1/Shx104.png" id="9760b15c" width="900" height="1250"></a></figure>      <p id="a1f31da2">Second, the generator model needs to be able to refer to the concepts defined in structure of the <i id="78236101">Shapes</i> language:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Shx105.png"><img alt="Shx105" title="Shx105" src="/help/img/idea/2019.1/Shx105.png" id="b442684b" width="900" height="1248"></a></figure>      <p id="cea8e624">With these languages imported we should be able to enter the code that discovers the correct static field declaration within the&nbsp;<i id="2a3e9594">Color</i> class:</p>         <figure><img alt="Sni mek obrazovky 2018 12 07 v 20 29 44" title="Sni mek obrazovky 2018 12 07 v 20 29 44" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-07-v-20-29-44.png" id="c41f7ffa" width="500" height="388"></figure>      <p id="df8f56fb">The&nbsp;<i id="29feb613">node-ptr/.../</i> construct allows you to obtain a node in the imported models of a specified concept represented with the given name. Since there only exists one&nbsp;<i id="6b4a5a1a">Color</i> class in JDK, the reference identified as&nbsp;<i id="2202da47">node-ptr/Color/</i> will be unique and will be pointing into the model to the <i id="82ad2ebd">Color</i> class.</p>   <p id="6d9755d6">      <b id="b0890cf2">Note:</b> Make sure you pick the right&nbsp;<i id="75bbbc9d">Color</i>&nbsp;element from the completion menu. It must be&nbsp;<i id="2d6b8216">java.awt.Color</i>, not the&nbsp;<i id="85ea0d34">Color</i> concept from the&nbsp;<i id="8a3a0d3d">Shapes</i> language.</p>         <figure><img alt="Sni mek obrazovky 2018 12 07 v 20 30 23" title="Sni mek obrazovky 2018 12 07 v 20 30 23" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-07-v-20-30-23.png" id="d8fa5d63" width="500" height="678"></figure>      <p id="86e8661b">Node pointer represent persistent references to nodes. To get a reference to the real node in memory, the node pointer must be resolved in the model repository. Use the following code to obtain the repository and resolve the&nbsp;<i id="e31e8ced">Color</i> node from it:</p>         <figure><img alt="Sni mek obrazovky 2018 12 07 v 20 31 33" title="Sni mek obrazovky 2018 12 07 v 20 31 33" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-07-v-20-31-33.png" id="0cf5b8d9" width="900" height="370"></figure>      <p id="371a2b67">The&nbsp;<b id="0183e60e">downcast</b> operator gives you access to the underlying Java API, which is currently the only way to get a repository in this place.</p>         <figure><img alt="Sni mek obrazovky 2018 12 07 v 20 44 23" title="Sni mek obrazovky 2018 12 07 v 20 44 23" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-07-v-20-44-23.png" id="dd729026" width="900" height="368"></figure>      <p id="c967d069">Using the <i id="2a734006">collections</i> language you can complete a concise query:</p>         <figure><img alt="Sni mek obrazovky 2018 12 07 v 20 33 23" title="Sni mek obrazovky 2018 12 07 v 20 33 23" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-07-v-20-33-23.png" id="b214a50b" width="900" height="396"></figure>      <p id="7bb99984">Since&nbsp;<i id="0c66e1bb">node</i> is an instance of the&nbsp;<i id="5171bef5">Circle</i> concept,&nbsp;<i id="c9ad1a22">node.color</i> is the circle's reference to the color (an instance of&nbsp;<i id="0248ed38">ColorReference</i>) and&nbsp;<i id="70fbf087">node.color.target</i> is a&nbsp;<i id="d4475638">Color</i> (an instance of the Shapes.Color concept) from the&nbsp;<b id="e4fb67f5">accessory model</b>.</p>   <p id="8dc67ed5">In brief, the query searches the first static field declaration&nbsp;within the static field declarations of the <i id="3e97bddc">java.awt.Color</i> class with the same name as is the name of the color specified for the&nbsp;<i id="5d89fffc">Circle</i>.</p>   <aside class="tip sideblock" data-title="" rel="8dc67ed5" id="ebe039e6">      <p id="15d26403">The&nbsp;<i id="f4ac3f1f">:eq:</i> operator is a null-safe equality comparison, equivalent to (<a href="http://it.name" data-external="true" target="_blank" rel="noopener noreferrer">it.name</a> !=null &amp;&amp; <a href="http://it.name" data-external="true" target="_blank" rel="noopener noreferrer">it.name</a>.equals(<a href="http://node.color.target.name" data-external="true" target="_blank" rel="noopener noreferrer">node.color.target.name</a>)). MPS also offers a&nbsp;<i id="bc9113e9">:ne:</i> operator, which is a negation of&nbsp;<i id="b39d904f">:eq:</i>.</p>   </aside>   <h3 id="reducingsquares">Reducing Squares</h3>   <p id="3ba8fa6f">We'll start mimicking how generator is done for <i id="5cdac513">Circles</i>. Identically provide the following code for the <i id="119c4a65">reduce_Square</i>&nbsp;template.</p>   <p id="a8874093">      <b id="8c076c69">Hint:</b> Start by inserting a&nbsp;<i id="f18a2a85">BlockStatement</i>   </p>         <br>       <figure><img alt="Tg47" title="Tg47" src="/help/img/idea/2019.1/Tg47.png" id="117d8f65" width="985" height="625"></figure>      <p id="b8656834">The values passed into "drawRect" should be replaced with <b id="ff73c1c2">property macros</b> with the <i id="914fbeff">upperLeftX</i>, <i id="566b73b5">upperLeftY</i>&nbsp;and <i id="47050481">size</i>&nbsp;properties of the <i id="6c9ee020">Square</i>.</p>         <figure><img alt="Tg40" title="Tg40" src="/help/img/idea/2019.1/Tg40.png" id="3a450bb3" width="986" height="625"></figure>      <aside class="tip sideblock" data-title="" rel="c01bcde0" id="0691f732">      <p id="9dbf9280">The&nbsp;<i id="bfcf716b">drawRect()</i>&nbsp;method's third and fourth parameters specify the rectangle's&nbsp;<b id="c513f935">width</b>&nbsp;and&nbsp;<b id="1dc1d679">height</b>, respectively. Since we want to draw a&nbsp;<b id="53e53b4c">square</b>, we need to provide the same values for both arguments. This is why the property macros for the&nbsp;<b id="2688b9ea">third</b>&nbsp;and&nbsp;<b id="d3786be2">fourth</b>&nbsp;parameters both specify&nbsp;<i id="45fc0f7e">size</i>.</p>   </aside>   <h2 id="generatingcode">Generating code</h2>   <p id="15fe9aa1">Now we're done defining the generator. If you rebuild the language, open&nbsp;<i id="1d66a740">MyDrawing</i>, right-click it and choose "Preview Generated Text",</p>   <p id="2bb51513">&nbsp;&nbsp;<figure><img alt="Tg48" title="Tg48" src="/help/img/idea/2019.1/Tg48.png" id="93ca3dd8" width="537" height="491"></figure>      <br>you'll get a nicely structured Java code that properly initializes a&nbsp;<i id="99420010">JFrame</i>&nbsp;and draws all the shapes:</p>         <figure><img alt="ppview2" title="ppview2" src="/help/img/idea/2019.1/ppview2.png" id="869c5340" width="500" height="1478"></figure>      <p id="5dfdb06d">If your code is different, look into one of your generator templates, they are probably different from the ones presented in the tutorial. Maybe your macros are not attached to the correct pieces of code or the values specified in the&nbsp;<b id="9b2e1dee">Inspector</b>&nbsp;window for the macros differ from the ones in the screen-shots.</p>   <p id="37c7bb54">If the code does not compile, make sure your generator module depends on the JDK module, as we defined earlier.</p>   <h2 id="amorerobustgenerationforsquares">A more robust generation for Squares</h2>   <p id="6e4e363d">The way we handled the&nbsp;<i id="90ddf8f5">graphics</i> local variable in the templates was not quite right. We relied, perhaps too optimistically, on the name of the variable to be the same in <i id="74e4ceba">map_Canvas</i>,&nbsp;<i id="b3a1bc3e">reduce_Circle</i> and <i id="779ad882">reduce_Square</i>. What if the names of the variable in these three templates were not the same? A more robust solution is needed</p>   <p id="0bac7106">As indicated earlier in the section for the&nbsp;<i id="a24408ed">Circle</i>&nbsp;generator, we'll use the <i id="d5eb27f2">reduce_Square</i>&nbsp;template to properly tie the <i id="69c811df">graphics</i>&nbsp;local variable with the <i id="5f16427a">graphics</i>&nbsp;parameter that the <i id="a1819ffe">map_Canvas</i>&nbsp;template generates. Relying on name match is not very robust.</p>   <p id="697e6c03">We basically need to go through three steps:</p>   <ol class="list _decimal"><li class="list__item" id="32e7337a"><p>Define a storage for created <i id="e2ae5e0d">graphics</i>&nbsp;parameters</p></li><li class="list__item" id="2ab67d04"><p>Store the <i id="34460150">graphics</i>&nbsp;parameter in the <i id="199c2d4b">map_Canvas</i>&nbsp;template</p></li><li class="list__item" id="bfd96bae"><p>Retrieve the proper <i id="6cea864e">graphics</i>&nbsp;parameter in the <i id="e240d8c9">reduce_Square</i>&nbsp;template</p></li></ol>   <p id="04e41f24">We'll start by creating a mapping label in the mapping configuration. This will be the storage of&nbsp;<i id="63577e67">ParameterDeclarations</i>, each identified by the&nbsp;<i id="94469295">Canvas</i> from which it was generated. You may also think of this mapping label as of a dictionary that maps&nbsp;<i id="178c2342">Canvases</i> to&nbsp;<i id="d02c648e">ParameterDeclarations</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/shapes3001.png"><img alt="shapes3001" title="shapes3001" src="/help/img/idea/2019.1/shapes3001.png" id="bf3e053f" width="900" height="632"></a></figure>      <p id="4a2b6523">The <i id="443f5620">graphicsParam</i>&nbsp;mapping label stores <i id="a901188d">ParameterDeclarations</i>&nbsp;mapped by <i id="fcc7a6db">Canvases</i>&nbsp;that they belong to.</p>   <p id="bf2fc619">The <i id="cd0688de">map_Canvas</i>&nbsp;template now needs to store the <i id="c2ae84aa">graphics</i>&nbsp;parameter in the mapping label. The <i id="aca29706">MAP_SRC</i>&nbsp;macro can be leveraged for that with great success:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/shapes3002.png"><img alt="shapes3002" title="shapes3002" src="/help/img/idea/2019.1/shapes3002.png" id="e010695f" width="900" height="998"></a></figure>      <p id="9580bcfc">Wrap the parameter declaration (including the type) with the <i id="b106cde5">MAP_SRC</i>&nbsp;macro (<i id="b4ef12e8">Alt + Enter</i>, pick <i id="42c63475">node macro</i>, type MAP_SRC_)<i id="6e97b3a6">. Down in the _Inspector</i>&nbsp;window you then select the <b id="1f3f2821">mapping label</b>&nbsp;to use for storing the generated parameter declaration. The <b id="f0dd8c91">current source node</b>, which is an instance of the <i id="1e4f235f">Canvas</i>&nbsp;concept, will be used as the key to identify the generated <i id="317462a5">graphics</i>&nbsp;parameter declaration in the mapping label.</p>   <p id="29d6c5b9">Finally, we need to retrieve the parameter declaration from the mapping label in the <i id="7394c9b9">reduce_Square</i>&nbsp;template. To indicate clearly that we are no longer relying on naming match, we can use a different name for the variable than <i id="cdcb302c">graphics</i>. We'll go with <i id="812ce5a1">g</i>&nbsp;in the sample:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/shapes3003.png"><img alt="shapes3003" title="shapes3003" src="/help/img/idea/2019.1/shapes3003.png" id="14582465" width="900" height="620"></a></figure>      <p id="f21cb10a">If you <i id="077120f9">Alt + Enter</i>&nbsp;on the <i id="d018f48e">g</i>&nbsp;reference and pick <i id="0428c285">reference macro</i>, you'll be able to retrieve the proper <i id="024bb310">graphics</i>&nbsp;parameter from the <b id="dac2f4fd">mapping label</b>:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/shapes3004.png"><img alt="shapes3004" title="shapes3004" src="/help/img/idea/2019.1/shapes3004.png" id="b4f9371b" width="900" height="614"></a></figure>      <p id="74dda236">Then repeat the reference macro creation for the second <i id="e04ac869">g</i> reference.&nbsp;<b id="fea5a4d9">Both</b> reference macros attached to the <i id="ef1e7b32">g</i> variable reference that you have just created must specify in the <b id="6d9c6ebc">Inspector</b> the details on how to obtain the desired target of the reference. The&nbsp;<i id="a002becb">genContext</i> object gives access to helpful methods and properties of the current generation session. Use the "<b id="00b0d268">get output for label and input</b>" operation on&nbsp;<i id="6bcd9db6">genContext</i> and provide the&nbsp;<i id="e7b56014">graphicsParam</i> mapping label as well as the&nbsp;<i id="1ce40514">Canvas</i> holding the currently generated&nbsp;<i id="58a1fb23">Square</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/shapes3005.png"><img alt="shapes3005" title="shapes3005" src="/help/img/idea/2019.1/shapes3005.png" id="66380cc2" width="900" height="984"></a></figure>      <p id="b5da51ac">We could now replicate the retrieval of the <i id="317a51ff">graphics</i>&nbsp;parameter&nbsp;for the <i id="a3b46274">reduce_Circle</i>&nbsp;template, as well.</p>   <h2 id="runningthecode">Running the code</h2>   <p id="209effb7">It is nice to see generated code, but you might actually prefer seeing it running. MPS can compile and run generated Java code easily. We only need to indicate that <i id="a264f24b">Canvas</i>&nbsp;is generated into a runnable Java class and thus <i id="76914a02">Canvas</i>&nbsp;itself should be treated as&nbsp;runnable, or as a "main" class. We only need to make <i id="72c9e7c2">Canvas</i>&nbsp;implement the <i id="6fcd3207">IMainClass</i>&nbsp;interface and MPS will take care of the rest. The <i id="26c3633b">IMainClass</i>&nbsp;interface comes from the&nbsp;<i id="a2bc1958">jet brains.mps.execution.util</i>&nbsp;language and so we need to add it to the list of dependencies of our language and set the scope to <b id="172ea2bb">Extends</b>:</p>         <figure><img alt="Tg50" title="Tg50" src="/help/img/idea/2019.1/Tg50.png" id="39892a53" width="792" height="539"></figure>      <p id="2f50a327">Use the <i id="59708b95">Alt + Enter</i>&nbsp;to get the properties dialogs. Notice that the language needs to be marked as <b id="70835d98">Extends</b>.</p>   <p id="4f524220">The <i id="6071c4d5">Convas</i>&nbsp;concept can now have the <i id="e56cba84">IMainClass</i>&nbsp;interface added to the <i id="51873e5b">implements</i>&nbsp;section.</p>   <p id="fab2009d">      <figure><img alt="Tg52" title="Tg52" src="/help/img/idea/2019.1/Tg52.png" id="96ab0a31" width="435" height="287"></figure>      <br> Rebuild the language and then right-click on <i id="de5527b5">MyDrawing</i>&nbsp;in the <b id="3af93f32">Project View</b>&nbsp;and click "Run".</p>   <aside class="tip sideblock" data-title="" rel="fab2009d" id="0adce5ef">      <p id="8fd31c1e">After creating a new drawing you may actually need to compile it first. If the <i id="bcd7bb01">Run 'Node MyDrawing'</i> is not shown in the context menu, it is an indication that <i id="edb62848">MyDrawing</i> has not yet been compiled. Please right-click on the sandbox solution or on the model holding <i id="84c67ce0">MyDrawing</i> and choose <i id="40425198">Make</i>. As soon as it finishes you should be able to run your drawing.</p>   </aside>   <p id="2c956929">      <figure><img alt="Tg53" title="Tg53" src="/help/img/idea/2019.1/Tg53.png" id="e11d80ef" width="446" height="574"></figure>      <br> You will get a running Java application with your drawing on it as a reward for your efforts.</p>         <figure><img alt="Tg54" title="Tg54" src="/help/img/idea/2019.1/Tg54.png" id="edbdb6ef" width="500" height="522"></figure>      <h2 id="analternativegenerator-generatingxml">An alternative generator - generating XML</h2>   <p id="96e76154">Just to give you an idea how the generator could be utilized to generate code in a declarative language, such as xml, here's a simple generator for the Shapes language generating xml. We start from an empty generator. The Java templates and rules have all been deleted:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 55 47" title="Sni mek obrazovky 2018 12 18 v 12 55 47" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-55-47.png" id="a5f9924a" width="500" height="1116"></figure>      <p id="d3ddaec9">First, the&nbsp;<i id="edc5d8b5">jetbrains.mps.core.xml</i> language must be imported (<i id="0a1a620f">Control + L</i>). It is the projectional equivalent to xml, as we know it, just like&nbsp;<i id="f010e4a5">BaseLanguage</i> is a projectional equivalent to Java.</p>   <p id="48deb90f">A root mapping rule must be created to convert&nbsp;<i id="445ac8a9">Canvas</i>      <i id="11caba55">es</i> into&nbsp;<i id="0d1caf85">xml files</i>.</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 56 04" title="Sni mek obrazovky 2018 12 18 v 12 56 04" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-56-04.png" id="1ca90c8e" width="500" height="366"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 56 16" title="Sni mek obrazovky 2018 12 18 v 12 56 16" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-56-16.png" id="c72581cb" width="500" height="736"></figure>      <p id="8dae48ca">The template named&nbsp;<i id="b6a71fb1">map_Canvas</i> gets created.</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 56 34" title="Sni mek obrazovky 2018 12 18 v 12 56 34" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-56-34.png" id="70b91f92" width="500" height="668"></figure>      <p id="631bba94">Xml code must be typed into the template in order to create the required code:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 56 44" title="Sni mek obrazovky 2018 12 18 v 12 56 44" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-56-44.png" id="1600cf78" width="500" height="468"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 57 01" title="Sni mek obrazovky 2018 12 18 v 12 57 01" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-57-01.png" id="180b75be" width="300" height="192"></figure>      <p id="c4fd7ac9">In order to insert the&nbsp;<i id="1dd42ff2">name</i> attribute, type "space" followed by "name=":</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 57 15" title="Sni mek obrazovky 2018 12 18 v 12 57 15" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-57-15.png" id="af0dbad1" width="300" height="152"></figure>      <p id="9bba0c7c">A property macro must be set on the contents of the&nbsp;<i id="59249f0f">name</i> attribute value:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 57 28" title="Sni mek obrazovky 2018 12 18 v 12 57 28" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-57-28.png" id="b19bb5da" width="500" height="774"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 57 48" title="Sni mek obrazovky 2018 12 18 v 12 57 48" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-57-48.png" id="48a51679" width="500" height="954"></figure>      <p id="905da51a">Some more xml needs to be inserted:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 58 08" title="Sni mek obrazovky 2018 12 18 v 12 58 08" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-58-08.png" id="fad9f54e" width="500" height="748"></figure>      <p id="f6d17c98">We create a placeholder for all the shapes:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 58 25" title="Sni mek obrazovky 2018 12 18 v 12 58 25" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-58-25.png" id="811bcbca" width="300" height="243"></figure>      <p id="932bb014">With&nbsp;<i id="153e722a">Control/Cmd + Up</i> select the placeholder xml element:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 58 42" title="Sni mek obrazovky 2018 12 18 v 12 58 42" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-58-42.png" id="81a2e981" width="300" height="252"></figure>      <p id="e9017981">Then insert a&nbsp;COPY_SRCL macro to loop through all the shapes of a&nbsp;<i id="291376c2">Canvas</i> and trigger their reduction rules:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 59 28" title="Sni mek obrazovky 2018 12 18 v 12 59 28" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-59-28.png" id="8a9174b4" width="500" height="660"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 59 40" title="Sni mek obrazovky 2018 12 18 v 12 59 40" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-59-40.png" id="6b0b2f28" width="500" height="984"></figure>      <p id="1918b499">The&nbsp;<i id="e3cdc92d">name</i> of the generated xml file can also be customized using a&nbsp;<b id="21eaf1c0">property macro</b>.</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 14 40 49" title="Sni mek obrazovky 2018 12 18 v 14 40 49" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-14-40-49.png" id="fe14657e" width="500" height="704"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 14 40 57" title="Sni mek obrazovky 2018 12 18 v 14 40 57" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-14-40-57.png" id="9636a6a1" width="500" height="504"></figure>      <p id="9414b432">Reduction rules for&nbsp;<i id="01ea48b8">Square</i> and&nbsp;<i id="bb16b795">Circle</i> now need to be created:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 12 59 57" title="Sni mek obrazovky 2018 12 18 v 12 59 57" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-12-59-57.png" id="057212ed" width="500" height="1520"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 00 20" title="Sni mek obrazovky 2018 12 18 v 13 00 20" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-00-20.png" id="95613883" width="500" height="836"></figure>      <p id="9fa25bca">The templates for <i id="def1b8cd">Circle</i> and&nbsp;<i id="6e02f4e8">Square</i> must hold an&nbsp;<i id="5ccf7ece">XmlElement</i> as their root:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 01 32" title="Sni mek obrazovky 2018 12 18 v 13 01 32" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-01-32.png" id="d2adc213" width="500" height="722"></figure>      <p id="cc227872">Then the xml template must be fully constructed:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 02 04" title="Sni mek obrazovky 2018 12 18 v 13 02 04" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-02-04.png" id="655ab2fa" width="500" height="794"></figure>      <p id="b0f22432">A&nbsp;<b id="6f13a9ec">template fragment</b> must be created around the whole xml code:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 02 48" title="Sni mek obrazovky 2018 12 18 v 13 02 48" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-02-48.png" id="bc88b3e4" width="500" height="520"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 03 07" title="Sni mek obrazovky 2018 12 18 v 13 03 07" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-03-07.png" id="218667e4" width="300" height="227"></figure>      <p id="528bbbbf">The&nbsp;<b id="7b654d57">TF</b> symbols indicate the&nbsp;<b id="a0638c0f">template fragment</b>:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 03 16" title="Sni mek obrazovky 2018 12 18 v 13 03 16" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-03-16.png" id="368e5799" width="500" height="520"></figure>      <p id="28581a23">Property macros should be used to parametrize the template:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 03 27" title="Sni mek obrazovky 2018 12 18 v 13 03 27" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-03-27.png" id="9a4fbb79" width="500" height="640"></figure>      <p id="46e2314b">The property macro must be further specified in the&nbsp;<b id="1cfae3f7">Inspector</b> so that the correct value is used and converted from&nbsp;<b id="c6ef3097">integer</b> to&nbsp;<b id="80e2808f">string</b>:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 04 02" title="Sni mek obrazovky 2018 12 18 v 13 04 02" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-04-02.png" id="539b6f96" width="500" height="948"></figure>      <p id="0f06c8ad">The same must be repeated for the&nbsp;<i id="559c4175">y</i> xml attribute.</p>   <p id="f0ef42a3">For radius, we will use a dedicated xml element:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 05 08" title="Sni mek obrazovky 2018 12 18 v 13 05 08" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-05-08.png" id="f9b33f80" width="500" height="544"></figure>            <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 05 25" title="Sni mek obrazovky 2018 12 18 v 13 05 25" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-05-25.png" id="01d613df" width="500" height="942"></figure>      <p id="af42a804">And quire similarly for the&nbsp;<i id="29fe907e">color</i>&nbsp;reference:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 07 31" title="Sni mek obrazovky 2018 12 18 v 13 07 31" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-07-31.png" id="86539a91" width="500" height="1024"></figure>      <p id="2ba33a9c">The template for<i id="a9eb7ac0">&nbsp;Square</i>&nbsp;will be very similar:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 09 27" title="Sni mek obrazovky 2018 12 18 v 13 09 27" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-09-27.png" id="f68cc2b8" width="500" height="1054"></figure>      <p id="ff271b19">The generator should be holding four root nodes now:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 09 53" title="Sni mek obrazovky 2018 12 18 v 13 09 53" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-09-53.png" id="34c30e08" width="500" height="328"></figure>      <p id="12b99af6">When you rebuild your language and preview the generated code for your sandbox, you should be getting an xml file similar to this:</p>         <figure><img alt="Sni mek obrazovky 2018 12 18 v 13 10 22" title="Sni mek obrazovky 2018 12 18 v 13 10 22" src="/help/img/idea/2019.1/Sni-mek-obrazovky-2018-12-18-v-13-10-22.png" id="61b46278" width="500" height="884"></figure>      <h2 id="whattodonext">What to do next</h2>   <p id="89c059cf">Congratulations! You've just completed your introductory tutorial into MPS.</p>   <p id="1f744522">Now you can continue on your own adding more shapes to the language. Point, Line, Triangle, Rectangle or shapes with colorful fills might be nice additions to our little language.</p>   <p id="aba5c0c8">If you want to understand MPS more thoroughly, it might be a good time to try the in-depth&nbsp;<a href="/help/mps/3.4/mps-calculator-language-tutorial.html" data-external="true" target="_blank" rel="noopener noreferrer">Calculator Tutorial</a>, which explores many of the advanced concepts and will teach you much more about code generation, type-system and scoping.</p><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="mps-tutorials.html">Tutorials</a><a class="navigation-links__next" href="mps-calculator-language-tutorial.html">MPS Calculator Language Tutorial</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>