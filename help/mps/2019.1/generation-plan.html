<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Generation plan - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Generation+plan.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Generation+plan.html" id="generation-plan.xml">Generation plan</h1>         <h2 id="generationplan">Generation plan</h2>      <p id="4d90ddfa">Generation plans allow developers to specify the desired order of generation for their models explicitly and thus gain better control over the generation process.</p>      <h3 id="motivation">Motivation</h3>      <p id="2ea883f0">Specifying mutual generator priorities may become cumbersome for larger projects. Additionally, in order to specify the priorities the involved languages need to know about one another by declaring appropriate mutual dependencies, which breaks their (sometimes desired) independence. Generation plans put the responsibility of proper ordering of generation steps into a single place - the generation plan. They allow language designers to provide intuitive means for end-user models to be processed in a desired order. Generation plans list all the languages that should be included in the generation process, order them appropriately and optionally specify checkpoints, at which the generator shall preserve the current transient models. These models can then be used for automatic cross-model reference resolution further down the generation process.</p>      <p id="1ba0fe38">&nbsp;</p>      <aside class="tip sideblock" data-title="" rel="1ba0fe38" id="e151b323">         <p id="a39122cd">The mechanism described here is a preliminary implementation that is likely to be further evolved in the following MPS versions. The general direction is:</p>         <ul class="list _ul"><li class="list__item" id="3b181634"><p>to give more flexibility to the language designers in how they organize builds for users of their languages</p></li><li class="list__item" id="9c5f1f61"><p>to relieve the end-developers (aka language users) from the need to handle directly build plans, genplan models or build facets</p></li></ul>         <p id="3d93dbb1">So the actual end-user mechanism is likely to become more dependent on the language designer's intentions. The approach described here, based on facet and a <b id="babac985">genplan</b> model, is a mere sample of how to accomplish custom generation.</p>      </aside>      <h3 id="definingagenerationplan">Defining a generation plan</h3>      <p id="bff4cbf3">In order to create a&nbsp;<b id="c13b2928">generation plan</b>, you first need to create a model. You may consider giving the model a&nbsp;<b id="e5bcbb31">genplan</b>&nbsp;stereotype to easily distinguish it from ordinary models, but this is not mandatory.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan4.png"><img alt="genplan4" title="genplan4" src="/help/img/idea/2019.1/genplan4.png" id="4d880f7b" width="300" height="476"></a></figure>            <p id="d1e0e4f1">After importing the&nbsp;<i id="bc5fa639">jetbrains.mps.lang.generator.plan</i> and&nbsp;<i id="855e23ab">jetbrains.mps.lang.smodel</i> languages, you can create root node of the&nbsp;<i id="77047dbd">Plan</i> concept, which will represent your generation plan:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan5.png"><img alt="genplan5" title="genplan5" src="/help/img/idea/2019.1/genplan5.png" id="94adc2c6" width="300" height="402"></a></figure>            <p id="86cd67f5">The generation plan consists of&nbsp;<b id="92a7ff5e">transforms</b> and&nbsp;<b id="c5c34d16">checkpoints</b>.</p>               <figure><img alt="genplan1" title="genplan1" src="/help/img/idea/2019.1/genplan1.png" id="ca24f9c2" width="500" height="197"></figure>            <p id="0dfac347">It is also possible to specify the required generators explicitly.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/Gen2.png"><img alt="Gen2" title="Gen2" src="/help/img/idea/2019.1/Gen2.png" id="8c6fbb06" width="500" height="922"></a></figure>            <p id="d07a37e9">         <b id="dd1347f2">Transforms</b> represent generation steps and include languages that should be generated as part of that generation phase.</p>      <p id="37aca072">         <b id="c08c55b3">Apply</b> represents an explicit invocation of a particular generator.&nbsp;&nbsp;The&nbsp;<i id="af271239">apply with extended</i>&nbsp;statement applies in a single step&nbsp;the specified generators and those that extend them. This allows the language designer to accommodate for possible extensions.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/Gen2.png"><img alt="Gen2" title="Gen2" src="/help/img/idea/2019.1/Gen2.png" id="04cca9d6" width="500" height="922"></a></figure>            <p id="6de63c92">         <b id="fa90253e">Fork with</b> enables the plan to fork the generation process and fork off another generation plan.</p>               <img alt="ForkG" title="ForkG" src="/help/img/idea/2019.1/ForkG.png" id="a05e391a" width="500">            <p id="85c376e3">The referenced generation plan will start with a copy of the&nbsp;model in the state it was at the fork step and proceeds as a regular transformation.&nbsp;From this point the two generators will run independently.</p>      <p id="31d0b168">         <b id="8cf7dbda">Checkpoints</b> represent points during the generation, at which the intermediate models should be preserved. References that will be resolved later in the generation will be able to look-up nodes in the stored intermediate models for their resolution through&nbsp;<b id="8885e2f7">mapping labels</b>. You can view these checkpoint models in the&nbsp;<b id="633025da">Project View</b> tool window:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan9.png"><img alt="genplan9" title="genplan9" src="/help/img/idea/2019.1/genplan9.png" id="b24064bc" width="300" height="786"></a></figure>            <p id="d1d36d3c">&lt;TODO - may be this is no longer valid&gt; These intermediate checkpoint models are preserved until you shutdown MPS or until you rebuild the models or the models that they depend on. Alternatively you can remove them manually:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan10.png"><img alt="genplan10" title="genplan10" src="/help/img/idea/2019.1/genplan10.png" id="5b9cecb8" width="300" height="250"></a></figure>            <p id="331d7943">Checkpoints provide synchronization points between different plans. The checkpoint models are denoted with a stereotype that matches the name of a checkpoint the model has been created with. Models are persisted alongside the generated sources using the naming scheme of &lt;plan-name&gt;-&lt;checkpoint name&gt;.&nbsp;</p>      <p id="9694c255">Distinct statements allow for capturing different aspects of a checkpoint.</p>      <ul class="list _ul"><li class="list__item" id="e67a0a19"><p>            <i id="65940e6c">declare checkpoint &lt;name&gt;</i>&nbsp;statement - specify a label that generator plans could share among themselves. This statement does not record/persist the state of the transformed model, it is a mere declaration that other generation plans will be able to refer to.<i id="0dde9337"></i>         </p></li><li class="list__item" id="128f348a"><p>            <i id="2b9f68a4">checkpoint &lt;checkpoint&gt;</i>&nbsp;-&nbsp;records/persists the state of the transformed model. It can either declare a checkpoint in-place&nbsp;or refer to a&nbsp;<i id="1ae3ba6a">declared checkpoint</i>.</p></li><li class="list__item" id="66726eb5"><p>            <i id="180ef207">synchronize with &lt;checkpoint&gt;</i>&nbsp;statements - &nbsp;instructs the generation plan to look up the target nodes in persisted models of the specified checkpoint, but do not persist its own nodes (read-only access to the check-point). This statement doesn't introduce any new state, but references a checkpoint declared elsewhere.</p></li></ul>               <figure><a class="lightbox" href="/help/img/idea/2019.1/Gen1.png"><img alt="Gen1" title="Gen1" src="/help/img/idea/2019.1/Gen1.png" id="dcafadc9" width="500" height="894"></a></figure>            <h3 id="specifyingagenerationplanformodels">Specifying a generation plan for models</h3>      <p id="c803a438">Modules that should have their models built following a generation plan need to enable the&nbsp;<b id="749aeb12">Custom generation</b> facet and point to the actual desired<b id="5a0a8771"> generation plan</b>:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan2.png"><img alt="genplan2" title="genplan2" src="/help/img/idea/2019.1/genplan2.png" id="35e402fa" width="500" height="565"></a></figure>            <p id="b05d9f49">&nbsp;<figure><a class="lightbox" href="/help/img/idea/2019.1/genplan3.png"><img alt="genplan3" title="genplan3" src="/help/img/idea/2019.1/genplan3.png" id="985ebab3" width="500" height="960"></a></figure>      </p>      <h3 id="verifyingthegenerationplan">Verifying the generation plan</h3>      <p id="1998f8fc">The&nbsp;<b id="375d8298">Show generation plan</b> action in the models' pop-up menu will correctly take the&nbsp;<b id="01298089">generation plan</b> into account when building the outline for the generation:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan7.png"><img alt="genplan7" title="genplan7" src="/help/img/idea/2019.1/genplan7.png" id="84ffafa5" width="300" height="550"></a></figure>                     <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan6.png"><img alt="genplan6" title="genplan6" src="/help/img/idea/2019.1/genplan6.png" id="85539b7e" width="500" height="1356"></a></figure>            <p id="adeee6ca">To view the original, on generator priorities based, generation plan that would be used without the explicit&nbsp;<b id="07f49c89">generation plan</b> script, hold the&nbsp;<i id="175b5945">Alt</i> key while clicking the&nbsp;<i id="5743dbf8">Show Generation Plan</i> menu entry:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan7.png"><img alt="genplan7" title="genplan7" src="/help/img/idea/2019.1/genplan7.png" id="c988c85b" width="300" height="550"></a></figure>                     <figure><a class="lightbox" href="/help/img/idea/2019.1/genplan8.png"><img alt="genplan8" title="genplan8" src="/help/img/idea/2019.1/genplan8.png" id="cd30f093" width="500" height="1512"></a></figure>                     <i id="22b3a530">Note that the report states in the header that it is not the currently active plan.</i>            <h3 id="usingdevkitstoassociateagenerationplan">Using DevKits to associate a generation plan</h3>      <p id="7ad9017d">DevKits can associate a generation plan, as well.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/devkit1.png"><img alt="devkit1" title="devkit1" src="/help/img/idea/2019.1/devkit1.png" id="0611fb69" width="500" height="490"></a></figure>            <p id="dc4c0fa3">First add dependencies on languages and solutions that the DevKit should be wrapping. Then specify the&nbsp;<b id="239af245">Generation plan</b> from within the imported solutions, which will be associated with the DevKit.&nbsp;Any <b id="1cc1f7c5">model</b> that imports that DevKit will get the DevKit's associated generation plan applied to it.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/devkit2.png"><img alt="devkit2" title="devkit2" src="/help/img/idea/2019.1/devkit2.png" id="ceef0902" width="500" height="383"></a></figure>            <aside class="warning " data-title="" rel="5af0ef29" id="f6bb40ee">         <p id="47a6db60">Only one DevKit with a plan is allowed per model at the moment.</p>      </aside>      <h3 id="cross-modelgeneration">Cross-model generation</h3>      <p id="6651371f">         <b id="138d78df">Model</b>&nbsp;is the unit of generation in MPS. All entities in a single model are generated together and references between the nodes can be resolved with&nbsp;<b id="ed8f02c7">reference macros</b>&nbsp;and&nbsp;<b id="979ba273">mapping labels</b>. Mapping labels, however, are not by default accessible from other models. This complicates generation of references that refer to nodes from other models. Fortunately, regular <b id="9b164250">mapping labels</b> can support mutually independent generation of models with cross-references, if the models share a&nbsp;<b id="5193b8bf">generation plan</b>. The mechanism leverages checkpoints to capture the intermediate transient models and then use them for reference resolution.</p>      <p id="764db5a8">In essence, to preserve cross-model references when generating multiple models, make sure that your models share a&nbsp;<b id="8f2ab0de">generation plan</b>. That&nbsp;<b id="07c1abd3">generation plan</b> must define checkpoints at moments, when the <b id="d5e219a7">mapping labels</b> that are used for cross-model reference resolution have been populated. The rest will be taken care of automatically. The reference macros can resolve nodes from&nbsp;<b id="ca6e8fd6">mapping labels</b> through the usual&nbsp;<i id="0deff6d3">genContext.get output by label and input</i> (for nodes generated through reduction or root mapping rules) or&nbsp;<i id="3f47b93d">genContext.get output for model</i> (for nodes generated through conditional root mapping rules) ways.</p>      <h3 id="linkingcheckpointmodels">Linking checkpoint models</h3>      <p id="950522cb">Models created at checkpoints now keep a reference to the previous checkpoint model in the sequence. This helps the Generator discover mapped nodes matching input that spans several generator phases.</p>      <h3 id="debuginformationinthecheckpointmodels">Debug information in the checkpoint models</h3>      <p id="231b6244">To ease debug of cross-model generation scenarios, a dedicated root inside each&nbsp;<b id="1ec6ef86">checkpoint model</b>&nbsp;lists the mapping label names along with pointers to the stored input and output nodes. Investigation of the mapping labels exposed at each checkpoint can substantially help debugging cross-model generation scenarios and fix unresolved references. Thus, next time your cross-model reference doesn't resolve, inspect corresponding checkpoint model to see if there's indeed a label for your input.</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/checkpoints1.png"><img alt="checkpoints1" title="checkpoints1" src="/help/img/idea/2019.1/checkpoints1.png" id="39b6845f" width="300" height="362"></a></figure>            <aside class="tip sideblock" data-title="" rel="f56f02f4" id="325d8f41">         <p id="6eb9ba15">A <a href="https://youtu.be/ktTzOg297ZQ" data-external="true" target="_blank" rel="noopener noreferrer">video</a> on setting a generation plan for a solution as well as for a DevKit is available.</p>      </aside>      <h2 id="generatinglanguagedescriptormodels">Generating language descriptor models</h2>      Generation plans have been enhanced to generate descriptor models for languages (known as&nbsp;<code class="code">&lt;language.name&gt;@descriptor</code>).&nbsp;The&nbsp;structure, textgen, typesystem, dataflow and constraints aspects are now generated with generation plans and they use the new cross-model reference resolution mechanism.      Custom aspects defined by language authors can join the generation plan, as well. If you got a custom aspect, you should make sure that its generator extends the generator of&nbsp;<code class="code">jetbrains.mps.lang.descriptor</code>&nbsp;language, as this is the way to get custom extensions activated for the plan.      <p id="4450a26e">&nbsp;</p>               <br>         <div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="mapping-priorities.html">Mapping Priorities</a><a class="navigation-links__next" href="generator-demos.html">Generator Demos</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>