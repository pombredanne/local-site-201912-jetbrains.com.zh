<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Commenting out nodes - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Commenting+out+nodes.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Commenting+out+nodes.html" id="commenting-out-nodes.xml">Commenting out nodes</h1>   <h2 id="genericsupportforcommentingoutnodesinmps">Generic support for commenting out nodes in MPS</h2>   <p id="f40a0d28">MPS provides a universal way to comment out nodes in models. In previous versions this functionality had to be implemented in all languages separately, either through node attributes or dedicated comment nodes. Since MPS 3.3 the information about a node being commented out is stored in the model in a generic way. The <i id="62b0092c">smodel</i> language ignores commented out nodes by default so that your queries do not have to filter out commented out nodes explicitly.<br>Additionally, actions have been created to comment/uncomment out a node by hitting "<i id="4dda916b">Control/Cmd + /</i>".</p>   <aside class="tip sideblock" data-title="" rel="f40a0d28" id="39714df5">      <p id="abf6f234">You can watch a <a href="https://youtu.be/mZv7PQH8nsY" data-external="true" target="_blank" rel="noopener noreferrer">short screen-cast on generic commenting out</a> that explains the feature and describes the customization options.</p>   </aside>   <h3 id="howtouseit">How to use it</h3>   <aside class="warning " data-title="" rel="howtouseit" id="8f82b4ba">      <p id="32232b5d">In the previous versions of MPS language authors had to provide their own implementations of the comment-out functionality for their languages. Thus it may happen that the old language-specific functionality will clash with the new generic functionality of MPS 3.3, especially the keyboard shortcut <i id="6b6f471f">Control/Cmd + /</i> is now taken by the generic comment-out action and will not work for the specific implementations, if they were using this keyboard shortcut before. It is advisable for the language authors to:</p>      <ol class="list _decimal"><li class="list__item" id="00e0a4ea"><p>choose a different key combination to trigger the specific comment out/uncomment functionality</p></li><li class="list__item" id="59dd0635"><p>deprecate the custom comment-out functionality</p></li><li class="list__item" id="bcff5d13"><p>customize the generic comment-out functionality</p></li><li class="list__item" id="d52129ba"><p>provide a migration that automatically replaces usages of the custom comment-out functionality with the generic one</p></li><li class="list__item" id="05529336"><p>eventually remove the custom comment-out functionality</p></li></ol>      <p id="65dc94c2">A semi-automated migration process is available in MPS 3.3 to help you migrate painlessly. Please check out the <a href="">Migrating away from your custom commenting out functionality</a> section below.</p>      <p id="1b6e31b5">&nbsp;</p>   </aside>   <p id="efd0ccbc">&nbsp;</p>   <p id="8df39d40">You can select any node in MPS, except roots, and press <i id="9c9af86b">Control/Cmd + /</i>. That node will be commented out.&nbsp;Lets watch some examples:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/mps-comment1.png"><img alt="mps comment1" title="mps comment1" src="/help/img/idea/2019.1/mps-comment1.png" id="0abd3d93" width="500" height="514"></a></figure>      <p id="ce2dc95a">The node that you select or point the cursor at will get commented out.&nbsp;Every single non-root node can be commented out - irrespective of whether it occupies a whole line, several lines, or whether it is nested deeply in an expression-like hierarchy.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/mps-comment2.png"><img alt="mps comment2" title="mps comment2" src="/help/img/idea/2019.1/mps-comment2.png" id="dc046656" width="580" height="512"></a></figure>      <br>       <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment3.png"><img alt="Comment3" title="Comment3" src="/help/img/idea/2019.1/Comment3.png" id="fb075ecb" width="580" height="514"></a></figure>      <p id="89cfc8ba">If you comment out a node, it will be physically removed from its place in the model. If the commented out node occupied a requested child link, an empty cell is provided so that the user can fill in a new child value.<br>       <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment4.png"><img alt="Comment4" title="Comment4" src="/help/img/idea/2019.1/Comment4.png" id="c26860f1" width="900" height="510"></a></figure>   </p>   <p id="745ec2e3">In <i id="55bb339b">BaseLanguage</i>, for example, this gives you possibilities beyond what the Java parsers allows.&nbsp;You can comment out an IfStatements condition:</p>         <figure><img alt="Comment5" title="Comment5" src="/help/img/idea/2019.1/Comment5.png" id="7b831d8f" width="280" height="53"></figure>      <p id="cfdce90e">a method parameter:</p>         <figure><img alt="Comment6" title="Comment6" src="/help/img/idea/2019.1/Comment6.png" id="4fff70af" width="405" height="63"></figure>      <p id="9be54bb9">or a variable type:</p>   <p id="e783179e">      <img alt="Comment7" title="Comment7" src="/help/img/idea/2019.1/Comment7.png" id="d92bd774" width="205" height="22" class="inline-icon-205">      <br>To give another example, the editor definition language allows you to comment out an editor cell, for example:</p>         <img alt="Comment8" title="Comment8" src="/help/img/idea/2019.1/Comment8.png" id="cc99b75c" width="429" height="23" class="inline-icon-429">      <aside class="tip sideblock" data-title="" rel="725851d4" id="02186ef2">      <p id="c2aea223">To uncomment a commented out node you simply press Control/Cmd + / while positioned on it.</p>   </aside>   <h3 id="smartcommentingout">Smart commenting out</h3>   <p id="4faa2608">The comment and uncomment actions have some intelligence in them in order to decide, which node to comment/uncomment.</p>   <ul class="list _ul"><li class="list__item" id="25377897"><p>if a node or a set of nodes is selected, this node/nodes will be commented out/uncommented</p></li><li class="list__item" id="d04aee7a"><p>if no node is selected, the editor attempts to comment out/uncomment the current "line" - to achieve this a search starts in the node under caret to identify the closest ancestor vertical collection and an ancestor of the node under caret that is a member of this vertical collection will be commented out/uncommented</p></li></ul>   <aside class="tip sideblock" data-title="" rel="d253e06c" id="ce5d914b">      <p id="62291dbb">You may get finer-grained control over the mechanism of detecting the ancestor line of the node under caret - simply define a handler for the <i id="b1128d74">COMMENT</i> action on a collection of cells as follows:</p>               <figure><a class="lightbox" href="/help/img/idea/2019.1/commentLine2.png"><img alt="commentLine2" title="commentLine2" src="/help/img/idea/2019.1/commentLine2.png" id="93c6e306" width="100" height="1040"></a></figure>                     <figure><a class="lightbox" href="/help/img/idea/2019.1/commentLine3.png"><img alt="commentLine3" title="commentLine3" src="/help/img/idea/2019.1/commentLine3.png" id="e6def445" width="100" height="636"></a></figure>         </aside>   <h3 id="howdoesitworkinthemodel">How does it work in the model</h3>   <p id="7500a591">When a node is commented out, it is placed as a child (wrapped) in a special child attribute, called <i id="15151b22">BaseCommentAttribute</i>. Then the instance of this attribute is attached to the commented nodes link in the former parent of the commented node.&nbsp;A <i id="92dd4f70">ChildAttribute</i> is same as the <i id="924a1d4c">LinkAttribute</i>&nbsp;concept, except that <i id="e6db7175">ChildAttribute</i>&nbsp;gets attached to aggregation links.&nbsp;So the commented nodes are not stored as the usual children, and they won't appear normal queries for child roles. Also, the <i id="39a4b430">node.children</i> operation ignores commented out nodes.      Use <i id="98caecda">node.childrenAndChildAttributes&lt;role&gt;</i> to collect children from comments as well. The <i id="a5951000">node.descendants</i> operation currently returns the commented out nodes, which may change in the future version of MPS to make it consistent with the <i id="aabe117b">node.children</i> operation.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment9.png"><img alt="Comment9" title="Comment9" src="/help/img/idea/2019.1/Comment9.png" id="7250887e" width="600" height="1088"></a></figure>      <p id="6a728fde">The MPS editor knows about comments and it will draw children as well as the commented out nodes, in this role.</p>   <aside class="tip sideblock" data-title="" rel="6a728fde" id="5e62cc37">      <p id="81c8701d">The&nbsp;<i id="da194b6c">BaseCommentAttribute</i> annotation comes from&nbsp;<i id="08c5aaef">jetbrains.mps.lang.core</i>, so this language needs to be listed among used languages in models that contain commented out nodes.</p>   </aside>   <h3 id="queryingforcommentednodes">Querying for commented nodes</h3>   <p id="be40e17c">The <i id="4907583c">smodel</i>&nbsp;language gives you options to query for the commented nodes. You use the same syntax that works for any attributes, only that the <i id="49fdc004">comment</i>&nbsp;attribute allows for parametrization by the containment link. For example, if a <i id="d83264c7">node</i>&nbsp;has a child collection named <i id="7a7f8714">commands</i>, querying whether any of the <i id="45a4b2d9">commands</i>&nbsp;children has been commented out would look like:</p>   <div class="code-block" data-lang="none">node.@comment&lt;commands&gt;.isNotEmpty</div>   <h3 id="customization">Customization</h3>   <p id="867e7259">By default every commented node is drawn surrounded by <i id="f4042f87">/* */</i>. You can override the visual appearance of a commented out node by defining a custom <b id="306b2fb1">commented editor</b> for the concept.&nbsp;Just define the usual editor with the hint <i id="9554b0b5">comment</i>:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment10.png"><img alt="Comment10" title="Comment10" src="/help/img/idea/2019.1/Comment10.png" id="3bb241ca" width="300" height="482"></a></figure>      <aside class="tip sideblock" data-title="" rel="70e2218b" id="ea1dd423">      <p id="09835186">For the <b id="bf24fcfb">comment</b> hint to be available, your editor model needs to import the <i id="94df432b">jetbrains.mps.lang.core.editor</i> model.</p>   </aside>   <p id="8429ede9">The style of the editor should be changed so that the user can easily visually distinguish commented code.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Commentx1.png"><img alt="Commentx1" title="Commentx1" src="/help/img/idea/2019.1/Commentx1.png" id="4e0ea4b2" width="500" height="486"></a></figure>      <p id="a9967224">You can either re-use the pre-defined&nbsp;<i id="13851f73">Comment</i> style, which uses a gray color with italics style, or you may create your own style for commented out nodes.</p>   <p id="e9f1d4e3">      <b id="d8596307">Note:</b> The children of the commented node should be drawn with their usual editor so you need to remove the comment hint in child cells:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment11.png"><img alt="Comment11" title="Comment11" src="/help/img/idea/2019.1/Comment11.png" id="afa5413a" width="500" height="1398"></a></figure>      <h3 id="easiercustomization">Easier customization</h3>   <p id="a05913c7">The&nbsp;<b id="afda6040">next applicable editor</b> cell gives you a more convenient way to customize the look of commented out nodes - you may address several concepts in a hierarchy with a single customized comment editor.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Commxy1.png"><img alt="Commxy1" title="Commxy1" src="/help/img/idea/2019.1/Commxy1.png" id="392ef20f" width="500" height="284"></a></figure>      <br>      <p id="af5eae61">The <b id="9b71c492">next applicable editor</b>&nbsp;cell simply removes the <b id="0ce76709">comment</b>&nbsp;hint and redirects the request to find the original editor of the concept (<i id="30fbad2b">IfStatement</i>). This avoids the need for repetition of the editor definition. You may further simplify the task, if&nbsp;you define a single editor bound to the<b id="80c39bc0"> comment</b> hint for a common super-concept - this way all sub-concepts will get the customized comment editor.</p>   <h3 id="commentingout/uncommentingnodesfromcode">Commenting out/uncommenting nodes from code</h3>   <p id="1d17c8e9">The&nbsp;<i id="c6aeae00">CommentUtil</i> class from&nbsp;<i id="c1a72f29">jetbrains.mps.editor.runtime</i> can be used to comment out and uncomment nodes from code, such as actions, intentions or key maps. This gives you options to further customize the behavior of commented out nodes.</p>   <p id="746bfd7a">The&nbsp;<i id="5fdc6c77">CellAction_CommentOrUncomment&nbsp;</i>and its inheritors&nbsp;class come from the same package. They give you the way to simply comment the node and restore the selection or uncomment the node if it is currently commented.</p>   <h3 id="thecommenteditoraction">The Comment editor action</h3>   <p id="5c5103e0">The response to the comment/uncomment action can also be customized on the node level. You can set the handler for&nbsp;<b id="90e280c5">COMMENT</b>&nbsp;action in the cell's action map:</p>         <figure><img alt="disable commenting" title="disable commenting" src="/help/img/idea/2019.1/disable_commenting.png" id="4ac5d02f" width="700" height="538"></figure>      <p id="5cb7e1ba">For example, if we want to prevent the user from commenting out conditions in the robot's Kaja&nbsp;<i id="47315835">While</i>&nbsp;statement, we attach the above action map to the While editor's cell representing the&nbsp;<i id="fa93fb05">condition</i>      <b id="1a42a4f0">:</b>   </p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Comment13.png"><img alt="Comment13" title="Comment13" src="/help/img/idea/2019.1/Comment13.png" id="5089c23b" width="500" height="910"></a></figure>      <p id="80819084">Since the&nbsp;<b id="3f16bd56">COMMENT</b>&nbsp;action is customized it will do what is indicated.</p>   <p id="173ff5c6">The action will work only if the&nbsp;<i id="6ec6fd84">condition&nbsp;</i>node is selected.</p>   <p id="a27e1c00">Since we create the&nbsp;<i id="7868e027">CellAction_CommentOrUncommentNode&nbsp;</i>with the&nbsp;<i id="e0128254">node&nbsp;</i>as the parameter, where the&nbsp;<i id="345fda19">node</i>&nbsp;is the&nbsp;<i id="33816417">While</i>&nbsp;statement, the action will process the&nbsp;<i id="cd6cb8dc">While</i>&nbsp;statement:</p>   <p id="624c74ef">1) If it is not commented, the action will comment it out.</p>   <p id="dfec0703">2) If it is commented out, the action will uncomment it.</p>   <p id="d4632d54">Thus the commenting of the&nbsp;<i id="82e207b3">condition&nbsp;</i>will be disabled.</p>      <h2 id="migratingawayfromyourcustomcommentingoutfunctionality">Migrating away from your custom commenting out functionality</h2>   <p id="7efa841d">In versions prior to MPS 3.3 language authors had to implement the comment out functionality themselves for each language individually. In MPS 3.3 the custom functionality may be redundant and should be replaced by the generic functionality provided by MPS, perhaps with some customization as described above.&nbsp;The existing usages of the old custom commenting-out functionality should be migrated to the generic version, which should be done in several steps:</p>   <ol class="list _decimal"><li class="list__item" id="4ddabb2b"><p>Your old concepts used for commenting out should be deprecated</p></li><li class="list__item" id="7013e84a"><p>Your keyboard shortcuts, actions and intentions for commenting out/uncommenting should be deprecated or removed</p></li><li class="list__item" id="cb6105ea"><p>You may wish to customize the look of commented out nodes by defining custom editors attached to the "comment" editor hint (as described above)</p></li><li class="list__item" id="5febad45"><p>You may also wish to disable the generic comment out functionality on some editor cells (as described above)</p></li><li class="list__item" id="5a1e3534"><p>You may need to provide a migration that will automatically translate usages of your old custom commented nodes in user code into nodes commented in the generic way. This can be done either fully manually or with MPS assistance.<br>      </p></li></ol>   <h3 id="mps-assistedmigration">MPS-assisted migration</h3>   <p id="dfedd545">MPS can create a&nbsp;<i id="06690ba5">Migration</i> for you, provided you indicate, which concepts represent the old custom comments using the&nbsp;<i id="d0c97896">IOldCommentAnnotation</i> and&nbsp;<i id="62ccaea7">IOldCommentContainer</i>. Since there were two typical ways to create custom comments in the past, there need to be two interface:</p>   <ul class="list _ul"><li class="list__item" id="cd144b30"><p>         <i id="cc01bdf9">IOldCommentAnnotation</i> - should be implemented by the&nbsp;<i id="d524257a">NodeAttribute</i> that indicates a node is commented out, if attributes were used annotate commented out nodes<br>      </p></li><li class="list__item" id="f8c56973"><p>         <i id="e24f59f3">IOldCommentContainer</i> - in case commented nodes were represented by a dedicated concept, such as&nbsp;<i id="bb4a5bc9">SingleLineComment</i>, these dedicated concepts should be marked with this concept interface</p></li></ul>   <p id="a7eaaff3">These marker concept interfaces come from&nbsp;<i id="59a6aed4">jetbrains.mps.lang.core</i>, so this language needs to extended by your language in order to use them. Once annotated, the generic comment-out functionality will be ceased on the nodes of these concepts in favor of the old custom comment out functionality.</p>   <p id="ce2325c7">Additionally, the old commenting-out concepts will have warnings reported on them -&nbsp;<b id="317fe282">Old comment container should be migrated</b> or&nbsp;<b id="d9dd5ee1">Old comment annotation should be migrated</b>. The quick-fixes for these warnings will create the necessary migrations to convert your old custom commenting-out scheme into the generic one painlessly. Just trigger the quick fixes, check the generated migrations and then migrate your projects.</p>   <h3 id="fullymanualmigration">Fully manual migration</h3>   <p id="20ba7955">You may create the migration fully manually. Typically all that your migration needs to do is to find all nodes being commented out in the old custom way, uncomment them and call&nbsp;<i id="8707ffd2">CommentUtil.comment()</i>&nbsp;on each node to get it commented out in the new way. The&nbsp;<i id="c0fcc679">CommentUtil</i>&nbsp;class comes from&nbsp;<i id="303ef908">jetbrains.mps.editor.runtime</i>.</p>   <p id="cdfa03f8">The generic comment out functionality marks commented out nodes with the&nbsp;<i id="1b78d7bb">BaseCommentAttribute</i> annotation that is attached to the parent of the commented-out node, holds the original role of the commented out node and comes from&nbsp;<i id="97d29330">jetbrains.mps.lang.core</i>, so this language needs to be used in models that contain commented out nodes. An automatic migration should add such language dependency to all altered models. You may take inspiration from The&nbsp;<i id="b33af63a">ReplaceSingleLineCommentsWithGenericComments</i> migration, which migrated&nbsp;<i id="a9d5efd0">SingleLineComment</i> nodes in <i id="e9fe8159">BaseLanguage</i>:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Mig1.png"><img alt="Mig1" title="Mig1" src="/help/img/idea/2019.1/Mig1.png" id="89336caf" width="900" height="978"></a></figure>            <figure><a class="lightbox" href="/help/img/idea/2019.1/Mig2.png"><img alt="Mig2" title="Mig2" src="/help/img/idea/2019.1/Mig2.png" id="31f03daa" width="500" height="354"></a></figure>      <br>            <br>      <p id="cdb3586c">&nbsp;</p><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="requirement-tracking-language.html">Requirement tracking language</a><a class="navigation-links__next" href="common-language-patterns.html">Common language patterns</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>