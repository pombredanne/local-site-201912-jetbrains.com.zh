<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Constraints - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Constraints.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Constraints.html" id="constraints.xml">Constraints</h1>   <p id="a0640f03">The <i id="e73bfc5e">Structure Language</i> may sometimes be insufficient to express advanced constraints on the language structure. The <i id="f307dc05">Constraints</i> aspect gives you a way to define such additional constraints.</p>      <h2 id="defaultconcreteconcept">Default concrete concept</h2>   <p id="8c7e6f7c">For abstract concepts the&nbsp;<i id="6a8aee84">Constraints</i> aspect can be used to indicate, which concept should be used instead when a node of the abstract concept needs to be created.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/image2018-9-12-15-43-19.png"><img alt="image2018 9 12 15 43 19" title="image2018 9 12 15 43 19" src="/help/img/idea/2019.1/image2018-9-12-15-43-19.png" id="1a10a355" width="500" height="612"></a></figure>      <p id="89a8801a">For example, if a child collection is supposed to hold&nbsp;<i id="51307d14">AbstractCommands</i> and the user hits enter to insert a new child into the collection, a node of the&nbsp;<i id="4c280699">EmptyLine</i> concept is created and inserted.</p>   <p id="46cb4b4e">Similarly. the smodel commands that create new nodes and accept the&nbsp;<i id="d39346b6">&lt;default&gt;</i> parameter will correctly create nodes of the concrete concept instead of the abstract one.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/image2018-9-12-15-50-5.png"><img alt="image2018 9 12 15 50 5" title="image2018 9 12 15 50 5" src="/help/img/idea/2019.1/image2018-9-12-15-50-5.png" id="3b96d4f0" width="500" height="102"></a></figure>      <h2 id="canbechild/parent/ancestor/root">Can be child/parent/ancestor/root</h2>   <p id="7dc31157">These are the first knobs to turn when defining constraints for a concept. They determine whether instances of this concept can be hooked as children (parents, ancestors) nodes of other nodes or root nodes in models. You specify them as <i id="f313063f">boolean-returning</i> closures, which MPS invokes each time when evaluating allowed possition for a node in the AST.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/Constraintsx1.png"><img alt="Constraintsx1" title="Constraintsx1" src="/help/img/idea/2019.1/Constraintsx1.png" id="efade99a" width="500" height="846"></a></figure>      <h4 id="languagestoimport">Languages to import</h4>   <p id="6611868b">You will most likely need at least two languages imported in the <i id="107f26b1">constraints</i>&nbsp;aspect in order to be able to define constraints - the <i id="0f7c1f46">j.m.baselanguage</i>&nbsp;and <i id="b2c2d6bf">j.m.lang.smodel</i>&nbsp;languages.&nbsp;</p>   <h4 id="canbechild">can be child</h4>   <p id="ce9bb078">Return false if an instance of the concept is not allowed to be a child of specific nodes.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="d0cb62ae"><thead><tr id="87d74660" class="ijRowHead"><th id="ee689326">            <p id="8798df33">parameter</p>         </th><th id="ca756103">            <p id="25c6c815">description</p>         </th></tr></thead><tbody><tr id="20c4805e" class="ijRowOdd"><td id="68d18ee5">            <p id="ec0e40cf">operationContext</p>         </td><td id="67f8ab13">            <p id="7dbaf5a5">IOperationContext</p>         </td></tr><tr id="7430dbc5" class="ijRowEven"><td id="0ef9359b"><p>node</p></td><td id="b24e62e5"><p>the child node we are checking (instance of this concept)</p></td></tr><tr id="f49770c2" class="ijRowOdd"><td id="ddb2663e">            <p id="af537157">parentNode</p>         </td><td id="64009029">            <p id="89a5cc89">the parent node we are checking</p>         </td></tr><tr id="594f4eb3" class="ijRowEven"><td id="ff33b793">            <p id="16e4e081">childConcept</p>         </td><td id="0e582e90">            <p id="78aad151">concept of the child node (can be a subconcept of this concept)</p>         </td></tr><tr id="b4cf68bf" class="ijRowOdd"><td id="4d045b8e">            <p id="e8792b0a">link</p>         </td><td id="fc24a59f">            <p id="24badb8e">LinkDeclaration of the child node (child role can be taken from there)</p>         </td></tr></tbody></table></div>   <h4 id="canbeparent">can be parent</h4>   <p id="73c73c5b">Return false if an instance of concept is not allowed to be a parent of specific concept node (in a given role).</p>   <div class="table-wrapper"><table class="                 " width="100%" id="97796098"><thead><tr id="e3984641" class="ijRowHead"><th id="0a3c60a3">            <p id="bac6d4a0">parameter</p>         </th><th id="e083be43">            <p id="77e5bbe3">description</p>         </th></tr></thead><tbody><tr id="a302920b" class="ijRowOdd"><td id="8000935b">            <p id="354b9d86">operationContext</p>         </td><td id="93f3161e">            <p id="05067296">IOperationContext</p>         </td></tr><tr id="167e2a9e" class="ijRowEven"><td id="013a930b">            <p id="d4fbe8fb">childNode</p>         </td><td id="e35d98c1">            <p id="2b635b60">the child node we are checking</p>         </td></tr><tr id="e8ff510f" class="ijRowOdd"><td id="751c33e8">            <p id="3ca117fd">node</p>         </td><td id="42d30e08">            <p id="874dcc12">the parent node we are checking (instance of this concept)</p>         </td></tr><tr id="9762f9d9" class="ijRowEven"><td id="0afc4369">            <p id="d0170a79">childConcept</p>         </td><td id="42e3053b">            <p id="b0dcb30c">the concept of the child node we are checking</p>         </td></tr><tr id="8b8f44b5" class="ijRowOdd"><td id="96f41346">            <p id="3d6799d7">link</p>         </td><td id="77c37673">            <p id="d1d70c12">LinkDeclaration of the child node</p>         </td></tr></tbody></table></div>   <h4 id="canbeancestor">can be ancestor</h4>   <p id="1705a4dd">Return false if an instance of the concept is not allowed to be an ancestor of specific nodes.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="fbfe24ab"><thead><tr id="c00af41c" class="ijRowHead"><th id="c91fa738">            <p id="f5bc02ab">parameter</p>         </th><th id="92453126">            <p id="cc705318">description</p>         </th></tr></thead><tbody><tr id="1f00ca46" class="ijRowOdd"><td id="70a6ff4e">            <p id="e74eabab">operationContext</p>         </td><td id="e0ddfb07">            <p id="4fa39e77">IOperationContext</p>         </td></tr><tr id="d8751b26" class="ijRowEven"><td id="db64de21">            <p id="dffd24bb">childNode</p>         </td><td id="767b699c">            <p id="e56c4ddb">the child node we are checking</p>         </td></tr><tr id="eddf6645" class="ijRowOdd"><td id="e2d32873">            <p id="d50e2fa1">node</p>         </td><td id="9741b915">            <p id="6326c85e">the ancestor node we are checking (instance of this concept)</p>         </td></tr><tr id="85fcf3a0" class="ijRowEven"><td id="6f6afa13">            <p id="4127e176">childConcept</p>         </td><td id="a3d31b54">            <p id="5dffad8a">the concept of the descendant node</p>         </td></tr></tbody></table></div>   <h4 id="canberoot">can be root</h4>   <p id="56073587">This constraint is available only for rootable concepts (<b id="51810b84">instance can be root</b> is true in the concept structure description). Return false if instance of concept cannot be a root in the given model.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="747d6b84"><thead><tr id="563e13e3" class="ijRowHead"><th id="699749c2">            <p id="bedcc61e">parameter</p>         </th><th id="b1e2ed4e">            <p id="80190072">description</p>         </th></tr></thead><tbody><tr id="f5b8d3e6" class="ijRowOdd"><td id="46d522fe">            <p id="f94f5bb1">operationContext</p>         </td><td id="9b24c3d6">            <p id="02fdf810">IOperationContext</p>         </td></tr><tr id="e90883b6" class="ijRowEven"><td id="7509f865">            <p id="054c9b50">model</p>         </td><td id="70c34066">            <p id="80460600">model of the root</p>         </td></tr></tbody></table></div>      <h2 id="propertyconstraints">Property constraints</h2>   <p id="173ff7d8">Technically speaking, <i id="8a2b6fcf">"pure"</i> concept properties are not properties in its original meaning, but only public fields. Property constraints allow you to make them real properties. Using these constraints, the behavior of concept's properties can be customized. Each property&nbsp;constraint is applied to a single specified property.</p>   <p id="ce3551f4">      <b id="77450a50">property</b> - the property to which this constraint is applied.</p>   <p id="31d55a9f">      <b id="28a285a2">get</b> - this method is executed to get property value every time property is accessed.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="d297b576"><thead><tr id="cc548496" class="ijRowHead"><th id="9e4b4bd6">            <p id="d8b84a53">parameter</p>         </th><th id="56cf6da5">            <p id="ae8d7be4">description</p>         </th></tr></thead><tbody><tr id="96501222" class="ijRowOdd"><td id="52ff42a2">            <p id="fa3a4305">node</p>         </td><td id="153b0818">            <p id="625ef3f5">node to get property from</p>         </td></tr></tbody></table></div>   <p id="29c359e3">      <b id="b58b8280">set</b> - this method is executed to set property value on every write. The property value is guaranteed to be valid.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="9693db18"><thead><tr id="0a4c63ad" class="ijRowHead"><th id="cc64b0b6">            <p id="96644cd7">parameter</p>         </th><th id="b72e1641">            <p id="7d3e3c8f">description</p>         </th></tr></thead><tbody><tr id="7fa34598" class="ijRowOdd"><td id="2b9ed66a">            <p id="e812249f">node</p>         </td><td id="da217f31">            <p id="50b1936c">node to set property</p>         </td></tr><tr id="9882766d" class="ijRowEven"><td id="da4dd57b">            <p id="2911ae59">propertyValue</p>         </td><td id="5a9070f5">            <p id="973e207a">new property value</p>         </td></tr></tbody></table></div>   <p id="ac78fe51">      <b id="1a5ad652">is valid</b> - this method should determine whether the value of the property is valid. This method is executed every time before changing the value, and if it returns false, the set() method is not executed.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="1e041851"><thead><tr id="922acee9" class="ijRowHead"><th id="7c2eb3ae">            <p id="281f4196">parameter</p>         </th><th id="c0d2f4af">            <p id="09846615">description</p>         </th></tr></thead><tbody><tr id="36e64c2f" class="ijRowOdd"><td id="5a988058">            <p id="08ec1f78">node</p>         </td><td id="46ab01bd">            <p id="c331b2fe">node to check property</p>         </td></tr><tr id="caf6110d" class="ijRowEven"><td id="883f1d55">            <p id="0f786964">propertyValue</p>         </td><td id="7a7e8a78">            <p id="c7ddada2">value to be checked</p>         </td></tr></tbody></table></div>      <h3 id="example-customizingthedescriptioninthecompletionmenu">Example - customizing the description in the completion menu</h3>   <p id="d174ee60">The completion menu lists available nodes together with some additional descriptive information:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/sd1.png"><img alt="sd1" title="sd1" src="/help/img/idea/2019.1/sd1.png" id="f6e8df5c" width="500" height="690"></a></figure>      <p id="8cac0ad1">In order to customize the additional information and provide more details on the individual options listed in the completion menu, you can override the getter of the&nbsp;<i id="06958bfb">shortDescription</i>&nbsp;property of the target concept:</p>   <p id="db8818ab">&nbsp;</p>         <figure><img alt="sd2" title="sd2" src="/help/img/idea/2019.1/sd2.png" id="86e13e84" width="300" height="185"></figure>            <figure><a class="lightbox" href="/help/img/idea/2019.1/sd3.png"><img alt="sd3" title="sd3" src="/help/img/idea/2019.1/sd3.png" id="aece50a2" width="500" height="686"></a></figure>      <h2 id="referentconstraints">Referent constraints</h2>   <p id="0a83af17">Constraints of this type help to add behavior to concept's links and make them look more properties-like.</p>   <p id="cf67e68a">      <b id="48d65d44">referent set handler</b> - if specified, this method is executed on every set of this link.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="dc129f96"><thead><tr id="9fd9c227" class="ijRowHead"><th id="eedfdec0">            <p id="e6af0e2b">parameter</p>         </th><th id="5d6f5093">            <p id="7a6d921c">description</p>         </th></tr></thead><tbody><tr id="9bfdd90a" class="ijRowOdd"><td id="bec6ff97">            <p id="33b93629">referenceNode</p>         </td><td id="dcac2570">            <p id="0f593e90">node that contains link.</p>         </td></tr><tr id="4fd19d8a" class="ijRowEven"><td id="2f2ec291">            <p id="7e7613d3">oldReferentNode</p>         </td><td id="13d8e010">            <p id="5de0dd6d">old value of the reference.</p>         </td></tr><tr id="a32081a1" class="ijRowOdd"><td id="affb0e4a">            <p id="be899738">newReferentNode</p>         </td><td id="8d206ed9">            <p id="7e623381">new value of the reference.</p>         </td></tr></tbody></table></div>   <p id="f01b74dc">      <br>       <b id="6088cf47">scope</b> - defines the set of nodes to which this link can point. The method returns a <i id="838bddcd">Scope</i>&nbsp;instance. Please refer to the <a href="scopes.html">Scopes documentation</a> for more information on scoping. There are two types of scope referent constraint:</p>   <ul class="list _ul"><li class="list__item" id="94f1aec2"><p>inherited</p></li><li class="list__item" id="2689a227"><p>reference</p></li></ul>   <p id="35f39c01">While <b id="5276a49c">inherited</b>&nbsp;scope simply declares the target concept, the&nbsp;<b id="31e17220">reference</b>&nbsp;scope provides a function that calculates the scope on the fly from the parameters.</p>   <div class="table-wrapper"><table class="                 " width="100%" id="84780e4b"><thead><tr id="4755e155" class="ijRowHead"><th id="e4def02c">            <p id="ed66c7aa">parameter</p>         </th><th id="ff38a334">            <p id="e7688e1a">description</p>         </th></tr></thead><tbody><tr id="95fe856b" class="ijRowOdd"><td id="aaacfe2b">            <p id="3cb8b0b7">referenceNode</p>         </td><td id="5736927a">            <p id="be0e399b">the node that contains the actual link. It can be null when a new node is being created for a concept with smart reference. In this situation smart reference is used to determine what type of node to create in the context of enclosingNode, so the search scope method is called with a null referenceNode.</p>         </td></tr><tr id="9d0bd985" class="ijRowEven"><td id="1c622790">            <p id="2b1e5d78">contextNode</p>         </td><td id="060fbe54">            <p id="c80a29c2">node with the reference or the closest not-null context node</p>         </td></tr><tr id="e9a8b238" class="ijRowOdd"><td id="fe2313ee">            <p id="7c127f5e">containmentLink</p>         </td><td id="e0bd19d9">            <p id="353c71eb">SContainmentLink describing parent-child relationship between&nbsp;the contextNode and its non-existent child that is being created (if referenceNode exists then this parameter has no meaning)</p>         </td></tr><tr id="9ffd73da" class="ijRowEven"><td id="4ea53947">            <p id="fde83829">linkTarget</p>         </td><td id="33a84550">            <p id="0a4c5e26">the concept that this link can refer to. Usually it is a concept of the reference, so it is known statically. If we specialize reference in subconcept and do not define search scope for specialized reference, then linkTarget parameter can be used to determine what reference specialization is required.</p>         </td></tr><tr id="a5a8c158" class="ijRowOdd"><td id="55d06379">            <p id="7f7f24be">position</p>         </td><td id="4c6b4528">            <p id="6f353cef">the target index in contextRole</p>         </td></tr></tbody></table></div>   <p id="80aab3ac">If scope is not set for the reference then default scope from the referenced concept is used. If the default scope is also not set then "global" scope is used: all instances of referent concept from all imported models.</p>   <p id="b8c5f5b2">      <br>       <b id="a42ce8ee">presentation (deprecated - the editor aspect now specifies presentation of references, see <a href="editor.html">Editor</a>)</b> - here you specify how the reference will look like in the editor and in the completion list. Sometimes it is convenient to show reference differently depending on context. For example, in Java all references to an instance field <i id="3d3d1164">f</i> should be shown as <i id="1f37b97a">this.f</i>, if the field is being shadowed by the local variable declaration with the same name. By default, if no presentation is set, the name of the reference node will be used as its presentation (provided it is an INamedConcept).</p>   <div class="table-wrapper"><table class="                 " width="100%" id="74027c79"><thead><tr id="b7589988" class="ijRowHead"><th id="3aaab036">            <p id="ab3e70a5">parameter</p>         </th><th id="870fa32b">            <p id="6da0bbf3">description</p>         </th></tr></thead><tbody><tr id="8108098f" class="ijRowOdd"><td id="e4d11bb1"><p>model</p></td><td id="2d1816fd"><p>model of node containing reference</p></td></tr><tr id="3db83f1d" class="ijRowEven"><td id="b86451ae">            <p id="bd093a19">parameterNode</p>         </td><td id="d170d060">            <p id="86d9b4bb">the node to be presented (referenceNode has a reference to parameterNode of type linkTarget)</p>         </td></tr><tr id="39cea216" class="ijRowOdd"><td id="3c86cbbc"><p>position</p></td><td id="393f30ad"><p>target index in contextRole</p></td></tr><tr id="e7e15b25" class="ijRowEven"><td id="5501fd8d"><p>exists</p></td><td id="e563addd"><p>false when reference is being created</p></td></tr><tr id="edf000e8" class="ijRowOdd"><td id="a91bba19">            <p id="e01be622">visible</p>         </td><td id="811fdf6c">            <p id="feff26f5">true - presentation of existing node, false - for new node (to be created after selection in completion menu)</p>         </td></tr><tr id="d79b70e3" class="ijRowEven"><td id="980a751f">            <p id="2211f646">smartReference</p>         </td><td id="2b4b461e">            <p id="e827bb64">true - node is presented in the smart reference</p>         </td></tr><tr id="d714972c" class="ijRowOdd"><td id="c8a60fec">            <p id="f40885b9">inEditor</p>         </td><td id="3b7cf5ac">            <p id="e6b34ba6">true - presentation for editor, false - for completion menu</p>         </td></tr><tr id="70b71a12" class="ijRowEven"><td id="14c9e7ed"><p>contextNode</p></td><td id="7633fbde"><p>node with the reference, or closest not-null context node</p></td></tr><tr id="2cf8523a" class="ijRowOdd"><td id="ae6c976a"><p>contextRole</p></td><td id="c1794991"><p>target role in contextNode</p></td></tr><tr id="9c98d95c" class="ijRowEven"><td id="0b8b8760"><p>referenceNode <br>enclosingNode <br>linkTarget<br>containingLink</p></td><td id="2e39139d"><p>deprecated</p></td></tr></tbody></table></div>      <h2 id="defaultscope">Default scope</h2>   <p id="4d65f02f">Suppose we have a link pointing to an instance of concept C and we have no scope defined for this link in referent constraints. When you edit this link, all instances of concept C from all imported models are visible by default. If you want to restrict set of visible instances for all links to concept C you can set <b id="c6edd17a">default scope</b> for the concept. As in referent constraint you can set <b id="724c6499">search scope</b>, <b id="d37f33ec">validator</b> and <b id="11710277">presentation</b> methods. All the parameters are the same.</p>   <p id="80de729e">Please refer to the <a href="scopes.html">Scopes documentation</a> for more information on scoping.</p><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="editor-language-generation-api.html">Editor language generation API</a><a class="navigation-links__next" href="behavior.html">Behavior</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>