<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Generator User Guide Demo2 - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Generator+User+Guide+Demo2.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Generator+User+Guide+Demo2.html" id="generator-user-guide-demo2.xml">Generator User Guide Demo2</h1>   <h2 id="generatoruserguidedemo2">Generator User Guide Demo 2</h2>   <p id="f6e3adb3">In this demo we will again generate a Java Swing application, but unlike in previous Demo 1, this time it is going to be <b id="5bb6f685">a single Java application per input model</b> (in Demo 1 we generated a separate Java application for each input XML Document). The single Java application that Demo 2 creates, will contain all components mentioned in all XML <i id="91ff8f9c">Documents</i>&nbsp;of the input model.</p>         <a name="new_language"></a>      <h2 id="newlanguage">New Language</h2>   <p id="0e58067d">We need to do some little technical setup first:</p>   <ul class="list _ul"><li class="list__item" id="f35cf07d"><p>create a new language: 'generator_demo.demoLang2'</p></li><li class="list__item" id="35aaa359"><p>in the language properties dialog add an&nbsp;<b id="2fba649e">extends dependency</b>&nbsp;on 'jetbrains.mps.sampleXML' and 'jetbrains.mps.baseLanguage'</p></li><li class="list__item" id="8b50f33f"><p>create a new generator for this language, if it has not been created automatically (see <a href="generator-user-guide-demo1.html">Generator User Guide Demo1</a> for details).</p></li></ul>   <p id="602f0c5e">As the code that we are going to generate is almost identical to that in Demo 1, we will copy the application class template from the <i id="504bc061">demoLang1</i> generator:</p>   <ul class="list _ul"><li class="list__item" id="20cfe650"><p>go to model 'main@generator' in <i id="d6947f0b">demoLang1</i>      </p></li><li class="list__item" id="ee29778d"><p>select the 'map_Document' template in project tree and copy it to clipboard</p></li><li class="list__item" id="6177ca7c">return to model 'main@generator' in <i id="b91bf667">demoLang2</i> (select this model in tree) and paste from clipboard<aside class="note " data-title="" rel="b91bf667" id="aad32dcf">            <p id="52c3e734">The 'Imports and Languages' dialog will offer to import some additional models into our new <i id="7087e2e2">demoLang2</i> generator model.<br>Accept all but model 'main@generator' in <i id="28a09b48">demoLang1</i> (our new generator is not going to depend on the <i id="4ad9d3bf">demoLang1</i> generator):</p>            <ul class="list _ul"><li class="list__item" id="d2df236a"><p>uncheck the <i id="05187827">demoLang1</i> generator model</p></li><li class="list__item" id="3a50b833"><p>press&nbsp;<i id="d03a06c6">OK</i>               </p></li></ul>                           <figure><img alt="gdb1" title="gdb1" src="/help/img/idea/2019.1/gdb1.png" id="9f6709b8" width="526" height="478"></figure>                     </aside>      </li><li class="list__item" id="261dfba5"><p>in the same manner copy the template switch 'switch_JComponentByElementName' from <i id="89857679">demoLang1</i> to the <i id="7c1433e2">demoLang2</i> generator model</p></li></ul>   <h2 id="conditionalrootrule">Conditional Root Rule</h2>   <p id="2e301dbb">The process of code generation in MPS can be viewed as a series of model-to-model transformations. An AST in one language is gradually transformed into an AST expressed in concepts from another language. In each step individual concepts from one language get translated (reduced) into concepts from another language. <i id="4ea57652">Conditional Root Rule</i>&nbsp;is somewhat special in that it creates new nodes out of nothing. It generates a brand new root node in the output model using a template referred to in this rule without having any original node in the input model.</p>   <ul class="list _ul"><li class="list__item" id="9c4f865b"><p>go to demoLang2 generator and open the mapping configuration 'main' in editor</p></li><li class="list__item" id="f1cfbd13"><p>add new <i id="9737c919">Conditional Root Rule</i> (press <i id="11b4efaf">Insert</i>&nbsp;or <i id="4091d01e">Enter</i>&nbsp;while cursor is in <b id="866b48e8">conditional root rules</b> section)</p></li><li class="list__item" id="932209de"><p>make reference to the 'map_Document' template so that this template is used to generate the resulting class</p></li></ul>         <figure><img alt="gdb2" title="gdb2" src="/help/img/idea/2019.1/gdb2.png" id="b133d056" width="887" height="535"></figure>      <ul class="list _ul"><li class="list__item" id="db9f9344"><p>open the 'map_Document' template (<i id="0d96724a">Control + &lt;left-click&gt;</i>&nbsp;or <i id="4fdf5c9f">Cmd + &lt;left-click&gt;</i>&nbsp;on the&nbsp;reference in the editor) so we can tweak it a bit for it to work in the changed context</p></li></ul>         <figure><img alt="gdb3" title="gdb3" src="/help/img/idea/2019.1/gdb3.png" id="19d3b916" width="812" height="604"></figure>      <ul class="list _ul"><li class="list__item" id="a9875ffc"><p>in the template's header remove the mention of&nbsp;<i id="a4b92564">Document</i> - press <i id="acdf1455">Del</i> while cursor is on the word 'Document' (we are using this template in Conditional Root Rule, which no longer passed a <i id="ffd8a752">Document</i>&nbsp;as the template's input)</p></li><li class="list__item" id="e5484fb7"><p>remove the property-macro from the class name, as now we only get a single class, we can hard-code its name</p></li><li class="list__item" id="13cd401c"><p>rename the generated class to '<b id="97733e6d">DemoApp</b>'</p></li><li class="list__item" id="7377deff"><p>open the <i id="67b07584">Inspector</i>&nbsp;for the <i id="20663e80">SWITCH</i>&nbsp;macro and resolve the reference to the <i id="f70563d0">template_switch</i>&nbsp;by hitting <i id="e55c91b0">Control + Space</i>      </p></li></ul>   <h2 id="loop-macro">LOOP-macro</h2>   <p id="19e066fd">The SWITCH-macro in 'DemoApp' template is expecting an XML <i id="514850b1">Document</i>&nbsp;on the input, since this is how we implemented it in Demo 1. It then extracts the <i id="fc57a125">Document's</i> root element and applies a template switch to it. However, there may be multiple <i id="d796c87f">Documents</i>&nbsp;in the input model (in fact in our demo app will have two - a button and a label), so we need to gradually process them all in sequence and generate an appropriate "<i id="7f5d2f0b">container.add(null);</i>" statement for each of these <i id="b81e8580">Documents</i>.<br>To provide the SWITCH-macro with a single <i id="370e9d30">Document</i>&nbsp;node,&nbsp;we will wrap the '<i id="7ad61c44">container.add(..);</i>' statement&nbsp;inside a LOOP-macro:</p>   <ul class="list _ul"><li class="list__item" id="f32bc9e5">in the template code select the statement <i id="b0b8d4d9">'container.add($SWITCH$[null]);</i>' (with your cursor placed inside the statement, use <i id="15cd5b27">Ctrl/Cmd+W</i> to expand block selection)      </li><li class="list__item" id="a23de86e"><p>press <i id="547f8017">Ctrl-Shift+M</i> to add node-macro</p></li><li class="list__item" id="0632b7ce"><p>choose <i id="11c5416e">$LOOP$</i> from the auto-completion menu (<i id="63a331d8">Ctrl+Space</i>)</p></li><li class="list__item" id="b7abdc3d"><p>enter code in the LOOP's <b id="b8aa85c2">mapped nodes</b> function as below</p></li></ul>         <figure><img alt="gdb4" title="gdb4" src="/help/img/idea/2019.1/gdb4.png" id="b7392f7e" width="749" height="520"></figure>      <p id="70476699">The <b id="989de8b6">mapped nodes</b> function will find all <i id="5771c9f3">Documents</i> in the input model and return a&nbsp;<i id="2b93063d">sequence</i> of these <i id="e590d345">Documents</i> to the generator&nbsp;(the <b id="1ad734c7">return</b> statement can be omitted in <i id="e186aa85">BaseLanguage</i>).<br>Then, the generator will iterate through this sequence, create 'container.add(..);' statement for each <i id="678793cc">Document</i> and gradually pass each <i id="42f6e2ec">Document</i> as an input node to the SWITCH-macro.</p>   <p id="8194feb1">That's it. The last step, as usual, is hitting <i id="b35611de">Shift-F9</i> to <b id="1b1d97dd">make the&nbsp;generator</b>.</p>         <a name="first_test"></a>      <h2 id="runningfirsttest">Running First Test</h2>   <p id="6e890ea6">To test the demoLang2 generator we need the exactly same input as in Demo 1 except that we are going to 'engage' different language on its generation.</p>   <ul class="list _ul"><li class="list__item" id="d953e8f9"><p>go to the 'test1' model in 'test_models' solution (select it in project tree)</p></li><li class="list__item" id="dd178619"><p>choose <i id="137909ac">Clone Model</i> in the popup menu</p></li><li class="list__item" id="62a17a6c"><p>enter the new model name: 'generator_demo.test2'</p></li><li class="list__item" id="00d82f0c">in properties dialog of the 'test2' model, in the <b id="d9f4c354">Languages Engaged on Generation</b> section:	<ul class="list _ul"><li class="list__item" id="c7583a21"><p>remove 'generator_demo.L1' language</p></li><li class="list__item" id="52f00709"><p>add 'generator_demo.L2' language</p></li></ul>	     </li></ul>   <p id="207e18c1">Generate the 'test2' model&nbsp;and preview the generated sources.</p>   <h2 id="abandonrootrule">Abandon Root Rule</h2>   <p id="8984a518">Note that the generated output also contains two 'generated' XML files: Button.xml and Label.xml.&nbsp;MPS did not generate those XML files in previous Demo 1. Why does it do so in this demo?</p>   <p id="f4d6c31f">Because in Demo 1 we have defined explicit mapping of input <i id="23c6f44b">Documents</i> to output <i id="4a30cb60">Classes</i> using Root Mapping Rule, the input was consumed and the xml files were not generated..<br>In Demo 2 we <b id="908d6a21">do not explicitly map</b> input <i id="589efd12">Documents</i> to any output roots and so they remain in the model until the text-generation phase, which turns them into xml files.</p>      <p id="acc16ae7">To prevent copying <i id="390566fa">Documents</i> to the output model we will use the <b id="976556a7">Abandon Root Rule</b>.</p>   <ul class="list _ul"><li class="list__item" id="96ffdd3d"><p>return to demoLang2 generator and open mapping configuration 'main' in editor</p></li><li class="list__item" id="bd49c594"><p>add a new Abandon Root Rule - press <i id="40d33abc">Insert</i> while cursor is in the <b id="0d96a11f">abandon roots</b> section</p></li><li class="list__item" id="0d74b2b7"><p>choose '<i id="034ecfaa">Document</i>' as the concept for application of the rule</p></li></ul>         <figure><img alt="gdb5" title="gdb5" src="/help/img/idea/2019.1/gdb5.png" id="7bfdeb39" width="740" height="351"></figure>      <p id="78e39232">After rebuilding the project you will no longer get xml files on the output.</p><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-user-guide-demo1.html">Generator User Guide Demo1</a><a class="navigation-links__next" href="generator-user-guide-demo3.html">Generator User Guide Demo3</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>