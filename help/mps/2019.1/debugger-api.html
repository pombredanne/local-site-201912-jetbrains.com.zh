<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Debugger API - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Debugger+API.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Debugger+API.html" id="debugger-api.xml">Debugger API</h1>   <h2 id="debugger">Debugger</h2>   <p id="726d6347">MPS provides a java api for creating a debugger engine to work with MPS.</p>         <ul data-skip-index="skip"><li class="list__item"><a href="#debugger">Debugger</a></li><li class="list__item"><a href="#wheretostart">Where to start</a></li><li class="list__item"><a href="#keyclasses">Key classes</a></li><li class="list__item"><a href="#valuesandwatchables">Values and watchables</a></li><li class="list__item"><a href="#sourcepositionandipositionprovider">SourcePosition and IPositionProvider</a></li><li class="list__item"><a href="#traceinforesourceprovider">TraceInfoResourceProvider</a></li><li class="list__item"><a href="#finalremarks">Final remarks</a></li></ul>      <h3 id="wheretostart">Where to start</h3>   <p id="fb33bc49">A good way to start writing a custom debugger engine is to study the <b id="34cb65aa">Java Debugger</b> plugin implementation in MPS. The source code is located in solutions <i id="a0bf16d6">jetbrains.mps.debugger.java.api</i> and <i id="f924d8c4">jetbrains.mps.debugger.java.runtime</i>. The Debugger API itself can be found in <i id="1c8ccce8">jetbrains.mps.debugger.api.api</i>. Solution <i id="5acc5d33">jetbrains.mps.debugger.api.runtime</i> can be studied to understand how api classes are used in MPS, but classes from this solution should not be referenced from a custom debugger code. Both Debugger API and Java Debugger are packaged as IDEA plugins for MPS, and so should be every custom implementation of Debugger API. Implementing a debugger for MPS requires some knowledge of Intellij IDEA, so <a href="http://confluence.jetbrains.com/display/IDEADEV/PluginDevelopment" data-external="true" target="_blank" rel="noopener noreferrer">Intellij IDEA Plugin Development page</a> should also be studied. And there is of course a <a href="build-language.html">Build Language Guide</a> to help with plugin packaging.</p>   <h3 id="keyclasses">Key classes</h3>   <p id="fbff3f0e">Interface <i id="92cc1fcc">jetbrains.mps.debug.api.IDebugger</i> represent a debugger as a whole. It should be registered in a <i id="1892f7c5">jetbrains.mps.debug.api.Debuggers</i> application component. There is a default implementation, <i id="f109fbf4">AbstractDebugger</i>. <i id="bb91beca">IDebugger</i> implementation is required to provide 2 things: a way to start an application under debugger and a way to create breakpoints. For that MPS Debugger API has 2 interfaces:</p>   <ol class="list _decimal"><li class="list__item" id="49164e60"><p>         <i id="84973277">jetbrains.mps.debug.api.AbstractDebugSessionCreator</i> â€“ its main job is to start an application under debug and create an instance of <i id="4f7286e6">AbstractDebugSession</i>, which corresponds to a single application, executed under debug. A state of debugger (either running or paused on a breakpoint or other) is represented by <i id="2910c4d1">jetbrains.mps.debug.api.AbstractUiState</i>. When a debug session transfers from one state to another, a new instance of <i id="f9a775c1">AbstractUiState</i> should be created and set to <i id="7f2ba943">AbstractDebugSession</i>. <i id="7e24d6d6">AbstractUiState</i> holds the information about current threads and stack frames, visible variables, and so on.</p></li><li class="list__item" id="f2a0bcdf"><p>         <i id="7ca295fa">jetbrains.mps.debug.api.breakpoints.IBreakpointsProvider</i> is responsible for creating breakpoints, providing editing ui and persisting breakpoints state to and from xml. A breakpoint class should implement <i id="4095aeb4">IBreakpoint</i>. <i id="4eb720f1">AbstractBreakpoint</i> is a base class to extend. For breakpoints that can be set on some location (which basically means "on a node", like a breakpoint on line of code) exists an interface <i id="45edf775">ILocationBreakpoint</i>. Each breakpoint is of some kind (<i id="4a51f540">IBreakpointKind</i>), for example there can be kinds for line breakpoints, field breakpoints or exception breakpoints.</p></li></ol>   <h4 id="valuesandwatchables">Values and watchables</h4>   <p id="a4254d13">      <i id="3d826a57">jetbrains.mps.debug.api.programState</i> package contains a number of interfaces to reflect a state of the program. When paused on a breakpoint <i id="82c27a0d">AbstractUiState</i> has a list of threads that are running in an application (interface <i id="747e2a8b">IThread</i>). Each thread has a list of stack frames (<i id="71f0ddfd">IStackFrame</i>), and each stack frame has a list of watchables (<i id="a2eedc62">IWatchable</i>) visible there. A watchable can be a local variable, or "this" object or a "static context". Each watchable has one value (<i id="bcfbbd55">IValue</i>). In turn, each value can have a number of watchables. For example, java local variable is a watchable, an object assigned to this variable is a value, and fields that this object has are watchables, and so on. This tree like structure is what is shown in "Variables" section of the "Debug" tool window.</p>   <h4 id="sourcepositionandipositionprovider">SourcePosition and IPositionProvider</h4>   <p id="f2aac73f">      <i id="05ebdc77">jetbrains.mps.debug.api.source.IPositionProvider</i> is an interface to customize the way source code (text) is mapped into a location inside of MPS (a text file or a node). It calculates an instance of <i id="1c1d6903">jetbrains.mps.debug.api.source.SourcePosition</i> for a location either given by an instance of a <i id="29e1a164">ILocation</i> interface or by name of a unit name, filename and line number. There are two predefined providers: <i id="1d7cda7b">jetbrains.mps.debug.api.source.NodePositionProvider</i> and <i id="59af7746">jetbrains.mps.debug.api.source.TextPositionProvider</i>. They are responsible for finding a node or a text position for a location.</p>   <p id="644bbc20">      <i id="b99ea4f0">SourcePosition</i> is a class that contains a position inside MPS. This class has two implementations: <i id="1fd8a66a">jetbrains.mps.debug.api.source.NodeSourcePosition</i> (contains a pointer to a node) and <i id="7305f198">jetbrains.mps.debug.api.source.TextSourcePosition</i> (contains a text file). Default line highlighting in MPS supports only these two kinds of positions.</p>   <p id="659e8722">Providers are registered in <i id="a09c85a5">jetbrains.mps.debug.api.source.PositionProvider</i> class. Each provider has a key, associated with it, which tell whether this provider returns a <i id="ad7bf22a">NodeSourcePosition</i> or a <i id="f2784619">TextSourcePosition</i>. Also, a provider accepts a specific <i id="4fa8c019">DebugSession</i>, and only providers that are shipped with the MPS debugger by default can accept all sessions.</p>   <p id="5961af33">Here is an example of a position provider:</p>   <div class="code-block" data-lang="none">/*
NodePositionProvider is extended here in order to provide NodeSourcePosition.
It is not necessary to extend one of the default providers.
*/
public class MyCustomNodePositionProvider extends NodePositionProvider { 
  private final Project myProject; 
   
  public MyCustomNodePositionProvider(Project project) { 
    myProject = project; 
  } 
   
  @Nullable() 
  @Override 
  public node&lt;&gt; getNode(@NonNls string unitName, @NonNls string fileName, int position) { 
    node&lt;&gt; node = ... (some code that calculates a node);
    return node;
  } 
   
  public void init() {
    // call this method on your debugger initialization
    PositionProvider.getInstance(myProject).addProvider(this, NodeSourcePosition.class.getName()); 
  } 
   
  public void dispose() { 
    // call this method on your debugger disposal
    PositionProvider.getInstance(myProject).removeProvider(this); 
  } 
   
  @Override 
  public boolean accepts(AbstractDebugSession session) { 
    // it is necessary to override this method and to accept only AbstractDebugSession instances that are created by your debugger
    return session instanceof MyCustomDebugSession; 
  } 
}</div>   <h4 id="traceinforesourceprovider">TraceInfoResourceProvider</h4>   <p id="53347d43">      <i id="caddce50">jetbrains.mps.generator.traceInfo.TraceInfoCache.TraceInfoResourceProvider</i> is an interface that allows to customse how paths to the <i id="6e0acaf1">trace.info</i> files are calculated for a module. As an example, modules that are written in <i id="babcbcb0">BaseLanguage</i> have their <i id="474c75de">trace.info</i> files in classpath. The instance of an interface is given a module and a name of resource to find (for example, "<i id="de6f4daa">jetbrains/mps/core/util/trace.info</i>" if a caller needs a location of a <i id="8f8ea793">trace.info</i> file for a model <i id="dc5cc5d1">jetbrains.mps.core.util</i>) and should return an instance of <i id="ebd16ca3">java.net.URL</i>. <i id="b1b64283">TraceInfoResourceProviders</i> are registered/unregistered in <i id="cc7b6ac5">TraceInfoCache</i> instance using <i id="9dae120e">addResourceProvider/removeResourceProvider</i> methods.</p>   <h3 id="finalremarks">Final remarks</h3>   <ol class="list _decimal"><li class="list__item" id="9f46edd8">Variables tree in debugger tool window now uses a background thread for its updates. Several methods in the API provide support for that::<ul class="list _ul"><li class="list__item" id="4b4e4af8"><p>               <i id="1bdc00b2">IValue.initSubvalues()</i> method, which is called in the background thread and should perform all the calculations necessary for acquiring subvalues of this value. The&nbsp;<i id="3a8b5e74">IValue.getSubvalues()</i>&nbsp;method is only supposed to return the data, which have been calculated in the <i id="ba0d8854">initSubvalues()</i> method before.</p></li><li class="list__item" id="10196588"><p>The<i id="89b3e974"> AbstractUiState.invokeEvaluation()</i> method, which is used by the debugger api to invoke all evaluation code (i.e. the code, which does some calculations inside the debugged program; specifically this method is used to invoke <i id="271b7e81">IValue.initSubvalues()</i>). By default this method just schedules the command to one of the threads in the thread pool, but one can override it for some custom behavior.</p></li></ul>      </li></ol><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="debugger.html">Debugger</a><a class="navigation-links__next" href="using-mps-debugger.html">Using the MPS Debugger</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>