<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Using Migrations with branching - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Using+Migrations+with+branching.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using+Migrations+with+branching.html" id="using-migrations-with-branching.xml">Using Migrations with branching</h1>   <h2 id="usingmigrationswithbranching">Using migrations with branching</h2>   <p id="668a03be">To nicely support language evolution, migrations automatically upgrade client code to use the latest version of a language or multiple languages. The <a href="migrations.html">Migrations</a> documentation describes the process of creating and running migrations in MPS. Briefly,&nbsp;in order to change models to comply with the language changes, language authors can provide migrations. MPS automatically tracks language versions used in projects and asks the end-user to apply needed migrations.</p>   <p id="9b848bbe">While there are hardly any surprises when using a single branch of development, typical team setup involves multiple branches for features as well as&nbsp;bug fixes. With multiple branches teams will inevitably face situations like having different versions of languages in different branches, which makes the merge procedure much more challenging.</p>   <h3 id="themainruleofpainlessmerge">The main rule of painless merge</h3>   <p id="f0d87aa3">To merge two branches smoothly, all languages used in those branches should be of the same versions. The following describes a simple workflow that allows you to easily synchronise language versions in two branches.</p>   <h4 id="nomigrationswerecreatedinanyofthemergedbranches">No migrations were created in any of the merged branches</h4>   <p id="bd34e5a4">To sync language versions, just update languages in the outdated branch and run required migrations. Now both branches have the same versions of used languages and can be easily merged.</p>   <h4 id="somemigrationswerecreated">Some migrations were created</h4>   <p id="63c36a4a">All considered cases have the same idea behind them: <b id="19fb6bf5">never merge branches that differ in versions of used languages</b>. Thus we need to propagate all the migrations into both branches before merging them.</p>   <h4 id="1.onemigrationwasdevelopedinoneofthebranches">1. One migration was developed in one of the branches</h4>   <p id="b6a3657a">The only special thing that should be done when you write a migration is that there should be a commit (name it C) containing the migration itself, but <b id="1bec0e32">no code should be migrated in the same commit</b>. The migrated files can be committed later, e.g. in the following commit.<br>The main idea here is to give other branches a possibility to get the new migration without having to merge different versions of used languages.</p>   <p id="657441ab">Now, your history looks like this:</p>   <p id="1f1cf941">&nbsp; &nbsp; &nbsp; &nbsp;|--- C --- &nbsp;[branch 1]</p>   <p id="270169e7">------|</p>   <p id="ce19cf11">&nbsp; &nbsp; &nbsp; &nbsp;|------------ &nbsp;[branch 2]</p>   <p id="836b4cc1">To merge branches b1 and b2</p>   <ol class="list _decimal"><li class="list__item" id="d7563774"><p>Merge b2 with commit C. Now you have the new migration in b2.&nbsp;</p></li><li class="list__item" id="e4d06305"><p>Run the migration on b2</p></li><li class="list__item" id="2ac9add7"><p>Merge with b1's HEAD</p></li></ol>   <p id="b75b1eaa">Quite simple, isn't it?</p>   <aside class="tip sideblock" data-title="" rel="b75b1eaa" id="1cf2673c">      <p id="a92e3709">It is a good habit to create a separate commit whenever you're adding a new language migration. This allows other branches to get your migration safely without having to bother with the upgrades that the migration caused to code in your branch.</p>   </aside>   <h4 id="2.twoormoremigrationsinoneofthebranches">2. Two or more migrations in one of the branches</h4>   <p id="95cc8849">The principle remains the same, it is just repeated two or more times</p>   <p id="71031c2f">&nbsp; &nbsp; &nbsp; &nbsp;|----- C1 — C2 – &nbsp;[branch 1]</p>   <p id="8a70c3f9">------|</p>   <p id="21d2ef86">&nbsp; &nbsp; &nbsp; &nbsp;|------------ &nbsp;[branch 2]</p>   <ol class="list _decimal"><li class="list__item" id="89bcf322"><p>merge b2 with C1</p></li><li class="list__item" id="f668df98"><p>run C1's migration on b2</p></li><li class="list__item" id="a822521e"><p>merge with C2</p></li><li class="list__item" id="a32de48f"><p>run the migration on b2</p></li><li class="list__item" id="910e2205"><p>merge with b1</p></li></ol>   <h4 id="3.migrationswerecreatedinbothbranches">3. Migrations were created in both branches</h4>   <p id="0bf4bafb">In general, we recommend you to avoid this situation as it's harder to resolve. This scenario can best be avoided by having all migrations created in only one agreed-upon branch (e.g. master).</p>   <p id="8feb51e3">But if you got into this situation, here's a way to resolve it gracefully:</p>   <p id="27756cd4">&nbsp; &nbsp; &nbsp; &nbsp;|--- C1 ----- &nbsp;[branch 1]</p>   <p id="753c4572">------|</p>   <p id="241607cf">&nbsp; &nbsp; &nbsp; &nbsp;|--- C2 ----- &nbsp;[branch 2]</p>   <ol class="list _decimal"><li class="list__item" id="13b93990"><p>Merge b2 and C1, b1 and C2</p></li><li class="list__item" id="048994f3"><p>Run C1's migration on b2, C2's migration on b1</p></li><li class="list__item" id="c41265a4"><p>merge the branches</p></li></ol><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="migrations.html">Migrations</a><a class="navigation-links__next" href="scripts.html">Scripts</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>