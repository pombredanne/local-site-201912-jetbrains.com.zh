<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Common language patterns - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Common+language+patterns.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Common+language+patterns.html" id="common-language-patterns.xml">Common language patterns</h1>   <p id="231fc670">This chapter covers common language design patterns that the beginners learning MPS would frequently come across. We've identified these over time as the most frequent questions that MPS users ask in the on-line forum and so we decided to summarise the answers in a single place for easy reference.</p>         <ul data-skip-index="skip"><li class="list__item"><a href="#sampleprojectwith%C2%A0languagepatterns%C2%A0">Sample project with&nbsp;language patterns&nbsp;</a></li><li class="list__item"><a href="#initialtips">Initial tips</a></li><li class="list__item"><a href="#namingconcepts">Naming concepts</a></li><li class="list__item"><a href="#valididentifiers">Valid identifiers</a></li><li class="list__item"><a href="#uniquenames">Unique names</a></li><li class="list__item"><a href="#notseeingtype-systemerrors">Not seeing type-system errors</a></li><li class="list__item"><a href="#regularexpressions">Regular expressions</a></li><li class="list__item"><a href="#safeoperatorsandoperations">Safe operators and operations</a></li><li class="list__item"><a href="#basicpatterns">Basic patterns</a></li><li class="list__item"><a href="#container-component">Container - component</a></li><li class="list__item"><a href="#customizedpresentation">Customized presentation</a></li><li class="list__item"><a href="#declaration-references">Declaration - references</a></li><li class="list__item"><a href="#fluentediting">Fluent editing</a></li><li class="list__item"><a href="#overrideeditorcomponent">Override editor component</a></li><li class="list__item"><a href="#seamlesssubstitution">Seamless substitution</a></li><li class="list__item"><a href="#hierarchicalscopes">Hierarchical scopes</a></li><li class="list__item"><a href="#extendingthedotexpressionforyourownreferences">Extending the DotExpression for your own references</a></li></ul>      <h2 id="sampleprojectwith&nbsp;languagepatterns&nbsp;">Sample project with language patterns </h2>   <p id="e78f0886">MPS comes bundled with sample projects. Many of the patterns discussed here have been implemented in the <b id="b9ff7573">languagePatterns</b>&nbsp;sample project. You can open it up in MPS (click on <i id="e3e7b199">Open sample project</i>&nbsp;in the MPS welcome screen) and check the actual implementation of the patterns of this chapter that refer to the sample project.</p>   <p id="b13215bf">      <figure><img alt="mps patterns1" title="mps patterns1" src="/help/img/idea/2019.1/mps-patterns1.png" id="02fdb8e4" width="890" height="1040"></figure>      <br> The patterns are organised into virtual packages both in the language definition and in the sandbox solution, to help you identify the elements that form the individual patterns.</p>   <h2 id="initialtips">Initial tips</h2>   <h3 id="namingconcepts">Naming concepts</h3>   <p id="3e9e1c75">Many concepts need to provide a string property to hold the name of the nodes. Since a name of a concept has certain special qualities and needs to be recognised and handled by MPS in a special way (e.g. to label nodes in the code completion menu as well as in the Project View, Node Explorer, Debugger Tool Window and others), it is advisable to inherit the property from the <i id="e6f30ebd">INamedConcept</i>&nbsp;concept interface. Many of your concepts and almost all root concepts should thus declare to&nbsp;<b id="2481112a">implement</b>&nbsp;<i id="7c2b5fdd">INamedConcept</i>.</p>   <h3 id="valididentifiers">Valid identifiers</h3>   <p id="22c78769">If you are extending <i id="d6ec4cc3">BaseLanguage</i>&nbsp;and the name of the concept translates directly to a Java identifier, you should consider inheriting the <b id="f0dfbb79">name</b>&nbsp;property from the&nbsp;<i id="525f622e">IValidIdentifier</i>&nbsp;concept interface, which extends <i id="bf09b56a">INamedConcept</i>. It will ensure through constraints that the name meets the criteria for a valid Java identifier.</p>   <h3 id="uniquenames">Unique names</h3>   <p id="f77a352c">Frequently you want to ensure uniqueness of names for a certain group of nodes of the same concept. You may use either constraints or non-typesystem rules. Not-typesystem rules give you the option to customise the error message and may even offer quick-fixes to the user for automatic problem resolution. A sample uniqueness check for the name of an <i id="7a889022">InputField</i>&nbsp;in a <i id="0fc26818">Calculator</i>&nbsp;of the Calculator tutorial would look like this:</p>   <div class="code-block" data-lang="none">checking rule check_InputField {
&nbsp; applicable for concept = InputField as inputField
&nbsp; overrides false

&nbsp; do {
&nbsp; &nbsp; if (inputField.parent : Calculator.inputField.any({~it =&gt; it.name :eq: inputField.name &amp;&amp; it :ne: inputField; })) {
&nbsp;     error "Duplicate name " + inputField.name -&gt; inputField;
    }
&nbsp; } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
</div>   <p id="ed1c5dd1">The same constraint specified with constraints would look this way:</p>   <div class="code-block" data-lang="none">concepts constraints InputField {&nbsp;
&nbsp; can be child &lt;none&gt;&nbsp;
&nbsp; &nbsp;
&nbsp; can be parent &lt;none&gt;&nbsp;
&nbsp; &nbsp;
&nbsp; can be ancestor &lt;none&gt;&nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; property {name}&nbsp;
&nbsp; &nbsp; get:&lt;default&gt;&nbsp;
&nbsp; &nbsp; set:&lt;default&gt;&nbsp;
&nbsp; &nbsp; is valid:(propertyValue, node)-&gt;boolean {&nbsp;
&nbsp; &nbsp; &nbsp; node.parent : Calculator.inputField.where({~it =&gt; it.name :eq: propertyValue; }).size &lt;= 1;&nbsp;
&nbsp; &nbsp; }&nbsp;
&nbsp; &nbsp;
&nbsp; &nbsp;
&nbsp; &lt;&lt;referent constraints&gt;&gt;&nbsp;
&nbsp; &nbsp;
&nbsp; default scope&nbsp;
&nbsp; &nbsp; &lt;no default scope&gt;&nbsp;
&nbsp; &nbsp;
}
</div>   <p id="86492826">Please note that constraints are probably less optimal here, for several reasons:</p>   <ul class="list _ul"><li class="list__item" id="a6d00a26"><p>you cannot specify a quick-fix</p></li><li class="list__item" id="f3a22292"><p>you cannot customise the error message</p></li><li class="list__item" id="f80901a9"><p>while the non-typesystem rule only underlines the duplicate names to indicate the error, constraints prevent invalid values to be inserted into the model and display the invalid values in red font, which makes the errors look more severe</p></li></ul>   <h3 id="notseeingtype-systemerrors">Not seeing type-system errors</h3>   <p id="d03afc3c">The type-system runs in the background and may sometimes be slow to deliver its results into the editor. Hit <b id="a0d60d5d">F5</b>&nbsp;in order to refresh all error and warning messages in the editor. Also make sure you have the <b id="ed62afe5">Power Save Mode</b>&nbsp;setting switched off. In <b id="60463d65">Power Safe Mode</b>&nbsp;the type-system only runs on explicit demand from the user (F5).</p>   <h3 id="regularexpressions">Regular expressions</h3>   <p id="a8201fc6">By default properties can be of one of three types - <b id="33593762">integer</b>, <b id="ce4aecd6">boolean</b>&nbsp;and <b id="7c42ffa8">string</b>. If you want a more customized datatype, you have to define one and restrict the allowed values by a regular expression. <i id="b7292a26">BaseLanguage</i> defines float types this way, foe example. Open the&nbsp;<i id="9e293f5f">FloatingPointConstant</i>&nbsp;concept (Control/Cmd + N) and see the property <i id="b9b885f8">value</i>&nbsp;- it has a type of&nbsp;<i id="297b8c44">_FPNumber_String</i>. Navigate to the definition of&nbsp;<i id="5977b0e6">_FPNumber_String</i>&nbsp;(Control/Cmd + B) to see an example of a constrained data type:</p>   <div class="code-block" data-lang="none">constrained string datatype: _FPNumber_String &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; matching regexp: -?[0-9]+\\.[0-9]*([Ee][\\+\\-]?[0-9]+)?[dD]?
</div>   <h3 id="safeoperatorsandoperations">Safe operators and operations</h3>   <p id="8aee9283">      <i id="d7fd12bc">BaseLanguage</i>&nbsp;and its core extensions offer several handy shortcuts for common operations that in Java require more efforts to get right - for example, checking for <i id="aa5ddbc0">null</i>&nbsp;before comparing, distinguishing <b id="2eea6216">empty</b> and <b id="4add7533">null</b> lists, calling equals instead of "==", etc. Here's a list of the most commonly useful ones:</p>   <ul class="list _ul"><li class="list__item" id="d42903da"><p>:eq: - null-safe equals</p></li><li class="list__item" id="f101d9cb"><p>:ne: - null-safe not-equals</p></li><li class="list__item" id="d6d7ea06"><p>isNull</p></li><li class="list__item" id="ac2e7b2e"><p>isNotNull</p></li><li class="list__item" id="1fc8a2a7"><p>size</p></li><li class="list__item" id="070d7b36"><p>isEmpty</p></li><li class="list__item" id="e3f685cc"><p>isNotEmpty</p></li></ul>   <h2 id="basicpatterns">Basic patterns</h2>   <h3 id="container-component">Container - component</h3>   <p id="269eff1c">Illustrated as the <i id="78992035">container-component</i>&nbsp;virtual package in the <b id="64cc9c5b">languagePatterns</b>&nbsp;sample.</p>   <p id="61983aa5">A common scenario where a container (FruitPlate in our case) contains elements (Fruit) of multiple kinds (Apples, Oranges). An abstract concept (Fruit) is used&nbsp;as a placeholder in the container and concrete sub-concepts (Apples, Oranges) are then provided by the language user explicitly. The sub-concepts may have completely different visual appearance.</p>   <p id="60bc7a5f">      <figure><img alt="mps patterns2" title="mps patterns2" src="/help/img/idea/2019.1/mps-patterns2.png" id="a4932686" width="1104" height="684"></figure>      <br> See also the <i id="cafaa294">seamless-substitution</i>&nbsp;pattern to learn about how to allow the user to switch Apples to Oranges and back with little effort. The current implementation requires the user to first select the whole node (Apple or Orange) and only then code-completion offers the alternatives.</p>         <figure><img alt="patterns3" title="patterns3" src="/help/img/idea/2019.1/patterns3.png" id="cb0b8775" width="1274" height="338"></figure>      <h3 id="customizedpresentation">Customized presentation</h3>   <p id="ef235b67">Illustrated as the&nbsp;<i id="89bd82d9">custom-presentation</i>&nbsp;virtual package in the&nbsp;<b id="06367615">languagePatterns</b>&nbsp;sample.</p>   <p id="d24811cc">Motivated by the discussion at <a href="http://forum.jetbrains.com/thread/Meta-Programming-System-2138?message=Meta-Programming-System-2138-3" data-external="true" target="_blank" rel="noopener noreferrer">http://forum.jetbrains.com/thread/Meta-Programming-System-2138?message=Meta-Programming-System-2138-3</a>      <br> Components held within <i id="209a243b">Containers</i> are referred to from <i id="952353c4">ComponentUsages</i>. The reference, however, should contain the name of the containing <i id="ca15d40d">Container</i>       <b id="152abd61">together</b>&nbsp;with the name of the <i id="75a82977">Component</i> - both in the completion menu and in the editor.</p>         <figure><img alt="patterns4" title="patterns4" src="/help/img/idea/2019.1/patterns4.png" id="830fbabd" width="1414" height="504"></figure>      <p id="fada4d53">      <figure><img alt="patterns6" title="patterns6" src="/help/img/idea/2019.1/patterns6.png" id="0f7ee7bf" width="1772" height="1186"></figure>      <br> Additionally, scoping rules should guarantee that only one reference to any&nbsp;<i id="c0e3018b">Component</i> may exist and the completion menu is filtered so that already referred <i id="667eb8f9">Components</i> are not offered.</p>         <figure><img alt="patterns5" title="patterns5" src="/help/img/idea/2019.1/patterns5.png" id="30e04428" width="3732" height="1296"></figure>      <h3 id="declaration-references">Declaration - references</h3>   <p id="57b2805e">Illustrated as the&nbsp;<i id="59e78e31">declaration-references</i>&nbsp;virtual package in the&nbsp;<b id="387d93e4">languagePatterns</b>&nbsp;sample.</p>         <figure><img alt="patterns8" title="patterns8" src="/help/img/idea/2019.1/patterns8.png" id="d421a24f" width="1736" height="878"></figure>      <p id="3e4cfad2">A typical pattern on declarations and references to them - <i id="49748b48">Singers</i> at an event can be organised into agendas with their <i id="204ea7b6">Performances</i>. Different types of&nbsp;<i id="3751dc5b">Performances</i> are available.</p>   <p id="44a26efe">Scoping rules ensure that:</p>   <ul class="list _ul"><li class="list__item" id="b95bc16b"><p>only singers listed in the current event can be added to its agenda</p></li><li class="list__item" id="7b604d16"><p>each singer can only be listed once in a combined performance</p></li><li class="list__item" id="4e2e47b7"><p>a handy intention (<i id="a3fc3232">IntroduceSinger</i>) is available to create a singer from a string typed in the performance (frequently known as "create from usage"&nbsp;or "introduce variable" refactoring).</p></li></ul>   <h3 id="fluentediting">Fluent editing</h3>   <p id="2d7624b4">Illustrated as the&nbsp;<i id="c8e05fca">fluent-editing</i>&nbsp;virtual package in the&nbsp;<b id="033abc5f">languagePatterns</b>&nbsp;sample.</p>         <figure><img alt="patterns7" title="patterns7" src="/help/img/idea/2019.1/patterns7.png" id="6b0ab22a" width="497" height="209"></figure>      <p id="55b7f53d">An example of creating a text-like editing experience and implements many of the recommendations mentioned in&nbsp;the Editor cookbook (<a href="editor-cookbook.html">Editor cookbook</a>). It implements a simple language for specifying drawing commands (line, rectangle):</p>   <ul class="list _ul"><li class="list__item" id="3d2bba07"><p>an empty line is inserted upon hitting Enter, empty lines can be placed anywhere thanks to a default node factory specified for the child collection</p></li><li class="list__item" id="fb433d5e"><p>empty line does not appear as an option in the completion menu thanks to implementing the <i id="f0ddc009">IDontSubstituteByDefault</i> concept interface</p></li><li class="list__item" id="cd888259"><p>typing on an empty line will insert the desired item (line or rectangle)</p></li><li class="list__item" id="eccd77dc"><p>when the body of a block of code is empty, the cursor is positioned on the first line (next to the header), editing can be started on this first line</p></li><li class="list__item" id="28f40a64"><p>         <i id="b2dd18e4">NodeFactories</i> take care of propagating values to new nodes if a nodes is replaced with another one</p></li><li class="list__item" id="bdbb462c"><p>an optional "line style" child can be specified on the left of the draw commands thanks to left-side transformations</p></li><li class="list__item" id="e925bca5"><p>wrappers allow the desired line style to be typed on an empty line and an intermediate "<i id="9e4e7034">IncompleteCommand</i>" will be created automatically our of it</p></li><li class="list__item" id="89812cc9"><p>         <i id="5a91a167">IncompleteCommand</i> expects either line or rectangle to be typed and will be substituted into the desired draw command instantly</p></li><li class="list__item" id="72222a0f"><p>draw commands define aliases and editors so that they start with the same word</p></li><li class="list__item" id="219bb724"><p>an editor in the abstract super-concept of the draw commands is reused by concrete sub-concepts</p></li><li class="list__item" id="8ca95107"><p>typing on the left hand-side of a command will offer the allowed prefixes</p></li><li class="list__item" id="0913e199"><p>deleting a prefix (solid, dotted) will correctly delete only the prefix</p></li></ul>   <h3 id="overrideeditorcomponent">Override editor component</h3>   <p id="e8c57dd1">Illustrated as the&nbsp;<i id="bcef1e52">override-editor-component</i>&nbsp;virtual package in the&nbsp;<b id="a5bc1354">languagePatterns</b>&nbsp;sample.</p>   <p id="04f5172d">An example of using editor components that get overriden in a sub-concept (<i id="5ef93084">Truck</i>). An editor in <i id="b011b3a7">Car</i> uses an editor component <i id="4d7246c9">CarProperties</i> also defined in <i id="0efe756c">Car</i>.&nbsp;A sub-concept (<i id="4993a2e9">Truck</i>) overrides the <i id="3a9baa19">CarProperties</i> editor component with the <i id="84458272">TruckProperties</i> editor component to contain its own properties. The editor in <i id="881c5c7f">Car</i>&nbsp;will use the <i id="0f2a8ad9">Trucks</i> variant of the editor component for <i id="e9926ee2">Trucks</i> and the <i id="9c6a448f">Car</i> variant for <i id="7a145814">Cars</i>.</p>         <figure><img alt="patterns9" title="patterns9" src="/help/img/idea/2019.1/patterns9.png" id="a1b35e58" width="2494" height="1138"></figure>      <h3 id="seamlesssubstitution">Seamless substitution</h3>   <p id="384ee6b7">Illustrated as the&nbsp;<i id="053c0e48">seamless-substitution</i>&nbsp;virtual package in the&nbsp;<b id="02a8eab6">languagePatterns</b>&nbsp;sample.</p>         <figure><img alt="patterns10" title="patterns10" src="/help/img/idea/2019.1/patterns10.png" id="0a31b850" width="2276" height="340"></figure>      <p id="2bc3b003">An example that seamlessly switches (substitutes) between different related subconcepts. A <i id="3a9ace85">Request</i> contains a "description", which may be either a <b id="668200f1">string</b>,&nbsp;a <b id="022faf52">simple form</b> or a <b id="806ba918">complex form</b>. A completion-menu lets the user pick the requested description type. If the user simply types text, the "string"-based&nbsp;description is picked automatically in the "<i id="54321283">PickTheRightDescriptionType</i>" substitute action.&nbsp;The <b id="ffebbdbf">first cell of editors</b> for each of the description concepts is sensitive to substitution (set through the "menu" property of the cell)&nbsp;and so offers the option to switch between description types with completion-menu.&nbsp;The "<i id="cfa92fcc">Converters</i>" node factories contain code that preserves parts of the description information and propagates it into the newly instantiated&nbsp;description concept.</p>         <figure><img alt="patterns11" title="patterns11" src="/help/img/idea/2019.1/patterns11.png" id="0e4d4c11" width="2162" height="1728"></figure>      <br>       <figure><img alt="patterns12" title="patterns12" src="/help/img/idea/2019.1/patterns12.png" id="34d4de9b" width="2834" height="1734"></figure>      <h3 id="hierarchicalscopes">Hierarchical scopes</h3>   <p id="9749d26b">If you are defining references of some sort, you typically want to restrict the scope for the references so they can only point to nodes in certain locations or "distance" from the reference. Additionally, definitions may hide other references&nbsp;with the same names that are further away from the reference - think of Java's local variables hiding parameter declarations or fields, for example. In MPS when defining references you provide the scope of the reference in the <b id="c729ae7a">Constraints</b>&nbsp;aspect of the language definition. For hierarchical scopes you use the <b id="05cdcc7f">inherited scope</b>&nbsp;type in the reference and then let your code containers (aka classes, methods, block statements, etc.) implement <i id="4d5e2aac">ScopeProvider</i>&nbsp;concept interface. In its <i id="cfacde9b">getScope()</i>&nbsp;method you implement the logic of retrieving candidate targets of certain kind for references that want to point to them. Check out the <a href="scopes.html">Scopes documentation</a> for detailed how-to.</p>   <h3 id="extendingthedotexpressionforyourownreferences">Extending the DotExpression for your own references</h3>   <p id="c42b29d1">Illustrated as the&nbsp;<i id="0f049248">dotexpression</i>&nbsp;virtual package in the&nbsp;<b id="67af42d0">languagePatterns</b>&nbsp;sample (bundled in MPS 3.3 and later).</p>   <p id="643c585f">De-referencing elements by "dot" notation is a very common practise in many languages. <i id="745f480a">BaseLanguage</i>&nbsp;offers the&nbsp;<i id="2fbc47af">DotExpression</i>&nbsp;concept to mimics Java's "dot" operator and you can leverage it in your languages, if they're extending <i id="ab544969">BaseLanguage</i>'s expressions. Let's assume a simple form with several addresses that need to be validated by validation expressions.&nbsp;The expressions need to refer to the street and zip code&nbsp;of each address in order to include their values in the validation expression:</p>   <p id="9abc5888">      <figure><img alt="patterns13" title="patterns13" src="/help/img/idea/2019.1/patterns13.png" id="f6a18005" width="1632" height="358"></figure>      <br> Each address is represented by a node of <i id="5f89c168">Address</i>&nbsp;concept. Notice that it also customises the presentation so that it displays the "kind" property in the code-completion menu:</p>         <figure><img alt="patterns14" title="patterns14" src="/help/img/idea/2019.1/patterns14.png" id="90889ba8" width="1094" height="754"></figure>      <p id="7235fd01">      <figure><img alt="patterns15" title="patterns15" src="/help/img/idea/2019.1/patterns15.png" id="f605d9cd" width="1114" height="536"></figure>      <br> The <i id="2af2ae36">AddressReference</i>&nbsp;concept allows referring to addresses from within <i id="d2ab8223">BaseLanguage</i>&nbsp;expressions in the validation section.</p>   <p id="2f5f2f2a">      <figure><img alt="patterns16" title="patterns16" src="/help/img/idea/2019.1/patterns16.png" id="4800b28f" width="2882" height="914"></figure>      <br> All <i id="ead7bf47">BaseLanguage</i>&nbsp;expressions are converted to <i id="c8f0810d">DotExpression</i>&nbsp;as soon as you append "dot" to them, with the left operand being the original expression. What remains is the right side of the <i id="6b969f8e">DotExpression</i>, called <b id="e9aca161">operation</b>. Operations implement the <i id="d0169eb9">IOperation</i>&nbsp;concept interface. We will need two operations, one for street and one for the zip code, thus we'll start with a common abstract super concept for these:</p>         <figure><img alt="patterns17" title="patterns17" src="/help/img/idea/2019.1/patterns17.png" id="a9a4d207" width="2878" height="1520"></figure>      <p id="b2d7cdfd">The concrete operations then only specify a meaningful alias and a type-system rule so as to participate properly in the whole surrounding expression:</p>         <figure><img alt="patterns18" title="patterns18" src="/help/img/idea/2019.1/patterns18.png" id="9bfd62b6" width="2872" height="784"></figure>   <div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="commenting-out-nodes.html">Commenting out nodes</a><a class="navigation-links__next" href="howto-integrating-into-the-mps-make-framework.html">HowTo -- Integrating into the MPS Make Framework</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>