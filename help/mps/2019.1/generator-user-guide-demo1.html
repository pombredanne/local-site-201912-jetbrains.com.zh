<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Generator User Guide Demo1 - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Generator+User+Guide+Demo1.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Generator+User+Guide+Demo1.html" id="generator-user-guide-demo1.xml">Generator User Guide Demo1</h1>   <h2 id="generatoruserguidedemo1">Generator User Guide Demo 1</h2>   <p id="a0424624">In this demo we will create a generator that will generate a java application for each input XML Document.</p>   <p id="5503e794">We'll re-use the <i id="cf5edc3c">'generator_demo.test1</i>' model in solution '<i id="c05b0512">test_models</i>' that we have created earlier.&nbsp;This model uses the '<i id="cd63bcce">jetbrains.mps.sampleXML</i>' language and contains two XML Documents - a 'Button' and a 'Label'.<br> We will apply a root mapping rule to each of these documents in order to generate the output java application.&nbsp;In the application's main method the generated code will instantiate a swing frame and add a requested swing component to its content pane. The component is going to be either a JButton or a JLabel, depending on the name of the root element in the input document.</p>   <p id="b6d27bb9">So, our 'Button' XML Document will be translated into a Java application that will show a button inside a frame.</p>   <h2 id="newlanguage">New Language</h2>   <p id="b42b0ae9">The first thing to do is to create a language that will enhance <i id="1dd80646">simpleXML</i>&nbsp;with a new generator. Instead of generating XML, we now need to generate Java code.</p>   <ul class="list _ul"><li class="list__item" id="03804251"><p>choose <i id="4edb67ba">New -&gt; Language</i> in project's popup menu</p></li><li class="list__item" id="e91e62b5"><p>enter language name: 'generator_demo.demoLang1'</p></li></ul>         <figure><img alt="gda1" title="gda1" src="/help/img/idea/2019.1/gda1.png" id="d60eb334" width="498" height="328"></figure>      <ul class="list _ul"><li class="list__item" id="8736cce4"><p>add the 'jetbrains.mps.sampleXML' as well as 'jetbrains.mps.baseLanguage' languages as <b id="664ec45a">extended languages</b>&nbsp;into the <i id="b0160d4f">Dependencies</i>&nbsp;section in the <i id="6bd9f6f9">demoLang1</i> language properties dialog</p></li></ul>         <figure><img alt="gdx" title="gdx" src="/help/img/idea/2019.1/gdx.png" id="240e6dab" width="668" height="470"></figure>      <h2 id="newgenerator">New Generator</h2>   <p id="5737a142">MPS has created an empty generator module inside the '<i id="4c95b478">generator_demo.demoLang1</i>' language as well as&nbsp;a <b id="827a5cd0">generator model</b> 'main@generator' containing an empty&nbsp;<b id="b8af4df0">mapping configuration</b> node 'main'. If not, you can easily have them created through the context menu for the '<i id="46f61d3a">generator_demo.demoLang1</i>' language.</p>         <figure><img alt="gda3" title="gda3" src="/help/img/idea/2019.1/gda3.png" id="b8316979" width="361" height="354"></figure>      <p id="0435b63e">Mapping configurations serve as generator's 'entry points' where all <b id="f95418c4">generator rules</b> are declared and from where&nbsp;<b id="119bb4e7">templates</b>&nbsp;can be referenced. Templates contain snippets of target code with declared placeholders for values to fill in from the input model. The templates are the core of MPS model-to-model transformation process.</p>   <p id="ac8997cb">The <b id="cefc8044">model stereotype</b> 'generator' (shown after symbol '@' in the model name) allows MPS to tell a generator model from a regular model.&nbsp;Any node in generator model is interpreted as a <b id="b472f1ca">template</b> unless that node is a part of the&nbsp;<b id="89a34e0b">generator language</b> itself.</p>   <p id="37b27c97">For instance, a mapping configuration node is a part of the generator language (the 'MappingConfiguration' concept is declared in language 'jetbrains.mps.lang.generator').<br> The <b id="e616428f">class</b> node, which we will create in the next step, is not a part of the generator language and so will be used as a template in our generator.</p>   <h2 id="rootmappingrule">Root Mapping Rule</h2>   <p id="75ae83e6">Let's create our first rule which will generate a Java application class for each input XML Document.</p>   <ul class="list _ul"><li class="list__item" id="8ccb43e9"><p>open the mapping configuration named 'main' in the editor</p></li><li class="list__item" id="9860fd90"><p>add a new rule in the <b id="016770ed">root&nbsp;mapping rules</b> section (press <i id="bae1c912">Insert</i>&nbsp;or <i id="96a891c1">Enter</i>&nbsp;with cursor is in the section)</p></li><li class="list__item" id="013faba0"><p>choose the rule's applicable concept: 'Document'</p></li></ul>         <figure><img alt="gda4" title="gda4" src="/help/img/idea/2019.1/gda4.png" id="80c9d1df" width="926" height="317"></figure>      <p id="1c671eb2">As we want to generate a class for each input <i id="5deb01c4">Document</i>, the template for this rule that we have to specify as part of the mapping rule is going to be a Class - i.e. an instance of the '<i id="dd040a9b">ClassConcept</i>' concept defined in <i id="dcd75c9c">BaseLanguage</i>.</p>   <p id="e68088f0">The easiest way to create that template is to apply intention (see the  on the left edge of the editor?):</p>   <ul class="list _ul"><li class="list__item" id="73e4bbb6"><p>press <i id="e23a132a">Alt-Enter</i> while cursor is in the red field '&lt;no template&gt;'</p></li><li class="list__item" id="db90a707"><p>choose <i id="d65e5ed5">New Root Template</i>      </p></li><li class="list__item" id="8a4ee57c"><p>choose <i id="02096a37">class</i>.</p></li><li class="list__item" id="3cf38291"><p>open the newly created class in the editor (use <i id="1da0d14f">Ctrl+left-click</i> or <i id="e6347964">Ctrl+B</i> on the reference)</p></li></ul>         <figure><img alt="gda5" title="gda5" src="/help/img/idea/2019.1/gda5.png" id="659c3571" width="623" height="147"></figure>      <br>       <figure><img alt="gda6" title="gda6" src="/help/img/idea/2019.1/gda6.png" id="3a9734d4" width="546" height="116"></figure>      <br>       <figure><img alt="gda7" title="gda7" src="/help/img/idea/2019.1/gda7.png" id="b57fea36" width="388" height="169"></figure>      <h2 id="property-macro">Property-macro</h2>   <p id="76a58dc2">A template needs to be parametrized with values from the input model to be of any good. MPS gives you several types of macros to hook values from the input model into your templates.&nbsp;Property-macros, which we are going to start with, are used to compute values of output model nodes' properties at the time of generation.</p>   <p id="bbb65dee">Let's start with something very trivial - we want to generate an output class with the same name as was the name of the input <i id="32aceb39">Document</i>.<br> Thus we will create a property-macro for the output class's name:</p>   <ul class="list _ul"><li class="list__item" id="41653e08"><p>put the cursor somewhere inside the name of the class</p></li><li class="list__item" id="daa200e8"><p>press <i id="3fc2128a">Ctrl-Shift+M</i> and choose <i id="f323cd72">property macro</i> in menu</p></li><li class="list__item" id="97a6ea55"><p>alternatively you could use <i id="8499c769">Intentions</i>&nbsp;through the <i id="53ad6016">Alt + Enter</i>&nbsp;command</p></li><li class="list__item" id="63108ad5"><p>select the macro node in editor (rendered as '$' symbol) and open the inspector window for it (<i id="db123600">Alt-Shift+I</i>)</p></li><li class="list__item" id="061c6213"><p>enter the code for the <b id="b1126883">value</b> function that will calculate the actual name of the class when it is being generated</p></li><li class="list__item" id="a72663bc"><p>the function can refer to the original <i id="14348aab">Document</i>&nbsp;node through the <i id="f4c4af71">node</i>&nbsp;parameter</p></li><li class="list__item" id="d23a2495"><p>this&nbsp;<b id="9f986577">value</b>&nbsp;function will in our case return the name of original Document</p></li></ul>         <figure><img alt="gda8" title="gda8" src="/help/img/idea/2019.1/gda8.png" id="0c25c6f1" width="893" height="453"></figure>      <aside class="tip sideblock" data-title="" rel="47ea21c9" id="4cc89503">      <p id="cd203f63">Type of the&nbsp;<i id="161a4319">node</i> in this case is 'node&lt;Document&gt;' (to find out type of node select it in code and press <i id="b435a237">Ctrl-Shift+T</i>). MPS knows the type of the input node, because this template's header explicitly specifies Document as the template input.</p>   </aside>   <h2 id="themain()method">The main() method</h2>   <p id="d45be6ca">Since we plan to use Java Swing components in the generated code, we need to import the MPS <b id="6fce950e">java_stub</b>&nbsp;models for the&nbsp;'java.awt' and 'javax.swing' packages into the generator model.</p>      <ul class="list _ul"><li class="list__item" id="9bd8c813"><p>press <i id="bf692a85">Ctrl-M</i> (import model)</p></li><li class="list__item" id="0d8f3d8f"><p>choose 'java.awt@java_stub' model</p></li><li class="list__item" id="9d49fd2d"><p>press <i id="302267c2">Ctrl-M</i> again</p></li><li class="list__item" id="012f2461"><p>choose 'javax.swing@java_stub' model</p></li></ul>   <p id="dbbff969">      <figure><img alt="gda9" title="gda9" src="/help/img/idea/2019.1/gda9.png" id="d0db0194" width="718" height="399"></figure>      <br> With the imports out of the way, we can now create the <i id="03d1b3c8">main()</i> method. Typing 'psvm' will trigger an automated action that inserts an empty <i id="30b617cc">main</i>&nbsp;method for you. Alternatively you can just type the method signature yourself.</p>         <figure><img alt="gda10" title="gda10" src="/help/img/idea/2019.1/gda10.png" id="d2d923ec" width="738" height="367"></figure>      <p id="b6e0e317"> If you stumbled trying to enter 'String[]' - don't panic, you are not alone. <a href="mps-faq.html">Help is here</a>   </p>   <h2 id="switch-macro">SWITCH-macro</h2>   <p id="744ee9d6">You might have wondered why we pass <b id="55ad1b01">null</b>&nbsp;into the <i id="f3e7060f">container.add()</i>&nbsp;method, while instead we need to pass in either a new <b id="ff8533b9">Button</b>&nbsp;or a <b id="fd13315c">Label</b>, depending on the actual value in the input XML <i id="d0e0c143">Document</i>.&nbsp;That is the last thing we have to do in this template - to replace the 'null' argument in the 'container.add(<b id="c9a42a23">null</b>)' expression with expression creating a swing component.<br> We will generate 'new JButton()' expression if the root element in the input document is named 'button', and 'new JLabel()' if the root element is named 'label'.</p>   <p id="68576c8a">To perform this replacement we will 'wrap' the 'null' argument into a <b id="119613bb">SWITCH-macro</b>.<br> A SWITCH-macro replaces the 'wrapped' template node with a new node. The replacing node is created depending on, which case-condition is satisfied in the associated <b id="1ae1a54b">template switch</b>.</p>   <p id="83d3109e">To begin with, let's create new <b id="1e40a6aa">template switch</b> named 'switch_JComponentByElementName'.</p>   <p id="bbeb340f">      <figure><img alt="gda11" title="gda11" src="/help/img/idea/2019.1/gda11.png" id="2504fbd1" width="961" height="253"></figure>      <br>  To start entering a <b id="3c12d0e3">condition</b> code press <i id="68a0331d">Insert</i>      <br>  The '&lt;T...T&gt;' things on next screenshot are called <b id="768e2eae">in-line template</b>. See also the note below the screenshot.</p>   <p id="d0b85227">      <figure><img alt="gda12" title="gda12" src="/help/img/idea/2019.1/gda12.png" id="93be03c7" width="1084" height="465"></figure>      <br> That's it. We are testing element's name. If it is 'button' we generate 'new JButton()'. Identically, if it is 'label' we generate 'new JLabel()'. If it is neither 'button' nor 'label' we are raising an error.</p>   <aside class="note " data-title="" rel="d0b85227" id="d5ea63a2">      <p id="27869dde">Creation of in-line template like <i id="d8d6dbd6">&lt;T new JButton() T&gt;</i> is not a trivial task.<br> If you stumbled trying to do that consider the following diagram.<br>          <figure><img alt="gd1 inline macro in switch" title="gd1 inline macro in switch" src="/help/img/idea/2019.1/gd1-inline-macro-in-switch.PNG" id="b89953be" width="796" height="694"></figure>      </p>   </aside>   <p id="d71a5c11">Now we are ready to attach the SWITCH-macro to the 'null' argument node in the in the 'container.add(<b id="19a423f9">null</b>)' expression.</p>   <ul class="list _ul"><li class="list__item" id="6bd9245d"><p>return to the 'main()' method in the 'Document' template</p></li><li class="list__item" id="14f8ab5d"><p>select the 'null' node in the 'container.add(<b id="17d1ee0b">null</b>)' expression</p></li><li class="list__item" id="e8b5d075"><p>press <i id="a48fb5be">Ctrl-Shift-M</i> to add an abstract node-macro</p></li><li class="list__item" id="44b3fdf6"><p>press <i id="92c1fa47">Ctrl+Space</i> to invoke completion menu and choose <i id="9d02eaf5">$SWITCH$</i>      </p></li><li class="list__item" id="fb90f0e2"><p>go to inspector of the $SWITCH$ macro</p></li><li class="list__item" id="93473b33"><p>enter the code (see below) in the <b id="2a474dfe">mapped node</b> function (press <i id="5174627b">Insert</i> to start entering) to set the node on which to make a decision regarding the switch</p></li><li class="list__item" id="9901fb86"><p>make reference to the 'switch_JComponentByElementName' template switch node that we created earlier to refer the switching process to</p></li></ul>   <p id="ba3e303e">      <figure><img alt="gda13" title="gda13" src="/help/img/idea/2019.1/gda13.png" id="a5166177" width="933" height="540"></figure>      <br> What does the <b id="37d31270">mapped node</b> function do and why do we need it?</p>   <p id="b655ae07">Up to this point our input node inside the <i id="a03d8789">map_Document</i>&nbsp;template&nbsp;has been a <i id="d20798fa">Document</i>.&nbsp;But the template switch '<i id="7330b770">switch_JComponentByElementName</i>' expects an <i id="317fc5e9">Element</i> as its input, not a <i id="f7d3b228">Document</i>.&nbsp;Thus we have to replace the input node - a <i id="0d83d2e1">Document</i>, with a new input node - an <i id="d344322d">Element</i>.&nbsp;The expression '<i id="8df05d3d">node.rootElement</i>' returns the root element of the current input document. The root element will become the new input node applicable inside the <i id="5bd0bb85">template switch</i>.</p>   <aside class="tip sideblock" data-title="" rel="b655ae07" id="2e26dea9">      <p id="3ef930ed">The 'rootElement' is a role of a child. You can navigate to the child link declaration by pressing <i id="b8d0d0c8">Ctrl+left-click</i> or <i id="42135119">Ctrl+B</i> on the 'rootElement'.</p>   </aside>   <h2 id="gettingreadyforthefirsttest">Getting Ready for the First Test</h2>   <p id="8cee452e">It is very important to remember that whatever changes you made in generator models that only become visible to other modules after the generator has been made. Your last action after making changes should always be the same: <b id="e3d6ca19">Make the generator</b>.<br> There is just one model in our generator so hit <i id="8c54a65c">Shift + Control + F9</i>&nbsp;or Shift +&nbsp;<i id="92c25486">Cmd + F9</i> (make model) when you finish editing the template.</p>   <h2 id="generatingtestmodel">Generating Test Model</h2>   <p id="1c9b5917">Let's return to the 'test1' model in the 'test_models' solution. The solution contains several XML Documents and we have just defined the semantics for XML nodes in demoLang1. Unfortunately, MPS cannot combine these two pieces without us telling it first.&nbsp;MPS doesn't understand that model 'test1' is now written in two languages - sampleXML and demoLang1, because we're not using demoLang1 explicitly anywhere in 'test1'.</p>   <p id="cec0e7b5">Since demoLang1 doesn't define any concepts of its own and so we cannot really use demoLang1 model 'test1', therefore we will explicitly tell MPS to include the demoLang1 generator in the generation process for model 'test1'.</p>   <aside class="tip sideblock" data-title="" rel="cec0e7b5" id="53845dd1">      <p id="a5ee777e">This is an extra step that is typically not needed with MPS. Pure virtual languages like demoLang1 are not very common in language development. Normally, language defines their own set of concepts as well as semantic for those concepts. If these concepts (their instances) are used in the solution model then MPS engage the language's generator automatically. We will see an example of this in Demo 6.</p>   </aside>   <ul class="list _ul"><li class="list__item" id="68386012"><p>open properties of model 'test1'</p></li><li class="list__item" id="e6ddb210"><p>add language 'generator_demo.L1' to the <b id="40020120">Languages Engaged On Generation</b> section</p></li></ul>   <p id="5f412a21">      <figure><img alt="gda14" title="gda14" src="/help/img/idea/2019.1/gda14.png" id="0159d545" width="674" height="507"></figure>      <br> Run the&nbsp;<i id="f073559e">Preview Generated Files</i>&nbsp;command in the 'test1' model's popup menu. MPS will generate two java files and show them in the editor:</p>   <div class="code-block" data-lang="none">$PROJECT_HOME\MPS_generator_demo\solutions\test_models\source_gen\generator_demo\test1\Button.java
$PROJECT_HOME\MPS_generator_demo\solutions\test_models\source_gen\generator_demo\test1\Label.java
</div>   <p id="bebf5239">MPS can also compile your generated Java sources into Java byte code as part of&nbsp;<i id="eee023ec">make</i>&nbsp;or <i id="8138a180">rebuild</i>&nbsp;of the 'test1' model. To enable Java compilation of generated sources you need to add a dependency on <b id="72736fb6">JDK</b>&nbsp;to the 'test_models' solution:</p>         <figure><img alt="gda15" title="gda15" src="/help/img/idea/2019.1/gda15.png" id="07e25391" width="635" height="461"></figure>   <div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-demos.html">Generator Demos</a><a class="navigation-links__next" href="generator-user-guide-demo2.html">Generator User Guide Demo2</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>