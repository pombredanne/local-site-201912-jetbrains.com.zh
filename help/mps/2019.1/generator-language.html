<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Generator Language - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Generator+Language.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Generator+Language.html" id="generator-language.xml">Generator Language</h1>   <h2 id="generatorlanguagereference">Generator Language Reference</h2>         <ul data-skip-index="skip"><li class="list__item"><a href="#generatorlanguagereference">Generator Language Reference</a></li><li class="list__item"><a href="#mappingconfiguration">Mapping Configuration</a></li><li class="list__item"><a href="#generatorrule">Generator Rule</a></li><li class="list__item"><a href="#roottemplate">Root Template</a></li><li class="list__item"><a href="#externaltemplate">External Template</a></li><li class="list__item"><a href="#mappinglabel">Mapping Label</a></li><li class="list__item"><a href="#macro">Macro</a></li><li class="list__item"><a href="#templateswitch">Template Switch</a></li><li class="list__item"><a href="#generationcontext(operations)">Generation Context (operations)</a></li><li class="list__item"><a href="#findingoutputnode">Finding Output Node</a></li><li class="list__item"><a href="#generatinguniquename">Generating Unique Name</a></li><li class="list__item"><a href="#templateparameters">Template Parameters</a></li><li class="list__item"><a href="#gettingcontextualinfo">Getting Contextual Info</a></li><li class="list__item"><a href="#transferringuserdata">Transferring User Data</a></li><li class="list__item"><a href="#logging">Logging</a></li><li class="list__item"><a href="#utilities(re-usablecode)">Utilities (Re-usable Code)</a></li><li class="list__item"><a href="#mappingscript">Mapping Script</a></li></ul>      <h3 id="mappingconfiguration">Mapping Configuration</h3>   <p id="61cc4572">Mapping Configuration is a container for generator rules, mapping label declarations and references to pre- and post-processing scripts. A generator model can contain any number of mapping configurations - all of them will be involved in the generation process, if the owning generator module is involved. Mapping configuration also serves as a minimal generator unit that can be referenced in the mapping priority rules.</p>   <h3 id="generatorrule">Generator Rule</h3>   <p id="81833e62">Generator Rule specifies a transformation of an input node to an output node (except for the <i id="06fb8e17">conditional root rule</i> which doesn't have an input node and simply creates a new node in the output model). All rules consist of two parts - a premise and a consequence (except for the <i id="0c966fb2">abandon root rule</i>, which doesn't have a consequence and simply ignores the input node). Any generator rule can be tagged by a mapping label.</p>   <p id="54c1860b">All generator rules' functions have the following parameters:</p>   <ul class="list _ul"><li class="list__item" id="facb27bc"><p>         <b id="72dd5b0b">node</b> - the current input node (all except the condition-function in <i id="6c6f6ede">conditional root rule</i>)</p></li><li class="list__item" id="53796911"><p>         <b id="6a5abe64">genContext</b> - generation context - allows searching for output nodes, generating of unique names and others</p></li></ul>   <p id="b9f1f9f9">Generator Rules:</p>   <div class="table-wrapper"><table class=" wide                 " width="100%" id="d69aa189"><thead><tr id="ff6b6a0f" class="ijRowHead"><th id="4c9321e2">            <p id="302472cc">Rule</p>         </th><th id="1f34b152">            <p id="c0fbde87">Description</p>         </th><th id="82f47acf">            <p id="5a8babb2">Premise</p>         </th><th id="5ff95dab">            <p id="1de8c320">Consequence</p>         </th></tr></thead><tbody><tr id="93a5be3c" class="ijRowOdd"><td id="cd60dc87">            <p id="77252bb3">conditional&nbsp;root&nbsp;rule</p>         </td><td id="ba09f543">            <p id="466261c8">Generates a root node in the output model. Applied only one time (max) during a single generation step.</p>         </td><td id="8782d8c2">            <p id="47945073">               <b id="6965341a">condition</b> function (optional), missing condition function is equivalent to a function always returning <i id="7d793c03">true</i>.</p>         </td><td id="7db10e6a">            <p id="f555f352">root template (ref)</p>         </td></tr><tr id="f8395b00" class="ijRowEven"><td id="df0feb8a">            <p id="abd9e10d">root&nbsp;mapping&nbsp;rule</p>         </td><td id="71f7022e">            <p id="d95c7ffc">Generates a root node in the output model.</p>         </td><td id="e97fc698">            <p id="074acddb">               <b id="16490fad">concept</b> - applicable concept (concept of the input node) <br>               <b id="84947a57">inheritors</b> - if <i id="b48ea3d0">true</i> then the rule is applicable to the specified concept and all its sub-concepts. If <i id="2ac67712">false</i> (default) then the sub-concepts are not applicable. <br>               <b id="c78210ab">condition</b> function (optional) - see <i id="e15b89fd">conditional root rule</i> above. <br>               <b id="99d43161">keep input root</b> - if <i id="2893ed8f">false</i> then the input root node (if it's a root node) will be dropped. If <i id="5f196be2">true</i> then input root will be copied to the output model.</p>         </td><td id="582948fc">            <p id="cbd98d92">root template (ref)</p>         </td></tr><tr id="59af4a2f" class="ijRowOdd"><td id="c6f62fd8">            <p id="48246595">weaving rule</p>         </td><td id="57d6e08e">            <p id="eb4966bd">Allows to insert additional child nodes into the output model. Weaving rules are processed at the end of a generation micro-step just before map_src and reference resolving. The rule is applied on each input node of the specified concept. The parent node for insertion should be provided by the <b id="e443b155">context</b> function. <br></p>         </td><td id="bf5dd8ca">            <p id="ada7a053">               <b id="c9406d88">concept</b> - same as above <br>               <b id="3b3e9db4">inheritors</b> - same as above <br>               <b id="934e5a49">condition</b> function (optional) - same as above</p>         </td><td id="44f57242">            <ul class="list _ul"><li class="list__item" id="9582c962"><p>external template (ref)</p></li><li class="list__item" id="1619efb4"><p>weave-each&nbsp;</p></li><li class="list__item" id="4b1150c5"><p>context - function that computes the (parent) output node into which the output node(s) generated by this rule will be inserted.</p></li><li class="list__item" id="b6a59ec7"><p>anchor (available in <b id="301e7241">Inspector</b>) - specifies a node within the <b id="99dd9e78">context</b> collection, in front of which the nodes should be inserted, <b id="8be5a901">null</b> means insert at the end of the collection</p></li></ul>         </td></tr><tr id="a2b84052" class="ijRowEven"><td id="ef6082c9">            <p id="fe4bcc58">reduction rule</p>         </td><td id="649d232b">            <p id="7a4b18ee">Transforms the input node while this node is being copied to the output model.</p>         </td><td id="5fd9e5db">            <p id="67bba69e">               <b id="7443057c">concept</b> - same as above <br>               <b id="3152c9ab">inheritors</b> - same as above <br>               <b id="14e987b1">condition</b> function (optional) - same as above</p>         </td><td id="3e35323d">            <ul class="list _ul"><li class="list__item" id="d08ab78f"><p>external template (ref)</p></li><li class="list__item" id="c4f9c54c"><p>in-line template</p></li><li class="list__item" id="4ab987da"><p>in-line switch</p></li><li class="list__item" id="3184dceb"><p>dismiss top rule</p></li><li class="list__item" id="94bcb629"><p>abandon input</p></li></ul>         </td></tr><tr id="2f550da8" class="ijRowOdd"><td id="32e5f425">            <p id="a7402a92">pattern rule</p>         </td><td id="b77153c5">            <p id="40a19be6">Transforms the input node, which matches the pattern.</p>         </td><td id="7ee52df8">            <p id="d227ffaa">               <b id="aa2723a9">pattern</b> - <a href="pattern.html">pattern expression</a>                <br>               <b id="1802a427">condition</b> function (optional) - same as above</p>         </td><td id="2f3e0044">            <ul class="list _ul"><li class="list__item" id="8d72233f"><p>external template (ref)</p></li><li class="list__item" id="d8906d57"><p>in-line template</p></li><li class="list__item" id="52381f15"><p>dismiss top rule</p></li><li class="list__item" id="3cf4cdcd"><p>abandon input</p></li></ul>         </td></tr><tr id="18ce996e" class="ijRowEven"><td id="35124f3a">            <p id="c26b925b">abandon root rule</p>         </td><td id="417ced1b">            <p id="d3f3c7c6">Allows to drop an input root node which otherwise would be copied into the output model.</p>         </td><td id="dd8a9263">            <p id="99611316">               <b id="4afe4375">applicable concept</b> ( including all its sub-concepts) <br>               <b id="c37ac1ca">condition</b> function (optional) - same as above</p>         </td><td id="835d9b0b">            <p id="e5edff87">n/a</p>         </td></tr><tr id="1aff43ae" class="ijRowOdd"><td id="08ac9265"><p>drop attribute rule</p></td><td id="1a869b90"><p>For a transformed node, controls which attributes get copied from the input node</p></td><td id="d03688ee"><p>            <b id="463d88e7">concept</b> - concept of the attribute node (subconcept of <code class="code">jetbrains.mps.lang.core.structure.Attribute</code>)<br>            <b id="55d3ef01">inheritors</b> - if <i id="8d91954c">true</i> then the rule is applicable to the specified concept and all its sub-concepts. If <i id="77122111">false</i> (default) then the sub-concepts are not applicable. <br>            <b id="84e9a3fc">condition</b> function (optional) - further restrictions to trigger the rule </p></td><td id="e796ff97">            <p id="0d8bf546">n/a</p>            <p id="1844e60f">Attribute is not copied when the rule matches</p>         </td></tr></tbody></table></div>   <p id="a3c16dea">Rule Consequences:</p>   <div class="table-wrapper"><table class=" wide                 " width="100%" id="84a4c619"><thead><tr id="014294cd" class="ijRowHead"><th id="a5d1bbb6">            <p id="93725b64">Consequence</p>         </th><th id="a1e8f697">            <p id="ce73c509">Usage</p>         </th><th id="af90a4ac">            <p id="f63153aa">Description</p>         </th></tr></thead><tbody><tr id="5ad96f7f" class="ijRowOdd"><td id="a8b2ba4a">            <p id="91b0c951">root template (ref)</p>         </td><td id="500d13da">            <ul class="list _ul"><li class="list__item" id="bbfcf1dd"><p>conditional&nbsp;root&nbsp;rule</p></li><li class="list__item" id="dd9e0822"><p>(root) mapping rule</p></li></ul>         </td><td id="5d5d0214">            <p id="974abf8c">Applies the root template</p>         </td></tr><tr id="a8f1af92" class="ijRowEven"><td id="fd19bd03">            <p id="f2e6608c">external&nbsp;template&nbsp;(ref)</p>         </td><td id="5967357c">            <ul class="list _ul"><li class="list__item" id="056067e4"><p>weaving rule</p></li><li class="list__item" id="d5c559c9"><p>reduction rule</p></li><li class="list__item" id="a85852dd"><p>pattern rule</p></li></ul>         </td><td id="3edffd11">            <p id="ff8336c8">Applies an external template. Parameters should be passed if required, they can be one of:</p>            <ul class="list _ul"><li class="list__item" id="334fb7b4"><p>pattern captured variable (starting with # sign)</p></li><li class="list__item" id="3f15b01c"><p>integer or string literal</p></li><li class="list__item" id="696b0f38"><p>                  <i id="2252ea71">null</i>, <i id="d3ac4bf0">true</i>, <i id="bd7f2558">false</i>               </p></li><li class="list__item" id="9650e50c"><p>query function</p></li></ul>         </td></tr><tr id="bab0ab82" class="ijRowOdd"><td id="5b0e5aa4">            <p id="98026068">weave-each</p>         </td><td id="74a48ad4">            <p id="3283f97b">weaving rule</p>         </td><td id="c37f0d55">            <p id="f98d8670">Applies an external template to a set of input nodes. <br>Weave-each consequence consists of:</p>            <ul class="list _ul"><li class="list__item" id="bbc8bd30"><p>                  <b id="1134afcc">foreach</b> function - returns a sequence of input nodes</p></li><li class="list__item" id="ce1e5a83"><p>reference on an external template</p></li></ul>         </td></tr><tr id="89d1d2f7" class="ijRowEven"><td id="c46bac86">            <p id="eb421369">in-line template</p>         </td><td id="663fe289">            <ul class="list _ul"><li class="list__item" id="3fa9bbfa"><p>reduction rule</p></li><li class="list__item" id="6c987186"><p>pattern rule</p></li></ul>         </td><td id="6205ca0d">            <p id="5acc0b82">Applies the template code which is written right here.</p>         </td></tr><tr id="82dc6968" class="ijRowOdd"><td id="a41d3a22">            <p id="7287eb6a">in-line switch</p>         </td><td id="ceac203a">            <p id="3d40cf9c">reduction rule</p>         </td><td id="9828ee27">            <p id="3ae57183">Consists of set of <b id="a817cdd6">conditional cases</b> and a <b id="12dbd8c5">default case</b>. <br>Each case specify a consequence, which can be one of:</p>            <ul class="list _ul"><li class="list__item" id="6176dad4"><p>external template (ref)</p></li><li class="list__item" id="bbbbb344"><p>in-line template</p></li><li class="list__item" id="7015498e"><p>dismiss top rule</p></li><li class="list__item" id="1e8e3aff"><p>abandon input</p></li></ul>         </td></tr><tr id="79fb6e44" class="ijRowEven"><td id="bf48a10a">            <p id="9fb5cf36">dismiss top rule</p>         </td><td id="f3e699aa">            <ul class="list _ul"><li class="list__item" id="db686163"><p>reduction rule</p></li><li class="list__item" id="9256400b"><p>pattern rule</p></li></ul>         </td><td id="720e1730">            <p id="ee2245d2">Drops all reduction-transformations up to the point where this sequence of transformations has been initiated by an attempt to copy the input node to the output model. The input node will be copied 'as is' (unless some other reduction rules are applicable). The user can also specify an error, warning or an information message.</p>         </td></tr><tr id="64139485" class="ijRowOdd"><td id="01812ca3">            <p id="3123dee6">abandon input</p>         </td><td id="84059833">            <ul class="list _ul"><li class="list__item" id="3470c948"><p>reduction rule</p></li><li class="list__item" id="5ebd80e9"><p>pattern rule</p></li></ul>         </td><td id="761506b9">            <p id="afd4310a">Prevents the input node from being copied into the output model.</p>         </td></tr></tbody></table></div>   <h3 id="roottemplate">Root Template</h3>   <p id="47e05232">Root Template is used in conditional root rules and (root) mapping rules. The Generator language doesn't define specific concept for root template. The generator language defines a special kind of annotation - <i id="780819dd">root template header</i>, which is automatically added to each new root template. The root template header is used for specifying an expected <b id="e56173d4">input</b> concept (i.e. concept of input node). MPS uses this setting to perform a static type checking of code in various macro-functions, which are used in the root template.</p>   <aside class="warning " data-title="" rel="47e05232" id="12db3776">      <p id="b2573ac7">Technically, any root node in the output language can be considered to be a Root Template, when created in the generator model. However, root nodes without annotations are treated by the generator as auxiliary, utility nodes e.g. to specify reference targets and thus are not considered for target language evaluation.&nbsp;A warning is displayed and a quick fix is offered to add the <i id="e80aafde">root template header</i> annotation to the root template that miss one. We highly recommend language designers to fix their templates and to always create new root templates with the annotation included.</p>               <br>         </aside>   <p id="b32fd44a">&nbsp;</p>   <h3 id="externaltemplate">External Template</h3>   <p id="c6f7fc54">External Template is a concept defined in the generator language. It is used in weaving rules and reduction rules.</p>   <p id="6f87e341">In external templates the user specifies the template <b id="296e7009">name</b>, <b id="a35b64d1">input</b> concept, <b id="8a015163">parameters</b> and a <b id="5a2debe9">content node</b>.</p>   <p id="2dfde204">The content node can be any node in the output language. The actual template code in external templates is surrounded by <b id="4cb82304">template fragment</b> 'tags' (the template fragment is also a special kind of annotation concept). The code outside template fragment serves as a framework (or context) for the real template code (template fragment) and is ignored by the generator. In external template for weaving rule, the template's context node is required (it is a design-time representation of the rule's <i id="d5757a90">context node</i>), while the template for reduction rule can be just one context-free template fragment. An external template for a reduction rule must contain exactly one template fragment, while a weaving rule's template can contain more than one template fragments.</p>   <p id="c2d684dd">Template fragment has a&nbsp;<b id="8155e1c1">mapping label</b>&nbsp;property, which is edited in <b id="f577fcea">Inspector view</b>.</p>   <h3 id="mappinglabel">Mapping Label</h3>   <p id="71ba59c6">Mapping Labels are declared in a mapping configuration and references stored to this declaration are used to label generator rules, macros and template fragments. Such marks allow finding of an output node by a known input node.</p>   <p id="fe22d54d">Properties:</p>   <ul class="list _ul"><li class="list__item" id="33f3b251">         <b id="5b61702a">name</b>      </li><li class="list__item" id="fddae893"><p>         <b id="c16a4fb4">input concept</b> (optional) - expected concept of the input node of the transformation performed by the tagged rule, macro or template fragment</p></li><li class="list__item" id="22866942"><p>         <b id="d0632b6a">output concept</b> (optional) - expected concept of the output node of the transformation performed by the tagged rule, macro or template fragment</p></li></ul>   <p id="8371c581">MPS makes use of the input/output concept settings to perform static type checking in <i id="6b37c628">get output ...</i> operations.</p>   <h3 id="macro">Macro</h3>   <p id="d9573fb2">Macro is a special kind of an annotation concept which can be attached to any node in template code. Macro brings dynamic aspect into otherwise static template-based model transformation.</p>   <p id="fa8067dd">Property- and reference-macros are attached to property- and reference-cells respectively, while node-macros (which come in many variations - LOOP, IF etc.) are attached to cells representing the whole node in the cell-editor. All properties of a macro are edited using the inspector view.</p>   <p id="5d27f090">All macros have the <b id="bffb74a9">mapping label</b> property - reference to a mapping label declaration. Additionally, all macros can be parameterized by various macro-functions - depending on the type of the macro. Any macro-function has at least the three following parameters:</p>   <ul class="list _ul"><li class="list__item" id="0b241a07"><p>         <b id="9f54fc14">node</b> - the current input node;</p></li><li class="list__item" id="5e3bb84b"><p>         <b id="8fd50aa1">genContext</b> - generation context - allows searching for output nodes, generating of unique names and others;</p></li><li class="list__item" id="d0a942e3"><p>         <b id="51c155bf">operationContext</b> - instance of <i id="412e2558">jetbrains.mps.smodel.IOperationContext</i> interface (used rarely).</p></li></ul>   <p id="355a765a">Many types of macros have the&nbsp;<b id="da475878">mapped node</b>&nbsp;(or <b id="72c6498a">mapped nodes</b>) function. This function computes the new input node - a substitution for the current input node. If the&nbsp;<b id="33cdc7dd">mapped node</b> function returns null or the&nbsp;<b id="470a4fed">mapped nodes</b> function returns an empty <i id="c1acd0a4">sequence</i>, then the generator will skip this macro altogether. I.e. no output will be generated in this place.</p>   <div class="table-wrapper"><table class=" wide                 " width="100%" id="2488ef67"><thead><tr id="85a52578" class="ijRowHead"><th id="c03e8fc3">            <p id="53010e9c">Macro</p>         </th><th id="e88aa1ec">            <p id="0cdd74f0">Description</p>         </th><th id="20c2ef76">            <p id="f6f3d82a">Properties (if not mentioned above)</p>         </th></tr></thead><tbody><tr id="ec7d6fcd" class="ijRowOdd"><td id="86a3522d">            <p id="6c3e3df8">Property&nbsp;macro</p>         </td><td id="0ff5fd10">            <p id="82d5aee1">Computes the value of a property.</p>         </td><td id="71d9a13e">            <p id="7ee14730">               <b id="69bd2585">value</b> function:</p>            <ul class="list _ul"><li class="list__item" id="dda29609"><p>return type - string, boolean or int - depending on the property type.</p></li><li class="list__item" id="53fef579"><p>parameters - standard + <b id="2ffc801b">templateValue</b> - value in the template code wrapped by the macro.</p></li></ul>         </td></tr><tr id="cded9c7e" class="ijRowEven"><td id="301944fd">            <p id="51b6c80d">Reference&nbsp;macro</p>         </td><td id="66085b34">            <p id="9903a5a0">Computes the referent node in the output model. <br>Normally executed at the end of a generation micro-step, when the output model (tree) is already constructed. <br>Can also be executed earlier, if the user code is trying to obtain the target of the reference.</p>            <p id="a549cc1d">Reference macro supports&nbsp;<code class="code">SNodeReference</code>&nbsp;as specification of a new target. With that, templates don't need access to a target's node model the moment they are applied.&nbsp;</p>         </td><td id="f007bc25">            <p id="3767508e">               <b id="c5e611e0">referent</b> function:</p>            <ul class="list _ul"><li class="list__item" id="edf259c6">return type<ul class="list _ul"><li class="list__item" id="54b3210e"><p>node (type depends on the reference link declaration)</p></li><li class="list__item" id="2d328a92">                        <code class="code">SNodeReference</code>                     </li><li class="list__item" id="8a2c0dcf"><p>string identifying the target node.</p></li></ul>               </li><li class="list__item" id="24d97a1a"><p>parameters - standard + <b id="e1653d09">outputNode</b> - source of the reference link (in the output model).</p></li></ul>         </td></tr><tr id="7dc8d99c" class="ijRowOdd"><td id="4abd06d8">            <p id="0d5e8778">IF</p>         </td><td id="95294ba3">            <p id="54790bb7">The wrapped template code is applied only if the condition is true. Otherwise the template code is ignored and an 'alternative consequence' (if any) is applied.</p>         </td><td id="967a96b6">            <p id="58ad90c2">               <b id="b6f0e36f">condition</b> function <br>                <b id="7d7de04b">alternative</b> consequence (optional) - any of:</p>            <ul class="list _ul"><li class="list__item" id="351b13c7"><p>external template (ref)</p></li><li class="list__item" id="d97ee2fd"><p>in-line template</p></li><li class="list__item" id="d7962883"><p>abandon input</p></li><li class="list__item" id="14521882"><p>dismiss top rule</p></li></ul>         </td></tr><tr id="0fbc3a86" class="ijRowEven"><td id="731d138e">            <p id="38fb7c0b">LOOP</p>         </td><td id="244d2853">            <p id="690152f9">Computes new input nodes and applies the wrapped template to each of them.</p>         </td><td id="0f404b4b">            <p id="a4eee55b">               <b id="5178d817">mapped nodes</b> function</p>         </td></tr><tr id="92195ff6" class="ijRowOdd"><td id="e832756c">            <p id="0d689768">INCLUDE</p>         </td><td id="a2902fd8">            <p id="8602519c">The wrapped template code is ignored (it only serves as an anchor for the INCLUDE-macro), a reusable external template will be used instead.</p>            <p id="3d72d07e">Null input makes INCLUDE effectively a no-op.</p>         </td><td id="14a424e7">            <p id="68a38992">               <b id="4590bca6">mapped node</b> function (optional) <br>                <b id="c1835f5b">include template</b> - reference to a reusable external template</p>         </td></tr><tr id="462873a0" class="ijRowEven"><td id="a8a149fd">            <p id="4db9ee3a">CALL</p>         </td><td id="adddcd95">            <p id="62acbee4">Invokes template and replaces wrapped template code with the result of template invocation. Supports templates with parameters.</p>            <p id="d17b28ae">Null input node is tolerated, and the template is ignored altogether in this case, i.e. CALL yields empty collection of nodes as a result when input/mapped node is null.</p>         </td><td id="78df815b">            <p id="e2911df7">               <b id="60e09f2c">mapped node</b> function (optional) <br>                <b id="f8c4bc67">call template</b> - reference to a reusable external template <br>                <br>                <i id="ecbf2ac2">argument</i> - one of</p>            <ul class="list _ul"><li class="list__item" id="0783786b"><p>pattern captured variable</p></li><li class="list__item" id="dad6ad9c"><p>integer or string literal</p></li><li class="list__item" id="71571cde"><p>                  <i id="803192ad">null</i>, <i id="d052dfdd">true</i>, <i id="0d20018c">false</i>               </p></li><li class="list__item" id="230ff417"><p>query function</p></li></ul>         </td></tr><tr id="c649a1b0" class="ijRowOdd"><td id="b87ba97e">            <p id="d2f5b00b">SWITCH</p>         </td><td id="c2f0b607">            <p id="81ac7df6">Provides a way to many alternative transformations in the given place in the template code. <br>The wrapped template code is applied, if none of switch cases is applicable and no default consequence is specified in <a href="#templateswitch">#template switch</a>.</p>            <p id="7a89c1b8">For null input node, SWITCH may react with a message (specified along with its rules), anchor template node is ignored, and SWITCH macro yields no results.</p>         </td><td id="0342d885">            <p id="5ea64b5f">               <b id="92c21577">mapped node</b> function (optional) <br>               <b id="e5bcc86b">template switch</b> - reference to a template switch</p>         </td></tr><tr id="9df5bcb1" class="ijRowEven"><td id="3adcbed4">            <p id="69f96fd0">COPY-SRC</p>         </td><td id="323c55eb">            <p id="f561cf20">Copies an input node to the output model. The wrapped template code is ignored.</p>         </td><td id="dd5f2a86">            <p id="d1e99d01">               <b id="954c91a6">mapped node</b> function - computes the input node to be copied.</p>         </td></tr><tr id="55ad8941" class="ijRowOdd"><td id="091864c4">            <p id="149bc8fa">COPY-SRCL</p>         </td><td id="9620d60e">            <p id="f7c025ab">Copies input nodes to the output model. The wrapped template code is ignored. <br>Can be used only for children with multiple aggregation cardinality.</p>         </td><td id="7a35b97f">            <p id="dbe3bd1e">               <b id="c3316787">mapped nodes</b> function - computes the input nodes to be copied.</p>         </td></tr><tr id="1a81f6b9" class="ijRowEven"><td id="22115030">            <p id="e412e5d6">MAP-SRC</p>         </td><td id="4a322026">            <p id="142b3856">Multifunctional macro, can be used for:</p>            <ul class="list _ul"><li class="list__item" id="82e82aa8"><p>marking a template code with a mapping label;</p></li><li class="list__item" id="0fd5b81a"><p>replacing the current input node with a new one;</p></li><li class="list__item" id="ddefac13"><p>perform a non-template based transformation;</p></li><li class="list__item" id="8a7283a4"><p>accessing the output node for some reason. <br>The MAP-SRC macro is executed at the end of a generator micro-step - after all node- and property-macros, but before any reference-macro is run.</p></li></ul>         </td><td id="9cf64ea8">            <p id="134e7958">               <b id="ddde8479">mapped node</b> function (optional) <br>               <b id="b7b60238">mapping func</b> function (optional) - performs non-template based transformation. <br>If defined then the wrapped template code will be ignored. <br>Parameters: standard + <b id="8ad1a610">parentOutputNode</b> - parent node in the output model. <br>               <b id="bd42e797">post-processing</b> function (optional) - give access to the output node. <br>Parameters: standard + <b id="c8ea0ceb">outputNode</b>            </p>         </td></tr><tr id="c2f0b3b0" class="ijRowOdd"><td id="818e180a">            <p id="50d593ed">MAP-SRCL</p>         </td><td id="9e3dcd62">            <p id="6a5cd954">Same as MAP-SRC but can handle many new input nodes (similar to the LOOP-macro)</p>         </td><td id="c3b85b11">            <p id="bbeac32b">               <b id="b381281f">mapped nodes</b> function <br>               <b id="bde587a1">mapping func</b> function (optional) <br>               <b id="bc5d661d">post-processing</b> function (optional)</p>         </td></tr><tr id="37bf3cfa" class="ijRowEven"><td id="e9401d01">            <p id="e1234db3">WEAVE</p>         </td><td id="aa8afe95">            <p id="2736207c">Allows to insert additional child nodes into the output model in a similar way <b id="1ff45f4a">Weaving rules</b> are used. The node wrapped in the <b id="eea4882e">WEAVE macro</b>&nbsp;(or provided by the <b id="459a9cf6">use input</b>&nbsp;function) will have the supplied template applied to it and the generated nodes will be inserted.</p>         </td><td id="4bc9546e">            <p id="a36c9ff4">               <b id="94358f57">use input</b>&nbsp;a function returning a collection of nodes to apply the macro to <br>               <b id="ce317f52">weave</b>&nbsp;reference to a template to weave into the nodes supplied as the input</p>         </td></tr><tr id="5fda7203" class="ijRowOdd"><td id="6b561398">            <p id="96972dd1">VAR</p>         </td><td id="b8e44e29">            <p id="055abf58">Introduces one or more named values into the generator context, which can then be obtained from the <i id="fb01b946">genContext</i> object. The stored variables are read-only and live in the generator context within the scope of the VAR macro.</p>         </td><td id="4485a035">            <p id="ad029bfe">               Each variable has the following parameters:<br>                <b id="34d686b6">type</b> the optional <i id="1e67efa6">BaseLanguage</i> type of the stored value, defaults to the type inferred from the <i id="cb1107c9">value</i> function.<br>                <b id="a5eec3d2">value</b> function - returns the value to store in the variable.<br>            </p>         </td></tr></tbody></table></div>      <aside class="tip sideblock" data-title="" rel="f7f9c09a" id="d421c23b">      <p id="5dadbcce">Reference resolving by identifier is only supported in BaseLanguage.<br>The identifier string for classes and class constructors may require (if class is not in the same output model) package name in square brackets preceding the class name:<br>         <i id="ea284c88">[package.name]ClassName</i>      </p>   </aside>      <h3 id="templateswitch">Template Switch</h3>   <p id="8c5651db">A template switch is used in pair with the SWITCH-macro (the <i id="c0fc3dfb">TemplateSwitchMacro</i>&nbsp;concept). A single template switch can be re-used in many different SWITCH-macros. A template switch consists of set of cases and one default case. Each switch case is a reduction rule, i.e. a template switch contains a list of reduction rules.</p>   <p id="6f071e58">The <b id="113d4e21">default case</b> consequence can be one of:</p>   <ul class="list _ul"><li class="list__item" id="a3571b16"><p>external template (ref)</p></li><li class="list__item" id="b6df77ca"><p>in-line template</p></li><li class="list__item" id="438bb774"><p>abandon input</p></li><li class="list__item" id="0e5d2b0f"><p>dismiss top rule<br> .. or can be omitted. In this case the template code surrounded by corresponding SWITCH-macro will be applied.</p></li></ul>   <p id="0e999d9c">A template switch can inherit reduction rules from other switches via the <b id="b035491a">extends</b> property. When the generator is executing a SWITCH-macro it tries to find most specific template switch (available in scope). Therefore the actually executed template switch is not necessarily the one that is defined in the&nbsp;<b id="d16be0fa">template switch</b> property of the SWITCH-macro.</p>   <p id="4f0a51f5">Through the <b id="55775571">null-input message</b> property the user can specify an <b id="125a8e0e">error, warning</b> or <b id="39c5ce48">info</b> message, which will be shown in the MPS messages view in case when the <b id="a124dae9">mapped node</b> function in SWITCH-macro returns null (by default no messages are shown and the macro is skipped altogether).</p>   <p id="a742190e">A template switch can accept parameters, the same way as template declarations. A use of parametrized switch mandates arguments to be supplied in the&nbsp;<b id="05c8bf8d">         <i id="9a8185bd">SWITCH</i>      </b>&nbsp;macro. The <code class="code">TemplateSwitchMacro</code>&nbsp;concept supports switches both with and without arguments.</p>      <h3 id="generationcontext(operations)">Generation Context (operations)</h3>   <p id="aa4554ba">Generation context (the&nbsp;<i id="349e3de7">genContext</i> parameter in macro- and rule-functions) allows finding of nodes in the output model, generating unique names and provides other useful functionality.</p>   <p id="a90a3cf6">Generation context can be used not only in the generator models, but also in utility models - as a variable of type <b id="391c7f0c">gencontext</b>.</p>   <p id="883d1487">Operations of genContext are invoked using the familiar dot-notation: <i id="f8512de0">genContext.operation</i>   </p>   <h4 id="findingoutputnode">Finding Output Node</h4>   <div class="table-wrapper"><table class="                 " width="100%" id="e17cace6"><thead><tr id="7430a03d" class="ijRowHead"><th id="74db0ccc">                           <i id="ad668985">get&nbsp;output&nbsp;&lt;mapping&nbsp;label&gt; for model ( &lt;model&gt; )</i>                     </th><th id="6ec36c75">            <p id="e7ae37cd">Returns the output node generated by a labeled <i id="85861301">conditional root rule</i> in a specified model. <br>Issues an error, if there is more than one matching output node.</p>         </th></tr></thead><tbody><tr id="a60922e5" class="ijRowOdd"><td id="fd0274e2">                           <i id="3473567d">get&nbsp;output&nbsp;&lt;mapping&nbsp;label&gt;&nbsp;for&nbsp;(&nbsp;&lt;input&nbsp;node&gt;&nbsp;)</i>                     </td><td id="5ae0eb3b">            <p id="73c56a04">Returns the output node generated from the <i id="eb544ecf">input node</i> by a labeled generator rule, a macro or a template fragment. <br>Issues an error if there is more than one matching output node.</p>         </td></tr><tr id="b693304a" class="ijRowEven"><td id="3c23f5d3">                           <i id="279f5c0d">pick&nbsp;output&nbsp;&lt;mapping label&gt;&nbsp;for&nbsp;(&nbsp;&lt;input&nbsp;node&gt;&nbsp;)</i>                     </td><td id="7edf6585">            <p id="07dfb653"> only used in the context of the <b id="1e1c4569">referent</b> function in a reference-macro and only if the required output node is a target of the reference, which is being resolved by that reference-macro. <br>Returns the output node generated from the <i id="54050476">input node</i> by a labeled generator rule, a macro or a template fragment. The difference between this and the previous operation is that this operation can automatically resolve the <i id="11c38db4">many-output-nodes</i> conflict - it picks the output node, which is visible in the given context.</p>         </td></tr><tr id="ef4acd6f" class="ijRowOdd"><td id="4a2a3aff">                           <i id="45339a24">get&nbsp;output&nbsp;list&nbsp;&lt;mapping&nbsp;label&gt;&nbsp;for&nbsp;(&nbsp;&lt;input&nbsp;node&gt;&nbsp;)</i>                     </td><td id="6a397112">            <p id="fed38c60">Returns a list of output nodes generated from the <i id="33ca2ee3">input node</i> by a labeled generator rule, a macro or a template fragment.</p>         </td></tr><tr id="5fd3d963" class="ijRowEven"><td id="e365b427">                           <i id="86adf940">get copied output for ( &lt;input node&gt; )</i>                     </td><td id="ea1433bf">            <p id="6c1e1ff0">Returns the output node, which has been created by copying of an input node. If during the copying, the input node has been reduced, but the concept of the <i id="6b4e5787">output node</i> is the same (i.e. it wasn't reduced into something totally different), then this is still considered 'copying'. <br>Issues an error if there is more than one matching output node.</p>         </td></tr></tbody></table></div>   <h4 id="generatinguniquename">Generating Unique Name</h4>         <i id="37f2363e">unique name from &lt;base name&gt; in context &lt;node&gt;</i>      <p id="d0d887c2">The uniqueness is secured throughout the whole generation session.<br>  Clashing with names that weren't generated using this service is still possible.</p>   <p id="d122e6eb">The <b id="fe0a19b5">context node</b> is optional, though we recommend to specify it to guarantee generation stability. If specified, then MPS tries its best to generated names 'contained' in a scope (usually a root node). Then when names are re-calculated (due to changes in the input model or in the generator model), this won't affect other names outside the scope.</p>   <h4 id="templateparameters">Template Parameters</h4>   <div class="table-wrapper"><table class="                 " width="100%" id="ba90a9b4"><thead><tr id="b5c2bb13" class="ijRowHead"><th id="32c37c9b">                           <i id="a5e9b941">#patternvar</i>                     </th><th id="5cc430c0">            <p id="1eb22f70">Value of the captured pattern variable <br>  available only in rule consequences</p>         </th></tr></thead><tbody><tr id="9429267a" class="ijRowOdd"><td id="9694b3c3">                           <i id="d5af7941">param</i>                     </td><td id="f769d958">            <p id="fe9a5559">Value of the template parameter <br>  available only in external templates</p>         </td></tr></tbody></table></div>   <h4 id="gettingcontextualinfo">Getting Contextual Info</h4>   <div class="table-wrapper"><table class="                 " width="100%" id="b2bb2bbf"><thead><tr id="db9da267" class="ijRowHead"><th id="bd7960f4">                           <i id="fe26a666">inputModel</i>                     </th><th id="7cc7b39b">            <p id="220947ad">The current input model</p>         </th></tr></thead><tbody><tr id="d9310f28" class="ijRowOdd"><td id="db9ab61e">                           <i id="b25dbb8c">originalModel</i>                     </td><td id="c5fea570">            <p id="2d10edc9">The original input model</p>         </td></tr><tr id="8ed410bc" class="ijRowEven"><td id="fa47b30b">                           <i id="f5f1128f">outputModel</i>                     </td><td id="3bf141ba">            <p id="e8472d87">The current output model</p>         </td></tr><tr id="f23a1644" class="ijRowOdd"><td id="343d54fa">                           <span class="text-line-through" id="330222e4">                  <i id="56acb2fb">templateNode</i>               </span>                     </td><td id="3e61066f">            <p id="ee789ee7">The template code surrounded by the macro. <br>It is only used in macro-functions</p>                            <i id="fa614b94"></i>                        <p id="93067727">The primary flaw is that this operation implies interpreted templates. There is no template model when templates are generated.</p>            <p id="ec2fa46f">Besides, contract of the operation is vague (i.e. what does it give in a context of argument query for a template call).</p>         </td></tr><tr id="da18385c" class="ijRowEven"><td id="b7b14baf">                           <i id="e5c24cfb">get prev input &lt;mapping label&gt;</i>                     </td><td id="78079a4a">            <p id="0e9965dc">Returns the input node that has been used for enclosing the template code surrounded by the labeled macro. <br>It is only used in macro-functions.</p>         </td></tr></tbody></table></div>   <h4 id="transferringuserdata">Transferring User Data</h4>   <p id="4ae7342f">During generation MPS maintains three maps of user objects, each of which has different life span:</p>   <ul class="list _ul"><li class="list__item" id="ea02b530"><p>         <b id="f1505465">session object</b> - kept throughout the whole generation session;</p></li><li class="list__item" id="971c2548"><p>         <b id="506d7e3b">step object</b> - kept through a single generation step;</p></li><li class="list__item" id="9e75abcf"><p>         <b id="eb819052">transient object</b> - only alive during a micro step.</p></li></ul>   <p id="ed843f6b">The developer can access the user object maps using the array (square brackets) notation:</p>   <div class="code-block" data-lang="none">session object [ &lt;key&gt; ]
step object [ &lt;key&gt; ]
transient object [ &lt;key&gt; ]
</div>   <p id="b19b7258">The key can be any object (<i id="2ebeff0b">java.lang.Object</i>).</p>   <aside class="tip sideblock" data-title="" rel="b19b7258" id="d3096c2e">      <p id="dc3e7c6f">The session- and step-object cannot be used to pass data associated with a particular input node across steps and micro-steps, because neither an input node nor its id can serve as a key (output nodes always have a different id).<br>To pass such data you should use the <i id="a5f2a8f1">putUserObject</i> and<i id="c5b4e432"> getUserObject</i> methods defined in class <i id="afeb8be8">jetbrains.mps.smodel.SNode</i>.<br>The data will be transferred to all output copies of the input node. The data will be also transferred to the output node, if a slight reduction (i.e. without changing of the node concept) took place while the node was being coppied.</p>   </aside>   <h4 id="logging">Logging</h4>   <div class="code-block" data-lang="none">show info &lt;message text&gt; -&gt; &lt;node&gt;
show error &lt;message text&gt; -&gt; &lt;node&gt;
show warning &lt;message text&gt; -&gt; &lt;node&gt;
</div>   <p id="f71918ad">Creates message in the MPS message view. If the <i id="bcd17edf">node</i> parameter is specified then clicking on the message will navigate to that node. In case of an <b id="4b102e8a">error</b> message, MPS will also output some additional diagnostic info.</p>   <h4 id="utilities(re-usablecode)">Utilities (Re-usable Code)</h4>   <p id="1e32cdc0">If you have duplicated code (in rules, macros, etc.) and want to say, extract it to re-usable static methods, then you must create this class in a separate, non-generator model.</p>   <p id="a11874f0">If you create an utility class in the generator model (i.e. in a model with the 'generator' stereotype), then it will be treated as a root template (unused) and no code will be generated from it.</p>   <h3 id="mappingscript">Mapping Script</h3>   <p id="96282ba7">A Mapping script is user code, which is executed either before a model transformation (pre-processing script) or after it (post-processing script). It should be referenced from <a href="#mappingconfiguration">#Mapping Configuration</a> to be invoked as a part of it's generation step. Mapping scripts provide the ability to perform non-template based model transformations.</p>   <p id="0761acdf">Pre-processing scripts are also commonly used for collecting certain information from input model that can be later used in the course of template-based transformation. The information collected by script is saved as a transient-, step- or session-object.</p>   <p id="7c55abd7">Script sample:</p>   <div class="code-block" data-lang="none">mapping script myPreProcessingScript

script kind : pre-process input model
modifies model : false

(model, genContext, operationContext)-&gt;void {
  for (node&lt;MyConcept&gt; te : model.nodes(MyConcept)) {
    genContext.transient object [ MyConceptUtil.KEY_ID ] = ....;
  }
}
</div>   <p id="568534cc">Properties:</p>   <div class="table-wrapper"><table class="                 " width="100%" id="c4555a75"><thead><tr id="417578e9" class="ijRowHead"><th id="47b1b0b6">                           <i id="c018e29e">script kind</i>                     </th><th id="b4646453">            <ul class="list _ul"><li class="list__item" id="d5dfd6cf"><p>                  <i id="84b325ef">pre-process input model</i> - the script is executed at the beginning of a generation step, before the template-based transformation;</p></li><li class="list__item" id="6f6b77b6"><p>                  <i id="d08961a3">post-process output model</i> - the script is executed at the end of a generation step, after the template-based transformation.</p></li></ul>         </th></tr></thead><tbody><tr id="1034f8a1" class="ijRowOdd"><td id="e2e3013b">                           <i id="d16da059">modifies model</i>                     </td><td id="9b2577f7">            <p id="91bba90d">only available if <i id="9b2ebf9b">script kind = pre-process input model</i>                <br>If set <i id="09611872">true</i> and the input model is the original input model, then MPS will create a transient input model before applying the script. <br>If set <i id="46d25318">false</i> but the script tries to modify the input model, then MPS will issue an error.</p>         </td></tr></tbody></table></div>   <p id="aa72950c">Code context:</p>   <div class="table-wrapper"><table class="                 " width="100%" id="cbe3a029"><thead><tr id="66a20019" class="ijRowHead"><th id="1bc03ffe">                           <i id="884918cc">model</i>                     </th><th id="3c0a8e50">            <p id="b02f9974">The current model</p>         </th></tr></thead><tbody><tr id="13e08c35" class="ijRowOdd"><td id="53b6419b">                           <i id="898216fb">genContext</i>                     </td><td id="e325d8dd">            <p id="de3f7f55">The generation context to give access to transient/session or step objects.</p>         </td></tr><tr id="09bf38e5" class="ijRowEven"><td id="c74b47ff">                           <span class="text-line-through" id="96163b66">                  <i id="8f4a7ef5">invocation context</i>               </span>                     </td><td id="ccd30089">            <p id="3847b02c">Operation context (<i id="4b738085">jetbrains.mps.smodel.IOperationContext</i> java interface) associated with the module - the owner of the original input model</p>                           <i id="79a4033a"></i>                     </td></tr></tbody></table></div><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="mps-generator.html">Generator</a><a class="navigation-links__next" href="the-generator-algorithm.html">The Generator Algorithm</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>