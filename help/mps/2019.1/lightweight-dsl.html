<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><meta charset="UTF-8"><title>Lightweight DSL - Help | MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Lightweight+DSL.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Lightweight+DSL.html" id="lightweight-dsl.xml">Lightweight DSL</h1>   <p id="7f8380a5">Years of evolving the MPS core languages led us to recognizing recurring patterns in our language-descriptive DSLs for IDE integration. Conceptually they looked and behaved like higher-level constructions expressed by plain classes that implement some higher-level interfaces.&nbsp;In the good tradition of language-oriented programming we decided to reflect these patterns in the languages and re-implement them as a thin abstraction on top of plain <i id="74867d79">BaseLanguage</i> classes. The&nbsp;new<b id="5d189392"> Lightweight DSL</b> language has been created to enable such abstractions.</p>   <p id="94e1aeee">The&nbsp;<i id="74337105">jetbrains.mps.baselanguage.lightweightdsl</i>&nbsp;language enables internal DSLs to be embedded inside <i id="c31d73e4">BaseLanguage</i>&nbsp;classes. Internal DSLs in general are easier and faster to develop than full-blown external DSLs, they typically reuse the syntax of the host language and tightly integrate with the surrounding non-DSL code. Similarly, <b id="5137eac4">lightweight DSLs</b>&nbsp;in MPS can be created by defining a single node and then weaving the node into a <i id="9082bbbe">BaseLanguage</i> ClassConcept or its subconcepts.</p>   <p id="9506d931">MPS itself leverages&nbsp;this mechanism in several places:</p>   <ul class="list _ul"><li class="list__item" id="567fb153"><p>         <i id="45b7c690">MigrationScript</i>&nbsp;concept, which is a mere BaseLanguage class, is enhanced by the <i id="dad1c9f0">Migration</i>&nbsp;DSLDescriptor that adds a few extra properties, members and custom members</p></li><li class="list__item" id="49c96015"><p>Find Usages</p></li><li class="list__item" id="424e53fb"><p>Intentions</p></li><li class="list__item" id="cfb78565"><p>Custom language aspects</p></li></ul>   <p id="2f76871f">You can have your lightweight DSL weaved into a plain <i id="6814132d">BaseLanguage</i> class or into your own concept extending <i id="753c2617">ClassConcept</i>.</p>   <h2 id="enhancingplainclasses">Enhancing plain classes</h2>   <p id="1da9cf3c">The core idea behind the Lightweight DSL language is to allow the DSL designer to define <b id="94f5b6ce">interfaces with constraints</b>, such as optional methods and properties, types depending on constraints, optional method parameters, custom class members and others.&nbsp;The&nbsp;<i id="d5d280ec">DSLDescriptor</i> concept represents nodes that codify such constrained interfaces that should be enforced on implementing&nbsp;<i id="405247db">Classes</i>. For example, the following&nbsp;<i id="49941a4e">DSLDescriptor</i> instance will weave a&nbsp;<i id="5eebb205">numberOfFrames</i> property into classes as well as a&nbsp;<i id="5bb96782">calculateFoo()</i> method and a custom&nbsp;<i id="a22430e6">BuilderMember</i> node:</p>   <p id="4926fe87">dslclass SwingBuilder for concept ClassConcept { <br>&nbsp; &nbsp; property numberOfFrames: integer; placeholder&lt;one frame&gt; <br>&nbsp; &nbsp; method calculateFoo(int value): int; required <br>&nbsp; &nbsp; custom member BuilderMember; &lt;modifiers&gt; <br>       <br>&nbsp; &nbsp; initializer: <br>&nbsp; &nbsp; &nbsp; &nbsp; {node&lt;ClassConcept&gt; node, model model =&gt; } <br>}</p>   <p id="3a1359fd">In order to have a particular&nbsp;<i id="06f85064">DSLDescriptor</i> take effect on a class, it needs to be annotated with a <i id="7ccbf562">DSLAnnotation</i>, which is done through intentions:</p>         <figure><img alt="ldsl1" title="ldsl1" src="/help/img/idea/2019.1/ldsl1.png" id="6a1bac1a" width="413" height="183"></figure>            <figure><img alt="ldsl2" title="ldsl2" src="/help/img/idea/2019.1/ldsl2.png" id="b054eabb" width="379" height="188"></figure>      <p id="525bcb17">As soon as the annotation is added, the required elements defined in the <i id="2bb131c7">DSLDescriptor</i> or the ones with&nbsp;<b id="14196a9c">placeholders</b> specified are added to the class. Deleting required elements will result in an error indicated on the class:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl3.png"><img alt="ldsl3" title="ldsl3" src="/help/img/idea/2019.1/ldsl3.png" id="40748252" width="300" height="228"></a></figure>      <p id="5e8eff20">An intention can be used to re-add the required elements as well as the placeholders in one step:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl4.png"><img alt="ldsl4" title="ldsl4" src="/help/img/idea/2019.1/ldsl4.png" id="43f6d3f4" width="300" height="406"></a></figure>      <p id="6d8670ac">The standard&nbsp;<b id="ced3050c">Implement method</b> action (<i id="4127ff25">Control/Cmd + I</i>) will also work for required methods.</p>   <h2 id="defininga&nbsp;dsldescriptor">Defining aÂ DSLDescriptor</h2>   <p id="e5c3d42f">There are four types of elements a&nbsp;<i id="da615190">DSLDescriptor</i> can add to classes:</p>   <ul class="list _ul"><li class="list__item" id="dfb0adf6"><p>properties</p></li><li class="list__item" id="6fd44260"><p>methods</p></li><li class="list__item" id="c1c2c1ff"><p>custom members</p></li><li class="list__item" id="4e1d3215"><p>an initializer</p></li></ul>   <p id="c445379f">Each of these can be&nbsp;<b id="d23c58ff">required</b>, can have a&nbsp;<b id="e5e62cd6">placeholder</b> defined to represent a missing member and&nbsp;<i id="f8d5d28a">custom members</i> can be marked as&nbsp;<b id="4a2945ce">multiple</b> indicating that more than one node of this kind can be a member of the class.</p>   <h3 id="properties">Properties</h3>   <p id="c4f23e09">Properties have a <b id="99e4e459">name</b> and can be of type <b id="9c521fe8">string</b>, <b id="5c910f04">int</b> or <b id="579037d9">boolean</b>. Properties become full blown members of the weaved class and can be accessed from other members, including the ones weaved in through this or other&nbsp;<i id="0f39d981">DSLDescriptor</i>.</p>   <h3 id="methods">Methods</h3>   <p id="850c1dac">Methods provide a very convenient way to let users of your lightweight DSL inject code - the&nbsp;<i id="e49b0a5f">DSLDescriptor</i> specifies method signatures of methods that the enhanced classes can or must implement. Unlike for normal methods, the return type as well as the types of any parameters of these weaved methods can be decided based on the actual usage in the host (enhanced) class.</p>   <h4 id="dependenttypes">Dependent types</h4>   <p id="d7219b84">The&nbsp;<b id="21d45c8d">dependent type</b>, when specified for a method's return type or a parameter type, specifies way to calculate the actual type of the method for a given class.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl5.png"><img alt="ldsl5" title="ldsl5" src="/help/img/idea/2019.1/ldsl5.png" id="52df3d9c" width="900" height="636"></a></figure>      <h4 id="conditionalmethodparameters">Conditional method parameters</h4>   <p id="bf14fc08">Methods can have some parameters marked as&nbsp;<b id="752230c7">conditional</b>, so that they only become visible in user code when the provided condition is satisfied. To mark a parameter as&nbsp;<b id="cb9c6704">conditional</b> you can use the corresponding intention:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl19.png"><img alt="ldsl19" title="ldsl19" src="/help/img/idea/2019.1/ldsl19.png" id="940b7be5" width="500" height="380"></a></figure>      <p id="c212d368">The actual condition is specified in the <b id="918bb962">Inspector</b>:</p>   <p id="ec568d22">&nbsp;<figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl20.png"><img alt="ldsl20" title="ldsl20" src="/help/img/idea/2019.1/ldsl20.png" id="a9137b88" width="700" height="434"></a></figure>   </p>   <h3 id="custommembers">Custom members</h3>   <p id="752c9130">If neither properties nor methods provide the required level of abstraction, custom members can be used to weave in any arbitrary concept with just a little bit of extra work.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl6.png"><img alt="ldsl6" title="ldsl6" src="/help/img/idea/2019.1/ldsl6.png" id="7995fb86" width="500" height="278"></a></figure>      <p id="01131b8e">The&nbsp;<i id="481974e9">CustomMemberDescriptor</i> points to a concept (<i id="527939df">BuilderMember</i> in our case) that will be weaved into the class as a new member. For this to be possible the concept has to implement the&nbsp;<i id="11fafc25">MemberInstance</i>&nbsp;and <i id="6ae79c8e">ClassifierMember</i> concept interfaces and point back to the&nbsp;<i id="d4dd0781">CustomMemberDescriptor</i>&nbsp;from the overriding&nbsp;<i id="22629a32">getDeclaration()</i> method.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl7.png"><img alt="ldsl7" title="ldsl7" src="/help/img/idea/2019.1/ldsl7.png" id="e3b01c37" width="500" height="660"></a></figure>            <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl8.png"><img alt="ldsl8" title="ldsl8" src="/help/img/idea/2019.1/ldsl8.png" id="37b575aa" width="500" height="532"></a></figure>      <p id="9a73a917">A node (or multiple nodes, if the <i id="9288dee6">CustomMemberDescriptor</i> is defined as <b id="715c9021">multiple</b>) of the specified concept can now be instantiated as a member of the host class and edited right inside it:</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl9.png"><img alt="ldsl9" title="ldsl9" src="/help/img/idea/2019.1/ldsl9.png" id="89a6dc66" width="500" height="1276"></a></figure>      <h3 id="initializer">Initializer</h3>   <p id="6bd8356d">The initializer function gets a chance to enhance the host class programmatically as soon as it is being created or annotated with the <i id="dbc64241">DSLAnnotation</i>. The node (the host class)&nbsp;itself may not have been added to the model when the initializer is called, thus the model parameter is provided as well as the node. If you import the&nbsp;<i id="967adba8">smodel</i> language you can manipulate the class and the model. Typically the initializer would set the imports and used languages or provide default values and implementations for the weaved in members, if needed.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl10.png"><img alt="ldsl10" title="ldsl10" src="/help/img/idea/2019.1/ldsl10.png" id="a4620805" width="900" height="1180"></a></figure>      <h2 id="enhancingcustomclassconceptsub-concepts">Enhancing custom ClassConcept sub-concepts</h2>   <p id="7253739e">There are some specifics if you're enhancing not&nbsp;<i id="1d8be157">BaseLanguage</i> classes directly, but specific sub-concepts of the&nbsp;<i id="f76f54f9">ClassConcept</i> class. This allows you to combine the benefits of external and internal DSLs. You typically create&nbsp;<i id="cb898eba">ClassConcept</i> sub-concepts instead of using plain <i id="940a378e">BaseLanguage</i> classes&nbsp;once your intended DSL requires customized editing experience, dedicated generator or specific type-system rules. So you create a sub-concept of&nbsp;<i id="4bbad446">ClassConcept</i> and make it implement the&nbsp;<i id="cb633de8">AutoInitDSLClass</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl11.png"><img alt="ldsl11" title="ldsl11" src="/help/img/idea/2019.1/ldsl11.png" id="675d71fd" width="500" height="628"></a></figure>      <p id="16521269">Implementing&nbsp;<i id="2bc90276">AutoInitDSLClass</i> ensures that whenever a node of your concept gets created, the weaved in DSLs get properly initialized by calling the&nbsp;<b id="f76dbca5">initializer</b> defined in their&nbsp;<i id="3787885d">DSLDescriptor</i>      <i id="270b8a50">s</i>.</p>         <figure><a class="lightbox" href="/help/img/idea/2019.1/ldsl12.png"><img alt="ldsl12" title="ldsl12" src="/help/img/idea/2019.1/ldsl12.png" id="f41f9f44" width="500" height="418"></a></figure>      <p id="ec6674f1">The&nbsp;<i id="ead802e7">AutoInitDSLClass</i> interface also mandates the implementing concepts to override the&nbsp;<i id="94f4b4a6">getDescriptor()</i> method that should return the particular&nbsp;<i id="29631dae">DSLDescriptor</i> instance to weave in.</p>   <h2 id="samples">Samples</h2>   <p id="5a1ea2b6">Samples illustrating basic usages of the Lightweight DSL can be found in the&nbsp;<b id="9439b5db">lightweightDSL</b> sample project bundled with MPS distributions.</p><div class="last-modified" data-skip-index="skip">Last modified: 5 July 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="custom-aspect.html">Custom Aspect</a><a class="navigation-links__next" href="base-language.html">Base Language</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>