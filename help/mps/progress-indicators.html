<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>进度指示器-帮助| MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Progress+indicators.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="progress-indicators.xml" data-toc="Progress+indicators.html">进度指标</h1>   <p id="b3fc52b8">默认情况下，动作会在执行期间阻止UI。对于未立即完成的动作，建议向用户指示该动作是活动的，并且可能还显示进度条，以向用户提供有关进度和时间估计的一些反馈。在本节中，我们将看到如何正确显示和更新进度指示器，如何允许用户手动取消操作以及将操作发送到后台。</p>   <aside class="tip sideblock" rel="b3fc52b8" id="ee457dd1" data-title="">      <p id="b38da80e"><b id="cc06cf63">ProgressIndicators</b>示例项目将为您提供显示进度条，可以取消并在后台运行的动作的功能示例。</p>   </aside>   <h2 id="asynchronoustasks">异步任务</h2>   <p id="46a8aca8">您应该以快速执行所有操作为目标，以避免冻结UI。应该从动作中提取持久的活动，并将其放入一个或多个异步运行的<b id="d063b695">任务中</b> 。任务从<i id="fbc2a7f4">com.intellij.openapi.progress@java_stub</i>扩展了<i id="70d1a327">Task</i>类，并且它们可以显示<b id="dc2cbe10">模式</b>对话框（ <i id="aef4fc31">Task。模态</i>类）或发送到<b id="d10d152f">后台</b> （ <i id="c328ff62">任务。背景</i>类）。该任务应通过<i id="744ef96e">ApplicationManager.getApplication（）。invokeLater（）</i>方法在EDT上调用。</p>   <div class="code-block" data-lang="none">action ModalProgressAction {助记符： <no mnemonic="">在外部执行命令：false也可用于：<< ... >>标题：BackgroundableProgressAction描述： <no description="">图标： <no icon="">施工参数<< ... >> action上下文参数（始终可见= false）项目项目关键字：需要PROJECT的MPSProject mpsProject键：MPS_PROJECT必需的<update block="">execute（event）-> void {boolean canBeCanceled = true;任务。模态modalTask =新任务。Modal（ModalProgressAction.this.project，“模态可取消任务”，canBeCanceled）{public void run（@NotNull（）final ProgressIndicator指标）{doWorkChunk1（）;如果（checkForCancellation（））返回; doWorkChunk2（）;如果（checkForCancellation（））返回; ...} @Override public void onCancel（）{super.onCancel（）; }; ApplicationManager.getApplication（）。invokeLater（{=> ProgressManager.getInstance（）。run（modalTask）;}）; }}</update></no></no></no></div>   <p id="36d0575c">该任务通常提供执行任务的<i id="34710c58">run（）</i>方法和处理用户调用的取消的<i id="95d670e0">onCancel（）</i>方法。实际的取消逻辑必须由任务实现者实施<i id="1756ba58">-run（）中的工作</i>应组织为大块，并检查它们之间是否有未决的取消。<i id="7dfdd680">onCancel（）</i>方法仅在<i id="719f17fc">run（）</i>通过取消完成后才被触发，因此主要用于清理任务完成的部分工作。</p>   <p id="0124d67c">不可取消的模态任务（ <i id="86dcb7ee">canBeCancelled</i>参数设置为<i id="c9db56fd">false</i> ）将迫使用户等待动作完全结束，因此应谨慎使用（也许仅用于关键动作），因为取消动作很难正确处理。</p>   <h2 id="monitoringprogress">监控进度</h2>   <p id="1c6e334f">任务的<i id="a6733f4f">run（）</i>方法获取IntelliJ进度指示器的实例作为参数。建议将其包装在来自<i id="538a6506">jetbrains.mps.progress@java_stub的</i> <i id="5829714c">ProgressMonitorAdapter中</i> 。<i id="d61a3234">ProgressMonitorAdapter</i>代表可视进度对话框，并提供了设置实际进度条值以及向用户显示的标签的方法。它还保存有关取消的信息。</p>   <div class="code-block" data-lang="none">任务。模态modalTask =新任务。Modal（ModalProgressAction.this.project，“模态可取消任务”，canBeCanceled） adapter.start（“正在进行中...”，8）; int stepValue = 1; adapter.step（“完成工作1 ...”）;做块1 adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； } adapter.step（“做工作2 ...”）;做块2 adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； } ...adapter.done（）; }</div>   <p id="09085c96">一些注意事项：</p>   <ul class="list _ul"><li class="list__item" id="d8645916"><p>Task的构造函数包含一个文本，该文本将用作进度对话框的标题</p></li><li class="list__item" id="d18c5938"><p><i id="023b6cf6">start（）</i>方法提供了在进度条上方显示的文本以及完成任务的许多步骤/点</p></li><li class="list__item" id="0b56189f"><p><i id="a5144be2">step（）</i>方法更改进度对话框中进度条下方显示的文本标签</p></li><li class="list__item" id="7075390a"><p><i id="b5795dd0">advance（）</i>方法将进度条按指定的步数/点数移动到新值</p></li><li class="list__item" id="f9407d32"><p>使进度步骤尽可能小，以改善用户体验。较小的步骤可为用户提供更流畅的体验</p></li></ul>   <h2 id="runninginthebackground">在后台运行</h2>   <p id="41db5984"><i id="446aa70f">任务。应将Backgroundable</i>类用于可在后台处理的任务。</p>   <div class="code-block" data-lang="none">action BackgroundableProgressAction {助记符： <no mnemonic="">在外部执行命令：false也可用于：<< ... >>标题：BackgroundableProgressAction描述： <no description="">图标： <no icon="">施工参数<< ... >> action上下文参数（始终可见= false）项目项目关键字：需要PROJECT的MPSProject mpsProject键：MPS_PROJECT必需的<update block="">execute（event）-> void {boolean canBeCanceled = true; PerformInBackgroundOption showProgress = PerformInBackgroundOption。聋;任务。Backgroundable backgroundable =新任务。Backgroundable（BackgroundableProgressAction.this.project，“ Backgroundable Cancelable task”，canBeCanceled，showProgress）{公共无效运行（@NotNull（）最终ProgressIndicator指示器）{...} @Override public void onCancel（）{super.onCancel（）; }; ApplicationManager.getApplication（）。invokeLater（{=> ProgressManager.getInstance（）。run（backgroundable）;}）; }其他方法private void doWork（）{...}}</update></no></no></no></div>   <p id="7a2a72c4">一些注意事项：</p>   <ul class="list _ul"><li class="list__item" id="465c14e8"><p>可后台执行的任务可能允许也可能不允许取消</p></li><li class="list__item" id="a6cb06ae"><p><i id="0a4207ff">PerformInBackgroundOption</i>界面使您可以创建从前台和后台开始的任务</p></li><li class="list__item" id="28d61778"><p>用户可以将可后台任务移动到前台以及后台</p></li><li class="list__item" id="853ccb99"><p><i id="df878a41">PerformInBackgroundOption</i>界面的预定义常量为<i id="df878a41">DEAF</i> <i id="d1650b02">（从前台开始）和ALWAYS_BACKGROUND（从后台开始）</i> ，对于用户不需要注意的非关键操作很有用，因为不会显示对话框使用户分心， UI始终保持完全可用状态）。_</p></li></ul>   <h2 id="properlockingwhenaccessingresources">访问资源时正确锁定</h2>   <p id="7ef10e17">可以在任务内部以及执行命令的同时获得对MPS存储库的读写锁定：</p>   <div class="code-block" data-lang="none">//显示状态为ModalProgressAction.this.mpsProject.getRepository（）。getModelAccess（）。runReadAction（new Runnable（）{public void run（）{adapter.step（“对读锁进行一些处理。） 。“）; ModalProgressAction.this.doWork（）;}}）; adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； } //对于显示状态ModalProgressAction.this.mpsProject.getRepository（）。getModelAccess（）。runWriteAction（new Runnable（）{public void run（）{adapter.step（“对写锁进行一些工作），在步骤中可以执行WriteAction。 ..“）; ModalProgressAction.this.doWork（）;}}）; adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； } //显示状态ModalProgressAction.this.mpsProject.getRepository（）。getModelAccess（）。executeCommand（new Runnable（）{public void run（）{adapter.step（“在命令中进行一些工作。 。“）; ModalProgressAction.this.doWork（）;}}）; adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； }</div>   <p id="1d4d5578">一些注意事项：</p>   <ul class="list _ul"><li class="list__item" id="f68dd00f"><p>当您需要在一个动作中锁定时，最好将所有修改分组到一个锁定块中</p></li><li class="list__item" id="91c64876"><p>不需要时立即释放锁，以免阻止其他潜在的用户操作</p></li><li class="list__item" id="8c7de00e"><p>不要在EDT线程中使用R / W操作或命令-这将导致进度的意外更新，甚至可能导致UI冻结</p></li></ul>   <h2 id="undoableactions">不可执行的动作</h2>   <p id="dd034dea">更改模型需要不可撤销的操作，可以通过<i id="29070d86">executeCommandInEDT（）</i>方法执行该操作。但是，您不能从命令中调用<i id="cf6516da">ProgressIndicator的</i>方法，因为它本身正在EDT中运行，并且所有对进度条更改的请求都将延迟到命令完成为止。推荐的方法是在通过<i id="616eb7a9">executeCommandInEDT（）</i>调用命令之前从主操作的线程指示进度条，然后阻塞主操作的线程，直到命令完成为止，也许使用<i id="131bd651">CyclicBarrier</i>或其他同步原语：</p>   <div class="code-block" data-lang="none">adapter.step（“在命令中做一些工作...”）;最终的CyclicBarrier障碍=新的CyclicBarrier（2）; ModalProgressAction.this.mpsProject.getRepository（）。getModelAccess（）。executeCommandInEDT（new Runnable（）{public void run（）{try {model m = model / myModel /; m.new root node（MyRootConceptDeclaration）;}最终{试试{barrier.await（）;} catch（BrokenBarrierException e）{ <no statements="">} catch（InterruptedException e）{ <no statements="">}}}}）；尝试{barrier.await（）; } catch（InterruptedException e）{ <no statements="">} catch（BrokenBarrierException e）{ <no statements="">} adapter.advance（stepValue）;如果（adapter.isCanceled（））{返回； }</no></no></no></no></div>   <p id="6f0fed61">可以利用“ <b id="d50ad3fc">其他方法”</b>部分从动作的主体中提取锁定实现代码。</p>   <div class="code-block" data-lang="none">私有无效块（CyclicBarrier障碍）{试试{barrier.await（）; } catch（BrokenBarrierException e）{ <no statements="">} catch（InterruptedException e）{ <no statements="">}}</no></no></div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="plugin.html">插件</a> <a class="navigation-links__next" href="creating-wizards.html">创建向导</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>