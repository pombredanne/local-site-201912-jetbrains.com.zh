<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>SModel language Queries - Help | MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="SModel+language+Queries.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search MPS Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Default</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_jbuilder">JBuilder</option><option data-group="primary" value="primary_mac_os_x">Mac OS X</option><option data-group="primary" value="primary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default">Default</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_jbuilder">JBuilder</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Mac OS X 10.5+</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="SModel+language+Queries.html" id="smodel-language-queries.xml">SModel language Queries</h1>      <h2 id="comparison">Comparison</h2>   <p id="da3ed3a2">The&nbsp;<i id="0d972a93">:eq:</i> and&nbsp;<i id="9d4d78c7">:ne:</i> operators can be used to compare nodes for equality. The operators are null-safe and will compare the whole sub-trees represented by the two&nbsp;compared nodes.</p>   <h2 id="queries">Queries</h2>   <h3 id="gettingnodesbyname">Getting nodes by name</h3>   <p id="0888ea7b">Use the <i id="315d47c2">node-ptr/.../</i> construct to obtain a reference to a node using its name.</p>   <p id="bf526972">      <figure><a class="lightbox" href="/help/img/idea/2019.2/ndptr1.png"><img alt="ndptr1" title="ndptr1" src="/help/img/idea/2019.2/ndptr1.png" id="2133d0b6" width="700" height="232"></a></figure>   </p>   <p id="9f90e3ff">To check that a node is a specific one, there is the "is"&nbsp;operation available.</p>   <div class="code-block"><code class="code-block__wrapper">equals.is(Object-&gt;equals);</code></div>   <p id="b8d93f3f">To get a pointer to a node, use the&nbsp;<b id="339adf48">pointer</b> construct:</p>   <p id="18422d61">      <figure><a class="lightbox" href="/help/img/idea/2019.2/ndptr2.png"><img alt="ndptr2" title="ndptr2" src="/help/img/idea/2019.2/ndptr2.png" id="0ea22c11" width="500" height="112"></a></figure>   </p>   <h3 id="gettingconceptsbyname">Getting concepts by name</h3>   <p id="423f1700">Use the&nbsp;<i id="f223a885">concept/.../</i> construct to obtain a concept declaration by specifying its name:</p>   <div class="code-block" data-lang="none">concept&lt;CommandList&gt; myConcept = concept/CommandList/;
&nbsp;</div>   <p id="d6bc52ca">The&nbsp;<i id="6381156b">concept switch</i> construct can be used to branch off the logic depending on the concept at hands:</p>   <p id="e00d3636">      <figure><a class="lightbox" href="/help/img/idea/2019.2/ConceptSwitch.png"><img alt="ConceptSwitch" title="ConceptSwitch" src="/help/img/idea/2019.2/ConceptSwitch.png" id="0ff53c8e" width="700" height="340"></a></figure>   </p>      <h3 id="featuresaccess">Features access</h3>   <p id="0d39ac65">The SModel language can be used to access the following features:</p>   <ul class="list _ul"><li class="list__item" id="54a3da3d"><p>properties</p></li><li class="list__item" id="5f01f86d"><p>children</p></li><li class="list__item" id="9f47aed6"><p>references</p></li></ul>   <p id="2b8b2a02">To access them, the following syntax is used:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt;.featureName.
</div>   <p id="c2c5bc1e">If the feature is a property, then the type of whole expression is the property's type. If the feature is a reference or a child of 0..1 or 1 cardinality, then the type of this expression is <b id="2676f29c">node&lt;LinkTarget&gt;</b>, where <b id="0c1fd4c2">LinkTarget</b> is the target concept in the reference or child declaration. If the feature is a child of 0..n cardinality, then the type of this expression is <b id="51ab6b11">nlist&lt;LinkTarget&gt;</b>.</p>   <p id="22994378">You can use so-called <i id="81777c20">implicit select</i> to access features of the child nodes. For example, the following query:</p>   <div class="code-block" data-lang="none">thisNode.children.grandChildren
</div>   <p id="20262a6b">will be automatically transformed by MPS to something like:</p>   <div class="code-block" data-lang="none">thisNode.children.selectMany({~it =&gt; it.grandChildren; })
</div>   <p id="e739957b">resulting in a plain collection of all non-null model elements accessible through the specified chain of link declarations.</p>      <h3 id="nullchecks">Null checks</h3>   <p id="00d0bdd4">Since nulls are treated liberally in MPS, we need a way to check for null values. The <b id="46fce6e6">isNull</b> and <b id="62aee878">isNotNull</b> operations are our friends here.</p>      <h3 id="isinstanceofcheckandtypecasts">IsInstanceOf check and type casts</h3>   <p id="08fab75d">Often, we need to check whether a node is an instance of a particular concept. We can't use Java's instanceof operator since it only understands java objects, not our MPS nodes. To perform this type of check, the following syntax should be used:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt;.isInstanceOf(Concept)
</div>   <p id="c155e79d">Also, there's the <i id="7dd83de3">isExactly</i> operation, which checks whether a node's concept is exactly the one specified by a user.</p>   <p id="ca472b7b">Once we've checked a node's type against a concept, we usually want to cast an expression to a concept instance and access some of this concept's features. To do so, the following syntax should be used:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt; : Concept
</div>   <p id="efedf039">      <br> Another way to cast node to particular concept instance is by using <b id="89a1012c">as</b> cast expression:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt; as Concept
</div>   <p id="32b39330">The difference between the regular cast (using colon) and the <b id="495a3fb1">as</b> cast is in a way it handles the situation when the result of the left-side expression cannot be safely cast to the specified Concept instance: A NullPointer exception will be thrown by the regular cast in this case, while null will be returned by the <b id="11bc3db8">as</b> cast.</p>   <p id="ac62f6d3">Combine this with the <b id="3ce3533d">null-safe dot operator</b> in the&nbsp;<i id="c402269e">smodel</i> language and you get a very convenient way to navigate around the model:</p>   <div class="code-block" data-lang="none">node.parent as BinaryOperation.leftExpression as BinaryOperation.leftExpression.isLValue()
</div>   <aside class="tip sideblock" data-title="" rel="fd375dee" id="634a8b18">      <p id="a3f15113">Intention are available to easily migrate from one type of cast expression to the other:</p>      <p id="d1735af8">         <figure><a class="lightbox" href="/help/img/idea/2019.2/cast1.png"><img alt="cast1" title="cast1" src="/help/img/idea/2019.2/cast1.png" id="78091be9" width="500" height="124"></a></figure>          <figure><a class="lightbox" href="/help/img/idea/2019.2/cast2.png"><img alt="cast2" title="cast2" src="/help/img/idea/2019.2/cast2.png" id="3c3a9c38" width="400" height="101"></a></figure>      </p>   </aside>   <h3 id="nodecollectioncast">Node collection cast</h3>   <p id="d32c02ae">A collection of nodes can be filtered and cast by the concept of the nodes using the&nbsp;<i id="342fc0f7">ofConcept</i> construct:</p>   <div class="code-block" data-lang="none">node.statements.ofConcept&lt;LocalVariableDeclaration&gt;</div>   <p id="07521f8e"><code class="code">seq.ofConcept&lt;MyConcept&gt;</code> is equivalent to <code class="code">seq.ofType&lt;node&lt;MyConcept&gt;&gt;</code></p>   <h3 id="aspectcollectioncast">Aspect collection cast</h3>   <p id="799dbc24"><code class="code">seq.ofAspect&lt;structure&gt;</code> filters nodes of a particular aspect</p>   <h3 id="parent">Parent</h3>   <p id="4afe81c3">In order to find a node's parent, the <b id="fd656af1">parent</b> operation is available on every node.</p>   <h3 id="children">Children</h3>   <p id="30f49b12">The <b id="a4b3cb86">children</b> operation can be used to access all direct child nodes of the current node. This operation has an optional parameter <b id="d63119f9">linkQualifier</b>. With this parameter result of <b id="ed113473">children&lt;linkQualifier&gt;</b> operation is equivalent to <b id="fd30b822">node.linkQualifier</b> operation call and so will recall only the children belonging to the <b id="e72223b4">linkQualifier</b> group/role. E.g. <i id="7a79658f">classDef.children&lt;annotation, member&gt;</i>   </p>      <h3 id="siblingqueries">Sibling queries</h3>   <p id="6c96988d">When you manipulate the AST, you will often want to access a node's siblings (that is, nodes with the same role and parent as the node under consideration). For this task we have the following operations:</p>   <ul class="list _ul"><li class="list__item" id="6071184c"><p>next-sibling/prev-sibling - returns next/previous sibling of a node. If there is no such sibling, null is returned.</p></li><li class="list__item" id="5ff2ce5a"><p>next-siblings/prev-siblings - returns nlist of next/previous siblings of a node. These operations have an optional parameter that specifies whether to include the current node.</p></li><li class="list__item" id="0f4a6a6b"><p>siblings - returns nlist of all siblings of a node. These operations have an optional parameter that specifies whether to include the current node.</p></li></ul>      <h3 id="ancestors">Ancestors</h3>   <p id="47361209">During model manipulation, it's common to find all ancestors (parent, parent of a parent, parent of a parent of a parent, etc) of a specified node. For such cases we have two operations:</p>   <ul class="list _ul"><li class="list__item" id="77af02e9"><p>ancestor - return a single ancestor of the node</p></li><li class="list__item" id="539fb02c"><p>ancestors - returns all ancestors of the node<br> Both of them have the following parameters to narrow down the list:</p></li><li class="list__item" id="f61e411e"><p>concept type constraint: concept=Concept, concept in [ConceptList]</p></li><li class="list__item" id="a53797e7"><p>a flag indicating whether to include the current node: +</p></li></ul>   <p id="7a3af493">E.g. <i id="a189f9b3">myNode.ancestors&lt;concept = InstanceMethodDeclaration, +&gt;</i>   </p>      <h3 id="descendants">Descendants</h3>   <p id="1d64ff1f">It's also useful to find all descendants (direct children, children of children etc) of a specified node. We have the <b id="7dec1fa5">descendants</b> operation for such purposes. It has the following parameters:</p>   <ul class="list _ul"><li class="list__item" id="46bd867e"><p>concept type constraint: concept=Concept, concept in [ConceptList]</p></li><li class="list__item" id="c7464e0a"><p>a flag indicating whether to include current node: +</p></li></ul>   <p id="0666b0b4">E.g.&nbsp;<i id="6d3ff1fb">myNode.descendants&lt;concept = InstanceMethodDeclaration&gt;</i>   </p>   <h3 id="containingrootandmodel">Containing root and model</h3>   <p id="0cd15d04">To access top-most ancestor node of a specified node you can make use of <b id="121f2cc6">containing root</b> operation. Containing model is available as a result of the <b id="fafda357">model</b> operation.</p>   <p id="936a6ba3">For example,</p>   <ul class="list _ul"><li class="list__item" id="d5dc3f5f"><p>node&lt;&gt; containingRoot = myNode.containing root</p></li><li class="list__item" id="8e22926d"><p>model owningModel = myNode.model</p></li></ul>      <h3 id="modelqueries">Model queries</h3>   <p id="a01ed0e8">The&nbsp;<i id="947629f7">model-ptr/.../</i> expression retrieves a resolvable reference to a model. With a repository it can be resolved into the&nbsp;<i id="03fa5a02">model&lt;&gt;</i> type.</p>   <p id="bd0152f3">Often we want to find all nodes in a model which satisfy a particular condition. We have several operations that are applicable to expressions of the model&lt;&gt; type:</p>   <ul class="list _ul"><li class="list__item" id="505ca9e0"><p>roots(Concept) - returns all roots in a model, which are instances of the specified Concept</p></li><li class="list__item" id="145f17b2"><p>nodes(Concept) - returns all nodes in a model, which are instances of the specified Concept</p></li></ul>   <p id="88c1c70d">E.g.&nbsp;<i id="27688699">model.roots(&lt;all&gt;)</i>&nbsp;or&nbsp;<i id="2333273d">model.nodes(IfStatement)</i>   </p>      <h3 id="searchscopequeries">Search scope queries</h3>   <p id="c60c9bcd">In some situations, we want to find out, which references can be set on a specified node. For such cases we have the search scope operation. It can be invoked with the following syntax:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt;.search scope(link, operationContext)
</div>      <h3 id="theconceptliteral">The Concept literal</h3>   <p id="34f99f8b">Often we want to have a reference to a specified concept. For this task we have the <b id="c1964a80">concept</b> literal. It has the following syntax:</p>   <div class="code-block" data-lang="none">concept/ConceptName/
</div>   <p id="d7cff8e1">E.g. <i id="8b407a47">concept&lt;IfStatement&gt; concept = concept/IfStatement/</i>   </p>      <h3 id="conceptoperation">Concept operation</h3>   <p id="0ba74677">If you want to find the concept of a specified node, you can call the <i id="7439074d">concept</i> operation on the node.</p>   <p id="a1cc40b7">E.g.&nbsp;<i id="8eccb6d2">concept&lt;IfStatement&gt; concept = myNode.concept</i>   </p>      <h3 id="migratingawayfromdeprecatedtypes">Migrating away from deprecated types</h3>   <p id="48eb759b">The <i id="ad415ea4">conceptNode&lt;&gt;</i>&nbsp;type as well as the <i id="ccbc3f6b">conceptNode</i>&nbsp;operation have been deprecated. The <i id="f817b9e3">asConcept</i>&nbsp;operation will convert a <i id="6fd98a27">conceptNode&lt;&gt;</i>&nbsp;to a <i id="6a039aca">concept&lt;&gt;</i>. The <i id="6c72c900">asNode</i>&nbsp;operation, on the other hand, will do the opposite conversion and will return a <i id="405e1369">node&lt;AbstractConceptDeclaration&gt;</i> for a <i id="f9cc761a">concept&lt;&gt;</i>.</p>   <aside class="tip sideblock" data-title="" rel="48eb759b" id="e58512f5">      <p id="eb72a39e">The <i id="b249abfc">conceptNode&lt;&gt;</i>&nbsp;type was called <i id="1a0d2b4e">concept&lt;&gt;</i>&nbsp;in MPS 3.1. The <i id="51c13afa">conceptNode</i>&nbsp;operation was called <i id="775bb190">concept</i>&nbsp;in MPS 3.1.</p>   </aside>   <h3 id="concepthierarchyqueries">Concept hierarchy queries</h3>   <p id="dd0302b2">We can query super/sub-concepts of expression with the concept type. The following operations are at your disposal:</p>   <ul class="list _ul"><li class="list__item" id="857cdc59"><p>         <b id="8b29952f">super-concepts/all</b>&nbsp;- returns all super-concepts of the specified concept. There is an option to include/exclude the current concept - <i id="378925ff">super-concepts/all&lt;+&gt;</i>      </p></li><li class="list__item" id="dce30a6c"><p>         <i id="54b9ae52">super-concepts/direct</i>&nbsp;- returns all direct super-concepts of the specified concept. Again, there is an option to include/exclude the current concept -&nbsp;<i id="de0cfbc9">super-concepts/direct&lt;+&gt;</i>      </p></li><li class="list__item" id="b3a82ff9"><p>         <b id="f8001b60">sub-concepts</b> - returns sub-concepts</p></li></ul>   <p id="26c3b8d8">For example:</p>   <p id="4494ff8c">concept&lt;IfStatement&gt; concept = myNode.concept;&nbsp;<br> list&lt;concept&lt;&gt;&gt; superConceptsAll = concept.super-concepts/all;&nbsp;<br> concept.super-concepts/direct&lt;+&gt;;&nbsp;<br> concept.sub-concepts(model);<br>       <i id="b13640eb">concept&lt;IfStatement&gt; concept = myNode.concept;&nbsp;</i>      <br>       <i id="b0ed284e">list&lt;concept&lt;&gt;&gt; superConceptsAll = concept.super-concepts/all;&nbsp;</i>      <br>       <i id="6ea4eb33">concept.super-concepts/direct&lt;+&gt;;&nbsp;</i>      <br>       <i id="0459282d">concept.sub-concepts(model, myScope);</i>   </p>      <h3 id="thehasroleoperation">The hasRole operation</h3>   <p id="00d90964">Sometimes we may want to check whether a node has a particular role. For this we have the following syntax:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt;.hasRole(Concept : child)
</div>   <p id="a3cdd320">For example,</p>   <p id="eb46fbc6">      <i id="3189de1a">myNode.hasRole(IfStatement: elsifClauses)</i>&nbsp;</p>   <h3 id="linkqueries">Link queries</h3>   <p id="d44ae1c1">The&nbsp;<i id="c5386961">link</i>,&nbsp;<i id="8274df6f">linkName</i> and&nbsp;<i id="a7aff793">linkNode</i> operations &nbsp;give you access to the details of a link between nodes.</p>   <p id="02426e31">&nbsp;</p>   <div class="code-block" data-lang="none">node&lt;LinkDeclaration&gt; decl = linkNode/ClassCreator : constructorDeclaration/; 
decl.sourceCardinality; 
decl.metaClass; 
decl.role; 
decl.target; 
decl.unordered;&nbsp;
...
 
string name = linkName/ClassCreator : constructorDeclaration/; 
 
SReferenceLink link = link/ClassCreator : constructorDeclaration/; 
link.isOptional(); 
link.getDeclarationNode(); 
link.getOwner(); 
link.getName(); 
link.getTargetConcept(); 
link.getScope(decl/);
...</div>   <h3 id="containinglinkqueries">Containing link queries</h3>   <p id="d9942d7e">If one node was added to another one (parent) using the following expression:</p>   <div class="code-block" data-lang="none">parent.childLinkRole.add(node)
</div>   <p id="21c16f3c">then you can call the following operations to access the containment relationship information:</p>   <ul class="list _ul"><li class="list__item" id="afdc9380"><p>         <b id="33cafea4">containingRole</b> - returns a string representing the child role of the parent node containing this node ("childLinkRole" in above case)</p></li><li class="list__item" id="8bb2bfcc"><p>         <b id="fc7fa958">containingLink</b> - returns node&lt;LinkDeclaration&gt; representing a link declaration of the parent node containing this node</p></li><li class="list__item" id="231b1e6a"><p>         <b id="9e99cdb7">index</b> - returns int value representing index of this node in a list of children with corresponding role. Identical to the following query upon the model represented above:</p></li></ul>   <div class="code-block" data-lang="none">parent.childLinkRole.indexOf(node)
</div>      <h3 id="downcast">downcast</h3>   <h3 id="downcasttolowersemanticlevel">Downcast to lower semantic level</h3>   <p id="ccaeec25">SModel language generates code that works with raw MPS classes. These classes are quite low-level for the usual work, but in some exceptional cases we may still need to access them. To access the low-level objects, you should use the <i id="a67343b1">downcast to lower semantic level</i> construct. It has the following syntax:</p>   <div class="code-block" data-lang="none">&lt;node expression&gt;/
</div>   <p id="cd92a686">For example,</p>   <p id="a53fc6b3">      <i id="1231c035">myNode/.getConcept().findProperty("name")</i>   </p>   <p id="43344910">      <i id="b7663ce7"></i>   </p><div class="last-modified" data-skip-index="skip">Last modified: 30 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="smodel-language-types.html">SModel language Types</a><a class="navigation-links__next" href="smodel-language-queries-references.html">SModel language Queries References</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>