<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>发电机用户指南Demo4-帮助| MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Generator+User+Guide+Demo4.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="generator-user-guide-demo4.xml" data-toc="Generator+User+Guide+Demo4.html">发电机用户指南Demo4</h1>   <h2 id="generatoruserguidedemo4">发电机用户指南演示4</h2>   <p id="272b4a5e">在这个演示中，我们将进一步改进demoLang3生成器（请参阅<a href="generator-user-guide-demo3.html">演示3</a> ），并增加对<i id="170c8863">面板</i>组件的支持。与<i id="ebd3585c">按钮</i>或<i id="288c914c">标签</i>不同， <i id="56efd038">面板</i>可以包含其他组件，包括其他面板。这样我们就可以在生成器中进行递归了。我们将看到<b id="8587a6bb">减少量</b>如何帮助解决此类问题。</p>   <h2 id="newlanguage">新语言</h2>   <p id="f6dda078">我们将在demoLang4中重用大部分demoLang3生成器。</p>   <ul class="list _ul"><li class="list__item" id="ada6a276"><p>创建新语言“ generator_demo.demoLang4”</p></li><li class="list__item" id="5bae1380"><p>在语言属性对话框中添加<b id="2ad17278">扩展语言</b> ：'jetbrains.mps.sampleXML'和'jetbrains.mps.baseLanguage'</p></li><li class="list__item" id="6f800785"><p>如果该语言不存在，请为其创建一个新的生成器（有关详细信息，请参见<a href="generator-user-guide-demo1.html">演示1</a> ）</p></li><li class="list__item" id="b91e557e"><p>从demoLang4生成器中删除（空）映射配置“ main”（我们将从demoLang3生成器中复制所有需要的部分到demoLang4生成器中）</p></li><li class="list__item" id="a13df43c">         <p id="fe7d47ee">将<b id="44ffe7ff">所有节点</b>从demoLang3生成器复制粘贴到demoLang4生成器</p>         <aside class="note " rel="fe7d47ee" id="1297f2cc" data-title="">            <p id="da4c12d2">有关详细信息，请参见<a href="generator-user-guide-demo2.html#new_language">演示2</a> 。</p>         </aside>         <aside class="tip sideblock" rel="a13df43c" id="f0ef2cce" data-title="">            <p id="7577aae8">这样做甚至不提供从demoLang3生成器导入生成器模型的功能。</p>         </aside>      </li></ul>   <h2 id="templateforpanel">面板模板</h2>   <p id="89151f72">与按钮和标签的生成方式一致，我们将创建一个新模板来为面板生成代码<i id="471456c7">-insert_Panel</i> 。由于此模板将与例如<i id="d0c905aa">insert_Label</i>非常相似， <i id="d0c905aa">因此</i>我们将创建新模板作为现有模板之一的副本。</p>   <ul class="list _ul"><li class="list__item" id="8a80f0d0"><p>在demoLang4生成器中选择（在树中） <i id="dba3820a">insert_Label</i>模板，然后在弹出菜单中调用<i id="64ff38d4">Clone Root</i>命令。</p></li><li class="list__item" id="d1fe5b13"><p>在编辑器中-重命名新模板： <i id="ebd438af">insert_Label-</i> > <i id="bbe84047">insert_Panel</i>      </p></li><li class="list__item" id="b6446f7e"><p>在模板代码中-用JPanel替换JLabel</p></li><li class="list__item" id="1d7d9990"><p>删除'setText（...）'语句-面板不支持'text'属性</p></li></ul>   <p id="25ed45e8">      </p><figure><img alt="屏幕截图2017年6月27日下午12 50 52" title="屏幕截图2017年6月27日下午12 50 52" src="/help/img/idea/2019.2/Screen-Shot-2017-06-27-at-12-50-52-PM.png" id="17880ce2" width="593" height="315"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="59268758"><p>在<i id="b1f4ef53">switch_Element</i>模板开关中为面板添加一个条目：</p></li></ul>   <p id="78cbc40b">      </p><figure><img alt="gdd2" title="gdd2" src="/help/img/idea/2019.2/gdd2.png" id="0658bccf" width="862" height="445"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="949d730d"><p>重新生成发电机</p></li></ul>   <h2 id="firsttest">第一次测试</h2>   <p id="ca92765a">让我们创建一个新的测试模型：</p>   <ul class="list _ul"><li class="list__item" id="26162dde"><p>转到“ test_models”解决方案</p></li><li class="list__item" id="20d1ec7f"><p>将模型“ test3”克隆到模型“ test4”</p></li><li class="list__item" id="f8654cd9"><p>在模型属性对话框中，替换“参与生成”语言demoLang3-> demoLang4（有关详细信息，请参见<a href="generator-user-guide-demo2.html">演示2</a> ）</p></li><li class="list__item" id="2573cc6b"><p>在模型“ test4”中，添加一个带有根元素“ panel”的新文档“ Panel”</p></li><li class="list__item" id="df6485c6"><p>在“面板”元素中添加属性：“ background =“ white””</p></li><li class="list__item" id="e5be2163"><p>在“ panel”元素中添加几个“ label”元素：</p></li></ul>   <p id="debf1ea0">      </p><figure><img alt="gdd3" title="gdd3" src="/help/img/idea/2019.2/gdd3.png" id="8edef2e3" width="609" height="234"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="06961328"><p>为“ test4”模型生成文件</p></li><li class="list__item" id="f2458f62"><p>预览生成的文件</p></li></ul>   <p id="a5ee17b9">      </p><figure><img alt="格迪" title="格迪" src="/help/img/idea/2019.2/gddy.png" id="77377026" width="386" height="629"></figure>   <p></p>   <p id="a5ece0d5">生成的用户界面显然忽略了“ Hello MPS！标签应嵌套在新面板内。而是将它们直接添加到框架中。这是因为我们的生成器当前在根元素和非根元素之间没有任何区别，只是将它们全部转换为顶级可视组件。对于输入模型中的每个元素，生成器都会在'DemoApp'类中插入静态方法声明'createComponent（）'（这是完全可以的），并在'DemoApp'中的'addContent（）'方法内部生成相应的方法调用类（我们需要更改，因为这仅应针对根元素进行）。</p>   <p id="c3f17fe0">当前的实现展平了我们的组件层次结构（所有组件都直接添加到应用程序的内容窗格中）。</p>   <h2 id="restrictingtheloopmacrotorootelements">将LOOP宏限制为根元素</h2>   <p id="c6e4aba1">攻击的第一个问题是<i id="8c8e3783">DemoApp</i>模板中的<i id="6fb2cba1">LOOP</i>宏，该宏仅应遍历根元素以生成针对它们的<i id="6ffe927c">container.add（）</i>调用。嵌套在面板内部的元素一定不能包含在循环中，因为它应该是稍后将其添加到UI的包含面板。</p>   <p id="b2e43ea2">让我们更改第一个<i id="e5c09f97">LOOP</i>宏。还要注意，第二个<i id="ce2b14ff">LOOP</i>宏没有改变，该宏为每个<i id="558cdbfc">Element</i>生成了静态方法声明。<br>       </p><figure><img alt="gdd6" title="gdd6" src="/help/img/idea/2019.2/gdd6.png" id="aaea13bd" width="740" height="569"></figure>   <p></p>   <p id="7043d34b">由于我们现在遍历<i id="3b73bf1c">Documents</i>而不是<i id="0cc897ed">Elements</i> ，因此需要在<i id="c3dc9f97">LOOP</i>内更改<i id="9883e7b0">引用宏</i> 。</p>   <p id="c4cc6c97">      </p><figure><img alt="gdd7" title="gdd7" src="/help/img/idea/2019.2/gdd7.png" id="e6a371d6" width="862" height="302"></figure>      <br>    <p></p>   <p id="eb63f7e2">如果您重建语言并查看生成的文件，则会注意到我们不再将嵌套的组件添加到最顶层的应用程序框架中。</p>   <p id="61596767">      </p><figure><img alt="gdd8" title="gdd8" src="/help/img/idea/2019.2/gdd8.png" id="933e18ed" width="393" height="602"></figure>      <br>但是，我们也没有将它们添加到面板中。这就是我们现在要解决的问题。我们将<i id="ebcac51a">为此</i>使用<i id="ebcac51a">COPY_SRC</i> -macro。<p></p>   <h2 id="copy_src-macro">COPY_SRC-宏</h2>   <p id="80c11009">      <i id="a8275444">COPY_SRC</i>宏用输入模型中的节点替换包装的虚拟模板代码段。如果此节点定义了归约规则，则将其还原后再添加到输出模型中。在我们的案例中，我们需要面板将其子<i id="0de15901">元素</i>正确添加为面板的视觉表示中的视觉组件。例如，如果我们的具体<i id="ffe9d66e">Panel</i>转换为<i id="705d68d0">JPanel</i> ，则需要将其两个子<i id="a9dc48db">Label</i>转换为<i id="5b854b18">JLabel，</i>并且需要将这些<i id="bd89dfac">JLabel</i>添加到<i id="0967ee09">JPanel中</i> 。多亏了<i id="6ad57cf9">DemoApp</i>模板中的第二个<i id="ff87a13d">LOOP</i>宏，所有<i id="2753d96f">元素</i>的转换部分都已正确完成，无论它们的嵌套如何。考虑到加法部分仅做一部分。对于嵌套的<i id="531b399e">Elements</i> ，必须是添加它们的<i id="68f04818">Panel</i> 。</p>   <ul class="list _ul"><li class="list__item" id="57cab3a1"><p>打开<i id="5eb3fae3">insert_Panel</i>      </p></li><li class="list__item" id="229271c3"><p>添加代码以将<i id="5b1ec924">null</i>添加到组件</p></li><li class="list__item" id="ae22a9e2"><p>用遍历XML <i id="ca642074">Panel</i> <i id="7e3ed276">内容</i>的<i id="f5afd8e8">LOOP</i>宏包装整个语句（包括;字符）      </p></li></ul>   <p id="7b75f44b">      <i id="4d1fb2a1"></i>   </p>   <p id="22c7cf75">      <br>我们显然不想在面板中添加<i id="4cad069a">null</i> ，是吗？现在，使用<i id="68f051dd">COPY_SRC</i>宏的技巧-我们将添加当前<i id="7a7ee737">节点</i> ，该<i id="7a7ee737">节点</i>是指我们当前使用<i id="c8e13af2">LOOP</i>宏进行迭代的<i id="65722b72">面板的</i> child_ Element_。<i id="113800c7">COPY_SRC</i>宏将在将<i id="e8506ac2">Element</i>添加到组件之前将其转换为swing <i id="1c969cec">组件</i> 。</p>   <p id="3c786b8e">      </p><figure><img alt="屏幕截图2017年6月27日下午12 55 46" title="屏幕截图2017年6月27日下午12 55 46" src="/help/img/idea/2019.2/Screen-Shot-2017-06-27-at-12-55-46-PM.png" id="43542a41" width="578" height="478"></figure>   <p></p>   <p id="e0ce8e7c"> </p>   <aside class="tip sideblock" rel="e0ce8e7c" id="4302183e" data-title="">      <p id="59114873">在处理COPY_SRC宏时，MPS在输出模型中创建输入节点（也称为映射节点）的副本。模板代码中的包装节点将被忽略。</p>      <p id="1107d39d">好吧，这听起来真的很奇怪-我们是否要生成Java代码，其中将XML元素作为参数传递给方法调用？当然，事实并非如此，诀窍在于一代人之间的“复制”并不是那么简单。每当MPS生成器执行将输入节点复制到输出模型时，它都会尝试<b id="06563c6f">缩小</b>此节点（即，找到并应用<b id="058fb4da">归约规则</b> ）。</p>   </aside>   <p id="413b48b9">因此，在被MPS生成器“复制”之后，我们的输入xml元素可以轻松地变成其他东西。现在，我们将定义“其他”内容。</p>   <h2 id="reductionrule">约简规则</h2>   <p id="a100c7ad">归约规则定义了从源语言元素到目标语言元素的转换。例如，我们希望将代表<i id="497073f7">Panel的</i>子<i id="b58d247d">元素的</i> XML <i id="b58d247d">Elements</i>转换为已经由静态工厂方法生成的Java swing组件。在我们的特殊情况下，我们想用对静态方法的调用来代替<i id="60409b08">Panel的</i>子级。幸运的是，要查找的静态方法已保留在<i id="bed50f2b">方法</i> <b id="55596f0c">映射标签中</b> ，因此我们可以轻松掌握正确的方法。</p>   <ul class="list _ul"><li class="list__item" id="d44a19e9"><p>转到demoLang4生成器中的<b id="9649f686">映射配置</b>并创建一个约<i id="9eeb0544">简规则</i> ，该<i id="9eeb0544">规则</i>适用于<i id="d7c6a3e8">Elements</i>      </p></li><li class="list__item" id="b6df9925"><p>应用<i id="4e590cca">意图</i> （ <i id="6c9c0e57">Alt + Enter</i> ）为此规则创建一个新模板</p></li></ul>   <p id="70faf501">      </p><figure><img alt="gdd11" title="gdd11" src="/help/img/idea/2019.2/gdd11.png" id="ed00374a" width="632" height="304"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="8b6fc979"><p>在编辑器中打开“ reduce_Element”模板（ <i id="d6d766e1">按住Ctrl键单击</i>引用）</p></li></ul>   <p id="295adcc8">      </p><figure><img alt="gdd12" title="gdd12" src="/help/img/idea/2019.2/gdd12.png" id="229ec0e4" width="428" height="83"></figure>       <figure><img alt="gdd13" title="gdd13" src="/help/img/idea/2019.2/gdd13.png" id="7d778a48" width="265" height="149"></figure>   <p></p>   <ul class="list _ul"><li class="list__item" id="ca06c994"><p>选择<i id="a7ab5054">ClassConcept</i>作为规则内容节点</p></li><li class="list__item" id="67e17d58"><p>向此类添加静态方法（名称无关紧要）</p></li><li class="list__item" id="57dfda83"><p>创建此方法的调用表达式并使其成为<b id="9a6203a4">模板片段</b> （ <i id="e7596769">Ctrl-Shift + F</i> ）：</p></li></ul>   <p id="c0f01eb1">      </p><figure><img alt="gdd14" title="gdd14" src="/help/img/idea/2019.2/gdd14.png" id="43fee4fa" width="362" height="226"></figure>   <p></p>   <aside class="note " rel="c0f01eb1" id="39d1d352" data-title="">      <p id="5d797ba5">确保仅将方法调用表达式标记为模板片段，而不是整个语句。最右边的';' symbol应该在<b id="63dd17bc">模板片段</b>之外，否则，您将包装一个<i id="5169645e">Statement</i>而不是<i id="cb45693b">MethodCall</i> 。</p>   </aside>   <ul class="list _ul"><li class="list__item" id="2ec73924"><p>在方法调用表达式中为方法名称添加引用宏-我们将从<i id="fa707704">方法</i> <b id="24447f1b">映射标签中</b>检索方法声明：</p></li></ul>   <p id="94a96154">      </p><figure><img alt="gdd15" title="gdd15" src="/help/img/idea/2019.2/gdd15.png" id="f17e8950" width="872" height="381"></figure>   <p></p>   <h2 id="finaltest">最后一个考试</h2>   <p id="7f411885">重建生成器并预览“ test4”模型生成的文本。</p>   <p id="76bc8ec4">      </p><figure><img alt="gdd16" title="gdd16" src="/help/img/idea/2019.2/gdd16.png" id="d882ee03" width="411" height="1053"></figure>   <p></p>   <p id="7f9013b5">这次同时标记了“ Hello”和“ MPS！”已正确添加到内容窗格中。我们就大功告成了！</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-user-guide-demo3.html">发电机用户指南Demo3</a> <a class="navigation-links__next" href="generator-user-guide-demo5.html">发电机用户指南Demo5</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>