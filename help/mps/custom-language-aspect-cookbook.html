<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>自定义语言方面的食谱-帮助|帮助MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Custom+language+aspect+cookbook.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="custom-language-aspect-cookbook.xml" data-toc="Custom+language+aspect+cookbook.html">自定义语言方面的食谱</h1>   <p id="ecf04bd5">除了常见的语言方面（例如<b id="01ec5fe6">Structure</b> ， <b id="d2e7f797">Editor</b> ， <b id="2b2dc41e">Type-system</b>等）外，语言作者还可以创建自定义语言方面（例如，解释器，替代类型系统等），并将其生成到语言运行时中然后使用从代码生成的这些方面。</p>   <aside class="tip sideblock" rel="ecf04bd5" id="c2e07799" data-title="">      <p id="13963878">本文档将使用MPS附带的<b id="9dc08444">customAspect</b>示例来教您如何定义自定义语言方面。自定义方面功能仍在开发中，因此在本文档中可以看到的一些Java东西将逐渐被特定的DSL结构所取代。</p>   </aside>   <p id="80da2e56">什么是自定义方面？</p>   <p id="e9944928">MPS中的语言定义可以看作是<b id="4600bd71">方面</b>的集合：结构，编辑器，类型系统，生成器。每个方面都由相应的<b id="e28e1093">方面子系统</b>使用的声明组成。例如，类型系统<b id="4c708d4e">方面</b>由类型系统<b id="d42d44be">规则</b>组成，并由类型系统<b id="64aa699b">引擎使用</b> 。</p>   <p id="601fc877">语言的每个方面现在都在单独的<b id="08268fa6">方面模型中</b>定义。例如，语言L的编辑器方面是在<i id="dcfcafb0">L.editor</i>模型中定义的。</p>   <p id="54ce8025">每个方面都使用一组<b id="45a8cd91">方面的主要语言进行描述</b> 。例如，有<i id="ec647d33">jmlang.editor</i> <b id="87016a44"> </b>描述编辑器方面的语言。</p>   <p id="16977313">方面模型中的声明可以绑定或可以不绑定到某个概念（例如，该概念的编辑器绑定到一个概念，生成器方面的映射配置不绑定）。</p>   <p id="79e5e856">可以将方面生成为<b id="ae131870">语言的方面运行时</b> ，该<b id="ae131870">运行时</b>表示该方面，即使用该语言时。</p>   <p id="62b01a69">从3.3版开始，MPS允许语言作者为其语言定义新的方面。</p>   <h2 id="developmentcycleofcustomaspects">自定义方面的开发周期</h2>   <ol class="list _decimal"><li class="list__item" id="b2f777b3"><p>创建一种用于描述方面的语言-您可以重用现有的语言或创建特定于方面需求的语言。例如，MPS的每个核心方面都使用自己的语言集，以及一些通用语言，例如<i id="3850d515">BaseLanguage</i>或<i id="d963e568">smodel</i> 。</p></li><li class="list__item" id="24de622c"><p>声明此语言（可能还有其他一些语言）描述了其他语言的某些方面-创建方面描述符</p></li><li class="list__item" id="f028ce57"><p>用创建的语言开发生成器以生成方面的运行时类（如果需要）</p></li><li class="list__item" id="4ca5a4b6"><p>开发使用方面的运行时的方面子系统</p></li></ol>   <p id="e33db3fe">我们将进一步详细介绍每个步骤。</p>   <h2 id="lookaroundthesampleproject">看看示例项目</h2>   <p id="d577ea40">如果打开<b id="7f96c3d2">customAspect</b>示例项目，您将获得五个模块。</p>   <p id="9169da9e">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-04-27-51.png"><img alt="屏幕截图2015年9月10日在04 27 51" title="屏幕截图2015年9月10日在04 27 51" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-04-27-51.png" id="f4348133" width="500" height="474"></a></figure>      <br><i id="5b9c62f7">文档</i>语言及其<i id="63618206">运行时</i>解决方案用于为任何其他语言定义新的<b id="51a6433d">文档方面</b> ， <i id="25b9981b">sampleLanguage</i> <b id="f784c095">利用</b>此新方面-它使用它来文档化其概念。<i id="ee2f5152">沙盒</i>解决方案显示<i id="174b86ef">sampleLanguage</i>的用法，以查看其文档编制能力。<i id="18d4fb57">Aspect</i>子系统由<i id="18d4fb57">pluginSolution</i>表示，该<i id="18d4fb57">插件</i>定义了一个动作，该动作显示了当前关注节点的概念的文档。<p></p>   <aside class="tip sideblock" rel="9169da9e" id="88785dc2" data-title="">      <p id="beb7a490">我们不会在本手册中介绍文档语言概念的创建以及sampleLanguage和沙盒解决方案的创建，因为这些是所有入门级MPS教程所涵盖的核心主题。我们将只关注创建新语言方面的细节。</p>   </aside>   <h2 id="languageruntime">语言运行时</h2>   <p id="d17aacbf">在继续之前，让我们再考虑一下语言方面在运行时如何工作。</p>   <ul class="list _ul"><li class="list__item" id="4eba4eba"><p>对于MPS中的每种语言，都会生成一种语言描述符（该类称为<i id="a5e9eed9">Language.java</i> ）。</p></li><li class="list__item" id="b966e6a2"><p>给定一个<b id="c59ed8a8">方面接口</b> ，语言描述符以该语言返回此方面的<b id="64943d06">具体实现</b> （我们称其为<i id="b5be7a79">AspectDescriptor</i> ）。</p></li><li class="list__item" id="bc86de5d"><p><i id="28a65cd4">AspectDescriptor</i>可以是具有任何方法的任何类，唯一的限制是它应该实现标记接口<i id="43953d7b">ILanguageAspect</i> 。我们建议<i id="1abd6921">AspectDescriptor除此</i>方面描述的实体的吸气剂外，不包含任何代码。</p></li></ul>   <p id="51b0386b">典型的语言运行时如下所示：</p>   <p id="050517ca">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-33-07.png"><img alt="屏幕截图2015年9月10日00 33 07" title="屏幕截图2015年9月10日00 33 07" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-33-07.png" id="84a01cef" width="500" height="206"></a></figure>   <p></p>   <p id="142c2131"><i id="9e759148">createAspect（）</i>方法检查期望方面中声明的接口之一的参数的类型，并返回相应的新实例化的实现。</p>   <p id="03152abf">这是方面中定义的接口的外观（此示例在“ <b id="59c23fb5">意图”</b>方面中定义）：</p>   <p id="ddd4a99b">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-30-32.png"><img alt="屏幕截图2015年9月10日00 30 32" title="屏幕截图2015年9月10日00 30 32" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-30-32.png" id="1fc2537d" width="500" height="130"></a></figure>   <p></p>   <h3 id="usingthelanguageaspects">使用语言方面</h3>   <p id="f16ebf2b">现在，让我们假设我们要使用某些方面。例如，在与编辑器一起工作时，我们想获取一个<b id="a2315e06">意图</b>列表，该列表可以应用于当前选定的节点。</p>   <ol class="list _decimal"><li class="list__item" id="f73c3c65"><p>我们首先找到与导入的语言相对应的所有语言运行时</p></li><li class="list__item" id="37e28b29"><p>然后获取每个目标的意图描述符</p></li><li class="list__item" id="bc78c6d1"><p>最后从描述符中获取所有意图，并检查它们对当前节点的适用性</p></li></ol>   <p id="57b4d3da">总体方案是： <b id="1341d4ab">语言->语言运行时->必需方面->从此方面获得所需的内容</b>   </p>   <p id="85a4c9f1">因此，您的自定义方面需要加入此发现机制，以便调用者可以掌握它。</p>   <h2 id="implementingcustomaspect">实施自定义方面</h2>   <p id="faacd830">让我们详细研究使用<b id="5c6565d8">customAspect</b>示例项目实现自定义方面所需的步骤：</p>   <ol class="list _decimal"><li class="list__item" id="651d2411"><p>为了使MPS将某些特殊模型视为文档方面（这是我们新的自定义方面），应以文档语言创建方面声明。为此，我们使用该语言创建一个插件方面并导入<i id="c512d8ee">customAspect</i>语言。<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-09-at-23-55-58.png"><img alt="屏幕截图2015年9月9日在23 55 58" title="屏幕截图2015年9月9日在23 55 58" src="/help/img/idea/2019.2/Screen-Shot-2015-09-09-at-23-55-58.png" id="d30248f7" width="300" height="339"></a></figure>      <p></p></li><li class="list__item" id="e808f852"><p>在语言的插件模型中创建一个方面声明，并填写其字段。这告诉MPS，该语言可用于为其他语言实现新的自定义方面。<br> </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-01-41.png"><img alt="屏幕截图2015年9月10日00 01 41" title="屏幕截图2015年9月10日00 01 41" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-01-41.png" id="fae3cf94" width="300" height="647"></a></figure>      <p></p></li><li class="list__item" id="f1c2900c"><p>制作/重建文档语言之后，已经可以使用示例语言创建<b id="0d561f91">文档方面并</b>在其中创建文档概念。<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-05-02.png"><img alt="屏幕截图2015年9月10日00 05 02" title="屏幕截图2015年9月10日00 05 02" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-05-02.png" id="49804113" width="300" height="320"></a></figure>      <p></p></li><li class="list__item" id="7219e004">         <figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-09-41.png"><img alt="屏幕截图2015年9月10日00 09 41" title="屏幕截图2015年9月10日00 09 41" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-09-41.png" id="1c86116b" width="300" height="365"></a></figure>      </li><li class="list__item" id="b7ba94b0"><p>现在，我们应该转到语言运行时，以便指定新方面的功能，因为它应该在MPS中工作。在我们的示例中，让我们创建一个界面，该界面将能够检索和返回所选概念的文档。为此，我们创建一个运行时解决方案，将其添加为<i id="9357eb59">文档</i>语言的运行时模块，并在其中创建<b id="9eeeaf13">接口</b> 。请注意，运行时类必须实现<i id="a7f97613">ILanguageAspect</i>接口。为了满足我们的需求，该方法必须将<i id="4c466cc2">概念</i>作为参数，并返回带有相应文档文本的<i id="c0513ac8">字符串</i> 。<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-17-23.png"><img alt="屏幕截图2015年9月10日00 17 23" title="屏幕截图2015年9月10日00 17 23" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-00-17-23.png" id="f48528b5" width="300" height="154"></a></figure>      <p></p></li><li class="list__item" id="52ed3f1a"><p>在<i id="2f0e634a">文档</i>语言的生成器中，我们现在需要从上面生成的接口实现一个实现。<b id="2a071323">有条件的根规则</b>和以下<b id="781d1fc3">模板</b>将完成此操作并生成文档描述符类：<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-10-27-at-17-57-32.png"><img alt="屏幕截图2015年10月27日的17 57 32" title="屏幕截图2015年10月27日的17 57 32" src="/help/img/idea/2019.2/Screen-Shot-2015-10-27-at-17-57-32.png" id="c9c503e9" width="300" height="425"></a></figure>         <br>该条件确保该规则仅触发您自定义方面的模型，即在我们的案例中，该模型保存文档定义（ <i id="2a286a10">jetbrains.mps.samples.customAspect.sampleLanguage.documentation</i> ）。<br>这里有用的功能是<b id="f207f78f">概念开关</b>构造，它使您可以忽略概念实现细节。它仅循环浏览所有已记录的概念（ <b id="f5e2c50f">LOOP</b>宏），并为每个此类概念创建一个匹配的大小写（恰好是-> $ [ConceptDocumentation]），该情况返回从关联的<i id="c536a7c3">ConceptDocumentation</i>获得的字符串值。<p></p></li><li class="list__item" id="03c56ab1"><p>因此，我们有一个接口和一个实现类。现在，我们需要将它们绑在一起-我们必须生成<i id="1b404137">LanguageRuntime</i>类的一部分，该部分将实例化我们的概念，即，无论何时需要<b id="b43137a4">文档方面</b> ，它都将返回<i id="99689fb0">DocumentationDescriptor</i>类。要了解以下内容的工作方式，请查看类<i id="04693ddd">Language.java</i>的生成方式（请参阅模型<i id="f2af99b8">jmlang.descriptor.generator.template.main中的</i> Language类）。描述符实例化是通过名为<i id="8ccab40a">InstantiateAspectDescriptor</i>的模板开关完成的，我们必须使用新的方面语言对其进行扩展，以便它可以与其他方面模型一起使用：<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-10-27-at-18-00-22.png"><img alt="屏幕截图2015 10 27 at 18 00 22" title="屏幕截图2015 10 27 at 18 00 22" src="/help/img/idea/2019.2/Screen-Shot-2015-10-27-at-18-00-22.png" id="537342ed" width="300" height="337"></a></figure>         <br>从本质上讲，我们增加了<i id="fbea87e5">DocumentationAspectDescriptor</i>接口生成的<i id="2f3647da">语言</i>类的检查，并返回<i id="b8f420e3">DocumentationDescriptor</i>的新鲜例如，如果要求<i id="4e1129a8">aspectClass</i>是我们自定义的方面接口。<p></p></li><li class="list__item" id="0436a2bc"><p>剩下的唯一事情就是使用我们的新方面。为此，需要创建一个动作，该动作将显示有关按需游标下的节点概念的文档：<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/clx202.png"><img alt="clx202" title="clx202" src="/help/img/idea/2019.2/clx202.png" id="583f67ac" width="300" height="1502"></a></figure>         <br>         <br>的<i id="2a2e23af"></i>必须导入模型，以便能够指定上下文参数。该动作必须作为（新创建的）插件解决方案（在<a href="plugin.html">Plugin</a>上的插件解决方案更多）的一部分创建，并带有一个<i id="9bcf9d14">StandalonePluginDescriptor，</i>并通过<i id="49d60242">ActionGroupDeclaration</i>挂接到菜单中：<br>         <figure><a class="lightbox" href="/help/img/idea/2019.2/clx201.png"><img alt="clx201" title="clx201" src="/help/img/idea/2019.2/clx201.png" id="1394f9c9" width="300" height="160"></a></figure>      <p></p></li><li class="list__item" id="8d8ee3d2"><p>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/clx200.png"><img alt="clx200" title="clx200" src="/help/img/idea/2019.2/clx200.png" id="dfc892ea" width="300" height="426"></a></figure>         <br>这样，IDE <b id="3473ba13">代码</b>菜单将得到增强。<br>         <i id="e33da32c"> </i>      <p></p></li><li class="list__item" id="de29ae21"><p>现在让我们尝试一下！重建项目，在<b id="50d1121d">沙盒</b>解决方案中创建或打开<i id="6f684f7c">DocumentedConcept</i>概念的节点，然后从“ <b id="68b92af1">代码”</b>菜单调用“ <b id="4b2afda4">显示文档”</b>操作：<br>         </p><figure><a class="lightbox" href="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-04-22-19.png"><img alt="屏幕截图2015年9月10日在04 22 19" title="屏幕截图2015年9月10日在04 22 19" src="/help/img/idea/2019.2/Screen-Shot-2015-09-10-at-04-22-19.png" id="11efe133" width="300" height="686"></a></figure>      <p></p></li></ol><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="building-an-interpreter-cookbook.html">构建解释器食谱</a> <a class="navigation-links__next" href="custom-persistence-cookbook.html">自定义持久性食谱</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>