<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>TextGen-帮助| MPS</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="TextGen.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="textgen.xml" data-toc="TextGen.html">TextGen</h1>   <h2 id="textgenlanguageaspect">TextGen语言方面</h2>   <h3 id="introduction">介绍</h3>   <p id="e48b1c73"><i id="0ec81d84">TextGen</i>语言方面定义了文本转换的模型。每当您需要将模型直接转换为文本形式时，它都会派上用场。该语言包含用于打印文本，将节点转换为文本值并为输出提供合理布局的结构。</p>   <h3 id="operations">运作方式</h3>   <p id="89259f38"><i id="0dc5c52b">append</i>命令执行转换并将结果文本添加到输出中。您可以使用<i id="23e9140b">发现的错误</i>命令来报告模型中的问题。<i id="07901eb7">with indent</i>命令用增加的缩进来划分块。可选地， <i id="238fdae5">增加深度</i>和<i id="3a6fdf6b">减小深度</i>命令操纵当前压痕深度而不限于块结构。<i id="53462345">缩进缓冲区</i>命令为当前行应用当前缩进（由<i id="0583e5ae">ident</i>或<i id="43137785">增加/减小深度指定</i> ）。</p>   <div class="table-wrapper"><table width="100%" id="a720c2f2"><thead><tr id="58572b49" class="ijRowHead"><th id="e7ebe2c1">            <p id="1a213530">运作方式</p>         </th><th id="287058f2">            <p id="3f431e78">争论</p>         </th></tr></thead><tbody><tr id="e5dba283" class="ijRowOdd"><td id="cdd37fca">            <p id="0cded8a5">               <b id="30a3825d">附加</b>            </p>         </td><td id="6a10249d">            <p id="6c3c1c29">任何数量的：</p>            <ul class="list _ul"><li class="list__item" id="2eed7457"><p>                  <b id="c0b6b441">{string value}</b> ， <i id="a39f888a">要插入，请使用“ char，或从完成菜单中选择常量</i>               </p></li><li class="list__item" id="29a5b1c3">                  <b id="9eca0877">\ n</b>               </li><li class="list__item" id="583648c6"><p>                  <b id="492caa11">$ list {node.list}</b> -不带分隔符的列表</p></li><li class="list__item" id="a677a76d"><p>                  <b id="610fc7ab">$ list {node.list with，}</b> -带分隔符（可以添加/删除分隔符）</p></li><li class="list__item" id="4b4f6d8a"><p>                  <b id="db45fff0">$ ref {node.reference}</b> ，例如<i id="7354c5e7">$ ref {node.reference <target>}-已过时，将被删除</target></i>               </p></li><li class="list__item" id="06b157cf">                  <b id="6a62307f">$ {node.child}</b>               </li><li class="list__item" id="1e918a2c"><p>                  <b id="fb528a13">$ {attributed node} $</b> -在属性节点中可用，委托给该属性节点</p></li></ul>         </td></tr><tr id="6ea73467" class="ijRowEven"><td id="6cd815e0">            <p id="c9b77d19">               <b id="d5b11d62">发现错误</b>            </p>         </td><td id="b8f12fbe">            <p id="b32161e1">错误文字</p>         </td></tr><tr id="943a79a8" class="ijRowOdd"><td id="9da64a82">            <p id="d00360ed">               <b id="3f65a838">减少深度</b>            </p>         </td><td id="b3533a8f">            <p id="c4ec2e79">从现在开始降低缩进级别</p>         </td></tr><tr id="542e2a28" class="ijRowEven"><td id="2fcfd285">            <p id="22f7c2b2">               <b id="4efc81d0">增加深度</b>            </p>         </td><td id="89877d8f">            <p id="364f7e63">从现在开始增加缩进级别</p>         </td></tr><tr id="ace7195a" class="ijRowOdd"><td id="aa5de3ed">            <p id="1d003e60">               <b id="94c99576">缩进缓冲区</b>            </p>         </td><td id="f57abb5b">            <p id="b2b0ae7c">将缩进应用于当前行</p>         </td></tr><tr id="997564a5" class="ijRowEven"><td id="3b6c29e9">            <p id="dfcae5aa">               <b id="ae9c850b">缩进{ <code>}</code></b>            </p>         </td><td id="d427cc51">            <p id="2ffd7c02">增加压痕等级<code></code></p>         </td></tr></tbody></table></div>   <aside class="tip sideblock" rel="a720c2f2" id="9c55491f" data-title="">      <p id="ab1fe5dc"><b id="42f13c4c">append</b>命令的参数可以在<b id="0403073a">Inspector工具窗口</b>中将<i id="84fefb89">with indent</i>标志设置为<i id="6a3c8e1f">true</i> ，以在当前缩进缓冲区之前添加前缀。</p>   </aside>   <h3 id="indentation">缩进</h3>   <p id="9d53dc5a">一旦了解了基本原理，就很容易正确缩进。<i id="c9a9b2b7">TextGen</i>将AST刷新为文本。<i id="dcef5965">TextGen</i>命令简单地顺序操作输出缓冲区并向其输出一些文本，一次输出一个节点。每个根概念都会保留一个保存当前缩进深度的变量（ <b id="a9012a77">缩进缓冲区</b> ）。<b id="4cb63638">缩进缓冲区</b>从零开始，并通过<b id="2519c30d">增加/减小深度</b>以及<b id="00b57b50">使用缩进</b>命令进行更改。</p>   <p id="cd17b0ea">但是，必须通过<b id="8f90b3b1">append</b>命令将“缩进”显式插入到输出流中。简单地<b id="746f44ce">用缩进</b>标记块将不会自动缩回由包装的TextGen代码生成的文本。<b id="93e5d4cd">with indent</b>块仅增加了<b id="495bccd2">缩进缓冲区</b>的值，但是各个<b id="31651506">附加项</b>可能会或可能不希望以当前大小的<b id="bc0e2169">缩进缓冲区</b>开头。</p>   <p id="8fcc1069">有两种方法可以将<b id="2ac62fba">缩进缓冲区</b>显式插入输出流：</p>   <ul class="list _ul"><li class="list__item" id="19b1094c"><p>         <b id="6a617b32">缩进缓冲区</b>命令</p></li><li class="list__item" id="b3e681e6"><p>         在检查器中<b id="5e6b0271">带有</b>用于<b id="d10995cb">添加</b>命令参数的<b id="5e6b0271">缩进</b>标志</p></li></ul>   <p id="97692183">例如，要正确缩进<b id="406311b5">常量</b>列表中的常量，我们在每条发出的行的开头调用<b id="04e3d778">缩进缓冲区</b> 。这样可以确保仅在每行的开头插入缩进。</p>   <div class="code-block" data-lang="none">用于概念常量的文本生成组件常量{文件名：常量扩展名： <no extension="">编码：utf-8（上下文，缓冲区，节点）-> void {追加$ {node.name} \ n；用缩进{node.constants.forEach（{〜constant =>缩进缓冲区；附加$ {constant.name} {=} $ {constant.initializer} \ n;}）; }}}</no></div>   <p id="049e13d6">另外，我们可以在检查器中为<b id="bded0956">附加</b>命令的第一个参数指定<b id="b63614bb">with indent</b>标志。这也将仅在每行的开头插入缩进。</p>   <p id="93ae3335">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/TextGen1.png"><img alt="TextGen1" title="TextGen1" src="/help/img/idea/2019.2/TextGen1.png" id="db24718c" width="800" height="804"></a></figure>   <p></p>   <h3 id="rootconcepts">根概念</h3>   <p id="dcafa2eb">TextGen提供了两种类型的根概念：</p>   <ul class="list _ul"><li class="list__item" id="4b05c97b"><p>         由<i id="b4737e39">ConceptTextGenDeclaration</i>概念表示的<b id="fe065266">text gen组件</b> ， <i id="b4737e39">它将</i>概念转换为文本编码。对于可<b id="2eb3ff1e">植根的</b>概念，也可以指定目标文件。</p></li><li class="list__item" id="4e5b2250"><p>         <b id="6c170faf">基本文本生成组件</b> ，由<i id="29a8e42e">LanguageTextGenDeclaration</i>概念表示，它允许定义可重用的文本生成操作和实用程序方法。可以从相同语言的其他text gen组件以及扩展语言中调用这些</p></li></ul>   <h3 id="textgeninextendedconcepts">扩展概念中的TextGen</h3>   <p id="ec2365ee">MPS不会自动为根概念创建文件。即使定义了TextGen的概念的子概念也不会自动创建文件。仅考虑精确的概念匹配。如果扩展概念希望按原样重用祖先的textgen组件，则它应声明其自己的<b id="53fe82fc">空</b> TextGen组件，将要点声明为文件名，编码和扩展名，并将该组件的主体保留为空。</p>   <h3 id="layout">布局</h3>   <p id="caef7b90">有临时机制可以控制输出文件的布局。<i id="3c2235a9">ConceptTextGenDeclaration</i>的<b id="4674a99e">文本布局</b>部分（仅在可<b id="ddf13878">植根的</b>概念中可用）允许作者定义多个逻辑部分（默认情况下为逻辑部分），然后可以选择为每个<b id="2740ca0c">append</b>指定将文本<b id="2740ca0c">附加</b>到哪个部分。</p>   <p id="099a8be1">并非总是能够以与物理文件中的行相对应的顺序生成文本。例如，对于一个Java源代码，我们可以区分两个不同的区域，如<b id="da481f33">进口</b>和<b id="b0d5d313">类主体</b> ，在<b id="c2bcca1f">进口</b>与<b id="95e4a4f4">身体</b>一起居住。一个热情的语言设计人员可能希望进一步分解文件，例如分解为<b id="a53baacc">文件注释</b> ， <b id="33a999f5">包声明</b> ， <b id="3489773d">导入</b>和由<b id="39114cca">字段</b>和<b id="deb91377">方法</b>组成的<b id="8ec8611d">类主体</b> ，并在遍历<i id="93e970eb">ClassConcept时</i>独立地填充每个文件。这就是我们所说的输出文件的<i id="b84f47a3">布局</i> ，这就是我们现在所控制的东西。MPS经验丰富的人可能已经知道TextGen多年来可用的两个缓冲区（ <i id="31fbbfaa">TOP</i>和<i id="4ad895ef">BOTTOM</i> ）。这些是预定义的硬编码值。现在由语言设计师来指定输出文件的区域及其顺序。</p>   <p id="0336c413">注意，特别是从属性生成文本时，不同的区域会很方便，因为它们会改变执行顺序。使用它们，确保文本生成的流与物理文本行相对应更加棘手，指定区域使生成更加舒适。</p>   <p id="c44acdae">可以为生成文本的头文字生成指定文件的布局。</p>   <p id="bda72fc6">该机制的支持是初步的，现在还很初级。我们在<i id="e97d5e0a">BaseLanguage</i>实现中利用了它，因此此通知是为了向您说明发生了什么，而不是鼓励您将其投入生产。</p>         <br>      <p id="3cad2edc">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/tgp1.png"><img alt="tgp1" title="tgp1" src="/help/img/idea/2019.2/tgp1.png" id="bdc06445" width="700" height="1260"></a></figure>   <p></p>   <h3 id="contextobjects">上下文对象</h3>   <p id="490aaf02">对于某些模型到文本的转换方案，至关重要的是在TextGen期间保留一些上下文信息。例如，在BaseLanguage中，TextGen必须跟踪模型导入和合格的类名称。以前版本基于直接文本缓冲区操作的繁琐和低级方法已被替换为可以定义和使用自定义对象作为该概念的textgen规范的一部分。</p>   <p id="f56223e8">      </p><figure><a class="lightbox" href="/help/img/idea/2019.2/ContextObject1.png"><img alt="ContextObject1" title="ContextObject1" src="/help/img/idea/2019.2/ContextObject1.png" id="110b37d5" width="500" height="1202"></a></figure>   <p></p>   <p id="966baf88">目前，支持将常规Java类（带有采用概念实例的无参数或单参数构造函数）作为上下文对象。您可以将代码中的上下文对象作为常规变量进行引用。</p>   <h3 id="handlingattributesintextgen">在TextGen中处理属性</h3>   <p id="a13414c4">用<b id="214594a1">Attributes</b>注释节点时，将<i id="95cbbbaf">首先</i>处理这些属性的<i id="95cbbbaf">TexGen</i> 。然后，属性的TextGen中的<i id="6f9c4e42">$ {attributed node}</i>构造将插入属性节点本身的TextGen。<br>如果单个节点上有多个属性，则从最后分配的（最顶部）属性开始依次处理它们。没有关联TextGen的属性将被忽略和跳过。</p>   <aside class="tip sideblock" rel="a13414c4" id="9835d16c" data-title="">      <p id="dc8c026c">从技术上讲，最高的属性是容器中的最后一个属性（编辑器描述属性的方式在<b id="6c736c0b"><i id="146fde3e">视觉上</i></b>与<b id="f7bc896d">节点浏览器中</b>可能注意到的顺序不同）。即在编辑器中具有属性A1和A2的节点看起来像A2（A1（N）），并且TextGen首先处理A2，然后处理A1，然后处理N。当要求TextGen生成N的文本时，它将在文本生成器中查找最后一个属性。定义了textgen的容器（如果有），并委托它。假设A2具有TextGen，而A1没有。然后，如果属性的组件具有$ {attributedNode}，则TextGen将检查先前的属性以获取关联的textgen。如果不存在（并且在我们的示例A1中也不存在），则实际节点N的文本生成将是最后一个接收控制的文本。</p>   </aside>   <h3 id="examples">例子</h3>   <p id="caf3e18a">这是<i id="7b554e6c">ForeachStatement</i> （jetbrains.mps.baseLanguage）的<b id="4104df6b">文本生成</b>组件的<i id="7b554e6c">示例</i> 。</p>   <div class="code-block" data-lang="none">用于概念ForeachStatement {（节点，上下文，缓冲区）-> void {如果（node.loopLabel！= null）{附加\ n $ {node.loopLabel.name} {：}; } if if（node.label！= null）{附加\ n $ {node.label} {：}； }附加\ n;缩进缓冲区;追加{for（} $ {node.variable} {：} $ {node.iterable} {）{};用缩进{append $ {node.body}； }附加\ n {}}; }}</div>   <p id="0711fbec">这是<b id="ee3bc164">text gen</b>的人工示例：</p>   <div class="code-block" data-lang="none">概念CodeBlockConcept {（节点，上下文，缓冲区）-> void {缩进缓冲区；附加{codeBlock {} \ n;缩进{indent buffer;追加{// codeBlock的开始} \ n;缩进缓冲区;追加{int i = 0} \ n;缩进缓冲区;追加{// codeBlock的结尾} \ n; }附加{}}； }}</div>   <p id="c6ade42b">产生以下代码块，其中包含多行带有缩进的行：</p>   <div class="code-block" data-lang="none">概念CodeBlockConcept的文本生成组件{codeBlock {// codeBlock的开头int i = 0 // // codeBlock的结尾}</div>   <p id="a1fbfafd">用于属性的<b id="9705b9af">TextGen</b>的示例，该示例向属性节点的输出添加了额外的文本：</p>   <p id="d0c83e6f">      </p><figure><img alt="MethodDocCommentAttribute" title="MethodDocCommentAttribute" src="/help/img/idea/2019.2/MethodDocCommentAttribute.png" id="fb48a649" width="407" height="165"></figure>   <p></p>   <p id="9f400d63"> </p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-demos.html">发电机演示</a> <a class="navigation-links__next" href="migrations.html">迁移</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>