<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>生成器算法-帮助MPS</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="The+Generator+Algorithm.html"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索MPS帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>MPS 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default" data-group="primary" selected>默认</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_mac_os_x" data-group="primary">Eclipse（Mac OS X）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_jbuilder" data-group="primary">JBuilder的</option><option value="primary_mac_os_x" data-group="primary">Mac OS X</option><option value="primary_mac_os_x_10.5_" data-group="primary">Mac OS X 10.5以上</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_default" data-group="secondary">默认</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_mac_os_x" data-group="secondary">Eclipse（Mac OS X）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_jbuilder" data-group="secondary">JBuilder的</option><option value="secondary_mac_os_x" data-group="secondary">Mac OS X</option><option value="secondary_mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5以上</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="the-generator-algorithm.xml" data-toc="The+Generator+Algorithm.html">生成器算法</h1>   <h2 id="thegeneratoralgorithm">生成器算法</h2>   <p id="2364083d">根据输入模型生成目标资产的过程（生成会话）包括5个阶段：</p>   <ul class="list _ul"><li class="list__item" id="a274b990"><p>定义必须涉及的所有生成器</p></li><li class="list__item" id="5cbb2dc3"><p>定义转换的优先顺序</p></li><li class="list__item" id="d05ae08c"><p>逐步模型转换</p></li><li class="list__item" id="95c12b66"><p>生成文本并将其保存到文件（针对输出模型中的每个根）</p></li><li class="list__item" id="0a7c1ea9"><p>后处理资产：编译等</p></li></ul>   <p id="25d7d1cb">我们将详细讨论此过程的前三个阶段。</p>   <h3 id="definingthegeneratorsinvolved">定义涉及的生成器</h3>   <p id="0e104e0f">为了定义所需的生成器，MPS会检查输入模型并确定其中使用了哪种语言。这样做MPS不会利用模型属性对话框中指定的“使用的语言”。相反，MPS会检查模型中的每个节点并收集实际使用的语言。</p>   <p id="39b29a0b">MPS从每种“使用的语言”中获取其生成器模块。如果一种语言中有多个生成器模块，则MPS选择第一个（在当前版本的MPS中不完全支持同一语言的多个生成器）。如果此列表中的任何生成器都依赖于其他生成器（如“取决于生成器”属性中所指定），则这些生成器也将添加到列表中。</p>   <p id="df2edd85">MPS获得生成器的初始列表后，它将开始扫描生成器的模板，以确定在中间（瞬态）模型中将使用哪种语言。以这种方式检测到的语言的处理方式与原始输入模型中使用的语言相同。重复此过程，直到无法检测到更多的“二手语言”。</p>   <h4 id="explicitengagement">明确参与</h4>   <p id="14487277">在极少数情况下，MPS无法检测到其生成器必须参与模型转换的语言。如果在输入模型或其他（检测到的）语言的模板代码中未使用该语言，则可能会发生这种情况。在这种情况下，您可以通过输入模型的属性对话框（“ <i id="cf825f85">高级”</i>选项卡）中的“生成时使用的<i id="21a47fb3">语言”</i>部分来显式指定生成器参与度。</p>   <h3 id="dependencyscope/kind-'generationtarget'and'design'.">依赖范围/种类-“生成目标”和“设计”。</h3>   <p id="68557b3a">当需要指定L2的生成器生成到L1并因此需要其运行时依赖关系时，“生成目标”将替换两种语言之间的“扩展”关系（L2扩展了L1）。现在，当一种语言（L2）被翻译成另一种语言（L1），并且L1具有运行时依赖性时，请使用L1作为L2的“生成目标”。尽管这种方法比“扩展”要好得多，但它仍然不是完美的，因为它是生成器而不是语言的属性。一旦生成器完全独立于其语言后，我们可能需要修复此方法（不同的生成器可能针对不同的语言，因此必须为生成器而不是源语言指定目标）。</p>   <p id="f3626b5a">“设计”依赖性取代了两个生成器之间的“扩展”。需要引用其他生成器以指定优先级规则时使用它（尽管考虑是否确实需要这些优先级，请参阅下面的生成器计划中的更改）</p>      <h3 id="definingtheorderofpriorities">定义优先顺序</h3>   <p id="34f5a23f">如前所述，生成器模块包含生成器模型，而生成器模型包含映射配置。映射配置（简称<b id="db8c9668">映射</b> ）是一组生成器规则。通常要求必须在某些其他映射之前（或不晚于其他映射，或与其一起）应用某些映射。语言开发人员通过生成器属性对话框中的映射约束来指定映射之间的这种关系。</p>   <p id="a69ce465">MPS构建了所涉及的生成器列表之后，它将根据指定的映射优先级将所有映射分为几组。没有为其指定优先级的所有映射都属于最后一个（最低优先级）组。</p>   <aside class="tip sideblock" rel="a69ce465" id="85dd4e05" data-title="">      <p id="f6ae1296">您可以通过在模型的弹出菜单中选择“ <i id="c472e2c8">显示生成计划”</i>操作来检查任何（输入）模型的映射分区。<br>分区结果将显示在MPS输出视图中。</p>   </aside>   <h3 id="optimizedgenerationplan">优化的发电计划</h3>   <p id="e1de94e2">在计划生成阶段时，MPS倾向于保持每个生成器尽可能的孤独。最终，您会看到许多相对较小且快速的生成步骤。当然，被迫与优先级规则一起运行的生成器仍在同一步骤中运行。在同一生成步骤（3.2之前的MPS）处理多个不相关的生成器效率低下，因为它对同一步骤中其他生成器的规则适用性强加了许多不必要的检查。使用3.2和更高版本中的就地转换时，每个额外生成步骤的性能损失可以忽略不计。</p>   <h3 id="ignoredpriorityrules">忽略优先级规则</h3>   <p id="cc633727">除了优先级冲突外，在生成计划期间还有一些规则会被忽略。如果输入模型没有任何语言参与优先级规则的概念，则可能会发生这种情况。由于没有实际使用语言，因此该规则将被忽略，“显示生成计划”操作将报告这些规则以及冲突的规则。以前的MPS版本曾经将其他未使用的语言的生成器包括在生成过程中，现在这些生成器没有机会参与进来。</p>   <h3 id="implicitpriorities">隐式优先</h3>   <p id="423251bc">目标语言（由模板产生的语言）被视为隐式“不迟于”规则。您无需手动指定这些优先级。MPS会自动以源语言和目标语言为所有<b id="3b126fb4">生成器模型</b>插入“不迟于”规则。重要的是要了解优先级规则在<b id="a40dda9e">模型</b>粒度级别上起作用。</p>   <aside class="tip sideblock" rel="423251bc" id="176823cf" data-title="">      <p id="86c3affd">如果为这两个模型定义了显式优先级规则，则这两个<b id="bb9eaac3">生成器模型</b>之间的隐式优先级规则将被忽略，一个显式优先级规则是从生成另一种语言的语言生成的，另一种是从另一种语言生成的语言。</p>   </aside>   <h3 id="modeltransformation">模型转换</h3>   <p id="a979b711">每组映射均在单独的<b id="50fecb87">生成步骤中应用</b> 。整个生成会话包括与映射分区期间形成的映射组一样多的生成步骤。生成步骤包括三个阶段：</p>   <ul class="list _ul"><li class="list__item" id="b2c6c630"><p>执行预映射脚本</p></li><li class="list__item" id="f82726b6"><p>基于模板的模型转换</p></li><li class="list__item" id="a89806c5"><p>执行映射后脚本</p></li></ul>   <p id="5c3472bd">基于模板的模型转换阶段包括一个或多个微步骤。微步是将输入模型转换为瞬态（输出）模型的单遍模型转换。</p>   <p id="3139f96e">在执行微步MPS时，遵循以下过程：</p>   <ol class="list _decimal"><li class="list__item" id="fd227a80"><p>应用条件根规则（仅一次-在第一个微步上）</p></li><li class="list__item" id="aad16b35"><p>应用根映射规则</p></li><li class="list__item" id="5d35f4d6"><p>复制未指定显式根映射的输入根（可以通过根映射规则中的“保留输入根”选项和“放弃根”规则来覆盖）</p></li><li class="list__item" id="0e105a14"><p>应用编织规则</p></li><li class="list__item" id="fdaef61b"><p>应用延迟的映射（来自MAP_SRC宏）</p></li><li class="list__item" id="8cbdb6e9"><p>重新验证输出模型中的引用（此处执行所有引用宏）</p></li></ol>   <p id="f5de13de">没有适用缩减规则和模式规则的单独阶段。相反，每次MPS将输入节点复制到输出模型中时，它都会尝试找到适用的归约（或模式）规则。MPS在复制根节点或执行COPY_SRC宏时执行节点复制。因此，减少可以发生在模型转换的任何阶段。</p>   <p id="ff94bfe3">MPS对生成步骤中的所有微步骤使用相同的规则集（映射组）。在完成一个微步骤并在执行过程中进行了一些转换之后，MPS将启动下一个微步骤，并将上一个微步骤的输出模型作为输入传递到下一个微步骤。如果在最后一个微步骤的执行过程中没有发生任何转换，即当当前规则集中没有更多适用于当前输入模型中的节点的规则时，则认为整个生成步骤已完成。</p>   <p id="85ab7379">下一代步骤（如果有）将接收上一步的输出模型作为输入。</p>   <aside class="tip sideblock" rel="85ab7379" id="a2178ead" data-title="">      <p id="0d31e1d6">作为生成步骤和微步骤的输出/输入的中间模型（瞬态模型）通常在完成向下一个模型的转换后立即销毁。<br>要保留瞬态模型，请启用以下选项：<br>          <i id="dfcc835f">设置</i> -> <i id="5683ae99">发电机设置</i> -> <b id="28d1d2e7">保存瞬态模型</b>      </p>      <p id="f88d22db">也可以看看：</p>      <ul class="list _ul"><li class="list__item" id="c5412526">            <a href="generator-user-guide-demo6.html#savingtransientmodels">保存瞬态模型</a>         </li><li class="list__item" id="078dfb1c">            <a href="generator-user-guide-demo6.html#usinggenerationtracertool">使用Generation Tracer工具</a>         </li></ul>   </aside>   <h3 id="handlingofnodeattributesduringgeneration">生成过程中节点属性的处理</h3>   <p id="5ad0d798">节点属性构成通用的扩展机制，因此Generator在转换过程中应保留属性（除非属性设计者选择不保留它们），而无需任何模板的明确支持。将输入节点转换为另一个节点时，Generator将输入节点的属性复制到输出。复制仅受新引入的<b id="d595fcd2">放置属性规则</b>控制，并且无论<b id="85d1c521">@attribute信息</b>规范如何（例如，其<b id="65199d87">属性概念</b>或<b id="280c17b7">多个</b>限制）都可以进行复制。不考虑转换规则可能已经产生属性节点本身的事实（即，如果简化规则将节点属性显式复制到新创建的输出节点，则由于属性的自动复制，属性将被复制。但是，减少规则很少会复制节点属性，而且如果出现此问题，则可以使用删除规则轻松解决该问题）。</p>   <p id="c79d2cf9">在复制节点的属性时，Generator会参考<b id="2e49263d">放置属性规则</b> （在MPS 3.3中新引入，位于<b id="6fdfb760">放弃的根规则</b>旁边），以查看语言设计者是否不需要这些属性来生存转换过程。此规则与<b id="993ddc2e">放弃根规则</b>非常相似-触发任何规则时，不会将属性复制到输出模型中。</p>   <p id="716637b1">随着属性的采用和复杂性的增加，我们使生成器可以使用常规模板处理规则来转换属性内容：</p>   <ul class="list _ul"><li class="list__item" id="360f6cd9"><p>对同一模型中节点的引用将更新为指向输出模型中的各个节点</p></li><li class="list__item" id="9d38883a"><p>应用约简规则以变换属性节点的子级。</p></li></ul>   <h3 id="in-placetransformation">就地转换</h3>   <p id="5116151a">模型中使用的语言生成器将顺序应用（也称为“ <i id="b968ab08">生成计划”</i> ）。实际上，每个生成步骤仅修改原始模型的一部分，而其余模型则按原样复制。凭借庞大的模型和众多的生成步骤，这种方法被证明是无效的。就地转换尝试使用众所周知的“增量”方法解决此问题，该方法仅收集更改并将其应用于原始模型以就地进行更改。</p>   <p id="dac4d166">在3.1版中，就地转换是一个选项，默认情况下启用，并且可以通过<i id="d161d624">Project settings-> Generator进行配置</i> 。鼓励客户修复在就地模式下失败的模板，因为就地生成可能会成为后来的唯一生成模式。</p>   <p id="6b1e85b4">使用就地转换会带来某些限制，甚至可能破坏以前的MPS版本中使用的模式：</p>   <ul class="list _ul"><li class="list__item" id="3691a2d3"><p>最值得注意和最重要的-执行规则的查询/条件时没有输出模型。在转换过程中查询输出模型是一个坏习惯，而就地转换会强制删除它。从转换规则访问输出模型意味着一定的执行顺序，从而有效地限制了MPS生成器可应用的优化集。具有“完整输入模型”和“处于某种不确定状态的输出模型”的转换规则具有<i id="9041aed5">完整的</i>输入和该特定规则负责的输出的一<i id="b738c963">小部分</i> ，其合同更为严格。</p></li><li class="list__item" id="57eb25ac"><p>确实存在用于编织规则的输出模型，因为它们的目的是处理输出节点。</p></li><li class="list__item" id="4861be04"><p>增量构建的过程要求生成器知道要添加到模型中的节点。因此，在启用就地生成的情况下，以前工作的输出模型中的任何<i id="7019b14a">隐式</i>更改都将失败。例如，考虑具有后处理功能的<b id="da95203b"><i id="c772994f">MAP-SRC</i></b> ，该功能将节点替换为新节点： <code class="code">postprocess: if (node.someCondition()) node.replace with new(AnotherNode);</code> 。生成器记录由MAP-SRC生成的新节点，安排它的添加时间，并延迟后处理。一旦后处理结束，生成器将无法确定其跟踪的节点，因为“添加到输出模型”不再有效，而应该使用另一个节点。当然，后期处理可以安全地更改由<b id="97e14cac"><i id="0f69de43">MAP-SRC</i></b>生成的节点下方的任何内容，但是尝试从节点的沙箱中退出会导致错误。</p></li><li class="list__item" id="119a89ee"><p>主动编织规则的存在会阻止就地转换，因为这些规则需要输入和输出模型。</p></li></ul>   <h3 id="generationtrace">世代痕迹</h3>   <p id="189ab094">就像就地转换一样，更新后的生成跟踪仅受跟踪实际更改的想法启发。现在，它的要求已大大降低，因为仅跟踪转换后的节点。此外，还有各种演示选项可用于提供有关转换过程的不同观点。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月30日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="generator-language.html">生成器语言</a> <a class="navigation-links__next" href="mapping-priorities.html">映射优先级</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>