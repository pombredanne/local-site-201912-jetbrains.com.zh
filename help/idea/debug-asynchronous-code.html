<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Debug asynchronous code - Help | IntelliJ IDEA</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Debug_asynchronous_code" data-breadcrumbs="Building, running, testing and deploying applications/Debugging_Code.xml|Debugging/Debug_asynchronous_code.xml|Debug asynchronous code" data-main-title="Debug asynchronous code"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search IntelliJ IDEA Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>IntelliJ IDEA 2019.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default_for_windows" selected>Default for Windows</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_sublime_text">Sublime Text</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_macos">macOS</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_macos">Eclipse (macOS)</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_intellij_idea_classic">IntelliJ IDEA Classic</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_sublime_text">Sublime Text</option><option data-group="secondary" value="secondary_sublime_text_macos">Sublime Text (macOS)</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="Debug_asynchronous_code" id="Debug_asynchronous_code.xml">Debug asynchronous code</h1><p id="e9d5125f">        Debugging asynchronous code is a challenge as the execution jumps between frames and makes it harder to follow the code.        To help you look back from a specific point in the code, IntelliJ IDEA provides <span class="keyword">capture points</span>.</p>        <p id="17b27e9c">                A <span class="keyword">capture point</span> is a place in your code where the debugger captures stack traces to be used later                when you reach a specific point in the code (the insertion point) and want to see how you got there. A <span class="keyword">capture point</span>                is specified by the method name (and the containing class) and the key expression. When the debugger stops, it starts matching stack frames with the                <span class="keyword">insertion point</span>, which is another method and expression. If a match is found, the debugger evaluates the expression, and if the value                has some related stack information, it replaces the rest of the call stack with the captured stack. This helps you see what was happening at the                related capture point, and how you got to the present point.        </p>        <p id="dbf3f6a2">                Asynchronous stack traces are enabled by default (<span data-skip-index="skip" class="menupath">Settings/Preferences | Build, Execution, Deployment | Debugger | Async Stack Traces</span>).                The most common capture points are built in, so no configuration is required.        </p>        <p id="b78e52cb">To try async stack traces, debug the following example:</p>        <div class="code-block" data-lang="java">
                import org.jetbrains.annotations.Async;

                import java.util.concurrent.BlockingQueue;
                import java.util.concurrent.LinkedBlockingQueue;

                public class AsyncSchedulerExample {
                        private static final BlockingQueue&lt;Integer&gt; queue = new LinkedBlockingQueue&lt;&gt;();

                        public static void main(String[] args) throws InterruptedException {
                                new Thread(() -&gt; {
                                        try {
                                                while (true) {
                                                        process(queue.take());
                                                }
                                        } catch (InterruptedException e) {
                                                e.printStackTrace();
                                        }
                                }).start();
                                schedule(1);
                                schedule(2);
                                schedule(3);
                        }

                private static void schedule(@Async.Schedule Integer i) throws InterruptedException {
                        System.out.println("Scheduling " + i);
                        queue.put(i);
                }

                private static void process(@Async.Execute Integer i) {
                        // Put a breakpoint here
                        System.out.println("Processing " + i);
                }
        }
        </div>        <div class="chapter"><h2 id="3fd96c12" data-toc="Debug_asynchronous_code#3fd96c12">Use async annotations</h2>                <p id="ab4ecdee">                        If you need capture points that are not included in the default configuration, you can use                        annotations that can be referenced in your code.                </p>                <p id="99f01590">                        <a href="work-with-maven-dependencies.html">Add a dependency</a> to the                        <a href="https://mvnrepository.com/artifact/org.jetbrains/annotations/16.0.2" data-external="true" target="_blank" rel="noopener noreferrer">JetBrains Maven Java annotations repository</a> for your artifacts and                        use the <code class="code">@Async.Schedule</code> and <code class="code">@Async.Execute</code> annotations in your code.                </p>                <p id="450d114a">                        When a point annotated with <code class="code">@Async.Schedule</code> is reached, the current stack is saved in a storage map. When a point annotated with                        <code class="code">@Async.Execute</code> is reached, the debugger tries to find the related stack in the storage map.                </p>                <p id="0f9a9f3c">                        You can annotate:                </p>                <ul class="list _bullet"><li class="list__item" id="f404af53"><p>                                methods: <code class="code">this</code> value is used as a key                        </p></li><li class="list__item" id="a1c3acdf"><p>                                parameters: the parameter value is used as a key                        </p></li></ul>                <section class="procedure-steps"><h3 id="custom_async_annotations">Define custom annotations</h3><p id="49342574">                                If for some reason you do not want to add the JetBrains Maven repository as a dependency for your project, you can define your own                                annotations and use them instead of the default ones.                        </p><ol class="list _decimal"><li class="list__item" id="86160715"><p>                                Create your own annotations for the capture point and the insertion point (you can use                                <a href="https://github.com/JetBrains/java-annotations/blob/master/common/src/main/java/org/jetbrains/annotations/Async.java" data-external="true" target="_blank" rel="noopener noreferrer">Async.java</a> for reference).                        </p></li><li class="list__item" id="93144d66"><p>                                <a name="open_settings"></a>                In the        <a name="settings_dialog"></a>        <span class="control">Settings/Preferences</span> dialog <kbd data-primary_default_for_windows="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-primary_emacs="Ctrl+Alt+S" data-primary_netbeans="Ctrl+Alt+S" data-primary_sublime_text="Ctrl+Alt+S" data-primary_visual_studio="Alt+F7" data-secondary_macos="⌘," data-secondary_eclipse="⌃⌥S" data-secondary_eclipse_macos="⌘," data-secondary_emacs="⌃⌥S" data-secondary_intellij_idea_classic="⌘," data-secondary_netbeans="⌃⌥S" data-secondary_sublime_text="⌃⌥S" data-secondary_sublime_text_macos="⌘," data-secondary_visual_studio="⌥F7">Ctrl+Alt+S</kbd>, go to                                <span data-skip-index="skip" class="menupath">Build | Execution | Deployment | Debugger | Async Stack Traces</span> and click                                <span class="control">Configure annotations</span>.                        </p></li><li class="list__item" id="90518f7b"><p>                              In the <span class="control">Async Annotations Configuration</span> dialog, click <img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.add@2x.png" width="16" alt="add"> to add your custom                                annotations to <span class="control">Async Schedule annotations</span> and <span class="control">Async Execute annotations</span>.                        </p></li></ol></section>        </div>        <div class="chapter"><h2 id="9fa2b98a" data-toc="Debug_asynchronous_code#9fa2b98a">Configure capture points manually</h2>                <p id="831ed61a">                        If for some reason you cannot use annotations, or need to be able to capture local variables, you can configure capture points manually.                </p>                <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="070da66c"><p>                                <a name="open_settings"></a>                In the        <a name="settings_dialog"></a>        <span class="control">Settings/Preferences</span> dialog <kbd data-primary_default_for_windows="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-primary_emacs="Ctrl+Alt+S" data-primary_netbeans="Ctrl+Alt+S" data-primary_sublime_text="Ctrl+Alt+S" data-primary_visual_studio="Alt+F7" data-secondary_macos="⌘," data-secondary_eclipse="⌃⌥S" data-secondary_eclipse_macos="⌘," data-secondary_emacs="⌃⌥S" data-secondary_intellij_idea_classic="⌘," data-secondary_netbeans="⌃⌥S" data-secondary_sublime_text="⌃⌥S" data-secondary_sublime_text_macos="⌘," data-secondary_visual_studio="⌥F7">Ctrl+Alt+S</kbd>         go to                                <span data-skip-index="skip" class="menupath">Build, Execution, Deployment | Debugger | Async Stack Traces</span>.                        </p></li><li class="list__item" id="2d878d53">                                Click <img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.add@2x.png" width="16" alt="add"> to add a new capture point, and enter the information related to the capture point and the insertion point.                                <p id="e7c24f59">                                        For example, <code class="code">javax.swing.SwingUtilities.invokeLater</code> with the <code class="code">doRun</code> key will capture all invocations of the                                        <code class="code">invokeLater</code> method and associate them with the <code class="code">Runnable</code> instance parameter.                                        <code class="code">java.awt.event.InvocationEvent.dispatch</code> with the <code class="code">runnable</code> insert key will insert the information captured                                        for <code class="code">invokeLater</code> to the place where <code class="code">Runnable</code> is executed.                                </p>                        </li><li class="list__item" id="6f4f0087"><p>                                (Optional) If you also want to capture local variables (primitives and String values together with the call stack,                                select the <span class="control">Capture local variables</span> option. Note that this may slow down the debugging process, and that this option is                                unavailable if the <span class="control">Instrumenting Agent</span> is enabled.                        </p></li></ol></section>                <p id="c0b9af29">                        You can download some additional capture settings from the following repository: <a href="https://github.com/JetBrains/capture-points" data-external="true" target="_blank" rel="noopener noreferrer">IntelliJ IDEA debugger Capture Points</a>                </p>                <aside data-type="note" class="prompt" data-title="" rel="c0b9af29" id="f243d9c1">                        <p id="8a06cb75">Evaluating key expressions may slow down your application, so we recommend using simple expressions, for example</p>                        <ul class="list _bullet"><li class="list__item" id="132b5891"><p>                                        this                                </p></li><li class="list__item" id="d2e56f5e"><p>                                        method parameter name (you can use <code class="code">param_N</code> where N is a zero-based param number)                                </p></li><li class="list__item" id="b816b393"><p>                                        local variable or field name                                </p></li></ul>                        <p id="1970644a">                                Method invocations are much slower and are not recommended.                        </p>                </aside>        </div>        <div class="chapter"><h2 id="1d5bf5fd" data-toc="Debug_asynchronous_code#1d5bf5fd">View Async Stack Traces in remote JVMs</h2>                <p id="e0984a0c">                        If you are debugging a remote process, for example managed within a <a href="docker.html">Docker</a> container,                        you can still use the JVM Instrumenting Agent to display Async Stack Traces as if it were started from the IDE.                </p>                <p id="a382a69b">                        To use the agent remotely, do the following:                </p>                <ul class="list _bullet"><li class="list__item" id="c3ff0ca7"><p>                                copy &lt;IDEA installation folder&gt;/lib/rt/debugger-agent.jar to any location on the remote machine                        </p></li><li class="list__item" id="205042c4"><p>                                add <code class="code">-javaagent:&lt;path to debugger-agent.jar&gt;</code> to the remote JVM options                        </p></li></ul>        </div>        <div class="last-modified" data-skip-index="skip">Last modified: 29 November 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="analyze-java-stream-operations.html">Analyze Java Stream operations</a><a class="navigation-links__next" href="attaching-to-local-process.html">Attach to Process</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>