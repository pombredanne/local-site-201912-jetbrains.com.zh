<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>用策略模式替换条件逻辑-帮助|帮助IntelliJ IDEA</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Tutorial._Replace_conditional_logic_with_strategy_pattern" data-breadcrumbs="Tutorials/Replace_Conditional_Logic_with_Strategy_Pattern.xml|Replace Conditional Logic with Strategy Pattern" data-main-title="Replace Conditional Logic with Strategy Pattern"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索IntelliJ IDEA帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>IntelliJ IDEA 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="secondary_macos" data-group="secondary">苹果系统</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Replace_Conditional_Logic_with_Strategy_Pattern.xml" data-toc="Tutorial._Replace_conditional_logic_with_strategy_pattern">用策略模式替换条件逻辑</h1>    <p id="fa87c5ab">当您的方法具有很多条件逻辑时（例如，if语句），您就会自找麻烦。众所周知，条件逻辑很难管理，并且可能导致您在单个方法内创建整个状态机。</p>    <ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ea1bc116">分析样本应用程序</a></li><li class="list__item"><a href="#39d986d8">创建并运行测试</a></li><li class="list__item"><a href="#256c732c">提取方法</a></li><li class="list__item"><a href="#ac62f437">使用提取委托重构</a></li><li class="list__item"><a href="#6e3a9cf0">微调</a></li><li class="list__item"><a href="#13660634">实现抽象类</a></li><li class="list__item"><a href="#e6ecd790">好结局</a></li></ul><div class="chapter"><h2 id="ea1bc116">分析样本应用程序</h2> <p id="2576fa18">这是一个简短的例子。假设有一种方法可以根据一个人的收入来计算保险费用：</p><div class="code-block" data-lang="java">包ifs;公共类IfElseDemo {公共双计算保险（双收入）{如果（收入<= 10000）{返回收入* 0.365； } else if（收入<= 30000）{return（收入-10000）* 0.2 + 35600; }否则，如果（收入<= 60000）{返回（收入30000）* 0.1 + 76500； } else {return（income-60000）* 0.02 + 105600; }}}</div> <p id="d2a1bee2">让我们分析这个例子。在这里，我们看到四个“收入带宽度”，分为四个计算策略。通常，它们符合以下公式：</p><div class="code-block" data-lang="java">（收入-调整）*体重+常数</div><p id="ccaf816d">我们的目标是提供单独的类来计算每种策略，并对原始类进行转换以使其更加透明。</p></div><div class="chapter"><h2 id="39d986d8">创建并运行测试</h2>    <p id="59c77844">首先，让我们确保该类能够正常工作。为此，请使用<a href="http://junit.org/" rel="noopener noreferrer" data-external="true" target="_blank">JUnit4</a>测试框架创建一个测试类。</p>    <p id="9f034fa9">将插入号放在班级名称上，然后按<kbd data-primary_default_for_windows="Alt+Enter" data-primary_eclipse="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_netbeans="Alt+Enter" data-primary_sublime_text="Alt+Enter" data-primary_visual_studio="Alt+Enter" data-secondary_macos="⌥⏎" data-secondary_eclipse="⌥⏎" data-secondary_eclipse_macos="⌘1" data-secondary_emacs="⌥⏎" data-secondary_intellij_idea_classic="⌥⏎" data-secondary_netbeans="⌥⏎" data-secondary_sublime_text="⌥⏎" data-secondary_sublime_text_macos="⌥⏎" data-secondary_visual_studio="⌥⏎">Alt+Enter</kbd> （或点击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.intentionBulb@2x.png" width="16" alt="图标动作意图"> ）。从建议的意图操作列表中，选择<span class="control">创建测试</span> ：</p>    <figure><img alt="ifelse教程创建测试" title="ifelse教程创建测试" src="/help/img/idea/2019.3/ifelse_tutorial_create_test.png" id="c746ac5c" width="365" height="230"></figure>    <p id="0f73e341">在“ <a href="create-test.html">创建测试”</a>对话框中，从“ <span class="control">测试库”</span>下拉列表中选择JUnit4，如果没有JUnit库，则单击“ <span class="control">修复”</span> ，然后单击“ <span class="control">确定”</span> ：</p>    <figure><img alt="ifelse教程创建测试对话框" title="ifelse教程创建测试对话框" src="/help/img/idea/2019.3/ifelse_tutorial_create_test_dialog.png" id="81f3ef19" width="444" height="547"></figure>    <p id="95d6a4ca">存根测试类已创建。但是，您必须使用提供的快速修复程序提供一些有意义的代码<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.quickfixBulb@2x.png" width="16" alt="图标操作quickfixBulb">创建导入语句：</p>    <div class="code-block" data-lang="java">导入org.junit。测试;导入静态org.junit。断言。*;公共类IfElseDemoTest {@Test public void low（）{assertEquals（1825，insuranceFor（5000），0.01）; } @Test public void medium（）{assertEquals（38600，insuranceFor（25000），0.01）; } @Test public void high（）{assertEquals（78500，insuranceFor（50000），0.01）; } @Test public void veryHigh（）{assertEquals（106400，insuranceFor（100_000），0.01）; }私人double insuranceFor（双重收入）{返回新的IfElseDemo（）。calculateInsurance（income）; }}</div>    <p id="8ded6a21">现在，通过单击运行按钮来运行此测试<img class="inline-icon-13" src="/help/img/idea/2019.3/icons.toolwindows.toolWindowRun@2x.png" width="13" alt="图标工具Windows工具WindowRun">在左装订线或按<kbd data-primary_default_for_windows="Ctrl+Shift+F10" data-primary_eclipse="Ctrl+Shift+F10" data-primary_emacs="Ctrl+Shift+F10" data-primary_netbeans="Shift+Alt+F6" data-primary_sublime_text="Ctrl+Shift+F10" data-primary_visual_studio="Ctrl+F9" data-secondary_macos="⌃⇧R" data-secondary_eclipse="⌃⇧F10" data-secondary_eclipse_macos="⌃⇧R" data-secondary_emacs="⌃⇧F10" data-secondary_intellij_idea_classic="⌃⇧F10" data-secondary_netbeans="⌥⇧F6" data-secondary_sublime_text="⌃⇧F10" data-secondary_sublime_text_macos="N/A" data-secondary_visual_studio="⌃F9">Ctrl+Shift+F10</kbd> ：</p>    <figure><img alt="ifelse教程运行测试" title="ifelse教程运行测试" src="/help/img/idea/2019.3/ifelse_tutorial_run_test.png" id="2ec39691" width="302" height="124"></figure>    <p id="2e28257a">所有4个测试均通过：</p>    <figure><img alt="ifelse教程运行测试通过" title="ifelse教程运行测试通过" src="/help/img/idea/2019.3/ifelse_tutorial_run_test_pass.png" id="2cd3327b" width="618" height="178"></figure></div>    <div class="chapter"><h2 id="256c732c">提取方法</h2>        <p id="882d1e10">接下来，提出原始的课程，将插入符号放置在</p>        <div class="code-block" data-lang="java">（收入60000）* 0.02 + 105600</div>        <p id="a9ea0cf0">并调用“ <a href="extract-method-dialog.html">提取方法对话框”</a>对话框<kbd data-primary_default_for_windows="Ctrl+Alt+M" data-primary_eclipse="Shift+Alt+M" data-primary_emacs="Ctrl+Alt+M" data-primary_netbeans="Shift+Alt+M" data-primary_sublime_text="Ctrl+Alt+M" data-primary_visual_studio="Ctrl+Alt+M" data-secondary_macos="⌥⌘M" data-secondary_eclipse="⌥⇧M" data-secondary_eclipse_macos="⌥⌘M" data-secondary_emacs="⌃⌥M" data-secondary_intellij_idea_classic="⌥⌘M" data-secondary_netbeans="⌥⇧M" data-secondary_sublime_text="⌃⌥M" data-secondary_sublime_text_macos="⌥⌘M" data-secondary_visual_studio="⌃⌥M">Ctrl+Alt+M</kbd> ：</p>        <figure><img alt="ifelse教程提取方法1" title="ifelse教程提取方法1" src="/help/img/idea/2019.3/ifelse_tutorial_extract_method1.png" id="92a66d4d" width="461" height="421"></figure>        <p id="35abf9d3">您得到以下代码：</p>        <div class="code-block" data-lang="java">包ifs;类别IfElseDemo {公共双计算保险（双收入）{如果（收入<= 10000）{返回收入* 0.365； } else if（收入<= 30000）{return（收入-10000）* 0.2 + 35600; }否则，如果（收入<= 60000）{返回（收入30000）* 0.1 + 76500； } else {返回calculateInsuranceVeryHigh（收入）; }}公众双计算保险金（双倍收入）{回报（收入60000）* 0.02 + 105600； }}</div><p id="1512a862">接下来，对60000、0.02和105600片段使用相同的Extract Method重构，并创建方法<code class="code">getAdjustment</code> ， <code class="code">getWeight</code>和<code class="code">getConstant</code> ：</p><div class="code-block" data-lang="java">包ifs;类别IfElseDemo {公共双计算保险（双收入）{如果（收入<= 10000）{返回收入* 0.365； } else if（收入<= 30000）{return（收入-10000）* 0.2 + 35600; }否则，如果（收入<= 60000）{返回（收入30000）* 0.1 + 76500； } else {返回calculateInsuranceVeryHigh（收入）; } public double computeInsuranceVeryHigh（double income）{return（income- getAdjustment（））* getWeight（）+ getConstant（）; } public int getConstant（）{return 105600; } public double getWeight（）{返回0.02; } public int getAdjustment（）{return 60000; }}</div>    </div>    <div class="chapter"><h2 id="ac62f437">使用提取委托重构</h2>        <p id="ddceade2">接下来，选择上一章中创建的所有方法，并调用<a href="extract-into-class-refactorings.html#extract_delegate">Extract委托示例</a>重构：</p><figure><a class="lightbox" href="/help/img/idea/2019.3/ifelse_tutorial_extract_delegate_thumbnail.zoomed.png"><img alt="ifelse教程提取代表缩略图" title="ifelse教程提取代表缩略图" src="/help/img/idea/2019.3/ifelse_tutorial_extract_delegate_thumbnail.png" id="57788a63" width="111" height="66"></a></figure>        <p id="6da4796f">新创建的类的名称<code class="code">InsuranceStrategyVeryHigh</code> 。</p>        <p id="bb2567a3">然后从该类中删除所有选定的方法<code class="code">IfElseDemo</code> 。因此，您将获得以下两个类：</p>        <div class="code-block" data-lang="java">包ifs; class IfElseDemo {私有最终的InsuranceStrategyVeryHigh insuranceStrategyVeryHigh =新的InsuranceStrategyVeryHigh（）;公众双计算保险（双倍收入）{如果（收入<= 10000）{回报* 0.365; } else if（收入<= 30000）{return（收入-10000）* 0.2 + 35600; }否则，如果（收入<= 60000）{返回（收入30000）* 0.1 + 76500； } else {返回insuranceStrategyVeryHigh.calculateInsuranceVeryHigh（income）; }}</div>        <p id="2c0a2595">和</p>        <div class="code-block" data-lang="java">包ifs; public class InsuranceStrategyVeryHigh {public InsuranceStrategyVeryHigh（）{} public double computeInsuranceVeryHigh（double income）{return（income-getAdjustment（））* getWeight（）+ getConstant（）; } public int getConstant（）{return 105600; } public double getWeight（）{返回0.02; } public int getAdjustment（）{return 60000; }}</div>    </div><div class="chapter"><h2 id="6e3a9cf0">微调</h2>    <p id="9d38796f">此代码需要进行一些修改。首先，让我们改变班级<code class="code">IfElseDemo</code> ：</p>    <ul class="list _ul"><li class="list__item" id="22842757"><p>改名<kbd data-primary_default_for_windows="Shift+F6" data-primary_eclipse="Shift+Alt+R" data-primary_emacs="Shift+F6" data-primary_netbeans="Ctrl+R" data-primary_sublime_text="Shift+F6" data-primary_visual_studio="Shift+F6" data-secondary_macos="⇧F6" data-secondary_eclipse="⌥⇧R" data-secondary_eclipse_macos="⇧F6" data-secondary_emacs="⇧F6" data-secondary_intellij_idea_classic="⇧F6" data-secondary_netbeans="⌃R" data-secondary_sublime_text="⇧F6" data-secondary_sublime_text_macos="⇧F6" data-secondary_visual_studio="⇧F6">Shift+F6</kbd>场<code class="code">insuranceStrategyVeryHigh</code>至<code class="code">strategy</code> </p></li><li class="list__item" id="af97fb31"><p>使该字段不是最终字段。</p></li><li class="list__item" id="999b9ddb"><p>使用意图动作，将其分为声明和初始化：</p><figure><img alt="ifelse教程拆分" title="ifelse教程拆分" src="/help/img/idea/2019.3/ifelse_tutorial_split.png" id="0e4d0276" width="635" height="411"></figure>        <p></p></li><li class="list__item" id="e3e93ad5"><p>将初始化下移到相应的位置<code class="code">if-else</code>科。</p></li></ul><p id="c1692073">获取以下代码：</p><div class="code-block" data-lang="java">包ifs; class IfElseDemo {私人InsuranceStrategyVeryHigh策略；公众双计算保险（双倍收入）{如果（收入<= 10000）{回报* 0.365; } else if（收入<= 30000）{return（收入-10000）* 0.2 + 35600; }否则，如果（收入<= 60000）{返回（收入30000）* 0.1 + 76500； } else {strategy = new InsuranceStrategyVeryHigh（）;返回strategy.calculateInsuranceVeryHigh（收入）; }}}</div>    <p id="6e7b55d4">接下来，让我们修改类<code class="code">InsuranceStrategyVeryHigh</code> -为其调用<a href="extract-superclass.html">提取超类</a>重构。</p>    <figure><img alt="ifelse教程提取超类" title="ifelse教程提取超类" src="/help/img/idea/2019.3/ifelse_tutorial_extract_superclass.png" id="ba1b623a" width="565" height="590"></figure>    <p id="8341069c">注意“ <a href="extract-superclass-dialog.html">提取超类对话框”</a>对话框中的设置：</p>    <ul class="list _ul"><li class="list__item" id="4208682b"><p>要生成的超类的名称是<code class="code">InsuranceStrategy</code> 。</p></li><li class="list__item" id="c4af206b"><p>该类的所有方法<code class="code">InsuranceStrategyVeryHigh</code>被选中-这意味着它们将包含在超类中。</p></li><li class="list__item" id="4e48914e"><p>方法<code class="code">calculateInsuranceStrategyVeryHigh</code>保持抽象通过选中“ <span class="control">使摘要”</span>复选框， <span class="control">使</span>所有其他方法都变得抽象。</p></li></ul>    <p id="f31f4e19">同意替换<code class="code">InsuranceStrategyVeryHigh</code>类（在<code class="code">IfElseDemo</code>类），并获得以下内容<code class="code">InsuranceStrategy</code>类：</p>    <div class="code-block" data-lang="java">包ifs;公共抽象类InsuranceStrategy {公共double CalculationInsuranceVeryHigh（双重收入）{return（收入-getAdjustment（））* getWeight（）+ getConstant（）; } public abstract int getConstant（）;公共抽象double getWeight（）;公共抽象int getAdjustment（）; }</div></div>    <div class="chapter"><h2 id="13660634">实现抽象类</h2>        <p id="ce49b02b">接下来，对于此抽象类，请使用<span class="control">Implement Abstract Class</span>意图为所有策略创建实现：</p>        <figure><img alt="ifelse教程实现摘要" title="ifelse教程实现摘要" src="/help/img/idea/2019.3/ifelse_tutorial_implement_abstract.png" id="31b544e3" width="572" height="256"></figure>        <p id="d4df82b8">命名新的实现类<code class="code">InsuranceStrategyLow</code> ， <code class="code">InsuranceStrategyMedium</code>和<code class="code">InsuranceStrategyHigh</code> 。</p>        <p id="73f5992b">为所有新的实现提供正确的<code class="code">return</code>方法说明<code class="code">getAdjustment()</code> ， <code class="code">getWeight()</code>和<code class="code">getConstant()</code> 。</p>        <p id="e2889207">因此，所有实现类都应类似于该类<code class="code">InsuranceStrategyVeryHigh</code> ，但要根据策略进行调整，权重和常数。例如：</p><div class="code-block" data-lang="java">包ifs;公共类InsuranceStrategyMedium扩展了InsuranceStrategy {@Override public int getConstant（）{return 35600; } @Override public double getWeight（）{返回0.2; } @Override public int getAdjustment（）{return 10000; }}</div>      <p id="2875a8c9">请注意，在所有新创建的实现类中，类名均为灰色-到目前为止尚未使用。</p><p id="6ddf5817">接下来，上课<code class="code">IfElseDemo</code> ，并修改所有分支主体，以便它们初始化<code class="code">strategy</code>字段，例如最后一个分支：</p><div class="code-block" data-lang="java">包ifs; class IfElseDemo {私人InsuranceStrategy策略；公众双计算保险（双倍收入）{如果（收入<= 10000）{策略=新的InsuranceStrategyLow（）;返回strategy.calculateInsuranceVeryHigh（收入）; }否则，如果（收入<= 30000）{策略=新的InsuranceStrategyMedium（）;返回strategy.calculateInsuranceVeryHigh（收入）; } else if（收入<= 60000）{strategy = new InsuranceStrategyHigh（）;返回strategy.calculateInsuranceVeryHigh（收入）; } else {strategy = new InsuranceStrategyVeryHigh（）;返回strategy.calculateInsuranceVeryHigh（收入）; }}}</div>        <p id="76a80f6c">最后，重命名方法<code class="code">calculateInsuranceVeryHigh</code> ：上课<code class="code">InsuranceStrategy</code> ，将插入号放在方法名称上，然后按<kbd data-primary_default_for_windows="Shift+F6" data-primary_eclipse="Shift+Alt+R" data-primary_emacs="Shift+F6" data-primary_netbeans="Ctrl+R" data-primary_sublime_text="Shift+F6" data-primary_visual_studio="Shift+F6" data-secondary_macos="⇧F6" data-secondary_eclipse="⌥⇧R" data-secondary_eclipse_macos="⇧F6" data-secondary_emacs="⇧F6" data-secondary_intellij_idea_classic="⇧F6" data-secondary_netbeans="⌃R" data-secondary_sublime_text="⇧F6" data-secondary_sublime_text_macos="⇧F6" data-secondary_visual_studio="⇧F6">Shift+F6</kbd> 。新名称应为<code class="code">calculate</code> 。</p>    </div><div class="chapter"><h2 id="e6ecd790">好结局</h2>    <p id="d78514a8">最后享受代码：</p>    <div class="code-block" data-lang="java">包ifs; class IfElseDemo {私人InsuranceStrategy策略；公众双计算保险（双倍收入）{如果（收入<= 10000）{策略=新的InsuranceStrategyLow（）;返回strategy.calculate（收入）; }否则，如果（收入<= 30000）{策略=新的InsuranceStrategyMedium（）;返回strategy.calculate（收入）; } else if（收入<= 60000）{strategy = new InsuranceStrategyHigh（）;返回strategy.calculate（收入）; } else {strategy = new InsuranceStrategyVeryHigh（）;返回strategy.calculate（收入）; }}}</div>    <p id="166dd295">接下来，让我们再次运行测试类。所有测试都应该通过–我们已经重构了代码，但是仍然产生相同的结果。</p></div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="tutorial-introduction-to-refactoring.html">重构</a> <a class="navigation-links__next" href="todo-example.html">TODO示例</a> <a class="navigation-links__prev" href="tutorial-introduction-to-refactoring.html">简介</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>