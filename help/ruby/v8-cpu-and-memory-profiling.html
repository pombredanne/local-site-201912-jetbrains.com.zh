<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>V8 CPU和内存性能分析-帮助|帮助红宝石矿</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="V8_CPU_and_Memory_Profiling" data-breadcrumbs="Framework-specific guidelines/Developing_Node_JS_Applications.xml|Node.js/V8_CPU_and_Memory_Profiling.xml|V8 CPU and Memory Profiling" data-main-title="V8 CPU and Memory Profiling"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索RubyMine帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>RubyMine 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_default_for_macos" data-group="primary">macOS的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_macos" data-group="primary">Eclipse（macOS）</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_sublime_text_macos" data-group="primary">崇高文字（macOS）</option><option value="primary_textmate" data-group="primary">TextMate</option><option value="secondary_default_for_windows" data-group="secondary">Windows的默认设置</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option><option value="secondary_textmate" data-group="secondary">TextMate</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="V8_CPU_and_Memory_Profiling.xml" data-toc="V8_CPU_and_Memory_Profiling">V8 CPU和内存性能分析</h1>            <p id="ws_v8_profiling_intro">借助RubyMine，您可以使用<a href="https://v8.dev/docs/profile" rel="noopener noreferrer" data-external="true" target="_blank">V8的基于示例的探查器</a>捕获和分析<span class="emphasis">Node.js</span>应用程序的CPU <a href="https://v8.dev/docs/profile" rel="noopener noreferrer" data-external="true" target="_blank">探查</a>和堆快照。</p>    <p id="ce0c2971">您还可以打开和浏览在Google Chrome DevTools中为客户端代码捕获的配置文件和快照。</p>    <div class="chapter"><h2 id="node_profiling_before_you_start" data-toc="V8_CPU_and_Memory_Profiling#node_profiling_before_you_start">在你开始前</h2>        <section class="procedure-steps"><ul class="list "><li class="list__item" id="677303c8"><p>                <a name="ws_install_repo_plugin"></a>如<a href="managing-plugins.html">管理插件中</a>所述，在“ <a href="plugins-settings.html">插件”页面</a>上安装并启用NodeJS存储库插件。</p></li></ul></section>    </div>    <div class="chapter"><h2 id="ws_node_cpu_profiling" data-toc="V8_CPU_and_Memory_Profiling#ws_node_cpu_profiling">CPU分析</h2>        <p id="1a25cd5d">CPU配置文件可帮助您更好地了解代码的哪些部分占用最多的CPU时间，以及V8 JavaScript引擎如何执行和优化代码。</p>        <p id="9be1c640">RubyMine中的Node.js CPU配置文件基于V8内置的CPU事件探查器，该探查器提供有关代码执行和JavaScript引擎本身行为的信息，包括垃圾回收周期，编译和重新编译以及代码优化。</p>        <p id="488ad203">探查器每隔一定时间间隔拍摄一次快照，称为“刻度”。不仅针对代码的工作进行测量，而且还针对引擎本身执行的活动进行测量，例如编译，系统库调用，优化和垃圾回收。</p>        <section class="procedure-steps"><h3 id="ws_node_configuring_cpu_profiling">启用CPU分析</h3><p id="9f1a839f">要在应用程序启动时调用V8 CPU分析，您需要在<span class="control">Node.js</span>运行配置中指定其他设置。</p><ol class="list _decimal"><li class="list__item" id="9db9136b"><p>                    <a name="start_creating_run_config_short_1"></a>从主菜单中，选择<span class="menupath" data-skip-index="skip">运行|编辑配置</span> 。 <a name="start_creating_run_config_short_2"></a>                        请点击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.add@2x.png" width="16" alt="添加按钮">在工具栏上，然后从列表中选择<span class="control">Node.js。</span></p></li><li class="list__item" id="dc86c556"><p>从列表中，选择<span class="emphasis">Node.js</span>运行配置以激活CPU性能分析或按照<a href="running-and-debugging-node-js.html">运行和调试Node.js中的</a>描述创建新配置。</p></li><li class="list__item" id="774232bb">                    <p id="d77cd365">切换到“ <span class="control">V8分析”</span>选项卡，然后选择“ <span class="control">记录CPU分析信息”</span>复选框。在“ <span class="control">日志文件夹”</span>字段中，指定将存储记录的日志的文件夹的路径，日志文件名为<code class="code">isolate-<session number></code> 。</p>                                        <figure><img alt="V8探查器选项卡" title="V8探查器选项卡" src="/help/img/idea/2019.3/ws_v8_profiler_tab_light.png" id="21018f9d" class=" _border-line" width="600" height="461"></figure>                </li></ol></section>        <section class="procedure-steps"><h3 id="ws_node_collecting_cpu_profiling_data">收集CPU分析信息</h3><ol class="list _decimal"><li class="list__item" id="2a2f7520">                    <p id="6e50df43">从主工具栏上的列表中选择运行配置，然后单击<img class="inline-icon-13" src="/help/img/idea/2019.3/icons.toolwindows.toolWindowRun@2x.png" width="13" alt="运行按钮">或选择<span class="menupath" data-skip-index="skip">运行|跑<configuration name=""></configuration></span>从主菜单。</p>                </li><li class="list__item" id="e9dc27a7">                    <p id="848c4900">执行需要分析的方案后，通过单击停止该过程<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.suspend@2x.png" width="16" alt="停止按钮">在工具栏上。</p>                </li></ol></section>        <div class="chapter"><h3 id="ws_node_analyzing_cpu_profiling_data">分析CPU分析日志</h3>            <p id="251339bb">当您停止应用程序时，RubyMine自动打开<span class="control">V8分析</span>工具窗口并在其中显示收集的分析数据。 <a name="v8ProfilingOpenSeveralTabs"></a>        如果该窗口已经打开，并显示了另一个会话的收集数据，则RubyMine将打开一个新选项卡。自动打开的选项卡以控制应用程序执行和收集性能分析数据的运行配置命名。</p>            <p id="1bbacb1b">要打开并分析一些以前保存的性能分析数据，请转到“ <span class="menupath" data-skip-index="skip">工具” |“工具”。 V8分析-分析V8分析日志</span>并选择相关的V8日志文件<code class="code">isolate-<session number></code> 。RubyMine用所选日志文件的名称创建一个单独的选项卡。</p>                    <p id="8fa5abc6">基于收集的概要分析数据，RubyMine构建三个调用树，并在单独的窗格中显示它们。使用这些调用树，您可以从两种不同的角度分析应用程序的执行情况：一方面，哪些调用很耗时（“繁重”），另一方面，“谁调用了谁”。</p>            <div class="chapter"><h4 id="ws_v8_spu_profiling_call_trees_metrics">了解调用树中的指标</h4>            <p id="a152e183">调用树使用<span class="emphasis">Total</span>和<span class="emphasis">Self</span>度量标准，这些度量标准显示函数中的滴答声数量或其与总执行时间的比率：</p>            <ul class="list _bullet"><li class="list__item" id="64256ff6"><p>                    <span class="emphasis">总计</span>显示了一个函数及其调用的函数花费了多少时间。</p></li><li class="list__item" id="e9f2912e"><p>                    <span class="emphasis">Self</span>显示仅在函数本身内部花费了多少时间，而没有考虑其子节点。</p></li></ul>                <p id="81fa30a3"><span class="emphasis">“父项”</span>度量标准显示函数的纯执行时间与调用该函数的函数的执行时间（ <span class="emphasis">父项</span> ）的比率。</p>            </div>            <div class="chapter"><h4 id="ws_v8_spu_profiling_call_trees_optimization">V8优化器</h4>            <p id="ws_v8_cpu_profiling_optimization">在某些情况下，V8可以优化您的代码，有关详细信息，请参阅<a href="http://floitsch.blogspot.de/2012/03/optimizing-for-v8-introduction.html" rel="noopener noreferrer" data-external="true" target="_blank">针对V8优化。</a></p>            <ul class="list _bullet"><li class="list__item" id="a41d7b28"><p>星号<code class="code">*</code>函数名称之前的数字表示该函数已被优化。</p></li><li class="list__item" id="5e0d9a49">                    <p id="96d3437d">波浪号<code class="code">~</code>表示功能可能需要优化，但由于某些原因尚未优化。如果代码运行时间短，引擎可能会推迟优化或跳过优化，但是代字号指向可以重写代码以获得更好性能的位置。</p>                </li></ul>            </div>            <div class="chapter"><h4 id="ws_v8_spu_profiling_call_trees_top_calls">热门来电树</h4>                    <p id="45cd109a">“ <span class="control">顶部呼叫”</span>窗格按“ <span class="emphasis">自我”</span>指标排序的降序列出了已执行的活动。对于每个活动，都会显示其<span class="emphasis">Total</span> ， <span class="emphasis">Total％</span>和<span class="emphasis">Self％</span>指标。 <a name="V8ProfilingFunctionCallLineColumn"></a>        对于每个函数调用，RubyMine都会显示文件名，行和定义函数的列。</p>                                    <figure><img alt="V8 CPU分析：“最热门呼叫”树" title="V8 CPU分析：“最热门呼叫”树" src="/help/img/idea/2019.3/v8ProfilerCPUTopCalls_light.png" id="9c05a073" class=" _border-line" width="600" height="878"></figure>                    <p id="d272d509">“ <span class="control">概述”</span>窗格中的图显示了“ <span class="emphasis">自身百分比”</span>指标高于1％的呼叫的“ <span class="emphasis">自身</span>时间”分布。</p>                </div>                <div class="chapter"><h4 id="ws_v8_spu_profiling_call_trees_bottom_up">自下而上的树</h4>                                        <p id="ws_v8_cpu_profiling_call_trees_bottom_up_intro">“ <span class="control">自下而上”</span>窗格还列出了按“ <span class="emphasis">自我”</span>指标按降序排序的已执行活动。与“ <span class="control">顶部调用”</span>窗格不同，“ <span class="control">底部向上”</span>窗格仅显示“ <span class="emphasis">总百分比”</span>指标高于2的活动以及调用这些活动的函数。</p><aside class="prompt" rel="ws_v8_cpu_profiling_call_trees_bottom_up_intro" id="99ac89a3" data-type="tip" data-title="">                        <p id="4809629c">如果遇到<span class="emphasis">繁重的</span>功能并想知道从何处调用它，则<span class="control">自下而上的</span>树会很有用。</p>                    </aside>                    <ul class="list _bullet"><li class="list__item" id="35ffc0f8"><p>对于每个活动，将显示其执行时间（以<span class="emphasis">滴答为单位）</span>和<span class="emphasis">“父项”</span>指标。</p></li><li class="list__item" id="a35135ff"><p>                            <a name="V8ProfilingFunctionCallLineColumn"></a>对于每个函数调用，RubyMine都会显示文件名，行和定义函数的列。</p></li></ul>                                        <figure><img alt="V8 CPU配置文件：自底向上树" title="V8 CPU配置文件：自底向上树" src="/help/img/idea/2019.3/v8ProfilerCPUBottomUp_light.png" id="ee2582d0" class=" _border-line" width="600" height="630"></figure>                </div>                <div class="chapter"><h4 id="ws_v8_spu_profiling_call_trees_top_down">自上而下的树</h4>                    <p id="e334bd05">“ <span class="control">自上而下”</span>窗格显示了整个调用层次结构，并在顶部显示了作为执行入口点的功能。对于每个活动，都会显示其<span class="emphasis">Total</span> ， <span class="emphasis">Total％</span> ， <span class="emphasis">Self</span>和<span class="emphasis">Self％</span>指标。 <a name="V8ProfilingFunctionCallLineColumn"></a>        对于每个函数调用，RubyMine都会显示文件名，行和定义函数的列。</p>                    <figure><img alt="V8分析：自顶向下的树" title="V8分析：自顶向下的树" src="/help/img/idea/2019.3/v8ProfilerCPUTopDown_light.png" id="71dae1e0" class=" _border-line" width="600" height="818"></figure>                                    </div>            <section class="procedure-steps"><h3 id="53f2dd3a">浏览呼叫树</h3><ul class="list "><li class="list__item" id="4e94a272">                    <p id="723df123">要导航到功能的源代码，请选择此功能并按<kbd data-primary_default_for_windows="F4" data-primary_default_for_macos="⌘+Down" data-primary_intellij_idea_classic_macos="F4" data-primary_emacs="F4" data-primary_visual_studio="F4" data-primary_default_for_xwin="F4" data-primary_default_for_gnome="F4" data-primary_default_for_kde="F4" data-primary_eclipse="F12" data-primary_eclipse_macos="F3" data-primary_netbeans="F4" data-primary_sublime_text="F4" data-primary_sublime_text_macos="N/A" data-primary_textmate="F4" data-secondary_default_for_windows="F4" data-secondary_default_for_macos="⌘↓" data-secondary_intellij_idea_classic="F4" data-secondary_emacs="F4" data-secondary_visual_studio="F4" data-secondary_default_for_xwin="F4" data-secondary_default_for_gnome="F4" data-secondary_default_for_kde="F4" data-secondary_eclipse="F12" data-secondary_eclipse_macos="F3" data-secondary_netbeans="F4" data-secondary_sublime_text="F4" data-secondary_sublime_text_macos="N/A" data-secondary_textmate="F4">F4</kbd>要么<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.edit@2x.png" width="16" alt="编辑按钮">在工具栏上，或从上下文菜单中选择“ <span class="control">跳转到源</span> ”。</p>                </li><li class="list__item" id="21ed1b6f">                    <p id="b1825171">要切换到另一个窗格并从另一个角度检查呼叫，请选择该呼叫并单击<img class="inline-icon-16" src="/help/img/idea/2019.3/NodeJS.com.jetbrains.nodejs.icons.Navigate_inMainTree@2x.png" width="16" alt="导航到按钮">在工具栏上，或从呼叫的上下文菜单中选择“ <span class="control">导航到</span> ”，然后选择目的地。RubyMine切换到所选窗格，并将焦点移至呼叫。</p>                </li></ul></section>                <section class="procedure-steps"><h3 id="67fe92e4">展开或折叠节点</h3><p id="2fc3c54c">当RubyMine打开一个用于性能分析会话的选项卡时，默认情况下，它将扩展具有最重调用的节点。在浏览树木时，您可能想折叠其中一些节点或扩展其他节点。</p><ul class="list "><li class="list__item" id="5ac33286">                        <p id="ecdc49c7">要展开或折叠节点，请从其上下文菜单中选择“ <span class="control">展开节点”</span>或“ <span class="control">折叠节点”</span> 。</p>                    </li><li class="list__item" id="071fe9c8">                        <p id="eeea16fa">要折叠活动窗格中的所有节点，请单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.collapseall@2x.png" width="16" alt="全部折叠按钮">在工具栏上。</p>                    </li><li class="list__item" id="3c7d305d">                        <p id="c2e9fb9b">要恢复原始的树状显示，请单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.expandall@2x.png" width="16" alt="展开大量痕迹按钮"> 。</p>                    </li></ul></section>                <section class="procedure-steps"><h3 id="06626347">过滤掉来电</h3><p id="80e73245">这样做只能查看实际上导致性能问题的呼叫。</p><ul class="list "><li class="list__item" id="d6fad9dd">                        <p id="49a0c304">请点击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.filter@2x.png" width="16" alt="过滤器按钮">在工具栏上，然后使用滑块为要显示的呼叫指定最小的<span class="emphasis">Total％</span>或<span class="emphasis">Parent％</span>值，然后单击<span class="control">完成</span> 。</p>                    </li></ul></section>                <section class="procedure-steps"><h3 id="3a82b822">保存并比较分析数据</h3><ul class="list "><li class="list__item" id="e0c91876">                        <p id="e551518f">要保存包含函数及其度量的行，请从函数的上下文菜单中选择“ <span class="control">复制</span> ”。如果要比较两个会话中某个函数的度量值（例如，在对代码进行一些改进之后），这可能会有所帮助。</p>                    </li><li class="list__item" id="2e58afb1">                        <p id="e72fe279">要仅保存函数名称和定义文件的名称，请从函数的上下文菜单中选择“ <span class="control">复制调用</span> ”。</p>                    </li><li class="list__item" id="8c4e08b3"><p>要将项目与剪贴板的内容进行<span class="control">比较，请</span>从项目的上下文菜单中选择“ <span class="control">与剪贴板比较</span> ”。RubyMine打开<span class="emphasis">差异查看器</span> 。</p></li><li class="list__item" id="1c759409"><p>要将当前日志与另一个隔离进行比较，请单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.diff@2x.png" width="16" alt="比较方式按钮">在工具栏上。在打开的对话框中，选择要与之进行比较的隔离物。要缩小搜索范围，请指定目标隔离是在当前隔离之前还是之后进行的。</p></li></ul></section>                    <section class="procedure-steps"><h3 id="22c85aff">导出调用树</h3><ul class="list "><li class="list__item" id="693d63d4">                            <p id="a7976a57">要将当前窗格中的调用树保存到文本文件，请单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.toolbarDecorator.export@2x.png" width="16" alt="导出按钮">在工具栏上，然后在打开的对话框中指定目标文件。</p>                        </li></ul></section>            <div class="chapter"><h4 id="ws_node_profiling_analyzing_flame_chart">分析火焰图</h4>                <p id="d1eeb234">使用多色<span class="control">火焰图</span>查找应用程序在哪里暂停，并探究导致这些暂停的呼叫。</p>                                <figure><img alt="火焰图" title="火焰图" src="/help/img/idea/2019.3/ws_v8_profiler_flame_chart_light.png" id="8877bc64" class=" _border-line" width="600" height="736"></figure>                <p id="914d13d1">该图表包含四个区域：</p>                <ul class="list _ul"><li class="list__item" id="1c80fee7"><p>上方区域显示了一个时间轴，其中包含两个滑块，用于限制要研究的片段的开始和结束。</p></li><li class="list__item" id="36e58b17"><p>底部区域以多色图表的形式显示一堆调用。首次调用时，为每个功能分配一个随机的颜色，因此，在当前会话中此功能的每次调用均以该颜色显示。</p></li><li class="list__item" id="765eb065"><p>中间区域显示了来自<span class="emphasis">垃圾收集器</span>的调用摘要，引擎，外部调用以及执行本身。这些活动保留的颜色在该区域的顶部列出。</p></li><li class="list__item" id="3bc3792f"><p>右侧窗格列出了所选片段中的调用，对于每个调用，列表都显示其持续时间，被调用函数的名称以及定义该函数的文件。</p></li></ul>                <p id="c50aab03">底部和右侧区域是同步的：随着时间线在底部区域中拖动滑块，右侧窗格中的焦点将移至每个时刻执行的呼叫。</p>                <p id="45f25484">此外，如果单击底部区域中的呼叫，则滑块会自动移至该呼叫，并且右侧窗格中的焦点会切换到相应的功能，必要时列表会自动滚动。反之亦然，如果您单击列表中的一个项目，则RubyMine在底部区域中选择相应的调用并将滑块自动拖至该调用：</p>                <section class="procedure-steps"><h3 id="181ab043">在时间轴中选择片段</h3><ul class="list "><li class="list__item" id="dddab7fd">                        <p id="89d60b08">要在一定时间内探索流程，需要在时间轴中选择相应的片段。为此，请拖动滑块或单击两个滑块之间的<span class="emphasis">窗口</span> ，然后将其拖动到所需的片段。</p>                        <p id="0039e9fd">无论哪种情况，下面的多色图表都会显示所选片段内的调用堆栈。</p>                    </li><li class="list__item" id="95dbe76a"><p>要放大图表，请单击选定的片段，然后单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.zoomIn@2x.png" width="16" alt="缩放按钮">在工具栏上。RubyMine将打开一个新选项卡，并放大显示所选片段以适合选项卡宽度，以便您可以检查片段的更多细节。</p></li></ul></section>                    <section class="procedure-steps"><h3 id="9332881e">浏览火焰图表</h3><p id="9186af08">从右侧区域中的调用，您可以跳至被调用函数的源代码，工具窗口的其他窗格以及火焰图中具有特定指标的区域。</p><ul class="list "><li class="list__item" id="a5a1108e">                            <p id="38191cc1">要跳转到被调用函数的源代码，请从调用的上下文菜单中选择“ <span class="control">跳转到源代码</span> ”。</p>                        </li><li class="list__item" id="1c5a4c58">                            <p id="a19358e7">要使火焰图放大带有特定呼叫指标的片段，请选择该呼叫并单击<img class="inline-icon-16" src="/help/img/idea/2019.3/NodeJS.com.jetbrains.nodejs.icons.Navigate_inMainTree@2x.png" width="16" alt="导航到按钮">或从呼叫的上下文菜单中选择“ <span class="control">导航到</span> ”，然后选择指标。</p>                        </li><li class="list__item" id="62b701a3">                            <p id="489cbd6c">您还可以导航到调用的堆栈跟踪以查看和分析异常。为此，请从调用的上下文菜单中选择“ <span class="control">显示为堆栈跟踪</span> ”。RubyMine在单独的选项卡中打开堆栈跟踪，要返回“ <span class="control">火焰图”</span>窗格，请单击底部的<span class="control">V8 CPU Profiling</span>工具窗口按钮。</p>                        </li></ul></section>            </div>        </div>    </div>    <div class="chapter"><h2 id="ws_node_memory_profiling" data-toc="V8_CPU_and_Memory_Profiling#ws_node_memory_profiling">内存分析</h2>        <p id="5979ec86">内存配置文件使您可以检测内存泄漏和动态内存问题，并找到导致它们的代码片段。</p>        <section class="procedure-steps"><h3 id="ws_node_configuring_memory_profiling">启用内存分析</h3><p id="1c554f9c">要在应用程序启动时调用获取内存快照，您需要在<span class="control">Node.js</span>运行配置中指定其他设置。</p><ol class="list _decimal"><li class="list__item" id="3e24fa36"><p>                    <a name="start_creating_run_config_short_1"></a>从主菜单中，选择<span class="menupath" data-skip-index="skip">运行|编辑配置</span> 。 <a name="start_creating_run_config_short_2"></a>                        请点击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.add@2x.png" width="16" alt="添加按钮">在工具栏上，然后从列表中选择<span class="control">Node.js。</span></p></li><li class="list__item" id="98f659b0"><p>从列表中，选择<span class="emphasis">Node.js</span>运行配置以激活CPU性能分析或创建新配置，如“ <a href="running-and-debugging-node-js.html">运行和调试Node.js”中所述</a> 。</p></li><li class="list__item" id="d82f6b7f">                    <p id="b7cc9b01">切换到“ <span class="control">V8分析”</span>选项卡，然后选择“ <span class="control">允许拍摄堆快照”</span>复选框。</p>                </li></ol></section>            <section class="procedure-steps"><h3 id="ws_node_collecting_memory_profiling_data">收集内存分析信息</h3><ol class="list _decimal"><li class="list__item" id="4901d195">                    <p id="518dc533">从主工具栏上的列表中选择运行配置，然后单击<img class="inline-icon-13" src="/help/img/idea/2019.3/icons.toolwindows.toolWindowRun@2x.png" width="13" alt="运行按钮">或选择<span class="menupath" data-skip-index="skip">运行|跑<configuration name=""></configuration></span>从主菜单。</p>                </li><li class="list__item" id="e7dcf93f">                    <p id="54038dc9">在应用程序执行期间的任何时间，单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.startMemoryProfile@2x.png" width="16" alt="“获取堆快照”按钮">在<span class="control">运行</span>工具窗口的工具栏上。</p>                </li><li class="list__item" id="b34102d1">                    <p id="a1cdc5fe">在打开的对话框中，指定快照的名称以及将其存储到的文件夹的路径。要立即开始分析快照，请选中“ <span class="control">打开快照”</span>复选框。</p>                </li></ol></section>        <div class="chapter"><h3 id="ws_node_analyzing_memory_profiling_data">分析内存快照</h3>            <p id="9b0878c9">拍摄快照并选择分析快照时，RubyMine会打开<span class="control">V8 Heap</span>工具窗口，其中包含收集的数据。 <a name="v8ProfilingOpenSeveralTabs"></a>        如果该窗口已经打开，并显示了另一个会话的收集数据，则RubyMine将打开一个新选项卡。</p>            <p id="9b9071d7">要打开并分析一些以前保存的内存配置文件数据，请转到“ <span class="menupath" data-skip-index="skip">工具” |“工具”。 V8分析-分析V8堆快照</span>并选择相关的<span class="filepath">.heapsnapshot</span>文件。RubyMine使用所选文件的名称创建一个单独的选项卡。</p>            <p id="ef61819a">工具窗口具有三个选项卡，这些选项卡显示了从不同角度收集的信息。</p>                <ul class="list _bullet"><li class="list__item" id="60f7919f">                        <p id="9f65d78d">在<span class="control">遏制</span>选项卡显示在您的应用程序中的对象在几个顶级条目归类<span class="emphasis">：DOMWindow对象</span> ， <span class="emphasis">本地浏览器的对象</span> <span class="emphasis">，GC</span>和<span class="emphasis">根</span> ，这是根的<span class="emphasis">垃圾收集器</span>实际使用。有关详细信息，请参见<a href="https://developer.chrome.com/devtools/docs/javascript-memory-profiling#containment-view" rel="noopener noreferrer" data-external="true" target="_blank">收容视图</a> 。</p>                        <p id="e29ccdbc">对于每个对象，该选项卡都会显示其<span class="emphasis">与GC根的距离</span> ，即<span class="emphasis">距离</span>对象与GC根之间的节点的最短简单路径，对象的<a href="https://developer.chrome.com/devtools/docs/javascript-memory-profiling#shallow-size" rel="noopener noreferrer" data-external="true" target="_blank">浅大小</a>以及对象的<a href="https://developer.chrome.com/devtools/docs/javascript-memory-profiling#retained-size" rel="noopener noreferrer" data-external="true" target="_blank">保留大小</a> 。除了对象大小的绝对值外，RubyMine还显示对象占用的内存百分比。</p>                    </li><li class="list__item" id="0aa3a2fc">                        <p id="f62beb7e">“ <span class="control">最大对象”</span>选项卡显示了按其<a href="https://developer.chrome.com/devtools/docs/javascript-memory-profiling#retained-size" rel="noopener noreferrer" data-external="true" target="_blank">保留大小</a>排序的最消耗内存的对象。在此选项卡中，您可以发现由于在某些全局对象中累积数据而引起的内存泄漏。</p>                    </li><li class="list__item" id="2afdfa60">                        <p id="6196e339">“ <span class="control">摘要”</span>选项卡按类型将应用程序中的对象分组。该选项卡显示每种类型的对象数，它们的大小以及它们所占内存的百分比。此信息可能是内存状态的线索。</p>                    </li></ul>            <p id="9f9d5532">每个选项卡都有一个“ <span class="control">详细信息”</span>窗格，该窗格显示从GC根目录到当前所选对象的路径，以及对象<span class="emphasis">保持器</span> （即保留指向所选对象链接的对象）的列表。每个堆快照都有许多“后退”引用和循环，因此每个对象始终有许多保留器。</p>                <section class="procedure-steps"><h3 id="750a3bcc">用文本标签标记对象</h3><p id="bdc484e6">标签可帮助您区分对象并在不丢失上下文的情况下从一个对象移到另一个对象。</p><ul class="list "><li class="list__item" id="dc9f1b97">                        <p id="d3f5f946">要为对象设置标签，请选择该对象并单击<img class="inline-icon-16" src="/help/img/idea/2019.3/platform-impl.com.intellij.ide.ui.laf.icons.graphite.checkmark@2x.png" width="16" alt="标记按钮">在工具栏上，或从上下文菜单中选择“ <span class="control">标记</span> ”。然后在打开的对话框中指定文本标签。</p>                    </li></ul></section>                <section class="procedure-steps"><h3 id="aeb01d1a">浏览快照</h3><ul class="list "><li class="list__item" id="52c5681d">                        <p id="c43b83b0">要导航到与对象相对应的函数或变量，请选择该对象并单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.edit@2x.png" width="16" alt="编辑器按钮">在工具栏上，或从上下文菜单中选择“ <span class="control">编辑源</span> ”。如果禁用了按钮和菜单选项，则意味着RubyMine找不到与所选对象相对应的任何函数或变量。</p>                        <p id="1bc42f4a">如果找到几个函数或变量，RubyMine会在建议列表中显示它们。</p>                    </li><li class="list__item" id="d18faa4f">                        <p id="5865f186">为了帮助您从调查来看，集中对象之间的联系围堵点对象，RubyMine的让你从一个对象跳的<span class="control">最大对象</span>或<span class="control">摘要</span>选项卡或<span class="control">纪录</span> ，以期<span class="control">遏制</span>该选项卡中的同一个对象。</p>                        <p id="192b1ae9">为此，选择对象并单击<img class="inline-icon-16" src="/help/img/idea/2019.3/NodeJS.com.jetbrains.nodejs.icons.Navigate_inMainTree@2x.png" width="16" alt="导航到按钮">在工具栏上，或从上下文菜单中选择“ <span class="control">在主树中导航”</span> 。</p>                    </li></ul></section>                <section class="procedure-steps"><h3 id="1d53d4ef">搜索快照</h3><ol class="list _decimal"><li class="list__item" id="657f1f0a"><p>在“ <span class="control">遏制”</span>选项卡中，单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.find@2x.png" width="16" alt="查找按钮">在工具栏上。</p></li><li class="list__item" id="330fa517">                        <p id="416705b6">在打开的<span class="control">V8堆搜索</span>对话框中，指定搜索模式和要搜索的范围。可用范围是：</p>                        <ul class="list _bullet"><li class="list__item" id="44945128"><p>                                <span class="control">到处：</span>选中此复选框以在所有范围内搜索。选中此复选框后，将禁用所有其他搜索类型。</p></li><li class="list__item" id="0395330e">                                <p id="6710242f">                                    <span class="control">链接名称：</span>选中此复选框可在<span class="emphasis">V8</span>调用<span class="emphasis">C ++运行</span> <span class="emphasis">时时</span>创建的对象名称中搜索。</p>                                <p id="a1d86f1d">在<span class="control">V8堆</span>工具窗口中，链接名称标有<code class="code">%</code>字符<code class="code">%<link name></code> 。</p>                            </li><li class="list__item" id="13289c3b"><p>                                <span class="control">类名：</span>选择此复选框可在函数构造器中搜索。</p></li><li class="list__item" id="72588b74"><p>                                <span class="control">文本字符串：</span>选中此复选框可以在对象的内容中执行文本搜索。</p></li><li class="list__item" id="b68e164a">                                <p id="5f5cdec8">                                    <span class="control">快照对象ID：</span>选中此复选框可在对象的唯一标识符中搜索。创建对象时， <span class="emphasis">V8</span>会以格式将这种唯一标识符分配给每个对象，并保留它直到对象被销毁为止。这意味着您可以在同一会话内拍摄的多个快照中找到并比较相同的对象。</p>                                <p id="53e3b752">在<span class="control">V8堆</span>工具窗口中，对象ID用<code class="code">@</code>字符<code class="code">@<object id></code> 。</p>                            </li><li class="list__item" id="02b66e4d"><p>                                <span class="control">标记：</span>选中此复选框可通过单击来手动搜索设置为对象的标签<img class="inline-icon-16" src="/help/img/idea/2019.3/platform-impl.com.intellij.ide.ui.laf.icons.graphite.checkmark@2x.png" width="16" alt="标记按钮">在“ <span class="control">遏制”</span>选项卡的工具栏上。</p></li></ul>                    </li></ol><p id="de3780c1">搜索结果显示在“ <span class="control">详细信息”</span>窗格<span class="control">中“ <search pattern="">”</search></span>视图的单独<span class="control">出现中</span> 。要按指定的搜索范围对显示的搜索结果进行分组，请按工具栏上的“ <span class="control">按类型分组”</span>切换按钮。</p><p id="cec1e896">下次打开对话框时，它将显示上一次搜索的设置。</p></section>        </div>    </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月28日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="unit-testing-node-js.html">测试Node.js</a> <a class="navigation-links__next" href="installing-and-removing-external-software-using-node-package-manager.html">npm和Yarn</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>