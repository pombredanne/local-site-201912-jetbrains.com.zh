<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>典型的LDAP配置-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Typical LDAP Configurations" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/configuring-authentication-settings.md|Configuring Authentication Settings/ldap-integration.md|LDAP Integration/typical-ldap-configurations.md|Typical LDAP Configurations" data-main-title="Typical LDAP Configurations" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/typical-ldap-configurations.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="typical-ldap-configurations.md" data-toc="Typical LDAP Configurations">典型的LDAP配置</h1><p id="c26509f7">此页面包含以下示例<code class="code">ldap-config.properties</code>文件用于不同的配置情况。</p><p id="78ce0ba7">在此页：</p><p id="4adae49d"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#TypicalLDAPConfigurations-BasicLDAPLogin">基本LDAP登录</a><ul class="list _bullet"><li class="list__item"><a href="#TypicalLDAPConfigurations-WindowsActiveDirectory">Windows Active Directory</a></li><li class="list__item"><a href="#TypicalLDAPConfigurations-Unix">Unix系统</a></li><li class="list__item"><a href="#TypicalLDAPConfigurations-SpecifyingBackupLDAPserver">指定备份LDAP服务器</a></li></ul></li><li class="list__item"><a href="#TypicalLDAPConfigurations-BasicLDAPLoginforUsersinSpecificLDAPGroupOnly">仅特定LDAP组中用户的基本LDAP登录</a></li><li class="list__item"><a href="#TypicalLDAPConfigurations-ActiveDirectoryWithUserDetailsSynchronization">具有用户详细信息同步的Active Directory</a></li><li class="list__item"><a href="#TypicalLDAPConfigurations-ActiveDirectoryWithUserDetailsSynchronizationandUserCreation">具有用户详细信息同步和用户创建的Active Directory</a></li><li class="list__item"><a href="#TypicalLDAPConfigurations-ActiveDirectoryWithGroupSynchronization">具有组同步的Active Directory</a><ul class="list _bullet"><li class="list__item"><a href="#TypicalLDAPConfigurations-Limitingthenumberofgroupstobesynchronized">限制要同步的组数</a></li></ul></li></ul><p></p><a name="BasicLDAPLogin"></a><a name="Basic-LDAP-Login"></a><div class="chapter"><h2 id="TypicalLDAPConfigurations-BasicLDAPLogin">基本LDAP登录</h2><p id="68fa7861">最小工作配置的示例如下。</p><a name="WindowsActiveDirectory"></a><a name="Windows-Active-Directory"></a><div class="chapter"><h3 id="TypicalLDAPConfigurations-WindowsActiveDirectory">Windows Active Directory</h3><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//dc.example.com：389 / DC = example，DC = com java.naming.security.principal = <username>java.naming.security.credentials = <password>teamcity.users.login.filter =（sAMAccountName = $ capturedLogin $）teamcity.users.username = sAMAccountName</password></username></div><p id="ba1e608b">注意<code class="code">sAMAccountName</code>限制为20个符号。您可能要使用另一个包含整个用户名的属性。</p></div><a name="Unix"></a><a name="Unix"></a><div class="chapter"><h3 id="TypicalLDAPConfigurations-Unix">Unix系统</h3><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//dc.example.com：389 / DC = example，DC = com java.naming.security.principal = <username>java.naming.security.credentials = <password>teamcity.users.login.filter =（uid = $ capturedLogin $）teamcity.users.username = uid</password></username></div><p id="11e736c5">在这种情况下，TeamCity不存储用户密码。每次用户登录时，都通过使用登录表单中输入的凭据直接登录LDAP来执行身份验证。</p></div><a name="SpecifyingBackupLDAPserver"></a><a name="Specifying-Backup-LDAP-server"></a><div class="chapter"><h3 id="TypicalLDAPConfigurations-SpecifyingBackupLDAPserver">指定备份LDAP服务器</h3><p id="e932f0da">您可以在<code class="code">java.naming.provider.url</code>属性如下：</p><div class="code-block" data-lang="bash">＃当第一台服务器关闭时，使用第二个URL。java.naming.provider.url = ldap：//example.com：389 / DC = example，DC = com ldap：//failover.example.com：389 / DC = example，DC = com</div></div></div><a name="BasicLDAPLoginforUsersinSpecificLDAPGroupOnly"></a><a name="Basic-LDAP-Login-for-Users-in-Specific-LDAP-Group-Only"></a><div class="chapter"><h2 id="TypicalLDAPConfigurations-BasicLDAPLoginforUsersinSpecificLDAPGroupOnly">仅特定LDAP组中用户的基本LDAP登录</h2><p id="842b8d0c">仅允许来自特定用户组的用户登录。用户只需要输入用户名（无域部分）即可登录。该示例适用于Windows Active Directory：</p><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//example.com：389 / DC = example，DC = com java.naming.security.principal = <username>java.naming.security.credentials = <password>＃仅过滤具有指定名称和所属的用户到DN为“ CN = Group1，CN = Users，DC = example，DC = com”的LDAP组“ Group1”， = Users，DC = example，DC = com））＃teamcity.users.username = sAMAccountName＃只允许用户名不带域（可选）teamcity.auth.loginFilter = [^ / \\\\ @] +＃不同步，只需登录。teamcity.options.users.synchronize = false teamcity.options.groups.synchronize = false</password></username></div></div><a name="ActiveDirectoryWithUserDetailsSynchronization"></a><a name="Active-Directory-With-User-Details-Synchronization"></a><div class="chapter"><h2 id="TypicalLDAPConfigurations-ActiveDirectoryWithUserDetailsSynchronization">具有用户详细信息同步的Active Directory</h2><p id="ed8efb41">用户可以使用不带域名的域名登录TeamCity，有一个帐户“ teamcity”，密码为“ secret”，可以读取所有Active Directory条目。TeamCity用户的显示名称和电子邮件是从Active Directory同步的。</p><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//example.com：389 / DC = example，DC = com java.naming.security.principal = CN = teamcity，CN = Users，DC = example，DC = com java。 naming.security.credentials =秘密teamcity.users.login.filter =（sAMAccountName = $ capturedLogin $）teamcity.users.username = sAMAccountName＃用户同步：打开，同步显示名称和电子邮件。teamcity.options.users.synchronize = true teamcity.users.filter =（objectClass = user）teamcity.users.property.displayName = displayName teamcity.users.property.email = mail</div></div><a name="ActiveDirectoryWithUserDetailsSynchronizationandUserCreation"></a><a name="Active-Directory-With-User-Details-Synchronization-and-User-Creation"></a><div class="chapter"><h2 id="TypicalLDAPConfigurations-ActiveDirectoryWithUserDetailsSynchronizationandUserCreation">具有用户详细信息同步和用户创建的Active Directory</h2><p id="f65c6770">用户可以使用不带域名的域名登录TeamCity，有一个帐户“ teamcity”，密码为“ secret”，可以读取所有Active Directory条目。TeamCity用户的显示名称和电子邮件是从Active Directory同步的。创建TeamCity数据库中不存在的用户。Active Directory中不再存在的用户将从TeamCity用户数据库中删除。</p><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//example.com：389 / DC = example，DC = com java.naming.security.principal = CN = teamcity，CN = Users，DC = example，DC = com java。 naming.security.credentials =秘密teamcity.users.login.filter =（sAMAccountName = $ capturedLogin $）teamcity.users.username = sAMAccountName＃用户同步：打开，同步显示名称和电子邮件。teamcity.options.users.synchronize = true teamcity.users.filter =（objectClass = user）teamcity.users.property.displayName = displayName teamcity.users.property.email = mail＃用户同步期间自动创建和删除用户teamcity.options .createUsers = true teamcity.options.deleteUsers = true</div></div><a name="ActiveDirectoryWithGroupSynchronization"></a><a name="Active-Directory-With-Group-Synchronization"></a><div class="chapter"><h2 id="TypicalLDAPConfigurations-ActiveDirectoryWithGroupSynchronization">具有组同步的Active Directory</h2><p id="0a1c98fb">应该有<code class="code">ldap-mapping.xml</code>文件，其中定义了一个或多个组映射。</p><p id="9c19257a"><code class="code">ldap-config.properties</code>文件：</p><div class="code-block" data-lang="none">java.naming.provider.url = ldap：//example.com：389 / DC = example，DC = com java.naming.security.principal = CN = teamcity，CN = Users，DC = example，DC = com java。 naming.security.credentials =秘密teamcity.users.login.filter =（sAMAccountName = $ capturedLogin $）teamcity.users.username = sAMAccountName＃用户同步已启用，同步显示名称和电子邮件。teamcity.options.users.synchronize = true teamcity.users.filter =（objectClass = user）teamcity.users.property.displayName = displayName teamcity.users.property.email = mail＃用户同步期间自动创建和删除用户teamcity.options .createUsers = true teamcity.options.deleteUsers = true＃组同步在teamcity.options.groups.synchronize = true＃组搜索LDAP过滤器，用于检索要进行同步的组。＃结果包括ldap-mapping.xml文件中配置的所有组。teamcity.groups.filter =（objectClass = group）＃存储其成员的组的LDAP属性。teamcity.groups.property.member =成员</div><a name="Limitingthenumberofgroupstobesynchronized"></a><a name="Limiting-the-number-of-groups-to-be-synchronized"></a><div class="chapter"><h3 id="TypicalLDAPConfigurations-Limitingthenumberofgroupstobesynchronized">限制要同步的组数</h3><p id="a558df70">的<code class="code">teamcity.users.filter</code>属性有助于限制用户同步期间处理的用户帐户的数量。</p><p id="fd0f4956">建议在Active Directory中创建“ TeamCity用户”组，并将所有必需的组包括在该组中，例如，您可能具有以下Active Directory结构：</p><ul class="list _ul"><li class="list__item" id="c614fd66"><p>具有成员用户1，用户2的组A</p></li><li class="list__item" id="d7443ab3"><p>组B，成员用户3，用户4</p></li><li class="list__item" id="c7811bf2"><p>组“ TeamCity用户”和组A，组B</p></li></ul><p id="b90f7d98">然后更新<code class="code">teamcity.users.filter</code>属性。例如，</p><div class="code-block" data-lang="bash">teamcity.users.filter =（＆（objectClass = user）（memberOf：1.2.840.113556.1.4.1941：= CN = TeamCity用户，OU =帐户，DC =域，DC = com））</div><p id="62e9435c">在这种情况下，仅当TeamCity是相应Active Directory组的成员时才创建帐户。支持嵌套组。</p><p id="643a42c7">另外，您可以列出几个组：</p><div class="code-block" data-lang="bash">teamcity.users.filter =（＆（objectClass = user）（|（memberOf = CN = GroupOne，OU = myou，DC = company，DC = tld）（memberOf = CN = GroupTwo，OU = myou，DC = company，DC = tld）））</div><p id="c4ff6016">为了限制可以登录TeamCity的用户，您还需要更改<code class="code">teamcity.users.login.filter</code>属性：</p><div class="code-block" data-lang="bash">teamcity.users.login.filter =（＆（sAMAccountName = $ capturedLogin $）（memberOf：1.2.840.113556.1.4.1941：= CN = TeamCity Users，OU =帐户，DC =域，DC = com））</div><p id="d8fa4a20">有关筛选器语法的更多详细信息，请参考<a href="https://msdn.microsoft.com/en-us/library/aa746475%28v=vs.85%29.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft文档</a> 。有关AD属性的更多详细信息，请参考<a href="https://msdn.microsoft.com/en-us/library/ms677980(v=vs.85).aspx" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft文档</a> 。</p><hr id="7a7eedf1"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>