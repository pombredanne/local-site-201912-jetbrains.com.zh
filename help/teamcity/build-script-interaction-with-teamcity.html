<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>与TeamCity建立脚本交互-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Build Script Interaction with TeamCity" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/extending-teamcity.md|Extending TeamCity/build-script-interaction-with-teamcity.md|Build Script Interaction with TeamCity" data-main-title="Build Script Interaction with TeamCity" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-script-interaction-with-teamcity.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-script-interaction-with-teamcity.md" data-toc="Build Script Interaction with TeamCity">与TeamCity建立脚本交互</h1><p id="a091b556">在此页：</p><p id="adec2a4d"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ServiceMessages">服务讯息</a><ul class="list _bullet"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Servicemessagesformats">服务消息格式</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Escapedvalues">转义值</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-CommonProperties">共同属性</a><ul class="list _bullet"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-MessageCreationTimestamp">消息创建时间戳</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-MessageFlowId">消息流编号</a></li></ul></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingMessagesForBuildLog">报告构建日志消息</a><ul class="list _bullet"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-BlocksofServiceMessages">服务消息块</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingCompilationMessages">报告编译消息</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingTests">报告测试</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Supportedtestservicemessages">支持的测试服务消息</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Nestedtestreporting">嵌套测试报告</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Interpretingtestnames">解释测试名称</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Reportingadditionaltestdata">报告其他测试数据</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Reporting.NETCodeCoverageResults">报告.NET代码覆盖率结果</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingInspections">报告检查</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Inspectiontype">检验类型</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Inspectioninstance">检验实例</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Example">例</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-PublishingArtifactswhiletheBuildisStillinProgress">在构建仍在进行时发布工件</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingBuildProgress">报告构建进度</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingBuildProblems">报告构建问题</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingBuildStatus">报告构建状态</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingBuildNumber">报告内部版本号</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-AddingorChangingaBuildParameter">添加或更改构建参数</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingBuildStatistics">报告构建统计</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-DisablingServiceMessagesProcessing">禁用服务消息处理</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ImportingXMLReports">导入XML报告</a></li></ul></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Cancelingbuildviaservicemessage">通过服务消息取消构建</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-LibrariesreportingresultsviaTeamCityServiceMessages">图书馆通过TeamCity服务消息报告结果</a></li></ul></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-teamcity-info.xml">teamcity-info.xml</a><ul class="list _bullet"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ModifyingtheBuildStatus">修改构建状态</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-ReportingCustomStatistics">报告自定义统计</a><ul class="list _bullet"><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Providingdatausingtheteamcity-info.xmlfile">使用teamcity-info.xml文件提供数据</a></li><li class="list__item"><a href="#BuildScriptInteractionwithTeamCity-Describingcustomcharts">描述自定义图表</a></li></ul></li></ul></li></ul><p></p><p id="53636d5b">如果TeamCity不支持您的测试框架或开箱即用，您仍然可以通过自定义构建脚本以与TeamCity服务器进行交互来利用TeamCity的许多优势。这为任何团队提供了广泛的功能，无论他们的测试框架和跑步者如何。其中一些功能包括显示实时测试结果和自定义统计信息，更改构建状态以及在构建完成之前发布工件。构建脚本交互可以通过以下方式实现：</p><ul class="list _ul"><li class="list__item" id="e89de66f"><p>构建脚本中的服务消息</p></li><li class="list__item" id="f361b24b"><p><code class="code">teamcity-info.xml</code>文件（过时的方法，请考虑改用服务消息）</p></li></ul><aside class="tip sideblock" rel="d2446546" id="ccd5170d" data-title=""><p id="6eb2ca04">如果使用MSBuild构建运行程序，则可以使用<a href="msbuild-service-tasks.html">MSBuild服务任务</a> 。</p></aside><a name="ServiceMessages"></a><a name="Service-Messages"></a><div class="chapter"><h2 id="BuildScriptInteractionwithTeamCity-ServiceMessages">服务讯息</h2><p id="5910c6cb">服务消息是特殊构造的文本，用于将有关构建的命令/信息从构建脚本传递到TeamCity服务器。</p><p id="ed5b7ac0">要由TeamCity处理， <b id="c7147b51">需要将它们写入构建的标准输出流，即从构建步骤打印或回显</b> 。建议每行输出一条服务消息（即用换行符号分隔消息）</p><p id="4a04dac6">例子：</p><p id="af1c1ede">视窗</p><div class="code-block" data-lang="bash">回声## teamcity [ <messagename>'value']</messagename></div><p id="686624f9">的Linux</p><div class="code-block" data-lang="bash">回声“ ## teamcity [ <messagename>'值']”</messagename></div><p id="10342b98">PowerShell脚本</p><div class="code-block" data-lang="bash">写主机“ ## teamcity [ <messagename>'value']”</messagename></div><p id="5b9c0952">单个服务消息中不能包含换行符，也不能跨多行。</p><a name="Servicemessagesformats"></a><a name="Service-messages-formats"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-Servicemessagesformats">服务消息格式</h3><p id="bc572f4f">服务消息支持两种格式：</p><ul class="list _ul"><li class="list__item" id="77c68585"><p id="d97ab6b6">单一属性消息：</p><div class="code-block" data-lang="bash">## teamcity [ <messagename>'value']</messagename></div></li><li class="list__item" id="7002b134"><p id="a76737f5">多属性消息：</p><div class="code-block" data-lang="bash">## teamcity [ <messagename>name1 ='</messagename> value1'name2 <messagename>='value2']</messagename></div><p id="a858c4d4">多个属性消息可以更正式地描述为：</p><div class="code-block" data-lang="bash">## teamcity [messageNameWSPpropertyNameOWSP = OWSP'value'WSPpropertyName_IDOWSP = OWSP'value'...OWSP]</div></li></ul><p id="e4d74554">哪里：</p><ul class="list _ul"><li class="list__item" id="c2746792"><p><b id="51936767">messageName</b>是消息的名称。请参阅下面的受支持消息。消息名称应为有效的Java ID（仅字母数字字符和“-”，以字母字符开头）</p></li><li class="list__item" id="6e988301"><p><b id="e942d3cf">propertyName</b>是消息属性的名称。应该是有效的Java ID。</p></li><li class="list__item" id="52d9c0fc"><p><b id="d1909a05">值</b>是属性的值。应为<i id="65b4f160">转义</i>值（请参见下文）。</p></li><li class="list__item" id="02a1539c"><p><b id="be311b63">WSP</b>是必需的空格：空格或制表符（\ t）</p></li><li class="list__item" id="b32cd99d"><p><b id="a0f2543b">OWSP</b>是一个可选的空格</p></li><li class="list__item" id="93c47471"><p><b id="dead261a">...</b>是任意数量的<code class="code">WSPpropertyNameOWSP=OWSP'value'</code>块</p></li></ul></div><a name="Escapedvalues"></a><a name="Escaped-values"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-Escapedvalues">转义值</h3><p id="2f5bbb16">对于转义的值，TeamCity使用竖线“ |”作为逃脱角色。为了让TeamCity服务器正确解释某些字符，必须在它们前面加上竖线。例如，以下消息：</p><div class="code-block" data-lang="bash">## teamcity [testStarted name ='foo |'s test']</div><p id="39c2098b">将在TeamCity中显示为“ foo's test”。请参阅下面的转义值表。</p><div class="table-wrapper"><table width="100%" id="930bcf43"><thead><tr id="2025c24a" class="ijRowHead"><th id="70a07c1d"><p id="4965ec37">字符</p></th><th id="ca935c50"><p id="aa82a4ff">转义为</p></th></tr></thead><tbody><tr id="1eb5c119" class="ijRowOdd"><td id="c5651078"><p id="0b7f17ad">'（撇号）</p></td><td id="91c487d1"><p id="c10a4377">|'</p></td></tr><tr id="0e93395f" class="ijRowEven"><td id="f22624ff"><p id="5fa54cea">\ n（换行符）</p></td><td id="a1b6c2d0"><p id="2925c1e4">| n</p></td></tr><tr id="e13ea2e0" class="ijRowOdd"><td id="5cf48957"><p id="fa026af3">\ r（回车）</p></td><td id="1cd3356a"><p id="f4f63b0e">| r</p></td></tr><tr id="826d4c32" class="ijRowEven"><td id="b69f60a9"><p id="64c763a5">\ uNNNN（代码为0xNNNN的Unicode符号）</p></td><td id="d941757d"><p id="e35ec65c">| 0xNNNN</p></td></tr><tr id="9e025f3a" class="ijRowOdd"><td id="4016e5c7"><p id="063327c3">| （竖线）</p></td><td id="969e85f5"><p id="33dc136a">||</p></td></tr><tr id="a9d99f40" class="ijRowEven"><td id="0dbad916"><p id="d764d5c4">[（开括号）</p></td><td id="d1afd95e"><p id="3403411a">| [</p></td></tr><tr id="ada18dc7" class="ijRowOdd"><td id="9c1d428f"><p id="2337772a">]（右括号）</p></td><td id="1dcce9d9"><p id="b80d4859">|]</p></td></tr></tbody></table></div></div><a name="CommonProperties"></a><a name="Common-Properties"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-CommonProperties">共同属性</h3><p id="04831694">任何“消息和多个属性”消息都支持以下可选属性列表： <code class="code">timestamp</code> ， <code class="code">flowId</code> 。在以下示例中<code class="code"><messageName></code>是特定服务消息的名称。</p><a name="MessageCreationTimestamp"></a><a name="Message-Creation-Timestamp"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-MessageCreationTimestamp">消息创建时间戳</h4><div class="code-block" data-lang="bash">## teamcity [ <messagename>timestamp ='timestamp'...]

</messagename></div><p id="39dda35b">时间戳格式为<code class="code">yyyy-MM-dd'T'HH:mm:ss.SSSZ</code>要么<code class="code">yyyy-MM-dd'T'HH:mm:ss.SSS</code>根据<a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/text/SimpleDateFormat.html" rel="noopener noreferrer" data-external="true" target="_blank">Java SimpleDateFormat语法</a> 。</p><p id="dc2dfcd4">例：</p><div class="code-block" data-lang="bash">## teamcity [ <messagename>timestamp ='2008-09-03T14：02：34.487 + 0400'...]## teamcity [ <messagename>timestamp ='2008-09-03T14：02：34.487'...]

</messagename></messagename></div><p id="81997c6e">对于.NET <a href="https://msdn.microsoft.com/en-us/library/az4se3k1(v=vs.110).aspx" rel="noopener noreferrer" data-external="true" target="_blank">DateTimeOffset</a> ，像这样的代码</p><div class="code-block" data-lang="none">var date = DateTimeOffset。现在; var timestamp = $“ {date：yyyy-MM-dd'T'HH：mm：ss.fff} {date。偏移量。滴答声：+;-;} {日期。偏移：hhmm}“;</div><p id="55e1fad6">将导致</p><div class="code-block" data-lang="bash">## teamcity [ <messagename>timestamp ='2008-09-03T14：02：34.487 + 0400'...]

</messagename></div></div><a name="MessageFlowId"></a><a name="Message-FlowId"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-MessageFlowId">消息流编号</h4><p id="5413b402">flowId是构建中消息流的唯一标识符。例如，必须进行流跟踪以区分并行运行的单独进程。标识符是一个字符串，在单个构建的范围内应该是唯一的。</p><div class="code-block" data-lang="bash">## teamcity [ <messagename>flowId ='flowId'...]

</messagename></div></div></div><a name="ReportingMessagesForBuildLog"></a><a name="Reporting-Messages-For-Build-Log"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-ReportingMessagesForBuildLog">报告构建日志消息</h3><p id="ae62560d">您可以通过以下方式报告构建日志的消息：</p><div class="code-block" data-lang="bash">## teamcity [message text =' <message text="">'errorDetails =' <error details="">'status =' <status value="">']</status></error></message></div><p id="ae9c329f">哪里：</p><ul class="list _ul"><li class="list__item" id="51c34be7"><p>的<code class="code">status</code>属性可以采用以下值： <code class="code">NORMAL</code> ， <code class="code">WARNING</code> ， <code class="code">FAILURE</code> ， <code class="code">ERROR</code> 。默认值为<code class="code">NORMAL</code> 。</p></li><li class="list__item" id="3f0031cc"><p>的<code class="code">errorDetails</code>该属性仅在以下情况下使用<code class="code">status</code>是<code class="code">ERROR</code> ，在其他情况下将被忽略。如果其状态为，则此消息将使构建失败<code class="code">ERROR</code>并在构建配置的“ <a href="build-failure-conditions.html">构建失败条件”</a>页面上选中了“如果构建运行程序记录了错误消息，则<a href="build-failure-conditions.html">构建失败</a> ”框。例如：</p></li></ul><div class="code-block" data-lang="bash">## teamcity [消息文本='异常文本'errorDetails ='堆栈跟踪'状态='错误']</div><a name="BlocksofServiceMessages"></a><a name="Blocks-of-Service-Messages"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-BlocksofServiceMessages">服务消息块</h4><p id="97d2cf4a">块用于将构建日志中的多个消息分组。</p><p id="31587ff1">区块开放：</p><p id="fe9de031">的<code class="code">blockOpened</code>系统消息允许<code class="code">name</code>属性，您也可以在<code class="code">blockOpened</code>信息：</p><div class="code-block" data-lang="bash">## teamcity [blockOpened name =' <blockname>'description =' <this is="" the="" description="" of="" blockname="">']</this></blockname></div><p id="c2b0052f">块关闭：</p><div class="code-block" data-lang="bash">## teamcity [blockClosed name =' <blockname>']</blockname></div><aside class="note " rel="6e341375" id="ba0b350b" data-title=""><p id="96428b4c">请注意，当您关闭该块时，所有内部块都会自动关闭。</p></aside></div><a name="ReportingCompilationMessages"></a><a name="Reporting-Compilation-Messages"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingCompilationMessages">报告编译消息</h4><div class="code-block" data-lang="bash">## teamcity [compilationStarted编译器=' <compiler name="">'] ...## teamcity [消息文本='编译器输出'] ## teamcity [消息文本='编译器输出'] ## teamcity [消息文本='编译器错误'status ='ERROR'] ...## teamcity [compilationFinished编译器=' <compiler name="">']</compiler></compiler></div><p id="9f94157d">哪里：</p><ul class="list _ul"><li class="list__item" id="37eaec92"><p><code class="code">compiler name</code>是执行编译的编译器的任意名称，例如。 javac，groovyc等。当前，它在构建日志中用作块名。</p></li><li class="list__item" id="69fe9605"><p>任何带有状态的消息<code class="code">ERROR</code>报道之间<code class="code">compilationStarted</code>和<code class="code">compilationFinished</code>将被视为编译错误。</p></li></ul></div><a name="ReportingTests"></a><a name="Reporting-Tests"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingTests">报告测试</h4><p id="f2871f3d">要使用TeamCity即时测试报告，测试框架需要对此功能的专门支持才能工作（或者，可以使用<a href="xml-report-processing.html">XML报表处理</a> ）。如果TeamCity本身不支持您的测试框架，则可以修改构建脚本以使用服务消息将测试运行报告给TeamCity服务器。这样就可以实时显示测试结果，并在<a href="working-with-build-results.html#All-Tests">“构建结果”页面</a>的“ <a href="working-with-build-results.html#All-Tests">测试”选项卡上</a>提供测试信息。</p></div><a name="Supportedtestservicemessages"></a><a name="Supported-test-service-messages"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Supportedtestservicemessages">支持的测试服务消息</h4><p id="49808a97"><b id="47eacc1a">测试套件消息：</b>测试套件用于对测试进行分组。TeamCity在<a href="working-with-build-results.html#All-Tests">“构建结果”页面</a>的“ <a href="working-with-build-results.html#All-Tests">测试”选项卡上</a>以及其他位置显示按套件分组的<a href="working-with-build-results.html#All-Tests">测试</a> 。</p><div class="code-block" data-lang="bash">## teamcity [testSuiteStarted name ='suiteName'] <individual test="" messages="" go="" here="">## teamcity [testSuiteFinished name ='suiteName']</individual></div><p id="7a2e8f31">所有单独的测试消息都将在<code class="code">testSuiteStarted</code>和<code class="code">testSuiteFinished</code> （按此顺序）具有相同的<code class="code">name</code>属性。</p></div><a name="Nestedtestreporting"></a><a name="Nested-test-reporting"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Nestedtestreporting">嵌套测试报告</h4><p id="cb482088"><b id="fcfe8b22">在TeamCity 9.1之前</b> ，可能已经在另一个测试中报告了一个测试（请参阅本节末尾的示例）。在更高版本中，启动另一个测试将以相同的“流程”完成当前启动的测试。要仍然从其他测试中报告测试，则需要在嵌套的测试服务消息中指定另一个<a href="#Message-FlowId">flowId</a> 。</p><p id="e68f3506"><b id="e088926d">测试开始/停止消息：</b></p><div class="code-block" data-lang="bash">## teamcity [testStarted name ='testName'captureStandardOutput =' <true false="">'] <here name="" go="" all="" the="" test="" service="" messages="" with="" same="">## teamcity [testFinished name ='testName'duration =' <test_duration_in_milliseconds>']</test_duration_in_milliseconds></here></true></div><p id="1c10d3e7">指示测试“ <i id="51b0bf21">testName</i> ”已运行。如果<code class="code">testFailed</code>消息不存在，则认为测试成功，其中</p><ul class="list _ul"><li class="list__item" id="fd6d3c6e"><p><b id="a1f61f5f">持续时间</b> （可选的数字属性）-设置要在TeamCity UI中报告的测试持续时间（以毫秒为单位）（应为整数）。如果省略，则测试持续时间将根据消息时间戳计算。如果缺少时间戳，则从服务器上收到消息的实际时间开始。</p></li><li class="list__item" id="bf269b10"><p><b id="ecce59c5">captureStandardOutput</b> （可选的boolean属性）-如果<code class="code">true</code> ，之间的所有标准输出（和标准错误）消息<code class="code">testStarted</code>和<code class="code">testFinished</code>消息将被视为测试输出。默认值为<code class="code">false</code>并假设使用<code class="code">testStdOut</code>和<code class="code">testStdErr</code>服务消息以报告测试输出。</p></li></ul><aside class="note " rel="8b2361cc" id="caefba13" data-title=""><p id="8f46425a">所有其他测试消息（除了<code class="code">testIgnored</code> ）相同<code class="code">name</code>属性应该出现在<code class="code">testStarted</code>和<code class="code">testFinished</code>消息（按此顺序）。</p><p id="bf9044e4">如果使用Ant的<i id="8ff6b670">echo</i>任务输出消息，请确保在与同一测试/测试套件相关的所有消息中包括具有相同值的<i id="e67ff672">flowId</i>属性，否则它们<a href="http://jetbrains.net/tracker/issue/TW-5059" rel="noopener noreferrer" data-external="true" target="_blank">将无法正确处理</a> 。</p></aside><p id="75f04bb9">强烈建议您确保<code class="code">test suite</code> + <code class="code">test name</code>在构建中是唯一的。为了使与TeamCity测试相关的高级功能正常工作，测试名称不应从一个内部版本偏移到另一个内部版本（在每个内部版本中，必须以相同的名称报告单个测试）。<b id="6fd6a406">强烈建议不要</b>在报告的测试名称中包含绝对路径。</p><p id="93793a20"><b id="a5f71d36">忽略的测试：</b></p><div class="code-block" data-lang="bash">## teamcity [testIgnored name ='testName'message ='ignore comment']</div><p id="e05cd2cd">表示测试“ <code class="code">testName</code> ”存在，但未被测试框架运行（被忽略）。作为例外， <code class="code">testIgnored</code>可以报告没有匹配的消息<code class="code">testStarted</code>和<code class="code">testFinished</code>消息。</p><p id="b3dc6327"><b id="4232f243">测试输出：</b></p><div class="code-block" data-lang="bash">## teamcity [testStarted name ='className.testName'] ## teamcity [testStdOut name ='className.testName'out ='text'] ## teamcity [testStdErr name ='className.testName'out ='错误文本'] ## teamcity [testFinished name ='className.testName'duration = '50']</div><p id="6b49a690">的<code class="code">testStdOut</code>和<code class="code">testStdErr</code>服务消息报告要在TeamCity UI中显示的测试标准和错误输出。只能有一个<code class="code">testStdOut</code>还有一个<code class="code">testStdErr</code>每个测试的消息。一种替代但不太可靠的方法是使用<code class="code">captureStandardOutput</code>的属性<code class="code">testStarted</code>信息。</p><p id="721c8bf1"><b id="06ad3122">测试结果：</b></p><div class="code-block" data-lang="bash">## teamcity [testStarted name ='MyTest.test1'] ## teamcity [testFailed name ='MyTest.test1'message ='failure message'details ='消息和堆栈跟踪'] ## teamcity [testFinished name ='MyTest。 test1'] ## teamcity [testStarted name ='MyTest.test2'] ## teamcity [testFailed type ='comparisonFailure'name ='MyTest.test2'message ='failure message'details ='消息和堆栈跟踪'期望='期望值'actual ='actual value'] ## teamcity [testFinished name ='MyTest.test2']</div><p id="a903a0ef">指示“ <i id="9cae59a6">testname</i> ”测试失败。只有一个<code class="code">testFailed</code>对于给定的测试名称，可能会出现消息。</p><ul class="list _ul"><li class="list__item" id="2d6ba55c"><p><code class="code">message</code>包含错误的文字表示</p></li><li class="list__item" id="15a2e695"><p><code class="code">details</code>包含有关测试失败的详细信息，通常是消息和异常stacktrace。</p></li><li class="list__item" id="cdfae898"><p><code class="code">actual</code>和<code class="code">expected</code>属性只能与<code class="code">type='comparisonFailure'</code>报告比较失败。在IDE中打开测试时将使用这些值。</p></li></ul><p id="9255aaea">这是带有服务消息的测试报告的更长的示例：</p><div class="code-block" data-lang="bash">## teamcity [testSuiteStarted name ='suiteName'] ## teamcity [testSuiteStarted name ='nestedSuiteName'] ## teamcity [testStarted name ='package_or_namespace。班级名称。TestName'] ## teamcity [testFailed name ='package_or_namespace。班级名称。TestName'message ='数字应为20000'details ='junit.framework。AssertionFailedError：预期：<20000>，但在junit.framework中为：<10000> | n | r。在junit.framework的Assert.fail（Assert.java:47）| n | r。Assert.failNotEquals（Assert.java:280）| n | r ...'] ## teamcity [testFinished name ='package_or_namespace。班级名称。TestName'] ## teamcity [testSuiteFinished name ='nestedSuiteName'] ## teamcity [testSuiteFinished name ='suiteName']</div></div><a name="Interpretingtestnames"></a><a name="Interpreting-test-names"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Interpretingtestnames">解释测试名称</h4><p id="a224199e">完整的测试名称可以采用以下形式： <code class="code"><suite name>:<package/namespace name>.<class name>.<test method>(<test parameters>)</code> ，</p><p id="4e31e56b">名称中<class name=""><test method="">不能有点。仅<test method="">是完整测试名称的强制性部分。</test></test></class></p><p id="1a08752b">完整的测试名称用于比较后续构建之间的测试或跨不同构建配置的匹配测试。</p><p id="67c91a79">完整测试名称的示例是</p><div class="code-block" data-lang="none">集成测试：后端：org.jetbrains.teamcity。LoginPageController.testBadPassword（“ invalid password”，false）//在上面的示例中，//套件名称=“集成测试：后端” //包= org.jetbrains.teamcity //类名= LoginPageController //测试方法= testBadPassword //测试参数=（“密码错误”，false）</div><p id="f5e4a981">“ <a href="working-with-build-results.html#Tests">构建结果”页面的</a> “ <a href="working-with-build-results.html#Tests">测试”选项卡</a>允许按套件，程序包/命名空间，类和测试进行分组。通常，提供属性值是因为它们由您的测试框架报告，并且TeamCity能够正确解释测试名称。</p><p id="120db23a">如果无法以上述形式解析测试，TeamCity仍将尝试<suite name="">从完整的测试名称中</suite>提取<suite name="">出来以进行“测试”选项卡上的过滤，并将套件后的所有内容都视为不可解析的测试名称。</suite></p></div><a name="Reportingadditionaltestdata"></a><a name="Reporting-additional-test-data"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Reportingadditionaltestdata">报告其他测试数据</h4><p id="5db1289e"><b id="0efff748">从TeamCity 2018.2开始</b> ，可以使用<code class="code">testMetadata</code>服务消息。有关更多详细信息，请参见<a href="reporting-test-metadata.html">单独的页面</a> 。</p></div><a name="Reporting.NETCodeCoverageResults"></a><a name="Reporting-.NET-Code-Coverage-Results"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Reporting.NETCodeCoverageResults">报告.NET代码覆盖率结果</h4><p id="64937d6c">您可以通过服务消息配置.NET Coverage处理。要了解更多信息，请参阅“ <a href="manually-configuring-reporting-coverage.html">手动配置报告范围”</a>页面。</p></div><a name="ReportingInspections"></a><a name="Reporting-Inspections"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingInspections">报告检查</h4><p id="49737a8b">您可以使用下面描述的服务消息，将自定义工具中的检查报告给TeamCity。</p><p id="7a62bcac">在其他用途中，检查次数可用作构建度量标准，以<a href="build-failure-conditions.html#Fail-build-on-metric-change">使构建失败</a> 。</p></div><a name="Inspectiontype"></a><a name="Inspection-type"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Inspectiontype">检验类型</h4><p id="cb6f78f8">每个特定警告或代码错误（检查实例）均具有检查类型-所执行检查的唯一描述，可以通过以下方式报告：</p><div class="code-block" data-lang="bash">## teamcity [inspectionType id =' <id>'name =' <name>'description =' <description>'category =' <category>']</category></description></name></id></div><p id="e5a82621">其中所有属性都是必需的，并且可以具有数字或文本值</p><ul class="list _ul"><li class="list__item" id="ffc1801b"><p><code class="code">id</code> -（必填），最多255个字符</p></li><li class="list__item" id="63f6f2f9"><p><code class="code">name</code> -（必填），最多255个字符</p></li><li class="list__item" id="106c552d"><p><code class="code">category</code> -（必填）限制为255个字符。的<code class="code">category</code>属性示例包括“样式违规”和“呼叫合同”。</p></li><li class="list__item" id="dd6cd15a"><p><code class="code">description</code> -（必填）限制为4000个字符。描述也可以是HTML。例如，</p></li></ul><div class="code-block" data-lang="markup">
报告不必要的局部变量，这些变量不会增加方法的可理解性。捕获的变量包括立即返回的局部变量，立即分配给另一个变量然后不使用的局部变量以及始终与另一个局部变量或参数具有相同值的局部变量。
<!-- tooltip end -->
<p>使用下面的第一个复选框，使此检查忽略立即返回或引发的变量。一些编码样式建议使用此类变量，以简化和调试。
</p><p>使用下面的第二个复选框，使该检查忽略带注释的变量。
</p><p>
</p>


</div></div><a name="Inspectioninstance"></a><a name="Inspection-instance"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Inspectioninstance">检验实例</h4><p id="42ed4d16">报告特定的缺陷，警告，错误消息。包括位置，描述以及各种可选和自定义属性。</p><div class="code-block" data-lang="bash">## teamcity [检查typeId =' <inspection type="" identity="">'message =' <instance description="">'file =' <file path="">'line =' <line>'其他属性=' <additional attribute="">']</additional></line></file></instance></inspection></div><p id="e556e3c0">其中所有属性都可以具有数字或文本值：</p><ul class="list _ul"><li class="list__item" id="6f244616"><p><code class="code">typeId</code> -（强制性），提及<code class="code">inspectionType.id</code> <a href="#Inspection-type">上述</a>限制为255个字符</p></li><li class="list__item" id="afb419cf"><p><code class="code">message</code> -（可选）当前实例描述，限制为4000个字符</p></li><li class="list__item" id="5f48f1ed"><p><code class="code">file</code> -（强制性）文件路径限制为4000个字符。该路径可以是绝对路径，也可以是相对于<a href="build-checkout-directory.html">checkout目录</a>的路径</p></li><li class="list__item" id="c3d36be0"><p><code class="code">line</code> -（可选）文件行，整数</p></li><li class="list__item" id="29eb3715"><p><code class="code">additional attribute</code> -可以是任何属性， <code class="code">SEVERITY</code>在这里经常使用，具有以下值之一（请注意大写）： <code class="code">INFO</code> ， <code class="code">ERROR</code> ， <code class="code">WARNING</code> ，<code class="code">WEAK WARNING</code></p></li></ul></div><a name="Example"></a><a name="Example"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Example">例</h4><div class="code-block" data-lang="bash">## teamcity [inspectionType id ='UnnecessaryLocalVariable'name ='Redundant local variable'description ='报告不必要的局部变量...
'category ='数据流问题'] ## teamcity [检查typeId ='UnnecessaryLocalVariable'message ='本地变量<code>i</code>是多余的'file ='src / Test.java'line = '19'SEVERITY ='WARNING']</div></div><a name="PublishingArtifactswhiletheBuildisStillinProgress"></a><a name="Publishing-Artifacts-while-the-Build-is-Still-in-Progress"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-PublishingArtifactswhiletheBuildisStillinProgress">在构建仍在进行时发布工件</h4><p id="edd8ae82">您可以在构建仍在运行时，在构建工件后立即发布构建工件。</p><p id="35f3f652">为此，您需要输出以下行：</p><div class="code-block" data-lang="bash">## teamcity [publishArtifacts' <path>']</path></div><p id="012af72c">的<code class="code"><path></code>必须遵循与“构建配置”设置的“ <a href="configuring-general-settings.html#Artifact-Paths">构建工件”规范</a>相同的规则。与匹配的文件<code class="code"><path></code>将被上传并显示为正在运行的构建的工件。</p><p id="2b0cdeda">在所有文件准备好并且没有文件被锁定读取之后，应该打印该消息。</p><p id="ef87664d">工件会在后台上传，这可能需要一些时间。确保在构建结束之前不删除匹配的文件（例如，您可以将它们放置在下次构建开始时清理的目录中的<a href="how-to.html#Make-Temporary-Build-Files-Erased-between-the-Builds">temp目录中</a> ，或者在构建之后使用<a href="build-files-cleaner-swabra.html">Swabra对其</a>进行清理）。</p><aside class="note " rel="ef87664d" id="a0fbd64b" data-title=""><p id="4cfc8751">发布工件的过程会影响构建，因为它消耗网络流量和一些磁盘/ CPU资源（对于不大的文件/目录，应该可以忽略不计）。</p></aside><p id="43dac763">在构建配置设置中指定的工件将照常发布。</p></div><a name="ReportingBuildProgress"></a><a name="Reporting-Build-Progress"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingBuildProgress">报告构建进度</h4><p id="1ef4ecdd">您可以使用特殊的进度消息在构建脚本中标记长期运行的零件。这些消息将显示在相应构建的项目仪表板上以及“ <a href="working-with-build-results.html">构建结果”页面上</a> 。</p><p id="38a29157">要记录单个进度消息，请使用：</p><div class="code-block" data-lang="bash">## teamcity [progressMessage' <message>']</message></div><p id="6171e6c7">该进度消息将一直显示，直到出现另一个进度消息或直到下一个目标启动为止（对于Ant构建而言）。</p><p id="0a8b1670">如果只希望显示一部分构建的进度消息，请使用：</p><div class="code-block" data-lang="bash">## teamcity [progressStart' <message>'] ...一些构建活动...## teamcity [progressFinish' <message>']</message></message></div><aside class="note " rel="deaff1b6" id="948a3ac2" data-title=""><p id="5a5dace8">两者都应使用相同的消息<code class="code">progressStart</code>和<code class="code">progressFinish</code> 。这允许嵌套进度块。另请注意，在构建Ant的情况下，如果启动Ant目标，则将替换进度消息。</p></aside></div><a name="ReportingBuildProblems"></a><a name="Reporting-Build-Problems"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingBuildProblems">报告构建问题</h4><p id="a03c41aa">要直接从构建脚本中使构建失败，必须报告一个构建问题。生成问题出现在“ <a href="working-with-build-results.html">生成结果”</a>页面上，并且还会影响<a href="working-with-build-results.html">生成</a>状态文本。要将生成问题添加到生成中，请使用：</p><div class="code-block" data-lang="bash">## teamcity [buildProblem description =' <description>'identity =' <identity>']</identity></description></div><p id="3a8ec47f">哪里：</p><ul class="list _ul"><li class="list__item" id="a0d34316"><p><code class="code">description</code> （强制性）：描述构建问题的易于理解的纯文本。默认情况下， <code class="code">description</code>出现在构建状态文本和构建问题列表中。文本限制为4000个符号，如果超出限制，该文本将被截断。</p></li><li class="list__item" id="5df22eaa"><p><code class="code">identity</code> （可选）：唯一的问题ID。不同的问题必须具有不同的身份，相同的问题–相同的身份，如果发生相同的问题（例如，发生相同的编译错误），则在整个构建中不应更改。它必须是有效的Java ID，最多60个字符。如果省略，则<code class="code">identity</code>是根据<code class="code">description</code>文本。</p></li></ul></div><a name="ReportingBuildStatus"></a><a name="Reporting-Build-Status"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingBuildStatus">报告构建状态</h4><p id="00787556">TeamCity允许从构建脚本更改<b id="b6a0b53d">构建状态文本</b> 。与<a href="#Reporting-Build-Progress">进度消息</a>不同，即使在构建完成后，此更改仍然存在。<br>您还可以将失败构建的构建状态更改为<code class="code">SUCCESS</code> 。</p><aside class="tip sideblock" rel="00787556" id="84541b84" data-title=""><p id="99250007">在TeamCity 7.1之前，此服务消息还可用于将构建状态更改为<code class="code">FAILURE</code> 。在更高的TeamCity版本中， <a href="#Reporting-Build-Problems"><code class="code">buildProblem</code></a>服务消息必须用于此目的。</p></aside><p id="5cffe6dc">要设置状态和/或更改构建状态的文本（例如，如果TeamCity不支持测试框架，请注意失败的测试数量），请使用<code class="code">buildStatus</code>具有以下格式的消息：</p><div class="code-block" data-lang="bash">## teamcity [buildStatus status =' <status_value>'text ='{build.status.text}和一些补充文字']</status_value></div><p id="2444ecf7">哪里：</p><ul class="list _ul"><li class="list__item" id="bbf8cae9"><p><code class="code">status</code> （可选）：使用<code class="code">SUCCESS</code>值将构建状态更改为<i id="4efbdd45">成功</i> 。</p></li><li class="list__item" id="f079f2b4"><p><code class="code">text</code> （强制性）：设置新的构建状态文本。<br>（可选）文本可以使用<code class="code">{build.status.text}</code>替换模式，它表示TeamCity使用传递的测试计数，编译消息等自动计算的状态。<br>状态集将在构建运行时显示，并且还将影响最终的构建结果。</p></li></ul></div><a name="ReportingBuildNumber"></a><a name="Reporting-Build-Number"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingBuildNumber">报告内部版本号</h4><p id="13c4b009">要直接设置自定义内部版本号，请指定一个<code class="code">buildNumber</code>使用以下格式的消息：</p><div class="code-block" data-lang="bash">## teamcity [buildNumber' <new build="" number="">']</new></div><p id="d6f3dad6">在<new build="" number="">值中，您可以使用<code class="code">{build.number}</code>替换以使用TeamCity自动生成的当前内部版本号。例如：</new></p><div class="code-block" data-lang="bash">## teamcity [buildNumber'1.2.3_ {build.number} -ent']</div></div><a name="AddingorChangingaBuildParameter"></a><a name="Adding-or-Changing-a-Build-Parameter"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-AddingorChangingaBuildParameter">添加或更改构建参数</h4><p id="3577943e">通过在构建脚本中使用专用服务消息，可以从构建步骤动态更新构建权限的构建参数（这些参数需要在构建配置的“ <a href="configuring-build-parameters.html">参数”部分</a>中定义）。修改后的构建步骤中将提供已更改的构建参数。它们也可以作为构建参数使用，并且可以通过以下方式在依赖的构建中使用<a href="predefined-build-parameters.html#Dependencies-Properties"><code class="code">%dep.*% parameter references</code></a> ， 例如：</p><div class="code-block" data-lang="bash">## teamcity [setParameter name ='ddd'value ='fff']</div><p id="5b70296f">指定构建参数的名称时，请注意前缀：</p><ul class="list _ul"><li class="list__item" id="84793124"><p><b id="36039edd">系统</b>的系统属性。</p></li><li class="list__item" id="6a4020f4"><p><b id="c55ff0a8">env</b>用于环境变量。</p></li><li class="list__item" id="e682e17c"><p>配置参数没有前缀。</p></li></ul><p id="6920471c"><a href="configuring-build-parameters.html">阅读</a>有关构建参数及其前缀的<a href="configuring-build-parameters.html">更多</a>信息。</p></div><a name="ReportingBuildStatistics"></a><a name="Reporting-Build-Statistics"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ReportingBuildStatistics">报告构建统计</h4><p id="95b1c1a1">在TeamCity中，可以配置构建脚本以报告统计数据，然后基于该数据显示图表。请参阅“ <a href="customizing-statistics-charts.html#Modifying-Pre-defined-Project-level-Charts">定制统计图”</a>页面，以获取有关在Web UI上显示图表的指南。本节介绍如何通过服务消息报告构建脚本中的统计数据。您可以通过两种方式发布构建静态值：</p><ul class="list _ul"><li class="list__item" id="1f9d8820"><p>直接在构建脚本中使用服务消息</p></li><li class="list__item" id="6828d8fd"><p><a href="#Providing-data-using-the-teamcity-info.xml-file">使用teamcity-info.xml文件提供数据</a><br>要使用服务消息报告构建统计信息，请执行以下操作：指定“ <code class="code">buildStatisticValue</code>您要报告的每个统计值的格式为'的服务消息：</p></li></ul><div class="code-block" data-lang="bash">## teamcity [buildStatisticValue key =' <valuetypekey>'value =' <value>']</value></valuetypekey></div><p id="bdff3b90">哪里</p><ul class="list _ul"><li class="list__item" id="a29d3880"><p>的<code class="code">key</code>不应等于任何<a href="custom-chart.html#Default-Statistics-Values-Provided-by-TeamCity">预定义的键</a> 。</p></li><li class="list__item" id="6ebd5f46"><p>的<code class="code">value</code>应该是最多13位数字的正/负整数；还支持不超过6位小数的float值。</p></li></ul></div><a name="DisablingServiceMessagesProcessing"></a><a name="Disabling-Service-Messages-Processing"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-DisablingServiceMessagesProcessing">禁用服务消息处理</h4><p id="29fbd8ff">如果出于某种原因需要在输出中禁用搜索服务消息，则可以禁用带有消息的服务消息搜索：</p><div class="code-block" data-lang="bash">## teamcity [enableServiceMessages] ## teamcity [disableServiceMessages]</div><p id="70abf87d">在这两者之间出现的任何消息都不会被解析为服务消息，并且会被有效地忽略。对于服务消息的服务器端处理，启用/禁用服务消息还支持flowId属性，并且将仅忽略具有相同flowId的消息。</p></div><a name="ImportingXMLReports"></a><a name="Importing-XML-Reports"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-ImportingXMLReports">导入XML报告</h4><p id="651007fd">除了<a href="xml-report-processing.html">UI构建功能外</a> ，还可以在构建脚本中借助XML报告来配置XML报告。 <code class="code">importData</code>服务消息。此外，该消息还支持导入先前收集的代码覆盖率和代码检查/重复报告。</p><p id="0dc4d70e">服务消息格式为：</p><div class="code-block" data-lang="bash">## teamcity [importData type ='typeID'path =' <path to="" the="" xml="" file="">']</path></div><aside class="note " rel="721b2060" id="77c88b62" data-title=""><p id="e6041a80">要进行处理，报告XML文件（或目录）必须位于checkout目录中，并且路径必须相对于<a href="build-checkout-directory.html">该目录</a> 。</p></aside><p id="ffe6b1b1">哪里<code class="code">typeID</code>可以是以下内容之一（另请参见<a href="xml-report-processing.html">XML报表处理</a> ）：</p><div class="table-wrapper"><table width="100%" id="3dda69c5"><thead><tr id="9da0d823" class="ijRowHead"><th id="5b754bfe"><p id="4f7648c4">typeID</p></th><th id="4babfc9c"><p id="4331b729">描述</p></th></tr></thead><tbody><tr id="67931159" class="ijRowOdd"><td colspan="2" id="ef79d11c"><p id="166c355d"><b id="4ca0bf73">测试框架</b></p></td></tr><tr id="4d00ed10" class="ijRowEven"><td id="fa6fde8f"><p id="b900eaec"><code class="code">junit</code></p></td><td id="d19b4b45"><p id="4814c554">JUnit Ant任务XML报告</p></td></tr><tr id="f9465f83" class="ijRowOdd"><td id="643e61f6"><p id="7a550227"><code class="code">surefire</code></p></td><td id="9222aecd"><p id="bda3b904">Maven Surefire XML报告</p></td></tr><tr id="7a728ad6" class="ijRowEven"><td id="08d0952e"><p id="e6cc1fa1"><code class="code">nunit</code></p></td><td id="3e654d23"><p id="f8f3d4c5">NUnit-Console XML报告</p></td></tr><tr id="480c4976" class="ijRowOdd"><td id="5dfb4328"><p id="faf7e2d2"><code class="code">mstest</code></p></td><td id="56be87af"><p id="28b38965">MSTest XML报告</p></td></tr><tr id="23718e13" class="ijRowEven"><td id="e8f31d83"><p id="dd9a1d40"><code class="code">vstest</code></p></td><td id="b2b0cbcc"><p id="a6b96008">VSTest XML报告</p></td></tr><tr id="3053af81" class="ijRowOdd"><td id="042103cc"><p id="2c9f3283"><code class="code">gtest</code></p></td><td id="40f9316c"><p id="c213c5ef">Google Test XML报告</p></td></tr><tr id="b7b5f784" class="ijRowEven"><td colspan="2" id="672256fe"><p id="2113efe6"><b id="059ed2dc">代码检查</b></p></td></tr><tr id="0eb61c6b" class="ijRowOdd"><td id="0c6fbbbd"><p id="10827ccc"><code class="code">intellij-inspections</code></p></td><td id="e5fd577a"><p id="70b8daa6"><b id="61c1204b">自TeamCity 2017.1起</b> ，IntelliJ IDEA检查结果</p></td></tr><tr id="7d0d57f0" class="ijRowEven"><td id="ae0e65de"><p id="9fd6cbf3"><code class="code">checkstyle</code></p></td><td id="cd4fc0de"><p id="6e47c816">Checkstyle检查XML报告</p></td></tr><tr id="93ad554a" class="ijRowOdd"><td id="f52e9f48"><p id="31c4519c"><code class="code">findBugs</code> 2）</p></td><td id="bf7c9fe1"><p id="5acb8f23">FindBugs检查XML报告</p></td></tr><tr id="c1ac64e8" class="ijRowEven"><td id="4f5de791"><p id="23384500"><code class="code">jslint</code></p></td><td id="3c36b6e6"><p id="35cc2655">JSLint XML报告</p></td></tr><tr id="c3f4bcbb" class="ijRowOdd"><td id="8e8197fc"><p id="df3205f2"><code class="code">ReSharperInspectCode</code> 1）</p></td><td id="20360d0a"><p id="7e1c40b3">锐化器<code class="code">inspectCode.exe</code> XML报告</p></td></tr><tr id="36ef3c93" class="ijRowEven"><td id="e171d6d7"><p id="86e7088d"><code class="code">FxCop</code> 1个</p></td><td id="51a84d6e"><p id="1767dfb0">FxCop检查XML报告</p></td></tr><tr id="ca6b2969" class="ijRowOdd"><td id="7c149364"><p id="486e1c92"><code class="code">pmd</code></p></td><td id="fea4c882"><p id="ec5db5e2">PMD检查XML报告</p></td></tr><tr id="6ffc1e5e" class="ijRowEven"><td colspan="2" id="c4aee87a"><p id="038ba75e"><b id="07ff70f9">代码重复</b></p></td></tr><tr id="4118ae18" class="ijRowOdd"><td id="a03f7207"><p id="cc922f3c"><code class="code">pmdCpd</code></p></td><td id="7e5578f2"><p id="0f40c9d2">PMD复制/粘贴检测器（CPD）XML报告</p></td></tr><tr id="06f5bf1f" class="ijRowEven"><td id="c087f052"><p id="d17e156f"><code class="code">DotNetDupFinder</code> 1）</p></td><td id="b3741318"><p id="b80fa78d">锐化器<code class="code">dupfinder.exe</code> XML报告</p></td></tr><tr id="e370d962" class="ijRowOdd"><td colspan="2" id="d7af8f5a"><p id="81215203"><b id="a865cbdd">代码覆盖率</b></p></td></tr><tr id="ae9f672d" class="ijRowEven"><td id="49562b30"><p id="4f1afb0f"><code class="code">dotNetCoverage</code> 1）3）</p></td><td id="148d9f34"><p id="5068248b">由dotcover，partcover，ncover或ncover3生成的XML报告</p></td></tr></tbody></table></div><p id="2a162449">笔记：</p><ol class="list _decimal"><li class="list__item" id="bb1c7139"><p>仅支持<code class="code">path</code>属性。</p></li><li class="list__item" id="0421099a"><p>还需要<code class="code">findBugsHome</code>指定的属性指向已安装的FindBugs工具的主目录。</p></li><li class="list__item" id="aae2797a"><p>还需要<code class="code">tool='<tool name>'</code>服务消息属性，其中<code class="code"><tool name></code>或者是<code class="code">dotcover</code> ， <code class="code">partcover</code> ， <code class="code">ncover</code>要么<code class="code">ncover3</code> 。</p></li></ol><p id="e9b9ccc7">如果没有特别说明，报告类型会在<code class="code">path</code>属性。</p><ul class="list _ul"><li class="list__item" id="5a329870"><p id="3dbd414e"><code class="code">verbose='true'</code>属性将启用详细记录到构建日志中。</p></li><li class="list__item" id="142328df"><p id="137e5b0f"><code class="code">parseOutOfDate='true'</code>属性将处理所有与路径匹配的文件。默认情况下，仅处理在构建期间更新的更新（由上次修改时间戳确定）。如果找到任何不匹配的报告，则“生成的报告已被跳过，因为过期”消息出现在构建日志中。</p></li><li class="list__item" id="189c74e0"><p id="e10a0885"><code class="code">whenNoDataPublished=<action></code> （ <action>以下内容之一： <code class="code">info</code> （默认）， <code class="code">nothing</code> ， <code class="code">warning</code> ， <code class="code">error</code>如果找不到与指定路径匹配的报告，则）将更改输出级别。</action></p></li><li class="list__item" id="71b0049e"><p id="b9f8c2ab">（ <b id="b54fbc6b">已弃用，请改用“ <a href="build-failure-conditions.html">构建失败条件”</a></b> ）<br><code class="code">findBugs</code> ， <code class="code">pmd</code>要么<code class="code">checkstyle</code> importData消息也可选<code class="code">errorLimit</code>和<code class="code">warningLimit</code>指定错误和警告限制的属性，超过这些限制将导致构建失败。</p></li></ul><aside class="note " rel="70bccee1" id="c0bb69a6" data-title=""><p id="36109392">之后<code class="code">importData</code>收到消息后，TeamCity代理将开始监视磁盘上的指定路径，并在文件出现在磁盘上后立即在后台导入匹配的报告文件。解析仅发生在接收消息的构建步骤中。在完成步骤后，代理将确保在开始下一步之前处理所有当前报告。此行为与<a href="xml-report-processing.html">XML报表处理</a>构建功能不同，后者仅在构建结束时才完成文件解析。确保报告文件在生成过程结束后可用（文件不会被删除，也不会被构建脚本覆盖）</p></aside><p id="506f4a30">要启动对多个目录的监视或分析几种类型的报告，请依次发送相应的服务消息。</p><aside class="note " rel="506f4a30" id="e2c20949" data-title=""><p id="f390e25a">构建中只能包含几个不同类型的报告。不支持在单个版本中处理多个检查或重复工具的报告。请参阅<a href="http://youtrack.jetbrains.com/issue/TW-14260" rel="noopener noreferrer" data-external="true" target="_blank">相关功能要求</a> 。</p></aside></div></div><a name="Cancelingbuildviaservicemessage"></a><a name="Canceling-build-via-service-message"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-Cancelingbuildviaservicemessage">通过服务消息取消构建</h3><p id="90758a52">例如，如果您需要从脚本中取消构建，如果由于环境而导致构建无法正常进行，或者应该从子进程中取消构建，则可以使用以下服务消息：</p><div class="code-block" data-lang="bash">回声## teamcity [buildStop comment ='取消评论'readdToQueue ='true']</div><p id="e69accf8">如果需要，您可以在取消构建后将其重新添加到队列中。</p></div><a name="LibrariesreportingresultsviaTeamCityServiceMessages"></a><a name="Libraries-reporting-results-via-TeamCity-Service-Messages"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-LibrariesreportingresultsviaTeamCityServiceMessages">图书馆通过TeamCity服务消息报告结果</h3><p id="42a611e4">JetBrains和外部来源的几个特定于平台的库都可以通过TeamCity Service消息报告结果。</p><ul class="list _ul"><li class="list__item" id="89179e1e"><p><a href="https://github.com/JetBrains/TeamCity.ServiceMessages" rel="noopener noreferrer" data-external="true" target="_blank">服务消息.NET库</a> -.NET库，用于从.NET应用程序生成（和解析）TeamCity服务消息。请参阅<a href="http://blog.jetbrains.com/teamcity/2011/10/teamcity-service-messages-library-for-net/" rel="noopener noreferrer" data-external="true" target="_blank">相关博客文章</a> 。</p></li><li class="list__item" id="0c148d25"><p><a href="https://github.com/WilliamDoman/Jasmine2.0TeamCityReporter" rel="noopener noreferrer" data-external="true" target="_blank">Jasmine 2.0 TeamCity记者</a> -支持从Jasmine 2.0记者发出TeamCity服务消息</p></li><li class="list__item" id="f83791c4"><p><a href="http://search.cpan.org/~thaljef/TAP-Formatter-TeamCity-0.04/" rel="noopener noreferrer" data-external="true" target="_blank">Perl TAP格式化</a>程序<a href="http://search.cpan.org/~thaljef/TAP-Formatter-TeamCity-0.04/" rel="noopener noreferrer" data-external="true" target="_blank">-Perl的格式化</a>程序，可将TAP消息转换为TeamCity服务消息</p></li><li class="list__item" id="0d66dbfc"><p><a href="https://github.com/sebastianbergmann/phpunit/blob/9e86c85be3302eb125f15037ae6f496f62750a93/ChangeLog-5.0.md#500---2015-10-02" rel="noopener noreferrer" data-external="true" target="_blank">PHPUnit 5.0-</a>支持TeamCity服务消息进行测试。对于早期的PHPUnit版本，可以使用以下外部库： <a href="https://github.com/realweb-team/deploytools" rel="noopener noreferrer" data-external="true" target="_blank">PHPUnit Listener 1</a> ， <a href="https://github.com/maartenba/phpunit-runner-teamcity" rel="noopener noreferrer" data-external="true" target="_blank">PHPUnit Listener 2-</a>可以通过PHPUnit的插件插入的<a href="https://github.com/maartenba/phpunit-runner-teamcity" rel="noopener noreferrer" data-external="true" target="_blank">监听器</a> <code class="code">suite.xml</code>生成TeamCity服务消息以进行测试。</p></li><li class="list__item" id="4afeff6a"><p><a href="https://pypi.python.org/pypi/teamcity-messages" rel="noopener noreferrer" data-external="true" target="_blank">向TeamCity报告Python单元测试</a> -该软件包可通过服务消息自动将单元测试报告给TeamCity服务器（在TeamCity下运行并提供适合其使用的测试代码时）。</p></li><li class="list__item" id="2be7c3d8"><p><a href="https://github.com/visionmedia/mocha" rel="noopener noreferrer" data-external="true" target="_blank">Mocha-</a>通过Mocha JavaScript测试框架的服务消息进行实时报告。请参阅相关的<a href="http://richarddingwall.name/2012/06/17/running-mocha-browser-tests-in-teamcity/" rel="noopener noreferrer" data-external="true" target="_blank">职位</a>有说明书。</p></li><li class="list__item" id="e49e1499"><p><a href="https://github.com/karma-runner/karma" rel="noopener noreferrer" data-external="true" target="_blank">Karma</a> -JavaScript测试工具的支持，以使用TeamCity服务消息将测试进度报告给TeamCity</p></li></ul></div></div><a name="teamcity-info.xml"></a><a name="teamcity-info.xml"></a><div class="chapter"><h2 id="BuildScriptInteractionwithTeamCity-teamcity-info.xml">teamcity-info.xml</h2><p id="9abf32ed">作为一种过时的方法，也可以让构建脚本收集信息，生成一个名为<code class="code">teamcity-info.xml</code>在根构建目录中。构建完成后，此文件将自动作为构建工件上传并由TeamCity服务器处理。</p><p id="320a22de">请注意，在将来的TeamCity版本中<b id="77cf4157">可以停止使用</b>此方法，因此建议使用服务消息方法。如果服务消息对您不起作用，请让我们知道详细信息并通过<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">电子邮件</a>描述情况。</p><a name="ModifyingtheBuildStatus"></a><a name="Modifying-the-Build-Status"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-ModifyingtheBuildStatus">修改构建状态</h3><p id="d64f525f">TeamCity可以直接从构建脚本中更改构建状态。您可以设置状态（构建失败或成功）并更改构建状态的文本（例如，如果TeamCity不支持测试框架，请注意失败的测试数）。</p><p id="6acaebaa"><a href="https://confluence.jetbrains.com/download/attachments/113084407/teamcity-info.xsd?version=1&modificationDate=1271791190000&api=v2" rel="noopener noreferrer" data-external="true" target="_blank">teamcity-info.xml的XML模式</a></p><p id="938432bd">可以为构建设置以下信息：</p><p id="8a6f69e0"><b id="91e523aa">内部版本号</b> —为完成的内部版本设置新的编号。您可以使用{引用TeamCity提供的内部版本号<code class="code">build.number</code> }。</p><p id="5c3d17fb"><b id="9f75fc18">构建状态</b> -更改构建状态。支持的值为“ FAILURE”和“ SUCCESS”。</p><p id="7d94f5b4"><b id="9b7a9f86">状态文本</b> -修改构建状态的文本。您可以替换TeamCity提供的状态文本，也可以在标准文本之前或之后添加自定义零件。支持的<code class="code">action</code>值是“追加”，“前置”和“替换”。</p><p id="ed861a62">例<code class="code">teamcity-info.xml</code>文件：</p><div class="code-block" data-lang="markup"><build number="1.0.{build.number}">
   <statusinfo status="FAILURE"> <!-- or SUCCESS --> <text action="append">Fitnesse：45</text> <text action="append">覆盖率：54％</text>
   </statusinfo>
</build>

</div><aside class="note " rel="62d1d859" id="ed5e5d91" data-title=""><p id="7a7096aa">由您自己决定如何检索TeamCity不支持的测试结果并将其准确地添加到<code class="code">teamcity-info.xml</code>文件。</p></aside></div><a name="ReportingCustomStatistics"></a><a name="Reporting-Custom-Statistics"></a><div class="chapter"><h3 id="BuildScriptInteractionwithTeamCity-ReportingCustomStatistics">报告自定义统计</h3><p id="8e3148a8">可以在TeamCity中提供<a href="customizing-statistics-charts.html">自定义图表</a> 。您的构建可以使用以下方式为此类图提供数据<code class="code">teamcity-info.xml</code>文件。</p><a name="Providingdatausingtheteamcity-info.xmlfile"></a><a name="Providing-data-using-the-teamcity-info.xml-file"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Providingdatausingtheteamcity-info.xmlfile">使用teamcity-info.xml文件提供数据</h4><p id="ef9366f9">该文件应由内部版本的根目录中的内部版本创建。您可以发布多个统计信息（请参阅下面的数据格式的详细信息），并为每组值创建单独的图表。</p><p id="f2a144ec">的<code class="code">teamcity-info.xml</code>文件应包含以下格式的代码（您可以在<code class="code">teamcity-info.xml</code>文件）：</p><div class="code-block" data-lang="markup"><build>
   <statisticvalue value="342" key="chart1Key"></statisticvalue>
   <statisticvalue value="53" key="chart2Key"></statisticvalue>
</build>

</div><p id="c93a57dc">的<code class="code">key</code>不应等于任何<a href="customizing-statistics-charts.html#Modifying-Pre-defined-Project-level-Charts">预定义的键</a> 。的<code class="code">value</code>应该是最多13位数字的正/负整数。支持的浮点数最多可保留小数点后6位。</p><p id="e880c377">此处的键与描述图表时使用的<b id="8198ac9b">valueType</b>标记的键有关。</p></div><a name="Describingcustomcharts"></a><a name="Describing-custom-charts"></a><div class="chapter"><h4 id="BuildScriptInteractionwithTeamCity-Describingcustomcharts">描述自定义图表</h4><p id="0d834f8e">有关详细说明，请参见“ <a href="customizing-statistics-charts.html">定制统计图”</a>页面。</p><hr id="c6a82d96"></div></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>