<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Snapshot Dependencies - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Snapshot Dependencies" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-dependencies.md|Configuring Dependencies/snapshot-dependencies.md|Snapshot Dependencies" data-main-title="Snapshot Dependencies" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/snapshot-dependencies.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Snapshot Dependencies" id="snapshot-dependencies.md">Snapshot Dependencies</h1><p id="21466014">By setting a <a href="dependent-build.html#Snapshot-Dependency">snapshot dependency</a> of a build (for example, build B) on other build's (build A's) sources, you can ensure that build B will start only after the one it depends on (build A) is run and finished. We call build A a <i id="70899372">dependency</i> build, whereas build B is a <i id="0aa6e7e8">dependent</i> build.</p><p id="fdfe0649">The Dependencies page of the build configuration settings displays the configured dependencies and <b id="42ecbe8a">since TeamCity 2017.1</b>, the Snapshot dependencies section of the page allows previewing the build chain and its configuration. The preview shows builds of the chain; the builds with automatic triggering configured are marked with this icon <img alt="v.png" title="v.png" src="/help/img/teamcity/2019.1/v.png" id="a15da513" width="17" height="18" class="inline-icon-17">.</p><p id="7ce0d002">When adding a new snapshot dependency, the following options need to be specified:</p><p id="5c272110"><a name="EnforceRevisionsSynchronization"></a><a name="SnapshotDependencies-EnforceRevisionsSynchronization"></a></p><div class="table-wrapper"><table width="100%" id="f5e6bc2c"><thead><tr id="4c05b88a" class="ijRowHead"><th width="150" id="c389bf0b"><p id="2eb4fae8">Option</p></th><th id="a7b0c3b6"><p id="ed02f89e">Description</p></th></tr></thead><tbody><tr id="62ebb08a" class="ijRowOdd"><td id="356c4da5"><p id="16e92a67">Depend on</p></td><td id="ac203f8f"><p id="4d45d164">Specify the build configuration for the current build configuration to depend on.</p></td></tr><tr id="0ea251d8" class="ijRowEven"><td id="58f9c299"><a name="enforce-rev-sync"></a><a name="SnapshotDependencies-enforce-rev-sync"></a><p id="cf29633b">Enforce revisions synchronization</p></td><td id="1ef9e144"><p id="ce342c2f">For all builds linked by snapshot dependencies with this option <b id="64ca973a">enabled</b>, TeamCity will use the same sources snapshot (for example, the same revision for the same VCS root). This is a recommended setting for configurations that need to use the same state of the sources to build successfully.</p><p id="0191165e">If you <b id="0578cf62">disable</b> this option for a snapshot dependency, then when a dependency build is promoted to the current build configuration, the build of the current build configuraiton will use the most recent revision of the sources instead of the revision corresponding to the promoted dependency. This is useful when the builds do not have strict sources dependencies (for example, as with package and deploy steps).</p><p id="75810aa2">Note that the sources snapshot rule is only applied to the <a href="build-chain.html#Disabling-Revisions-Synchronization-Between-Chain-Parts">parts of the builds chain</a>) linked via the snapshot dependencies with the option enabled.</p></td></tr><tr id="2f774264" class="ijRowOdd"><td id="a3131d45"><p id="c4f952bf">Do not run new build if there is a suitable one</p></td><td id="1c45d41e"><p id="8d450a2e">If the option is enabled, TeamCity will not run a dependency build, if another running or finished dependency build with the appropriate sources revision exists. See also <a href="#Suitable-Builds">Suitable Builds</a> below. However, when a dependent build is triggered, the dependency build will also be put into the queue. Then, when the changes for the build chain are collected, this dependency build will be removed from the queue and the dependency will be set to a suitable finished build.</p><aside class="note " data-title="" rel="8d450a2e" id="c499ea70"><p id="7019e9d8">Note: if there is more than one snapshot dependency on some build configuration, then for builds reusing to work, all of them must have the "Do not run new build if there is a suitable one" option enabled.</p></aside></td></tr><tr id="27f14d7f" class="ijRowEven"><td id="997da98c"><p id="d784b528">Only use successful builds from suitable ones</p></td><td id="caa0e162"><p id="888e7775">A new triggered build will only "use" successfully finished suitable builds as dependencies. If the latest finished "suitable" build is failed, it will be re-run.</p></td></tr><tr id="2ace8f28" class="ijRowOdd"><td id="ba30e121"><a name="RunOnTheSameAgent"></a><a name="SnapshotDependencies-RunOnTheSameAgent"></a><p id="81a7fa40">Run build on the same agent</p></td><td id="a399dc28"><p id="94dbf12e">When enabled, and B snapshot-depends on A, then builds of B are run on the same agent where the build of A from the same build chain was run.</p><aside class="note " data-title="" rel="94dbf12e" id="128102bf"><p id="c49e1652">Before starting a build chain having <b id="0021e7ea">run on the same agent</b> dependencies, TeamCity forms groups of builds combined by <b id="8c06354a">run on the same agent</b> dependency, and for each starting build participating in such a group TeamCity chooses agents which can be used by any build of the group. Thus this option makes sense for <a href="composite-build-configuration.html">composite builds</a> too, even though composite build does not occupy an agent, it still can form a group of builds combined by such dependencies. For instance, composite build B having <b id="a8512c5e">run on the same agent</b> dependencies on A and C will cause both A and C use the same agent.</p></aside></td></tr><tr id="4f8fb090" class="ijRowEven"><td id="fcd8ed4c"><a name="on-failed-dependency"></a><a name="SnapshotDependencies-on-failed-dependency"></a><p id="c698ecf2">On failed dependency/  On failed to start/canceled dependency</p></td><td id="48597d35"><p id="91bce05d">If a dependency fails, you can manage the status of the dependent build by selecting one of the following options:</p><ul class="list _ul"><li class="list__item" id="08526313"><p><b id="71e8a96b">Run build, but add problem</b>: the dependent build will be run and the problem will be added to it, changing its status to failed (if problem was not muted earlier)</p></li><li class="list__item" id="e66b1351"><p><b id="4c89d715">Run build, but do not add problem</b>: the dependent build will be run and no problems will be added</p></li><li class="list__item" id="fe2bc19e"><p><b id="5a4978aa">Make build failed to start</b>: the dependent build will not run and will be marked as "Failed to start"</p></li><li class="list__item" id="f8c3abc0"><p><b id="0c64c0e3">Cancel build</b>: the dependent build will not run and will be marked as "Canceled".</p></li></ul></td></tr></tbody></table></div><a name="SuitableBuilds"></a><a name="Suitable-Builds"></a><h3 id="SnapshotDependencies-SuitableBuilds">Suitable Builds</h3><p id="b99238fc">A "suitable" build in terms of snapshot dependencies is a build which can be used instead a queued dependency build within a <a href="build-chain.html">build chain</a>. That is, a queued build which is a part of a build chain can be dropped and the builds depending on it can be made dependent on another queued, running or already finished "suitable" build. This behavior only works when the "<i id="380ebc62">Do not run new build if there is a suitable one</i>" option of a corresponding snapshot dependency is selected.</p><p id="8b477905">For a build to be considered "suitable", it should comply with all of the conditions below:</p><ul class="list _ul"><li class="list__item" id="f41d15f0"><p>use the same sources snapshot as the entire queued build chain being processed. If the build configurations have the same VCS settings, this basically means the one with the same sources revision. If the VCS settings are different (VCS roots or checkout rules), then "same sources snapshot" revisions means revisions taken simultaneously at some moment in time.</p></li><li class="list__item" id="4f1e7705"><p>be successful (if "Only use successful builds from suitable ones" snapshot dependency option is set)</p></li><li class="list__item" id="9469b1ee"><p>be a usual, not a <a href="personal-build.html">personal build</a></p></li><li class="list__item" id="98cbc8b3"><p>have no customized parameters, also considering those set via <code class="code">reverse.dep.</code> parameters (related feature request: <a href="http://youtrack.jetbrains.com/issue/TW-23700" data-external="true" target="_blank" rel="noopener noreferrer">TW-23700</a>)</p></li><li class="list__item" id="a710cfd5"><p>the original build should not be triggered selecting "rebuild" option for the dependency build configuration in question</p></li><li class="list__item" id="c6de320c"><p>have no VCS settings preventing effective revision calculation, see <a href="#VCS-Settings-Disabling-Builds-Reuse">below</a></p></li><li class="list__item" id="193214b9"><p>there is no other build configuration snapshot-depending on the current one with "Do not run new build if there is a suitable one" option set to "off"</p></li><li class="list__item" id="69a03271"><p>the running build is not "hanging"</p></li><li class="list__item" id="b5e14aaf"><p>settings of the build configuration were not changed since the build (that is, the build was run with the current build configuration settings). This also includes no changes to the parameters of all the parent projects of the build configuration. You can check if the settings were changed between several builds by comparing <code class="code">.teamcity/settings/digest.txt</code> file in the <a href="build-artifact.html#Hidden-Artifacts">hidden build's artifacts</a></p></li><li class="list__item" id="11823083"><p>if there is also an artifact dependency in addition to snapshot one, the suitable build should have artifacts</p></li><li class="list__item" id="8b70e120"><p>all the dependency builds (the builds the current one depends on) are "suitable" and are appropriately merged</p></li></ul><a name="VCSSettingsDisablingBuildsReuse"></a><a name="VCS-Settings-Disabling-Builds-Reuse"></a><h4 id="SnapshotDependencies-VCSSettingsDisablingBuildsReuse">VCS Settings Disabling Builds Reuse</h4><p id="5e871d10">Some settings in VCS roots can effectively disable builds reusing. These settings are:</p><ul class="list _ul"><li class="list__item" id="e6884359"><p id="a3fec31f">Subversion: <b id="0e7fa9eb">Checkout, but ignore changes</b> mode</p></li><li class="list__item" id="7c50dec8"><p id="ea48e415">CVS: <b id="90284f2c">Checkout by tag</b> mode</p></li><li class="list__item" id="d90ae5db"><p id="4cc16059">Perforce: <b id="bb929970">Stream</b> or <b id="85fd08a4">Client</b> connection settings, or label is specified in <b id="00dd4692">Label/revision to checkout</b> option</p></li><li class="list__item" id="8172e29e"><p id="d279f72f">Starteam: checkout mode option set to <b id="ace55eff">view label</b> or <b id="8b84bd43">promotion date</b></p><hr id="8f9bfc32"></li></ul><p id="10a27f22"><b id="e9acf385">See also:</b></p><p id="4b5becf1"><b id="c6000450">Concepts</b>: <a href="dependent-build.html">Dependent Build</a></p><hr id="fd8bc6d0"></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>