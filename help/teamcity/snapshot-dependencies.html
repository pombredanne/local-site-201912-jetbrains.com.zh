<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>快照依赖性-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Snapshot Dependencies" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-dependencies.md|Configuring Dependencies/snapshot-dependencies.md|Snapshot Dependencies" data-main-title="Snapshot Dependencies" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/snapshot-dependencies.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="snapshot-dependencies.md" data-toc="Snapshot Dependencies">快照依存关系</h1><p id="21466014">通过在其他构建（构建A）的源上设置构建（例如，构建B）的<a href="dependent-build.html#Snapshot-Dependency">快照依赖关系</a> ，可以确保构建B仅在其依赖的构建（构建A）运行并完成后才启动。我们称构建A为<i id="70899372">依赖</i>构建，而构建B为<i id="0aa6e7e8">依赖</i>构建。</p><p id="fdfe0649">构建配置设置的“依赖关系”页面显示已配置的依赖关系， <b id="42ecbe8a">自TeamCity 2017.1开始</b> ，该页面的“快照依赖关系”部分允许预览构建链及其配置。预览显示了链的构建。配置了自动触发的构建带有此图标标记<img alt="v.png" title="v.png" src="/help/img/teamcity/2019.1/v.png" id="a15da513" width="17" height="18" class="inline-icon-17"> 。</p><p id="7ce0d002">添加新的快照依赖项时，需要指定以下选项：</p><p id="5c272110"><a name="EnforceRevisionsSynchronization"></a><a name="SnapshotDependencies-EnforceRevisionsSynchronization"></a></p><div class="table-wrapper"><table width="100%" id="f5e6bc2c"><thead><tr id="4c05b88a" class="ijRowHead"><th width="150" id="c389bf0b"><p id="2eb4fae8">选项</p></th><th id="a7b0c3b6"><p id="ed02f89e">描述</p></th></tr></thead><tbody><tr id="62ebb08a" class="ijRowOdd"><td id="356c4da5"><p id="16e92a67">取决于</p></td><td id="ac203f8f"><p id="4d45d164">为当前的构建配置指定构建配置。</p></td></tr><tr id="0ea251d8" class="ijRowEven"><td id="58f9c299"><a name="enforce-rev-sync"></a><a name="SnapshotDependencies-enforce-rev-sync"></a><p id="cf29633b">强制执行修订同步</p></td><td id="1ef9e144"><p id="ce342c2f">对于<b id="64ca973a">启用</b>了此选项的所有通过快照依赖关系链接的构建，TeamCity将使用相同的源快照（例如，同一VCS根目录使用相同的修订版）。对于需要使用源的相同状态才能成功构建的配置，建议使用此设置。</p><p id="0191165e">如果为快照依赖项<b id="0578cf62">禁用</b>此选项，则在将依赖关系构建升级为当前构建配置时，当前构建配置的构建将使用源的最新修订版，而不是与提升的依赖关系相对应的修订版。当构建没有严格的源依赖性时（例如，与打包和部署步骤一样），此功能很有用。</p><p id="75810aa2">请注意，sources快照规则仅应用于通过快照依赖项（启用了该选项）链接<a href="build-chain.html#Disabling-Revisions-Synchronization-Between-Chain-Parts">的构建链（</a> ）的<a href="build-chain.html#Disabling-Revisions-Synchronization-Between-Chain-Parts">各个部分</a> 。</p></td></tr><tr id="2f774264" class="ijRowOdd"><td id="a3131d45"><p id="c4f952bf">如果有合适的版本，请勿运行新版本</p></td><td id="1c45d41e"><p id="8d450a2e">如果启用了该选项，则如果存在具有适当源版本的另一个正在运行或已完成的依赖关系生成，TeamCity将不会运行依赖关系生成。另请参见下面的<a href="#Suitable-Builds">合适的版本</a> 。但是，当触发从属构建时，从属构建也将放入队列。然后，当收集到构建链的更改时，将从队列中删除此依赖关系构建，并将依赖关系设置为合适的完成构建。</p><aside class="note " rel="8d450a2e" id="c499ea70" data-title=""><p id="7019e9d8">注意：如果某个构建配置中有多个快照依赖项，则为了重新使用构建，所有这些都必须启用“如果有合适的构建，则不要运行新构建”选项。</p></aside></td></tr><tr id="27f14d7f" class="ijRowEven"><td id="997da98c"><p id="d784b528">仅使用合适的成功构建</p></td><td id="caa0e162"><p id="888e7775">新触发的构建将仅“使用”成功完成的合适构建作为依赖项。如果最新完成的“合适的”构建失败，它将重新运行。</p></td></tr><tr id="2ace8f28" class="ijRowOdd"><td id="ba30e121"><a name="RunOnTheSameAgent"></a><a name="SnapshotDependencies-RunOnTheSameAgent"></a><p id="81a7fa40">在同一代理上运行构建</p></td><td id="a399dc28"><p id="94dbf12e">启用后，并且B快照依赖于A，则B的构建将在运行来自同一构建链的A的构建的同一代理上运行。</p><aside class="note " rel="94dbf12e" id="128102bf" data-title=""><p id="c49e1652">在开始以<b id="0021e7ea">相同代理</b>依赖项<b id="0021e7ea">运行</b>的构建链之前，TeamCity会以<b id="8c06354a">在相同代理</b>依赖项<b id="8c06354a">上运行的方式</b>组合构建的构建组，并且对于参与该组的每个初始构建，TeamCity选择可以由该组的任何构建使用的代理。因此，即使复合构建不占用代理，此选项对<a href="composite-build-configuration.html">复合构建</a>也很有意义，但它仍可以形成由这种依赖关系组合而成的一组构建。例如，复合构建B在A和C上具有<b id="a8512c5e">相同的代理</b>依赖项时，将导致A和C使用相同的代理。</p></aside></td></tr><tr id="4f8fb090" class="ijRowEven"><td id="fcd8ed4c"><a name="on-failed-dependency"></a><a name="SnapshotDependencies-on-failed-dependency"></a><p id="c698ecf2">依赖失败/启动失败/取消依赖</p></td><td id="48597d35"><p id="91bce05d">如果依赖项失败，则可以通过选择以下选项之一来管理依赖项构建的状态：</p><ul class="list _ul"><li class="list__item" id="08526313"><p><b id="71e8a96b">运行构建，但添加问题</b> ：将运行从属构建并将问题添加到该构建中，将其状态更改为失败（如果之前未将问题静音）</p></li><li class="list__item" id="e66b1351"><p><b id="4c89d715">运行构建，但不要添加问题</b> ：依赖的构建将运行，并且不会添加任何问题</p></li><li class="list__item" id="fe2bc19e"><p><b id="5a4978aa">使构建无法启动</b> ：依赖的构建将无法运行，并将被标记为“无法启动”</p></li><li class="list__item" id="f8c3abc0"><p><b id="0c64c0e3">取消构建</b> ：依赖的构建将不会运行，并将被标记为“已取消”。</p></li></ul></td></tr></tbody></table></div><a name="SuitableBuilds"></a><a name="Suitable-Builds"></a><h3 id="SnapshotDependencies-SuitableBuilds">适合的体型</h3><p id="b99238fc">就快照依赖关系而言，“合适的”构建是可以在<a href="build-chain.html">构建链中</a>替代排队的依赖关系构建的<a href="build-chain.html">构建</a> 。即，可以删除作为构建链一部分的排队构建，并且可以使依赖于该构建的构建依赖于另一个排队，正在运行或已经完成的“合适”构建。仅当选择了“相应快照依赖项<i id="380ebc62">不运行新版本</i> ”选项时，此行为才起作用。</p><p id="8b477905">对于被认为是“合适”的构建，它应符合以下所有条件：</p><ul class="list _ul"><li class="list__item" id="f41d15f0"><p>使用与正在处理的整个排队的构建链相同的源快照。如果构建配置具有相同的VCS设置，则基本上意味着具有相同源版本的VCS设置。如果VCS设置不同（VCS根目录或签出规则），则“相同源快照”修订版表示在某个时刻同时进行的修订版。</p></li><li class="list__item" id="4f1e7705"><p>成功（如果设置了“仅使用适当的构建成功的构建”快照依赖项选项）</p></li><li class="list__item" id="9469b1ee"><p>是平常的，不是<a href="personal-build.html">个人的</a></p></li><li class="list__item" id="98cbc8b3"><p>没有自定义参数，也要考虑通过<code class="code">reverse.dep.</code>参数（相关功能要求： <a href="http://youtrack.jetbrains.com/issue/TW-23700" rel="noopener noreferrer" data-external="true" target="_blank">TW-23700</a> ）</p></li><li class="list__item" id="a710cfd5"><p>不应触发原始构建，请为相关的依赖构建配置选择“ rebuild”选项</p></li><li class="list__item" id="c6de320c"><p>没有VCS设置，无法进行有效的修订计算，请参见<a href="#VCS-Settings-Disabling-Builds-Reuse">下文</a></p></li><li class="list__item" id="193214b9"><p>没有其他构建配置快照-取决于当前的快照，并将“如果有合适的快照，则不运行新的构建”选项设置为“ off”</p></li><li class="list__item" id="69a03271"><p>运行的构建不是“挂起”</p></li><li class="list__item" id="b5e14aaf"><p>自构建以来，构建配置的设置未更改（即，构建是使用当前构建配置设置运行的）。这也包括不更改构建配置的所有父项目的参数。您可以通过比较来检查设置是否在多个版本之间进行了更改<code class="code">.teamcity/settings/digest.txt</code> <a href="build-artifact.html#Hidden-Artifacts">隐藏构建的工件中的文件</a></p></li><li class="list__item" id="11823083"><p>如果除了快照一之外还存在工件依赖项，则合适的构建应具有工件</p></li><li class="list__item" id="8b70e120"><p>所有依赖项构建（当前一个依赖项所依赖的构建）都是“合适的”并且已适当合并</p></li></ul><a name="VCSSettingsDisablingBuildsReuse"></a><a name="VCS-Settings-Disabling-Builds-Reuse"></a><h4 id="SnapshotDependencies-VCSSettingsDisablingBuildsReuse">VCS设置禁用内部版本重用</h4><p id="5e871d10">VCS根目录中的某些设置可以有效地禁用构建重用。这些设置是：</p><ul class="list _ul"><li class="list__item" id="e6884359"><p id="a3fec31f">Subversion： <b id="0e7fa9eb">签出，但忽略更改</b>模式</p></li><li class="list__item" id="7c50dec8"><p id="ea48e415">CVS： <b id="90284f2c">按标签</b>模式<b id="90284f2c">签出</b></p></li><li class="list__item" id="d90ae5db"><p id="4cc16059">Perforce： <b id="bb929970">流</b>或<b id="85fd08a4">客户端</b>连接设置，或在“ <b id="00dd4692">标签/修订到签出”</b>选项中指定<b id="00dd4692">标签</b></p></li><li class="list__item" id="8172e29e"><p id="d279f72f">Starteam：结帐模式选项设置为<b id="ace55eff">查看标签</b>或<b id="8b84bd43">促销日期</b></p><hr id="8f9bfc32"></li></ul><p id="10a27f22"><b id="e9acf385">也可以看看：</b></p><p id="4b5becf1"><b id="c6000450">概念</b> ： <a href="dependent-build.html">依赖构建</a></p><hr id="fd8bc6d0"></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>