<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>LDAP Integration - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="LDAP Integration" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/configuring-authentication-settings.md|Configuring Authentication Settings/ldap-integration.md|LDAP Integration/typical-ldap-configurations.md|Typical LDAP Configurations/ldap-troubleshooting.md|LDAP Troubleshooting" data-main-title="LDAP Integration" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/ldap-integration.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="LDAP Integration" id="ldap-integration.md">LDAP Integration</h1><p id="890690e3">LDAP integration in TeamCity has two levels: authentication (login) and users synchronization:</p><ul class="list _ul"><li class="list__item" id="aa02dee8"><p><b id="4e0ee2df">authentication</b> allows you to login in to TeamCity using LDAP server credentials.</p></li><li class="list__item" id="1721d0ea"><p>once LDAP authentication is configured, you can enable LDAP <b id="3feca6ce">synchronization</b> which allows the TeamCity user-set to be automatically populated with the user data from LDAP.LDAP integration is generic and can be configured for Active Directory or other LDAP servers.</p></li></ul><aside class="note " data-title="" rel="bb7047aa" id="0c67c965"><p id="8c82283e">It is recommended to configure LDAP authentication on a test server before enabling it in the production one, because switching to an incorrectly configured authentication scheme may cause users' inability to log in to TeamCity.</p></aside><p id="8bd38441">LDAP integration might be not trivial to configure, so it might require some trial and error approach to get the right settings. Please review <a href="typical-ldap-configurations.html">Typical LDAP Configurations</a>. If a problem occurs, <a href="#Debugging-LDAP-Integration">LDAP logs</a> should give you enough information to understand possible misconfigurations. If you are experiencing difficulties configuring LDAP integration after going through this document and investigating the logs, please <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">contact us</a> and let us know your LDAP settings with a detailed description of what you want to achieve and what you currently get.</p><p id="84443d94">On this page:</p><p id="8a1d904d"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#LDAPIntegration-Authentication">Authentication</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-ldap-config.propertiesConfiguration">ldap-config.properties Configuration</a></li><li class="list__item"><a href="#LDAPIntegration-ConfiguringUserLogin">Configuring User Login</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-ActiveDirectory">Active Directory</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-AdvancedConfiguration">Advanced Configuration</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-Synchronization">Synchronization</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-CommonConfiguration">Common Configuration</a></li><li class="list__item"><a href="#LDAPIntegration-UserProfileData">User Profile Data</a></li><li class="list__item"><a href="#LDAPIntegration-UserGroupMembership">User Group Membership</a></li><li class="list__item"><a href="#LDAPIntegration-CreatingandDeletingUsers">Creating and Deleting Users</a></li><li class="list__item"><a href="#LDAPIntegration-Usernamemigration">Username migration</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-Miscellaneous">Miscellaneous</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-SwitchingtoLDAPAuthentication">Switching to LDAP Authentication</a></li><li class="list__item"><a href="#LDAPIntegration-Scramblingcredentialsinldap-config.propertiesfile">Scrambling credentials in ldap-config.properties file</a></li><li class="list__item"><a href="#LDAPIntegration-DebuggingLDAPIntegration">Debugging LDAP Integration</a></li></ul></li></ul></p><a name="Authentication"></a><a name="Authentication"></a><div class="chapter"><h2 id="LDAPIntegration-Authentication">Authentication</h2><p id="938540b3">To allow logging into TeamCity with LDAP credentials, you need to configure LDAP connection settings in the <code class="code">ldap-config.properties</code> file and enable LDAP authentication in the server's <a href="configuring-authentication-settings.html">Authentication section</a>.</p><p id="540435b6">If you need to configure authentication without access to web UI refer to the <a href="https://confluence.jetbrains.com/display/TCD8/LDAP+Integration" data-external="true" target="_blank" rel="noopener noreferrer">corresponding section</a> in the previous documentation version.</p><p id="f060ea98">When the <code class="code">Allow creating new users on the first login</code> option is selected (this is the default) a new user account will be created on the first successful login. The TeamCity user names for the new users will be derived from their LDAP data based on the configured setting. All newly created users belong to the <a href="user-group.html">User Group</a> group and have all roles assigned to this group. If some specific <a href="role-and-permission.html">roles</a> are needed for the newly registered users, these roles can <a href="managing-roles.html">be granted</a> via the <b id="8ad4f26e">All Users</b> group.</p><p id="13fb3720">TeamCity stores user accounts and details in its own database. For information on automatic user creation and automatic population of user details from LDAP, refer to the <a href="#Synchronization">Synchronization</a> section.</p><a name="ldap-config.propertiesConfiguration"></a><a name="ldap-config.properties-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-ldap-config.propertiesConfiguration">ldap-config.properties Configuration</h3><p id="176ec7df">LDAP integration settings are configured in the <code class="code">&lt;TeamCity Data Directory&gt;/config/ldap-config.properties</code> file on the server.</p><p id="e10d371b">Create the file by copying <code class="code">&lt;TeamCity Data Directory&gt;/config/ldap-config.properties.dist</code> file and renaming it to the <code class="code">&lt;TeamCity Data Directory&gt;/config/ldap-config.properties</code>; follow the comments in the file to edit the default settings as required.</p><p id="8cf2fa90">The file uses the standard Java properties file syntax, so all the values in the file must be properly <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream)" data-external="true" target="_blank" rel="noopener noreferrer">escaped</a>. The file is re-read on any modification so you do not need to restart the server to apply changes in the file.</p><p id="d7d3eea6">It is strongly recommended to back up the previous version of the file: if you misconfigure LDAP integration, you may no longer be able to log in into TeamCity. The users who are already logged in are not affected by the modified LDAP integration settings because users are authenticated only on login.</p><p id="0ce2edb5">The mandatory property in the <code class="code">ldap-config.properties</code> file is <code class="code">java.naming.provider.url</code> that configures the server and root DN. The property stores the URL to the LDAP server node that is used in following LDAP queries. For example, <code class="code">ldap://dc.example.com:389/CN=Users,DC=Example,DC=Com</code>. Note that the value of the property should use URL-escaping if necessary. For example, use <code class="code">%20</code> if you need the space character.</p><aside class="note " data-title="" rel="0ce2edb5" id="5bbfa8c5"><p id="0aa79d66">For samples of <code class="code">ldap-config.properties</code> file refer to the <a href="typical-ldap-configurations.html">Typical LDAP Configurations</a> page.The supported configuration properties are documented in comments in the <code class="code">ldap-config.properties.dist</code> file.</p></aside></div><a name="ConfiguringUserLogin"></a><a name="Configuring-User-Login"></a><div class="chapter"><h3 id="LDAPIntegration-ConfiguringUserLogin">Configuring User Login</h3><p id="a474f460">The general login sequence is as follows:</p><ul class="list _ul"><li class="list__item" id="65de218d"><p>based on the username entered in the login form by the user, an LDAP search is performed (defined by the <code class="code">teamcity.users.login.filter</code> LDAP filter where the user-entered username is referenced via the <code class="code">$login$</code> or <code class="code">$capturedLogin$</code> substring within the users base LDAP node (defined by <code class="code">teamcity.users.base</code>),</p></li><li class="list__item" id="06f34b56"><p>if the search is successful, authentication (LDAP bind) is performed using the DN found during the search and the user-entered password,</p></li><li class="list__item" id="b10453eb"><p>if the authentication is successful, TeamCity user is created if necessary and the user is logged in. The name of the TeamCity user is retrieved from an attribute of the found LDAP entry (the attribute name is defined via the <code class="code">teamcity.users.username</code> property)</p></li></ul><p id="f41ac24a">When users log in via LDAP, TeamCity does not store the user passwords. On each user login, authentication is performed by a direct login into LDAP with the credentials based on the values entered in the login form.</p><p id="378d2466">Note that in certain configurations (for example, with <code class="code">java.naming.security.authentication=simple</code>) the login information will be sent to the LDAP server in the unencrypted form. For securing the connection, refer to <a href="http://java.sun.com/products/jndi/tutorial/ldap/security/sasl.html" data-external="true" target="_blank" rel="noopener noreferrer">Sun documentation</a>. Another option is to configure communications via the ldaps protocol.</p><p id="7d83b9d8">The related external link: <a href="http://www.therightstuff.de/2009/02/02/How-To-Set-Up-Secure-LDAP-Authentication-With-TeamCity.aspx" data-external="true" target="_blank" rel="noopener noreferrer">How To Set Up Secure LDAP Authentication with TeamCity</a> by Alexander Groß.</p><a name="ActiveDirectory"></a><a name="Active-Directory"></a><div class="chapter"><h4 id="LDAPIntegration-ActiveDirectory">Active Directory</h4><p id="d0ce7ba9">The following template enables authentication against active directory:</p><p id="97c187cd">Add the following code to the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/config/ldap-config.properties file (assuming the domain name is <code class="code">Example.Com</code> and domain controller is <code class="code">dc.example.com</code>).</p><p id="9c8fb086">For using secure connection (ldaps) use URL like <code class="code">ldaps://dc.example.com:636/DC=Example,DC=Com</code>, for plain connection (ldap) use URL like <code class="code">ldap://dc.example.com:389/DC=Example,DC=Com</code> (note the different port).</p><div class="code-block" data-lang="bash">java.naming.provider.url=ldaps://dc.example.com:636/DC=Example,DC=Com
java.naming.security.principal=&lt;username&gt;
java.naming.security.credentials=&lt;password&gt;
teamcity.users.login.filter=(sAMAccountName=$capturedLogin$)
teamcity.users.username=sAMAccountName
java.naming.security.authentication=simple
java.naming.referral=follow

</div></div></div><a name="AdvancedConfiguration"></a><a name="Advanced-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-AdvancedConfiguration">Advanced Configuration</h3><p id="a10ec52f">If you need to fine-tune LDAP connection settings, you can add the <code class="code">java.naming</code> options to the <code class="code">ldap-config.properties</code> file: they will be passed to the underlying Java library. The default options are retrieved using <code class="code">java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory</code>. Refer to the Java <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jndi/jndi-ldap.html" data-external="true" target="_blank" rel="noopener noreferrer">documentation page</a> for more information about property names and values.</p><p id="08a6eba1">You can use an LDAP explorer to browse LDAP directory and verify the settings (for example, <a href="http://www.jxplorer.org/" data-external="true" target="_blank" rel="noopener noreferrer">http://www.jxplorer.org/</a> or <a href="http://www.ldapbrowser.com/softerra-ldap-browser.htm" data-external="true" target="_blank" rel="noopener noreferrer">http://www.ldapbrowser.com/softerra-ldap-browser.htm</a>).</p><p id="ac4537e4">There is an ability to specify failover servers using the following pattern:</p><div class="code-block" data-lang="bash">java.naming.provider.url=ldap://ldap.mycompany.com:389 ldap://ldap2.mycompany.com:389 ldap://ldap3.mycompany.com:389

</div><p id="4ce0266f">The servers are contacted until any of them responds. There is no particular order in which the address list is processed.</p></div></div><a name="Synchronization"></a><a name="Synchronization"></a><div class="chapter"><h2 id="LDAPIntegration-Synchronization">Synchronization</h2><p id="6fc7f467">Synchronization with LDAP in TeamCity allows you to:</p><ul class="list _ul"><li class="list__item" id="44c801ed"><p>Retrieve the user's profile data from LDAP</p></li><li class="list__item" id="eba052f6"><p>Update the user groups membership based on LDAP groups</p></li><li class="list__item" id="509cff1c"><p>Automatically create and remove users in TeamCity based on information retrieved from LDAP</p></li></ul><p id="6d035daa">TeamCity supports one-way synchronization with LDAP: the data is retrieved from LDAP and stored in the TeamCity database. Periodically, TeamCity fetches data from LDAP and updates users in TeamCity.</p><p id="b2a637a8">When synchronization is enabled, you can review the related data and run on-demand synchronization in the <b id="f5052a50">Administration | LDAP Synchronization</b> section of the <a href="teamcity-configuration-and-maintenance.html">server settings</a>.</p><a name="CommonConfiguration"></a><a name="Common-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-CommonConfiguration">Common Configuration</h3><p id="60c36774">You need to have LDAP authentication configured for the synchronization to function.</p><p id="2e5e283d">By default, the synchronization is turned off. To turn it on, add the following option to <code class="code">ldap-config.properties</code> file:</p><div class="code-block" data-lang="bash">teamcity.options.users.synchronize=true

</div><p id="5caad892">You also need to specify the following mandatory properties:</p><ul class="list _ul"><li class="list__item" id="f9e0c059"><p><code class="code">java.naming.security.principal</code> and <code class="code">java.naming.security.credentials</code> - they specify the user credentials which are used by TeamCity to connect to LDAP and retrieve data,</p></li><li class="list__item" id="cd2e8714"><p><code class="code">teamcity.users.base</code> and <code class="code">teamcity.users.filter</code> - these specify the settings to search for users</p></li><li class="list__item" id="df59fd62"><p><code class="code">teamcity.users.username</code> - the name of the LDAP attribute containing the TeamCity user's username. Based on this setting LDAP entries are mapped to the TeamCity users.</p></li></ul><p id="46389785">No users are created or deleted on enabling user's synchronization. Check the <a href="#Creating-and-Deleting-Users">Creating and Deleting Users</a> section for the related configuration.</p></div><a name="UserProfileData"></a><a name="User-Profile-Data"></a><div class="chapter"><h3 id="LDAPIntegration-UserProfileData">User Profile Data</h3><p id="5b8d0a4a">When synchronization is properly configured, TeamCity can retrieve user-related information from LDAP (e-mail, full name, or any custom property) and store it as TeamCity user's details. If updated in LDAP, the data will be updated in the user's profile in TeamCity. If modified in user's profile in TeamCity, the data will no longer be updated from LDAP for the modified fields. All the user fields synchronization properties store the name of LDAP field to retrieve the information from.</p><p id="6efd2da7">The user's profile synchronization is performed on user creation and also periodically for all users.</p><p id="a822c738">The list of supported user settings:</p><ul class="list _ul"><li class="list__item" id="c5f2db3b"><code class="code">teamcity.users.username</code></li><li class="list__item" id="fae459fa"><code class="code">teamcity.users.property.displayName</code></li><li class="list__item" id="1160d470"><code class="code">teamcity.users.property.email</code></li><li class="list__item" id="7cf0ad97"><code class="code">teamcity.users.property.plugin:notificator:jabber:jabber-account</code></li><li class="list__item" id="c82c5519"><p><code class="code">teamcity.users.property.plugin:vcs:&lt;VCS type&gt;:anyVcsRoot</code> – VCS username for all &lt;VCS type&gt; roots. The following VCS types are supported: svn, perforce, jetbrains.git, cvs, tfs, vss, clearcase, starteam.</p></li></ul><p id="ed86b519">Example properties can be seen by configuring them for a user in the web UI and then listing the properties via <a href="rest-api.html#Users">REST API</a>.</p><p id="526ff487"><b id="b0dabb28">Since TeamCity 8.0</b>, there is an <b id="b8898593">experimental</b> feature which allows mapping user profile properties in TeamCity to a formatted combination of LDAP properties rather than to a specific property on user synchronization.<br>To enable the mapping, add <code class="code">teamcity.users.properties.resolve=true</code> to <code class="code">ldap-config.properties</code>.<br>Then you can use the <code class="code">%</code>-references to LDAP attributes in the form of <code class="code">%ldap.userEntry.&lt;attribute&gt;%</code> in the user property definitions. For example,</p><div class="code-block" data-lang="bash">teamcity.users.property.plugin\:notificator\:jabber\:jabber-account=%ldap.userEntry.name%@jabber.my.domain.com

</div></div><a name="UserGroupMembership"></a><a name="User-Group-Membership"></a><div class="chapter"><h3 id="LDAPIntegration-UserGroupMembership">User Group Membership</h3><p id="c758435b">TeamCity can automatically update users membership in groups based on the LDAP-provided data.</p><p id="5244a2a1"><b id="c185c391">To configure Group membership:</b></p><ol class="list _decimal"><li class="list__item" id="5bb85135"><p>Create groups in TeamCity manually.</p></li><li class="list__item" id="f112874f"><p>Specify the mapping of LDAP groups to TeamCity groups in the <code class="code">&lt;TeamCity Data Directory&gt;/config/ldap\-mapping.xml</code> file. Use the <code class="code">ldap-mapping.xml</code>.<a href="teamcity-data-directory.html"><code class="code">dist file</code></a> as an example: TeamCity user groups are determined by the <a href="managing-users-and-user-groups.html#Managing-User-Groups">Group Key</a>, LDAP groups are specified by the group DN.</p></li><li class="list__item" id="f01ba79f">Set the required properties in the <code class="code">ldap-config.properties</code> file, the <b id="8732d0d9">groups settings</b> section:<ul class="list _ul"><li class="list__item" id="151fb451"><p><code class="code">teamcity.options.groups.synchronize</code> - enables user group membership synchronization</p></li><li class="list__item" id="d5b7e3da"><p><code class="code">teamcity.groups.base</code> and <code class="code">teamcity.groups.filter</code> - specifies the LDAP base node and filter to find the groups in LDAP (those configured in the <code class="code">ldap-mapping.xml</code> file should be a subset of the groups found by these settings)</p></li><li class="list__item" id="35fe66b1"><p><code class="code">teamcity.groups.property.member</code> specifies the LDAP attribute holding the members of the group. LDAP groups should have all their members listed in the specified attribute.</p></li></ul></li></ol><p id="ddfaffae">Note that TeamCity only operates with the users matched by <code class="code">teamcity.users.base</code> and <code class="code">teamcity.users.filter</code>settings, so only the users found by these properties will be processed during the group membership synchronization process.</p><p id="8e5c16c0">On each synchronization run, TeamCity updates the membership of users in the groups configured in the mapping.<br>By default, TeamCity synchronizes membership only for users residing directly in the groups.</p><p id="b4292262"><b id="d68ce6e9">To map nested LDAP groups to TeamCity</b>:</p><ul class="list _ul"><li class="list__item" id="0821b20e"><p>either (<b id="e5cfbd5e">since TeamCity 2017.1</b>) specify <code class="code">teamcity.groups.retrieveUsersFromNestedGroups=true</code> in the <code class="code">ldap-config.properties</code> file and make sure all the groups hierarchy is matched by the <code class="code">teamcity.groups.base/teamcity.groups.filter</code> settings</p></li><li class="list__item" id="95923b2e"><p>or copy your LDAP groups structure in TeamCity groups, together with the group inclusions. Then configure the mapping between the TeamCity groups and corresponding LDAP groups.</p></li></ul><p id="b1e023d3">If either an LDAP group or a TeamCity group that is configured in the mapping is not found, an error is reported. You can review the errors found during the last synchronization run in the <b id="0e822960">Administration | LDAP Synchronization</b> section of the <a href="teamcity-configuration-and-maintenance.html">server settings</a>.</p><p id="93d6afcf">See also <a href="typical-ldap-configurations.html#Active-Directory-With-Group-Synchronization">example settings</a> for Active Directory synchronization.</p></div><a name="CreatingandDeletingUsers"></a><a name="Creating-and-Deleting-Users"></a><div class="chapter"><h3 id="LDAPIntegration-CreatingandDeletingUsers">Creating and Deleting Users</h3><p id="d6e82de9">TeamCity can automatically create users in TeamCity, if they are found in one of the mapped LDAP groups and groups synchronization is turned on via the <code class="code">teamcity.options.groups.synchronize</code> option.</p><p id="30e4d44c">By default, automatic user creation is turned off. To turn it on, set the <code class="code">teamcity.options.createUsers</code> property to <code class="code">true</code> in the <code class="code">ldap-config.properties</code> file.</p><p id="9082021d">TeamCity can automatically delete users in TeamCity if they cannot be found in LDAP or do not belong to an LDAP group that is mapped to the predefined "<b id="21e786bd">All Users</b>" group. By default, automatic user deletion is turned off as well; set the <code class="code">teamcity.options.deleteUsers</code> property to turn it on.</p></div><a name="Usernamemigration"></a><a name="Username-migration"></a><div class="chapter"><h3 id="LDAPIntegration-Usernamemigration">Username migration</h3><p id="9e02eb04">The username for the existing users can be updated upon first successful login. For instance, suppose the user previously logged in using 'DOMAIN\user' name, thus the string <code class="code">DOMAIN\user</code> was stored in TeamCity as the username. To synchronize the data with LDAP, the user can change the username to 'user' using the following options:</p><div class="code-block" data-lang="bash">teamcity.users.login.capture=DOMAIN\\\\(.*)
teamcity.users.login.filter=(cn=$login$)
teamcity.users.previousUsername=DOMAIN\\$login$

</div><p id="a591698e">The first property allows you to capture the username from the input login and use it to authenticate the user (can be particularly useful when the domain 'DOMAIN' isn't stored anywhere in LDAP). The second property <code class="code">teamcity.users.login.filter</code> allows you to fetch the username from LDAP by specifying the search filter to find this user (other mandatory properties to use this feature: <code class="code">teamcity.users.base</code> and <code class="code">teamcity.users.username</code>). The third property allows you to find the <code class="code">DOMAIN\user</code> username when login with just 'user', and replace it with either the captured login, or with the username from LDAP.</p><p id="7b9db38f">Note that if any of these properties are not set or cannot be applied, the username isn't changed (the input login name is used).</p><p id="ab1be2b5">More configuration examples are available <a href="typical-ldap-configurations.html">here</a>.</p></div></div><a name="Miscellaneous"></a><a name="Miscellaneous"></a><div class="chapter"><h2 id="LDAPIntegration-Miscellaneous">Miscellaneous</h2><a name="SwitchingtoLDAPAuthentication"></a><a name="Switching-to-LDAP-Authentication"></a><div class="chapter"><h3 id="LDAPIntegration-SwitchingtoLDAPAuthentication">Switching to LDAP Authentication</h3><p id="13d1c93a">When you add the LDAP authentication module on a TeamCity server which already has users, the users can still log in using the previous authentication modules credentials (unless you remove the modules). On a successful LDAP login, LDAP retrieves a username as configured by the <code class="code">teamcity.users.username</code> property and if there is already a user with such TeamCity username, user logs in as the matching user. If there is no existing user, a new one is created with the username retrieved from LDAP.</p></div><a name="Scramblingcredentialsinldap-config.propertiesfile"></a><a name="Scrambling-credentials-in-ldap-config.properties-file"></a><div class="chapter"><h3 id="LDAPIntegration-Scramblingcredentialsinldap-config.propertiesfile">Scrambling credentials in ldap-config.properties file</h3><p id="cdcc36e0">The <code class="code">java.naming.security.credentials</code> property can store the password either in the plain-text or scrambled form. TeamCity needs the raw password value when authenticating in LDAP server, so the password should be stored in a reversible form.You can get the scrambled value using the command below and then set the property to the the scrambled value.</p><p id="f7457d0a">Note that scrambling is not encryption: it protects the password from being easily remembered when seen occasionally, but it does not protect against getting the real password value when someone gets the scrambled password value.</p><p id="c86bfbf2">To get the scrambled password value, execute the following command (must be executed from the <code class="code">&lt;TeamCity installation directory&gt;/webapps/ROOT/WEB-INF/lib</code> directory:</p><p id="b86a546d">For Windows:</p><div class="code-block" data-lang="bash">java -cp serviceMessages.jar;common-api.jar;commons-codec.jar;commons-codec-1.3.jar;log4j-1.2.12.jar jetbrains.buildServer.serverSide.crypt.ScrambleMain "&lt;text to scramble&gt;"

</div><p id="d3593ddb">For Linux:</p><div class="code-block" data-lang="bash">java -cp serviceMessages.jar:common-api.jar:commons-codec.jar:commons-codec-1.3.jar:log4j-1.2.12.jar jetbrains.buildServer.serverSide.crypt.ScrambleMain "&lt;text to scramble&gt;"

</div></div><a name="DebuggingLDAPIntegration"></a><a name="Debugging-LDAP-Integration"></a><div class="chapter"><h3 id="LDAPIntegration-DebuggingLDAPIntegration">Debugging LDAP Integration</h3><p id="8b87dbfb">Internal LDAP logs are stored in <code class="code">logs/teamcity-ldap.log*</code> files in the <a href="teamcity-server-logs.html">server logs</a>. If you encounter an issue with LDAP configuration, it is advised that you look into the logs as the issue can often be figured out from the messages in there. To get detailed logs of LDAP login and synchronization processes, use the "debug-ldap" <a href="teamcity-server-logs.html">logging preset</a>.</p><p id="42bcd876">If you want to <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">report an LDAP issue to us</a>, make sure to include LDAP settings (<code class="code">&lt;TeamCity Data Directory&gt;/config/ldap-config.properties</code> and <code class="code">ldap-mapping.xml</code> files, with password in <code class="code">ldap-config.properties</code> masked) and debug LDAP logs fully covering a login/synchronization sequence (include all <code class="code">teamcity-ldap.log*</code> files). Make sure to describe the related structure of your LDAP (noting the attributes of related LDAP entities) and detail expected/actual behavior. The archive with the data can be sent to us via <a href="reporting-issues.html#Uploading-Large-Data-Archives">one of the supported ways</a>.</p><hr id="cce3e94e"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>