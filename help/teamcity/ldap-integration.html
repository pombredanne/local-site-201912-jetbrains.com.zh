<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>LDAP集成-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="LDAP Integration" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/configuring-authentication-settings.md|Configuring Authentication Settings/ldap-integration.md|LDAP Integration/typical-ldap-configurations.md|Typical LDAP Configurations/ldap-troubleshooting.md|LDAP Troubleshooting" data-main-title="LDAP Integration" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/ldap-integration.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="ldap-integration.md" data-toc="LDAP Integration">LDAP整合</h1><p id="890690e3">TeamCity中的LDAP集成有两个级别：身份验证（登录）和用户同步：</p><ul class="list _ul"><li class="list__item" id="aa02dee8"><p><b id="4e0ee2df">身份验证</b>使您可以使用LDAP服务器凭据登录TeamCity。</p></li><li class="list__item" id="1721d0ea"><p>一旦配置了LDAP身份验证，便可以启用LDAP <b id="3feca6ce">同步</b> ，从而可以自动使用来自LDAP的用户数据填充TeamCity用户集。LDAP集成是通用的，可以为Active Directory或其他LDAP服务器配置。</p></li></ul><aside class="note " rel="bb7047aa" id="0c67c965" data-title=""><p id="8c82283e">建议在生产服务器中启用LDAP身份验证之前，先在测试服务器上对其进行配置，因为切换到配置错误的身份验证方案可能会导致用户无法登录TeamCity。</p></aside><p id="8bd38441">LDAP集成配置可能并非易事，因此可能需要一些反复试验才能获得正确的设置。请查看<a href="typical-ldap-configurations.html">典型的LDAP配置</a> 。如果发生问题， <a href="#Debugging-LDAP-Integration">LDAP日志</a>应为您提供足够的信息，以了解可能的错误配置。如果在阅读完本文档并调查了日志后配置LDAP集成时遇到困难，请<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">与我们联系，</a>并让我们知道您的LDAP设置，并详细说明您要实现的目标和当前获得的目标。</p><p id="84443d94">在此页：</p><p id="8a1d904d"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#LDAPIntegration-Authentication">认证方式</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-ldap-config.propertiesConfiguration">ldap-config.properties配置</a></li><li class="list__item"><a href="#LDAPIntegration-ConfiguringUserLogin">配置用户登录</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-ActiveDirectory">活动目录</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-AdvancedConfiguration">进阶设定</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-Synchronization">同步化</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-CommonConfiguration">通用配置</a></li><li class="list__item"><a href="#LDAPIntegration-UserProfileData">用户资料数据</a></li><li class="list__item"><a href="#LDAPIntegration-UserGroupMembership">用户组成员资格</a></li><li class="list__item"><a href="#LDAPIntegration-CreatingandDeletingUsers">创建和删除用户</a></li><li class="list__item"><a href="#LDAPIntegration-Usernamemigration">用户名迁移</a></li></ul></li><li class="list__item"><a href="#LDAPIntegration-Miscellaneous">杂</a><ul class="list _bullet"><li class="list__item"><a href="#LDAPIntegration-SwitchingtoLDAPAuthentication">切换到LDAP认证</a></li><li class="list__item"><a href="#LDAPIntegration-Scramblingcredentialsinldap-config.propertiesfile">ldap-config.properties文件中的加扰凭证</a></li><li class="list__item"><a href="#LDAPIntegration-DebuggingLDAPIntegration">调试LDAP集成</a></li></ul></li></ul><p></p><a name="Authentication"></a><a name="Authentication"></a><div class="chapter"><h2 id="LDAPIntegration-Authentication">认证方式</h2><p id="938540b3">要允许使用LDAP凭据登录TeamCity，您需要在<code class="code">ldap-config.properties</code>文件并在服务器的“ <a href="configuring-authentication-settings.html">身份验证”部分</a>启用LDAP身份<a href="configuring-authentication-settings.html">验证</a> 。</p><p id="540435b6">如果您需要在不访问Web UI的情况下配置身份验证，请参考先前文档版本中的<a href="https://confluence.jetbrains.com/display/TCD8/LDAP+Integration" rel="noopener noreferrer" data-external="true" target="_blank">相应部分</a> 。</p><p id="f060ea98">当。。。的时候<code class="code">Allow creating new users on the first login</code>选项被选中（这是默认设置），将在首次成功登录时创建一个新的用户帐户。新用户的TeamCity用户名将基于配置设置从其LDAP数据派生。所有新创建的用户都属于“ <a href="user-group.html">用户组”</a>组，并且已将所有角色分配给该组。如果新注册的用户需要某些特定<a href="role-and-permission.html">角色</a> ，则<a href="managing-roles.html">可以</a>通过“ <b id="8ad4f26e">所有用户”</b>组<a href="managing-roles.html">授予</a>这些角色。</p><p id="13fb3720">TeamCity将用户帐户和详细信息存储在其自己的数据库中。有关从LDAP自动创建用户和自动填充用户详细信息的信息，请参阅“ <a href="#Synchronization">同步”</a>部分。</p><a name="ldap-config.propertiesConfiguration"></a><a name="ldap-config.properties-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-ldap-config.propertiesConfiguration">ldap-config.properties配置</h3><p id="176ec7df">LDAP集成设置在<code class="code"><TeamCity Data Directory>/config/ldap-config.properties</code>服务器上的文件。</p><p id="e10d371b">通过复制创建文件<code class="code"><TeamCity Data Directory>/config/ldap-config.properties.dist</code>文件并将其重命名为<code class="code"><TeamCity Data Directory>/config/ldap-config.properties</code> ;按照文件中的注释按要求编辑默认设置。</p><p id="8cf2fa90">该文件使用标准的Java属性文件语法，因此必须正确<a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream)" rel="noopener noreferrer" data-external="true" target="_blank">转义</a>文件中的所有值。任何修改都会重新读取该文件，因此您无需重新启动服务器即可在文件中应用更改。</p><p id="d7d3eea6">强烈建议备份文件的先前版本：如果您错误配置LDAP集成，则可能不再能够登录TeamCity。已登录的用户不受修改的LDAP集成设置的影响，因为仅在登录时对用户进行身份验证。</p><p id="0ce2edb5">中的强制属性<code class="code">ldap-config.properties</code>文件是<code class="code">java.naming.provider.url</code>配置服务器和根DN。该属性将URL存储到在以下LDAP查询中使用的LDAP服务器节点。例如， <code class="code">ldap://dc.example.com:389/CN=Users,DC=Example,DC=Com</code> 。请注意，如有必要，该属性的值应使用URL转义。例如使用<code class="code">%20</code>如果需要空格字符。</p><aside class="note " rel="0ce2edb5" id="5bbfa8c5" data-title=""><p id="0aa79d66">对于样品<code class="code">ldap-config.properties</code>请参阅“ <a href="typical-ldap-configurations.html">典型LDAP配置”</a>页面。支持的配置属性记录在<code class="code">ldap-config.properties.dist</code>文件。</p></aside></div><a name="ConfiguringUserLogin"></a><a name="Configuring-User-Login"></a><div class="chapter"><h3 id="LDAPIntegration-ConfiguringUserLogin">配置用户登录</h3><p id="a474f460">常规登录顺序如下：</p><ul class="list _ul"><li class="list__item" id="65de218d"><p>根据用户在登录表单中输入的用户名，执行LDAP搜索（由<code class="code">teamcity.users.login.filter</code> LDAP过滤器，通过该过滤器引用用户输入的用户名<code class="code">$login$</code>要么<code class="code">$capturedLogin$</code>用户基本LDAP节点内的子字符串（由<code class="code">teamcity.users.base</code> ），</p></li><li class="list__item" id="06f34b56"><p>如果搜索成功，则使用搜索过程中找到的DN和用户输入的密码执行身份验证（LDAP绑定），</p></li><li class="list__item" id="b10453eb"><p>如果身份验证成功，则在必要时创建TeamCity用户并登录。从找到的LDAP条目的属性中检索TeamCity用户的名称（该属性名称是通过<code class="code">teamcity.users.username</code>属性）</p></li></ul><p id="f41ac24a">当用户通过LDAP登录时，TeamCity不存储用户密码。每次用户登录时，都基于登录表单中输入的值，使用凭据直接登录LDAP来执行身份验证。</p><p id="378d2466">请注意，在某些配置中（例如， <code class="code">java.naming.security.authentication=simple</code> ），登录信息将以未加密的形式发送到LDAP服务器。要确保连接安全，请参考<a href="http://java.sun.com/products/jndi/tutorial/ldap/security/sasl.html" rel="noopener noreferrer" data-external="true" target="_blank">Sun文档</a> 。另一个选择是通过ldaps协议配置通信。</p><p id="7d83b9d8">相关的外部链接：AlexanderGroß的“ <a href="http://www.therightstuff.de/2009/02/02/How-To-Set-Up-Secure-LDAP-Authentication-With-TeamCity.aspx" rel="noopener noreferrer" data-external="true" target="_blank">如何使用TeamCity设置安全LDAP身份验证”</a> 。</p><a name="ActiveDirectory"></a><a name="Active-Directory"></a><div class="chapter"><h4 id="LDAPIntegration-ActiveDirectory">活动目录</h4><p id="d0ce7ba9">以下模板启用对活动目录的身份验证：</p><p id="97c187cd">将以下代码添加到< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > /config/ldap-config.properties文件中（假设域名为<code class="code">Example.Com</code>和域控制器是<code class="code">dc.example.com</code> ）。</p><p id="9c8fb086">要使用安全连接（ldaps），请使用如下网址<code class="code">ldaps://dc.example.com:636/DC=Example,DC=Com</code> ，对于纯连接（ldap），请使用如下网址<code class="code">ldap://dc.example.com:389/DC=Example,DC=Com</code> （请注意其他端口）。</p><div class="code-block" data-lang="bash">java.naming.provider.url = ldaps：//dc.example.com：636 / DC = Example，DC = Com java.naming.security.principal = <username>java.naming.security.credentials = <password>teamcity.users.login.filter =（sAMAccountName = $ capturedLogin $）teamcity.users.username = sAMAccountName java.naming.security.authentication =简单的java.naming.referral =关注</password></username></div></div></div><a name="AdvancedConfiguration"></a><a name="Advanced-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-AdvancedConfiguration">进阶设定</h3><p id="a10ec52f">如果您需要微调LDAP连接设置，则可以添加<code class="code">java.naming</code>选项<code class="code">ldap-config.properties</code>文件：它们将被传递到底层Java库。使用以下选项检索默认选项<code class="code">java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory</code> 。有关属性名称和值的更多信息，请参考Java <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jndi/jndi-ldap.html" rel="noopener noreferrer" data-external="true" target="_blank">文档页面</a> 。</p><p id="08a6eba1">您可以使用LDAP资源管理器浏览LDAP目录并验证设置（例如， <a href="http://www.jxplorer.org/" rel="noopener noreferrer" data-external="true" target="_blank">http://www.jxplorer.org/</a>或<a href="http://www.ldapbrowser.com/softerra-ldap-browser.htm" rel="noopener noreferrer" data-external="true" target="_blank">http://www.ldapbrowser.com/softerra-ldap-browser.htm</a> ）。</p><p id="ac4537e4">可以使用以下模式指定故障转移服务器：</p><div class="code-block" data-lang="bash">java.naming.provider.url = ldap：//ldap.mycompany.com：389 ldap：//ldap2.mycompany.com：389 ldap：//ldap3.mycompany.com：389</div><p id="4ce0266f">联系服务器，直到其中任何一个服务器响应为止。没有特定的顺序来处理地址列表。</p></div></div><a name="Synchronization"></a><a name="Synchronization"></a><div class="chapter"><h2 id="LDAPIntegration-Synchronization">同步化</h2><p id="6fc7f467">通过TeamCity中的LDAP同步，您可以：</p><ul class="list _ul"><li class="list__item" id="44c801ed"><p>从LDAP检索用户的个人资料数据</p></li><li class="list__item" id="eba052f6"><p>根据LDAP组更新用户组成员身份</p></li><li class="list__item" id="509cff1c"><p>根据从LDAP检索到的信息自动在TeamCity中创建和删除用户</p></li></ul><p id="6d035daa">TeamCity支持与LDAP的单向同步：从LDAP检索数据并将其存储在TeamCity数据库中。TeamCity定期从LDAP获取数据并更新TeamCity中的用户。</p><p id="b2a637a8">启用同步后，您可以在“ <b id="f5052a50">管理” |</b> “ <b id="f5052a50">管理”中</b>查看相关数据并运行按需同步。 <a href="teamcity-configuration-and-maintenance.html">服务器设置的“</a> <b id="f5052a50">LDAP同步”</b>部分。</p><a name="CommonConfiguration"></a><a name="Common-Configuration"></a><div class="chapter"><h3 id="LDAPIntegration-CommonConfiguration">通用配置</h3><p id="60c36774">您需要配置LDAP身份验证才能使同步起作用。</p><p id="2e5e283d">默认情况下，同步是关闭的。要打开它，将以下选项添加到<code class="code">ldap-config.properties</code>文件：</p><div class="code-block" data-lang="bash">teamcity.options.users.synchronize = true</div><p id="5caad892">您还需要指定以下强制属性：</p><ul class="list _ul"><li class="list__item" id="f9e0c059"><p><code class="code">java.naming.security.principal</code>和<code class="code">java.naming.security.credentials</code> -他们指定TeamCity用于连接LDAP和检索数据的用户凭证，</p></li><li class="list__item" id="cd2e8714"><p><code class="code">teamcity.users.base</code>和<code class="code">teamcity.users.filter</code> -这些指定用于搜索用户的设置</p></li><li class="list__item" id="df59fd62"><p><code class="code">teamcity.users.username</code> -包含TeamCity用户的用户名的LDAP属性的名称。基于此设置，LDAP条目将映射到TeamCity用户。</p></li></ul><p id="46389785">启用用户同步后，不会创建或删除任何用户。检查“ <a href="#Creating-and-Deleting-Users">创建和删除用户”</a>部分以获取相关配置。</p></div><a name="UserProfileData"></a><a name="User-Profile-Data"></a><div class="chapter"><h3 id="LDAPIntegration-UserProfileData">用户资料数据</h3><p id="5b8d0a4a">正确配置同步后，TeamCity可以从LDAP中检索与用户相关的信息（电子邮件，全名或任何自定义属性），并将其存储为TeamCity用户的详细信息。如果在LDAP中更新，则数据将在TeamCity中的用户个人资料中更新。如果在TeamCity中的用户个人资料中进行了修改，则将不再从LDAP更新已修改字段的数据。所有用户字段同步属性都存储LDAP字段的名称以从中检索信息。</p><p id="6efd2da7">用户的配置文件同步是在用户创建时执行的，并且会定期对所有用户执行。</p><p id="a822c738">支持的用户设置列表：</p><ul class="list _ul"><li class="list__item" id="c5f2db3b"><code class="code">teamcity.users.username</code></li><li class="list__item" id="fae459fa"><code class="code">teamcity.users.property.displayName</code></li><li class="list__item" id="1160d470"><code class="code">teamcity.users.property.email</code></li><li class="list__item" id="7cf0ad97"><code class="code">teamcity.users.property.plugin:notificator:jabber:jabber-account</code></li><li class="list__item" id="c82c5519"><p><code class="code">teamcity.users.property.plugin:vcs:<VCS type>:anyVcsRoot</code> –所有<vcs type="">根的 VCS用户名<vcs type="">。支持以下VCS类型：svn，perforce，jetbrains.git，cvs，tfs，vss，clearcase，starteam。</vcs></vcs></p></li></ul><p id="ed86b519">通过在Web UI中为用户配置示例属性，然后通过<a href="rest-api.html#Users">REST API</a>列出属性，可以看到示例属性。</p><p id="526ff487"><b id="b0dabb28">自TeamCity 8.0起</b> ，存在一项<b id="b8898593">实验性</b>功能，该功能允许将TeamCity中的用户配置文件属性映射到LDAP属性的格式化组合，而不是映射到用户同步时的特定属性。<br>要启用映射，请添加<code class="code">teamcity.users.properties.resolve=true</code>至<code class="code">ldap-config.properties</code> 。<br>然后您可以使用<code class="code">%</code> -对LDAP属性的引用形式为<code class="code">%ldap.userEntry.<attribute>%</code>在用户属性定义中。例如，</p><div class="code-block" data-lang="bash">teamcity.users.property.plugin \：notificator \：jabber \：jabber-account=%ldap.userEntry.name%@jabber.my.domain.com</div></div><a name="UserGroupMembership"></a><a name="User-Group-Membership"></a><div class="chapter"><h3 id="LDAPIntegration-UserGroupMembership">用户组成员资格</h3><p id="c758435b">TeamCity可以根据LDAP提供的数据自动更新组中的用户成员身份。</p><p id="5244a2a1"><b id="c185c391">要配置组成员身份：</b></p><ol class="list _decimal"><li class="list__item" id="5bb85135"><p>在TeamCity中手动创建组。</p></li><li class="list__item" id="f112874f"><p>在中指定LDAP组到TeamCity组的映射<code class="code"><TeamCity Data Directory>/config/ldap\-mapping.xml</code>文件。使用<code class="code">ldap-mapping.xml</code> 。 <a href="teamcity-data-directory.html"><code class="code">dist file</code></a>例如：TeamCity用户组由<a href="managing-users-and-user-groups.html#Managing-User-Groups">组密钥</a>确定，LDAP组由组DN指定。</p></li><li class="list__item" id="f01ba79f">在中设置所需的属性<code class="code">ldap-config.properties</code>文件， <b id="8732d0d9">组设置</b>部分：<ul class="list _ul"><li class="list__item" id="151fb451"><p><code class="code">teamcity.options.groups.synchronize</code> -启用用户组成员身份同步</p></li><li class="list__item" id="d5b7e3da"><p><code class="code">teamcity.groups.base</code>和<code class="code">teamcity.groups.filter</code> -指定LDAP基本节点，并进行过滤以查找LDAP中的组（在<code class="code">ldap-mapping.xml</code>文件应该是这些设置找到的组的子集）</p></li><li class="list__item" id="35fe66b1"><p><code class="code">teamcity.groups.property.member</code>指定保存组成员的LDAP属性。LDAP组应在指定属性中列出其所有成员。</p></li></ul></li></ol><p id="ddfaffae">请注意，TeamCity仅在与<code class="code">teamcity.users.base</code>和<code class="code">teamcity.users.filter</code>设置，因此在组成员身份同步过程中将仅处理通过这些属性找到的用户。</p><p id="8e5c16c0">在每次同步运行中，TeamCity都会更新映射中配置的组中的用户成员身份。<br>默认情况下，TeamCity仅同步直接位于组中的用户的成员资格。</p><p id="b4292262"><b id="d68ce6e9">要将嵌套的LDAP组映射到TeamCity</b> ：</p><ul class="list _ul"><li class="list__item" id="0821b20e"><p>（ <b id="e5cfbd5e">自TeamCity 2017.1起</b> ）指定<code class="code">teamcity.groups.retrieveUsersFromNestedGroups=true</code>在里面<code class="code">ldap-config.properties</code>文件，并确保所有组层次结构都与<code class="code">teamcity.groups.base/teamcity.groups.filter</code>设定</p></li><li class="list__item" id="95923b2e"><p>或复制TeamCity组中的LDAP组结构以及组包含。然后配置TeamCity组和相应的LDAP组之间的映射。</p></li></ul><p id="b1e023d3">如果找不到映射中配置的LDAP组或TeamCity组，则会报告错误。您可以在“ <b id="0e822960">管理” |</b> “ <b id="0e822960">管理”中</b>查看在上一次同步运行期间发现的错误<b id="0e822960">。</b> <a href="teamcity-configuration-and-maintenance.html">服务器设置的“</a> <b id="0e822960">LDAP同步”</b>部分。</p><p id="93d6afcf">另请参阅Active Directory同步的<a href="typical-ldap-configurations.html#Active-Directory-With-Group-Synchronization">示例设置</a> 。</p></div><a name="CreatingandDeletingUsers"></a><a name="Creating-and-Deleting-Users"></a><div class="chapter"><h3 id="LDAPIntegration-CreatingandDeletingUsers">创建和删除用户</h3><p id="d6e82de9">如果在映射的LDAP组之一中找到了TeamCity的用户并且通过打开了组同步，则TeamCity可以在TeamCity中自动创建用户。 <code class="code">teamcity.options.groups.synchronize</code>选项。</p><p id="30e4d44c">默认情况下，自动创建用户功能处于关闭状态。要打开它，请设置<code class="code">teamcity.options.createUsers</code>财产<code class="code">true</code>在里面<code class="code">ldap-config.properties</code>文件。</p><p id="9082021d">如果在LDAP中找不到用户或不属于映射到预定义的“ <b id="21e786bd">所有用户</b> ”组的LDAP组，则TeamCity可以自动删除TeamCity中的<b id="21e786bd">用户</b> 。默认情况下，自动用户删除功能也处于关闭状态；设置<code class="code">teamcity.options.deleteUsers</code>属性以将其打开。</p></div><a name="Usernamemigration"></a><a name="Username-migration"></a><div class="chapter"><h3 id="LDAPIntegration-Usernamemigration">用户名迁移</h3><p id="9e02eb04">首次成功登录后，可以更新现有用户的用户名。例如，假设用户以前使用“ DOMAIN \ user”名称登录，则该字符串为<code class="code">DOMAIN\user</code>已作为用户名存储在TeamCity中。要将数据与LDAP同步，用户可以使用以下选项将用户名更改为“ user”：</p><div class="code-block" data-lang="bash">teamcity.users.login.capture = DOMAIN \\\\（。*）teamcity.users.login.filter =（cn = $ login $）teamcity.users.previousUsername = DOMAIN \\ $ login $</div><p id="a591698e">第一个属性允许您从输入的登录名中捕获用户名，并使用它来对用户进行身份验证（当域“ DOMAIN”未存储在LDAP中的任何位置时，该功能特别有用）。第二个属性<code class="code">teamcity.users.login.filter</code>允许您通过指定搜索过滤器来查找该用户来从LDAP中获取用户名（使用此功能的其他必填属性： <code class="code">teamcity.users.base</code>和<code class="code">teamcity.users.username</code> ）。第三个属性可让您找到<code class="code">DOMAIN\user</code>仅使用“用户”登录时的用户名，然后将其替换为捕获的登录名或LDAP中的用户名。</p><p id="7b9db38f">请注意，如果未设置或无法应用任何这些属性，则用户名不会更改（使用输入的登录名）。</p><p id="ab1be2b5"><a href="typical-ldap-configurations.html">此处</a>提供更多配置示例。</p></div></div><a name="Miscellaneous"></a><a name="Miscellaneous"></a><div class="chapter"><h2 id="LDAPIntegration-Miscellaneous">杂</h2><a name="SwitchingtoLDAPAuthentication"></a><a name="Switching-to-LDAP-Authentication"></a><div class="chapter"><h3 id="LDAPIntegration-SwitchingtoLDAPAuthentication">切换到LDAP认证</h3><p id="13d1c93a">在已经有用户的TeamCity服务器上添加LDAP身份验证模块时，用户仍可以使用以前的身份验证模块凭据登录（除非您删除了这些模块）。LDAP成功登录后，LDAP将检索由<code class="code">teamcity.users.username</code>属性，如果已经有一个具有这样的TeamCity用户名的用户，则该用户以匹配的用户身份登录。如果没有现有用户，则会使用从LDAP检索的用户名创建一个新用户。</p></div><a name="Scramblingcredentialsinldap-config.propertiesfile"></a><a name="Scrambling-credentials-in-ldap-config.properties-file"></a><div class="chapter"><h3 id="LDAPIntegration-Scramblingcredentialsinldap-config.propertiesfile">ldap-config.properties文件中的加扰凭证</h3><p id="cdcc36e0">的<code class="code">java.naming.security.credentials</code>属性可以以纯文本或加扰的形式存储密码。在LDAP服务器中进行身份验证时，TeamCity需要原始密码值，因此密码应以可逆的形式存储。您可以使用以下命令获取加扰值，然后将属性设置为加扰值。</p><p id="f7457d0a">请注意，加扰不是加密的：它可以防止密码偶尔被轻易记住，但当有人获得加扰的密码值时，也无法防止获得真实的密码值。</p><p id="c86bfbf2">要获取加密的密码值，请执行以下命令（必须从<code class="code"><TeamCity installation directory>/webapps/ROOT/WEB-INF/lib</code>目录：</p><p id="b86a546d">对于Windows：</p><div class="code-block" data-lang="bash">java -cp serviceMessages.jar; common-api.jar; commons-codec.jar; commons-codec-1.3.jar; log4j-1.2.12.jar jetbrains.buildServer.serverSide.crypt。ScrambleMain <text to="" scramble="">“”</text></div><p id="d3593ddb">对于Linux：</p><div class="code-block" data-lang="bash">java -cp serviceMessages.jar：common-api.jar：commons-codec.jar：commons-codec-1.3.jar：log4j-1.2.12.jar jetbrains.buildServer.serverSide.crypt。ScrambleMain“ <text to="" scramble="">”</text></div></div><a name="DebuggingLDAPIntegration"></a><a name="Debugging-LDAP-Integration"></a><div class="chapter"><h3 id="LDAPIntegration-DebuggingLDAPIntegration">调试LDAP集成</h3><p id="8b87dbfb">内部LDAP日志存储在<code class="code">logs/teamcity-ldap.log*</code> <a href="teamcity-server-logs.html">服务器日志中的</a>文件。如果您遇到LDAP配置问题，建议您查看日志，因为通常可以从那里的消息中找出问题。要获取LDAP登录和同步过程的详细日志，请使用“ debug-ldap” <a href="teamcity-server-logs.html">日志记录预设</a> 。</p><p id="42bcd876">如果您想向我们<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">报告LDAP问题</a> ，请确保包括LDAP设置（ <code class="code"><TeamCity Data Directory>/config/ldap-config.properties</code>和<code class="code">ldap-mapping.xml</code>文件，密码输入<code class="code">ldap-config.properties</code>屏蔽）并调试LDAP日志，完全覆盖了登录/同步序列（包括所有<code class="code">teamcity-ldap.log*</code>文件）。确保描述LDAP的相关结构（注意相关LDAP实体的属性）并详细说明预期的/实际的行为。可以通过<a href="reporting-issues.html#Uploading-Large-Data-Archives">一种受支持的方式</a>将包含数据的存档发送给我们。</p><hr id="cce3e94e"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>