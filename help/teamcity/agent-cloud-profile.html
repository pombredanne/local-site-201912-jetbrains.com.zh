<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Agent Cloud Profile - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Agent Cloud Profile" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/agent-cloud-profile.md|Agent Cloud Profile" data-main-title="Agent Cloud Profile" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/agent-cloud-profile.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Agent Cloud Profile" id="agent-cloud-profile.md">Agent Cloud Profile</h1><p id="2ba0007e">On this page:</p><p id="5e0a7689"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#AgentCloudProfile-ConfiguringCloudProfile">Configuring Cloud Profile</a><ul class="list _bullet"><li class="list__item"><a href="#AgentCloudProfile-Specifyingprofilesettings">Specifying profile settings</a></li><li class="list__item"><a href="#AgentCloudProfile-AddingAgentImage">Adding Agent Image</a></li></ul></li><li class="list__item"><a href="#AgentCloudProfile-ViewingCloudAgentInformation">Viewing Cloud Agent Information</a></li><li class="list__item"><a href="#AgentCloudProfile-Enabling/disablingCloudIntegrationinProject">Enabling/disabling Cloud Integration in Project</a></li></ul></p><p id="4ec712fc">A <i id="d99d1d28">cloud profile</i> is a collection of settings for TeamCity to start virtual machines with installed TeamCity agents on-demand while distributing a build queue. Configuring a cloud provider profile is one of the steps required to <a href="teamcity-integration-with-cloud-solutions.html">enable agent cloud integration</a> between TeamCity and a cloud provider. The settings of profiles slightly vary depending on the cloud type.</p><aside class="tip sideblock" data-title="" rel="4ec712fc" id="0e9ee30e"><p id="5f70ae03">Note that after an upgrade, if you use Kotlin DSL for your TeamCity project settings, you need to update your DSL as described <a href="upgrading-dsl.html">here</a>.</p></aside><a name="ConfiguringCloudProfile"></a><a name="Configuring-Cloud-Profile"></a><div class="chapter"><h2 id="AgentCloudProfile-ConfiguringCloudProfile">Configuring Cloud Profile</h2><p id="9eff0e27">Cloud profiles are configured in the <b id="272b5338">Cloud Profiles</b> section of the <b id="0bd8d92e">Project Settings</b>.</p><a name="Specifyingprofilesettings"></a><a name="Specifying-profile-settings"></a><div class="chapter"><h3 id="AgentCloudProfile-Specifyingprofilesettings">Specifying profile settings</h3><p id="3ac879b8">The following profile settings have to be provided:</p><div class="table-wrapper"><table width="100%" id="c7647aee"><thead><tr id="8ea5eaac" class="ijRowHead"><th id="a7403076"><p id="7bde5d71">Setting</p></th><th id="631f2a0d"><p id="9f517ae2">Description</p></th></tr></thead><tbody><tr id="183114bb" class="ijRowOdd"><td id="96767843"><p id="efe846d5">Profile name</p></td><td id="636f8b3d"><p id="307ae5a2">Provide a name for the profile.</p></td></tr><tr id="e6c492ff" class="ijRowEven"><td id="488afc86"><p id="ef1af21a">Description</p></td><td id="ca780027"><p id="b657e880">Provide an optional profile description.</p></td></tr><tr id="6b87c348" class="ijRowOdd"><td id="aabccf29"><p id="ac7b7049">Cloud type</p></td><td id="8592b647"><p id="c9fec417">Select the cloud provider type from the drop-down menu.</p></td></tr><tr id="1dbe749b" class="ijRowEven"><td id="c9acdbf1"><p id="60229074">Server URL</p></td><td id="4c06ae10"><p id="de08f5ca">The URL that the agents cloned from the image will use to connect to the TeamCity server. This URL must be available from the build agent machine.<br>If this field is left empty, agents will use the <a href="configuring-server-url.html">TeamCity server URL</a> specified on the <b id="2f021ade">Administration | Global Settings</b> page.</p></td></tr><tr id="f1ca435d" class="ijRowOdd"><td id="f2e161a8"><p id="8bf69827">Terminate instance idle time</p></td><td id="d538a4b1"><p id="81bff378">Instruct TeamCity to stop a cloud agent machine using this setting and the <b id="ad089610">Additional terminate condition</b> options. Specify the period (in minutes) for TeamCity to wait before stopping an idle build agent.<br>Leave empty for no timeout.</p></td></tr><tr id="0dcc25bd" class="ijRowEven"><td id="567941fd"><p id="67bc7e9d">Additional terminate conditions</p></td><td id="9ae58b33"><ul class="list _ul"><li class="list__item" id="82c1a6c0"><p><i id="c18432d1">After certain work time (minutes)</i>:<br>Specify the working time (in minutes) for the agent after which the instance will be terminated. If the time elapses while a build is in progress, the agent will wait until the current build finishes.</p></li><li class="list__item" id="9e66e4ea"><p><i id="31d940d5">On idle, close to an hour (minutes left to the end of hour)</i>:<br>Specify how many minutes before the full hour an idle instance should be stopped: this allows avoiding charges for partial hours if your virtual machines are billed in whole hours, for example, when using Amazon EC2 instances.</p></li><li class="list__item" id="6c311562"><p><i id="5b3a06fd">After the first build</i>:<br>Select this option if you want TeamCity to stop the virtual machine immediately after the first build finishes. TeamCity will disable the build agents, and no more builds will be run on the same machine.</p></li></ul></td></tr></tbody></table></div><p id="7f9f22ec">Next, you need to provide the cloud access information which will differ depending on the provider. After that, you can check the connection and add an image to be used as a source for TeamCity cloud agents.</p><p id="1f5ce79d">You can limit the number of instances across all images in the cloud profile (<b id="04839f0f">Maximum instances count</b>) and/or set the limit per image (in <a href="#Adding-Agent-Image">image settings</a>).</p></div><a name="AddingAgentImage"></a><a name="Adding-Agent-Image"></a><div class="chapter"><h3 id="AgentCloudProfile-AddingAgentImage">Adding Agent Image</h3><p id="3d0900e5">Click <b id="575f7b50">Add Image</b> and configure the required options for the image.</p><p id="eca5913e">You can specify which <a href="agent-pools.html">agent pool</a> the agents should belong to. You can only select the pool that contains this project and/or its subprojects. Pools containing projects other than the current one and its subprojects will not be available for assignment. If the selected agent pool is changed in the future so that the criteria are not met or if the agent pool is not specified, TeamCity will automatically assign the cloud agents to the <i id="7e9e7b2c">project agent pool</i>. You can also select the <i id="4b505145">&lt;Project pool&gt;</i> in the drop-down menu manually.<br>TeamCity automatically composes the project pool containing agents from all cloud profiles of the current project and all its subprojects. Thus, the added image will be available to all the subprojects as well. On the <b id="e3eaf286">Agents | Pools</b> page, this pool is marked as "<i id="ab7a9311">&lt;Project name&gt; project pool</i>". Project pools cannot be deleted or modified.</p><p id="347d1b99">After an Agent Cloud profile is created with one or several sources for virtual machines, TeamCity does a test start for all the virtual machines specified in the profile to learn about the agents configured on them. Once agents are connected, TeamCity calculates their build configurations-to-agents compatibility and stores this information.</p><p id="a9e463aa">When a cloud profile is changed, TeamCity detects modifications immediately and forces shutdown of the agents started prior to these changes once the agents finish the current build.</p></div></div><a name="ViewingCloudAgentInformation"></a><a name="Viewing-Cloud-Agent-Information"></a><div class="chapter"><h2 id="AgentCloudProfile-ViewingCloudAgentInformation">Viewing Cloud Agent Information</h2><p id="fd5c04a5">The agents' information is displayed on the <b id="8e2438e8">Agents | Cloud</b> page under the <b id="486cec21">&lt;Profile name&gt;</b> drop-down.</p></div><a name="Enabling/disablingCloudIntegrationinProject"></a><a name="Enabling/disabling-Cloud-Integration-in-Project"></a><div class="chapter"><h2 id="AgentCloudProfile-Enabling/disablingCloudIntegrationinProject">Enabling/disabling Cloud Integration in Project</h2><p id="c0967bd1">You can enable or disable integration for a project and/or its subprojects via the TeamCity web UI using the <i id="10c5d86b">Change cloud integration status</i> option on the <b id="e2cb9e26">Cloud Profiles</b> page.</p><hr id="9b27ca64"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>