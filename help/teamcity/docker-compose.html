<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Docker Compose - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Docker Compose" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/docker-compose.md|Docker Compose" data-main-title="Docker Compose" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/docker-compose.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Docker Compose" id="docker-compose.md">Docker Compose</h1><p id="a19485ba">TeamCity-<a href="integrating-teamcity-with-docker.html">Docker integration</a> includes the Docker Compose runner.</p><a name="reqs-supported-env"></a><a name="SupportedEnvironments"></a><a name="Supported-Environments"></a><div class="chapter"><h2 id="DockerCompose-SupportedEnvironments">Supported Environments</h2><p id="1d4502f7">TeamCity Docker Support can run on Mac, Linux, and Windows build agents. It uses the <code class="code">docker</code> executable on the build agent machine, so it should be runnable by the build agent user.</p><aside class="note " data-title="" rel="1d4502f7" id="1bc332cc"><ul class="list _ul"><li class="list__item" id="b784d35e"><p>On Linux, the integration will run if the installed Docker is detected.</p></li><li class="list__item" id="e0efb3ea"><p>On Windows, the integration works for Linux and Windows container modes.</p></li><li class="list__item" id="b09b8765"><p>On macOS, the official <a href="https://docs.docker.com/docker-for-mac/install/" data-external="true" target="_blank" rel="noopener noreferrer">Docker support for Mac</a> should be installed for the user running the build agent.</p></li></ul></aside></div><a name="DockerCompose"></a><a name="Docker-Compose"></a><div class="chapter"><h2 id="DockerCompose-DockerCompose">Docker Compose</h2><a name="docker-compose"></a><p id="6f926bc9">The runner allows starting <a href="https://docs.docker.com/compose/" data-external="true" target="_blank" rel="noopener noreferrer">Docker Compose</a> build services and shutting down those services at the end of the build.</p><p id="8482ceac">The Docker Compose runner supports one or several <a href="https://docs.docker.com/compose/compose-file/compose-file-v2/" data-external="true" target="_blank" rel="noopener noreferrer">Docker Compose YAML file(s)</a> with a description of the services to be used during the build. The path to the <code class="code">docker-compose.yml</code> file(s) should be relative to the <a href="build-checkout-directory.html">checkout directory</a>. When specifying several files, separate them with a space.</p><p id="24cd08b7">The executed commands are:</p><div class="code-block" data-lang="bash">
# The commands are executed with the current working directory, where the docker-compose file resides.
docker-compose -f &lt;docker-compose.yml&gt; [-f &lt;docker-compose2.yml&gt;] up -d

# At the end of the build, for each docker compose build step the build agent will run:
docker-compose -f &lt;docker-compose.yml&gt; [-f &lt;docker-compose2.yml&gt;] down -v

</div><p id="026c4bff">If the checkbox <b id="1fa54c84">pull image explicitly</b> is enabled, <code class="code">docker-compose pull</code> will be run before the <code class="code">docker-compose up</code> command.</p><p id="ea287287">When using Docker Compose with images which support <a href="https://docs.docker.com/engine/reference/builder/#healthcheck" data-external="true" target="_blank" rel="noopener noreferrer">HEALTHCHECK</a>, TeamCity will wait for the <code class="code">healthy</code> status of all containers that support this parameter.</p><p id="f1fdfbc2">If the start of Docker Compose was successful, the TeamCity agent will register the <code class="code">TEAMCITY_DOCKER_NETWORK</code> environment variable containing the name of the Docker Compose default network. This network will be passed transparently to the <a href="integrating-teamcity-with-docker.html#Docker-Wrapper">Docker Wrapper</a> when used in some build runners.</p><hr id="f0ba96d1"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>