<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Storing Project Settings in Version Control - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Storing Project Settings in Version Control" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/storing-project-settings-in-version-control.md|Storing Project Settings in Version Control/kotlin-dsl.md|Kotlin DSL/upgrading-dsl.md|Upgrading DSL" data-main-title="Storing Project Settings in Version Control" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/storing-project-settings-in-version-control.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Storing Project Settings in Version Control" id="storing-project-settings-in-version-control.md">Storing Project Settings in Version Control</h1><p id="1014f292">On this page:</p><p id="42177730"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-Overview">Overview</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-SynchronizingSettingswithVCS">Synchronizing Settings with VCS</a><ul class="list _bullet"><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-DefiningSettingstoApplytoBuilds">Defining Settings to Apply to Builds</a></li></ul></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-StoringSecureSettings">Storing Secure Settings</a><ul class="list _bullet"><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-GeneratingTokens">Generating Tokens</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-ImplicationsofStoringSecurityDatainVCS">Implications of Storing Security Data in VCS</a></li></ul></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-SettingsFormat">Settings Format</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-CommittingCurrentProjectSettingstoVCS">Committing Current Project Settings to VCS</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-DisplayingChanges">Displaying Changes</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-EnablingVersionedSettingsafterTeamCityUpgrade">Enabling Versioned Settings after TeamCity Upgrade</a></li><li class="list__item"><a href="#StoringProjectSettingsinVersionControl-FAQs">FAQs</a></li></ul></p><a name="Overview"></a><a name="Overview"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-Overview">Overview</h2><p id="b788f607">TeamCity allows the two-way synchronization of the project settings with the version control repository. Supported VCSs are Git, Mercurial, Perforce, Subversion, and Azure DevOps Server (formerly TFS).</p><p id="84b67852">You can store settings in the XML format and in the <a href="https://kotlinlang.org/" data-external="true" target="_blank" rel="noopener noreferrer">Kotlin language</a> and define settings programmatically using the <a href="kotlin-dsl.html">kotlin-based DSL</a>.</p><p id="2cfb6664">When you enable two-way settings synchronization:</p><ul class="list _ul"><li class="list__item" id="d026a123"><p>Each administrative change made to the project settings in the TeamCity web UI is committed to the version control; the changes are made noting the TeamCity user as the committer.</p></li><li class="list__item" id="9e4ceebd"><p>If the settings change is committed to the version control, the TeamCity server will detect the modifications and apply them to the project on the fly.<br>Before applying the newly checked-in settings, certain constraints are applied. If the constraints are not met (that is, the settings are invalid), the current settings are left intact and an error is shown in the UI. Invalid settings are those that cannot be loaded because of constraints, for instance, a build configuration referencing a non-existing VCS root, of having a duplicate ID or a duplicate name, and so on.</p></li></ul><p id="0a1fa4cb">The settings in the VCS are stored in the <code class="code">.teamcity</code> folder in the root of the repository the same format as in the <a href="teamcity-data-directory.html">TeamCity Data Directory</a>.</p></div><a name="SynchronizingSettingswithVCS"></a><a name="Synchronizing-Settings-with-VCS"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-SynchronizingSettingswithVCS">Synchronizing Settings with VCS</h2><p id="d9d249ec">By default, the synchronization of the project settings with the version control is disabled.</p><p id="92e11656">To enable it, go to <b id="882476d4">Project Settings | Versioned Settings</b>.</p><p id="830492d9">The "<i id="4f8d7948">Enable/disable versioned settings</i>" permission is required (default for the <a href="role-and-permission.html#Per-Project-Authorization-Mode">System Administrator</a> role).</p><p id="c3d41af9">The <b id="fde83ae2">Configuration</b> tab is used to define</p><ul class="list _ul"><li class="list__item" id="ee745efb"><p>whether the synchronization settings are the same as in the parent project;</p></li><li class="list__item" id="8ab638e1">whether the synchronization is enabled;<ul class="list _ul"><li class="list__item" id="2495db7e"><p>when synchronization is enabled, you can define which settings to use when build starts. See details <a href="#Defining-Settings-to-Apply-to-Builds">below</a>.</p></li></ul></li><li class="list__item" id="fda101e5"><p>which VCS Root is used to store the project settings: you can store the settings either in the same repository as the source code, or in a dedicated VCS root.</p></li></ul><p id="32e9c8be">Enabling synchronization for a project also enables it for all its subprojects. TeamCity synchronizes all changes to the project settings (including modifications of <a href="build-configuration.html">build configurations</a>, <a href="build-configuration-template.html">templates</a>, <a href="vcs-root.html">VCS roots</a>, and so on) with the exception of <a href="ssh-keys-management.html">SSH keys</a>.</p><p id="6d9b5b2d">You can override the synchronization settings inherited from a project for a subproject.</p><p id="6160a28a">As soon as synchronization is enabled in a project, TeamCity will make an initial commit in the selected repository for the whole project tree (the project with all its subprojects) to store the current settings from the server. If the settings for the given project are found in the specified VCS root (the VCS root for the parent project settings or the user-selected VCS root), a warning will be displayed asking if TeamCity should</p><ul class="list _ul"><li class="list__item" id="dfba3f0f"><p>overwrite the settings in the VCS with the current project settings on the TeamCity server; or</p></li><li class="list__item" id="f7136e88"><p>import the settings from the VCS replacing the current project settings on the TeamCity server with those from version control.</p></li></ul><a name="DefiningSettingstoApplytoBuilds"></a><a name="Defining-Settings-to-Apply-to-Builds"></a><div class="chapter"><h3 id="StoringProjectSettingsinVersionControl-DefiningSettingstoApplytoBuilds">Defining Settings to Apply to Builds</h3><p id="ea1c0b23">There are two sources of build settings: (1) the current settings on the TeamCity server, that is the latest settings changes applied to the server (either made via the UI, or via a commit into the <code class="code">.teamcity</code> directory in the VCS root) and (2) the settings in the VCS on the revision selected for a build.<br>Therefore, it is possible to start builds with settings different from those currently defined in the build configuration. For projects where versioned settings are enabled, you can tell TeamCity which settings to take <b id="d0d516d1">when build starts</b>.<br>This gives you several possibilities:</p><ul class="list _ul"><li class="list__item" id="4f520c4f"><p>If you are using TeamCity <a href="working-with-feature-branches.html">feature branches</a>, you can define a branch specification in the VCS root used for versioned settings, and TeamCity will run a build in a branch using the settings from this branch.</p></li><li class="list__item" id="2e280242"><p>You can start a <a href="personal-build.html">personal build</a> with changes made in the <code class="code">.teamcity</code> directory, and these changes will affect the build behavior.</p></li><li class="list__item" id="40db1ae5"><p>When running a <a href="history-build.html">history build</a>, TeamCity will attempt to use the settings corresponding to the moment of the selected change. Otherwise, the current project settings will be used.</p></li></ul><p id="51bd28c7">Before starting a build, TeamCity stores configuration for this build in build internal artifacts under <code class="code">.teamcity/settings</code> directory. These configuration files can be examined later to understand what settings were actually used by the build.</p><p id="8b36fc5b">To define which settings to take <b id="42462b87">when build starts</b>, open the <b id="69657002">Project Settings | Versioned Settings</b> page click <i id="4dba0c9b">Show advanced options</i> and select one of the following options:</p><ul class="list _ul"><li class="list__item" id="9974174d"><p><b id="616c31f0">always use current settings</b>: all builds use current project settings from the TeamCity server. Settings changes in branches, history, and personal builds are ignored. Users cannot run a build with custom project settings.</p></li><li class="list__item" id="f77ff66e"><p><b id="9413a12b">use current settings by default</b>: a build uses the latest project settings from the TeamCity server. Users can run a build with older project settings via the <a href="triggering-a-custom-build.html#Changes">custom build dialog</a>.</p></li><li class="list__item" id="dd5a9aa1"><b id="e40d9391">use settings from VCS</b>: builds in branches and history builds, which use settings from VCS, load settings from the versioned settings revision calculated for the build. Users can change configuration settings in <a href="remote-run.html">personal builds from IDE</a> or can run a build with project settings current on the TeamCity server via the <a href="triggering-a-custom-build.html#Changes">custom build dialog</a>.<ul class="list _ul"><li class="list__item" id="7678d54d">changes in the following settings will <b id="7c588aa6">affect</b> the build:<ul class="list _ul"><li class="list__item" id="543b1832"><p>build number pattern</p></li><li class="list__item" id="48322196"><p>build steps (build steps parameters and their order)</p></li><li class="list__item" id="89855c22"><p>build configuration parameters</p></li><li class="list__item" id="12d22e20"><p>system properties and environment variables</p></li><li class="list__item" id="b1bf6c42"><p>agent requirements</p></li><li class="list__item" id="f5dae0b3"><p>build features (except Automatic merge and VCS labeling)</p></li><li class="list__item" id="cd0d0042"><p>failure conditions</p></li><li class="list__item" id="4bbbe59c"><p>artifact publishing rules</p></li><li class="list__item" id="991ed895"><p>artifact dependencies</p></li></ul></li><li class="list__item" id="44d64ac7">changes in the following settings coming from a branch will be ignored and <b id="be334820">will not affect</b> the build:<ul class="list _ul"><li class="list__item" id="66287d1e"><p>VCS roots and checkout rules</p></li><li class="list__item" id="77af945b"><p>snapshot dependencies</p></li><li class="list__item" id="01ceb221"><p>build triggers</p></li><li class="list__item" id="36fb1a55"><p>build configuration level options, like hanging builds detection, enabling/disabling of triggering of personal builds, or build configuration type</p></li><li class="list__item" id="a7c41566"><p>cleanup rules</p></li></ul></li></ul></li></ul></div></div><a name="StoringSecureSettings"></a><a name="Storing-Secure-Settings"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-StoringSecureSettings">Storing Secure Settings</h2><p id="865f819c">It is recommended to store security data outside the VCS. The <b id="c608a0ac">Project Settings | Versioned Settings | Configuration</b> page has an option to <b id="38e4c0bc">store passwords, API tokens, and other secure settings outside of VCS</b>. This option is enabled by default if versioned settings are enabled for a project for the first time, and not enabled for projects already storing their settings in the VCS.</p><p id="6caeae55">If this option is enabled, TeamCity stores a random generated IDs in XML configuration files instead of the scrambled passwords. Actual passwords are stored on the disk under the TeamCity Data Directory and are not checked into the version control system.</p><aside class="warning " data-title="" rel="6caeae55" id="9c51aeb4"><p id="25fd13f8">If this option is disabled, the <a href="#Implications-of-Storing-Security-Data-in-VCS">security implications</a> listed below should be taken into account before committing security data to the VCS.</p></aside><p id="b4c5f358"><a name="tokensGen"></a><a name="StoringProjectSettingsinVersionControl-tokensGen"></a></p><a name="GeneratingTokens"></a><a name="Generating-Tokens"></a><div class="chapter"><h3 id="StoringProjectSettingsinVersionControl-GeneratingTokens">Generating Tokens</h3><p id="c2535771">If you need to add a password into the versioned settings not via the TeamCity UI (for example, adding settings with Kotlin-based <code class="code">DSL</code>), add the password to the project in TeamCity and get the corresponding token to use in the settings (select <i id="ec1b47e7">Generate token for a secure value</i> in the <b id="db29cbd8">Actions</b> drop-down menu).</p><p id="a842bd5b">At this time passwords are not inheritable by projects hierarchy. If a setting in a project (a VCS root, OAuth connection, cloud profile) requires a password, the token generated for this password can be used in this project only. For instance, it is not possible to take a generated token and use it in a similar setting in a subproject. A new token should be generated in this case.<br>If you need to use a secure value in the nested projects, consider adding a <a href="typed-parameters.html#Adding-Parameter-Specification">password parameter</a> with the secure value and using a <a href="configuring-build-parameters.html#Using-Build-Parameters-in-Build-Configuration-Settings">reference</a> to the parameter in the nested projects.</p></div><a name="ImplicationsofStoringSecurityDatainVCS"></a><a name="Implications-of-Storing-Security-Data-in-VCS"></a><div class="chapter"><h3 id="StoringProjectSettingsinVersionControl-ImplicationsofStoringSecurityDatainVCS">Implications of Storing Security Data in VCS</h3><p id="0945f282">If you are using a version <b id="3e6c4830">prior to TeamCity 2017.1</b>, it is recommended to carefully consider the implications of storing security settings in a VCS.</p><ul class="list _ul"><li class="list__item" id="6551f6d8">If the projects or build configurations with settings in a VCS have <b id="5d0524c7">password fields defined</b>, the values appear in the settings committed into the VCS (though, in scrambled form).<ul class="list _ul"><li class="list__item" id="2b7869f0"><p>If the project settings are stored in <b id="d277235c">the same repository as the source code</b>, anyone with access to the repository will be able to see these scrambled passwords.</p></li><li class="list__item" id="e0f8b7f6"><p>If the project settings are stored <b id="41caa6af">separately from the source code in a dedicated repository</b> and the <i id="9a81ae6d">Show settings changes in builds</i> option is enabled, any user having the "View VCS file content" permission can see all the changes in the TeamCity UI using the <a href="difference-viewer.html">changes difference viewer</a>.</p></li></ul></li><li class="list__item" id="58301577"><p>Being able to change the settings in an arbitrary manner via a VCS, it is possible to trigger builds of any build configurations and obtain settings of any build configurations irrespective of the build configurations permissions configured in TeamCity.</p></li><li class="list__item" id="434dc211"><p>by committing wrong or malicious settings, a user can affect the entire server performance or server presentation to other users.</p></li></ul><p id="fe1fa549">It is recommended to store passwords, API tokens, and other secure settings outside of VCS using the corresponding option <a href="#Storing-Secure-Settings">described above</a>.</p><p id="9e407ecd">Note that SSH keys will not be stored in the VCS repository.</p><p id="5c02be20"><a name="settingsFormat"></a><a name="StoringProjectSettingsinVersionControl-settingsFormat"></a></p></div></div><a name="SettingsFormat"></a><a name="Settings-Format"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-SettingsFormat">Settings Format</h2><p id="e69f15fe">You can select the settings format: on the <b id="cba6842f">Versioned Settings | Configuration</b> page for your project, click <i id="0f910140">Show advanced options</i>.</p><p id="09c46310">TeamCity stores project settings:</p><ul class="list _ul"><li class="list__item" id="68606e57"><p>in the XML format</p></li><li class="list__item" id="53e03f6d"><p>in the Kotlin-based DSL format (see a <a href="kotlin-dsl.html">dedicated page</a>).</p></li></ul><aside class="note " data-title="" rel="e31db865" id="516ab053"><p id="92728be9">To test kotlin-based settings in a sandbox project, you can download the settings as a zip archive without disabling the UI: on the <b id="549e3c82">Project Settings</b> page, click the <b id="a2896664">Actions</b> menu and select <b id="3af7b26d">Download settings in kotlin format.</b> A zip archive will be downloaded.</p></aside><p id="979ace5d"><a name="ForcingSynch"></a><a name="StoringProjectSettingsinVersionControl-ForcingSynch"></a></p></div><a name="CommittingCurrentProjectSettingstoVCS"></a><a name="Committing-Current-Project-Settings-to-VCS"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-CommittingCurrentProjectSettingstoVCS">Committing Current Project Settings to VCS</h2><aside class="warning " data-title="" rel="StoringProjectSettingsinVersionControl-CommittingCurrentProjectSettingstoVCS" id="20c3a926"><p id="eba4b458">Before committing settings to the VCS, consider the recommended approach to storing security settings <a href="#Storing-Secure-Settings">described above</a>.</p></aside><p id="118ec726">If you want to commit the current configuration to the VCS (for example, earlier you committed misconfigured settings to the repository and TeamCity was unable to load it displaying errors and warnings), you can use the <i id="41216694">Commit current project settings</i> option on the <b id="0ab87c25">Versioned Settings | Configuration</b> page.</p><p id="e4d5d103">When TeamCity commits settings into a VCS, it uses a  standard commit message noting the TeamCity user as the committer and the project whose settings changed. It is possible to add a fixed custom prefix to each settings change committed by TeamCity via the <code class="code">teamcity.versionedSettings.commitMessagePrefix</code> <a href="configuring-teamcity-server-startup-properties.html">internal property</a>, for example, <code class="code">teamcity.versionedSettings.commitMessagePrefix=TC Change\n\n</code></p></div><a name="DisplayingChanges"></a><a name="Displaying-Changes"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-DisplayingChanges">Displaying Changes</h2><p id="d77aea6d">TeamCity will not only synchronize the settings, but will also automatically display changes to the project settings the same way it is done for regular changes in the version control. You can configure the changes to be displayed for the affected build configurations: on the <b id="f3db794d">Project Settings | Versioned Settings</b> page, <b id="32b4476f">Configuration</b> tab, click <b id="f71b309d">Show advanced options</b> and check the <i id="81df2d50">Show settings changes in builds</i> box.</p><p id="aadeacca">By default, the VCS trigger will ignore such changes. To enable build triggering on a settings commit, add a trigger rule in the following format: <code class="code">+:root=Settings_root_id;:*</code>.</p><p id="f7caba92">All changes in the VCS root where project settings are stored are listed on the <b id="4bcfc0a5">Versioned Settings | Change log</b> tab of the <b id="febb2e7d">Versioned Settings</b> page.</p><p id="5930c2d3"><a name="enableAfterUpgrade"></a><a name="StoringProjectSettingsinVersionControl-enableAfterUpgrade"></a></p></div><a name="EnablingVersionedSettingsafterTeamCityUpgrade"></a><a name="Enabling-Versioned-Settings-after-TeamCity-Upgrade"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-EnablingVersionedSettingsafterTeamCityUpgrade">Enabling Versioned Settings after TeamCity Upgrade</h2><p id="c62baecb">The format of the XML settings files changes from one TeamCity version to another to accommodate the new features and improvements. Generally, the format is not changed within bugfix releases and is changed in minor/major releases. When a TeamCity server is upgraded, the current settings on the TeamCity server are changed from the earlier to the current format.</p><p id="f7546d32">It is a common practice to upgrade a TeamCity test server with production data before upgrading the production server. In order to avoid accidentally changing the format of the settings which are used on a production server of an older version, versioned settings are disabled after a TeamCity upgrade and the corresponding health item is displayed. System administrators have permissions to enable versioned settings. When enabled, the converted settings in the format of the current TeamCity version will checked in the version control. Note that the new settings will be committed to the default branch of the VCS root; the settings stored in other branches will have to be updated manually.</p></div><a name="FAQs"></a><a name="FAQs"></a><div class="chapter"><h2 id="StoringProjectSettingsinVersionControl-FAQs">FAQs</h2><p id="5e6673a0">Q. Can I apply the settings from a TeamCity server of a different version?<br>A. No, because just like with the TeamCity Data Directory, the format of the settings differs from one TeamCity version to another.</p><p id="8efc90aa">Q. Where are the settings stored?<br>A. The settings are stored in the <code class="code">.teamcity</code> folder in the root of the VCS root-configured repository path. For Git and Mercurial this is always the root of the repository. The default branch configured in the VCS root is used with <a href="git.html">Git</a>, <a href="mercurial.html">Mercurial</a>. You can create a dedicated VCS root to change the branch (or a repository path in case of Perforce, Subversion, or Azure DevOps – formerly TFS).</p><p id="e6f35b71">Q. Why is there a delay before a build is run after I changed to the settings in the UI?<br>A. When the settings are changed via the UI, TeamCity will wait for the changes to be completed with a commit to the VCS before running a build with the latest changes.</p><p id="491ee290">Q. Who are the changes authored by?<br>A. If the settings are changed via the user interface, in Git and Mercurial a commit in the VCS will be performed on behalf of the user who actually made the change via the UI. For Perforce as well as Azure DevOps Server (formerly TFS), the name of the user  specified in the VCS root  is used, and in Subversion the commit message will also contain the username of the TeamCity user who actually made the change via the UI.</p><hr id="80bdb984"><p id="eca38b6c"><b id="8b88e511">See also:</b></p><p id="75cbd3c7"><b id="7ddce569">Administrator's Guide</b>: <a href="kotlin-dsl.html">Kotlin DSL</a></p><hr id="56a4e7e2"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>