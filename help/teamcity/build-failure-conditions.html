<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>构建失败条件-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Build Failure Conditions" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/build-failure-conditions.md|Build Failure Conditions" data-main-title="Build Failure Conditions" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-failure-conditions.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-failure-conditions.md" data-toc="Build Failure Conditions">构建失败条件</h1><p id="97da59dc">在TeamCity中，您可以调整“ <a href="creating-and-editing-build-configurations.html">构建配置设置”</a>页面的“ <b id="6bdba52a">失败条件”</b>部分中应将构建标记为失败的<b id="6bdba52a">条件</b> 。<br>如果无法释放足够的磁盘空间进行构建而使构建失败，请参阅<a href="free-disk-space.html">释放磁盘空间</a>构建功能。</p><p id="836555f2">在此页：</p><p id="5fc1e04a"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildFailureConditions-Commonbuildfailureconditions">常见的构建失败条件</a></li><li class="list__item"><a href="#BuildFailureConditions-AdditionalFailureConditions">附加故障条件</a><ul class="list _bullet"><li class="list__item"><a href="#BuildFailureConditions-Failbuildonmetricchange">无法根据指标更改建立</a></li><li class="list__item"><a href="#BuildFailureConditions-Addingcustombuildmetric">添加自定义构建指标</a></li><li class="list__item"><a href="#BuildFailureConditions-Failbuildonspecifictextinbuildlog">无法在构建日志中构建特定文本</a></li><li class="list__item"><a href="#BuildFailureConditions-Stoppingbuildimmediately">立即停止构建</a></li></ul></li></ul><p></p><a name="Commonbuildfailureconditions"></a><a name="Common-build-failure-conditions"></a><div class="chapter"><h2 id="BuildFailureConditions-Commonbuildfailureconditions">常见的构建失败条件</h2><p id="7dd22d24">在“常见故障情况”中，通过从“ <b id="219c30b8">如果</b>发生以下情况<b id="219c30b8">失败”</b>区域中选择适当的选项，指定TeamCity将如何导致失败：</p><ul class="list _ul"><li class="list__item" id="200c8a4a"><b id="30c5a995">它的运行时间超过...分钟</b> ：以分钟为单位输入一个值，以启用构建的执行超时。如果超过指定的时间量，构建将自动取消。<ul class="list _ul"><li class="list__item" id="c9f2f634"><p>除非设置为0，否则此构建配置设置将覆盖“管理”->“全局设置”中指定的<a href="teamcity-configuration-and-maintenance.html">服务器范围的</a>默认执行超时。</p></li><li class="list__item" id="42a2861e"><p>默认值0表示构建配置未设置任何限制。如果存在<a href="teamcity-configuration-and-maintenance.html">服务器范围的</a>默认执行超时，则将使用此默认值。<br>此选项有助于处理挂起的构建并保持代理效率。</p></li></ul></li><li class="list__item" id="f0d74b35"><p><b id="92700036">构建过程退出代码不为零</b> ：如果构建过程未成功退出，请选中此选项以将构建标记为失败。</p></li><li class="list__item" id="f18a3bde"><p><b id="aac8f522">至少一项测试失败</b> ：如果构建<b id="aac8f522">至少一项测试失败，则</b>选中此选项以将构建标记为失败。如果未选中此选项，则即使构建无法通过许多测试，也可以将其标记为成功。无论选择哪个选项，TeamCity都会运行所有构建步骤。</p></li><li class="list__item" id="2a51cf64"><p><b id="0cfc3bab">构建运行器记录一条错误消息</b> ：如果构建运行器在构建时报告错误，请选中此选项以将构建标记为失败。</p></li><li class="list__item" id="ca314200"><p><b id="abe1caf9">检测到内存不足或崩溃（仅Java）</b> ：如果检测到JVM崩溃或Java内存不足问题，请选中此选项以将构建标记为失败。如果可能，TeamCity将上载崩溃日志和内存转储作为此类构建的工件。</p></li></ul></div><a name="AdditionalFailureConditions"></a><a name="Additional-Failure-Conditions"></a><div class="chapter"><h2 id="BuildFailureConditions-AdditionalFailureConditions">附加故障条件</h2><p id="7c631a60">您可以指示TeamCity将某个构建标记为失败（如果其某些指标与另一个构建相比）变差，例如代码覆盖率，工件大小等。例如，如果代码重复编号高于上一个版本，则可以将版本标记为失败。</p><p id="76e8d059">当构建日志中存在某些文本时，另一个构建失败条件会导致TeamCity将构建标记为失败。</p><p id="d91b9270">要将此类构建失败条件添加到构建配置中，请单击<b id="62ad0e7e">添加构建失败条件，</b>然后从列表中选择：</p><ul class="list _ul"><li class="list__item" id="acd33194"><a href="#Fail-build-on-metric-change">无法根据指标更改建立</a></li><li class="list__item" id="8bae9b1c"><a href="#Fail-build-on-specific-text-in-build-log">无法在构建日志中构建特定文本</a></li></ul><aside class="tip sideblock" rel="e358974a" id="791e5e9c" data-title=""><p id="896cc6ee">您可以随时临时或永久禁用构建失败条件，即使该条件是从构建配置模板继承的也是如此。</p></aside><a name="Failbuildonmetricchange"></a><a name="Fail-build-on-metric-change"></a><div class="chapter"><h3 id="BuildFailureConditions-Failbuildonmetricchange">无法根据指标更改建立</h3><p id="72fe89c3">在构建中使用代码检查工具时，例如代码覆盖率，重复查找器，检查等，构建会生成各种数字指标。对于这些指标，您可以指定一个阈值，如果超过该阈值，将使构建失败。</p><p id="a88b2f7b">通常，有两种方法可以配置此构建失败条件：</p><ul class="list _ul"><li class="list__item" id="2e4274b6"><p><i id="ea32e2ee">构建指标</i>超过或小于指定的恒定值（阈值）。<br>例如， <b id="5b1fa23a">如果失败，则构建</b> <code class="code">build duration (secs)</code>与恒定值相比<code class="code">more</code>比<code class="code">300</code> 。在这种情况下，如果运行超过300秒，构建将失败。</p></li><li class="list__item" id="1c3e654c"><p>与特定构建相比， <i id="5325b35a">构建指标</i>已更改了指定值。<br>例如， <b id="9c134c54">如果构建失败</b> ，则<b id="9c134c54">失败</b> <code class="code">build duration (secs)</code>与另一个版本的值相比<code class="code">more</code>至少<code class="code">300</code>此指标的默认单位，而不是<code class="code">Last successful build</code> 。在这种情况下，如果构建比最后一次成功的构建运行时间长300秒，则构建将失败。如果配置了<a href="working-with-feature-branches.html">分支规范</a> ，那么将应用<a href="working-with-feature-branches.html">以下逻辑</a> 。</p></li></ul><p id="dba22511">以下构建中的值可用作比较构建方式的基础：</p><ul class="list _ul"><li class="list__item" id="2a73942c"><p>上一次成功构建</p></li><li class="list__item" id="9b82bbdb"><p>最后固定的版本</p></li><li class="list__item" id="106b1751"><p>最后完成的版本</p></li><li class="list__item" id="18fcc53c"><p>使用指定的内部版本号进行构建</p></li><li class="list__item" id="9d97a67e"><p>最后完成的构建，带有指定标签。</p></li></ul><p id="9bfcc07c">默认情况下，TeamCity提供了广泛的<i id="00c6f660">构建指标</i> ：</p><ul class="list _ul"><li class="list__item" id="6a4c5681"><p>工件大小（字节）-工件的大小，不包括<a href="build-artifact.html#Hidden-Artifacts">内部的工件</a> <code class="code">.teamcity</code>目录</p></li><li class="list__item" id="107b4eb9"><p>构建持续时间（秒）</p></li><li class="list__item" id="e6ca62b2"><p>类数</p></li><li class="list__item" id="332fd972"><p>重复的代码数</p></li><li class="list__item" id="424ac1b3"><p>涵盖课程数</p></li><li class="list__item" id="14f6e08d"><p>覆盖线数</p></li><li class="list__item" id="d5162e73"><p>涵盖方法的数量</p></li><li class="list__item" id="bc2a4488"><p>测试失败次数</p></li><li class="list__item" id="1f0756cb"><p>被忽略的测试数</p></li><li class="list__item" id="649719fd"><p>检查错误数</p></li><li class="list__item" id="9266136e"><p>检查警告数</p></li><li class="list__item" id="81e38c24"><p>代码行数</p></li><li class="list__item" id="b5811a11"><p>方法数量</p></li><li class="list__item" id="476aecdd"><p>通过测试的次数</p></li><li class="list__item" id="686932e5"><p>测试次数</p></li><li class="list__item" id="d6f3e63c"><p>区块覆盖率</p></li><li class="list__item" id="211dc5b9"><p>班级覆盖率</p></li><li class="list__item" id="d500fc31"><p>线覆盖率</p></li><li class="list__item" id="fb162829"><p>方法覆盖率</p></li><li class="list__item" id="9620f97e"><p>报表覆盖率</p></li><li class="list__item" id="51623f07"><p>测试时间（秒）</p></li><li class="list__item" id="486ebe7d"><p>工件总数（字节）-所有工件（包括<a href="build-artifact.html#Hidden-Artifacts">内部</a>工件）的大小</p></li></ul><p id="40782df4">请注意， <b id="66573311">自TeamCity 9.0起</b> ，TeamCity计数测试的方式<a href="https://confluence.jetbrains.com/display/TW/Hajipur+9.0+EAP1+(build+31423)+Release+Notes" rel="noopener noreferrer" data-external="true" target="_blank">已更改</a> 。</p></div><a name="Addingcustombuildmetric"></a><a name="Adding-custom-build-metric"></a><div class="chapter"><h3 id="BuildFailureConditions-Addingcustombuildmetric">添加自定义构建指标</h3><p id="8d019205">您可以添加自己的构建指标。为此，您需要修改TeamCity配置文件<code class="code"><TeamCity Data Directory>/config/main-config.xml</code>然后在“服务器”节点下添加以下部分：</p><div class="code-block" data-lang="markup"><build-metrics>
  <statisticvalue key="myMetric" description="build metric for number of files"></statisticvalue>
</build-metrics>

</div><p id="1cfb5091">因此，如果您的版本发布了<code class="code">myMetric</code>值，您可以将其用作构建失败的标准。</p></div><a name="Failbuildonspecifictextinbuildlog"></a><a name="Fail-build-on-specific-text-in-build-log"></a><div class="chapter"><h3 id="BuildFailureConditions-Failbuildonspecifictextinbuildlog">无法在构建日志中构建特定文本</h3><p id="03a0c187">TeamCity可以检查构建日志中的所有行，以查看是否有某些特定文本表示构建失败。匹配的行没有在构建日志表示形式中每个消息之前的时间和块名前缀。</p><p id="72f5eb0f">要配置此构建失败条件，请指定：</p><ul class="list _ul"><li class="list__item" id="f96aff6b"><p>一个字符串或<a href="http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html" rel="noopener noreferrer" data-external="true" target="_blank">Java正则表达式，</a>其在构建日志中的存在/不存在指示构建失败，</p></li><li class="list__item" id="86806508"><p>当由于这种情况而导致构建失败时，将在构建结果页面上显示一条失败消息。</p></li></ul></div><a name="Stoppingbuildimmediately"></a><a name="Stopping-build-immediately"></a><div class="chapter"><h3 id="BuildFailureConditions-Stoppingbuildimmediately">立即停止构建</h3><p id="54915073">您可以在生成日志中遇到指定的文本时立即停止生成，也可以在超过使用“基于<b id="48ea98ba">失败的生成度量”更改</b>条件指定的特定生成度量时立即停止生成。</p><hr id="ad8d44b1"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>