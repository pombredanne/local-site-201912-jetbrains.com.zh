<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Build Failure Conditions - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Build Failure Conditions" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/build-failure-conditions.md|Build Failure Conditions" data-main-title="Build Failure Conditions" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-failure-conditions.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Build Failure Conditions" id="build-failure-conditions.md">Build Failure Conditions</h1><p id="97da59dc">In TeamCity you can adjust the conditions when a build should be marked as failed in the <b id="6bdba52a">Failure Conditions</b> section of the of the <a href="creating-and-editing-build-configurations.html">Build Configuration Settings</a> page.<br>To fail a build if sufficient disk space cannot be freed for the build, see the <a href="free-disk-space.html">Free disk space</a> build feature.</p><p id="836555f2">On this page:</p><p id="5fc1e04a"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildFailureConditions-Commonbuildfailureconditions">Common build failure conditions</a></li><li class="list__item"><a href="#BuildFailureConditions-AdditionalFailureConditions">Additional Failure Conditions</a><ul class="list _bullet"><li class="list__item"><a href="#BuildFailureConditions-Failbuildonmetricchange">Fail build on metric change</a></li><li class="list__item"><a href="#BuildFailureConditions-Addingcustombuildmetric">Adding custom build metric</a></li><li class="list__item"><a href="#BuildFailureConditions-Failbuildonspecifictextinbuildlog">Fail build on specific text in build log</a></li><li class="list__item"><a href="#BuildFailureConditions-Stoppingbuildimmediately">Stopping build immediately</a></li></ul></li></ul></p><a name="Commonbuildfailureconditions"></a><a name="Common-build-failure-conditions"></a><div class="chapter"><h2 id="BuildFailureConditions-Commonbuildfailureconditions">Common build failure conditions</h2><p id="7dd22d24">In the Common Failure Conditions, specify how TeamCity will fail builds by selecting appropriate options from in the <b id="219c30b8">Fail build if</b> area:</p><ul class="list _ul"><li class="list__item" id="200c8a4a"><b id="30c5a995">it runs longer than ... minutes</b>: Enter a value in minutes to enable execution timeout for a build.  If the specified amount of time is exceeded, the build is automatically canceled.<ul class="list _ul"><li class="list__item" id="c9f2f634"><p>Unless set to 0, this build configuration setting overrides the <a href="teamcity-configuration-and-maintenance.html">server-wide</a> default execution timeout specified in Administration -&gt; Global settings.</p></li><li class="list__item" id="42a2861e"><p>The default value of 0 means that no limit is set by the build configuration. If there is a <a href="teamcity-configuration-and-maintenance.html">server-wide</a> default execution timeout, this default will be used.<br>This option helps to deal with builds that hang and maintains agent efficiency.</p></li></ul></li><li class="list__item" id="f0d74b35"><p><b id="92700036">the build process exit code is not zero</b>: Check this option to mark the build as failed if the build process doesn't exit successfully.</p></li><li class="list__item" id="f18a3bde"><p><b id="aac8f522">at least one test failed</b>: Check this option to mark the build as failed if the build fails at least one test. If this option is not checked, the build can be marked successful even if it fails to pass a number of tests. Regardless of this option, TeamCity will run all build steps.</p></li><li class="list__item" id="2a51cf64"><p><b id="0cfc3bab">an error message is logged by build runner</b>: Check this option to mark the build as failed if the build runner reports an error while building.</p></li><li class="list__item" id="ca314200"><p><b id="abe1caf9">an out of memory or crash is detected (Java only)</b>: Check this option to mark the build as failed if a crash of the JVM is detected, or Java out of memory problems. If possible, TeamCity will upload crash logs and memory dumps as artifacts for such builds.</p></li></ul></div><a name="AdditionalFailureConditions"></a><a name="Additional-Failure-Conditions"></a><div class="chapter"><h2 id="BuildFailureConditions-AdditionalFailureConditions">Additional Failure Conditions</h2><p id="7c631a60">You can instruct TeamCity to mark a build as failed if some of its metrics has deteriorated in comparison with another build, for example, code coverage, artifacts size, and so on. For instance, you can mark build as failed if the code duplicates number is higher than in the previous build.</p><p id="76e8d059">Another build failure condition causes TeamCity to mark build as failed when a certain text is present in the build log.</p><p id="d91b9270">To add such build failure condition to your build configuration, click <b id="62ad0e7e">Add build failure condition</b> and select from the list:</p><ul class="list _ul"><li class="list__item" id="acd33194"><a href="#Fail-build-on-metric-change">Fail build on metric change</a></li><li class="list__item" id="8bae9b1c"><a href="#Fail-build-on-specific-text-in-build-log">Fail build on specific text in build log</a></li></ul><aside class="tip sideblock" data-title="" rel="e358974a" id="791e5e9c"><p id="896cc6ee">You can disable a build failure condition temporarily or permanently at any time, even if it is inherited from a build configuration template.</p></aside><a name="Failbuildonmetricchange"></a><a name="Fail-build-on-metric-change"></a><div class="chapter"><h3 id="BuildFailureConditions-Failbuildonmetricchange">Fail build on metric change</h3><p id="72fe89c3">When using code examining tools in your build, like code coverage, duplicates finders, inspections and so on, your build generates various numeric metrics. For these metrics you can specify a threshold which, when exceeded, will fail a build.</p><p id="a88b2f7b">In general there are two ways to configure this build fail condition:</p><ul class="list _ul"><li class="list__item" id="2e4274b6"><p>A <i id="ea32e2ee">build metric</i> exceeds or is less than the specified constant value (threshold).<br>For example, <b id="5b1fa23a">Fail build if</b> <code class="code">build duration (secs)</code> compared to constant value is <code class="code">more</code> than <code class="code">300</code>. In this case a build will fail if it runs more than 300 seconds.</p></li><li class="list__item" id="1c3e654c"><p>A <i id="5325b35a">build metric</i> has changed comparing to a specific build by a specified value.<br>For example, <b id="9c134c54">Fail build if</b> its <code class="code">build duration (secs)</code> compared to a value from another build is <code class="code">more</code> by at least <code class="code">300</code> default units for this metric than the value in the <code class="code">Last successful build</code>. In this case a build will fail if it runs 300 seconds longer than the last successful build. If a <a href="working-with-feature-branches.html">branch specification</a> is configured, then the <a href="working-with-feature-branches.html">following logic</a> is applied.</p></li></ul><p id="dba22511">Values from the following builds can be used as the basis for comparing build metics:</p><ul class="list _ul"><li class="list__item" id="2a73942c"><p>last successful build</p></li><li class="list__item" id="9b82bbdb"><p>last pinned build</p></li><li class="list__item" id="106b1751"><p>last finished build</p></li><li class="list__item" id="18fcc53c"><p>build with specified build number</p></li><li class="list__item" id="9d97a67e"><p>last finished build with specified tag.</p></li></ul><p id="9bfcc07c">By default, TeamCity provides the wide range of <i id="00c6f660">build metrics</i>:</p><ul class="list _ul"><li class="list__item" id="6a4c5681"><p>artifacts size(bytes) - size of artifacts excluding <a href="build-artifact.html#Hidden-Artifacts">internal artifacts</a> under <code class="code">.teamcity</code> directory</p></li><li class="list__item" id="107b4eb9"><p>build duration (secs)</p></li><li class="list__item" id="e6ca62b2"><p>number of classes</p></li><li class="list__item" id="332fd972"><p>number of code duplicated</p></li><li class="list__item" id="424ac1b3"><p>number of covered classes</p></li><li class="list__item" id="14f6e08d"><p>number of covered lines</p></li><li class="list__item" id="d5162e73"><p>number of covered methods</p></li><li class="list__item" id="bc2a4488"><p>number of failed tests</p></li><li class="list__item" id="1f0756cb"><p>number of ignored tests</p></li><li class="list__item" id="649719fd"><p>number of inspection errors</p></li><li class="list__item" id="9266136e"><p>number of inspection warnings</p></li><li class="list__item" id="81e38c24"><p>number of lines of code</p></li><li class="list__item" id="b5811a11"><p>number of methods</p></li><li class="list__item" id="476aecdd"><p>number of passed tests</p></li><li class="list__item" id="686932e5"><p>number of tests</p></li><li class="list__item" id="d6f3e63c"><p>percentage of block coverage</p></li><li class="list__item" id="211dc5b9"><p>percentage of class coverage</p></li><li class="list__item" id="d500fc31"><p>percentage of line coverage</p></li><li class="list__item" id="fb162829"><p>percentage of method coverage</p></li><li class="list__item" id="9620f97e"><p>percentage of statement coverage</p></li><li class="list__item" id="51623f07"><p>test duration (secs)</p></li><li class="list__item" id="486ebe7d"><p>total artifacts size (bytes) - size of all artifacts including <a href="build-artifact.html#Hidden-Artifacts">internal ones</a></p></li></ul><p id="40782df4">Note that <b id="66573311">since TeamCity 9.0</b>, the way TeamCity counts tests <a href="https://confluence.jetbrains.com/display/TW/Hajipur+9.0+EAP1+(build+31423)+Release+Notes" data-external="true" target="_blank" rel="noopener noreferrer">has changed</a>.</p></div><a name="Addingcustombuildmetric"></a><a name="Adding-custom-build-metric"></a><div class="chapter"><h3 id="BuildFailureConditions-Addingcustombuildmetric">Adding custom build metric</h3><p id="8d019205">You can add your own build metric. To do so, you need to modify the TeamCity configuration file <code class="code">&lt;TeamCity Data Directory&gt;/config/main-config.xml</code> and add the following section under "server" node there:</p><div class="code-block" data-lang="markup">&lt;build-metrics&gt;
  &lt;statisticValue key="myMetric" description="build metric for number of files"/&gt;
&lt;/build-metrics&gt;

</div><p id="1cfb5091">So, if your build publishes the <code class="code">myMetric</code> value, you can use it as a criterion for a build failure.</p></div><a name="Failbuildonspecifictextinbuildlog"></a><a name="Fail-build-on-specific-text-in-build-log"></a><div class="chapter"><h3 id="BuildFailureConditions-Failbuildonspecifictextinbuildlog">Fail build on specific text in build log</h3><p id="03a0c187">TeamCity can inspect all lines in build log for some particular text occurrence that indicates a build failure. Lines are matched without the time and block name prefixes which precede each message in the build log representation.</p><p id="72f5eb0f">To configure this build failure condition, specify:</p><ul class="list _ul"><li class="list__item" id="f96aff6b"><p>a string or a <a href="http://java.sun.com/javase/6/docs/api/java/util/regex/Pattern.html" data-external="true" target="_blank" rel="noopener noreferrer">Java Regular Expression</a> whose presence/absence in the build log is an indicator of a build failure,</p></li><li class="list__item" id="86806508"><p>a failure message to be displayed on the build results page when a build fails due to this condition.</p></li></ul></div><a name="Stoppingbuildimmediately"></a><a name="Stopping-build-immediately"></a><div class="chapter"><h3 id="BuildFailureConditions-Stoppingbuildimmediately">Stopping build immediately</h3><p id="54915073">You can stop a build immediately on encountering a specified text in the build log or when a certain build metric, specified using the <b id="48ea98ba">Fail build on metric change</b> condition, is exceeded.</p><hr id="ad8d44b1"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>