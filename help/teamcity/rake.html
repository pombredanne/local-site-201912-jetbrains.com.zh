<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>耙-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Rake" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/rake.md|Rake" data-main-title="Rake" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/rake.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="rake.md" data-toc="Rake">耙</h1><aside class="tip sideblock" rel="rake.md" id="0d619f0c" data-title=""><p id="2a8977ef">TeamCity Rake运行器支持Test :: Unit，Test-Spec， <a href="http://github.com/thoughtbot/shoulda" rel="noopener noreferrer" data-external="true" target="_blank">Shoda</a> ， <a href="http://rspec.info/" rel="noopener noreferrer" data-external="true" target="_blank">RSpec</a>和<a href="http://cukes.info/" rel="noopener noreferrer" data-external="true" target="_blank">Cucumber</a>测试框架。它与使用Rake 0.7.3 gem或更高版本的Ruby版本管理器（MRI Ruby，JRuby，IronRuby，REE，MacRuby等）安装的Ruby解释器兼容。</p></aside><p id="1ea8e661">在此页：</p><p id="07f41315"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Rake-Prerequisites">先决条件</a></li><li class="list__item"><a href="#Rake-ImportantNotes">重要笔记</a></li><li class="list__item"><a href="#Rake-RakeRunnerSettings">犁耙赛跑者设置</a><ul class="list _bullet"><li class="list__item"><a href="#Rake-RakeParameters">耙参数</a></li><li class="list__item"><a href="#Rake-RubyInterpreter">Ruby解释器</a></li><li class="list__item"><a href="#Rake-LaunchingParameters">启动参数</a></li><li class="list__item"><a href="#Rake-TestsReporting">测试报告</a></li></ul></li><li class="list__item"><a href="#Rake-KnownIssues">已知的问题</a></li><li class="list__item"><a href="#Rake-AdditionalRunnerOptions">附加亚军选项</a></li><li class="list__item"><a href="#Rake-DevelopmentLinks">开发链接</a></li></ul><p></p><a name="Prerequisites"></a><a name="Prerequisites"></a><div class="chapter"><h2 id="Rake-Prerequisites">先决条件</h2><p id="a0d5a7fe">确保安装了带有rake 0.7.3 gem或更高版本（强制性）的Ruby解释器（MRI Ruby，JRuby，IronRuby，REE，MacRuby等），以及安装了Ruby（或ROR）项目和测试框架的所有必需gem。至少一个构建代理。您可以在不同的文件夹中安装几个Ruby解释器。在Linux / MacOS上，使用<a href="http://rvm.io/" rel="noopener noreferrer" data-external="true" target="_blank">RVM</a>或<a href="http://github.com/sstephenson/rbenv" rel="noopener noreferrer" data-external="true" target="_blank">rbenv</a>进行配置更容易。可以使用“ <a href="command-line.html">命令行</a>构建”运行器步骤安装Ruby解释器和必要的Ruby gem。如果要自动配置此解释器的代理要求，则需要在构建代理配置属性中注册其路径，然后在<a href="#Rake-Runner-Settings">Rake构建运行器配置中</a>引用该属性名称。要安装gem，请执行：</p><div class="code-block" data-lang="bash">宝石安装<gem_name>

</gem_name></div><p id="222d43d0">您可以参考《 <a href="http://docs.rubygems.org/" rel="noopener noreferrer" data-external="true" target="_blank">Ruby Gems手册》</a>以获取更多信息。</p><p id="13d38b6a">而不是<code class="code">gem</code>命令，您可以使用<a href="http://bundler.io/" rel="noopener noreferrer" data-external="true" target="_blank">Bundler gem</a>安装<a href="http://bundler.io/" rel="noopener noreferrer" data-external="true" target="_blank">gem</a> 。</p><aside class="note " rel="13d38b6a" id="7f6153ae" data-title=""><p id="b28fba6b">如果将Ruby 1.9用于Shoulda，Test-Spec和Test :: Unit框架，则<code class="code">test-unit</code>必须安装gem。</p></aside><aside class="note " rel="Rake-Prerequisites" id="d1f62b67" data-title=""><p id="fecc49d7">要使用<a href="https://rubygems.org/gems/minitest" rel="noopener noreferrer" data-external="true" target="_blank">最小测试</a>框架， <code class="code">minitest-reporters</code>必须安装gem。在<a href="http://www.jetbrains.com/ruby/webhelp/minitest.html" rel="noopener noreferrer" data-external="true" target="_blank">RubyMine Webhelp中</a>查看详细信息。</p></aside></div><a name="ImportantNotes"></a><a name="Important-Notes"></a><div class="chapter"><h2 id="Rake-ImportantNotes">重要笔记</h2><ul class="list _ul"><li class="list__item" id="5bee7722"><p>Ruby的<i id="7db573d5">待处理规范</i>在“ <b id="6d435193">Overwiew”</b>选项卡中显示为“ <b id="90c9568f">忽略的测试</b> ”。</p></li><li class="list__item" id="ed7564da"><p>Rake Runner使用自己的单元测试运行器，并使用<code class="code">RUBYLIB</code>环境变量。您需要确保您的程序不会清除此环境变量，但可以将路径附加到该变量。</p></li><li class="list__item" id="8c47c53c"><p>如果您使用<code class="code">--color</code>在Windows操作系统下启用该选项后，RSpec会建议您安装<b id="af5d0efb">win32console</b> gem。该警告将出现在您的构建日志中，但是您可以忽略它。TeamCity Rake Runner在构建日志中不支持彩色输出，并且不使用此功能。</p></li><li class="list__item" id="cc581434"><p>Rake Runner使用自定义格式化程序运行规范示例。如果使用其他控制台格式化程序，则构建日志将包含冗余信息。</p></li><li class="list__item" id="70f569b8"><p><code class="code">Spec::Rake::SpecTask.spec_opts</code>您的rakefile受以下因素影响<code class="code">SPEC_OPTS</code>命令行参数。犁耙赛跑者总是使用<code class="code">SPEC_OPTS</code>设置其自定义格式化程序。因此，您应该在Web UI中设置规格选项。黄瓜测试选项存在相同的限制。</p></li><li class="list__item" id="6d7db34d"><p>要将HTML报告包含在“构建结果”中，可以为其添加相应的<a href="including-third-party-reports-in-the-build-results.html">报告选项卡</a> 。</p></li></ul></div><a name="RakeRunnerSettings"></a><a name="Rake-Runner-Settings"></a><div class="chapter"><h2 id="Rake-RakeRunnerSettings">犁耙赛跑者设置</h2><a name="RakeParameters"></a><a name="Rake-Parameters"></a><div class="chapter"><h3 id="Rake-RakeParameters">耙参数</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="a46d8c13"><thead><tr id="a82456a6" class="ijRowHead"><th id="e4c6ccbd"><p id="e6b1a8b4">选项</p></th><th id="e76a8aa6"><p id="9c472ae1">描述</p></th></tr></thead><tbody><tr id="b2a73a9c" class="ijRowOdd"><td id="113d94e4"><p id="33fe9e3b">Rakefile文件的路径</p></td><td id="67670119"><p id="3be7992e">如果您不想使用默认路径，请输入一个Rakefile路径。指定的路径应相对于<a href="build-checkout-directory.html">Build Checkout目录</a> 。</p></td></tr><tr id="e0555756" class="ijRowEven"><td id="b6f17f79"><p id="f82d33dc">Rakefile内容</p></td><td id="ca699fc0"><p id="39819f8e">输入Rakefile内容，而不使用现有的Rakefile。在运行Rake之前，将从指定的内容动态创建新的Rakefile。</p></td></tr><tr id="e4a4ee03" class="ijRowOdd"><td id="b483c47d"><p id="0d8c873e">工作目录</p></td><td id="9f4f7a44"><p id="fc0494ec">可选的。指定是否与<a href="build-checkout-directory.html">Build Checkout目录不同</a> 。</p></td></tr><tr id="c00aaa3c" class="ijRowEven"><td id="3342fb0a"><p id="d4a53af7">耙子任务</p></td><td id="3b5fe8c6"><p id="1e6b4881">如果您不想使用任务名称，请输入以空格分隔的任务名称<code class="code">default</code>任务。例如， <code class="code">test:functionals</code>要么<code class="code">mytask:test mytask:test2</code> 。</p></td></tr><tr id="8652f94b" class="ijRowOdd"><td id="988989ae"><p id="e71d144d">其他Rake命令行参数</p></td><td id="d354b008"><p id="310909b1">指定的参数将添加到<code class="code">rake</code>命令行。命令行将具有以下格式：</p><div class="code-block" data-lang="bash">红宝石耙<additional rake="" command="" line="" parameters=""><teamcity rake="" runner="" options,="" e.g="" testopts=""><tasks>

</tasks></teamcity></additional></div></td></tr></tbody></table></div></div><a name="RubyInterpreter"></a><a name="Ruby-Interpreter"></a><div class="chapter"><h3 id="Rake-RubyInterpreter">Ruby解释器</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="f95739a9"><thead><tr id="322113df" class="ijRowHead"><th id="67d7f604"><p id="30c356a8">选项</p></th><th id="951c15fe"><p id="5277f212">描述</p></th></tr></thead><tbody><tr id="38a820b2" class="ijRowOdd"><td id="a16bf20e"><p id="0ec41378">使用默认的Ruby</p></td><td id="d16fb477"><p id="a3de6a8c">使用在<a href="ruby-environment-configurator.html">Ruby环境配置器</a>构建功能设置中定义的Ruby解释器设置，否则将在<code class="code">PATH</code> 。</p></td></tr><tr id="e2688f30" class="ijRowEven"><td id="57043251"><p id="711df746">Ruby解释器路径</p></td><td id="2d4d8fb2"><p id="bb969229">Ruby解释器的路径。路径不能为空。该字段支持环境和系统变量的值。例如：</p><div class="code-block" data-lang="bash">％env.I_AM_DEFINED_IN_BUILDAGENT_CONFIGURATION％</div></td></tr><tr id="03d85106" class="ijRowOdd"><td id="4bdd8ddf"><p id="732c34b3">RVM解释器</p></td><td id="69201612"><p id="d151f7be">在此指定RVM解释器名称，以及在构建代理上配置的可选的宝石集。注意，解释器名称不能为空。如果未指定gemset，则将使用默认值。</p></td></tr></tbody></table></div></div><a name="LaunchingParameters"></a><a name="Launching-Parameters"></a><div class="chapter"><h3 id="Rake-LaunchingParameters">启动参数</h3><div class="table-wrapper"><table width="100%" id="f57ca46a"><thead><tr id="8f1a73df" class="ijRowHead"><th id="01aa4c34"><p id="7e53801a">选项</p></th><th id="1b86731f"><p id="68ef82f1">描述</p></th></tr></thead><tbody><tr id="35fd2afd" class="ijRowOdd"><td id="01bc18d7"><p id="76bda97e">Bundler：捆绑执行程序</p></td><td id="457cf884"><p id="501c430a">如果您的项目使用<a href="http://gembundler.com" rel="noopener noreferrer" data-external="true" target="_blank">Bundler需求</a>管理器，而Rakefile没有加载捆绑程序设置脚本，则此选项将允许您使用<code class="code">bundle exec</code>命令仿真。如果要执行<code class="code">bundle install</code>命令，则需要在“ <i id="20b9251c">Rake</i> <a href="command-line.html">运行程序”</a>步骤之前的“ <a href="command-line.html">命令行”</a>步骤中执行。另外，请记住要设置<a href="ruby-environment-configurator.html">Ruby环境配置器</a>构建功能，以将Ruby解释器自动传递给命令行运行程序。</p></td></tr><tr id="6576376d" class="ijRowEven"><td id="98fa4ad2"><p id="2abc45b1">除错</p></td><td id="64716cb6"><p id="7f459b73">选中“ <b id="76442ab4">跟踪调用/执行阶段”</b>选项以启用在构建日志中显示“ <i id="a2d8e2e2">调用</i>阶段”数据。</p></td></tr></tbody></table></div></div><a name="TestsReporting"></a><a name="Tests-Reporting"></a><div class="chapter"><h3 id="Rake-TestsReporting">测试报告</h3><div class="table-wrapper"><table width="100%" id="40ddcc6c"><thead><tr id="4538f801" class="ijRowHead"><th id="fbdc48ce"><p id="5c0e79da">选项</p></th><th id="da453169"><p id="2be82234">描述</p></th></tr></thead><tbody><tr id="5d47fe58" class="ijRowOdd"><td id="28498cf2"><p id="2d67236f">所附记者</p></td><td id="4f4a9c4c"><p id="a0f1f82a">如果希望TeamCity在“ <b id="1c0e4d65">构建结果”</b>页面的专用“ <a href="working-with-build-results.html#All-Tests">测试”选项卡</a>上显示测试结果，请在此处选择您使用的测试框架：Test :: Unit，Test-Spec，Shoda，RSpec或Cucumber。</p><aside class="note " rel="a0f1f82a" id="fb4a89ef" data-title=""><p id="203bf516">如果您使用的是RSpec或Cucumber，请确保在此处指定构建脚本中定义的用户选项，否则将被忽略。</p></aside></td></tr></tbody></table></div></div></div><a name="KnownIssues"></a><a name="Known-Issues"></a><div class="chapter"><h2 id="Rake-KnownIssues">已知的问题</h2><ul class="list _ul"><li class="list__item" id="59eee83a"><p>如果您的Rake任务或测试在一个版本的范围内并行运行，则版本输出和测试结果将不准确。</p></li><li class="list__item" id="b479437a"><p>如果您使用的是RVM，建议在未设置当前rvm sdk时启动TeamCity代理或调用<code class="code">rvm system</code>首先。</p></li></ul></div><a name="AdditionalRunnerOptions"></a><a name="Additional-Runner-Options"></a><div class="chapter"><h2 id="Rake-AdditionalRunnerOptions">附加亚军选项</h2><p id="21c5af8f">可以使用“ <a href="configuring-build-parameters.html">构建参数”</a>部分中的系统属性来配置这些选项。</p><div class="table-wrapper"><table width="100%" id="98f6e572"><thead><tr id="5ef220af" class="ijRowHead"><th width="300" id="6427aea5"><p id="e8b49180">选项</p></th><th id="aef9b64d"><p id="15e14205">描述</p></th></tr></thead><tbody><tr id="3858ca44" class="ijRowOdd"><td id="c3cb6ead"><p id="8e5cfafd"><code class="code">system.teamcity.rake.runner.gem.rake.version</code></p></td><td id="0b9008b1"><p id="82b7a14a">允许指定用于启动rake构建的rake gem。</p></td></tr><tr id="afe1a3c0" class="ijRowEven"><td id="08e66104"><p id="11a62519"><code class="code">system.teamcity.rake.runner.gem.testunit.version</code></p></td><td id="9030a4f4"><p id="d30130a5">如果您的应用程序使用的不是最新安装的测试单元gem版本（在Ruby sdk中），请在此处指定。否则，Test :: Unit测试报告程序可能会尝试加载错误的gem版本并影响运行时行为。如果已安装测试单元gem，但您的应用程序使用Ruby 1.8.x SDK中捆绑的Test :: Unit，则将版本值设置为“内置”。</p></td></tr><tr id="ca801a25" class="ijRowOdd"><td id="1de3cbbf"><p id="590688d1"><code class="code">system.teamcity.rake.runner.gem.bundler.version</code></p></td><td id="4c8ea95e"><p id="d26c20fa">针对指定的捆绑程序gem版本启动捆绑程序仿真（该gem应该已经安装在代理上。</p></td></tr><tr id="e6b77393" class="ijRowEven"><td id="153c8c5b"><p id="e3a12917"><code class="code">system.teamcity.rake.runner.custom.gemfile</code></p></td><td id="295a4abd"><p id="e09ad843">自定义Gemfile（如果它不在检出目录根目录中）。</p></td></tr><tr id="0057b1d2" class="ijRowOdd"><td id="bb6a65de"><p id="3723f5e5"><code class="code">system.teamcity.rake.runner.custom.bundle.path</code></p></td><td id="81006e3b"><p id="2ee700af">套装<code class="code">BUNDLE_PATH</code>如果TeamCity无法从以下位置正确获取它<code class="code"><Gemfile_containing_directory>/.bundle/config</code> 。</p></td></tr></tbody></table></div></div><a name="DevelopmentLinks"></a><a name="Development-Links"></a><div class="chapter"><h2 id="Rake-DevelopmentLinks">开发链接</h2><p id="5742b053">Rake支持作为开源插件实现。有关开发链接，请参阅<a href="https://confluence.jetbrains.com/display/TW/Rake+Runner" rel="noopener noreferrer" data-external="true" target="_blank">插件页面</a> 。</p><hr id="ca8dadac"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>