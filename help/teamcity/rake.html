<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Rake - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Rake" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/rake.md|Rake" data-main-title="Rake" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/rake.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Rake" id="rake.md">Rake</h1><aside class="tip sideblock" data-title="" rel="rake.md" id="0d619f0c"><p id="2a8977ef">TeamCity Rake runner supports the Test::Unit, Test-Spec, <a href="http://github.com/thoughtbot/shoulda" data-external="true" target="_blank" rel="noopener noreferrer">Shoulda</a>, <a href="http://rspec.info/" data-external="true" target="_blank" rel="noopener noreferrer">RSpec</a>, <a href="http://cukes.info/" data-external="true" target="_blank" rel="noopener noreferrer">Cucumber</a> test frameworks. It is compatible with Ruby interpreters installed using Ruby Version Manager (MRI Ruby, JRuby, IronRuby, REE, MacRuby, and so on) with Rake 0.7.3 gem or higher.</p></aside><p id="1ea8e661">On this page:</p><p id="07f41315"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Rake-Prerequisites">Prerequisites</a></li><li class="list__item"><a href="#Rake-ImportantNotes">Important Notes</a></li><li class="list__item"><a href="#Rake-RakeRunnerSettings">Rake Runner Settings</a><ul class="list _bullet"><li class="list__item"><a href="#Rake-RakeParameters">Rake Parameters</a></li><li class="list__item"><a href="#Rake-RubyInterpreter">Ruby Interpreter</a></li><li class="list__item"><a href="#Rake-LaunchingParameters">Launching Parameters</a></li><li class="list__item"><a href="#Rake-TestsReporting">Tests Reporting</a></li></ul></li><li class="list__item"><a href="#Rake-KnownIssues">Known Issues</a></li><li class="list__item"><a href="#Rake-AdditionalRunnerOptions">Additional Runner Options</a></li><li class="list__item"><a href="#Rake-DevelopmentLinks">Development Links</a></li></ul></p><a name="Prerequisites"></a><a name="Prerequisites"></a><div class="chapter"><h2 id="Rake-Prerequisites">Prerequisites</h2><p id="a0d5a7fe">Make sure to have Ruby interpreter (MRI Ruby, JRuby, IronRuby, REE, MacRuby, and so on) with rake 0.7.3 gem or higher (mandatory) and all necessary gems for your Ruby (or ROR) projects and testing frameworks installed on at least one build agent. You can install several Ruby interpreters in different folders. On Linux/MacOS it is easier to configure using <a href="http://rvm.io/" data-external="true" target="_blank" rel="noopener noreferrer">RVM</a> or <a href="http://github.com/sstephenson/rbenv" data-external="true" target="_blank" rel="noopener noreferrer">rbenv</a>. It is possible to install Ruby interpreter and necessary Ruby gems using the <a href="command-line.html">Command Line</a> build runner step. If you want to automatically configure agent requirements for this interpreters, you need to register its paths in the build agent configuration properties and then refer to such property name in the <a href="#Rake-Runner-Settings">Rake build runner configuration</a>. To install a gem, execute:</p><div class="code-block" data-lang="bash">gem install &lt;gem_name&gt;

</div><p id="222d43d0">You can refer to the <a href="http://docs.rubygems.org/" data-external="true" target="_blank" rel="noopener noreferrer">Ruby Gems Manuals</a> for more information.</p><p id="13d38b6a">Instead of the <code class="code">gem</code> command, you can install gems using the <a href="http://bundler.io/" data-external="true" target="_blank" rel="noopener noreferrer">Bundler gem</a>.</p><aside class="note " data-title="" rel="13d38b6a" id="7f6153ae"><p id="b28fba6b">If you use Ruby 1.9 for Shoulda, Test-Spec and Test::Unit frameworks to operate, the <code class="code">test-unit</code> gem must be installed.</p></aside><aside class="note " data-title="" rel="Rake-Prerequisites" id="d1f62b67"><p id="fecc49d7">To use the <a href="https://rubygems.org/gems/minitest" data-external="true" target="_blank" rel="noopener noreferrer">minitest</a> framework, the <code class="code">minitest-reporters</code> gem must be installed. See details in the <a href="http://www.jetbrains.com/ruby/webhelp/minitest.html" data-external="true" target="_blank" rel="noopener noreferrer">RubyMine webhelp</a>.</p></aside></div><a name="ImportantNotes"></a><a name="Important-Notes"></a><div class="chapter"><h2 id="Rake-ImportantNotes">Important Notes</h2><ul class="list _ul"><li class="list__item" id="5bee7722"><p>Ruby's <i id="7db573d5">pending specs</i> are shown as <b id="90c9568f">Ignored Tests</b> in the <b id="6d435193">Overwiew</b> tab.</p></li><li class="list__item" id="ed7564da"><p>Rake Runner uses its own unit tests runner and loads it using the <code class="code">RUBYLIB</code> environment variable. You need to ensure your program doesn't clear this environment variable, but you may append your paths to it.</p></li><li class="list__item" id="8c47c53c"><p>If you run RSpec with the <code class="code">--color</code> option enabled under Windows OS, RSpec will suggest you install the <b id="af5d0efb">win32console</b> gem. This warning will appear in your build log, but you can ignore it. TeamCity Rake Runner doesn't support coloured output in the build log and doesn't use this feature.</p></li><li class="list__item" id="cc581434"><p>Rake Runner runs spec examples with a custom formatter. If you use additional console formatter, your build log will contain redundant information.</p></li><li class="list__item" id="70f569b8"><p><code class="code">Spec::Rake::SpecTask.spec_opts</code> of your rakefile is affected by <code class="code">SPEC_OPTS</code> command line parameter. Rake Runner always uses <code class="code">SPEC_OPTS</code> to set up its custom formatter. Thus you should set up Spec Options in Web UI. The same limitation exists for Cucumber tests options.</p></li><li class="list__item" id="6d7db34d"><p>To include HTML reports into the Build Results, you can add the corresponding <a href="including-third-party-reports-in-the-build-results.html">report tab</a> for them.</p></li></ul></div><a name="RakeRunnerSettings"></a><a name="Rake-Runner-Settings"></a><div class="chapter"><h2 id="Rake-RakeRunnerSettings">Rake Runner Settings</h2><a name="RakeParameters"></a><a name="Rake-Parameters"></a><div class="chapter"><h3 id="Rake-RakeParameters">Rake Parameters</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="a46d8c13"><thead><tr id="a82456a6" class="ijRowHead"><th id="e4c6ccbd"><p id="e6b1a8b4">Option</p></th><th id="e76a8aa6"><p id="9c472ae1">Description</p></th></tr></thead><tbody><tr id="b2a73a9c" class="ijRowOdd"><td id="113d94e4"><p id="33fe9e3b">Path to a Rakefile file</p></td><td id="67670119"><p id="3be7992e">Enter a Rakefile path if you don't want to use the default one. The specified path should be relative to the <a href="build-checkout-directory.html">Build Checkout Directory</a>.</p></td></tr><tr id="e0555756" class="ijRowEven"><td id="b6f17f79"><p id="f82d33dc">Rakefile content</p></td><td id="ca699fc0"><p id="39819f8e">Type in the Rakefile content instead of using the existing Rakefile. The new Rakefile will be created dynamically from the specified content before running Rake.</p></td></tr><tr id="e4a4ee03" class="ijRowOdd"><td id="b483c47d"><p id="0d8c873e">Working directory</p></td><td id="9f4f7a44"><p id="fc0494ec">Optional. Specify if differs from the <a href="build-checkout-directory.html">Build Checkout Directory</a>.</p></td></tr><tr id="c00aaa3c" class="ijRowEven"><td id="3342fb0a"><p id="d4a53af7">Rake tasks</p></td><td id="3b5fe8c6"><p id="1e6b4881">Enter space-separated tasks names if you don't want to use the <code class="code">default</code> task.  For example, <code class="code">test:functionals</code> or <code class="code">mytask:test mytask:test2</code>.</p></td></tr><tr id="8652f94b" class="ijRowOdd"><td id="988989ae"><p id="e71d144d">Additional Rake command line parameters</p></td><td id="d354b008"><p id="310909b1">Specified parameters will be added to <code class="code">rake</code> command line. The command line will have the following format:</p><div class="code-block" data-lang="bash">ruby rake &lt;Additional Rake command line parameters&gt;
&lt;TeamCity Rake Runner options, e.g TESTOPTS&gt; &lt;tasks&gt;

</div></td></tr></tbody></table></div></div><a name="RubyInterpreter"></a><a name="Ruby-Interpreter"></a><div class="chapter"><h3 id="Rake-RubyInterpreter">Ruby Interpreter</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="f95739a9"><thead><tr id="322113df" class="ijRowHead"><th id="67d7f604"><p id="30c356a8">Option</p></th><th id="951c15fe"><p id="5277f212">Description</p></th></tr></thead><tbody><tr id="38a820b2" class="ijRowOdd"><td id="a16bf20e"><p id="0ec41378">Use default Ruby</p></td><td id="d16fb477"><p id="a3de6a8c">Use Ruby interpreter settings defined in the <a href="ruby-environment-configurator.html">Ruby environment configurator</a> build feature settings or the interpreter will be searched in the <code class="code">PATH</code>.</p></td></tr><tr id="e2688f30" class="ijRowEven"><td id="57043251"><p id="711df746">Ruby interpreter path</p></td><td id="2d4d8fb2"><p id="bb969229">The path to Ruby interpreter. The path cannot be empty. This field supports values of environment and system variables. For example:</p><div class="code-block" data-lang="bash">%env.I_AM_DEFINED_IN_BUILDAGENT_CONFIGURATION%

</div></td></tr><tr id="03d85106" class="ijRowOdd"><td id="4bdd8ddf"><p id="732c34b3">RVM interpreter</p></td><td id="69201612"><p id="d151f7be">Specify here the RVM interpreter name and optionally a gemset configured on a build agent.  Note, the interpreter name cannot be empty. If gemset isn't specified, the default one will be used.</p></td></tr></tbody></table></div></div><a name="LaunchingParameters"></a><a name="Launching-Parameters"></a><div class="chapter"><h3 id="Rake-LaunchingParameters">Launching Parameters</h3><div class="table-wrapper"><table width="100%" id="f57ca46a"><thead><tr id="8f1a73df" class="ijRowHead"><th id="01aa4c34"><p id="7e53801a">Option</p></th><th id="1b86731f"><p id="68ef82f1">Description</p></th></tr></thead><tbody><tr id="35fd2afd" class="ijRowOdd"><td id="01bc18d7"><p id="76bda97e">Bundler: bundle exec</p></td><td id="457cf884"><p id="501c430a">If your project uses the <a href="http://gembundler.com" data-external="true" target="_blank" rel="noopener noreferrer">Bundler requirements</a> manager and your Rakefile doesn't load the bundler setup script, this option will allow you to launch rake tasks using the <code class="code">bundle exec</code> command emulation. If you want to execute <code class="code">bundle install</code> command, you need to do it in the <a href="command-line.html">Command Line</a> step before the <i id="20b9251c">Rake runner</i> step. Also, remember to set up the <a href="ruby-environment-configurator.html">Ruby environment configurator</a> build feature to automatically pass Ruby interpreter to the command line runner.</p></td></tr><tr id="6576376d" class="ijRowEven"><td id="98fa4ad2"><p id="2abc45b1">Debug</p></td><td id="64716cb6"><p id="7f459b73">Check the <b id="76442ab4">Track invoke/execute stages</b> option to enable showing <i id="a2d8e2e2">Invoke</i> stage data in the build log.</p></td></tr></tbody></table></div></div><a name="TestsReporting"></a><a name="Tests-Reporting"></a><div class="chapter"><h3 id="Rake-TestsReporting">Tests Reporting</h3><div class="table-wrapper"><table width="100%" id="40ddcc6c"><thead><tr id="4538f801" class="ijRowHead"><th id="fbdc48ce"><p id="5c0e79da">Option</p></th><th id="da453169"><p id="2be82234">Description</p></th></tr></thead><tbody><tr id="5d47fe58" class="ijRowOdd"><td id="28498cf2"><p id="2d67236f">Attached reporters</p></td><td id="4f4a9c4c"><p id="a0f1f82a">If you want TeamCity to display the test results on a dedicated <a href="working-with-build-results.html#All-Tests">Tests tab</a> of the <b id="1c0e4d65">Build Results</b> page, select here the testing framework you use: Test::Unit, Test-Spec, Shoulda, RSpec or Cucumber.</p><aside class="note " data-title="" rel="a0f1f82a" id="fb4a89ef"><p id="203bf516">If you're using RSpec or Cucumber, make sure to specify here the user options defined in your build script, otherwise they will be ignored.</p></aside></td></tr></tbody></table></div></div></div><a name="KnownIssues"></a><a name="Known-Issues"></a><div class="chapter"><h2 id="Rake-KnownIssues">Known Issues</h2><ul class="list _ul"><li class="list__item" id="59eee83a"><p>If your Rake tasks or tests run in parallel in the scope of one build, the build output and tests results will be inaccurate.</p></li><li class="list__item" id="b479437a"><p>If you are using RVM, it is recommended to start TeamCity agent when the current rvm sdk isn't set or to invoke <code class="code">rvm system</code> at first.</p></li></ul></div><a name="AdditionalRunnerOptions"></a><a name="Additional-Runner-Options"></a><div class="chapter"><h2 id="Rake-AdditionalRunnerOptions">Additional Runner Options</h2><p id="21c5af8f">These options can be configured using system properties in the <a href="configuring-build-parameters.html">Build Parameters</a> section.</p><div class="table-wrapper"><table width="100%" id="98f6e572"><thead><tr id="5ef220af" class="ijRowHead"><th width="300" id="6427aea5"><p id="e8b49180">Option</p></th><th id="aef9b64d"><p id="15e14205">Description</p></th></tr></thead><tbody><tr id="3858ca44" class="ijRowOdd"><td id="c3cb6ead"><p id="8e5cfafd"><code class="code">system.teamcity.rake.runner.gem.rake.version</code></p></td><td id="0b9008b1"><p id="82b7a14a">Allows specifying which rake gem to use for launching a rake build.</p></td></tr><tr id="afe1a3c0" class="ijRowEven"><td id="08e66104"><p id="11a62519"><code class="code">system.teamcity.rake.runner.gem.testunit.version</code></p></td><td id="9030a4f4"><p id="d30130a5">If your application uses the test-unit gem version other than the latest installed (in Ruby sdk), specify it here. Otherwise the Test::Unit test reporter may try to load the incorrect gem version and affect the runtime behavior. If the test-unit gem is installed but you application uses Test::Unit bundled in Ruby 1.8.x SDK, set the version value to 'built-in'.</p></td></tr><tr id="ca801a25" class="ijRowOdd"><td id="1de3cbbf"><p id="590688d1"><code class="code">system.teamcity.rake.runner.gem.bundler.version</code></p></td><td id="4c8ea95e"><p id="d26c20fa">Launches bundler emulation for the specified bundler gem version (the gem should be already installed on an agent.</p></td></tr><tr id="e6b77393" class="ijRowEven"><td id="153c8c5b"><p id="e3a12917"><code class="code">system.teamcity.rake.runner.custom.gemfile</code></p></td><td id="295a4abd"><p id="e09ad843">Customizes Gemfile if it isn't located in the checkout directory root.</p></td></tr><tr id="0057b1d2" class="ijRowOdd"><td id="bb6a65de"><p id="3723f5e5"><code class="code">system.teamcity.rake.runner.custom.bundle.path</code></p></td><td id="81006e3b"><p id="2ee700af">Sets <code class="code">BUNDLE_PATH</code> if TeamCity doesn't fetch it correctly from <code class="code">&lt;Gemfile_containing_directory&gt;/.bundle/config</code>.</p></td></tr></tbody></table></div></div><a name="DevelopmentLinks"></a><a name="Development-Links"></a><div class="chapter"><h2 id="Rake-DevelopmentLinks">Development Links</h2><p id="5742b053">Rake support is implemented as an open-source plugin. For development links refer to the <a href="https://confluence.jetbrains.com/display/TW/Rake+Runner" data-external="true" target="_blank" rel="noopener noreferrer">plugin's page</a>.</p><hr id="ca8dadac"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>