<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>生成文件清理器（Swabra）-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="viewpage.actionpageId113084151" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/build-files-cleaner-swabra.md|Build Files Cleaner (Swabra)" data-main-title="Build Files Cleaner (Swabra)" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-files-cleaner-swabra.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-files-cleaner-swabra.md" data-toc="viewpage.actionpageId113084151">生成文件清理器（Swabra）</h1><p id="53e16f3b"><i id="de8f8223">Swabra</i> （最初来自俄语名词“ <i id="9d5f0f0f">shvabra</i> ”-拖把，也来自英语动词“ swab”-用拖把清洁）是一个捆绑式插件，可让您清除在构建期间创建的文件。</p><p id="6500c351">插件会在源检出后记住文件树的状态，并在构建结束时或下一次构建开始时删除所有新添加的文件（取决于设置）。Swabra还会检测在构建过程中被修改或删除的文件，并将它们报告给构建日志（但是，插件不会还原这些文件）。该插件还可以确保在构建开始之前，没有文件被先前的构建修改或删除，并且如果检测到此类文件，则启动干净签出。</p><p id="9db08175">而且，Swabra能够转储在构建结束时锁定目录的进程（需要<a href="#Installing-Handle">handle.exe</a> ）</p><p id="531f047d">可以将Swabra作为构建功能添加到您的构建配置中，而不管您具有什么构建步骤集。通过配置其选项，可以启用在检出目录中扫描新创建，修改和删除的文件的功能，并启用文件锁定过程检测。</p><aside class="tip sideblock" rel="531f047d" id="95d86592" data-title=""><p id="bdf98137">Swabra仅应与<a href="vcs-checkout-mode.html">自动签出一起</a>使用：配置此构建功能后，它将<b id="29e3e473">在第一步构建之前</b>运行<b id="29e3e473">，</b>以记住源签出后文件树的状态并在构建后恢复文件树的状态。</p></aside><p id="17b2c449">检出目录状态保存到名为caches的缓存目录中的文件中<code class="code"><checkout-directory-name-hash>.snapshot</code>使用DiskDir格式。要清理的checkout目录的路径保存到<code class="code">snapshot.map</code>文件。以后（在构建结束时或在下一个构建开始时）将使用快照来确定新创建，修改或删除的文件和文件夹。它是根据实际文件的存在，上次修改数据以及与快照中相应记录的大小比较来完成的。</p><p id="f52d6f8c">在此页：</p><p id="07437826"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-ConfiguringSwabraOptions">配置Swabra选项</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Defaultexcludedpaths">默认排除的路径</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-InstallingHandle">安装把手</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Debugoptions">调试选项</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-CleanCheckout">清洁结帐</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Developmentlinks">开发链接</a></li></ul><p></p><a name="ConfiguringSwabraOptions"></a><a name="Configuring-Swabra-Options"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-ConfiguringSwabraOptions">配置Swabra选项</h2><div class="table-wrapper"><table width="100%" id="01980fed"><thead><tr id="12674f56" class="ijRowHead"><th id="4d45a977"><p id="66c41702">选项</p></th><th id="63a4e653"><p id="c43d0d04">描述</p></th></tr></thead><tbody><tr id="ef145322" class="ijRowOdd"><td id="8731788a"><p id="e1aaf414">文件清理</p></td><td id="96379b14"><p id="f696ec06">选择是否要执行构建文件清除，以及何时执行。</p></td></tr><tr id="4864dbdc" class="ijRowEven"><td id="df75d668"><p id="9b632cf8">清洁结帐</p></td><td id="d22e5223"><p id="526e0b9e">选择“ <b id="9afab4e9">如果无法还原干净目录状态</b>则<b id="9afab4e9">强制清除结帐”</b>选项，以确保结帐目录与构建开始时的存储库中的源相对应。如果Swabra在构建开始之前在checkout目录中检测到任何已修改或删除的文件，它将强制执行<a href="clean-checkout.html">clean checkout</a> 。如果Swabra无法删除在先前构建期间创建的某些文件，则构建将失败。</p><p id="8a4e7d94">如果禁用此选项，则只会收到有关已修改和删除文件的警告。</p></td></tr><tr id="7606d7b5" class="ijRowOdd"><td id="4579e53d"><p id="9322f7f5">监控路径</p></td><td id="9f921e08"><p id="ad73f25a">指定一组以换行符分隔的<code class="code">+-:path</code>定义文件收集过程中将涉及哪些文件和文件夹的规则（默认情况下，直到明确排除为止，将监视整个checkout目录）。路径可以是相对的（基于<a href="build-checkout-directory.html">构建的checkout目录</a> ）或绝对的，并且可以包含类似Ant的通配符。如果不<code class="code">+:</code>要么<code class="code">-:</code>指定了前缀，将规则视为“包含”。</p><p id="638d27c5">任何路径上的规则都必须按照<b id="6fc84f18">从更一般到更具体</b>的顺序排列。<br>顶级路径必须始终指向目录。指定目录会影响其整个内容和子目录。还要注意，Swabra <b id="03efbe3f">区分大小写。</b></p><p id="1459d20c">例子：</p><ul class="list _ul"><li class="list__item" id="8a5eb0e5"><p><code class="code">-:*/dir/*</code>排除所有<code class="code">dir</code>文件夹及其内容</p></li><li class="list__item" id="ed8eb4fe"><p><code class="code">-:some/dir, +:some/dir/inner</code>排除<code class="code">some/dir</code>文件夹及其所有内容（除了<code class="code">inner</code>子文件夹及其内容</p></li><li class="list__item" id="d6a20b14"><p><code class="code">+:./*file.txt</code>仅将构建签出目录中的指定文件包括到监视中</p></li><li class="list__item" id="4e176c8c"><p><code class="code">-:file.txt</code>从监视中排除构建签出目录中的指定文件</p></li></ul><aside class="note " rel="6c2d7dc4" id="2a6691b3" data-title=""><p id="4689daea">请注意，删除一些排除规则后，建议运行干净签出。</p></aside></td></tr><tr id="3e888a9a" class="ijRowEven"><td id="23e9d43b"><p id="88d40c96">锁定过程</p></td><td id="0eb0bc43"><p id="d24667a6">选择是否要Swabra检查签出目录中是否有锁定此目录中文件的进程，以及如何处理此类进程。注意<a href="#Installing-Handle"><code class="code">handle.exe</code></a>代理需要用于锁定过程检测。</p></td></tr><tr id="0905f675" class="ijRowOdd"><td id="5038ecb7"><p id="f52d1162">详细输出</p></td><td id="bed8d429"><p id="2c658878">选中此选项可启用详细日志记录以生成日志。</p></td></tr></tbody></table></div></div><a name="Defaultexcludedpaths"></a><a name="Default-excluded-paths"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Defaultexcludedpaths">默认排除的路径</h2><p id="23941985">如果将构建设置为在代理上签出，则默认情况下，Swabra会忽略所有<code class="code">.svn</code> ， <code class="code">.git</code> ， <code class="code">.hg</code> ， <code class="code">CVS</code>文件夹及其内容。要关闭此行为，请指定一个空白<code class="code">swabra.default.rules</code>配置参数。</p></div><a name="InstallingHandle"></a><a name="Installing-Handle"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-InstallingHandle">安装把手</h2><p id="dd107b1e">您可以安装<code class="code">handle.exe</code>来自<b id="c9a6a282">政府</b> | <b id="44952a76">工具</b>页面。<br>单击<b id="00fc6dcd">安装工具</b>按钮，然后从工具列表中选择<b id="8d5b04b8">Sysinternals handle.exe</b> 。<br>指定是否要下载最新版本的<code class="code">handle.exe</code>或手动选择本地计算机上的路径将其上传，然后点击<b id="14ecbc1d">添加</b> 。TeamCity将下载或上传<code class="code">handle.exe</code>并将其发送给Windows代理。</p><p id="78448868"><code class="code">handle.exe</code>仅在升级后才存在于代理上。</p><p id="868f6ab8">请注意，运行handle.exe需要生成代理用户的一些其他权限。有关更多详细信息，请阅读<a href="https://social.technet.microsoft.com/Forums/en-US/e8d97be5-8265-418a-9f44-00a399858bcf/handleexe-amp-user-rights-needed?forum=miscutils" rel="noopener noreferrer" data-external="true" target="_blank">此线程</a> 。</p></div><a name="Debugoptions"></a><a name="Debug-options"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Debugoptions">调试选项</h2><p id="1fc2d365">通常，快照文件在文件收集后被删除。设置<code class="code">swabra.preserve.snapshot</code>系统属性以保留快照以用于调试目的。</p></div><a name="CleanCheckout"></a><a name="Clean-Checkout"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-CleanCheckout">清洁结帐</h2><p id="a6d475c5">请注意，Swabra有时可能会导致<a href="clean-checkout.html">干净签出</a>以恢复干净签出目录状态。<br>为了避免不必要的频繁清理操作，请始终为相同的检出目录中的构建配置设置相同的Swabra构建功能。<br>如果为配置配置了相同的自定义检出目录路径或相同的VCS设置，则构建配置将在相同的检出目录中工作。</p></div><a name="Developmentlinks"></a><a name="Development-links"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Developmentlinks">开发链接</h2><p id="330e1070">请参阅位于<a href="https://confluence.jetbrains.com/display/TW/Swabra" rel="noopener noreferrer" data-external="true" target="_blank">Swabra的</a>插件页面。</p><hr id="cfef0e85"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>