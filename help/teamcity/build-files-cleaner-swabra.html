<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Build Files Cleaner (Swabra) - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="viewpage.actionpageId113084151" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/build-files-cleaner-swabra.md|Build Files Cleaner (Swabra)" data-main-title="Build Files Cleaner (Swabra)" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-files-cleaner-swabra.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="viewpage.actionpageId113084151" id="build-files-cleaner-swabra.md">Build Files Cleaner (Swabra)</h1><p id="53e16f3b"><i id="de8f8223">Swabra</i> (originally from the Russian noun '<i id="9d5f0f0f">shvabra</i>' â€“ a mop, also from the English verb 'swab' - clean with a mop) is a bundled plugin allowing you to clean files created during the build.</p><p id="6500c351">The plugin remembers the state of the file tree after the sources checkout and deletes all the newly added files at the end of the build or at the next build start depending on the settings. Swabra also detects files modified or deleted during the build and reports them to the build log (however, such files are not restored by the plugin). The plugin can also ensure that by the start of the build there are no files modified or deleted by previous builds and initiate clean checkout if such files are detected.</p><p id="9db08175">Moreover, Swabra gives the ability to dump processes which lock directory by the end of the build (requires <a href="#Installing-Handle">handle.exe</a>)</p><p id="531f047d">Swabra can be added as a build feature to your build configuration regardless of what set of build steps you have. By configuring its options you can enable scanning the checkout directory for newly created, modified and deleted files and enable file locking processes detection.</p><aside class="tip sideblock" data-title="" rel="531f047d" id="95d86592"><p id="bdf98137">Swabra should be used with the <a href="vcs-checkout-mode.html">automatic checkout</a> only: after this build feature is configured, it will run <b id="29e3e473">before the first build step</b> to remember the state of the file tree after the sources checkout and to restore it after the build.</p></aside><p id="17b2c449">The checkout directory state is saved into a file in the caches directory named <code class="code">&lt;checkout-directory-name-hash&gt;.snapshot</code> using the DiskDir format. The path to the checkout directory to be cleaned is saved into the <code class="code">snapshot.map</code> file. The snapshot is used later (at the end of the build or at the next build start) to determine which files and folders are newly created, modified or deleted. It is done based on the actual files' presence, last modification data and size comparison with the corresponding records in the snapshot.</p><p id="f52d6f8c">On this page:</p><p id="07437826"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-ConfiguringSwabraOptions">Configuring Swabra Options</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Defaultexcludedpaths">Default excluded paths</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-InstallingHandle">Installing Handle</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Debugoptions">Debug options</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-CleanCheckout">Clean Checkout</a></li><li class="list__item"><a href="#BuildFilesCleaner(Swabra)-Developmentlinks">Development links</a></li></ul></p><a name="ConfiguringSwabraOptions"></a><a name="Configuring-Swabra-Options"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-ConfiguringSwabraOptions">Configuring Swabra Options</h2><div class="table-wrapper"><table width="100%" id="01980fed"><thead><tr id="12674f56" class="ijRowHead"><th id="4d45a977"><p id="66c41702">Option</p></th><th id="63a4e653"><p id="c43d0d04">Description</p></th></tr></thead><tbody><tr id="ef145322" class="ijRowOdd"><td id="8731788a"><p id="e1aaf414">Files cleanup</p></td><td id="96379b14"><p id="f696ec06">Select whether you want to perform build files cleanup, and when it will be performed.</p></td></tr><tr id="4864dbdc" class="ijRowEven"><td id="df75d668"><p id="9b632cf8">Clean checkout</p></td><td id="d22e5223"><p id="526e0b9e">Select the <b id="9afab4e9">Force clean checkout if cannot restore clean directory state</b> option to ensure that the checkout directory corresponds to the sources in the repository at the build start. If Swabra detects any modified or deleted files in the checkout directory before the build start, it will enforce <a href="clean-checkout.html">clean checkout</a>. The build will fail if Swabra cannot delete some files created during the previous build.</p><p id="8a4e7d94">If this option is disabled, you will only get warnings about modified and deleted files.</p></td></tr><tr id="7606d7b5" class="ijRowOdd"><td id="4579e53d"><p id="9322f7f5">Paths to monitor</p></td><td id="9f921e08"><p id="ad73f25a">Specify a newline-separated set of <code class="code">+-:path</code> rules to define which files and folders are to be involved in the files collection process (by default and until explicitly excluded, the entire checkout directory is monitored). The path can be relative (based on the <a href="build-checkout-directory.html">build's checkout directory</a>) or absolute and can include Ant-like wildcards. If no <code class="code">+:</code> or <code class="code">-:</code> prefix is specified, a rule as treated as "include".</p><p id="638d27c5">Rules on any path must come in the order <b id="6fc84f18">from more general to more concrete</b>.<br>The top level path must always point to a directory. Specifying a directory affects its entire content and sub-directories. Note also that Swabra is <b id="03efbe3f">case-sensitive.</b></p><p id="1459d20c">Examples:</p><ul class="list _ul"><li class="list__item" id="8a5eb0e5"><p><code class="code">-:*/dir/*</code> excludes all <code class="code">dir</code> folders and their content</p></li><li class="list__item" id="ed8eb4fe"><p><code class="code">-:some/dir, +:some/dir/inner</code> excludes <code class="code">some/dir</code> folder and all its content except for the <code class="code">inner</code> subfolder and its content</p></li><li class="list__item" id="d6a20b14"><p><code class="code">+:./*file.txt</code> includes only the specified file in the build checkout directory into monitoring</p></li><li class="list__item" id="4e176c8c"><p><code class="code">-:file.txt</code>excludes the specified file in the build checkout directory from monitoring</p></li></ul><aside class="note " data-title="" rel="6c2d7dc4" id="2a6691b3"><p id="4689daea">Note that after removing some exclude rules, it is advisable to run a clean checkout.</p></aside></td></tr><tr id="3e888a9a" class="ijRowEven"><td id="23e9d43b"><p id="88d40c96">Locking processes</p></td><td id="0eb0bc43"><p id="d24667a6">Select whether you want Swabra to inspect the checkout directory for processes locking files in this directory, and what to do with such processes. Note that <a href="#Installing-Handle"><code class="code">handle.exe</code></a> is required on agents for locking processes detection.</p></td></tr><tr id="0905f675" class="ijRowOdd"><td id="5038ecb7"><p id="f52d1162">Verbose output</p></td><td id="bed8d429"><p id="2c658878">Check this option to enable detailed logging to build log.</p></td></tr></tbody></table></div></div><a name="Defaultexcludedpaths"></a><a name="Default-excluded-paths"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Defaultexcludedpaths">Default excluded paths</h2><p id="23941985">If the build is set up to checkout on the agent, by default Swabra ignores all <code class="code">.svn</code>, <code class="code">.git</code>, <code class="code">.hg</code>, <code class="code">CVS</code> folders and their content. To turn off this behaviour, specify an empty <code class="code">swabra.default.rules</code> configuration parameter.</p></div><a name="InstallingHandle"></a><a name="Installing-Handle"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-InstallingHandle">Installing Handle</h2><p id="dd107b1e">You can install <code class="code">handle.exe</code> from the <b id="c9a6a282">Administration</b> | <b id="44952a76">Tools</b> page.<br>Click the <b id="00fc6dcd">Install Tool</b> button and select <b id="8d5b04b8">Sysinternals handle.exe</b> from the list of tools.<br>Specify whether you want to download the latest version of <code class="code">handle.exe</code> or upload it manually choosing the path on local machine, and click <b id="14ecbc1d">Add</b>. TeamCity will download or upload <code class="code">handle.exe</code> and send it to Windows agents.</p><p id="78448868"><code class="code">handle.exe</code> is present on agents only after the upgrade.</p><p id="868f6ab8">Note that running handle.exe requires some additional permissions for the build agent user. For more details read <a href="https://social.technet.microsoft.com/Forums/en-US/e8d97be5-8265-418a-9f44-00a399858bcf/handleexe-amp-user-rights-needed?forum=miscutils" data-external="true" target="_blank" rel="noopener noreferrer">this thread</a>.</p></div><a name="Debugoptions"></a><a name="Debug-options"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Debugoptions">Debug options</h2><p id="1fc2d365">Generally snapshot file is deleted after files collection. Set the <code class="code">swabra.preserve.snapshot</code> system property to preserve snapshots for debugging purposes.</p></div><a name="CleanCheckout"></a><a name="Clean-Checkout"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-CleanCheckout">Clean Checkout</h2><p id="a6d475c5">Note that Swabra may sometimes cause <a href="clean-checkout.html">clean checkout</a> to restore clean checkout directory state.<br>To avoid unnecessary frequent clean checkouts, always set up identical Swabra build features for build configurations working in the same checkout directory.<br>Build configurations work in the same checkout directory if either the same custom checkout directory path or same VCS settings configured for them.</p></div><a name="Developmentlinks"></a><a name="Development-links"></a><div class="chapter"><h2 id="BuildFilesCleaner(Swabra)-Developmentlinks">Development links</h2><p id="330e1070">See plugin page at <a href="https://confluence.jetbrains.com/display/TW/Swabra" data-external="true" target="_blank" rel="noopener noreferrer">Swabra</a>.</p><hr id="cfef0e85"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>