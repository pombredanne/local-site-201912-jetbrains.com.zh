<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>手动备份和还原-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Manual Backup and Restore" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/teamcity-data-backup.md|TeamCity Data Backup/manual-backup-and-restore.md|Manual Backup and Restore" data-main-title="Manual Backup and Restore" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/manual-backup-and-restore.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="manual-backup-and-restore.md" data-toc="Manual Backup and Restore">手动备份和还原</h1><p id="5d02fc07">在此页：</p><p id="1f452e74"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ManualBackupandRestore-ServerManualBackup">服务器手动备份</a><ul class="list _bullet"><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDataDirectory">TeamCity数据目录</a></li><li class="list__item"><a href="#ManualBackupandRestore-DatabaseData">数据库数据</a></li><li class="list__item"><a href="#ManualBackupandRestore-ApplicationFiles">申请文件</a></li><li class="list__item"><a href="#ManualBackupandRestore-Logfiles">日志文件</a></li></ul></li><li class="list__item"><a href="#ManualBackupandRestore-ManualRestorationofServerBackup">手动还原服务器备份</a><ul class="list _bullet"><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDataDirectoryRestoration">TeamCity数据目录还原</a></li><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDatabaseRestoration">TeamCity数据库还原</a></li><li class="list__item"><a href="#ManualBackupandRestore-RestorationtoNewServer">恢复到新服务器</a></li><li class="list__item"><a href="#ManualBackupandRestore-RestoringBuildLogs">恢复构建日志</a></li></ul></li></ul><p></p><a name="ServerManualBackup"></a><a name="Server-Manual-Backup"></a><div class="chapter"><h2 id="ManualBackupandRestore-ServerManualBackup">服务器手动备份</h2><p id="eca83695">创建备份其它方式<a href="teamcity-data-backup.html">使用</a> 。如果您希望对备份过程进行细粒度的控制，或者需要对TeamCity备份使用特定的过程，则可以使用此页面上的说明。手动备份也可以是创建和还原备份的最有效方式，因为它们可以针对正在使用的特定基础结构进行定制。</p><aside class="note " rel="eca83695" id="64084075" data-title=""><p id="1535a1a2">在执行备份过程之前，建议先<b id="0470c9a4">停止</b> TeamCity服务器。这样，您可以确保备份是一致的。如果在TeamCity服务器运行时创建备份，则还原后，当前更新的数据（主要与排队和运行中的构建以及设置更新有关）可能会以不一致的状态出现。在服务器运行时执行备份时，首先创建数据库备份，然后在TeamCity Data Directory中创建文件的备份。</p></aside><p id="727be3bf">需要备份以下数据：</p><a name="TeamCityDataDirectory"></a><a name="TeamCity-Data-Directory"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDataDirectory">TeamCity数据目录</h3><p id="3d428a06"><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a>店铺：</p><ul class="list _ul"><li class="list__item" id="8cc1a634"><p>服务器设置，项目和构建配置及其设置（即通过管理Web UI配置的所有设置）</p></li><li class="list__item" id="61f0c4f6"><p>默认情况下构建构件，除非<a href="build-artifact.html">配置</a>了其他位置。构建日志也存储为构建工件的一部分</p></li><li class="list__item" id="f8cb7bf4"><p>当前的操作文件，内部数据结构等</p></li></ul><p id="13b20d95">有关目录结构和数据的更多详细信息，请参阅<a href="teamcity-data-directory.html">TeamCity数据目录</a>部分。</p><p id="ad3401aa">如有必要，您可以从备份中排除部分目录以节省空间：您只会丢失被排除的数据。您可以安全地排除“ <code class="code">system/caches</code>备份中的“”目录-必要的数据将在TeamCity启动时从头开始重建。</p><p id="f18a843d">如果您决定跳过下面的备份数据<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/system</code>目录中，请确保您记下了每个目录中的最新文件<code class="code">artifacts</code> ， <code class="code">messages</code>和<code class="code">changes</code>子目录并保存此信息。如果您决定使用TeamCity Data Directory还原与数据库状态相比新的状态，则需要还原数据库备份。</p><p id="4de6acee">的<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/system/buildserver.*</code>文件存储内部数据库（HSQLDB）数据。如果使用HSQLDB（默认设置不适合生产使用），则需要备份它们。</p></div><a name="DatabaseData"></a><a name="Database-Data"></a><div class="chapter"><h3 id="ManualBackupandRestore-DatabaseData">数据库数据</h3><p id="9cb74996"><a name="database_data"></a><a name="ManualBackupandRestore-database_data"></a></p><p id="ef436a7a">数据库存储有关构建结果的所有信息（构建历史记录和所有与构建相关的数据（工件和构建日志除外），VCS更改，代理，构建队列，用户帐户和用户权限等。</p><ul class="list _ul"><li class="list__item" id="f9af7aaf"><p>如果您使用HSQLDB（内部数据库）（默认设置，不建议用于生产环境），则数据库存储在直接位于服务器内部的文件中。 <code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/system</code>夹。目录中的所有文件都可以备份。您还可以参考<a href="http://hsqldb.org/doc/guide/ch05.html#N10F02" rel="noopener noreferrer" data-external="true" target="_blank">HSQLDB备份说明</a> 。</p></li><li class="list__item" id="f20cad5d"><p>如果您使用外部数据库，请使用特定于数据库的工具备份TeamCity使用的数据库架构。有关TeamCity使用的外部数据库连接设置，请参阅<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/database.properties</code>文件。您也可以看到<a href="setting-up-an-external-database.html">相应的安装部分</a> 。</p></li></ul></div><a name="ApplicationFiles"></a><a name="Application-Files"></a><div class="chapter"><h3 id="ManualBackupandRestore-ApplicationFiles">申请文件</h3><p id="93452fd7">您无需备份TeamCity应用程序目录（仅与Web应用程序一起使用Web服务器），前提是您仍具有原始分发包，而您没有：</p><ul class="list _ul"><li class="list__item" id="d481abe4"><p>放置任何自定义库供TeamCity使用</p></li><li class="list__item" id="aa64bed7"><p>将所有非默认TeamCity插件直接安装到Web应用程序文件中</p></li><li class="list__item" id="75b8dbe3"><p>进行任何启动脚本/配置更改。</p></li></ul><p id="63d7c475">如果您认为需要备份应用程序文件：</p><ul class="list _ul"><li class="list__item" id="bfe89fa0"><p>如果您使用<i id="eeb27539">非战争</i>发行版：请备份<b id="38c5a614">所有内容</b> <code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">></code>除了<code class="code">temp</code>和<code class="code">work</code>目录。</p></li><li class="list__item" id="488f3bf7"><p>如果使用<i id="e367934f">战争</i>发行版，请遵循所用Servlet容器的备份过程。</p></li></ul></div><a name="Logfiles"></a><a name="Log-files"></a><div class="chapter"><h3 id="ManualBackupandRestore-Logfiles">日志文件</h3><p id="e35d337c">如果您需要<a href="teamcity-server-logs.html">TeamCity服务器日志文件</a> （主要用于解决问题或调试目的），请备份<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/logs</code>目录。</p><aside class="note " rel="e35d337c" id="e11542dd" data-title=""><p id="d1bed365">您可能还希望备份TeamCity Windows服务设置（如果已修改）。</p></aside></div></div><a name="ManualRestorationofServerBackup"></a><a name="Manual-Restoration-of-Server-Backup"></a><div class="chapter"><h2 id="ManualBackupandRestore-ManualRestorationofServerBackup">手动还原服务器备份</h2><p id="8aa6c0e1">如果您需要还原使用Web UI创建的备份或<code class="code">maintainDB</code>实用程序，请参阅<a href="restoring-teamcity-data-from-backup.html">从备份还原TeamCity数据</a> 。本节介绍还原手动创建的备份。</p><p id="b5a583be">您应该始终还原两个数据<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">></code>和数据库中的数据。数据库和目录都应同步备份/还原。</p><a name="TeamCityDataDirectoryRestoration"></a><a name="TeamCity-Data-Directory-Restoration"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDataDirectoryRestoration">TeamCity数据目录还原</h3><p id="2fde6407">您可以简单地将以前备份的文件放回其原始位置。但是，重要的是还原备份时，不要有多余的文件。实现此目的的最简单方法是将备份还原到干净的数据目录中。如果无法做到这一点，请确保清除备份完成后创建的文件。特别是新创建的文件<code class="code">artifacts</code> ， <code class="code">messages</code> ， <code class="code">changes</code>下的目录<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/system</code> 。</p></div><a name="TeamCityDatabaseRestoration"></a><a name="TeamCity-Database-Restoration"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDatabaseRestoration">TeamCity数据库还原</h3><p id="e3f7111a">必须使用特定于数据库的工具和方法来还原数据库。您可能还希望使用特定于数据库的方法来加快还原速度（例如将SQL Server的“恢复模型”设置为“简单”）。</p><p id="9f418de5">还原之前，请确保TeamCity使用的架构中没有多余的表。</p></div><a name="RestorationtoNewServer"></a><a name="Restoration-to-New-Server"></a><div class="chapter"><h3 id="ManualBackupandRestore-RestorationtoNewServer">恢复到新服务器</h3><p id="98bc41ad">如果要运行服务器的副本，请确保服务器使用不同的数据目录和数据库。对于外部数据库，请确保您在<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/database.properties</code>文件指向另一个数据库。</p></div><a name="RestoringBuildLogs"></a><a name="Restoring-Build-Logs"></a><div class="chapter"><h3 id="ManualBackupandRestore-RestoringBuildLogs">恢复构建日志</h3><p id="528a85ec">构建日志位于<code class="code">/logs</code>的子目录<a href="teamcity-data-directory.html#artifacts"><code class="code">/artifacts</code></a>从<a href="build-artifact.html">多个工件目录</a>中备份并还原到单个目录中<code class="code">system/<project ID>/<build configuration name>/<internal_build_id>/.teamcity/logs</code> 。</p><hr id="b83320f6"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>