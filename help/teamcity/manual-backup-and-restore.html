<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Manual Backup and Restore - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Manual Backup and Restore" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/teamcity-data-backup.md|TeamCity Data Backup/manual-backup-and-restore.md|Manual Backup and Restore" data-main-title="Manual Backup and Restore" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/manual-backup-and-restore.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Manual Backup and Restore" id="manual-backup-and-restore.md">Manual Backup and Restore</h1><p id="5d02fc07">On this page:</p><p id="1f452e74"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ManualBackupandRestore-ServerManualBackup">Server Manual Backup</a><ul class="list _bullet"><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDataDirectory">TeamCity Data Directory</a></li><li class="list__item"><a href="#ManualBackupandRestore-DatabaseData">Database Data</a></li><li class="list__item"><a href="#ManualBackupandRestore-ApplicationFiles">Application Files</a></li><li class="list__item"><a href="#ManualBackupandRestore-Logfiles">Log files</a></li></ul></li><li class="list__item"><a href="#ManualBackupandRestore-ManualRestorationofServerBackup">Manual Restoration of Server Backup</a><ul class="list _bullet"><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDataDirectoryRestoration">TeamCity Data Directory Restoration</a></li><li class="list__item"><a href="#ManualBackupandRestore-TeamCityDatabaseRestoration">TeamCity Database Restoration</a></li><li class="list__item"><a href="#ManualBackupandRestore-RestorationtoNewServer">Restoration to New Server</a></li><li class="list__item"><a href="#ManualBackupandRestore-RestoringBuildLogs">Restoring Build Logs</a></li></ul></li></ul></p><a name="ServerManualBackup"></a><a name="Server-Manual-Backup"></a><div class="chapter"><h2 id="ManualBackupandRestore-ServerManualBackup">Server Manual Backup</h2><p id="eca83695">Other ways to create a backup are <a href="teamcity-data-backup.html">available</a>. You can use the instructions on this page if you want fine-grained control over the backup process or need to use a specific procedure for your TeamCity backups. Manual backups can also be the most performant way to create and restore backups as they can be tailored to the specific infrastructure in use.</p><aside class="note " data-title="" rel="eca83695" id="64084075"><p id="1535a1a2">Before performing the backup procedures, it is recommended to <b id="0470c9a4">stop</b> the TeamCity server. This way you ensure the backup taken is consistent. If you create a backup while the TeamCity server is running, currently updated data (mostly related to queued and running builds as well as settings updates) can appear in inconsistent state after restore. When performing backup while the server is running first create the database backup and then that of the files in the TeamCity Data Directory.</p></aside><p id="727be3bf">The following data needs to be backed up:</p><a name="TeamCityDataDirectory"></a><a name="TeamCity-Data-Directory"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDataDirectory">TeamCity Data Directory</h3><p id="3d428a06"><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> stores:</p><ul class="list _ul"><li class="list__item" id="8cc1a634"><p>server settings, projects and build configurations with their settings (i.e. all that is configured via the Administration web UI)</p></li><li class="list__item" id="61f0c4f6"><p>build artifacts by default, unless a different location is <a href="build-artifact.html">configured</a>. Build logs are also stored as a part of the build artifacts</p></li><li class="list__item" id="f8cb7bf4"><p>current operation files, internal data structure, etc.</p></li></ul><p id="13b20d95">For more details on the directory structure and data, refer to the <a href="teamcity-data-directory.html">TeamCity Data Directory</a> section.</p><p id="ad3401aa">If necessary, you can exclude parts of the directory from the backup to save space: you will only lose the excluded data. You may safely exclude the "<code class="code">system/caches</code>" directory from the backup â€” the necessary data will be rebuilt from scratch on TeamCity startup.</p><p id="f18a843d">If you decide to skip backing up data under <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system</code> directory, make sure you note the most recent files in each of the <code class="code">artifacts</code>, <code class="code">messages</code>, and <code class="code">changes</code> subdirectories and save this information. It will be needed if you decide to restore the database backup with the TeamCity Data Directory corresponding to a newer state than that of the database.</p><p id="4de6acee">The <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system/buildserver.*</code> files store the internal database (HSQLDB) data. You need to back them up if you use HSQLDB (the default setting not suitable for production use).</p></div><a name="DatabaseData"></a><a name="Database-Data"></a><div class="chapter"><h3 id="ManualBackupandRestore-DatabaseData">Database Data</h3><p id="9cb74996"><a name="database_data"></a><a name="ManualBackupandRestore-database_data"></a></p><p id="ef436a7a">The database stores all information on the build results (build history and all the build-associated data except for artifacts and build logs), VCS changes, agents, build queue, user accounts and user permissions, etc.</p><ul class="list _ul"><li class="list__item" id="f9af7aaf"><p>If you use the HSQLDB, the internal database (default setting, not recommended for production), the database is stored in the files residing directly in the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system</code> folder. All files from the directory can be backed up. You may also refer to the <a href="http://hsqldb.org/doc/guide/ch05.html#N10F02" data-external="true" target="_blank" rel="noopener noreferrer">HSQLDB backup notes</a>.</p></li><li class="list__item" id="f20cad5d"><p>If you use an external database, back up your database schema used by TeamCity with database-specific tools. For the external database connection settings used by TeamCity, refer to the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/config/database.properties</code> file. You can also see the <a href="setting-up-an-external-database.html">corresponding installation section</a>.</p></li></ul></div><a name="ApplicationFiles"></a><a name="Application-Files"></a><div class="chapter"><h3 id="ManualBackupandRestore-ApplicationFiles">Application Files</h3><p id="93452fd7">You do not need to back up TeamCity application directory (web server alone with the web application), provided you still have the original distribution package and you did not:</p><ul class="list _ul"><li class="list__item" id="d481abe4"><p>place any custom libraries for TeamCity to use</p></li><li class="list__item" id="aa64bed7"><p>install any non-default TeamCity plugins directly into web application files</p></li><li class="list__item" id="75b8dbe3"><p>make any startup script/configuration changes.</p></li></ul><p id="63d7c475">If you feel you need to back up the application files:</p><ul class="list _ul"><li class="list__item" id="bfe89fa0"><p>If you use a <i id="eeb27539">non-war</i> distribution: back up <b id="38c5a614">everything</b> under <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;</code> except for the <code class="code">temp</code> and <code class="code">work</code> directories.</p></li><li class="list__item" id="488f3bf7"><p>If you use the <i id="e367934f">war</i> distribution, follow the backup procedure of the servlet container used.</p></li></ul></div><a name="Logfiles"></a><a name="Log-files"></a><div class="chapter"><h3 id="ManualBackupandRestore-Logfiles">Log files</h3><p id="e35d337c">If you need <a href="teamcity-server-logs.html">TeamCity server log files</a> (which are mainly used for problem solving or debug purposes), back up the  <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/logs</code> directory.</p><aside class="note " data-title="" rel="e35d337c" id="e11542dd"><p id="d1bed365">You may also want to back up TeamCity Windows Service settings, if they were modified.</p></aside></div></div><a name="ManualRestorationofServerBackup"></a><a name="Manual-Restoration-of-Server-Backup"></a><div class="chapter"><h2 id="ManualBackupandRestore-ManualRestorationofServerBackup">Manual Restoration of Server Backup</h2><p id="8aa6c0e1">If you need to restore backup created with the web UI or <code class="code">maintainDB</code> utility, please refer to <a href="restoring-teamcity-data-from-backup.html">Restoring TeamCity Data from Backup</a>. This section describes restoration of a manually created backup.</p><p id="b5a583be">You should always restore both the data in the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;</code> and data in the database. Both the database and the directory should be backed up/restored in sync.</p><a name="TeamCityDataDirectoryRestoration"></a><a name="TeamCity-Data-Directory-Restoration"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDataDirectoryRestoration">TeamCity Data Directory Restoration</h3><p id="2fde6407">You can simply put the previously backed up files back to their original places. However, it is important that no extra files are present when restoring the backup. The simplest way to achieve this is to restore the backup into a clean Data Directory. If this is not possible, make sure the files created after the backup was done are cleared. Especially the newly created files under the <code class="code">artifacts</code>, <code class="code">messages</code>, <code class="code">changes</code> directories under <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system</code>.</p></div><a name="TeamCityDatabaseRestoration"></a><a name="TeamCity-Database-Restoration"></a><div class="chapter"><h3 id="ManualBackupandRestore-TeamCityDatabaseRestoration">TeamCity Database Restoration</h3><p id="e3f7111a">The database must be restored using the database-specific tools and methods. You might also want to use database-specific methods to make the restore faster (like setting SQL Server "Recovery Model" to "Simple").</p><p id="9f418de5">Prior to restoring, make sure there are no extra tables in the schema used by TeamCity.</p></div><a name="RestorationtoNewServer"></a><a name="Restoration-to-New-Server"></a><div class="chapter"><h3 id="ManualBackupandRestore-RestorationtoNewServer">Restoration to New Server</h3><p id="98bc41ad">If you want to run a copy of the server, make sure the servers use distinct data directories and databases. For an external database, make sure you modify settings in the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/config/database.properties</code> file to point to a different database.</p></div><a name="RestoringBuildLogs"></a><a name="Restoring-Build-Logs"></a><div class="chapter"><h3 id="ManualBackupandRestore-RestoringBuildLogs">Restoring Build Logs</h3><p id="528a85ec">Build logs located in the <code class="code">/logs</code> subdirectory of <a href="teamcity-data-directory.html#artifacts"><code class="code">/artifacts</code></a> from <a href="build-artifact.html">multiple artifact directories</a> are backed up and restored into the single directory <code class="code">system/&lt;project ID&gt;/&lt;build configuration name&gt;/&lt;internal_build_id&gt;/.teamcity/logs</code>.</p><hr id="b83320f6"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>