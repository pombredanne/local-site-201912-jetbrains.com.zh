<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>TeamCity服务器日志-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="TeamCity Server Logs" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/teamcity-server-logs.md|TeamCity Server Logs" data-main-title="TeamCity Server Logs" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/teamcity-server-logs.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="teamcity-server-logs.md" data-toc="TeamCity Server Logs">TeamCity服务器日志</h1><p id="86552c58">在此页：</p><p id="1b1189c0"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#TeamCityServerLogs-GeneralLoggingDescription">常规记录说明</a></li><li class="list__item"><a href="#TeamCityServerLogs-Logging-relatedDiagnosticsUI">与记录相关的诊断UI</a></li><li class="list__item"><a href="#TeamCityServerLogs-ChangingLoggingConfiguration">更改日志记录配置</a><ul class="list _bullet"><li class="list__item"><a href="#TeamCityServerLogs-ChangingLoggingSettings">更改记录设置</a></li></ul></li><li class="list__item"><a href="#TeamCityServerLogs-ReadingLogs">阅读日志</a><ul class="list _bullet"><li class="list__item"><a href="#TeamCityServerLogs-GeneralLoggingConfiguration">常规记录配置</a></li></ul></li></ul><p></p><p id="2669fc6e">TeamCity Server保留内部活动的日志，可以对其进行检查以调查服务器行为问题或获取内部错误详细信息。</p><p id="8770cafe">日志存储在TeamCity服务器计算机上磁盘目录中的纯文本文件中（通常在<code class="code"><</code> <a href="teamcity-home-directory.html"><code class="code">TeamCity Server home</code></a> <code class="code">>/logs</code> ）。运行TeamCity时，文件将附加消息。</p><p id="d30e3d50">在服务器运行时，可以在Web UI上查看日志。 <code class="code">Server Logs</code> <b id="497da0a7">管理</b>标签<b id="497da0a7">|诊断</b>部分。</p><aside class="tip sideblock" rel="d30e3d50" id="c1d79004" data-title=""><p id="77f66b2b"><b id="bd6c7ea6">在服务器日志中启用调试</b></p><p id="bd674d66">在Web UI中，转到<b id="6b047160">管理|诊断</b>页面。在“ <b id="e14a68b4">疑难解答”</b>选项卡上，选择一个日志记录预设，在“ <b id="ce1c3472">服务器日志”</b>子部分下<b id="ce1c3472">查看日志</b> 。</p><p id="99a79f9a">如果无法从TeamCity Web UI启用调试日志记录模式，请参阅“ <a href="#Changing-Logging-Configuration">更改日志记录配置”</a>部分以了解如何手动调整日志记录选项。</p></aside><a name="GeneralLoggingDescription"></a><a name="General-Logging-Description"></a><div class="chapter"><h2 id="TeamCityServerLogs-GeneralLoggingDescription">常规记录说明</h2><p id="765c1b14">TeamCity使用<a href="http://logging.apache.org/log4j" rel="noopener noreferrer" data-external="true" target="_blank">log4j库</a>进行日志记录，并且可以<a href="#Changing-Logging-Configuration">自定义</a>其设置。</p><p id="5b47778c">默认情况下，日志文件位于<code class="code"><</code> <a href="teamcity-home-directory.html"><code class="code">TeamCity Server home</code></a> <code class="code">>/logs</code>目录。</p><p id="f1b7725d">最重要的日志文件是：</p><div class="table-wrapper"><table width="100%" id="8f05e331"><thead><tr id="1b250049" class="ijRowHead"><th id="984e619b"><p id="b6ba500c"><code class="code">teamcity-server.log</code></p></th><th id="3f75e8cc"><p id="e8241ced">常规服务器日志</p></th></tr></thead><tbody><tr id="63dd2400" class="ijRowOdd"><td id="34b2bd58"><p id="e92cb67d"><code class="code">teamcity-activities.log</code></p></td><td id="5d54ac0c"><p id="fb105249">用户启动和主要与构建相关的事件的日志</p></td></tr><tr id="2a0d434f" class="ijRowEven"><td id="a32407fc"><p id="ca4a2f90"><code class="code">teamcity-vcs.log</code></p></td><td id="67c152ca"><p id="2e943097"><a href="configuring-vcs-roots.html">VCS</a>相关活动的日志</p></td></tr><tr id="b90d6bfb" class="ijRowOdd"><td id="dc3c1aff"><p id="ef0ccdb0"><code class="code">teamcity-cleanup.log</code></p></td><td id="7c02d4ba"><p id="0bd650ff">包含与<a href="clean-up.html">清理</a>相关的日志</p></td></tr><tr id="5ba11075" class="ijRowEven"><td id="d8da6eeb"><p id="20241b50"><code class="code">teamcity-notifications.log</code></p></td><td id="55a3e2a3"><p id="b19cfb6d"><a href="subscribing-to-notifications.html">通知</a>相关的日志</p></td></tr><tr id="fa333c7a" class="ijRowOdd"><td id="81ed3a35"><p id="7642b834"><code class="code">teamcity-clouds.log</code></p></td><td id="7bb53a9e"><p id="e6db6b36">（默认关闭）与<a href="teamcity-integration-with-cloud-solutions.html">云集成</a>相关的日志</p></td></tr><tr id="f1ace2ab" class="ijRowEven"><td id="e1cf4c35"><p id="76a2178c"><code class="code">teamcity-sql.log</code></p></td><td id="8394301a"><p id="7a9385bb">（默认关闭）SQL查询日志，请参阅<a href="reporting-issues.html#Database-related-Slowdowns">详细信息</a></p></td></tr><tr id="05ba68b2" class="ijRowOdd"><td id="6ff15906"><p id="515001f7"><code class="code">teamcity-http-auth.log</code></p></td><td id="4dfed357"><p id="2adf86ff">（默认情况下处于关闭状态）使用与<a href="ntlm-http-authentication.html">NTLM</a>和其他HTML身份验证有关的消息进行登录</p></td></tr><tr id="2949d269" class="ijRowEven"><td id="43a694f8"><p id="411e24d1"><code class="code">teamcity-xmlrpc.log</code></p></td><td id="c57a9bce"><p id="f8182d16">（默认情况下处于关闭状态）服务器通过XML-RPC发送到代理和IDE插件的消息日志</p></td></tr><tr id="fb81de99" class="ijRowOdd"><td id="b13d307e"><p id="2659293f"><code class="code">vcs-content-cache.log</code></p></td><td id="f76694dd"><p id="e453dbe6">（默认关闭）与来自VCS的单个文件内容请求相关的日志</p></td></tr><tr id="63cb91e1" class="ijRowEven"><td id="b8072e77"><p id="bec4f7c7"><code class="code">teamcity-rest.log</code></p></td><td id="64a5c3e1"><p id="60afe779">（默认情况下关闭）与<a href="rest-api.html">REST-API</a>相关的日志记录</p></td></tr><tr id="b19ecc13" class="ijRowOdd"><td id="1b135316"><p id="6b2516d7"><code class="code">teamcity-freemarker.log</code></p></td><td id="c180afda"><p id="c5a64305">（默认情况下为关闭）与<a href="customizing-notifications.html">通知模板</a>处理相关的日志记录</p></td></tr><tr id="c8aa4ecf" class="ijRowEven"><td id="1969cf8b"><p id="aec02714"><code class="code">teamcity-agentPush.log</code></p></td><td id="99fe341b"><p id="1f0151b7">（默认为关闭）与<a href="setting-up-and-running-additional-build-agents.html">代理推送</a>操作相关的日志记录</p></td></tr><tr id="2857039e" class="ijRowOdd"><td id="982e2e3d"><p id="60ffcd50"><code class="code">teamcity-remote-run.log</code></p></td><td id="eee59300"><p id="e907f22f">（默认关闭）与服务器上的<a href="personal-build.html">个人构建</a>处理相关的日志记录</p></td></tr><tr id="79bf6368" class="ijRowEven"><td id="d471bc4c"><p id="b46fc187"><code class="code">teamcity-svn.log</code></p></td><td id="e36f900f"><p id="de6046a2">（默认关闭） <a href="subversion.html">SVN集成</a>日志</p></td></tr><tr id="e97c2854" class="ijRowOdd"><td id="effeda21"><p id="da1c7dac"><code class="code">teamcity-tfs.log</code></p></td><td id="18332ae0"><p id="eb5f4122">（默认关闭） <a href="team-foundation-server.html">TFS集成</a>日志</p></td></tr><tr id="7f4372ea" class="ijRowEven"><td id="46f6450f"><p id="9a2e89e6"><code class="code">teamcity-starteam.log</code></p></td><td id="8543e04e"><p id="31c98d3c">（默认情况下为关闭） <a href="starteam.html">StarTeam集成</a>日志</p></td></tr><tr id="ad2ba2ee" class="ijRowOdd"><td id="2b59517e"><p id="c5f0bd0d"><code class="code">teamcity-clearcase.log</code></p></td><td id="537a8db4"><p id="889ed6a0">（默认情况下关闭） <a href="clearcase.html">ClearCase集成</a>日志</p></td></tr><tr id="92406be8" class="ijRowEven"><td id="ffc0bc5a"><p id="ff0b1a41"><code class="code">teamcity-ldap.log</code></p></td><td id="55aa58a7"><p id="d2e717f0"><a href="ldap-integration.html">LDAP</a>相关日志</p></td></tr><tr id="2c76254a" class="ijRowOdd"><td id="c7612331"><p id="821edaed"><code class="code">teamcity-nuget.log</code></p></td><td id="531eda72"><p id="47f39ecf"><a href="nuget.html">NuGet</a>相关的日志</p></td></tr><tr id="f3bc4310" class="ijRowEven"><td id="47cc327b"><p id="9db82035"><code class="code">teamcity-maintenance.log</code></p></td><td id="8e73e021"><p id="3cd3cdef">（默认为关闭）使用<a href="migrating-to-an-external-database.html#Full-Migration">maintainDB工具</a>执行的备份/还原/迁移日志</p></td></tr><tr id="ffa5b678" class="ijRowOdd"><td id="d7b6eb9a"><p id="a1c7808e"><code class="code">teamcity-maintenance-truncation.log</code></p></td><td id="16a7c4ed"><p id="06f69023">（默认情况下为关闭）包含有关通过<a href="migrating-to-an-external-database.html">maintainDB工具</a>执行的备份/还原/迁移期间可能的数据截断的扩展信息</p></td></tr><tr id="5ad0a85a" class="ijRowEven"><td id="08b1bfaa"><p id="d53b7576"><code class="code">teamcity-versioned-settings.log</code></p></td><td id="fb17079c"><p id="4ececc86">（默认关闭）包含有关<a href="storing-project-settings-in-version-control.html">项目设置</a>与版本控件<a href="storing-project-settings-in-version-control.html">同步的</a>信息</p></td></tr><tr id="f5e247f3" class="ijRowOdd"><td id="2c15c656"><p id="5a381c15"><code class="code">teamcity-ws.log</code></p></td><td id="4857c4c2"><p id="fad94219">与使用<a href="server-health.html#WebSocket-connection-issues">WebSocket连接的</a>浏览器和TeamCity服务器之间的通信有关的日志</p></td></tr><tr id="95459dcf" class="ijRowEven"><td id="c0b7b4de"><p id="cbc32dd7"><code class="code">teamcity-issue-trackers.log</code></p></td><td id="d3f8915f"><p id="36c071e8">与TeamCity和已配置的<a href="integrating-teamcity-with-issue-tracker.html">问题跟踪器</a>之间的通信有关的日志</p></td></tr></tbody></table></div><p id="8e0bd0c7">也可以在<a href="#Changing-Logging-Configuration">更改“日志记录配置”时</a>创建其他文件。</p><p id="9bb37123">一些文件可以有<code class="code">.N</code>扩展名-带有先前日志记录消息的文件，这些消息在主文件旋转时复制。看到<a href="#Changing-Logging-Settings"><code class="code">maxBackupIndex</code></a>用于保存更多文件。</p></div><a name="Logging-relatedDiagnosticsUI"></a><a name="Logging-related-Diagnostics-UI"></a><div class="chapter"><h2 id="TeamCityServerLogs-Logging-relatedDiagnosticsUI">与记录相关的诊断UI</h2><p id="5b5d5583">具有系统管理员角色的用户可以使用“ <b id="bf87c093">管理” |“管理” |“</b>直接从TeamCity UI中查看和下载服务器日志” <b id="bf87c093">。诊断|服务器日志</b> 。</p></div><a name="ChangingLoggingConfiguration"></a><a name="Changing-Logging-Configuration"></a><div class="chapter"><h2 id="TeamCityServerLogs-ChangingLoggingConfiguration">更改日志记录配置</h2><p id="49efc50a">在TeamCity运行时，可以通过在可用的之间进行选择来更改活动的日志记录设置<code class="code">logging presets</code> 。</p><p id="2758a47f">活动的日志记录预设在“ <b id="9380e1b6">管理” |</b> “ <b id="9380e1b6">管理”</b>中进行了更改。 <b id="9380e1b6">诊断</b>页面， <b id="8931e4df">疑难解答</b> ， <b id="5a4720af">调试日志记录</b>小节。选择一个预设会立即更改日志记录配置，并在服务器重新启动后保留该预设，直到再次在页面上更改该预设为止。<default>一旦收集到必要的日志，</default>建议返回到“ <default>”。</default></p><p id="8196f781">可用的预设存储在扩展名为.xml的文件中，位于<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/_logging</code>目录。可以将新文件添加到目录中，并且可以修改现有文件（使用<a href="teamcity-data-directory.html#.dist-Template-Configuration-Files">.dist约定</a> ）。新的预设也可以通过<b id="fc95d6c2">Diagnostics |记录预设</b> 。</p><p id="55765e45">如果无法通过日志记录预设启用调试日志记录模式（例如，在服务器初始化期间获取日志记录）或对日志记录进行永久更改，则可以备份<code class="code">conf/teamcity-server-log4j.xml</code>文件并复制/重命名<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/_logging/debug-general.xml</code>归档<code class="code">conf/teamcity-server-log4j.xml</code>服务器启动之前。</p><a name="ChangingLoggingSettings"></a><a name="Changing-Logging-Settings"></a><div class="chapter"><h3 id="TeamCityServerLogs-ChangingLoggingSettings">更改记录设置</h3><p id="0d33c727">如果要微调log4j配置，可以编辑<code class="code"><</code> <a href="teamcity-home-directory.html"><code class="code">TeamCity Server home</code></a> <code class="code">>/conf/teamcity-server-log4j.xml</code>文件（用于<code class="code">.war</code> TeamCity分发，请参阅<a href="#General-Logging-Configuration">相关部分</a> ）。如果服务器正在运行，则log4j配置文件将自动重新加载，并且日志记录配置将即时更改（某些log4j限制仍然适用，因此，要进行大量更改，请考虑重新启动服务器）。</p><p id="39be0ca1">log4j配置的最有用的设置：<br>要更改保存在文件中的最低日志级别，请调整<code class="code">value</code>的属性<code class="code">priority</code>元件：</p><div class="code-block" data-lang="none"><category ...="">
    <priority value="INFO"></priority> ...

</category></div><p id="a7117287">默认情况下轮换日志。启用调试后，增加<code class="code">value</code>的属性<code class="code">maxBackupIndex</code>影响保留日志文件数量的元素。这样做时，请确保有足够的可用磁盘空间。</p><div class="code-block" data-lang="none"><appender ...="">
    <param name="maxBackupIndex" value="10"> ...

</appender></div><p id="dcb29922">有关的详细说明<code class="code">maxBackupIndex</code>和其他受支持的属性，请参阅Apache文档中的<a href="http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/RollingFileAppender.html" rel="noopener noreferrer" data-external="true" target="_blank">Class RollingFileAppender</a> 。</p></div></div><a name="ReadingLogs"></a><a name="Reading-Logs"></a><div class="chapter"><h2 id="TeamCityServerLogs-ReadingLogs">阅读日志</h2><p id="f03f6f37">每个消息都有一个时间戳和级别（ <code class="code">ERROR</code> ， <code class="code">WARN</code> ， <code class="code">INFO</code> ， <code class="code">DEBUG</code> ）。</p><p id="10907c0d">例：</p><div class="code-block" data-lang="bash">[2010-11-19 23：22：35,657]信息-s.buildServer。服务器-代理vmWin2k3-3已注册ID为19，未运行构建</div><ul class="list _ul"><li class="list__item" id="29ebca4f"><p><code class="code">ERROR</code>表示操作失败，某些数据丢失或未执行操作。通常，日志中应该没有错误。</p></li><li class="list__item" id="6206fced"><p><code class="code">WARN</code>通常表示操作失败，但是将重试或认为该操作不重要。一定数量的警告是可以的。但是，您可以查看日志中的此类警告，以更好地了解正常情况和不正常情况。</p></li><li class="list__item" id="676c74a8"><p><code class="code">INFO</code>是一条信息性消息，仅报告当前活动。</p></li><li class="list__item" id="ee14211d"><p><code class="code">DEBUG</code>仅对问题调查有用，例如，由TeamCity开发人员进行分析。</p></li></ul><a name="GeneralLoggingConfiguration"></a><a name="General-Logging-Configuration"></a><div class="chapter"><h3 id="TeamCityServerLogs-GeneralLoggingConfiguration">常规记录配置</h3><p id="7287b796">通过默认，TeamCity在以下位置搜索log4j配置： <code class="code">.../conf/teamcity-server-log4j.xml</code>文件（此解析为<code class="code"><</code> <a href="teamcity-home-directory.html"><code class="code">TeamCity Server home</code></a> <code class="code">>/conf/teamcity-server-log4j.xml</code>对于TeamCity <code class="code">.exe</code>和<code class="code">.tar.gz</code>运行时的分布<code class="code">bin</code> ）。如果不存在此类文件，则使用默认的log4j配置。日志保存到<code class="code">../logs</code>目录默认情况下。</p><p id="3b53715c">可以通过相应的配置选项值进行更改<code class="code">log4j.configuration</code>和<code class="code">teamcity_logs</code> JVM选项或<a href="configuring-teamcity-server-startup-properties.html">内部属性</a> 。<br>例如： <code class="code">log4j.configuration=file:../conf/teamcity-server-log4j.xml</code>和<code class="code">teamcity_logs=../logs/</code> 。<br>可以在<code class="code">bin/teamcity-server</code> .exe和tar.gz发行版中可用的脚本。</p><p id="c32ee060">如果您通过捆绑方式以外的其他方式启动TeamCity <code class="code">teamcity-server</code>要么<code class="code">runAll</code>脚本，请确保将上述选项传递给服务器JVM。又见<a href="installing-and-configuring-the-teamcity-server.html">建议</a>上安装的TeamCity到非绑定的Web服务器。</p><p id="d84353e3">默认值<code class="code">teamcity-server-log4j.xml</code>文件内容可以在<code class="code">.exe</code>和<code class="code">tar.gz</code>分布。启用调试的可以在下面找到<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/_logging/debug-general.xml</code>服务器首次启动后的名称。另请参阅示例<a href="https://confluence.jetbrains.com/download/attachments/113084044/teamcity-server-log4j.xml?version=1&modificationDate=1362486616000&api=v2" rel="noopener noreferrer" data-external="true" target="_blank">teamcity-server-log4j.xml</a>文件。</p><hr id="48d6157c"><p id="87a81a1f"><b id="c4eb933a">也可以看看：</b></p><p id="d2c90d51"><b id="8b7bf85d">管理员指南</b> ： <a href="viewing-build-agent-logs.html">查看生成代理日志</a><br><b id="b99b9735">故障排除</b> ： <a href="reporting-issues.html">报告问题</a></p><hr id="a5218e26"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>