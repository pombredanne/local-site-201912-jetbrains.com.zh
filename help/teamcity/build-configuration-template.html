<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Build Configuration Template - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Build Configuration Template" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/build-configuration-template.md|Build Configuration Template" data-main-title="Build Configuration Template" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-configuration-template.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Build Configuration Template" id="build-configuration-template.md">Build Configuration Template</h1><p id="1bca5af5"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildConfigurationTemplate-Overview">Overview</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Creatingbuildconfigurationtemplate">Creating build configuration template</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Definingdefaulttemplateforproject">Defining default template for project</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Relatedsettingschanges">Related settings changes</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Associatingbuildconfigurationswithtemplates">Associating build configurations with templates</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Associatingbuildconfigurationwithmultipletemplates">Associating build configuration with multiple templates</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Relatedsettingschanges2">Related settings changes</a></li></ul></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Detachingbuildconfigurationsfromtemplate">Detaching build configurations from template</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Redefiningsettingsinheritedfromtemplate">Redefining settings inherited from template</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Usingparameterreference">Using parameter reference</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Exampleofconfigurationparametersusage">Example of configuration parameters usage</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Abilitytohavepre-andpost-stepsinatemplate">Ability to have pre- and post-steps in a template</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Enforcingsettingsinheritedfromtemplate">Enforcing settings inherited from template</a></li></ul></p><a name="Overview"></a><a name="Overview"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Overview">Overview</h2><p id="468a349e"><i id="4a55bdb4">Build configuration templates</i> allow you to eliminate duplication of build configuration settings. If you want to have several similar (not necessarily identical) build configurations and be able to modify their common settings in one place without having to edit each configuration, create a build configuration template with those settings. Modifying template settings affects <b id="8d18c442">all</b> build configurations associated with this template.</p><p id="86af7320">It is possible to define a default template in a project for all build configurations in this project and its subprojects. The <a href="#Defining-default-template-for-project">section below</a> contains details.</p><p id="0d7e050e">Build configuration templates support project hierarchy: once created, available templates include the ones from the current project and its parents. On copying a project or a build configuration, the templates that do not belong to the target project or one of its parents are automatically copied. You can associate a build configuration with a template only if the template belongs to the current project or one of its parents.</p></div><a name="Creatingbuildconfigurationtemplate"></a><a name="Creating-build-configuration-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Creatingbuildconfigurationtemplate">Creating build configuration template</h2><p id="69f76968">There are several ways to create a build configuration template:</p><ul class="list _ul"><li class="list__item" id="8b85aae6"><p><b id="7b240caa">Manually</b>, like a <a href="creating-and-editing-build-configurations.html#Creating-Build-Configuration-Template">regular build configuration</a>.</p></li><li class="list__item" id="80163d45"><p><b id="947e9c0c">Extract</b> from an existing build configuration: there is the <b id="9048969b">Extract template</b> option available from the <b id="bf12491e">Actions</b> button at the top right corner of the screen. Note that if you extract a template from a build configuration, the original configuration automatically becomes <a href="#Associating-build-configurations-with-templates">associated</a> with the newly created template.</p></li></ul></div><a name="Definingdefaulttemplateforproject"></a><a name="Defining-default-template-for-project"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Definingdefaulttemplateforproject">Defining default template for project</h2><p id="7c9559da">Default templates allow affecting all build configurations in this project and its subprojects.</p><p id="deff9fc7">You can associate all the build configurations of the project with a default template using the <b id="64700c46">General Settings</b> page of the project administration, by selecting a template from the  <b id="72d8bc25">Default template</b> drop-down menu. The option is available if at least one template is defined in the project or its parent. All new build configurations will inherit the default template settings.</p><p id="75d27468">The settings of the existing configurations will be preserved.</p><p id="a2015331">When defined, the default template affects all build configurations and subprojects of this project unless other default templates are defined in subprojects. With default templates, you can easily modify all project's build configurations, for example:</p><ul class="list _ul"><li class="list__item" id="4b6c4d71"><p>add a specific build feature to all build configurations of a project</p></li><li class="list__item" id="af666a16"><p>switch all build configurations to some specific checkout mode</p></li><li class="list__item" id="94f1d735"><p>provide a default failure condition</p></li></ul><a name="Relatedsettingschanges"></a><a name="Related-settings-changes"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Relatedsettingschanges">Related settings changes</h3><p id="7666e61e">The project configuration schema accommodates for default templates.</p><ul class="list _ul"><li class="list__item" id="6f3ca1c2"><p>XML: The <code class="code">project-config.xml</code> file contains the <code class="code">&lt;default-template ref="...." /&gt;</code> element.</p></li><li class="list__item" id="85f87576"><p>DSL: Project configuration contains the <code class="code">defaultTemplate = "..."</code> method. See a sample project configuration with a default template configured:</p></li></ul><div class="code-block" data-lang="bash">object Project : Project({
&nbsp;&nbsp;&nbsp;&nbsp;uuid = "2b241ffb-9019-4e60-9a3a-d5475ab1f312"
&nbsp;&nbsp;&nbsp;&nbsp;extId = "ExampleProject"
&nbsp;&nbsp;&nbsp;&nbsp;parentId = "_Root"
&nbsp;&nbsp;&nbsp;&nbsp;name = "Example Project"
&nbsp;&nbsp;&nbsp;&nbsp;defaultTemplate = "ExampleProject_MyDefaultTemplate"
&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;features {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;...
})

</div></div></div><a name="Associatingbuildconfigurationswithtemplates"></a><a name="Associating-build-configurations-with-templates"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Associatingbuildconfigurationswithtemplates">Associating build configurations with templates</h2><ul class="list _ul"><li class="list__item" id="dce54daf"><p>You can <a href="creating-and-editing-build-configurations.html#Creating-Build-Configuration-From-Template">create new build configurations based on a template</a>.</p></li><li class="list__item" id="7430aa63"><p>You can associate/attach any number of existing build configurations with/to a template: there is the <b id="941e97a2">Attach to template</b> option available from the <b id="18d370f2">Actions</b> button in the upper right corner of the screen.</p></li></ul><p id="dc23a48d">When you associate an existing build configuration with a template, the build configuration inherits <b id="a4c3ea79">all the settings</b> defined in the template, and if there is a conflict, the template settings supersede the settings of the build configuration (except dependencies, parameters, and requirements). The settings inherited from a template <a href="#Redefining-settings-inherited-from-template">can be overridden</a>.</p><p id="e58678ea">You can associate a build configuration to a template only if the template belongs to the current project or one of its parents. A template which has at least one associated build configuration cannot be deleted, the associated build configurations need to be detached first.</p><p id="29ffa074">It is also possible to associate a build configuration with multiple templates.</p><a name="Associatingbuildconfigurationwithmultipletemplates"></a><a name="Associating-build-configuration-with-multiple-templates"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Associatingbuildconfigurationwithmultipletemplates">Associating build configuration with multiple templates</h3><p id="4accb06d">A build configuration can be attached to multiple templates using the <i id="2f01b02e">Attach to template</i> action menu. In the <b id="b7487262">Actions</b> menu, the <b id="db79cf73">Manage templates</b> action allows users to:</p><ul class="list _ul"><li class="list__item" id="7a1238a1"><p>change the order of templates, which affects the overlapping settings priority and the build step order: the priority is given to the settings from the template higher in the list. It affects such entities as parameter names, setting IDs (for build steps, triggers, features, artifact dependencies, and requirements), VCS roots or snapshot dependency source build configurations IDs if they overlap between templates attached to a build configuration.</p></li><li class="list__item" id="3403b731"><p>detach the build configuration from some of the templates (the user marks those to be detached and then has to apply their changes).</p></li><li class="list__item" id="2f45cee9"><p>detach the build configuration from all templates using the respectively named button in the same dialog window.</p></li></ul><p id="2843016a">You can view all the templates attached to a build configuration on the <b id="7c0d29d2">Build Configuration Settings</b> page.</p><p id="fca2c779">The settings from all templates the build configuration is attached to are inherited and you can view where they are inherited from in the view/edit <b id="1ba863df">Build Configuration Settings</b> pages.</p><p id="1fbe00ad">When a build configuration is detached from some of its templates, all the effective (that is not overridden in the config and not overlapped by some higher priority template) settings inherited from them are copied to the configuration. The copying build configuration logic is the same as extracting a template. On moving a build configuration/project, the logic checks all templates to which the build configuration is attached.</p><a name="Relatedsettingschanges"></a><a name="Related-settings-changes"></a><div class="chapter"><h4 id="BuildConfigurationTemplate-Relatedsettingschanges2">Related settings changes</h4><ul class="list _ul"><li class="list__item" id="41279403"><p>XML: If a build configuration is attached to a single template, the resulting config XML format stays the same as it was before (<code class="code">ref</code> attribute of the <code class="code">settings</code> element). If it is attached to a number of templates, then references to them are stored in a separate element under the <code class="code">settings</code> node, as follows:</p></li></ul><div class="code-block" data-lang="none">
&lt;inherits&gt;
&lt;ref id="Template1_ExternalId" /&gt;
&lt;ref id="Template2_ExternalId /&gt;
.....
&lt;/inherits&gt;

</div><ul class="list _ul"><li class="list__item" id="885ac72e"><p>DSL: Kotlin DSL is extended, so within a build configuration definition users can use the <code class="code">templates(vararg)</code> method accepting either external ids or DSL template instances (but not a mix of them, so if both templates defined inside and outside DSL are used in the same configuration, the external ids of both must be used).The older <code class="code">template(...)</code> method and property <b id="a2cd029e">cannot</b> be used multiple times within the same build type definition to indicate that it is inherited from multiple templates: following earlier implementation, each time this method is used, it overrides the previous template external ID. It is preserved for backward compatibility.</p></li></ul></div></div></div><a name="Detachingbuildconfigurationsfromtemplate"></a><a name="Detaching-build-configurations-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Detachingbuildconfigurationsfromtemplate">Detaching build configurations from template</h2><p id="72dfaffa">When you <i id="30d77855">detach a build configuration from a template</i> using the <b id="6698420e">Detach from template</b> option available in the <b id="87499826">Actions</b> menu of the <b id="7be65250">Build Configuration Settings</b> page, all settings from the template will be copied to the build configuration and enabled for editing.</p></div><a name="Redefiningsettingsinheritedfromtemplate"></a><a name="Redefining-settings-inherited-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Redefiningsettingsinheritedfromtemplate">Redefining settings inherited from template</h2><p id="deb98031">A build configuration associated with a template inherits all its settings (marked as <i id="5259bfc8">inherited</i> in the UI). Inherited settings cannot be deleted from an associated build configuration, but the inherited build steps, triggers, build features, failure conditions, artifact dependencies, and agent requirements can be disabled in it.</p><p id="588e92d3">Modifying settings in the template will influence <b id="a22b9da5">all configurations</b> associated with this template; however, it is possible to redefine most settings in an associated build configuration.</p><p id="6fb083c6">You can redefine almost all the build configuration settings (for example, build steps, <a href="configuring-build-parameters.html">parameters</a>, <a href="configuring-general-settings.html#Build-Options">build options</a>). The only exceptions are snapshot dependecies and checkout rules which <b id="f8988748">cannot be redefined</b>.</p><p id="504ba7a5">Modified settings are highlighted with a yellow border, and the <b id="fbed8d2b">Reset</b> button appears on the right of the modified settings enabling you to revert the changes to the original settings of the template.</p><p id="51356403">Note that if you redefine an inherited parameter in a build configuration, it will be saved with the inherited name and the new value. If you then rename this parameter in the template, you will end up with two parameters in the build configuration: the one with the original name and the redefined value, and the renamed one inherited from the template.</p><a name="Usingparameterreference"></a><a name="Using-parameter-reference"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Usingparameterreference">Using parameter reference</h3><p id="02331d0d">Beside redefining settings as described above, you can redefine inidividual fields of the inherited settings via parameter references.</p><p id="8b27044b">To introduce a configuration parameter reference, use the <code class="code">%ParameterName%</code> syntax in the template text field. Once introduced, this parameter appears on the <b id="3b07cd46">Parameters</b> page of the build configuration template marked as requiring a value.</p><p id="53a76858">You can either specify the parameter's default value or leave it without any value. You can then define the actual value for the parameter in a build configuration associated with the template.</p><p id="b6c217ff">See also <a href="configuring-build-parameters.html">Configuring Build Parameters</a>.</p><a name="Exampleofconfigurationparametersusage"></a><a name="Example-of-configuration-parameters-usage"></a><div class="chapter"><h4 id="BuildConfigurationTemplate-Exampleofconfigurationparametersusage">Example of configuration parameters usage</h4><p id="3544a2f4">Assume that you have two similar build configurations that differ only by checkout rules. For instance, checkout rules for the first configuration should contain <code class="code">+:release_1_0 =&gt; .</code> and for the second one <code class="code">+:trunk =&gt; .</code>. All other settings are equal. It would be useful to have one template to associate with both build configurations, but this means changing the checkout rules in each build configuration separately.</p><p id="4c80e7c3">To do so, perform the following steps:</p><ol class="list _decimal"><li class="list__item" id="62c83879"><p>Extract a template from one of those configurations.</p></li><li class="list__item" id="5fc4c8ec"><p>In the template settings, navigate to <b id="27922df3">Version Control Settings</b>, open the <b id="515f4e8e">Checkout rules</b> dialog for the VCS root, and enter there: <code class="code">%checkout.rules%</code></p></li><li class="list__item" id="b466a450"><p>For the inherited build configuration, open the configuration settings page and on the <b id="be3ee882">Parameters</b> page specify the actual value for the <code class="code">checkout.rules</code> configuration parameter.</p></li><li class="list__item" id="27847fb1"><p>For the second build configuration, use the <b id="c5f2d9b0">Associate with template</b> option from <b id="9b2254c2">Actions</b> and choose the template. Specify an appropriate value for the <code class="code">checkout.rules</code> parameter right in the "Associate with Template" dialog. Click <b id="edf3b4ac">Associate</b>.</p></li></ol><p id="4fbecbd4">As a result, you'll have two build configurations with different checkout rules, but associated with one template.</p><p id="fd25b61b">This way you can create a configuration parameter and then reference it from any build configuration, which has a text field.</p></div></div><a name="Abilitytohavepre-andpost-stepsinatemplate"></a><a name="Ability-to-have-pre--and-post-steps-in-a-template"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Abilitytohavepre-andpost-stepsinatemplate">Ability to have pre- and post-steps in a template</h3><p id="ae252df1">There is sometimes a need to define a common build step in a template, so that this step will be executed either before all build configuration steps or after them.<br>For a given template, it is possible to define such steps and then define their placement in respect to the build configuration steps. All build configuration steps are represented as a placeholder in the <i id="a6655de8">Reorder Build Steps</i> dialog. The template steps can be placed before and/or after this placeholder.</p><p id="57be3f89"><figure><img alt="Reorder build steps" title="Reorder build steps" src="/help/img/teamcity/2019.1/reorder-build-steps.png" id="4f52e070" width="544" height="502"></figure></p><p id="497de958">You can still customize the order of build steps in a template-based build configuration if necessary:</p><ul class="list _ul"><li class="list__item" id="2a4c0e83"><p>Using the TeamCity web UI, it is possible to change the placement of the build configuration steps in respect to the template steps.</p></li><li class="list__item" id="9fac856a"><p>Using <a href="storing-project-settings-in-version-control.html">versioned settings</a>, it is possible to change not only the placement of the build configuration steps in respect to the template steps, but also to reorder the steps of the template itself.</p></li></ul></div></div><a name="Enforcingsettingsinheritedfromtemplate"></a><a name="Enforcing-settings-inherited-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Enforcingsettingsinheritedfromtemplate">Enforcing settings inherited from template</h2><p id="48835e5f">If you want to enforce some settings on all the build configurations in the project so that other users could not redefine them, TeamCity provides this ability for all of the build configurations in a project hierarchy. For instance, using enforced settings it is possible to set <a href="vcs-checkout-mode.html">agent side checkout</a> everywhere, or ensure that all build configurations have some strict <a href="build-failure-conditions.html#Common-build-failure-conditions">execution timeout</a>. Currently, it is possible to enforce build features, options, and parameters. Build steps and build requirements can also be enforced.</p><p id="c3cef1a3">To enforce some settings in the project hierarchy, create a template with these settings. After that, a system administrator can set this template as the enforced settings template in the project:</p><p id="ce4d390c"><figure><img alt="Enforced settings template" title="Enforced settings template" src="/help/img/teamcity/2019.1/enforced-settings-template.png" id="6e031395" width="1164" height="731"></figure></p><p id="c9cb3d04">The enforced settings template is similar to the default template as all of its settings are inherited in build configurations of the project hierarchy. The difference is that these inherited settings cannot be disabled or overridden.</p><p id="bf516837">The system administrator role is required to associate a project with a specific enforced settings template. The template itself can be edited by a project administrator who can administer the project where the template is defined.</p><p id="819a7b75">If the enforced settings template is specified in a project and a different template is assigned as the enforced settings in a subproject, the template of the subproject will have a higher priority.</p><hr id="48aaa824"><p id="636b0ade"><b id="3070c982">See also:</b></p><p id="e5c60f64"><b id="c899b725">Administrator's Guide</b>: <a href="creating-and-editing-build-configurations.html">Creating and Editing Build Configurations</a> | <a href="configuring-build-parameters.html">Configuring Build Parameters</a></p><hr id="86b5f2c2"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>