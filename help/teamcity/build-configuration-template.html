<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>构建配置模板-帮助|帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Build Configuration Template" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/build-configuration-template.md|Build Configuration Template" data-main-title="Build Configuration Template" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-configuration-template.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-configuration-template.md" data-toc="Build Configuration Template">构建配置模板</h1><p id="1bca5af5"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildConfigurationTemplate-Overview">总览</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Creatingbuildconfigurationtemplate">创建构建配置模板</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Definingdefaulttemplateforproject">定义项目的默认模板</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Relatedsettingschanges">相关设置更改</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Associatingbuildconfigurationswithtemplates">将构建配置与模板相关联</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Associatingbuildconfigurationwithmultipletemplates">将构建配置与多个模板相关联</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Relatedsettingschanges2">相关设置更改</a></li></ul></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Detachingbuildconfigurationsfromtemplate">从模板分离构建配置</a></li><li class="list__item"><a href="#BuildConfigurationTemplate-Redefiningsettingsinheritedfromtemplate">重新定义从模板继承的设置</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Usingparameterreference">使用参数参考</a><ul class="list _bullet"><li class="list__item"><a href="#BuildConfigurationTemplate-Exampleofconfigurationparametersusage">配置参数用法示例</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Abilitytohavepre-andpost-stepsinatemplate">能够在模板中包含前步骤和后步骤</a></li></ul></li><li class="list__item"><a href="#BuildConfigurationTemplate-Enforcingsettingsinheritedfromtemplate">强制执行从模板继承的设置</a></li></ul><p></p><a name="Overview"></a><a name="Overview"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Overview">总览</h2><p id="468a349e"><i id="4a55bdb4">构建配置模板</i>使您可以消除重复的构建配置设置。如果要具有多个相似（不一定相同）的构建配置，并且能够在一个地方修改它们的公共设置而不必编辑每个配置，请使用这些设置创建一个构建配置模板。修改模板设置会影响与此模板关联的<b id="8d18c442">所有</b>构建配置。</p><p id="86af7320">可以在项目中为该项目及其子项目中的所有构建配置定义默认模板。以下<a href="#Defining-default-template-for-project">部分</a>包含详细信息。</p><p id="0d7e050e">构建配置模板支持项目层次结构：创建后，可用的模板包括当前项目及其父项目中的模板。复制项目或构建配置时，将自动复制不属于目标项目或其父项之一的模板。仅当模板属于当前项目或其父项之一时，才能将构建配置与模板关联。</p></div><a name="Creatingbuildconfigurationtemplate"></a><a name="Creating-build-configuration-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Creatingbuildconfigurationtemplate">创建构建配置模板</h2><p id="69f76968">有几种创建构建配置模板的方法：</p><ul class="list _ul"><li class="list__item" id="8b85aae6"><p><b id="7b240caa">手动进行</b> ，就像<a href="creating-and-editing-build-configurations.html#Creating-Build-Configuration-Template">常规的构建配置一样</a> 。</p></li><li class="list__item" id="80163d45"><p>从现有的构建配置<b id="947e9c0c">精华</b> ：有在屏幕的右上角可以从<b id="bf12491e">操作</b>按钮<b id="9048969b">提取模板</b>选项。请注意，如果您从构建配置中提取模板，则原始配置会自动与新创建的模板<a href="#Associating-build-configurations-with-templates">相关联</a> 。</p></li></ul></div><a name="Definingdefaulttemplateforproject"></a><a name="Defining-default-template-for-project"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Definingdefaulttemplateforproject">定义项目的默认模板</h2><p id="7c9559da">默认模板允许影响此项目及其子项目中的所有构建配置。</p><p id="deff9fc7">您可以使用项目管理的“ <b id="64700c46">常规设置”</b>页面，通过从“ <b id="72d8bc25">默认模板”</b>下拉菜单中选择一个模板，将项目的所有构建配置与默认模板相关联。如果在项目或其父项中定义了至少一个模板，则该选项可用。所有新的构建配置都将继承默认模板设置。</p><p id="75d27468">现有配置的设置将保留。</p><p id="a2015331">定义后，默认模板会影响该项目的所有构建配置和子项目，除非在子项目中定义了其他默认模板。使用默认模板，您可以轻松修改所有项目的构建配置，例如：</p><ul class="list _ul"><li class="list__item" id="4b6c4d71"><p>向项目的所有构建配置中添加特定的构建功能</p></li><li class="list__item" id="af666a16"><p>将所有构建配置切换到某些特定的检出模式</p></li><li class="list__item" id="94f1d735"><p>提供默认的失败条件</p></li></ul><a name="Relatedsettingschanges"></a><a name="Related-settings-changes"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Relatedsettingschanges">相关设置更改</h3><p id="7666e61e">项目配置架构可容纳默认模板。</p><ul class="list _ul"><li class="list__item" id="6f3ca1c2"><p>XML： <code class="code">project-config.xml</code>文件包含<code class="code"><default-template ref="...." /></code>元件。</p></li><li class="list__item" id="85f87576"><p>DSL：项目配置包含<code class="code">defaultTemplate = "..."</code>方法。查看配置了默认模板的示例项目配置：</p></li></ul><div class="code-block" data-lang="bash">对象项目：Project（{uuid =“ 2b241ffb-9019-4e60-9a3a-d5475ab1f312” extId =“ ExampleProject” parentId =“ _Root”名称=“示例项目” defaultTemplate =“ ExampleProject_MyDefaultTemplate” ...特征 {         ...} ...}）</div></div></div><a name="Associatingbuildconfigurationswithtemplates"></a><a name="Associating-build-configurations-with-templates"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Associatingbuildconfigurationswithtemplates">将构建配置与模板相关联</h2><ul class="list _ul"><li class="list__item" id="dce54daf"><p>您可以<a href="creating-and-editing-build-configurations.html#Creating-Build-Configuration-From-Template">基于模板创建新的构建配置</a> 。</p></li><li class="list__item" id="7430aa63"><p>您可以将任意数量的现有构建配置与模板关联/附加：屏幕右上角的“ <b id="18d370f2">操作”</b>按钮提供了“ <b id="941e97a2">附加到模板”</b>选项。</p></li></ul><p id="dc23a48d">将现有构建配置与模板关联时，构建配置会继承模板中定义的<b id="a4c3ea79">所有设置</b> ，并且如果存在冲突，则模板设置将取代构建配置的设置（依赖项，参数和要求除外）。从模板继承的设置<a href="#Redefining-settings-inherited-from-template">可以被覆盖</a> 。</p><p id="e58678ea">仅当模板属于当前项目或其父项之一时，才可以将构建配置与模板关联。具有至少一个相关联的构建配置的模板无法删除，相关联的构建配置需要首先分离。</p><p id="29ffa074">也可以将构建配置与多个模板相关联。</p><a name="Associatingbuildconfigurationwithmultipletemplates"></a><a name="Associating-build-configuration-with-multiple-templates"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Associatingbuildconfigurationwithmultipletemplates">将构建配置与多个模板相关联</h3><p id="4accb06d">可以使用“ <i id="2f01b02e">附加到模板”</i>操作菜单<i id="2f01b02e">将</i>构建配置附加到多个模板。在“ <b id="b7487262">操作”</b>菜单中，“ <b id="db79cf73">管理模板”</b>操作使用户可以：</p><ul class="list _ul"><li class="list__item" id="7a1238a1"><p>更改模板的顺序，这会影响重叠设置的优先级和构建步骤的顺序：优先级从列表中较高的模板开始赋予设置。它会影响诸如参数名称，设置ID（用于构建步骤，触发器，功能，工件依赖关系和要求），VCS根目录或快照依赖关系源构建配置ID等实体，如果它们在附加到构建配置的模板之间重叠。</p></li><li class="list__item" id="3403b731"><p>将构建配置与某些模板分离（用户将其标记为要分离，然后必须应用其更改）。</p></li><li class="list__item" id="2f45cee9"><p>使用同一对话框窗口中分别命名的按钮将构建配置与所有模板分离。</p></li></ul><p id="2843016a">您可以在“ <b id="7c0d29d2">构建配置设置”</b>页面上查看附加到构建配置的所有模板。</p><p id="fca2c779">构建配置所附加的所有模板中的设置都是继承的，您可以在“查看/编辑<b id="1ba863df">构建配置设置”</b>页面中查看从中继承它们的位置。</p><p id="1fbe00ad">当构建配置与其某些模板分离时，将从它们继承的所有有效设置（在配置中不会被覆盖，也不会与更高优先级的模板重叠）都复制到配置中。复制构建配置逻辑与提取模板相同。移动构建配置/项目时，逻辑将检查与构建配置关联的所有模板。</p><a name="Relatedsettingschanges"></a><a name="Related-settings-changes"></a><div class="chapter"><h4 id="BuildConfigurationTemplate-Relatedsettingschanges2">相关设置更改</h4><ul class="list _ul"><li class="list__item" id="41279403"><p>XML：如果将构建配置附加到单个模板，则生成的config XML格式将与以前相同（ <code class="code">ref</code>的属性<code class="code">settings</code>元件）。如果将其附加到许多模板，则对它们的引用将存储在<code class="code">settings</code>节点，如下所示：</p></li></ul><div class="code-block" data-lang="none">
<inherits>
<ref id="Template1_ExternalId"></ref>
<ref id="Template2_ExternalId />
.....
</inherits>

</div><ul class=" list="" _u="="><li class="list__item" id="885ac72e"><p>DSL：Kotlin DSL已扩展，因此在构建配置定义中，用户可以使用<code class="code">templates(vararg)</code>接受外部ID或DSL模板实例（但不能混合使用）的方法（因此，如果在内部和外部DSL中定义的模板都在同一配置中使用，则必须使用这两个外部ID）。年长的<code class="code">template(...)</code>在同一构建类型定义中，方法和属性<b id="a2cd029e">不能</b>多次使用以指示它是从多个模板继承的：在较早的实现中，每次使用此方法时，它都会覆盖先前的模板外部ID。保留它是为了向后兼容。</p></li></ref></inherits></div></div></div><a name="Detachingbuildconfigurationsfromtemplate"></a><a name="Detaching-build-configurations-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Detachingbuildconfigurationsfromtemplate">从模板分离构建配置</h2><p id="72dfaffa">当您使用“ <b id="7be65250">构建配置设置”</b>页面的“ <b id="87499826">操作”</b>菜单中的“ <b id="6698420e">从模板分离”</b>选项<i id="30d77855">将构建配置与模板</i> <b id="6698420e">分离时，该模板</b>中的所有设置都将被复制到构建配置中并可以进行编辑。</p></div><a name="Redefiningsettingsinheritedfromtemplate"></a><a name="Redefining-settings-inherited-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Redefiningsettingsinheritedfromtemplate">重新定义从模板继承的设置</h2><p id="deb98031">与模板关联的构建配置将继承其所有设置（在UI中标记为<i id="5259bfc8">继承</i> ）。无法从关联的构建配置中删除继承的设置，但是可以在其中禁用继承的构建步骤，触发器，构建功能，故障条件，工件依赖关系和代理要求。</p><p id="588e92d3">修改模板中的设置将影响与此模板相关联的<b id="a22b9da5">所有配置</b> 。但是，可以在关联的构建配置中重新定义大多数设置。</p><p id="6fb083c6">您几乎可以重新定义所有构建配置设置（例如，构建步骤， <a href="configuring-build-parameters.html">参数</a> ， <a href="configuring-general-settings.html#Build-Options">构建选项</a> ）。唯一的例外是快照依赖项和<b id="f8988748">无法重新定义的</b>签出规则。</p><p id="504ba7a5">修改后的设置以黄色边框突出显示，并且“ <b id="fbed8d2b">重置”</b>按钮出现在修改后的设置的右侧，使您可以将更改恢复为模板的原始设置。</p><p id="51356403">请注意，如果您在构建配置中重新定义了继承的参数，它将与继承的名称和新值一起保存。如果您随后在模板中重命名此参数，则将在构建配置中得到两个参数：一个具有原始名称和重新定义的值，另一个是从模板继承的重命名的参数。</p><a name="Usingparameterreference"></a><a name="Using-parameter-reference"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Usingparameterreference">使用参数参考</h3><p id="02331d0d">除了如上所述重新定义设置外，您还可以通过参数引用重新定义继承设置的单个字段。</p><p id="8b27044b">要介绍配置参数参考，请使用<code class="code">%ParameterName%</code>模板文本字段中的语法。引入后，此参数将显示在构建配置模板的“ <b id="3b07cd46">参数”</b>页面上，标记为需要一个值。</p><p id="53a76858">您可以指定参数的默认值，也可以不使用任何值。然后，您可以在与模板关联的构建配置中为参数定义实际值。</p><p id="b6c217ff">另请参阅<a href="configuring-build-parameters.html">配置构建参数</a> 。</p><a name="Exampleofconfigurationparametersusage"></a><a name="Example-of-configuration-parameters-usage"></a><div class="chapter"><h4 id="BuildConfigurationTemplate-Exampleofconfigurationparametersusage">配置参数用法示例</h4><p id="3544a2f4">假设您有两个相似的构建配置，它们的区别仅在于签出规则。例如，第一个配置的签出规则应包含<code class="code">+:release_1_0 => .</code>第二个<code class="code">+:trunk => .</code> 。其他所有设置均相同。一个模板与两个构建配置相关联会很有用，但这意味着分别更改每个构建配置中的签出规则。</p><p id="4c80e7c3">为此，请执行以下步骤：</p><ol class="list _decimal"><li class="list__item" id="62c83879"><p>从这些配置之一中提取模板。</p></li><li class="list__item" id="5fc4c8ec"><p>在模板设置中，导航到“ <b id="27922df3">版本控制设置”</b> ，打开VCS根的“ <b id="515f4e8e">签出规则”</b>对话框，然后在其中输入：<code class="code">%checkout.rules%</code></p></li><li class="list__item" id="b466a450"><p>对于继承的构建配置，请打开“配置设置”页面，然后在“ <b id="be3ee882">参数”</b>页面上指定<code class="code">checkout.rules</code>配置参数。</p></li><li class="list__item" id="27847fb1"><p>对于第二个构建配置，请使用“ <b id="9b2254c2">操作”中的“</b> <b id="c5f2d9b0">与模板关联”</b>选项，然后选择模板。指定适当的值<code class="code">checkout.rules</code>参数直接在“与模板关联”对话框中。单击<b id="edf3b4ac">关联</b> 。</p></li></ol><p id="4fbecbd4">结果，您将拥有两种具有不同签出规则但与一个模板相关联的构建配置。</p><p id="fd25b61b">这样，您可以创建配置参数，然后从具有文本字段的任何构建配置中引用它。</p></div></div><a name="Abilitytohavepre-andpost-stepsinatemplate"></a><a name="Ability-to-have-pre--and-post-steps-in-a-template"></a><div class="chapter"><h3 id="BuildConfigurationTemplate-Abilitytohavepre-andpost-stepsinatemplate">能够在模板中包含前步骤和后步骤</h3><p id="ae252df1">有时需要在模板中定义一个通用的构建步骤，以便在所有构建配置步骤之前或之后执行该步骤。<br>对于给定的模板，可以定义这样的步骤，然后相对于构建配置步骤定义它们的位置。在“ <i id="a6655de8">重新排序构建步骤”</i>对话框中，所有构建配置步骤均表示为占位符。模板步骤可以放置在此占位符之前和/或之后。</p><p id="57be3f89"></p><figure><img alt="重新排序构建步骤" title="重新排序构建步骤" src="/help/img/teamcity/2019.1/reorder-build-steps.png" id="4f52e070" width="544" height="502"></figure><p></p><p id="497de958">如有必要，您仍然可以在基于模板的构建配置中自定义构建步骤的顺序：</p><ul class="list _ul"><li class="list__item" id="2a4c0e83"><p>使用TeamCity Web UI，可以相对于模板步骤更改构建配置步骤的位置。</p></li><li class="list__item" id="9fac856a"><p>使用<a href="storing-project-settings-in-version-control.html">版本设置</a> ，不仅可以相对于模板步骤更改构建配置步骤的位置，还可以对模板本身的步骤进行重新排序。</p></li></ul></div></div><a name="Enforcingsettingsinheritedfromtemplate"></a><a name="Enforcing-settings-inherited-from-template"></a><div class="chapter"><h2 id="BuildConfigurationTemplate-Enforcingsettingsinheritedfromtemplate">强制执行从模板继承的设置</h2><p id="48835e5f">如果要对项目中的所有构建配置强制执行某些设置，以使其他用户无法重新定义它们，则TeamCity为项目层次结构中的所有构建配置提供此功能。例如，使用强制设置，可以在任何地方设置<a href="vcs-checkout-mode.html">代理端检出</a> ，或者确保所有构建配置都具有严格的<a href="build-failure-conditions.html#Common-build-failure-conditions">执行超时</a> 。当前，可以强制执行构建功能，选项和参数。也可以强制执行构建步骤和构建要求。</p><p id="c3cef1a3">要在项目层次结构中强制执行某些设置，请使用这些设置创建模板。之后，系统管理员可以将此模板设置为项目中的强制设置模板：</p><p id="ce4d390c"></p><figure><img alt="强制设置模板" title="强制设置模板" src="/help/img/teamcity/2019.1/enforced-settings-template.png" id="6e031395" width="1164" height="731"></figure><p></p><p id="c9cb3d04">强制设置模板与默认模板类似，因为其所有设置都在项目层次结构的构建配置中继承。不同之处在于这些继承的设置不能被禁用或覆盖。</p><p id="bf516837">需要系统管理员角色才能将项目与特定的强制设置模板相关联。模板本身可以由项目管理员编辑，该管理员可以管理定义模板的项目。</p><p id="819a7b75">如果在项目中指定了强制设置模板，并且在子项目中将其他模板指定为强制设置，则子项目的模板将具有更高的优先级。</p><hr id="48aaa824"><p id="636b0ade"><b id="3070c982">也可以看看：</b></p><p id="e5c60f64"><b id="c899b725">管理员指南</b> ： <a href="creating-and-editing-build-configurations.html">创建和编辑内部配置</a> | <a href="configuring-build-parameters.html">配置构建参数</a></p><hr id="86b5f2c2"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>