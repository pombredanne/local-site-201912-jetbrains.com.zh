<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Git-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Git" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/configuring-vcs-settings.md|Configuring VCS Settings/configuring-vcs-roots.md|Configuring VCS Roots/git.md|Git/ssh-keys-management.md|SSH Keys Management" data-main-title="Git" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/git.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="git.md" data-toc="Git">吉特</h1><p id="0152d59f">TeamCity开箱即用地支持Git。支持使用Azure DevOps Services进行Git源代码控制（请参阅<a href="#Authenticating-to-Azure-DevOps-Services">下面的</a>身份验证说明）。</p><p id="30beed3f">此页面包含VCS根设置的特定于Git的字段的描述。<br>有关常见的VCS根属性，请参阅<a href="configuring-vcs-roots.html#Common-VCS-Root-Properties">本节</a> 。</p><aside class="note " rel="30beed3f" id="d5918f0e" data-title=""><p id="b715e2f8">如果使用<a href="vcs-checkout-mode.html#agent-checkout">代理端检出，</a>则需要在代理上安装Git命令行客户端。</p></aside><p id="fad3d960"><b id="14a7e8b8">重要说明</b> ：</p><ul class="list _ul"><li class="list__item" id="87b7b8a0"><p><a href="intellij-platform-plugin.html">IntelliJ IDEA</a>和<a href="eclipse-plugin.html">Eclipse</a>插件支持“ <a href="remote-run.html">远程运行”</a>和“ <a href="pre-tested-delayed-commit.html">预测试的提交”</a> 。与<a href="visual-studio-addin.html">Visual Studio插件一起</a>使用“ <a href="branch-remote-run-trigger.html">分支远程运行触发器”</a> 。</p></li><li class="list__item" id="19a46b67"><p>根据项目历史记录的大小，初始Git <a href="build-checkout-directory.html#Checkout-Process">签出</a>可能会花费大量时间（有时数小时），因为整个项目历史记录是在初始签出期间下载的。</p></li></ul><p id="13169c3c">在此页：</p><p id="a06af902"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Git-GeneralSettings">通用设置</a><ul class="list _bullet"><li class="list__item"><a href="#Git-BranchMatchingRules">分行匹配规则</a></li><li class="list__item"><a href="#Git-SupportedGitProtocols">支持的Git协议</a></li></ul></li><li class="list__item"><a href="#Git-AuthenticationSettings">验证设定</a></li><li class="list__item"><a href="#Git-AuthenticatingtoAzureDevOpsServices">向Azure DevOps Services进行身份验证</a><ul class="list _bullet"><li class="list__item"><a href="#Git-PersonalAccessTokens">个人访问令牌</a><ul class="list _bullet"><li class="list__item"><a href="#Git-RequiredAccessScope">所需的访问范围</a></li></ul></li><li class="list__item"><a href="#Git-AlternateAuthenticationCredentials">备用身份验证凭证</a></li></ul></li><li class="list__item"><a href="#Git-ServerSettings">服务器设定</a></li><li class="list__item"><a href="#Git-AgentSettings">代理设定</a><ul class="list _bullet"><li class="list__item"><a href="#Git-Gitexecutableontheagent">代理上的Git可执行文件</a></li></ul></li><li class="list__item"><a href="#Git-ConfiguringGitGarbageCollectiononServer">在服务器上配置Git垃圾收集</a></li><li class="list__item"><a href="#Git-GitLFS">Git LFS</a></li><li class="list__item"><a href="#Git-InternalProperties">内部性质</a></li><li class="list__item"><a href="#Git-Limitations">局限性</a></li><li class="list__item"><a href="#Git-KnownIssues">已知的问题</a></li><li class="list__item"><a href="#Git-DevelopmentLinks">开发链接</a></li></ul><p></p><a name="GeneralSettings"></a><a name="General-Settings"></a><div class="chapter"><h2 id="Git-GeneralSettings">通用设置</h2><div class="table-wrapper"><table width="100%" id="e53ccc21"><thead><tr id="aaf01484" class="ijRowHead"><th width="150" id="6874ca58"><p id="36e0ebd7">选项</p></th><th id="b28ce12f"><p id="399248da">描述</p></th></tr></thead><tbody><tr id="00d3e7ca" class="ijRowOdd"><td id="b89d78b1"><p id="62923ba1">提取网址</p></td><td id="2960eee9"><p id="e7065ecb">远程Git存储库的URL，用于从存储库中获取数据。</p></td></tr><tr id="ed03fccf" class="ijRowEven"><td id="f3c5be9a"><p id="55de179a">推送网址</p></td><td id="a0c45eec"><p id="666722e0">目标远程Git存储库的URL，用于将通过<a href="vcs-labeling.html">VCS标签</a>构建功能创建的带注释的标签推送到远程存储库。如果为空白，则使用获取URL。</p></td></tr><tr id="14bd5a16" class="ijRowOdd"><td id="e7523e77"><p id="cc9994db">默认分支</p></td><td id="f1c4646c"><a name="defaultBranch"></a><a name="Git-defaultBranch"></a><p id="e6b431ea">配置<a href="working-with-feature-branches.html#Default-branch">默认分支</a> 。这里支持参数引用。默认值为<code class="code">refs/heads/master</code> 。</p><aside class="note " rel="e6b431ea" id="aa6f3df0" data-title=""><p id="b549b1c1">您可以通过<a href="configuring-build-parameters.html#Defining-Build-Parameters-in-Build-Configuration">添加构建配置参数</a>来配置Git插件以获取所有磁头<code class="code">teamcity.git.fetchAllHeads=true</code> 。</p></aside></td></tr><tr id="9d92cef8" class="ijRowEven"><td id="f5899e1b"><p id="e92f4880">分支规格</p></td><td id="cb16207c"><p id="be62c448">列出<a href="working-with-feature-branches.html#Configuring-branches">功能分支</a>支持所必需的分支名称模式。除了默认分支外，还监视匹配的分支是否有更改。语法类似于结帐规则： <code class="code">+|-:branch_name</code> ，在哪里<code class="code">branch_name</code>特定于VCS，即<code class="code">refs/heads/</code>在Git中（可选<code class="code">*</code>占位符）。</p><a name="OR-syntax-tip"></a><aside class="tip sideblock" rel="7d9302dd" id="4f41664b" data-title=""><p id="0bfa15d3">在这里， <i id="ccb68295" origin="teamcity-help">管道</i>符号<code class="code">|</code>代表<b id="65503489" origin="teamcity-help">OR</b>命令，如正则表达式中一样：use <code class="code">+</code>用于包括， <b id="3a18cf9b" origin="teamcity-help">或</b> <code class="code">-</code>排除。</p></aside></td></tr><tr id="f2d20102" class="ijRowOdd"><td id="fe6a706b"><p id="4d1b98a4">将标签用作分支</p></td><td id="1fd685f4"><p id="5286450c">允许将git <a href="vcs-labeling.html">标签</a>作为分支进行监控/检出，从而使分支规范与标签名称以及分支相匹配（例如， <code class="code">+|-:refs/tags/<tag_name></code> ）。默认情况下，标签将被忽略。</p></td></tr><tr id="7b9cf874" class="ijRowEven"><td id="8268842c"><p id="6cf453ad">用户名风格</p></td><td id="97accb87"><p id="8f6788b8">定义TeamCity报告VCS更改用户名的方式。更改用户名样式将仅影响新收集的更改。旧更改将继续以收集更改时使用的样式进行存储。</p></td></tr><tr id="4217770f" class="ijRowOdd"><td id="433c039b"><p id="77886d18">子模块</p></td><td id="4917306e"><p id="9d54936a">选择是要忽略子模块，还是将其视为源树的一部分。子模块存储库不应要求身份验证，也不应使用相同的协议，并接受与VCS根目录中配置的身份验证相同的身份验证。</p></td></tr><tr id="700c82cf" class="ijRowEven"><td id="e2a8efb7"><p id="59b99cab">标签/合并的用户名</p></td><td id="950717f8"><p id="de29542c">用于<a href="vcs-labeling.html">标记的</a>自定义用户名。</p></td></tr></tbody></table></div><p id="ad67d88b"><a name="branchMatchingRules"></a><a name="Git-branchMatchingRules"></a></p><a name="BranchMatchingRules"></a><a name="Branch-Matching-Rules"></a><div class="chapter"><h3 id="Git-BranchMatchingRules">分行匹配规则</h3><ul class="list _ul"><li class="list__item" id="8d9c6e01"><p>如果分支与没有样式的行匹配，则使用该行。</p></li><li class="list__item" id="8cb21934"><p>如果分支将多行与模式匹配，则使用最佳匹配行。</p></li><li class="list__item" id="8e9c6f02"><p>如果有几行具有相等的匹配项，则以下一行优先。<br>通配符匹配的所有内容都将在TeamCity界面中显示为分支名称。例如， <code class="code">+:refs/heads/*</code>将匹配<code class="code">refs/heads/feature1</code>分支，但在TeamCity界面中您只会看到<code class="code">feature1</code>作为分支名称。<br>分支的简称如下：</p></li><li class="list__item" id="195801f5"><p>如果该行不包含方括号，则使用全行，如果没有模式或行的一部分从第一个模式匹配的字符到最后一个模式匹配的字符开始。</p></li><li class="list__item" id="6c631f46"><p>如果该行包含方括号，则使用方括号内的行的一部分。如果在此处指定了分支，并且您的构建配置具有VCS触发器并且在某个分支中找到了更改，则TeamCity将在该分支中触发构建。</p></li></ul></div><a name="SupportedGitProtocols"></a><a name="Supported-Git-Protocols"></a><div class="chapter"><h3 id="Git-SupportedGitProtocols">支持的Git协议</h3><p id="9f097ea8">Git存储库URL支持以下协议：</p><ul class="list _ul"><li class="list__item" id="695122eb"><p>ssh ：（例如， <code class="code">ssh://git.somwhere.org/repos/test.git</code> ， <code class="code">ssh://git@git.somwhereElse.org/repos/test.git</code> ，类似于scp的语法： <code class="code">git@git.somwhere.org:repos/test.git</code> ）</p></li></ul><aside class="note " rel="46f1b50f" id="c2aa3c2a" data-title=""><p id="0f4b3c0e"><b id="5251e50c">小心</b></p><p id="85c76d29">类似SCP的语法在主机名后需要冒号，而通常的SSH URL则不需要。这是常见的错误来源。</p></aside><ul class="list _ul"><li class="list__item" id="048a6f9c"><p>git ：（例如<a href="javascript:void(0);" rel="noopener noreferrer" data-external="true" target="_blank">git：//git.kernel.org/pub/scm/git/git.git</a> ）</p></li><li class="list__item" id="bce048f7"><p>http ：（例如，http: <a href="http://git.somewhere.org/projects/test.git" rel="noopener noreferrer" data-external="true" target="_blank">//git.somewhere.org/projects/test.git</a> ）</p></li><li class="list__item" id="12a666f5"><p>文件：（例如， <a href="javascript:void(0);" rel="noopener noreferrer" data-external="true" target="_blank">file：/// c：/projects/myproject/.git</a> ）</p></li></ul><aside class="note " rel="eef3d70b" id="3e4e4d3b" data-title=""><p id="2bff021a"><b id="d134445e">小心</b></p><p id="c4cd06a5">类似SCP的语法在主机名后需要冒号，而通常的SSH URL则不需要。这是常见的错误来源。当您将TeamCity作为Windows服务运行时，它无法访问映射的网络驱动器和位于它们上的存储库。</p></aside></div></div><a name="AuthenticationSettings"></a><a name="Authentication-Settings"></a><div class="chapter"><h2 id="Git-AuthenticationSettings">验证设定</h2><div class="table-wrapper"><table width="100%" id="59992846"><thead><tr id="8a016325" class="ijRowHead"><th id="2924979b"><p id="3cfbbe87">身份验证方法</p></th><th id="fe0b3136"><p id="0d41f0cb">描述</p></th></tr></thead><tbody><tr id="1d98ed05" class="ijRowOdd"><td id="51237a45"><p id="200bb462">匿名</p></td><td id="814ae3ff"><p id="b09631dc">选择此选项可克隆具有匿名读取访问权限的存储库。</p></td></tr><tr id="f3726cad" class="ijRowEven"><td id="b852b69d"><p id="031b936f">密码</p></td><td id="064aa006"><a name="passwordAuth"></a><a name="Git-passwordAuth"></a><p id="e7d48084">指定有效的<b id="0ecd533b">用户名</b> （如果克隆URL中没有用户名；此处指定的用户名将覆盖URL中的用户名）和用于克隆存储库的<b id="a389ad20">密码</b> 。<br>对于<a href="vcs-checkout-mode.html">代理端检出</a> ， <b id="220c9ea3">仅当</b>代理上安装了<b id="220c9ea3">Git 1.7.3+客户端时才</b>支持。参见<a href="http://youtrack.jetbrains.com/issue/TW-18711" rel="noopener noreferrer" data-external="true" target="_blank">TW-18711</a> 。<br>对于从Team Foundation Server 2013托管的Git，请在此处指定NTLM凭据。</p><p id="ebcda378">您可以使用个人访问令牌代替密码来向Azure DevOps Services进行身份验证。请注意，TeamCity不支持对托管的<a href="https://azure.microsoft.com/en-in/services/devops/server/" rel="noopener noreferrer" data-external="true" target="_blank">Azure DevOps Server</a> （以前称为Team Foundation Server）安装的令牌身份验证。</p></td></tr><tr id="932fe757" class="ijRowOdd"><td id="492c9f87"><p id="907a77a7">私钥</p></td><td id="5ccf4db5"><p id="cc9dcdd1">仅对SSH协议有效。私钥必须采用<b id="30eb70b8">OpenSSH格式</b> 。从“ <b id="140433df">私钥”</b>列表中选择一个选项，然后指定一个有效的用户名（如果克隆URL中没有用户名；此处指定的用户名将覆盖URL中的用户名）。<br>可用的<b id="c965d8bc">私钥</b>选项：</p><ul class="list _ul"><li class="list__item" id="ec2f44fd"><p><b id="76c6b19b">上载密钥</b> –使用上载到项目的密钥。有关详细信息，请参见<a href="ssh-keys-management.html">SSH密钥管理</a> 。</p></li><li class="list__item" id="a9f4a144"><p><b id="7c8d1e2d">默认私钥</b> –使用文件系统上通用ssh工具使用的默认位置中可用的密钥： <code class="code"><USER_HOME>/.ssh/config</code>如果文件存在或私钥文件<code class="code"><USER_HOME>/.ssh/id_rsa</code> （如果使用了<a href="vcs-checkout-mode.html">代理端检出，</a>则文件必须存在于服务器上以及代理上）。</p></li><li class="list__item" id="28f7975b"><p><b id="83f74739">自定义私钥</b> – <b id="cdd7a869">仅支持<a href="vcs-checkout-mode.html">服务器端检出</a></b> 。使用此方法时，请使用服务器计算机上私钥文件的绝对路径填充“ <b id="d16fc205">私钥路径”</b>字段。如果需要，请在相应的字段中指定密码以访问您的SSH密钥。</p></li></ul></td></tr></tbody></table></div><p id="4acba8ed">有关连接到GitHub的所有可用选项，请参见<a href="http://youtrack.jetbrains.com/issue/TW-16194#comment=27-475793" rel="noopener noreferrer" data-external="true" target="_blank">注释</a> 。</p></div><a name="AuthenticatingtoAzureDevOpsServices"></a><a name="Authenticating-to-Azure-DevOps-Services"></a><div class="chapter"><h2 id="Git-AuthenticatingtoAzureDevOpsServices">向Azure DevOps Services进行身份验证</h2><p id="21537347">如果将Git源代码控制与Azure DevOps Services一起使用，则可以使用以下选项：</p><a name="azure-authentication"></a><a name="PersonalAccessTokens"></a><a name="Personal-Access-Tokens"></a><div class="chapter"><h3 id="Git-PersonalAccessTokens">个人访问令牌</h3><p id="0dfe3004">若要使用访问令牌，您需要在Azure DevOps帐户中创建<a href="https://www.visualstudio.com/en-us/docs/setup-admin/team-services/use-personal-access-tokens-to-authenticate" rel="noopener noreferrer" data-external="true" target="_blank">个人访问令牌</a> ，您必须在其中在存储库中设置一些<b id="f30c2bbd" origin="teamcity-help">代码</b> <a href="#Required-Access-Scope">访问范围</a> ，并在配置VCS根目录时使用它。</p><aside class="note " rel="0dfe3004" id="5d3c46b6" data-title=""><p id="f6713c43">您只能使用个人访问令牌对Azure DevOps Services进行身份验证。TeamCity不支持对托管的<a href="https://azure.microsoft.com/en-in/services/devops/server/" rel="noopener noreferrer" data-external="true" target="_blank">Azure DevOps Server</a> （以前称为Team Foundation Server）安装的令牌身份验证。</p></aside><div class="table-wrapper"><table width="100%" id="995c1956"><thead><tr id="98e94b41" class="ijRowHead"><th id="8289e28c"><p id="aa5e731e">选项</p></th><th id="48817271"><p id="7e953a34">描述</p></th></tr></thead><tbody><tr id="517e8f71" class="ijRowOdd"><td id="adf66fc4"><p id="fdf9318e">用户名</p></td><td id="497009b3"><p id="c00e1b4e">TFVC保留空白，Git保留任何值，例如username</p></td></tr><tr id="59154c7c" class="ijRowEven"><td id="9cec30fb"><p id="2a1a3773">密码</p></td><td id="7f9e0498"><p id="f9b797b1">输入您之前创建的个人访问令牌</p></td></tr></tbody></table></div><a name="RequiredAccessScope"></a><a name="Required-Access-Scope"></a><div class="chapter"><h4 id="Git-RequiredAccessScope">所需的访问范围</h4><div class="table-wrapper"><table width="100%" id="0fe9dc6a"><thead><tr id="24ad1236" class="ijRowHead"><th id="21988817"><p id="1835b2e1">TFS子系统</p></th><th id="6ef148ad"><p id="f900b7de">范围</p></th></tr></thead><tbody><tr id="1ce7b31a" class="ijRowOdd"><td id="fe81ee34"><p id="9386db7f">TFVC</p></td><td id="437e0214"><p id="7733d210">所有范围</p></td></tr><tr id="4c9b7c1c" class="ijRowEven"><td id="8f734e0d"><p id="8ea4d9c8">吉特</p></td><td id="9a39106a"><p id="08c407b9">版本设置的代码（读取）/代码（读取和写入）</p></td></tr><tr id="58033015" class="ijRowOdd"><td id="88681edf"><p id="51729c1b">工作项目</p></td><td id="0d695fa1"><p id="510d7fcd">工作项目（已读）</p></td></tr><tr id="ab84f429" class="ijRowEven"><td id="dfb6111f"><p id="fdaa1c55">提交状态</p></td><td id="5f2e1b7c"><p id="b3c47050">代码（状态）</p></td></tr></tbody></table></div></div></div><a name="AlternateAuthenticationCredentials"></a><a name="Alternate-Authentication-Credentials"></a><div class="chapter"><h3 id="Git-AlternateAuthenticationCredentials">备用身份验证凭证</h3><p id="33887f6d">若要使用登录名/密码对身份验证，必须在Azure DevOps帐户中启用<a href="https://www.visualstudio.com/en-us/docs/report/analytics/client-authentication-options#create-an-alternate-access-credential" rel="noopener noreferrer" data-external="true" target="_blank">备用凭据</a> ，您可以在其中设置在配置VCS根目录时使用的辅助用户名和密码。</p></div></div><a name="ServerSettings"></a><a name="Server-Settings"></a><div class="chapter"><h2 id="Git-ServerSettings">服务器设定</h2><p id="41c67829">这些是服务器端<a href="vcs-checkout-mode.html">检出时</a>使用的设置。</p><div class="table-wrapper"><table width="100%" id="01805d9f"><thead><tr id="500e4196" class="ijRowHead"><th width="150" id="a88c3095"><p id="e60c7396">选项</p></th><th id="5dd09f30"><p id="06c6ad46">描述</p></th></tr></thead><tbody><tr id="8794c54a" class="ijRowOdd"><td id="d5e96c5b"><a name="serverAutoCRLF"></a><a name="Git-serverAutoCRLF"></a><p id="4c942ff1">将行尾转换为CRLF</p></td><td id="a4c44acc"><p id="1321f48c">将所有文本文件的行尾转换为CRLF（作为设置工作） <code class="code">core.autocrlf=true</code>在存储库配置中）。如果未选择，则不执行任何行尾转换（作为设置<code class="code">core.autocrlf=false</code> ）。仅影响服务器端检出。对此属性所做的更改将导致干净签出。</p></td></tr></tbody></table></div></div><a name="AgentSettings"></a><a name="Agent-Settings"></a><div class="chapter"><h2 id="Git-AgentSettings">代理设定</h2><p id="ac6f26da"><a name="agentSettings"></a><a name="Git-agentSettings"></a></p><p id="ce481e31">这些是代理方<a href="vcs-checkout-mode.html">结帐时</a>使用的设置。<br>请注意，代理方结帐对SSH的支持有限。唯一受支持的身份验证方法是“默认私钥”和“上载私钥”。<br>如果您打算使用<a href="vcs-checkout-mode.html">代理端检出</a> ，则需要在代理上安装Git 1.6.4+。</p><div class="table-wrapper"><table width="100%" id="74b5e08b"><thead><tr id="0984b757" class="ijRowHead"><th width="150" id="3f42bfad"><p id="22e82dbd">选项</p></th><th id="06959504"><p id="433b3675">描述</p></th></tr></thead><tbody><tr id="1c8b92f2" class="ijRowOdd"><td id="d73c4afc"><p id="962868e8">git的路径</p></td><td id="55d519d6"><p id="b0e0f382">提供要在代理上使用的git可执行文件的路径。设置为<code class="code">%env.TEAMCITY_GIT_PATH%</code> ，将使用自动检测到的git，有关详细信息，请参见<a href="#Git-executable-on-the-agent">代理上的Git可执行文件</a></p></td></tr><tr id="5b15182a" class="ijRowEven"><td id="598c47e4"><p id="7e9c969c">清理策略/清理文件策略</p></td><td id="529f4050"><p id="b8bc5f1f">在此处指定<code class="code">git clean</code>命令将在代理上运行，以及要删除哪些文件。</p></td></tr><tr id="05640aee" class="ijRowOdd"><td id="1c02f460"><a name="use-alternates"></a><a name="Git-use-alternates"></a><p id="0f301ba0">使用镜子</p></td><td id="85220d3e"><p id="f12178a9"><b id="dbefaf18">启用后</b> （默认），TeamCity会将存储库克隆到代理的<code class="code">system\git</code>目录，并在更新构建的签出目录时将镜像用作备用存储库。结果，这加快了清理签出的速度（因为仅清理了工作目录），并节省了磁盘空间（因为代理上只有给定Git存储库的一个克隆）。</p><p id="59d289a5">如果<b id="a8d90395">禁用</b>此选项，TeamCity将在版本的工作目录下直接克隆存储库，除非<a href="#use-local-mirrors"><code class="code">teamcity.git.use.local.mirrors</code></a>属性设置为<code class="code">true</code> 。</p></td></tr></tbody></table></div><aside class="tip sideblock" rel="74b5e08b" id="7328237d" data-title=""><p id="bd5c28ca">要配置从运行在代理后面的TeamCity服务器到远程Git存储库的连接，请参阅<a href="how-to.html#Configure-TeamCity-to-Use-Proxy-Server-for-Outgoing-Connections">本节</a> 。</p></aside><a name="Gitexecutableontheagent"></a><a name="Git-executable-on-the-agent"></a><div class="chapter"><h3 id="Git-Gitexecutableontheagent">代理上的Git可执行文件</h3><p id="cc53777d"><a name="agentGitPath"></a><a name="Git-agentGitPath"></a></p><p id="f47ff50b">TeamCity需要代理上的Git命令行客户端版本1.6.4+，才能使用代理端检出。</p><p id="2e473265">推荐的方法是确保git客户端在<code class="code">PATH</code>的TeamCity代理，并将VCS根目录中的“ Path to git”设置保留为空白。<br>如果在某些计算机上只有git命令行，则将VCS根目录中的“ Path to git”设置设置为<code class="code">%env.TEAMCITY_GIT_PATH%</code>值。</p><p id="caeee187">除了将Git添加到代理的PATH之外，您还可以设置<code class="code">TEAMCITY_GIT_PATH</code>环境变量（或<code class="code">env.TEAMCITY_GIT_PATH</code>代理人的财产<a href="build-agent-configuration.html"><code class="code">buildAgent.properties</code></a>文件）到git可执行文件的完整路径。</p><p id="00445ac2">如果<code class="code">TEAMCITY_GIT_PATH</code>未定义，Git代理插件会在代理启动时尝试检测已安装的git。它首先尝试从以下位置运行git：</p><ul class="list _ul"><li class="list__item" id="50bf4415">对于Windows-它尝试运行<code class="code">git.exe</code>在：<ul class="list _ul"><li class="list__item" id="b7076501"><code class="code">C:\Program Files\Git\bin</code></li><li class="list__item" id="27004d7d"><code class="code">C:\Program Files (x86)\Git\bin</code></li><li class="list__item" id="68d1a7ff"><code class="code">C:\cygwin\bin</code></li></ul></li><li class="list__item" id="e877758c">对于* nix-它尝试运行<code class="code">git</code>在：<ul class="list _ul"><li class="list__item" id="1b54c4a7"><code class="code">/usr/local/bin</code></li><li class="list__item" id="cbbec00f"><code class="code">/usr/bin</code></li><li class="list__item" id="403e5af1"><code class="code">/opt/local/bin</code></li><li class="list__item" id="a0d7c3f9"><code class="code">/opt/bin</code></li></ul></li></ul><p id="a949ed0f">如果在上述任何位置均未找到git，它将尝试通过<code class="code">PATH</code>环境变量。<br>如果找到兼容的git（1.6.4+），则会在<code class="code">TEAMCITY_GIT_PATH</code>环境变量。可以在<a href="vcs-root.html">VCS根目录</a>设置的<b id="19450763">git路径</b>字段中使用此变量。结果，具有这种VCS根目录的配置将仅在检测到或在代理属性中指定git的代理上运行。</p><p id="c6901e87"><a name="Git_gc"></a><a name="Git-Git_gc"></a></p></div></div><a name="ConfiguringGitGarbageCollectiononServer"></a><a name="Configuring-Git-Garbage-Collection-on-Server"></a><div class="chapter"><h2 id="Git-ConfiguringGitGarbageCollectiononServer">在服务器上配置Git垃圾收集</h2><p id="d725ca96">TeamCity服务器为服务器上配置的VCS根目录中使用的每个Git存储库维护一个本地克隆。由于服务器一天要多次执行这些克隆的提取，因此需要定期优化克隆以保持可预测的性能。如果克隆的Git垃圾回收没有长时间运行，则收集更改的过程可能会变慢或开始报告与内存相关的错误。当可以在服务器上找到本地Git客户端时，TeamCity可以自动定期运行git gc。无法运行Git GC会生成相关的运行状况报告。</p><p id="62213144">要修复警告/满足自动git gc要求，请执行以下操作：</p><ol class="list _decimal"><li class="list__item" id="e515f900"><p>在TeamCity服务器上手动安装本机Git客户端。</p></li><li class="list__item" id="640f96d5">指定Git可执行文件的路径：<ul class="list _ul"><li class="list__item" id="7b48cbb6"><p>将带有可执行文件的目录添加到<code class="code">Path</code>环境变量并重新启动服务器， <i id="81eaa5e5">或者</i></p></li><li class="list__item" id="569a8c84"><p>在目录中设置目录的完整路径<code class="code">teamcity.server.git.executable.path</code> <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">内部属性，</a>而无需重新启动服务器。</p></li></ul></li></ol><p id="6853ae8d">当TeamCity运行Git垃圾收集时，详细信息将记录到<a href="teamcity-server-logs.html"><code class="code">teamcity-cleanup.log</code></a> 。如果git垃圾收集失败，则会显示相应的警告。</p><p id="58c8faf8">TeamCity执行Git垃圾收集，直到总时间不超过5小时配额；配额可以使用<code class="code">teamcity.server.git.gc.quota.minutes</code> <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">内部财产</a> 。<br>Git垃圾收集每天晚上2点执行一次，可以通过使用cron表达式指定内部属性来更改它，如下所示： <code class="code">teamcity.git.cleanupCron=0 0 2 * * ?</code> （重新启动服务器以使该属性生效）。如果<code class="code">git gc</code>过程运行缓慢，无法在指定时间内完成，请检查<code class="code">git-repack</code>默认Git配置文件中的配置（例如，您可以增加<code class="code">--window-memory</code>改善<code class="code">git gc</code>性能）。</p><p id="0f7fb754">如果本地Git克隆需要某种手动维护，则可以在下面找到它们<code class="code"><TeamCity Data Directory>/system/caches/git</code>目录。的<code class="code">map</code>该目录中的文件包含存储库URL和存储该存储库的裸克隆内容的子目录之间的映射。</p></div><a name="GitLFS"></a><a name="Git-LFS"></a><div class="chapter"><h2 id="Git-GitLFS">Git LFS</h2><p id="a214800c">TeamCity支持Git LFS进行代理方结帐。要使用它，请在构建代理机器上安装git 1.8.5+和Git LFS。Git LFS应该使用<code class="code">git lfs install</code>命令（在Windows上可能需要提升的命令提示符）。<a href="https://git-lfs.github.com/" rel="noopener noreferrer" data-external="true" target="_blank">Git LFS文档中</a>提供了更多信息。</p><p id="3a70655a"><a name="internalProperties"></a><a name="Git-internalProperties"></a></p></div><a name="InternalProperties"></a><a name="Internal-Properties"></a><div class="chapter"><h2 id="Git-InternalProperties">内部性质</h2><p id="3c929f65">对于Git VCS，可以配置以下<a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">内部属性</a> ：</p><div class="table-wrapper"><table class=" wide" width="100%" id="75badc6b"><thead><tr id="27c8ce80" class="ijRowHead"><th width="300" id="dcbd420f"><p id="793815f2">属性</p></th><th width="100" id="51583db8"><p id="599659ab">默认</p></th><th id="6fe8241f"><p id="754b4aba">描述</p></th></tr></thead><tbody><tr id="3a7e6925" class="ijRowOdd"><td id="8c410ee3"><p id="87063053"><code class="code">teamcity.git.idle.timeout.seconds</code></p></td><td id="e7932a3e"><p id="5b6eaff0">1800</p></td><td id="9fd43324"><p id="b47ab055">与远程存储库通信的空闲超时。如果在此超时期间未发送或接收任何数据，则插件会引发超时错误，以防止永远挂起该进程。</p></td></tr><tr id="bc7765e7" class="ijRowEven"><td id="fd07ab74"><p id="446627b4"><code class="code">teamcity.git.fetch.timeout</code></p></td><td id="c0be8a6c"><p id="598d8110">1800</p></td><td id="38fec9c6"><p id="0312b2a0">（不建议使用）覆盖<code class="code">teamcity.git.idle.timeout.seconds</code>用于git fetch操作</p></td></tr><tr id="37561a25" class="ijRowOdd"><td id="4ca94b1e"><p id="854ddeb0"><code class="code">teamcity.git.fetch.separate.process</code></p></td><td id="effe349b"><p id="54bbbaa9">真正</p></td><td id="89d475ee"><p id="29cb7f18">定义TeamCity是否在单独的进程中运行git fetch</p></td></tr><tr id="395a105d" class="ijRowEven"><td id="3aff4373"><p id="94b5fa15"><code class="code">teamcity.git.fetch.process.max.memory</code></p></td><td id="aed2cb31"><p id="d4064ccc">512M</p></td><td id="c66e8e79"><p id="e5805cef">单独的提取过程的JVM -Xmx参数的值。您还需要确保服务器计算机具有足够的内存，因为除了主服务器进程外，还将使用配置的内存，并且可能有多个子进程执行git fetch，每个子进程都使用配置的内存量。</p><aside class="note " rel="e5805cef" id="7d991e73" data-title=""><p id="05be2416">对于需要堆内存大于的大型存储库<code class="code">-Xmx1024m</code>对于Git提取，可能需要<a href="installing-and-configuring-the-teamcity-server.html#Setting-Up-Memory-settings-for-TeamCity-Server">切换到64位Java</a> 。</p></aside></td></tr><tr id="c519bd17" class="ijRowOdd"><td id="716c780d"><p id="c0ae768f"><code class="code">teamcity.git.monitoring.expiration.timeout.hours</code></p></td><td id="96b220c4"><p id="56ce1f58">24</p></td><td id="dbee9676"></td></tr><tr id="10bd8e0e" class="ijRowEven"><td id="97b23e59"><p id="e173271c"><code class="code">teamcity.server.git.gc.enabled</code></p></td><td id="e02328e6"><p id="c9119bc2">假</p></td><td id="0a07bf50"><p id="7a924de0">TeamCity是否应运行<code class="code">git gc</code>在服务器清理期间（使用本地git）</p></td></tr><tr id="be63fd81" class="ijRowOdd"><td id="f0f268ef"><p id="a67c9ec8"><code class="code">teamcity.server.git.executable.path</code></p></td><td id="6b9acee8"><p id="c65162f6">吉特</p></td><td id="2756f696"><p id="43eca89d">服务器上本机git可执行文件的路径</p></td></tr><tr id="2cb6ceac" class="ijRowEven"><td id="2564168b"><p id="33040219"><code class="code">teamcity.server.git.gc.quota.minutes</code></p></td><td id="574ee6be"><p id="ab0aac06">60</p></td><td id="c4ec6220"><p id="8b246515">最长运行时间<code class="code">git gc</code></p></td></tr><tr id="45a2a08a" class="ijRowOdd"><td id="ed46e8a9"><p id="ac488fef"><code class="code">teamcity.git.cleanupCron</code></p></td><td id="bee85a96"><p id="ef9d9f4e">0 0 2 * *？*</p></td><td id="01464686"><p id="4ce8ed06">默认情况下-每天凌晨2点在git-plugin中进行清理时的<a href="http://quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger" rel="noopener noreferrer" data-external="true" target="_blank">Cron表达式</a> 。</p></td></tr><tr id="ccd85790" class="ijRowEven"><td id="6fadce1d"><p id="66e02b5a"><code class="code">teamcity.git.stream.file.threshold.mb</code></p></td><td id="73bcd4b6"><p id="2c03dc92">128</p></td><td id="f8cbc976"><p id="23fb9e01">阈值（以兆字节为单位），在此阈值之后，JGit使用流来膨胀对象。如果存储库中有很大的二进制文件并查看<a href="http://youtrack.jetbrains.com/issue/TW-14947" rel="noopener noreferrer" data-external="true" target="_blank">TW-14947中</a>描述的症状，请增加它</p></td></tr><tr id="c8ae09d3" class="ijRowOdd"><td id="92a92d87"><p id="8e9f4917"><code class="code">teamcity.git.buildPatchInSeparateProcess</code></p></td><td id="52dbcbcb"><p id="437b1812">真正</p></td><td id="9b4abe9e"><p id="700e87e6">Git插件在一个单独的进程中构建补丁程序，将其设置为false可在服务器进程中构建补丁程序。要构建补丁，git-plugin必须将存储库文件读入内存。为了不耗尽内存，git-plugin只读取大小小于阈值的对象，因为使用了较大的对象流，它们的速度可能很慢（ <a href="http://youtrack.jetbrains.com/issue/TW-14947" rel="noopener noreferrer" data-external="true" target="_blank">TW-14947</a> ）。通过在单独的过程中构建补丁，所有对象都被读入内存。修补过程使用单独的访存过程的内存设置。</p></td></tr><tr id="cfb1e1c5" class="ijRowEven"><td id="c002ba5f"><p id="12b398db"><code class="code">teamcity.git.mirror.expiration.timeout.days</code></p></td><td id="c6f4a076"><p id="0cb4ff8f">7</p></td><td id="552d1b5f"><p id="691a7cc2">将未使用的存储库克隆从服务器计算机上删除之后的天数。如果该存储库上没有TeamCity操作，例如检查更改或获取当前版本，则该存储库被视为未使用。这些操作非常频繁，因此7天是相当高的价值。</p></td></tr><tr id="cdfe8b5e" class="ijRowOdd"><td id="d58964a4"><p id="7075766c"><code class="code">teamcity.git.commit.debug.info</code></p></td><td id="e35f677d"><p id="6964bdda">假</p></td><td id="e11cfa4c"><p id="b0086d05">定义是否在找到的每个提交上记录其他调试信息</p></td></tr><tr id="79e8b05e" class="ijRowEven"><td id="f8ff96b5"><p id="a729dfa6"><code class="code">teamcity.git.sshProxyType</code></p></td><td id="39259e77"></td><td id="daad2844"><p id="d45f7f3c">ssh代理的类型，支持的值： <code class="code">http</code> ， <code class="code">socks4</code> ， <code class="code">socks5</code> 。请记住，socks4代理无法解析远程主机名，因此，如果收到UnknownHostException，请切换到socks5或将git服务器的条目添加到TeamCity服务器计算机上的hosts文件中。</p></td></tr><tr id="079a82a7" class="ijRowOdd"><td id="535f223e"><p id="145d1003"><code class="code">teamcity.git.sshProxyHost</code></p></td><td id="d1b33e8e"></td><td id="e5195c29"><p id="283a0e09">SSH代理主机</p></td></tr><tr id="79080ec8" class="ijRowEven"><td id="440bb2de"><p id="346f1f07"><code class="code">teamcity.git.sshProxyPort</code></p></td><td id="755ade46"></td><td id="9d93a631"><p id="f51c2128">SSH代理端口</p></td></tr><tr id="10fa38f7" class="ijRowOdd"><td id="66c6ef86"><p id="3e5f7d0d"><code class="code">teamcity.git.connectionRetryAttempts</code></p></td><td id="72f68fe1"><p id="56fc66e8">3</p></td><td id="44c838cb"><p id="7d9a665a">在承认失败之前尝试建立与远程主机的连接以测试连接并获取当前存储库状态的尝试次数</p></td></tr><tr id="1da403ac" class="ijRowEven"><td id="3a7db7c0"><p id="8b94b2d7"><code class="code">teamcity.git.connectionRetryIntervalSeconds</code></p></td><td id="b5efd0a7"><p id="832f8741">4</p></td><td id="a9ab11b3"><p id="0c523211">尝试连接之间的时间间隔（以秒为单位）</p></td></tr><tr id="e04b67cc" class="ijRowOdd"><td id="df1e9ced"><a name="use-local-mirrors"></a><a name="Git-use-local-mirrors"></a><p id="25bb7bef"><code class="code">teamcity.git.use.local.mirrors</code></p></td><td id="30b52299"><p id="3752d5b9">假</p></td><td id="6bdbac77"><p id="623de429"><i id="91d20069">仅当在VCS根目录设置中禁用了“ <a href="#use-alternates"><i id="41919f93">使用镜像</i></a> ”选项时，TeamCity才会检查此属性的状态。</i></p><p id="0549b2ce">默认情况下，如果您禁用“ <i id="003f68e4">Use mirrors</i> ”，TeamCity将在版本的工作目录下克隆存储库。<br>组<code class="code">teamcity.git.use.local.mirrors</code>至<code class="code">true</code>克隆代理程序下的存储库<code class="code">system\git</code>目录代替。运行构建时，TeamCity将存储库从该目录复制到构建的工作目录。</p><aside class="note " rel="0549b2ce" id="fede59f5" data-title=""><p id="57221607">从同一台计算机上的目录复制存储库比从源克隆存储库要快，因此我们建议设置<code class="code">teamcity.git.use.local.mirrors</code>至<code class="code">true</code>如果您禁用“ <i id="68088731">使用镜像</i> ”选项。</p></aside></td></tr><tr id="2d92338a" class="ijRowEven"><td id="16d1294d"><p id="c924669d"><code class="code">teamcity.git.use.shallow.clone</code></p></td><td id="7f011ede"><p id="2a25c5ac">假</p></td><td id="5d1c56a5"><p id="692a430d"><i id="b0d30b95">仅当在VCS根目录设置中禁用了“ <i id="fe6499fc">使用镜像</i> ”选项时，TeamCity才会检查此属性的状态。 <code class="code">teamcity.git.use.local.mirrors</code>被设定为<code class="code">true</code> 。</i></p><p id="b0b1b589">如果<code class="code">teamcity.git.use.shallow.clone</code>被设定为<code class="code">true</code> ，TeamCity将仅克隆存储库的最新版本。这等于创建一个<i id="64c9eacb">浅</i>克隆，这意味着设置<a href="https://git-scm.com/docs/git-clone#Documentation/git-clone.txt---depthltdepthgt" rel="noopener noreferrer" data-external="true" target="_blank">深度</a> <code class="code">git clone</code>操作到<code class="code">1</code> 。</p><p id="5bd64fa3">如果除了最后一次提交以外不需要存储任何提交（例如，如果您经常使用一次性云实例来运行构建），则可以通过禁用“ <a href="#use-alternates"><i id="0fb81dcb">使用镜像</i></a> ”选项并设置设置来优化设置的性能。内部属性如下：</p><ul class="list _ul"><li class="list__item" id="e185b817"><code class="code">teamcity.git.use.local.mirrors=true</code></li><li class="list__item" id="99edd27d"><code class="code">teamcity.git.use.shallow.clone=true</code></li></ul><p id="7b524808">在所有其他情况下，我们建议启用“ <i id="93dbd715">使用镜像</i> ”选项。</p></td></tr></tbody></table></div><p id="88eb40dc">Git的<a href="build-agent-configuration.html">代理配置</a> ：</p><div class="table-wrapper"><table class=" wide" width="100%" id="dcf5a174"><thead><tr id="fbf60800" class="ijRowHead"><th width="300" id="dacbfb1e"><p id="d7da02bc">属性</p></th><th id="e75a5baa"><p id="029265bd">默认</p></th><th id="ddc2ac3a"><p id="17dc4d7e">描述</p></th></tr></thead><tbody><tr id="d98b31ab" class="ijRowOdd"><td id="83092cde"><p id="fe59091a"><code class="code">teamcity.git.use.native.ssh</code></p></td><td id="b62204c7"><p id="aebaf2c0">假</p></td><td id="e30c9181"><p id="fbb0f2c0">在代理上签出时：TeamCity是否应使用本机SSH实现。</p></td><td id="96255b40"></td></tr><tr id="a5646e7f" class="ijRowEven"><td id="fb178716"><p id="a1408c3b"><code class="code">teamcity.git.idle.timeout.seconds</code></p></td><td id="619cd60b"><p id="aaaf5584">1800</p></td><td id="9ba47c49"><p id="163ac5f9">使用代理程序侧签出时，git fetch操作的空闲超时。如果在此期间没有任何获取过程的输出，则终止获取。在8.0.4之前，默认值为600。</p></td></tr></tbody></table></div><p id="45297578"><a name="limitations"></a><a name="Git-limitations"></a></p></div><a name="Limitations"></a><a name="Limitations"></a><div class="chapter"><h2 id="Git-Limitations">局限性</h2><p id="d1e28b8b">在代理上使用签出时，仅支持一部分<a href="vcs-checkout-rules.html">签出规则</a> 。Git插件将某些签出规则转换为稀疏签出模式。仅<b id="e9afa41e">支持不重新映射文件</b>的<b id="e9afa41e">规则</b> ：</p><div class="code-block" data-lang="bash">+：一些/目录-：一些/目录/ subDir</div><p id="b4377ff1"><b id="8a47cdd9">不支持的</b>规则示例是<code class="code">+:some/dir=>some/otherDir</code> 。</p></div><a name="KnownIssues"></a><a name="Known-Issues"></a><div class="chapter"><h2 id="Git-KnownIssues">已知的问题</h2><ul class="list _ul"><li class="list__item" id="0194afe6"><p><code class="code">java.lang.OutOfMemoryError</code>同时获取存储库。通常在存储库中有大文件时发生。默认情况下，TeamCity在单独的进程中运行获取。要增加此过程可用的内存，请更改teamcity.git.fetch.process.max.memory内部属性（请参阅<a href="#Internal-Properties">上面</a>有关此属性的描述）。</p></li><li class="list__item" id="f8d4b514"><p>作为Windows服务运行的Teamcity无法访问网络映射的驱动器，因此您不能使用位于此类驱动器上的git存储库。为此，请使用以下命令运行TeamCity <code class="code">teamcity-server.bat</code> 。</p></li><li class="list__item" id="fc008c1a"><p>使用JGit中的流进行通胀可以防止<code class="code">OutOfMemoryError</code> ，但可能很耗时（有关详细信息以及与该问题有关的<a href="http://youtrack.jetbrains.net/issue/TW-14947" rel="noopener noreferrer" data-external="true" target="_blank">TW-14947</a>问题，请参阅<a href="http://dev.eclipse.org/mhonarc/lists/jgit-dev/msg00687.html" rel="noopener noreferrer" data-external="true" target="_blank">jgit-dev中</a>的相关线程）。如果您遇到的问题与问题中所述的情况类似，请尝试增加<code class="code">teamcity.git.stream.file.threshold.mb</code> 。此外，建议增加TeamCity专用的内存总量，以防止<code class="code">OutOfMemoryError</code> 。</p></li></ul></div><a name="DevelopmentLinks"></a><a name="Development-Links"></a><div class="chapter"><h2 id="Git-DevelopmentLinks">开发链接</h2><p id="8eb04567">Git支持作为开源插件实现。有关开发链接，请参阅<a href="https://plugins.jetbrains.com/plugin/8887-git" rel="noopener noreferrer" data-external="true" target="_blank">插件页面</a> 。</p><hr id="645f4005"><p id="90e433db"><b id="472c6c0f">也可以看看：</b></p><p id="6b3917bc"><b id="cc65f3c7">管理员指南</b> ： <a href="branch-remote-run-trigger.html">分支远程运行触发器</a></p><hr id="72ccbf06"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>