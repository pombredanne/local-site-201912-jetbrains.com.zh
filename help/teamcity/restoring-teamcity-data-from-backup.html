<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Restoring TeamCity Data from Backup - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Restoring TeamCity Data from Backup" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/teamcity-data-backup.md|TeamCity Data Backup/restoring-teamcity-data-from-backup.md|Restoring TeamCity Data from Backup" data-main-title="Restoring TeamCity Data from Backup" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/restoring-teamcity-data-from-backup.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Restoring TeamCity Data from Backup" id="restoring-teamcity-data-from-backup.md">Restoring TeamCity Data from Backup</h1><p id="e9dec095"><ul class="list" data-skip-index="skip"></ul></p><p id="ce34b0c1">TeamCity administrators are able to restore <a href="creating-backup-via-maintaindb-command-line-tool.html">backed up data</a> using the <code class="code">maintainDB</code> command-line utility.</p><aside class="note " data-title="" rel="ce34b0c1" id="1e519091"><p id="9e6e3224"><b id="b827f80f">Server Copying</b></p><p id="708a9c18">If you are creating a copy of the server, make sure to go through <a href="how-to.html#Copied-Server-Checklist">copied server checklist</a> after restoration.</p></aside><p id="e4b139c9">You can restore backed up data into the same or a different database; from/to any of the <a href="supported-platforms-and-environments.html#Supported-Databases">supported databases</a> (for example, you can restore data from a HSQL database to a PostgreSQL database, as well as restore a backup of a PostgreSQL database to a new PostgreSQL database).</p><p id="22dfe9f8">A newer version of TeamCity can be used to restore the backup created with any previous TeamCity version (provided that the TeamCity version is later than 6.0).</p><p id="3ee905b0">During restoration of a large database you might want to configure database-specific settings to make the bulk data changes faster (like setting SQL Server "Recovery Model" to "Simple"). Consult your DBA for more details.</p><p id="8ae14e5d">A TeamCity backup file <b id="0dd7b98b">does not contain build artifacts</b>, so to get the server with all the same important data you need to restore from a backup file (at least settings and database) and copy the build logs and artifacts (located in <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system/artifacts</code> by <a href="build-artifact.html">default</a>) from an old to the new Data Directory manually. The general compatibility rule of the data under <code class="code">system/artifacts</code> is that files created by older TeamCity versions can be read by newer versions, but not necessarily vice versa.</p><p id="5cadfcb6">When <a href="configuring-artifacts-storage.html#External-Artifacts-Storage">external artifacts storage</a> is enabled, the <a href="teamcity-configuration-and-maintenance.html#artifact-directories">artifacts directory</a> of the TeamCity Data Directory contains metadata about artifacts mappings, so make sure they are restored.</p><p id="96094d46">See also details on the directories in the <a href="teamcity-data-directory.html">TeamCity Data Directory</a> description.</p><a name="Performingrestore"></a><a name="Performing-restore"></a><h3 id="RestoringTeamCityDatafromBackup-Performingrestore">Performing restore</h3><p id="c8edd1c8">This document describes <b id="2f78935c">only some</b> of the <code class="code">maintainDB</code> options. For the complete list of all available options, run <code class="code">maintainDB</code> from the command line with no parameters. See also maintainDB <a href="creating-backup-via-maintaindb-command-line-tool.html#maintainDB-Startup-Options">startup options</a>.</p><p id="11e3eb10">To perform restore from a backup file:</p><ol class="list _decimal"><li class="list__item" id="e5160e0c"><p id="1c7a530b">Install the TeamCity server from a <code class="code">tar.gz</code> or <code class="code">.exe</code> installation package. Do not start the TeamCity server.</p></li><li class="list__item" id="2af36e16"><p id="ff2893a1">Create a new empty <a href="teamcity-data-directory.html">TeamCity Data Directory</a>.</p></li><li class="list__item" id="ea328de3"><p id="865318b2">Select one of the options:</p><ul class="list _ul"><li class="list__item" id="e883ca73"><p>To restore the backup into a <b id="279c1fce">new external database</b>, <a href="setting-up-an-external-database.html">create and configure an empty database</a>, configure a <code class="code">database.properties</code> file with the database settings to be passed to the <code class="code">restore</code> command later on and either place it into the <code class="code">/config</code> subdirectory of the newly created <a href="teamcity-data-directory.html">TeamCity Data Directory</a> or anywhere on your file system outside the TeamCity Data Directory.</p></li><li class="list__item" id="a7bf750c"><p>To restore the data into the <b id="2370bc5d">same database the backup was created from</b>, proceed to the next step.</p></li></ul></li><li class="list__item" id="22340730"><p id="6a3bd61a">Place the required <a href="setting-up-an-external-database.html#Database-specific-Steps">database drivers</a> into the <code class="code">lib/jdbc</code> subdirectory of the newly created <a href="teamcity-data-directory.html">TeamCity Data Directory</a> directory.</p></li><li class="list__item" id="fd228ba2"><p id="757239da">Use the <code class="code">maintainDB</code> utility located in the <code class="code">&lt;</code><a href="teamcity-home-directory.html"><code class="code">TeamCity Home</code></a><code class="code">&gt;/bin</code> directory to run the <code class="code">restore</code> command:</p><p id="54789b74">a. To restore the backup into a <b id="cb2ab75d">new external database</b></p><p id="d2a0a0d2">- if the  <code class="code">database.properties</code> file is in the TeamCity Data Directory:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore -A &lt;absolute path to the newly created TeamCity Data Directory&gt; -F &lt;path to the TeamCity backup file&gt; -T &lt;config/database.properties&gt;
</div><p id="3e05502c">- if the <code class="code">database.properties</code> file is outside the TeamCity Data Directory:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore -A &lt;absolute path to the newly created TeamCity Data Directory&gt; -F &lt;path to the TeamCity backup file&gt; -T &lt;absolute path to the database.properties file of the target database on the file system outside data dir&gt;
</div><p id="0b8355d1">b. To restore the data into the <b id="43eef065">same database the backup was created from</b>:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore -A &lt;absolute path to the newly created TeamCity Data Directory&gt; -F &lt;path to the TeamCity backup file&gt;
</div><p id="dac77e25">c. To restore the backup into the <b id="3ac0b3b0">internal database</b>:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore -A &lt;absolute path to the newly created TeamCity Data Directory&gt; -I -F &lt;path to the TeamCity backup file&gt;
</div></li><li class="list__item" id="4b31b72f"><p id="bf6f5e9b">If the process completes successfully, to <b id="35cc94fd">complete the restoration</b> you need to <b id="c789e162">copy</b> over &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/artifacts from the old directory. The directory stores build artifacts and those are not included into the backup file.</p></li></ol><p id="b96b0db9">Notes on the <code class="code">restore</code> command options:</p><ul class="list _ul"><li class="list__item" id="17c04a54"><p>The <code class="code">-A</code> argument can be omitted if you have the <a href="teamcity-data-directory.html"><code class="code">TEAMCITY_DATA_PATH</code></a> environment variable set.</p></li><li class="list__item" id="6e3956fd"><p>The <code class="code">-F</code> argument can be an absolute path or a path relative to the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/backup directory.</p></li><li class="list__item" id="be05c732"><p>The <code class="code">-T</code> argument must point to the <code class="code">database.properties</code> file created in step 3.</p></li><li class="list__item" id="c6cf2e20"><p>If the <code class="code">-T</code>argument is not specified and the <code class="code">database.properties</code>file is present in the newly created <code class="code">TeamCity Data Directory/config and the backup file, the database is restored using the properties file in</code>TeamCity Data Directory/config.`</p></li><li class="list__item" id="13973e52"><p>By default, if no other option except <code class="code">-F</code> is specified, all of the backed up scopes will be restored from the backup file. To restore only specific scopes from the backup file, use the corresponding options of the <code class="code">maintainDB</code> utility: <code class="code">-D</code>, <code class="code">-C</code>, <code class="code">-U</code>, <code class="code">-L</code>, and <code class="code">-P</code>.</p></li></ul><aside class="tip sideblock" data-title="" rel="8f19d897" id="3dc8c7f2"><p id="44a96de1">To get the reference for the available options of <code class="code">maintainDB</code>, run the utility without any command or option.</p></aside><a name="Restoringdatabaseonly"></a><a name="Restoring-database-only"></a><h3 id="RestoringTeamCityDatafromBackup-Restoringdatabaseonly">Restoring database only</h3><p id="1a850f23">When restoring the database but preserving the more recent TeamCity Data Directory, it is important to make sure the data is consistent:</p><ul class="list _ul"><li class="list__item" id="a205f725"><p>&lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/pluginData (<i id="3d6b9210">supplementary data</i>) should be restored as well to be consistent with the data stored in the database</p></li><li class="list__item" id="afe3ac3f"><p>&lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/caches should be cleared before the server start</p></li></ul><p id="7215dd20">Before restoring a TeamCity database to an existing server, make sure the TeamCity server is not running.</p><p id="d0c7c4d4">To restore a TeamCity database only from a backup file to an existing server:</p><ol class="list _decimal"><li class="list__item" id="8a25502e"><p id="10dc3b3e"><a href="setting-up-an-external-database.html">Create and configure the database</a>, placing the <code class="code">database.properties</code> file into the <code class="code">config</code> subdirectory of the <code class="code">TeamCity Data Directory</code>.</p></li><li class="list__item" id="1b436d5c"><p id="82295e0e">Ensure that the required database drivers are present in the <code class="code">/lib/jdbc</code> sub directory.</p></li><li class="list__item" id="3b6f5013"><p id="dded7039">Use the <code class="code">maintainDB</code> utility located in the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;/bin directory (only available in TeamCity <code class="code">.tar.gz</code> and <code class="code">.exe</code> distributions).</p></li><li class="list__item" id="624bbdab"><p id="2e2504d0">If the <i id="b81175b4">supplementary data</i> is present in the backup, delete the content of the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/pluginData directory (consider backing it up in another location first).</p></li><li class="list__item" id="bc19fba3"><p id="692adf78">Use the <code class="code">restore</code> command (The <code class="code">-T</code> argument must point to the <code class="code">database.properties</code> file created in step 1):</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore -A &lt;absolute path to TeamCity Data Directory&gt; -F &lt;path to the TeamCity backup file&gt; -T &lt;path to the database.properties file of the target database&gt; -D
</div></li><li class="list__item" id="a9eb68e7"><p id="87dcb380">See the <code class="code">maintainDB</code> utility console output. You may have to copy the <code class="code">database.properties</code> file manually if requested.</p></li><li class="list__item" id="2f58a288"><p id="a70f8de9">Delete the contents of the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/caches directory.</p></li></ol><a name="Resumingrestoreafterinterruption"></a><a name="Resuming-restore-after-interruption"></a><h3 id="RestoringTeamCityDatafromBackup-Resumingrestoreafterinterruption">Resuming restore after interruption</h3><p id="9b29dc7e">The restore may be interrupted due to the following reasons:</p><ul class="list _ul"><li class="list__item" id="89b95112"><p>Lack of space on the file system or in the database</p></li><li class="list__item" id="7e281098"><p>Insufficient permissions to the file system or the database.The interruption occurs when one of tables or indexes failed to be restored, which is indicated in the <code class="code">maintainDB</code> utility console output.<br><b id="71f8ad72">Before resuming the restore</b>, manually delete the incorrectly restored object from the database.</p></li></ul><p id="2a0faf77">To resume the backup restore after an interruption:<br>Run the <code class="code">maintainDB</code> utility with the <code class="code">restore</code> command with the required options and the additonal <code class="code">--continue</code> option:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] restore &lt;all previously used restore options&gt; --continue

</div><hr id="598162ea"><p id="fb84a98a"><b id="fe2e31f7">See also:</b></p><p id="27bbe874"><b id="1224ce51">Administrator's Guide</b>: <a href="creating-backup-via-maintaindb-command-line-tool.html">Creating Backup via maintainDB command-line tool</a></p><hr id="668f9c23"></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>