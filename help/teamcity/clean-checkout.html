<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Clean Checkout - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Clean Checkout" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/clean-checkout.md|Clean Checkout" data-main-title="Clean Checkout" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/clean-checkout.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Clean Checkout" id="clean-checkout.md">Clean Checkout</h1><p id="45ff462e"><i id="ddda2707">Clean Checkout</i> (also referred to as "Clean Sources") is an operation that ensures that the next build will get a copy of the sources fetched all over from the VCS. All the content of the <a href="build-checkout-directory.html">Build Checkout Directory</a> is deleted and the sources are re-fetched from the version control.</p><a name="EnforcingCleanCheckout"></a><a name="Enforcing-Clean-Checkout"></a><div class="chapter"><h2 id="CleanCheckout-EnforcingCleanCheckout">Enforcing Clean Checkout</h2><p id="824b90ca">Clean checkout is recommended if the checkout directory content was modified by an external process by adding new, modifying or deleting existing files.</p><p id="16342e1c">You can enforce clean sources action for a build configuration from the Build Configuration Home page (<b id="9e052698">Actions</b> drop-down in the top right corner), or for an agent from the <a href="viewing-build-agent-details.html">Agent Details</a> page using the <b id="1acf6fef">Miscellaneous</b> section, the Clean sources on this agent option. The action opens a list of agents/build configurations to clean sources for.</p><aside class="note " data-title="" rel="16342e1c" id="c04e9902"><p id="70abe1c3">If you set a specific folder as the Build Checkout Directory (instead of using default one), you should remember that all of the content of this directory will be deleted during the clean checkout procedure.</p></aside><p id="da71d1cb">TeamCity maintains an internal cache for the sources to optimize communications with the VCS server. The caches are reset during the <a href="clean-up.html">cleanup time</a>. To resolve problems with sources update, the caches may need to be reset manually using the <b id="c1fc8a6e"><a href="teamcity-monitoring-and-diagnostics.html#Caches">Diagnostics | Caches</a></b> tab in the Web UI or by deleting the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a>&gt;<code class="code">/system/caches</code> directory.</p></div><a name="AutomaticCleanCheckout"></a><a name="Automatic-Clean-Checkout"></a><div class="chapter"><h2 id="CleanCheckout-AutomaticCleanCheckout">Automatic Clean Checkout</h2><p id="92a113ab">You can also enable automatic cleaning the sources before every build, if you check the option <b id="c9d8f93d">Clean all files before build</b> on the <b id="49a8470f"><a href="creating-and-editing-build-configurations.html">Create/Edit Build Configuration</a>&gt; <a href="configuring-vcs-settings.html">Version Control Settings</a></b> page. If this option is checked, TeamCity performs a full checkout before each build.If clean checkout is not enabled, TeamCity updates the sources in the checkout directory incrementally to the required state.</p><p id="0a8a8b9a">TeamCity tries to detect if the sources in the checkout directory are not corresponding to the expected state and triggers clean checkout in such cases to ensure sources are appropriate. This means that under certain circumstances TeamCity can detect clean checkout is necessary even if it is not enabled in the VCS settings and not requested by the user from web UI. In such cases, all the content of the checkout directory is deleted and it is re-populated by the sources from scratch. If any details are available on the decision, they are added into the build log before checkout-related logging.</p><p id="e8dcd439">Here is the summary of cases when TeamCity performs automatic clean checkout:</p><ul class="list _ul"><li class="list__item" id="2deee13b"><p>if it is enabled using the <b id="1e150fc9">Clean all files in the checkout directory before the build</b> option in the "Version Control Settings" of the build configuration</p></li><li class="list__item" id="e292138e">build checkout directory was not found or is empty (either the build configuration is started on the agent for the first time or the directory has disappeared since the last build). This also covers the following:<ul class="list _ul"><li class="list__item" id="3f44f969"><p>no builds were run in a specific checkout directory for a configured (or default) time and the directory became empty. See more at <a href="build-checkout-directory.html#Automatic-Checkout-Directory-Cleaning">automatic checkout directory cleaning</a></p></li><li class="list__item" id="545b849f"><p>there was not enough <a href="free-disk-space.html">free space on disk</a> in one of the earlier builds and the directory was deleted</p></li></ul></li><li class="list__item" id="6f46762f"><p>a user invoked "Enforce clean checkout" action from the web UI for a build configuration or agent</p></li><li class="list__item" id="24acfc35"><p>the build was triggered via Custom Run Build dialog with "Clean all files in the checkout directory before build" option selected or by a trigger with the corresponding option</p></li><li class="list__item" id="ef7f72c4"><p>the build was triggered by a Schedule trigger with "Clean all files in checkout directory before build" option enabled or as a part of a build chain where the topmost build was triggered with the setting in the schedule trigger while "apply to all snapshot dependencies" was also selected</p></li><li class="list__item" id="fc149088"><p>VCS settings of the build configuration were changed</p></li><li class="list__item" id="a1e6f668"><p>the previous build in this directory was of a build configuration with different VCS settings (can only occur if the same checkout directory is specified for several build configurations with individual VCS settings and VCS Roots)</p></li><li class="list__item" id="db5a0a38"><p>the previous build in this directory was built on more recent revisions then the current one (can only occur for <a href="history-build.html">history builds</a>)</p></li><li class="list__item" id="10abd097"><p>there was a critical error while applying or rolling back a patch during the previous build, so TeamCity cannot ensure that checkout directory contains known versions of files</p></li><li class="list__item" id="27cdcf60"><p><a href="build-files-cleaner-swabra.html">Build Files Cleaner (Swabra)</a> is enabled with corresponding options and it detected that clean checkout is necessary</p></li><li class="list__item" id="7dda4569"><p>Custom checkout directory contains agent-specific parameters, such as `%teamcity.agent.work.dir% (pre-8.1)</p></li></ul><hr id="7fbdac68"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>