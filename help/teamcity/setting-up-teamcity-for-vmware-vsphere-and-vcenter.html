<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Setting Up TeamCity for VMware vSphere and vCenter - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Setting Up TeamCity for VMware vSphere and vCenter" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/installation.md|Installation/teamcity-integration-with-cloud-solutions.md|TeamCity Integration with Cloud Solutions/setting-up-teamcity-for-vmware-vsphere-and-vcenter.md|Setting Up TeamCity for VMware vSphere and vCenter" data-main-title="Setting Up TeamCity for VMware vSphere and vCenter" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/setting-up-teamcity-for-vmware-vsphere-and-vcenter.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Setting Up TeamCity for VMware vSphere and vCenter" id="setting-up-teamcity-for-vmware-vsphere-and-vcenter.md">Setting Up TeamCity for VMware vSphere and vCenter</h1><p id="ee849f44">TeamCity vSphere integration allows using TeamCity <a href="teamcity-integration-with-cloud-solutions.html">agent cloud features</a> with VMware <b id="2e253c61">vSphere</b> and <b id="4dbf975e">vCenter</b> installation. It requires configuring TeamCity with your VMware vSphere/vCenter account and then handles automatic creation/starting/stopping/deleting of the virtual machines with TeamCity agents on-demand, based on the queued builds.</p><p id="4b0baa2c">The functionality is implemented as a plugin bundled with TeamCity.</p><p id="8ef97958">On this page:</p><p id="45d1b5c7"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#SettingUpTeamCityforVMwarevSphereandvCenter-Requirements">Requirements</a></li><li class="list__item"><a href="#SettingUpTeamCityforVMwarevSphereandvCenter-Features">Features</a></li><li class="list__item"><a href="#SettingUpTeamCityforVMwarevSphereandvCenter-Usage">Usage</a><ul class="list _bullet"><li class="list__item"><a href="#SettingUpTeamCityforVMwarevSphereandvCenter-NotesonconfiguringAgentcloudprofile">Notes on configuring Agent cloud profile</a></li></ul></li></ul></p><a name="Requirements"></a><a name="Requirements"></a><div class="chapter"><h2 id="SettingUpTeamCityforVMwarevSphereandvCenter-Requirements">Requirements</h2><aside class="note " data-title="" rel="SettingUpTeamCityforVMwarevSphereandvCenter-Requirements" id="39c56ec0"><p id="35da4d2b">The integration requires a write access for vSphere/vCenter via API, which is available in the licensed versions; the API support of free versions is limited to read-only  access.</p></aside></div><a name="Features"></a><a name="Features"></a><div class="chapter"><h2 id="SettingUpTeamCityforVMwarevSphereandvCenter-Features">Features</h2><p id="0f9c73e3">The TeamCity vSphere integration allows you to:</p><ul class="list _ul"><li class="list__item" id="4cd97bf7">select the type of behavior:<ul class="list _ul"><li class="list__item" id="109136ea"><p>either to start/stop an existing virtual machine</p></li><li class="list__item" id="084df06c"><p>or clone a virtual machine or a template, deleting the clone once it becomes idle (when the build is finished or an idle timeout elapses, depending on the profile settings)</p></li></ul></li><li class="list__item" id="6fd99424"><p>select a virtual machine snapshot to start</p></li><li class="list__item" id="1a845255"><p>specify the folder for clones and the resource pool where your machine will be allocated</p></li><li class="list__item" id="488ee6d3"><p>configure the maximum number of started instances</p></li></ul></div><a name="Usage"></a><a name="Usage"></a><div class="chapter"><h2 id="SettingUpTeamCityforVMwarevSphereandvCenter-Usage">Usage</h2><p id="22676abe">The following steps are required to set up TeamCity-VMware vSphere agent cloud integration:</p><ol class="list _decimal"><li class="list__item" id="c5a8d351"><p>Create a virtual machine where your builds will run. Refer to the VMware vSphere website for details on creating <a href="https://pubs.vmware.com/vsphere-51/index.jsp#com.vmware.vsphere.vm_admin.doc/GUID-7834894B-DD17-4D59-A9BF-A33D02478521.html" data-external="true" target="_blank" rel="noopener noreferrer">virtual machines</a>.</p></li><li class="list__item" id="6d121d6c"><p>Make sure VMware Tools or Open VM Tools are installed. See <a href="https://docs.vmware.com/en/VMware-Tools/10.1.0/com.vmware.vsphere.vmwaretools.doc/GUID-28C39A00-743B-4222-B697-6632E94A8E72.html" data-external="true" target="_blank" rel="noopener noreferrer">VMware documentation</a>.</p></li><li class="list__item" id="f6efb6b5">Install a TeamCity agent, configure and test the machine as described in <a href="teamcity-integration-with-cloud-solutions.html#Preparing-a-virtual-machine">this section</a>.<ul class="list _ul"><li class="list__item" id="80b932cc"><p>If you want TeamCity to start/stop this machine on demand or to clone it, proceed to configuring the VMware <a href="agent-cloud-profile.html">cloud profile</a> on the TeamCity server.  When the profile is modified, TeamCity detects the changes immediately, and forces shutdown of the agents started prior to these changes once the agents finish the current build.</p></li><li class="list__item" id="9e23b854"><p>If you want to create a template of this machine and clone it, refer to the VMware vSphere web site for details on creating <a href="https://pubs.vmware.com/vsphere-51/index.jsp#com.vmware.vsphere.vm_admin.doc/GUID-F40130B0-0194-4A41-91FA-1A967721924B.html" data-external="true" target="_blank" rel="noopener noreferrer">templates</a> and proceed to configuring the VMware <a href="agent-cloud-profile.html">cloud profile</a> on the TeamCity server. Make sure to specify the valid <a href="https://pubs.vmware.com/vsphere-51/topic/com.vmware.vsphere.install.doc/GUID-191D86C8-EEF4-4198-9C11-2E0F25D2AB89.html" data-external="true" target="_blank" rel="noopener noreferrer">vCenter SDK URL</a>.</p></li></ul></li></ol><aside class="note " data-title="" rel="eec26632" id="134e18c4"><p id="874eff8a">When configuring the TeamCity build agent, be sure to specify the valid TeamCity server URL in the build agent properties.</p></aside><a name="NotesonconfiguringAgentcloudprofile"></a><a name="Notes-on-configuring-Agent-cloud-profile"></a><div class="chapter"><h3 id="SettingUpTeamCityforVMwarevSphereandvCenter-NotesonconfiguringAgentcloudprofile">Notes on configuring Agent cloud profile</h3><ul class="list _ul"><li class="list__item" id="98ebf4b5"><p>You can limit a number of instances across all images and/or set the limit per image.</p></li><li class="list__item" id="38626663"><p>It is possible to specify unique hostnames for cloud agents: when adding an image, choose a customization spec from the corresponding field. The option is available for Windows and Linux virtual machines.</p></li><li class="list__item" id="b2b7aa0a"><p>When using the same image in different cloud profiles, to avoid possible conflicts, it is possible to use a custom agent image name when configuring a cloud profile in TeamCity. This can be also useful with naming patterns for agents. When a custom agent image name is specified, the names of cloud agent instances cloned from the image will be based on this name.</p></li></ul><hr id="ebc1b901"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>