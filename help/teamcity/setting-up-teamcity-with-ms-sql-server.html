<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Setting up TeamCity with MS SQL Server - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Setting up TeamCity with MS SQL Server" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/setting-up-an-external-database.md|Setting up an External Database/setting-up-teamcity-with-ms-sql-server.md|Setting up TeamCity with MS SQL Server" data-main-title="Setting up TeamCity with MS SQL Server" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/setting-up-teamcity-with-ms-sql-server.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Setting up TeamCity with MS SQL Server" id="setting-up-teamcity-with-ms-sql-server.md">Setting up TeamCity with MS SQL Server</h1><p id="3ad5171f">On this page:</p><p id="0136a818"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-Prerequisites">Prerequisites</a></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-ConfigureMSSQLservertobeusedwithTeamCity">Configure  MS SQL server to be used with TeamCity</a><ul class="list _bullet"><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-EnableTCP/IPprotocolforyourSQLserver">Enable TCP/IP protocol for your SQL server</a></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-Createnewdatabase">Create new database</a></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-SetupTeamCitydatabaseuser">Set up TeamCity database user</a><ul class="list _bullet"><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-CreatededicateduserforTeamCitywithSQLserverauthentication">Create dedicated user for TeamCity with SQL server authentication</a></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-CreateSQLdatabaseuserwithWindowsauthentication">Create SQL database user with Windows authentication</a></li></ul></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-SetupJDBCDriverforSQLServerdatabase">Set up JDBC Driver for SQL Server database</a><ul class="list _bullet"><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-AdditionalsettingsforWindowsauthentication(MSSQLintegratedsecurity)">Additional settings for Windows authentication (MS SQL integrated security)</a></li></ul></li></ul></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-StartTeamCity">Start TeamCity</a></li><li class="list__item"><a href="#SettingupTeamCitywithMSSQLServer-Post-Setupnotes">Post-Setup notes</a></li></ul></p><a name="Prerequisites"></a><a name="Prerequisites"></a><div class="chapter"><h2 id="SettingupTeamCitywithMSSQLServer-Prerequisites">Prerequisites</h2><ul class="list _ul"><li class="list__item" id="96b2e1ab"><p>MS SQL server</p></li><li class="list__item" id="1447b9aa"><p>MS SQL Server Management Studio</p></li><li class="list__item" id="12681c99"><a href="installation-quick-start.html">Installed TeamCity Server</a></li></ul></div><a name="ConfigureMSSQLservertobeusedwithTeamCity"></a><a name="Configure-MS-SQL-server-to-be-used-with-TeamCity"></a><div class="chapter"><h2 id="SettingupTeamCitywithMSSQLServer-ConfigureMSSQLservertobeusedwithTeamCity">Configure  MS SQL server to be used with TeamCity</h2><a name="EnableTCP/IPprotocolforyourSQLserver"></a><a name="Enable-TCP/IP-protocol-for-your-SQL-server"></a><div class="chapter"><h3 id="SettingupTeamCitywithMSSQLServer-EnableTCP/IPprotocolforyourSQLserver">Enable TCP/IP protocol for your SQL server</h3><p id="dd0360eb">Open SQL Server Configuration Manager and do the following:</p><ol class="list _decimal"><li class="list__item" id="00c14c9a"><p>Expand <i id="e3120ad4">SQL Server Network Configuration</i>, click <i id="9dcf0d3b">Protocols for MS SQL</i>.</p></li><li class="list__item" id="e574c473"><p>In the right pane, right-click <i id="3954c865">TCP/IP</i>, then click <i id="0a9c74c6">Enabled</i> and select <i id="7cd15dc1">Yes</i>. (MS SQL comes with TCP/IP disabled by default.) Click <b id="0da0ea23">OK</b>.<figure><img alt="enableTCP.png" title="enableTCP.png" src="/help/img/teamcity/2019.1/enableTCP.png" id="b423b332" width="1044" height="842"></figure></p></li><li class="list__item" id="526dbbac"><p>You need to restart your MSSQL server for the changes to take effect: in the left pane, click <i id="ccf028b3">SQL Server Services</i>, in the right pane right-click <i id="d00168e9">SQL Server</i> and click <b id="10fe7b85">Restart</b>.</p></li><li class="list__item" id="0cdc5dc2"><p>Check that SQL Server Browser is running.<figure><img alt="SQLServerBrowser.png" title="SQLServerBrowser.png" src="/help/img/teamcity/2019.1/SQLServerBrowser.png" id="c988cd1a" width="1038" height="251"></figure></p></li></ol></div><a name="Createnewdatabase"></a><a name="Create-new-database"></a><div class="chapter"><h3 id="SettingupTeamCitywithMSSQLServer-Createnewdatabase">Create new database</h3><p id="472a3f39">In MS SQL Server Management Studio:</p><ol class="list _decimal"><li class="list__item" id="a7615fc2"><p>Connect to your database server, right-click the <i id="4ab67632">Databases</i> node in the Object Explorer and select <i id="adcb644e">New database</i>.</p></li><li class="list__item" id="f87660db"><p>On the <i id="a229ec06">General</i> page, specify the database name, "TeamCity" in the image below, and allocate sufficient <a href="https://msdn.microsoft.com/en-us/library/ms365418.aspx" data-external="true" target="_blank" rel="noopener noreferrer">transaction log</a> space. The recommended minimum is 1Gb (1024 Mb) in the image below. The requirements vary depending on how intensively the server will be used.<figure><img alt="createDB_new.png" title="createDB_new.png" src="/help/img/teamcity/2019.1/createDB_new.png" id="6ebcf50c" width="1144" height="795"></figure></p></li><li class="list__item" id="a5f73a7a"><p>Next specify the primary collation. Go to the <i id="5375489e">Option</i> node in the left pane and select a collation on the right. We recommend a case-sensitive collation (with the collation name ending with <code class="code">_CS_AS</code>) corresponding to your locale and click <b id="69611a0f">Ok</b> to save the settings:<figure><img alt="collation_new_new.png" title="collation_new_new.png" src="/help/img/teamcity/2019.1/collation_new_new.png" id="01be48c7" width="2044" height="1513"></figure></p></li><li class="list__item" id="bf57cb92"><p>Now make sure the "<code class="code">no count</code>" setting is disabled as follows: Right-click the server instance in Object Explorer, go to <i id="3e859d1c">Properties | Connections</i>. In the <i id="d5724f04">Default Connection Options</i> frame, "<code class="code">no count</code>" must be turned off. Save changes if any.<figure><img alt="noCount.png" title="noCount.png" src="/help/img/teamcity/2019.1/noCount.png" id="329b8007" width="1440" height="900"></figure></p></li></ol></div><a name="SetupTeamCitydatabaseuser"></a><a name="Set-up-TeamCity-database-user"></a><div class="chapter"><h3 id="SettingupTeamCitywithMSSQLServer-SetupTeamCitydatabaseuser">Set up TeamCity database user</h3><p id="5662c6b9">SQL Server supports two ways of authentication: SQL Server authentication and Windows authentication mode.</p><ul class="list _ul"><li class="list__item" id="4748b23b"><p>SQL Authentication requires specifying username and a password in the database settings. It is recommended to start with this authentication before you try to use Windows authentication.</p></li><li class="list__item" id="03a20138"><p>Windows authentication (MS SQL integrated security) allows the TeamCity server running under a specific Windows user connect to the SQL server as that user, without providing a username and a password. However, it requires <a href="#Additional-settings-for-Windows-authentication-(MS-SQL-integrated-security)">additional setup</a></p></li></ul><a name="CreatededicateduserforTeamCitywithSQLserverauthentication"></a><a name="Create-dedicated-user-for-TeamCity-with-SQL-server-authentication"></a><div class="chapter"><h4 id="SettingupTeamCitywithMSSQLServer-CreatededicateduserforTeamCitywithSQLserverauthentication">Create dedicated user for TeamCity with SQL server authentication</h4><ol class="list _decimal"><li class="list__item" id="0c8952a8"><p>Go to the <i id="237ee642">Security</i> node, right-click <i id="aa7d79c5">Logins</i>, select <i id="e2352474">New Login</i>, and in the <i id="0426c44b">General</i> window that opens provide the login name ("TeamCity" on the image below), select the SQL server authentication and provide the password for the user. Set the default database to TeamCity.<figure><img alt="defaultDBTC.png" title="defaultDBTC.png" src="/help/img/teamcity/2019.1/defaultDBTC.png" id="afcf6d56" width="1152" height="798"></figure></p></li><li class="list__item" id="206b0133"><p>Next select <i id="3fca2197">User Mapping</i> in the left pane, in the upper right pane check the TeamCity database in the list and in the lower pane grant the user TeamCity database owner rights: check the "<code class="code">db_owner</code>" box. Click <b id="6406e14b">OK</b>.<figure><img alt="dbowner_new1.png" title="dbowner_new1.png" src="/help/img/teamcity/2019.1/dbowner_new1.png" id="c3f7dbb4" width="1152" height="796"></figure></p></li></ol></div><a name="CreateSQLdatabaseuserwithWindowsauthentication"></a><a name="Create-SQL-database-user-with-Windows-authentication"></a><div class="chapter"><h4 id="SettingupTeamCitywithMSSQLServer-CreateSQLdatabaseuserwithWindowsauthentication">Create SQL database user with Windows authentication</h4><ol class="list _decimal"><li class="list__item" id="b09eb056"><p>Go to the <i id="89a2c411">Security</i> node, right-click <i id="bc45b473">Logins</i>, select <i id="d463e380">New Login</i>, and in the <i id="2baab4ee">General</i> window that opens provide the login name, select Windows authentication, and click the search button.</p></li><li class="list__item" id="607aa9e9"><p>In the <i id="56aea849">Select user or Group</i> dialog, specify the user account which will be used to run TeamCity. Click <b id="783198ef">Check names</b>. Once the user is found, click <b id="45677796">OK</b>.<figure><img alt="6WinAuthNewSQLUser.png" title="6WinAuthNewSQLUser.png" src="/help/img/teamcity/2019.1/6WinAuthNewSQLUser.png" id="fef2aa89" width="1149" height="803"></figure></p></li><li class="list__item" id="966fbd49"><p>Grant this user the DB owner permissions: select <i id="a9321d6b">User Mapping</i> in the left pane, in the upper right pane check the TeamCity database in the list and in the lower pane grant the user TeamCity database owner rights: check the "<code class="code">db_owner</code>" box. Click <b id="d6da58ca">OK</b>.<figure><img alt="7WinAuthNewSQLUser.png" title="7WinAuthNewSQLUser.png" src="/help/img/teamcity/2019.1/7WinAuthNewSQLUser.png" id="0ecfeb3d" width="1150" height="797"></figure></p></li></ol></div></div><a name="SetupJDBCDriverforSQLServerdatabase"></a><a name="Set-up-JDBC-Driver-for-SQL-Server-database"></a><div class="chapter"><h3 id="SettingupTeamCitywithMSSQLServer-SetupJDBCDriverforSQLServerdatabase">Set up JDBC Driver for SQL Server database</h3><ol class="list _decimal"><li class="list__item" id="1b9e5ea6"><p>Download a <a href="https://docs.microsoft.com/en-us/sql/connect/jdbc/download-microsoft-jdbc-driver-for-sql-server" data-external="true" target="_blank" rel="noopener noreferrer">Microsoft JDBC driver version 6.0 or higher</a> (pick <code class="code">.exe</code> or <code class="code">.tar.gz</code> depending on your TeamCity server platform) from the Microsoft Download Center.</p></li><li class="list__item" id="e5aa05a7"><p>Unpack the downloaded package into a temporary directory.</p></li><li class="list__item" id="41ae3133"><p>Copy the <code class="code">sqljdbc42.jar</code> (or <code class="code">mssql-jdbc-&lt;version&gt;.jre8.jar</code> in versions above 6.0) package from the just downloaded package into the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/lib/jdbc</code> directory.</p></li></ol><aside class="note " data-title="" rel="f4d5b7cf" id="d928010c"><p id="5f1917fa">Note that Microsoft JDBC driver v6.0+ has compatibility issues with Microsoft SQL Server 2005. For MS SQL Server 2005, use <a href="https://docs.microsoft.com/en-us/sql/connect/jdbc/download-microsoft-jdbc-driver-for-sql-server" data-external="true" target="_blank" rel="noopener noreferrer">JDBC driver v4.x</a> (<code class="code">exe</code> or <code class="code">.tar.gz</code> depending on your TeamCity server platform).</p></aside><p id="4972611b"><a name="integratedSecurityAuth"></a><a name="SettingupTeamCitywithMSSQLServer-integratedSecurityAuth"></a></p><a name="AdditionalsettingsforWindowsauthentication(MSSQLintegratedsecurity)"></a><a name="Additional-settings-for-Windows-authentication-(MS-SQL-integrated-security)"></a><div class="chapter"><h4 id="SettingupTeamCitywithMSSQLServer-AdditionalsettingsforWindowsauthentication(MSSQLintegratedsecurity)">Additional settings for Windows authentication (MS SQL integrated security)</h4><p id="2a7731b2">For Windows authentication (MS SQL integrated security), in addition to the JDBC driver, it is necessary to install native driver library <code class="code">sqljdbc_auth.dll</code> from the JDBC driver package. The required version of the library depends on the bitness of the Java version used by the server.</p><p id="09bdb2a5">For the default 32-bit JVM bundled with the TeamCity server, copy the <code class="code">&lt;sql_jdbc_home&gt;/enu/auth/x86/sqljdbc_auth.dll</code> file into <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/lib/jdbc/native/windows-i386</code>.<br>For the <a href="installing-and-configuring-the-teamcity-server.html">64-bit JVM</a> used to run the TeamCity server, use the <code class="code">&lt;sql_jdbc_home&gt;/enu/auth/x64/sqljdbc_auth.dll</code> and place it into the <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/lib/jdbc/native/windows-amd64</code> directory.</p></div></div></div><a name="StartTeamCity"></a><a name="Start-TeamCity"></a><div class="chapter"><h2 id="SettingupTeamCitywithMSSQLServer-StartTeamCity">Start TeamCity</h2><ol class="list _decimal"><li class="list__item" id="15d9ddd1"><p>Start the TeamCity server. For Windows authentication (MS SQL integrated security), make sure the server is running under the user <a href="#Create-SQL-database-user-with-Windows-authentication">configured at this step</a>.</p></li><li class="list__item" id="59cf8a30"><p>Select MS SQL as the database.</p></li><li class="list__item" id="c52d0cd4"><p>Click the Refresh the JDBC drivers if asked.</p></li><li class="list__item" id="362efc00">Specify the connection settings:<ul class="list _ul"><li class="list__item" id="a3f535b1"><p>Database host - your SQL server host</p></li><li class="list__item" id="a0602b32"><p>Port - optional</p></li><li class="list__item" id="30824040"><p>Database instance name - leave blank for the default SQL server instance.  If a named instance is used, provide its name here.</p></li><li class="list__item" id="ee867bdd"><p>Database name - the name of the newly created database</p></li></ul></li><li class="list__item" id="e9460668"><p>Select the required authentication type, for SQL Server authentication provide the credentials of the dedicated SQL user <a href="#Create-dedicated-user-for-TeamCity-with-SQL-server-authentication">configured at this step</a>.<figure><img alt="DB_SQLAuth.png" title="DB_SQLAuth.png" src="/help/img/teamcity/2019.1/DB_SQLAuth.png" id="8a90eeec" width="687" height="775"></figure></p></li><li class="list__item" id="8167b395"><p>Continue with the setup. It'll take some time to initialize the database schema and the components.</p></li></ol></div><a name="Post-Setupnotes"></a><a name="Post-Setup-notes"></a><div class="chapter"><h2 id="SettingupTeamCitywithMSSQLServer-Post-Setupnotes">Post-Setup notes</h2><p id="59d2148f">It is recommended to monitor the database performance regularly. For example, perform <a href="https://msdn.microsoft.com/en-us/library/ms189858.aspx#Fragmentation" data-external="true" target="_blank" rel="noopener noreferrer">reindexing</a> every several months.</p><hr id="e104c87b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>