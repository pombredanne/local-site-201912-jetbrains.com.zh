<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Working with Feature Branches - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Working with Feature Branches" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/configuring-vcs-settings.md|Configuring VCS Settings/working-with-feature-branches.md|Working with Feature Branches/branch-filter.md|Branch Filter" data-main-title="Working with Feature Branches" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/working-with-feature-branches.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Working with Feature Branches" id="working-with-feature-branches.md">Working with Feature Branches</h1><p id="f82f3320">Feature Branches in distributed version control systems (DVCS) allow you to work on a feature independently from the main development and commit all the changes for the feature onto the branch, merging the changes into the main branch when your feature is complete. This approach brings a number of advantages to software development teams; however, in continuous integration servers that do not have dedicated support for it, it also causes a number of problems, like constant build configurations duplication, poor visibility, and, in the end, loss of control over the process.</p><p id="d7534fc3">TeamCity support for feature branches is continuously increasing and, among other features, includes <a href="branch-remote-run-trigger.html">Branch Remote Run Trigger</a> starting a new personal build each time TeamCity detects changes in a particular branches of the VCS roots of the build configuration and <a href="automatic-merge.html">Automatic Merge</a> to merge a branch into another after a successful build.</p><p id="c768bb10">On this page:</p><p id="78daeae9"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#WorkingwithFeatureBranches-Supportedversioncontrolsystems">Supported version control systems</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Configuringbranches">Configuring branches</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Defaultbranch">Default branch</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Mybranches">My branches</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Logicalbranchname">Logical branch name</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Builds">Builds</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Changes">Changes</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Activebranches">Active branches</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Tests">Tests</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-FailureConditions">Failure Conditions</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Triggers">Triggers</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Dependencies">Dependencies</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Notifications">Notifications</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Buildconfigurationstatus">Build configuration status</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-MultipleVCSroots">Multiple VCS roots</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Buildparameters">Build parameters</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Clean-up">Clean-up</a></li><li class="list__item"><a href="#WorkingwithFeatureBranches-Manualbranchmerging">Manual branch merging</a></li></ul></p><a name="Supportedversioncontrolsystems"></a><a name="Supported-version-control-systems"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Supportedversioncontrolsystems">Supported version control systems</h2><p id="13ec148f"><a href="git.html">Git</a> and <a href="mercurial.html">Mercurial</a> feature branches are supported as well as Perforce <a href="perforce.html#branch-support">branch streams support</a>.</p><p id="3cbd13ee"><a name="branchSpec"></a><a name="WorkingwithFeatureBranches-branchSpec"></a></p></div><a name="Configuringbranches"></a><a name="Configuring-branches"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Configuringbranches">Configuring branches</h2><p id="96b1c048">To start working with DVCS branches, you need to configure which branches need to be watched for changes. This is done in the <b id="3b8f1c9e">General Settings</b> section of a <a href="git.html">Git</a> or <a href="mercurial.html">Mercurial</a> VCS root via the <b id="c41e9415">Branch Specification</b> field.<br>With Perforce, check the corresponding box to enable feature branches support, which will display the branch specification field. The field accepts a list of branch names or patterns. TeamCity monitors the branches matched by the branch specification in addition to the <a href="#Default-branch">default branch</a>.</p><p id="69ece538">Once you've configured the branch specification, TeamCity will start to monitor these branches for changes. If your build configuration has <a href="configuring-vcs-triggers.html#Branch-Filter">a VCS trigger and a change is found in some branch</a>, TeamCity will trigger a build in this branch. From the build configuration home page you'll also be able to filter the history, change log, pending changes and issue log by the branch name. Branch names will also appear in the custom build dialog, so you'll be able to manually trigger a custom build on a branch too.</p><p id="1d526ea7">The syntax of the branch specification field is newline-delimited list of "<code class="code">+|-:branch_name</code>" rules.</p><a name="OR-syntax-tip"></a><aside class="tip sideblock" data-title="" rel="WorkingwithFeatureBranches-Configuringbranches" id="05a58488"><p id="96dea169">Here, the <i origin="teamcity-help" id="1e8741b7">pipe</i> symbol <code class="code">|</code> represents the <b origin="teamcity-help" id="1c9a0d24">OR</b> command, as in regular expressions: use <code class="code">+</code> for including, <b origin="teamcity-help" id="08f2922c">OR</b> <code class="code">-</code> for excluding.</p></aside><p id="e550e9a9">Each rule can have one optional <code class="code">*</code> placeholder which matches one or more characters.<br>For example, <code class="code">+:refs/heads/teamcity*</code> matches all branches starting with <code class="code">refs/heads/teamcity</code> <b id="fef2d1ed">and at least one additional character</b>.<br>The branch with <code class="code">refs/heads/teamcity</code> will not be matched.</p><p id="7b12ae15">The <code class="code">branch_name</code> parameter is VCS-specific, i.e. <code class="code">refs/heads/master</code> in Git: <figure><img alt="branchSpec.png" title="branchSpec.png" src="/help/img/teamcity/2019.1/branchSpec.png" id="cfbc024f" width="2085" height="249"></figure></p><p id="4dceff47">The part of the branch name matched by the asterisk (<code class="code">*</code>) wildcard becomes the short branch name to be displayed in the TeamCity user-level interface (also known as the <a href="#Logical-branch-name">logical branch name</a>). The line can also contain optional parentheses which, when present, denote the part of the pattern to be used as the logical name instead of just *-matched symbols.</p><p id="44d79e96">You can use parameters in the branch specification.</p><p id="45e2114d">When a single VCS branch is matched by several lines of the branch specification, the most specific (least characters matched by pattern) last rule applies.</p><p id="7e84c2f9">That is, if the specification contains an exact pattern matching the branch (i.e. a pattern without the <code class="code">*</code> wildcard), then the last such pattern is used. So if you have a specification like this:</p><div class="code-block" data-lang="none">+:refs/heads/release-v1
-:refs/heads/release-v1

</div><p id="c29b5879">then the last pattern will win and the branch will be excluded.</p><p id="96f90533">If a branch specification has several patterns with the <code class="code">*</code> wildcard, then TeamCity selects the pattern producing the shortest logical name. This branch specification:</p><div class="code-block" data-lang="none">+:refs/heads/*/hotfix
-:refs/heads/v1/*

</div><p id="011e6dfb">will include the <code class="code">refs/heads/v1/hotfix</code> branch (because "<code class="code">v1</code>" is shorter than "<code class="code">hotfix</code>").<br>If 2 patterns with <code class="code">*</code> wildcard produce logical names of the same length, then the last pattern wins.</p><p id="2e5723f0">The branch specification supports comments as lines beginning with "<code class="code">#"</code>.</p><p id="76b8101b">There is also a special escaping syntax defined via <code class="code">#! escape: CHARACTER</code> syntax: for example, to use round brackets in a branch name, you need to escape them. Let's say you want to track the <code class="code">release-(7.1)</code> branch: to do that, specify an escaping symbol as the first line in the specification. For Mercurial, the following branch specification does that:</p><div class="code-block" data-lang="none">#! escape: \
+:release-\(7.1\)

</div><aside class="tip sideblock" data-title="" rel="fd62a0df" id="f6b3a563"><p id="d0441da0">To run builds on GitHub pull request branches, use the <a href="pull-requests.html">Pull Requests</a> build feature.</p></aside></div><a name="Defaultbranch"></a><a name="Default-branch"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Defaultbranch">Default branch</h2><p id="53d8933a">When configuring a VCS root for DVCS, you need to specify the branch name to be used as the default one. The default branch has special meaning:</p><ul class="list _ul"><li class="list__item" id="9f491715"><p>It is a fallback branch to use when the branch is not specified or the specified branch is not included by the branch specification (for example, when someone just clicks on the <b id="00d8770f">Run</b> button without selecting a branch).</p></li><li class="list__item" id="13e3a1a4"><p>It can be used when displaying sequences of builds and changes and reaching the moment of the branch creation.</p></li><li class="list__item" id="1339f823"><p>The default branch allows using different branches in different VCS roots (for example, if one of the roots is Git and another is Mercurial) and in different builds when they are linked by a snapshot dependency. When the top chain build is triggered in the default branch, all its dependencies will be built in their respective default branches as well.</p></li></ul><p id="ce41de09">Unless disabled via a <a href="branch-filter.html">branch filter</a>, the default branch is always implicitly included into the branch specification. In the TeamCity UI the default branch is marked with the darker background of the branch marker.</p></div><a name="Mybranches"></a><a name="My-branches"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Mybranches">My branches</h2><p id="337c42ba">TeamCity can identify and group branches, based on the commits of the current TeamCity user.</p><p id="2d0f9ee5">Select the <i id="4bffd2c2">My Branches</i> group in the branch filter to display all active branches whose last 100 changes include your commits, based on the defined VSC usernames.</p><p id="3ff8921f"><a name="logicalBranchName"></a><a name="WorkingwithFeatureBranches-logicalBranchName"></a></p></div><a name="Logicalbranchname"></a><a name="Logical-branch-name"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Logicalbranchname">Logical branch name</h2><p id="b1ebfdae">A logical branch name is a branch name shown in the user interface for the builds and on build configuration level. A logical branch name is regularly a part of the full VCS-specific branch name. It is calculated by applying a <a href="#Configuring-branches">branch specification</a> to the branch name from the version control.</p><p id="5ba188bc">For example, if the branch specification is defined like this:</p><div class="code-block" data-lang="none">+:refs/heads/*

</div><p id="4ed2203f">then the part matched by <code class="code">*</code> (for example, <code class="code">master</code>) is a logical branch name.</p><p id="99a2b12b">If the branch specification pattern uses parentheses, the logical name then is made up of the part of the name within the parentheses; to see the <code class="code">v8.1/feature1</code> logical name displayed in the UI for the VCS branch <code class="code">refs/heads/v8.1/feature1</code>, use this:</p><div class="code-block" data-lang="none">+:refs/heads/(v8.1/*)

</div><p id="2ab1dc22">You do not need to include the default branch into the branch specification as it is already included there implicitly. But, if you want to have some short logical branch name for the default branch in the UI, for example, <code class="code">master</code>, you can include it in the branch specification and use the parentheses:</p><div class="code-block" data-lang="none">+:refs/heads/(master)

</div></div><a name="Builds"></a><a name="Builds"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Builds">Builds</h2><p id="04d21b72">Builds from branches are easily recognizable in the TeamCity UI, because they are marked with a special label:</p><p id="f1780f4c"><figure><img alt="branches.png" title="branches.png" src="/help/img/teamcity/2019.1/branches.png" id="5af4534d" width="1852" height="774"></figure></p><p id="af7c36ff">You can also filter history by a branch name if you're interested in a particular branch. TeamCity assigns a branch label to the builds from the default branch too.</p></div><a name="Changes"></a><a name="Changes"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Changes">Changes</h2><p id="498ae29d">For each build TeamCity shows changes included in it. For builds from branches the changes calculation process takes the branch into account and presents you with the changes relevant to the build branch. The changes for a build in a branch are calculated as the changes from the build's revision to the previous build in the branch or a build in the default branch.<br>The change log with its graph of commits will help you understand what is going on in the monitored branches.</p><p id="82547a8c"><figure><img alt="branchesChange.png" title="branchesChange.png" src="/help/img/teamcity/2019.1/branchesChange.png" id="f0cbf0f8" width="1886" height="1654"></figure></p><p id="2c99f799">With the <b id="37cc60c8">Show graph</b> option enabled by default TeamCity displays build markers on the graph.</p><p id="a4526bcc"><a name="ActiveBranches"></a><a name="WorkingwithFeatureBranches-ActiveBranches"></a></p></div><a name="Activebranches"></a><a name="Active-branches"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Activebranches">Active branches</h2><p id="74cd62ed">In a build configuration with configured branches, most UI pages show active branches by default.</p><p id="b922b153">An <i id="cea18e40">active branch</i> is a branch with the recent activity: it has recent builds or exists in the repository with recent commits.</p><p id="5cb9dfbb">The threshold for activity can be configured via build configuration parameters. The parameters can be changed either in a build configuration (this will affect one build configuration only), project, or in the <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">internal properties</a> (this defines defaults for the entire server). A parameter in the configuration overrides a parameter in the <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">internal properties</a>.</p><p id="6983e0bf">A branch is considered active if:</p><ul class="list _ul"><li class="list__item" id="03429b8e"><p>it is present in the VCS repository and has recent commits (i.e. commits with the age less than the value of the <code class="code">teamcity.activeVcsBranch.age.days</code> parameter, 7 days by default).</p></li><li class="list__item" id="238480b2"><p>or it has recent builds (i.e. builds with the age less than the value of <code class="code">teamcity.activeBuildBranch.age.hours</code> parameter, 24 hours by default).<br>A closed VCS branch with builds will still be displayed as active during 24 hours after last build. To remove closed branches from display, set <code class="code">teamcity.activeBuildBranch.age.hours=0</code>.</p></li></ul></div><a name="Tests"></a><a name="Tests"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Tests">Tests</h2><p id="359addf4">TeamCity tries to detect new failing tests in a build, and for those tests which are not new, you can see in which build the test started to fail. This functionality is aware of branches too, i.e. when the first build is calculated, TeamCity traverses builds from the same branch.</p><p id="d53f7e32">Additionally, a <a href="branch-filter.html">branch filter</a> is available on the test details page and you can see a history of test passes or failures in a single branch.</p></div><a name="FailureConditions"></a><a name="Failure-Conditions"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-FailureConditions">Failure Conditions</h2><p id="3c89bc02">If a build failure condition is configured as follows:  <i id="76e7e5b4">build metric has changed comparing to a last successful/finished/pinned build</i>, then the build from the same branch will be used. If there is no suitable build on the same branch, then build from default branch is used and the corresponding message is added to the build log.</p></div><a name="Triggers"></a><a name="Triggers"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Triggers">Triggers</h2><p id="2dd18375">The VCS trigger is fully aware of branches and will trigger a build once a check-in is detected in a branch. All VCS trigger options like per-checkin triggering, quiet period, and triggering rules are directly available for builds from branches. By default, the Schedule and Finish build trigger will watch for builds in the default branch only.</p><p id="d06b5722">Additionally, a <a href="branch-filter.html">branch filter</a> can be specified for the VCS, Schedule and Finish build triggers.</p></div><a name="Dependencies"></a><a name="Dependencies"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Dependencies">Dependencies</h2><p id="cc8602f4">If a build configuration with branches has snapshot dependencies on other build configurations with branches, then when a build in a branch is triggered, the other builds in the chain will also get the branch associated, if the branches in the VCS roots of the builds have the same <a href="#Logical-branch-name">logical name</a> and this branch is not excluded by the branch specification. The VCS roots of the builds can point to different repositories, but the logical branch name must be the same.</p><p id="3f5a60f9">If this condition is met, the branches with this name will be checked out and all the builds down the chain (which the build triggered depends on) and all the builds up the chain (depending on the triggered build) will be marked with the same branch.  Otherwise the default branch will be checked out.</p><p id="724b9b34">It is possible to configure artifact dependencies to retrieve artifacts from a build from a specific branch: artifact dependencies will use builds from the branch specified. The same applies to the <a href="configuring-schedule-triggers.html">Schedule</a> and <a href="configuring-finish-build-trigger.html">Finish Build</a> triggers.</p></div><a name="Notifications"></a><a name="Notifications"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Notifications">Notifications</h2><p id="796a78b2">All notification rules except "My changes" will only notify you on builds from the default branch. At the same time, the "My changes" rule will work for builds from all available branches.</p></div><a name="Buildconfigurationstatus"></a><a name="Build-configuration-status"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Buildconfigurationstatus">Build configuration status</h2><p id="5bf13853">The Build Configuration status is calculated based on the builds from the default branch only. Consequently, per-configuration investigation works for builds from the default branch. For example, a successful build from a non-default branch will not remove a per-configuration investigation, but a successful build from the default branch will.</p></div><a name="MultipleVCSroots"></a><a name="Multiple-VCS-roots"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-MultipleVCSroots">Multiple VCS roots</h2><p id="641c70b1">If your build configuration uses more than one VCS root and you specified branches to monitor in both VCS roots, the way the builds are triggered is more complicated.</p><p id="bc001e78">The VCS trigger groups branches from several VCS roots by <a href="#Logical-branch-name">logical branch names</a>. When some root does not have a branch from the other root, its default branch is used. For example, you have 2 VCS roots, both have the default branch <code class="code">refs/heads/master</code>, the first root has the branch specification <code class="code">refs/heads/7.1/*</code> and changes in branches <code class="code">refs/heads/7.1/feature1</code> and <code class="code">refs/heads/7.1/feature2</code>, the second root has the specification <code class="code">refs/heads/devel/*</code> and changes in branch <code class="code">refs/heads/devel/feature1</code>. In this case VCS trigger runs 3 builds with revisions from following branches combinations:</p><div class="table-wrapper"><table width="100%" id="2a236ca5"><thead><tr id="6f05777d" class="ijRowHead"><th id="599f258d"><p id="4223e6ec">root1</p></th><th id="79d9b673"><p id="c28353b6">root2</p></th></tr></thead><tbody><tr id="5654a7a0" class="ijRowOdd"><td id="fb3edd7e"><p id="9cd59868">refs/heads/master</p></td><td id="b4f3517f"><p id="6e36f2de">refs/heads/master</p></td></tr><tr id="6d21fc88" class="ijRowEven"><td id="5c2e41a6"><p id="0ba2e51a">refs/heads/7.1/feature1</p></td><td id="6628da43"><p id="49468ef5">refs/heads/devel/feature1</p></td></tr><tr id="de7ecd52" class="ijRowOdd"><td id="bcd63d79"><p id="2c7a7d5f">refs/heads/7.1/feature2</p></td><td id="d06b9139"><p id="fc3795f3">refs/heads/master</p></td></tr></tbody></table></div></div><a name="Buildparameters"></a><a name="Build-parameters"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Buildparameters">Build parameters</h2><p id="8326d5c2">If you need to get the branch name in the build script or use it in other build configuration settings as a parameter, refer to <a href="predefined-build-parameters.html">Predefined Build Parameters</a>.</p></div><a name="Clean-up"></a><a name="Clean-up"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Clean-up">Clean-up</h2><p id="d51bd91c">Clean-up rules are applied <a href="clean-up.html#Clean-up-in-Build-Configurations-with-Feature-Branches">independently</a> to each <a href="#Active-branches">active branch</a>.</p></div><a name="Manualbranchmerging"></a><a name="Manual-branch-merging"></a><div class="chapter"><h2 id="WorkingwithFeatureBranches-Manualbranchmerging">Manual branch merging</h2><p id="961b6ada">You can merge branches in TeamCity manually, for example, if you want to merge branches only after a code review / approval, or if you want to perform the merge despite the tests failure in a branch.</p><p id="316c1c4b"><b id="a184924e">To merge sources manually</b>:</p><p id="ec92c8f0">Open the <a href="working-with-build-results.html">build results page</a>, click the <b id="1bafb390">Actions</b> menu in the upper right corner and select "<b id="aec495c1">Merge this build sources</b>".<br>The dialog that appears enables you to select the destination branch and add a commit message (required).</p><p id="0ef46164">It is also possible to merge branches <a href="automatic-merge.html">automatically</a>.</p><hr id="e618378e"><p id="bf9225aa"><b id="b1d13789">See also:</b></p><p id="8e51e636"><b id="d56fc315">Administrator's Guide</b>: <a href="git.html">Git</a> | <a href="mercurial.html">Mercurial</a></p><hr id="9cb81c71"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>