<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Dependent Build - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Dependent Build" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/dependent-build.md|Dependent Build" data-main-title="Dependent Build" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/dependent-build.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Dependent Build" id="dependent-build.md">Dependent Build</h1><p id="c56f0344">In TeamCity, one build configuration can depend on one or more configurations. Two types of dependencies can be specified:</p><ul class="list _ul"><li class="list__item" id="7048379f"><a href="#Snapshot-Dependency">Snapshot Dependency</a></li><li class="list__item" id="40d8bc43"><a href="#Artifact-Dependency">Artifact Dependency</a></li></ul><p id="55a233b8">An <i id="c0bb742c">artifact dependency</i> is just a way to get artifacts produced by one build into another. Without a corresponding <i id="63afe128">snapshot dependency</i>, it is mainly used when the build configurations are not related in terms of sources. For example, one build provides a reusable component for others.<br>A snapshot dependency influences the way builds are processed and implies that the builds are deeply related, one build being a logic part of another.</p><a name="SnapshotDependency"></a><a name="Snapshot-Dependency"></a><div class="chapter"><h2 id="DependentBuild-SnapshotDependency">Snapshot Dependency</h2><p id="097c7231"><i id="0fe084f2">Snapshot Dependency</i> is a powerful concept that allows expressing source-level dependencies between build configurations in TeamCity. The primary goal is to allow complex build procedures via creating different build configurations linked with snapshot dependencies. This, in particular, allows dividing a single monolith build into a set of interlinked builds (<a href="build-chain.html">Build Chain</a>) with flexible reuse rules. TeamCity follows the declarative style of defining the build structure on this level (declaring dependencies rather than adding build triggers) as it allows for more flexible and powerful features.</p><p id="382eaebc">See <a href="build-dependencies-setup.html">Build Dependencies Setup</a> for a description of typical snapshot dependencies usages and related blog posts: <a href="https://blog.jetbrains.com/teamcity/2019/09/build-chains-teamcitys-blend-of-pipelines-part-1-getting-started/" data-external="true" target="_blank" rel="noopener noreferrer">September 2019</a>, <a href="http://blog.jetbrains.com/teamcity/2016/03/teamcity-take-on-build-pipelines/" data-external="true" target="_blank" rel="noopener noreferrer">March 2016</a>, <a href="http://blog.jetbrains.com/teamcity/2012/04/teamcity-build-dependencies-2/" data-external="true" target="_blank" rel="noopener noreferrer">April 2012</a>.</p><p id="5e0e5092">A snapshot dependency of build configuration A on build configuration B ensures that each build of A has a <a href="snapshot-dependencies.html#Suitable-Builds">"suitable" build</a> of B before build of A can start. Both builds of A and B use the same sources snapshot (revision of the sources being the same or taken at the same time if the VCS roots are different) when they belong to the same chain and when revisions synchronization is enforced. If revisions synchronization is not enforced, then build A can use up-to-date revisions when promoting a finished build B to A (read more in <a href="build-chain.html#Disabling-Revisions-Synchronization-Between-Chain-Parts">Build Chain</a>).</p><p id="fe4207bd">The build results page of a build with snapshot dependencies allows reviewing all the dependency builds and their errors, if there are any.</p><p id="b9d5e69f">A snapshot dependency alters the builds behavior in the following way:</p><ul class="list _ul"><li class="list__item" id="52fdd37f"><p>when a build is queued, so are the builds from all the Build Configurations it snapshot-depends on, transitively; TeamCity then determines the revisions to be used by the builds ("checking for changes" process).</p></li><li class="list__item" id="451d9d89"><p>if some of the build configurations already have started builds with matching changes ("suitable builds") and the snapshot dependency has the "<i id="90eb6ac8">Do not run new build if there is a suitable one</i>" option ON, TeamCity optimizes the queued builds by using an already finished builds instead of the queued ones. Corresponding queued builds are then silently removed. This procedure can be performed several times, because, while builds of the chain remain in the queue, new builds may start and finish;</p></li><li class="list__item" id="33f76028"><p>all builds linked via snapshot dependencies are started by TeamCity with explicit specification of the sources revision. The revision is calculated so that it corresponds to the same moment in time (for the same VCS root it is the same revision number). For a queued build chain (all builds linked with a snapshot dependency), the revision to use is determined after adding builds to the queue. At this time, all the VCS roots of the chain are checked for changes and the current revision is fixed in the builds;</p></li><li class="list__item" id="a354a3fb"><p>if there is a snapshot dependency and artifact dependency on the <b id="663f88a6">Build from the same chain</b> pointing to the same build configuration, TeamCity ensures the download of artifacts from the same-sources build.</p></li><li class="list__item" id="b11d5dc3"><p>by default, builds that are a part of a build chain are preserved from clean-up, but this can be switched on a per-build configuration basis. Refer to the <a href="clean-up.html">Clean-Up</a> description for more details.</p></li></ul><p id="9cf60369">Depending on the dependencies, topology builds can run sequentially or in parallel.</p><p id="a5dbe68a">Behavior on the build chain continuation in case of a build failure is customizable via the snapshot dependency options. For each failed or failed to start dependency you can select one of the four options:</p><ul class="list _ul"><li class="list__item" id="715ecafd"><p><b id="bc208956">Run build, but add problem</b>: the dependent build will be run and the problem will be added to it, changing its status to failed (if a problem was not muted earlier)</p></li><li class="list__item" id="63bad57d"><p><b id="0526ee9b">Run build, but do not add problem</b>: the dependent build will be run and no problems will be added</p></li><li class="list__item" id="dee6b0fe"><p><b id="b36c1870">Make build failed to start</b>: the dependent build will not run and will be marked as "Failed to start"</p></li><li class="list__item" id="4cf46fc9"><p><b id="06bde271">Cancel build</b>: the dependent build will not run and will be marked as "Canceled".</p></li></ul><p id="393d4f3b">A build of a chain can <a href="predefined-build-parameters.html#Dependencies-Properties">reference parameters</a> from the preceding builds via <code class="code">dep.&lt;configurationId&gt;.&lt;parameterName&gt;</code> syntax.</p><p id="c22ee45e">There is a <a href="predefined-build-parameters.html#Overriding-Dependencies-Properties">special support</a> for pushing parameters down the chain when a build with snapshot dependencies is triggered. It is done by defining a parameter with <code class="code">reverse.dep.&lt;configurationId&gt;.&lt;parameterName&gt;</code> name.</p><p id="12045949">When setting up <b id="6c9d6ee9">triggers</b> for the builds in the chain, the recommended approach is: <i id="4c252ff6">think about the result</i> â€“ the build you want to get at the end of the process, and configure triggers in its corresponding, "top" build configuration. No triggers are necessary in the build configurations this top one depends on, as their builds will be put into the queue automatically when the top one is triggered.<br>See also the related "Trigger on changes in snapshot dependencies" <a href="configuring-vcs-triggers.html#Trigger-a-build-on-changes-in-snapshot-dependencies">setting</a> of a VCS trigger and the "Show changes from snapshot dependencies" <a href="build-dependencies-setup.html#show-changes-from-dependencies">checkbox</a> in the "Version Control Settings" configuration section.</p><p id="a04a903d">Let's consider an example to illustrate how snapshot dependencies work.</p><p id="9e8e4a18">Let's assume that we have two build configurations, A and B, and configuration A has a snapshot dependency on configuration B and revisions synchronization is enforced.</p><aside class="tip sideblock" data-title="" rel="9e8e4a18" id="db701f9f"><p id="d8da7315">If the build configurations connected with a snapshot dependency <a href="configuring-vcs-roots.html">share the same set of VCS roots</a>, all builds will run on the same sources. Otherwise, if the VCS roots are different, changes in the VCS will correspond to the same moment in time.</p></aside><ol class="list _decimal"><li class="list__item" id="44019220"><p>When a build of configuration A is triggered, it automatically triggers a build of configuration B, and both builds will be placed into the Build Queue. Build B starts first and build A will wait in the queue till build B is finished (<a href="snapshot-dependencies.html">if no other specific options are set</a>).</p></li><li class="list__item" id="d2e2796b"><p>When builds B and A are added to the queue, TeamCity adjusts the sources to include in these builds. All builds will be run with the sources taken at the moment the builds were added to the queue.</p></li><li class="list__item" id="aab27557"><p>When the build B has finished and if it finished successfully, TeamCity will start to run build A.</p></li></ol><aside class="tip sideblock" data-title="" rel="2a6cdad7" id="3b4cc3f3"><p id="39757492">Note that the changes to be included in build A could have become not the latest ones by the moment the build started to run. In this case, build A becomes a <a href="history-build.html">history build</a>.</p></aside><p id="a20bd05f">The example above shows the core basics of snapshot dependencies as a straightforward process without any additional options. For snapshot dependency options, refer to the <a href="snapshot-dependencies.html">Snapshot Dependencies</a> page.</p></div><a name="ArtifactDependency"></a><a name="Artifact-Dependency"></a><div class="chapter"><h2 id="DependentBuild-ArtifactDependency">Artifact Dependency</h2><aside class="tip sideblock" data-title="" rel="DependentBuild-ArtifactDependency" id="3cd7b936"><p id="4cc883ca">Note that if both a snapshot dependency and an artifact dependency are configured for the same build configuration, in order for it to take artifacts from the build with the same sources, the <b id="d116f8e9">Build from the same chain</b> option must be selected in the artifact dependency.</p></aside><p id="15517b09">Artifact Dependencies provide you with a convenient means to use the output (<a href="build-artifact.html">artifacts</a>) of one build in another build. When an artifact dependency is configured, the necessary artifacts are downloaded to the agent before the build starts. You can then review what artifacts were used in the build or what build used the artifacts of the current build using the <b id="ebc6c1cc">Dependencies</b> tab of build results.</p><p id="554b304d">To create and configure an artifact dependency, use the <b id="b593d03d"><a href="artifact-dependencies.html">Dependencies</a></b> build configuration settings page. If you need to download the artifacts inside a build script or locally, you can use the <a href="rest-api.html">REST API</a> or <a href="artifact-dependencies.html">Ivy Ant tasks</a> for that.</p><p id="9183abfc"><b id="010f4993">Notes on Cleaning Up Artifacts</b></p><p id="b7ef3acf">Artifacts may not be <a href="clean-up.html">cleaned</a> if they were downloaded by other builds and these builds are not yet cleaned up. For a build configuration with configured artifact dependencies, you can specify whether the artifacts downloaded by this configuration from other builds can be cleaned or not. This setting is available on the <a href="clean-up.html">cleanup policies</a> page.</p><hr id="82223cf8"><p id="52387c90"><b id="738d8869">See also:</b></p><p id="3cd4b5b9"><b id="0b47458a">Concepts</b>: <a href="build-artifact.html">Build Artifact</a> | <a href="build-dependencies-setup.html">Build Dependencies Setup</a><br><b id="11ddf405">Administrator's Guide</b>: <a href="configuring-dependencies.html">Configuring Dependencies</a></p><hr id="68377627"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>