<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>构建结帐目录-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Build Checkout Directory" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/build-checkout-directory.md|Build Checkout Directory" data-main-title="Build Checkout Directory" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-checkout-directory.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-checkout-directory.md" data-toc="Build Checkout Directory">建立结帐目录</h1><p id="00eb59d5"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildCheckoutDirectory-CheckoutProcess">结帐流程</a></li><li class="list__item"><a href="#BuildCheckoutDirectory-Customcheckoutdirectory">自定义结帐目录</a></li><li class="list__item"><a href="#BuildCheckoutDirectory-AutomaticCheckoutDirectoryCleaning">自动结帐目录清理</a></li></ul><p></p><p id="32d43b59"><i id="716c9d0f">构建签出目录</i>是TeamCity代理计算机上的目录，所有构建的所有源都被签入到该目录中。</p><ul class="list _ul"><li class="list__item" id="870f201d"><p>如果使用<a href="vcs-checkout-mode.html#agent-checkout">代理端检出模式</a> ，则构建代理会在构建之前将源签出到此目录中。</p></li><li class="list__item" id="128216ea"><p>如果使用<a href="vcs-checkout-mode.html#server-checkout">服务器端检出模式</a> ，TeamCity服务器会将增量补丁发送到代理，以仅更新自给定检出目录中上次构建以来更改的文件。</p></li><li class="list__item" id="5cc09b53"><p>在<a href="vcs-checkout-mode.html#do-not-checkout-files-automatically">手动检出</a>模式下，不会检出任何源，但是仍将创建默认的构建检出目录以通过构建脚本检出源。除非按<a href="#Automatic-Checkout-Directory-Cleaning">以下说明</a>配置有效期，否则不会自动清除该目录。</p></li></ul><p id="3f161fdd">根据<a href="vcs-checkout-rules.html">VCS Checkout Rules中</a>定义的映射，将源放置在checkout目录中。</p><p id="bbb5ae20">检出目录是在“ <a href="configuring-vcs-triggers.html">版本控制设置”</a>页面上的“ <b id="c9a49abc">检出设置”</b>部分中配置的；默认的<b id="620eb6c5">自动（推荐）</b>值，强烈建议，但也可以作为描述配置自定义检出目录<a href="#Custom-checkout-directory">下面</a> 。</p><p id="b0ef2e10">如果您想调查问题并需要了解构建配置所使用的目录，则可以从构建日志中获取该目录，或者可以参考<code class="code"><</code> <a href="agent-work-directory.html"><code class="code">Agent Work Directory</code></a> <code class="code">>/directory.map</code>生成的文件，其中列出了构建配置以及它们最后使用的目录。</p><p id="43749493">在您的<a href="build-script-interaction-with-teamcity.html">构建脚本中，</a>您可以通过以下方式引用构建签出目录的有效值： <code class="code">teamcity.build.checkoutDir</code>由TeamCity提供的<a href="configuring-build-parameters.html">属性</a> 。</p><p id="97079b97">默认情况下，这也是<a href="build-working-directory.html">构建将运行</a>的目录。</p><a name="CheckoutProcess"></a><a name="Checkout-Process"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-CheckoutProcess">结帐流程</h2><p id="d912cc5d">对于由TeamCity处理的签出（ <a href="vcs-checkout-mode.html#server-checkout">服务器端</a>或<a href="vcs-checkout-mode.html#agent-checkout">代理端</a>签出模式），TeamCity会将上次签出的修订跟踪到代理上的每个签出目录中，并且对于新版本，将从上次使用的修订中应用增量补丁。当前版本的修订。<br>可以在构建结果页面的“ <b id="9c433464"><a href="working-with-build-results.html#Changes">更改”</a></b>选项卡上查找所使用的修订。</p><p id="f36e7b41">增量检出意味着未由TeamCity创建或修改（例如，由先前的构建脚本创建或修改）的任何文件均以修改后的状态保留（除非使用了专用的VCS根目录特定的重置选项）。<br>因此，建议：</p><ul class="list _ul"><li class="list__item" id="6bdccfa0"><p>确保对于所有影响该构建并且可能是先前构建生成的文件，构建作为构建的第一步执行干净的过程。典型的文件是编译输出，测试报告，构建生产工件。</p></li><li class="list__item" id="64c08612"><p>确保版本永远不会在版本控制下修改或删除文件。</p></li></ul><p id="2096df22">如果TeamCity检测到无法构建增量补丁，则强制执行<a href="clean-checkout.html">干净签</a>出。也可以手动执行它，也可以配置为在每个构建上执行。</p></div><a name="Customcheckoutdirectory"></a><a name="Custom-checkout-directory"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-Customcheckoutdirectory">自定义结帐目录</h2><p id="53de96d6">在大多数情况下，默认的<b id="b8020899">自动（推荐）</b>设置可以满足您的需求。使用此默认签出目录，TeamCity可确保最佳性能和一致的增量源更新。默认自动创建目录的名称生成如下： <code class="code"><</code> <a href="agent-work-directory.html"><code class="code">Agent Work Directory</code></a> <code class="code">>/<VCS settings hash code></code> 。VCS设置哈希码是基于VCS根集，其签出规则和构建配置使用的VCS设置（签出模式）计算的。实际上，这意味着该目录在具有相同VCS设置的所有构建配置之间共享。</p><p id="80157bbf">如果出于某种原因需要指定自定义检出目录（例如，生成版本的过程取决于某些特定目录），请确保满足以下条件：</p><ul class="list _ul"><li class="list__item" id="07f98d79"><p>使用不同VCS设置的构建配置之间不会共享检出目录（否则，每次在目录中构建另一个构建配置时，TeamCity都会执行<a href="clean-checkout.html">干净检出</a> ）；</p></li><li class="list__item" id="4000621b"><p>目录的内容不会被单个TeamCity代理的进程修改（否则，TeamCity可能无法确保一致的增量源更新）。如果无法消除这种情况，请确保为所有参与的构建配置打开clean build checkout选项。此规则也适用于共享同一工作目录的两个TeamCity代理。由于一个TeamCity代理不了解另一个代理，因此另一个代理对它来说是一个外部过程。</p></li></ul><aside class="warning " rel="cb329364" id="6861ac25" data-title=""><p id="fbd79f4f">建议自定义结帐目录<b id="c1172146">不包含</b> <a href="build-working-directory.html">代理的工作目录，</a>因为这可能会带来不良的副作用。</p></aside><p id="8def9227">请注意，在<a href="clean-checkout.html#Automatic-Clean-Checkout">某些情况下</a> ，TeamCity可以删除checkout目录的内容。</p></div><a name="AutomaticCheckoutDirectoryCleaning"></a><a name="Automatic-Checkout-Directory-Cleaning"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-AutomaticCheckoutDirectoryCleaning">自动结帐目录清理</h2><p id="633d1f48">在<a href="vcs-checkout-mode.html#server-checkout">服务器端</a>和<a href="vcs-checkout-mode.html#agent-checkout">代理端检出</a>模式下，如果在指定的时间段内（默认为8天）未使用检出目录（未使用目录作为检出目录在代理上运行任何版本），则会自动从磁盘中删除检出目录。 ）或其他版本需要更多可用磁盘空间时。在<a href="vcs-checkout-mode.html#do-not-checkout-files-automatically">手动签出</a>模式下，除非配置了目录有效期限，否则不执行自动目录清除。</p><p id="ad31a160">建议使用“可用<a href="free-disk-space.html">磁盘空间”</a>构建功能，以确保构建在构建代理上获得足够的磁盘可用空间。</p><p id="cdf39d8a">对于旧的检出目录清除，还有一些过时的手动控件：</p><p id="371c0551">可以通过以下两种方式之一指定一个新值（以小时为单位）来更改目录自动失效的时间范围：</p><ul class="list _ul"><li class="list__item" id="5db3d9df"><p><code class="code">teamcity.agent.build.checkoutDir.expireHours</code>中的代理属性<code class="code">buildAgent.properties</code>文件</p></li><li class="list__item" id="a6e61583"><code class="code">system.teamcity.build.checkoutDir.expireHours</code> <a href="configuring-build-parameters.html">构建配置属性</a><ul class="list _ul"><li class="list__item" id="6c74cf8d"><p><code class="code">0</code>将在构建完成后立即删除检出目录</p></li><li class="list__item" id="76435344"><p><code class="code">never</code>将使TeamCity知道该目录永远不能被TeamCity删除</p></li><li class="list__item" id="eab4876f"><p><code class="code">default</code>将强制使用默认值</p></li></ul></li></ul><p id="32e72b41">当构建代理处于空闲状态（没有构建正在运行）时，将在后台执行基于过期的目录清除。</p><hr id="b5fd0729"><p id="450254fa"><b id="9e84a236">也可以看看：</b></p><p id="6bc939a7"><b id="e99b14c6">管理员指南</b> ： <a href="configuring-vcs-settings.html">配置VCS设置</a></p><hr id="209d942b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>