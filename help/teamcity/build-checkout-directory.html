<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Build Checkout Directory - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Build Checkout Directory" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/build-checkout-directory.md|Build Checkout Directory" data-main-title="Build Checkout Directory" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-checkout-directory.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Build Checkout Directory" id="build-checkout-directory.md">Build Checkout Directory</h1><p id="00eb59d5"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildCheckoutDirectory-CheckoutProcess">Checkout Process</a></li><li class="list__item"><a href="#BuildCheckoutDirectory-Customcheckoutdirectory">Custom checkout directory</a></li><li class="list__item"><a href="#BuildCheckoutDirectory-AutomaticCheckoutDirectoryCleaning">Automatic Checkout Directory Cleaning</a></li></ul></p><p id="32d43b59">The <i id="716c9d0f">build checkout directory</i> is a directory on the TeamCity agent machine where all the sources of all builds are checked out into.</p><ul class="list _ul"><li class="list__item" id="870f201d"><p>If you use the <a href="vcs-checkout-mode.html#agent-checkout">agent-side checkout mode</a>, the build agent checks out the sources into this directory before the build.</p></li><li class="list__item" id="128216ea"><p>In case you use the <a href="vcs-checkout-mode.html#server-checkout">server-side checkout mode</a>, the TeamCity server sends incremental patches to the agent to update only the files changed since the last build in the given checkout directory.</p></li><li class="list__item" id="5cc09b53"><p>With the <a href="vcs-checkout-mode.html#do-not-checkout-files-automatically">manual checkout</a> mode, no sources will be checked out, but the default build checkout directory will still be created to check out the sources via a build script. The directory will not be cleaned automatically unless its expiration period is configured as <a href="#Automatic-Checkout-Directory-Cleaning">described below</a>.</p></li></ul><p id="3f161fdd">The sources are placed into the checkout directory according to the mapping defined in the <a href="vcs-checkout-rules.html">VCS Checkout Rules</a>.</p><p id="bbb5ae20">The checkout directory is configured in the <b id="c9a49abc">Checkout Settings</b> section on the <a href="configuring-vcs-triggers.html">Version Control Settings</a> page; the default <b id="620eb6c5">Auto (recommended)</b> value is strongly advised, but it is possible to configure a custom checkout directory as described <a href="#Custom-checkout-directory">below</a>.</p><p id="b0ef2e10">If you want to investigate an issue and need to know the directory used by the build configuration, you can get the directory from the build log, or you can refer to the <code class="code">&lt;</code><a href="agent-work-directory.html"><code class="code">Agent Work Directory</code></a><code class="code">&gt;/directory.map</code> generated file which lists build configurations with the directories they used last.</p><p id="43749493">In your <a href="build-script-interaction-with-teamcity.html">build script</a> you can refer to the effective value of the build checkout directory via the <code class="code">teamcity.build.checkoutDir</code> <a href="configuring-build-parameters.html">property</a> provided by TeamCity.</p><p id="97079b97">By default, this is also the directory <a href="build-working-directory.html">where builds will run</a>.</p><a name="CheckoutProcess"></a><a name="Checkout-Process"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-CheckoutProcess">Checkout Process</h2><p id="d912cc5d">For checkout handled by TeamCity (the <a href="vcs-checkout-mode.html#server-checkout">server-side</a> or <a href="vcs-checkout-mode.html#agent-checkout">agent-side</a> checkout mode), TeamCity keeps track of the last revision checked out into each checkout directory on the agent and for the new build applies an incremental patch from the last used revision to the revision of the current build.<br>The revisions used can be looked up on the <b id="9c433464"><a href="working-with-build-results.html#Changes">Changes</a></b> tab of the build results page.</p><p id="f36e7b41">Incremental checkouts mean that any files not created or modified by TeamCity (for example, by the previous build scripts) are preserved in their modified state (unless dedicated VCS root-specific reset options are used).<br>That is why it is recommended to:</p><ul class="list _ul"><li class="list__item" id="6bdccfa0"><p>make sure the builds perform a clean procedure as the first step of the build for all the files that affect the build and might have been produced by previous builds. Typical files are compilation output, tests reports, build produce artifacts.</p></li><li class="list__item" id="64c08612"><p>make sure the builds never modify or delete the files under version control.</p></li></ul><p id="2096df22">If TeamCity detects that it cannot build an incremental patch, a <a href="clean-checkout.html">clean checkout</a> in enforced. It can also be enforced manually or configured to be performed on each build.</p></div><a name="Customcheckoutdirectory"></a><a name="Custom-checkout-directory"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-Customcheckoutdirectory">Custom checkout directory</h2><p id="53de96d6">In most cases, the default <b id="b8020899">Auto (recommended)</b> setting will cover your needs. With this default checkout directory, TeamCity ensures the best performance and consistent incremental sources updates. The name of the default automatically created directory is generated as follows: <code class="code">&lt;</code><a href="agent-work-directory.html"><code class="code">Agent Work Directory</code></a><code class="code">&gt;/&lt;VCS settings hash code&gt;</code>. The VCS settings hash code is calculated based on the set of VCS roots, their checkout rules and VCS settings used by the build configuration (checkout mode). Effectively, this means that the directory is shared between all the build configurations with the same VCS settings.</p><p id="80157bbf">If for some reason you need to specify a custom checkout directory (for example, the process of creating builds depends on some particular directory), make sure that the following conditions are met:</p><ul class="list _ul"><li class="list__item" id="07f98d79"><p>the checkout directory is not shared between build configurations with different VCS settings (otherwise, TeamCity will perform <a href="clean-checkout.html">clean checkout</a> each time another build configuration is built in the directory);</p></li><li class="list__item" id="4000621b"><p>the content of the directory is not modified by processes other than those of a single TeamCity agent (otherwise TeamCity might be unable to ensure consistent incremental sources update). If this cannot be eliminated, make sure to turn on the clean build checkout option for all the participating build configurations. This rule also applies to two TeamCity agents sharing the same working directory. As one TeamCity agent has no knowledge of another, the other agent appears as an external process to it.</p></li></ul><aside class="warning " data-title="" rel="cb329364" id="6861ac25"><p id="fbd79f4f">It is recommended that a custom checkout directory <b id="c1172146">does not contain</b> the <a href="build-working-directory.html">agent's working directory</a> because of the potential undesirable side effects.</p></aside><p id="8def9227">Note that the content of the checkout directory can be deleted by TeamCity under <a href="clean-checkout.html#Automatic-Clean-Checkout">certain circumstances</a>.</p></div><a name="AutomaticCheckoutDirectoryCleaning"></a><a name="Automatic-Checkout-Directory-Cleaning"></a><div class="chapter"><h2 id="BuildCheckoutDirectory-AutomaticCheckoutDirectoryCleaning">Automatic Checkout Directory Cleaning</h2><p id="633d1f48">With the <a href="vcs-checkout-mode.html#server-checkout">server-side</a> and <a href="vcs-checkout-mode.html#agent-checkout">agent-side checkout</a> modes, checkout directories are automatically deleted from the disk if not used (no builds were run on the agent using the directory as the checkout directory) for a specified period of time (8 days by default) or when another build requires more free disk space than available. With the <a href="vcs-checkout-mode.html#do-not-checkout-files-automatically">manual checkout</a> mode, automatic directory cleaning is not performed unless the directory expiration period is configured.</p><p id="ad31a160">It is recommended to use the <a href="free-disk-space.html">Free Disk Space</a> build feature to ensure the build gets enough disk free space on the build agent.</p><p id="cdf39d8a">There are also obsolete manual controls for old checkout directories cleanup:</p><p id="371c0551">The time frame for automatic directory expiration can be changed by specifying a new value (in hours) by either of the following ways:</p><ul class="list _ul"><li class="list__item" id="5db3d9df"><p><code class="code">teamcity.agent.build.checkoutDir.expireHours</code> agent property in the <code class="code">buildAgent.properties</code> file</p></li><li class="list__item" id="a6e61583"><code class="code">system.teamcity.build.checkoutDir.expireHours</code> <a href="configuring-build-parameters.html">build configuration property</a><ul class="list _ul"><li class="list__item" id="6c74cf8d"><p><code class="code">0</code> will cause deleting the checkout directories right after the build finishes</p></li><li class="list__item" id="76435344"><p><code class="code">never</code> will let TeamCity know that the directory should never be deleted by TeamCity</p></li><li class="list__item" id="eab4876f"><p><code class="code">default</code> will enforce using the default value</p></li></ul></li></ul><p id="32e72b41">Expiration-based directory cleaning is performed in the background when the build agent is idle (no builds are running).</p><hr id="b5fd0729"><p id="450254fa"><b id="9e84a236">See also:</b></p><p id="6bc939a7"><b id="e99b14c6">Administrator's Guide</b>: <a href="configuring-vcs-settings.html">Configuring VCS Settings</a></p><hr id="209d942b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>