<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>TeamCity与云解决方案的集成-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="TeamCity Integration with Cloud Solutions" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/installation.md|Installation/teamcity-integration-with-cloud-solutions.md|TeamCity Integration with Cloud Solutions/setting-up-teamcity-for-amazon-ec2.md|Setting Up TeamCity for Amazon EC2/setting-up-teamcity-for-vmware-vsphere-and-vcenter.md|Setting Up TeamCity for VMware vSphere and vCenter" data-main-title="TeamCity Integration with Cloud Solutions" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/teamcity-integration-with-cloud-solutions.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="teamcity-integration-with-cloud-solutions.md" data-toc="TeamCity Integration with Cloud Solutions">TeamCity与云解决方案的集成</h1><p id="9468aa8b">在此页：</p><p id="e5885db7"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-GeneralDescription">一般说明</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-AvailableIntegrations">可用的集成</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-TeamCitySetupforCloudIntegration">TeamCity的云集成设置</a><ul class="list _bullet"><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-PreparingavirtualmachinewithaninstalledTeamCityagent">使用已安装的TeamCity代理准备虚拟机</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-Preparingavirtualmachine">准备虚拟机</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-Capturinganimagefromavirtualmachine">从虚拟机捕获图像</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-ConfiguringacloudprofileinTeamCity">在TeamCity中配置云配置文件</a></li></ul></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-EstimatingCosts">估算成本</a><ul class="list _bullet"><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-TrafficEstimate">流量估算</a></li><li class="list__item"><a href="#TeamCityIntegrationwithCloudSolutions-RunningCosts">运营成本</a></li></ul></li></ul><p></p><p id="fa275e6e">利用TeamCity与云（IAAS）解决方案的集成，TeamCity可以根据构建队列状态按需配置运行TeamCity代理的虚拟机。</p><p id="8a46e864">该页面涵盖有关集成配置的<b id="2c393f39">一般信息</b> 。有关当前支持的解决方案的列表，请参阅下面的“ <a href="#Available-Integrations">可用集成”</a> 。</p><a name="GeneralDescription"></a><a name="General-Description"></a><div class="chapter"><h2 id="TeamCityIntegrationwithCloudSolutions-GeneralDescription">一般说明</h2><p id="eecea6a3">在具有许多项目的大型TeamCity设置中，可能很难预测构建代理的负载以及我们需要运行的代理数量。配置了云代理集成后，TeamCity将利用云的弹性按需提供其他构建代理。</p><p id="9aeb4272">对于每个排队的构建，TeamCity首先尝试在常规的非云代理之一上启动它。如果没有可用的常规代理，TeamCity将查找具有兼容代理的匹配云映像，并为该映像启动一个新实例。TeamCity确保不超过运行的云实例数限制。</p><p id="7de672bb">集成需要：</p><ul class="list _ul"><li class="list__item" id="61e968ad"><p>在云中已安装TeamCity代理的已配置虚拟机已预先配置为在引导时启动TeamCity代理</p></li><li class="list__item" id="94bec972"><p><a href="agent-cloud-profile.html">TeamCity中</a>已配置的云<a href="agent-cloud-profile.html">配置文件</a></p></li></ul><p id="295c46b4">在TeamCity中为一个或多个映像配置了云配置文件后，TeamCity将为所有新添加的映像测试一个实例的开始，以了解有关在其上配置的代理的信息。连接代理后，TeamCity将存储其参数，以便能够正确处理构建配置与代理的兼容性。从TeamCity启动的云实例连接的代理会自动获得授权，前提是有可用的代理许可证：云代理的数量受您在TeamCity中拥有的代理许可证总数的限制。之后，该代理将作为常规代理进行处理。</p><p id="78b660ff">根据配置文件设置，当TeamCity意识到需要更多座席时，它可以：</p><ul class="list _ul"><li class="list__item" id="9272eda6"><p>启动现有虚拟机并停止它（在构建完成或经过空闲超时之后）。停止的计算机将被重新分配，因此当代理处于不活动状态时，虚拟机费用将不适用。此类TeamCity代理的存储成本仍然适用。</p></li><li class="list__item" id="613314fa"><p>从映像创建新的虚拟机。此类计算机将被销毁（在构建完成或经过空闲超时后）。这样可以确保机器不会产生进一步的运行成本。</p></li></ul><p id="52f10414">断开连接的代理将从授权代理列表中删除，并从系统中删除，以释放TeamCity构建代理许可证。</p></div><a name="AvailableIntegrations"></a><a name="Available-Integrations"></a><div class="chapter"><h2 id="TeamCityIntegrationwithCloudSolutions-AvailableIntegrations">可用的集成</h2><p id="f5fdfb9e">与云解决方案的集成以插件的形式实现。以下页面介绍了特定于平台的详细信息：</p><ul class="list _ul"><li class="list__item" id="489ab9ad"><a href="setting-up-teamcity-for-amazon-ec2.html">亚马逊EC2</a></li><li class="list__item" id="ca801d12"><a href="setting-up-teamcity-for-vmware-vsphere-and-vcenter.html">VMWare vSphere</a></li></ul><p id="516d3c63">还可以作为非捆绑插件提供：</p><ul class="list _ul"><li class="list__item" id="6ad9434f"><a href="https://plugins.jetbrains.com/plugin/9260-azure-resource-manager-cloud-support" rel="noopener noreferrer" data-external="true" target="_blank">Windows Azure</a></li><li class="list__item" id="ae860d86"><a href="https://plugins.jetbrains.com/plugin/9704-google-cloud-agents" rel="noopener noreferrer" data-external="true" target="_blank">谷歌云</a></li><li class="list__item" id="2e384cab"><a href="https://plugins.jetbrains.com/plugin/9818-kubernetes-support" rel="noopener noreferrer" data-external="true" target="_blank">Kubernetes</a></li></ul><p id="09bffc27">和<a href="https://plugins.jetbrains.com/category/102-cloud-support/teamcity" rel="noopener noreferrer" data-external="true" target="_blank">其他</a> 。</p><p id="784edb56">新的集成可以作为TeamCity插件<a href="https://confluence.jetbrains.com/display/TW/Implementing+Cloud+support" rel="noopener noreferrer" data-external="true" target="_blank">实施</a> ，请参阅<a href="https://confluence.jetbrains.com/display/TW/Implementing+Cloud+support" rel="noopener noreferrer" data-external="true" target="_blank">实施云支持</a> 。</p></div><a name="TeamCitySetupforCloudIntegration"></a><a name="TeamCity-Setup-for-Cloud-Integration"></a><div class="chapter"><h2 id="TeamCityIntegrationwithCloudSolutions-TeamCitySetupforCloudIntegration">TeamCity的云集成设置</h2><p id="4e9cad45">本节描述了云集成所需的一般步骤。</p><a name="PreparingavirtualmachinewithaninstalledTeamCityagent"></a><a name="Preparing-a-virtual-machine-with-an-installed-TeamCity-agent"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-PreparingavirtualmachinewithaninstalledTeamCityagent">使用已安装的TeamCity代理准备虚拟机</h3><p id="ffa1dece">用于TeamCity云集成的虚拟机/映像的要求：</p><ul class="list _ul"><li class="list__item" id="7319db80"><p>必须正确<a href="setting-up-and-running-additional-build-agents.html">安装</a> TeamCity代理并将其配置为在计算机启动时<a href="setting-up-and-running-additional-build-agents.html#Automatic-Start">自动</a>启动。</p></li><li class="list__item" id="f40725b2"><p>要跳过对服务器的每个代理连接的更新尝试，请确保该代理是最新的：启动并等待更新完成。每次在服务器上安装/更新/删除插件或工具时，代理状态都会更改。</p></li><li class="list__item" id="8c8c1434"><p>的<a href="project-and-agent-level-build-parameters.html"><code class="code">buildAgent.properties</code></a>文件可以“按原样”保留。的<code class="code">serverUrl</code> ， <code class="code">name</code>和<code class="code">authorizationToken</code>属性可以保留为空或设置为任何值， <b id="ea81d1e7">除非</b> Team-City <b id="ea81d1e7">特定</b>于<a href="https://confluence.jetbrains.com/display/TW/Microsoft+Azure+cloud" rel="noopener noreferrer" data-external="true" target="_blank">平台的文档中</a> <b id="ea81d1e7">另有说明</b> ， <b id="ea81d1e7">否则</b>在TeamCity启动实例时将忽略它们。</p></li></ul><p id="4cf061a5">如果满足这些要求，则适用常规TeamCity代理安装和云提供商映像捆绑程序。</p><p id="808fe360">如果需要确保服务器和代理计算机之间的<a href="setting-up-and-running-additional-build-agents.html#Agent-Server-Data-Transfers">连接</a>安全，则需要在启动时设置代理计算机以建立到服务器的安全隧道（例如VPN），以便TeamCity代理通过安全通道。请记住，TeamCity代理和服务器之间的通信是双向的，并且需要代理和服务器上的开放端口。</p></div><a name="Preparingavirtualmachine"></a><a name="Preparing-a-virtual-machine"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-Preparingavirtualmachine">准备虚拟机</h3><ol class="list _decimal"><li class="list__item" id="58bda878"><p>创建并启动安装了所需操作系统的虚拟机。</p></li><li class="list__item" id="9e03f2ca"><p>连接并登录到虚拟机。</p></li><li class="list__item" id="569a98bb">配置正在运行的实例：<ol class="list _decimal"><li class="list__item" id="4257a5b5"><a href="setting-up-and-running-additional-build-agents.html">安装</a>和配置构建代理。<ul class="list _ul"><li class="list__item" id="9f58738c"><p>在中配置服务器名称和代理名称<a href="project-and-agent-level-build-parameters.html"><code class="code">buildAgent.properties</code></a>文件-如果将TeamCity配置为启动映像，则这是可选的，但是对测试代理配置是否正确很有用。</p></li><li class="list__item" id="124e4a8b"><p>通常，指定<code class="code">tempDir</code>和<code class="code">workDir</code>在<code class="code">conf/buildAgent.properties</code>使用非系统驱动器（例如， <code class="code">D</code> Windows下驱动器）</p></li></ul></li><li class="list__item" id="bcb8af77"><p>在计算机上安装构建所需的任何其他软件（例如，Java或.NET）</p></li><li class="list__item" id="942b070a"><p>启动代理并等待，直到它连接到服务器，确保其正常运行并与所有必需的构建配置兼容（在TeamCity Web UI中，转到“ <b id="d10483c9">代理”</b>页面，选择构建代理并查看“ <b id="be664cab">兼容配置”</b>选项卡），然后以此类推。</p></li><li class="list__item" id="e58f9945"><p>配置系统，以便<a href="setting-up-and-running-additional-build-agents.html#Automatic-Start">在计算机启动时启动</a>代理（并确保在计算机启动时可访问TeamCity服务器）。</p></li><li class="list__item" id="ba2af3f2"><p>检查构建代理将在其中侦听来自TeamCity的传入数据的端口，并打开所需的防火墙端口（通常为9090）。</p></li></ol></li><li class="list__item" id="f3a8c239"><p>通过重新引导计算机并检查代理是否正常连接到服务器来测试设置。代理连接后，它将自动更新所有插件。等待代理完全连接，以便将所有插件下载到代理计算机。</p></li></ol><p id="7602afd5">如果您希望TeamCity启动现有虚拟机并在构建完成或经过空闲超时后将其停止，则只需上述设置。如果希望TeamCity从映像创建和启动虚拟机，并在使用后终止该计算机，则应从创建的虚拟机捕获该映像。</p></div><a name="Capturinganimagefromavirtualmachine"></a><a name="Capturing-an-image-from-a-virtual-machine"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-Capturinganimagefromavirtualmachine">从虚拟机捕获图像</h3><p id="a49f8683">请执行下列操作：</p><ol class="list _decimal"><li class="list__item" id="e75ca9dd">完成<a href="#Preparing-a-virtual-machine">创建虚拟机</a>的步骤。<ul class="list _ul"><li class="list__item" id="067f11a8"><p>删除系统中的所有临时/历史信息。</p></li><li class="list__item" id="15d893c3"><p>停止代理（在Windows下，停止服务，但将其保留为“ <i id="f6377c01">自动”</i>启动类型）</p></li><li class="list__item" id="ade75760"><p>（可选）删除内容<code class="code">logs</code>和<code class="code">temp</code> <a href="agent-home-directory.html">代理主</a>目录中的目录</p></li><li class="list__item" id="2762cc1b"><p>（可选）清理<code class="code"><Agent Home>/conf/</code>平台特定文件中的目录</p></li><li class="list__item" id="5c8f49c1"><p>（可选）更改<a href="project-and-agent-level-build-parameters.html"><code class="code">buildAgent.properties</code></a>文件删除<code class="code">name</code> ， <code class="code">serverUrl</code>和<code class="code">authorizationToken</code>属性， <b id="13d68057">除非特定</b>于<a href="https://confluence.jetbrains.com/display/TW/Microsoft+Azure+cloud" rel="noopener noreferrer" data-external="true" target="_blank">平台的文档</a> <b id="13d68057">另有说明</b> 。</p></li></ul></li><li class="list__item" id="ef8e3230"><p>从正在运行的实例中创建新映像。请参阅云文档以了解有关操作方法。</p></li></ol><aside class="note " rel="702effbe" id="838574f1" data-title=""><p id="ea83e049">每当服务器上的代理分发（例如，TeamCity升级后）或代理插件发生更改时，TeamCity代理都会自动升级。如果要减少代理启动时间，则可能需要在更新代理分发或插件后捕获新的虚拟机映像。</p></aside></div><a name="ConfiguringacloudprofileinTeamCity"></a><a name="Configuring-a-cloud-profile-in-TeamCity"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-ConfiguringacloudprofileinTeamCity">在TeamCity中配置云配置文件</h3><p id="e18c7783">云配置文件是用于TeamCity的设置的集合，以启动按需安装TeamCity代理的虚拟机。<b id="bd947ded">在TeamCity 2017.1之前的版本中</b> ，配置文件是在<b id="9462a55c">TeamCity |管理|代理云</b>页面。在更高版本中，云配置文件是在“ <b id="111cc1f0">项目设置”的“</b> <b id="9bb8668b">云配置文件”</b>部分中<b id="9bb8668b">配置</b>的。</p></div></div><a name="EstimatingCosts"></a><a name="Estimating-Costs"></a><div class="chapter"><h2 id="TeamCityIntegrationwithCloudSolutions-EstimatingCosts">估算成本</h2><p id="aac734c1">云提供商的定价适用。请注意，费用可能取决于为部署TeamCity实施的特定配置。我们建议您定期检查配置和云帐户数据，以便尽早发现并防止意外收费。</p><p id="56ffc8e6">请注意，通信量以及必要的服务器和代理计算机特性在很大程度上取决于TeamCity设置和构建运行的性质。</p><a name="TrafficEstimate"></a><a name="Traffic-Estimate"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-TrafficEstimate">流量估算</h3><p id="c549e56d">以下几点可帮助您估算与TeamCity相关的流量：</p><p id="2b0c4f2d">如果TeamCity服务器与代理程序不在同一区域或相似性组中，则服务器和代理程序之间的流量将由提供商收取通常的外部流量费。估算流量时，请记住，有许多与TeamCity相关的流量（请参阅下面的不完整列表）。</p><p id="cf1fedba"><b id="47a3d6bc">由服务器发起的外部连接</b> ：</p><ul class="list _ul"><li class="list__item" id="88fd7669"><p>VCS服务器</p></li><li class="list__item" id="638fbb39"><p>电子邮件和Jabber服务器</p></li><li class="list__item" id="62e62316"><p>Maven仓库</p></li><li class="list__item" id="f3200239"><p>NuGet存储库</p></li></ul><p id="af768b43"><b id="4fefe86b">由服务器发起的内部连接</b> ：</p><ul class="list _ul"><li class="list__item" id="2ee42872"><p>TeamCity代理（检查状态，发送命令，检索信息如线程转储，等等）</p></li></ul><p id="5eb637f3"><b id="7c775780">由代理发起的外部连接</b> ：</p><ul class="list _ul"><li class="list__item" id="fe1dcb1b"><p>VCS服务器（在代理方结帐的情况下）</p></li><li class="list__item" id="997223de"><p>Maven仓库</p></li><li class="list__item" id="d6e9271d"><p>NuGet存储库</p></li><li class="list__item" id="cd3d96b5"><p>从构建过程本身执行的任何连接</p></li></ul><p id="7a284590"><b id="b421a942">由代理发起的内部连接</b> ：</p><ul class="list _ul"><li class="list__item" id="1f239283"><p>TeamCity服务器（在服务器端检出或进行个人构建，下载工件等情况下，检索构建源）</p></li></ul><p id="984677db"><b id="687bc40b">服务器使用的常用连接</b> ：</p><ul class="list _ul"><li class="list__item" id="cc48b3d6"><p>网页浏览器</p></li><li class="list__item" id="cceb0f1b"><p>IDE插件</p></li></ul></div><a name="RunningCosts"></a><a name="Running-Costs"></a><div class="chapter"><h3 id="TeamCityIntegrationwithCloudSolutions-RunningCosts">运营成本</h3><p id="f064491d">云提供商根据虚拟机的正常运行时间来计算成本，因此建议根据您通常的构建长度来调整超时设置。这减少了虚拟机运行的时间。强烈建议为所有构建设置执行超时，以使构建挂起不会导致实例长时间运行而没有有效负载。</p><hr id="ab9b9b9a"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>