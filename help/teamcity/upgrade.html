<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Upgrade - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Upgrade" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/upgrade.md|Upgrade" data-main-title="Upgrade" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/upgrade.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Upgrade" id="upgrade.md">Upgrade</h1><aside class="warning " data-title="" rel="upgrade.md" id="45ec5681"><p id="0ee3bcb0">Unless specifically noted, TeamCity does not support downgrade between major/minor releases (changes in first two numbers of the version). It is strongly recommended to <a href="teamcity-data-backup.html">back up your data</a> before any upgrade.</p></aside><p id="872bad60">TeamCity supports upgrades from any of the previous versions to the later ones. All the settings and data are preserved unless noted in the <a href="upgrade-notes.html">Upgrade Notes</a>.</p><p id="d3e265d1">It is recommended to plan for regular upgrades to run the latest TeamCity version at least after several bugfix updates are released. This way you run a fully <a href="how-to.html#TeamCity-Release-Cycle">supported version</a> with the latest fixes and security patches.</p><p id="4d1cf93c">On this page:</p><p id="2e026ac7"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Upgrade-BeforeUpgrade">Before Upgrade</a><ul class="list _bullet"><li class="list__item"><a href="#Upgrade-Licensing">Licensing</a></li></ul></li><li class="list__item"><a href="#Upgrade-UpgradingTeamCityServer">Upgrading TeamCity Server</a><ul class="list _bullet"><li class="list__item"><a href="#Upgrade-AutomaticUpdate">Automatic Update</a></li><li class="list__item"><a href="#Upgrade-ManualUpgrade">Manual Upgrade</a><ul class="list _bullet"><li class="list__item"><a href="#Upgrade-UsingWindowsInstaller">Using Windows Installer</a></li><li class="list__item"><a href="#Upgrade-ManualUpgradingusing.tar.gzor.warDistributions">Manual Upgrading using .tar.gz or .war Distributions</a></li><li class="list__item"><a href="#Upgrade-UpgradingTeamCitystartedfromDockerimages">Upgrading TeamCity started from Docker images</a></li><li class="list__item"><a href="#Upgrade-UpgradingTeamCitystartedfromAWSCloudFormationtemplate">Upgrading TeamCity started from AWS CloudFormation template</a></li></ul></li></ul></li><li class="list__item"><a href="#Upgrade-IDEPlugins">IDE Plugins</a></li><li class="list__item"><a href="#Upgrade-UpgradingBuildAgents">Upgrading Build Agents</a><ul class="list _bullet"><li class="list__item"><a href="#Upgrade-AutomaticBuildAgentUpgrading">Automatic Build Agent Upgrading</a></li><li class="list__item"><a href="#Upgrade-UpgradingBuildAgentsManually">Upgrading Build Agents Manually</a><ul class="list _bullet"><li class="list__item"><a href="#Upgrade-UpgradingtheBuildAgentWindowsServiceWrapper">Upgrading the Build Agent Windows Service Wrapper</a></li><li class="list__item"><a href="#Upgrade-UpgradingfromTeamCityversion1.x">Upgrading from TeamCity version 1.x</a></li><li class="list__item"><a href="#Upgrade-UpgradingfromTeamCityversion2.x">Upgrading from TeamCity version 2.x</a></li></ul></li></ul></li></ul></p><a name="BeforeUpgrade"></a><a name="Before-Upgrade"></a><div class="chapter"><h2 id="Upgrade-BeforeUpgrade">Before Upgrade</h2><p id="2f1e0f9b">Before upgrading TeamCity:</p><ol class="list _decimal"><li class="list__item" id="a926e4ec"><p>For a major upgrade, review what you will be getting in <a href="what-s-new-in-teamcity-2019-1.html">What's New</a> (follow the links at the bottom of What's New if you are upgrading not from the previous major release).</p></li><li class="list__item" id="60ef083d"><p><a href="#Licensing">Check your license keys</a> unless you are upgrading within bugfix releases of the same major <code class="code">X.X</code> version.</p></li><li class="list__item" id="df986617"><p><a href="http://www.jetbrains.com/teamcity/download/" data-external="true" target="_blank" rel="noopener noreferrer">Download</a> the new TeamCity version (<a href="https://confluence.jetbrains.com/display/TW/Previous+Releases+Downloads" data-external="true" target="_blank" rel="noopener noreferrer">extended download options</a>).</p></li><li class="list__item" id="611b4dc8"><p>Carefully review the <b id="40767477"><a href="upgrade-notes.html">Upgrade Notes</a></b>.</p></li><li class="list__item" id="01943b16"><p>Consider probing the upgrade on a <a href="how-to.html#Test-drive-Newer-TeamCity-Version-before-Upgrade">test server</a></p></li><li class="list__item" id="76c1efca"><p>If you have non-bundled plugins installed, check plugin pages for compatibility with the new version and upgrade/uninstall the plugins if necessary</p></li></ol><p id="88d4236c">To upgrade the server:</p><ol class="list _decimal"><li class="list__item" id="067b0f5e"><p><a href="teamcity-data-backup.html">Back up the current TeamCity data</a> including settings, database, and supplementary data. You will need the backup to roll back to the previous version in the unlikely event of the upgrade failure.</p></li><li class="list__item" id="69aae645"><a href="#Upgrading-TeamCity-Server">Perform the upgrade steps</a>:<ul class="list _ul"><li class="list__item" id="cd0a49b4"><a href="#Using-Windows-Installer">Upgrading Using Windows Installer</a></li><li class="list__item" id="9f5e2486"><a href="#Manual-Upgrading-using-.tar.gz-or-.war-Distributions">Manual Upgrading on Linux and for WAR Distributions</a></li></ul></li></ol><p id="6e144a41">If you plan to upgrade a production TeamCity installation, it is recommended to install a <a href="how-to.html#Test-drive-Newer-TeamCity-Version-before-Upgrade">test server</a> and check its functioning in your environment before upgrading the main one.</p><a name="Licensing"></a><a name="Licensing"></a><div class="chapter"><h3 id="Upgrade-Licensing">Licensing</h3><p id="2e57e483">Before upgrading, make sure the maintenance period of your licenses is not yet elapsed (use <b id="e7d8b905">Administration | Licenses</b> TeamCity server web UI page to list your license keys). The licenses are valid only for the versions of TeamCity with the effective release date within the maintenance period. Check the effective release date on the <a href="https://confluence.jetbrains.com/display/TW/Previous+Releases+Downloads" data-external="true" target="_blank" rel="noopener noreferrer">releases list</a>.<br>Typically all the bugfix updates (indicated by changes in the <code class="code">Z</code> part of the <code class="code">X.Y.Z</code> TeamCity version) use the same effective release date (that of the major/minor release).<br>If not all the licenses cover the target version release date, consider <a href="https://www.jetbrains.com/teamcity/buy/#license-type=renewal" data-external="true" target="_blank" rel="noopener noreferrer">renewing the licenses</a> before the upgrade (you can replace the old license keys with the renewed ones even before the upgrade).</p><p id="6fadd1f2">If you are only evaluating a newer version, you can get an evaluation license on the <a href="http://www.jetbrains.com/teamcity/download/" data-external="true" target="_blank" rel="noopener noreferrer">download page</a>. Note that each TeamCity version can be evaluated only once. To extend the evaluation period, <a href="http://www.jetbrains.com/company/contacts/#contactSales" data-external="true" target="_blank" rel="noopener noreferrer">contact</a> the JetBrains sales department.</p><p id="76b05155">When upgrading from TeamCity 4.x or earlier, note that the licensing policy in TeamCity versions 5.0 and later are different from that of the previous TeamCity versions. Review the <a href="licensing-policy.html">Licensing Policy</a> page and the <a href="http://www.jetbrains.com/teamcity/buy#upgradeuser" data-external="true" target="_blank" rel="noopener noreferrer">Licensing and Upgrade</a> section on the official site.</p></div></div><a name="UpgradingTeamCityServer"></a><a name="Upgrading-TeamCity-Server"></a><div class="chapter"><h2 id="Upgrade-UpgradingTeamCityServer">Upgrading TeamCity Server</h2><p id="8e5d5d88">TeamCity supports upgrades from any of the previous versions to the current one.<br>Unless specifically noted, downgrades with preserving the data are not possible with changing <code class="code">major.minor</code> version and are possible within bugfix releases (without changing <code class="code">major.minor</code> version).</p><p id="229d6fa0">The general policy is that bugfix updates (indicated by changes in the <code class="code">Z</code> part of the <code class="code">X.Y.Z</code> TeamCity version) do not change data format, so you can freely upgrade/downgrade within the bugfix versions. However, when upgrading to the next major or minor version (changed <code class="code">X</code> or <code class="code">Y</code> in <code class="code">X.Y.Z</code> TeamCity version), you will not be able to downgrade with the data preservation: you will need to <a href="restoring-teamcity-data-from-backup.html">restore a backup</a> of the appropriate version.</p><p id="7b5b7f03">On upgrade, all the TeamCity configuration settings and other data are preserved unless noted in <a href="upgrade-notes.html">Upgrade Notes</a>. If you have customized TeamCity installation (like Tomcat server settings change), you will need to repeat the customization after the upgrade.</p><p id="2f970585">The general approach to upgrade is to remove all the files of the previous installation in the TeamCity server home and place the new files into the same location. Make sure to preserve the <a href="teamcity-data-directory.html">TeamCity Data Directory</a> and the database intact (making a backup beforehand), backing up and restoring previously customized settings (for example, in <code class="code">...\conf\server.xml</code>, <code class="code">...\conf\web.xml</code> files) is also necessary. The logs directory (<code class="code">...\logs</code>) can be left with the old installation files.</p><p id="d3ef53d1">Agents connected to the server are upgraded <a href="#Automatic-Build-Agent-Upgrading">automatically</a>.</p><aside class="note " data-title="" rel="d3ef53d1" id="5a0d05a6"><p id="4a2552bc"><b id="64531a81">Important note on TeamCity data structure upgrade</b></p><p id="a0954cf5">TeamCity server stores its data in the database and in <a href="teamcity-data-directory.html">TeamCity Data Directory</a> on the file system. Different TeamCity versions use different data structure of the database and Data Directory. Upon starting newer version of TeamCity, the data is kept in the old format until you confirm the upgrade and data conversion on the Maintenance page in the web UI. Until you do so, you can back up the old data; however, once the upgrade is complete, the data is converted to the new format.<b id="09f64fa6">Once the data is converted, downgrade to the previous TeamCity versions which uses different data format is not possible!</b><br>There are several important issues with data format upgrade:</p><ul class="list _ul"><li class="list__item" id="ee895aa8"><p>Data structure downgrade is not possible. Once newer TeamCity version changes the data format of database and Data Directory, you cannot use this data to run an older TeamCity version. Please ensure you <a href="teamcity-data-backup.html">backup</a> the data before upgrading TeamCity.</p></li><li class="list__item" id="392b6512"><p>Both the database and the Data Directory should be upgraded simultaneously. Ensure that during the first start of the newer server it uses the correct <a href="teamcity-data-directory.html">TeamCity Data Directory</a> that in its turn has the correct database <a href="setting-up-an-external-database.html">configured</a> in the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;\config\database.properties file. Also make sure the Data Directory is complete (for example, all the build logs and artifacts are in place), no Data Directory content supports copying from the Data Directory of the older server versions.</p></li></ul></aside><p id="8dbc8f31">If you accidentally performed an inconsistent upgrade, check the <a href="how-to.html#Recover-from-&#34;Data-format-of-the-Data-Directory-(NNN)-and-the-database-(MMM)-do-not-match&#34;-error">recovery instructions</a>.</p><a name="AutomaticUpdate"></a><a name="Automatic-Update"></a><div class="chapter"><h3 id="Upgrade-AutomaticUpdate">Automatic Update</h3><p id="9bef38f4">Since TeamCity 2017.2 automatic update option is available. For that to function, TeamCity server should be able to contact <a href="https://www.jetbrains.com/" data-external="true" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com</a> site.<br>When a new version of TeamCity is detected, the server displays the corresponding health item for system administrators. The item points to the server's <b id="e94c5487">Administration | Updates</b> page, where all the versions available for the update are listed. The page contains notes about licenses compatibility, the new version description and controls to perform the automatic upgrade if you want to use that instead of performing the manual updating procedure.</p><p id="0d73154b">The automatic update procedure is as follows:</p><ol class="list _decimal"><li class="list__item" id="f9a59c8c"><p>The TeamCity server is stopped.</p></li><li class="list__item" id="4a928777">The update script is run to do the following:<ol class="list _decimal"><li class="list__item" id="f467185b"><p>Create a backup of the current installation in the &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/.old directory.</p></li><li class="list__item" id="d4fedc9e"><p>Update the stopped server to the new version.</p></li></ol></li><li class="list__item" id="609be046"><p>Next, the updated server starts.<br>The update progress is logged to the &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/logs/teamcity-update.log file.</p></li></ol><aside class="note " data-title="" rel="cc8bf19e" id="4623658b"><p id="6d3b54d5">In case of an automatic update failure, perform the following to restore your TeamCity to the state prior to the update:</p><ol class="list _decimal"><li class="list__item" id="9178e3c3"><p>Stop your TeamCity server if it is running.</p></li><li class="list__item" id="7ae67391"><p>In your <a href="teamcity-home-directory.html">TeamCity Home Directory</a> directory, remove the folders with the same name as the ones in the &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/.old directory.</p></li><li class="list__item" id="3e89b8eb"><p>Copy the contents of the &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/.old directory to the &lt;TeamCity server home&gt; directory.</p></li><li class="list__item" id="328d9946"><p>Start the TeamCity server.</p></li></ol></aside><p id="241a8fbf">Current automatic update limitations:</p><ul class="list _ul"><li class="list__item" id="c90d4cb6"><p>some customizations, for example, installations with <a href="installing-and-configuring-the-teamcity-server.html#Changing-Server-Context">changed server context</a>, are not supported by automatic update</p></li><li class="list__item" id="fc5ec498"><p>only manual upgrade is possible if the server is deployed from a <a href="#Manual-Upgrading-using-.tar.gz-or-.war-Distributions"><code class="code">.war distribution</code></a>, or runs under the official <a href="#Upgrading-TeamCity-started-from-Docker-images">TeamCity Docker container</a>, started with <a href="running-teamcity-stack-in-aws.html">AWS CloudFormation template</a> or  Azure Resource Manager template.</p></li><li class="list__item" id="915326f6"><p>the Windows uninstaller is not updated during the upgrade, so after several updates, old TeamCity version will still be noted in Windows lists. During the uninstallation, not all of the TeamCity installation files might be deleted.</p></li><li class="list__item" id="8f2b2529"><p>the bundled Java is not updated</p></li><li class="list__item" id="e4e42c99"><p>with several nodes installation, only the main TeamCity server can be auto-updated, the Running Builds node needs to be updated manually.</p></li></ul></div><a name="ManualUpgrade"></a><a name="Manual-Upgrade"></a><div class="chapter"><h3 id="Upgrade-ManualUpgrade">Manual Upgrade</h3><p id="954fcb3f"><a name="winUpgrading"></a><a name="Upgrade-winUpgrading"></a></p><a name="UsingWindowsInstaller"></a><a name="Using-Windows-Installer"></a><div class="chapter"><h4 id="Upgrade-UsingWindowsInstaller">Using Windows Installer</h4><aside class="tip sideblock" data-title="" rel="Upgrade-UsingWindowsInstaller" id="448bcccd"><p id="076d79ea">The main server configuration file &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/conf/server.xml is updated automatically when there were no changes to it since the last installation. If modification were made, the installer will detect them and backup the old <code class="code">server.xml</code> file displaying a warning about the overwrite and the backup file location. Other files under <code class="code">conf</code> can be overwitten to their default content as well, so if you have made manual modifications in those, check them after the upgrade.</p></aside><ol class="list _decimal"><li class="list__item" id="0acf9b89"><p><a href="teamcity-data-backup.html">Create a backup</a>. When upgrading from TeamCity 6.0+ you will also have a chance to create a backup with the "basic" profile on the <a href="teamcity-maintenance-mode.html">TeamCity Maintenance Mode</a> page on the updated TeamCity start.</p></li><li class="list__item" id="4dae1739"><p>Note the username used to run the TeamCity server. You will need it during the new version installation.</p></li><li class="list__item" id="11ac9716"><p>If you have any of the Windows service settings customized, store them to repeat the customizations later.</p></li><li class="list__item" id="ed08f879"><p>Note if you are using 64 bit Java to run the service (for example, check for "64" in "Java VM info" on the server's Administration | Diagnostics or in a thread dump), consider backing up &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;\jre directory.</p></li><li class="list__item" id="ebbb5c26"><p>(optional as these will not be overwritten by the upgrade) If you have any customizations of the bundled Tomcat server (like port, https protocol, and so on), JRE, etc. Backup those to repeat the customizations later.</p></li><li class="list__item" id="65b4e4dd"><p>Note if you have local agent installed (though, it is <a href="how-to.html#TeamCity-Security-Notes">not recommended</a> to have a local agent) so that you can select the same option in the installer.</p></li><li class="list__item" id="cc36403f"><p>Run the new installer and point it to the same place TeamCity is installed into ( the location used for installation is remembered automatically). Confirm uninstalling the previous installation. The TeamCity uninstaller ensures proper uninstallation, but you might want to make sure the <a href="teamcity-home-directory.html">TeamCity server installation directory</a> does not contain any non-customized files after uninstallation finishes. If there are any, backup/remove them before proceeding with the installation.</p></li><li class="list__item" id="46b9e803"><p>If prompted, specify the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/ used by the previous installation.</p></li><li class="list__item" id="075452f9"><p>(Optional as these will not be overwritten by the upgrade) Make sure you have the external database driver <a href="setting-up-an-external-database.html#General-Steps">installed</a> (this applies only if you use an external database).</p></li><li class="list__item" id="7cb08136"><p>Check and restore any customizations of Windows services and Tomcat configuration that you need. When upgrading from versions 7.1 and earlier, make sure to transfer the <a href="configuring-teamcity-server-startup-properties.html">server memory setting</a> to the <a href="configuring-teamcity-server-startup-properties.html#Standard-TeamCity-Startup-Scripts">environment variables</a>.</p></li><li class="list__item" id="6e7edfac"><p>If you were using 64 bit Java to run the server restore the &lt;<a href="teamcity-home-directory.html">TeamCity Home Directory</a>&gt;/\jre directory previously backed up or repeat the 64 bit Java <a href="installing-and-configuring-the-teamcity-server.html#Java-Installation">installation steps</a>.</p></li><li class="list__item" id="4eebaa92"><p>If you use a customized Log4j configuration in the <code class="code">conf\teamcity-server-log4j.xml</code> file and want to preserve it (note, however, that customizing the file is actually not recommended, use <a href="teamcity-server-logs.html#Logging-related-Diagnostics-UI">logging presets</a> instead), compare and merge <code class="code">conf\teamcity-server-log4j.xml.backup</code> created by the installer from the existing copy with the default file saved with the default name. Compare the <code class="code">conf\teamcity-*-log4j.xml.dist</code> file with the corresponding <code class="code">conf\teamcity-*-log4j.xml</code> file and make sure that<code class="code">.xml</code> file contains all the<code class="code">.dist</code> file defaults. It is recommended to copy the <code class="code">.dist</code> file over to the corresponding <code class="code">.xml</code> file until you really need the changed logging configuration.</p></li><li class="list__item" id="240dfd1b"><p>Start up the TeamCity server (and agent, if it was installed together with the installer).</p></li><li class="list__item" id="2dac5728"><p>Review the <a href="teamcity-maintenance-mode.html">TeamCity Maintenance Mode</a> page to make sure there are no problems encountered, and confirm the upgrade by clicking the corresponding button. Only after that all data will be converted to the newer format.</p></li></ol><p id="1f06622e">If you encounter errors which cannot be resolved, make sure old TeamCity is not running/does not start on boot, restart the machine, and repeat the installation procedure.</p></div><a name="ManualUpgradingusing.tar.gzor.warDistributions"></a><a name="Manual-Upgrading-using-.tar.gz-or-.war-Distributions"></a><div class="chapter"><h4 id="Upgrade-ManualUpgradingusing.tar.gzor.warDistributions">Manual Upgrading using .tar.gz or .war Distributions</h4><p id="30ba014f">Note that it is recommended to use <code class="code">.tar.gz</code> or <code class="code">.exe</code> TeamCity distribution. Using <code class="code">.war</code> is not a recommended way to install TeamCity.</p><ol class="list _decimal"><li class="list__item" id="4f47de9f"><p><a href="teamcity-data-backup.html">Create a backup</a>.</p></li><li class="list__item" id="f045b819"><p>Backup files customized since previous installation (most probably <code class="code">[TOMCAT_HOME]/conf/server.xml</code>)</p></li><li class="list__item" id="d4215c58"><p>Remove old installation files (the entire <code class="code">&lt;&amp;gt;</code>or <code class="code">[TOMCAT_HOME]/webapps/TeamCity/*</code> if you are installing from a <code class="code">war</code> file). It's advised to backup the directory beforehand.</p></li><li class="list__item" id="63c45bfd"><p>Unpack the new archive to the location where TeamCity was previously installed.</p></li><li class="list__item" id="bef0d75b"><p>If you use a Tomcat server (your own or bundled in .tar.gz TeamCity distribution), it is recommended to delete the content of the <code class="code">work</code> directory. Note that this may affect other web applications deployed into the same web server.</p></li><li class="list__item" id="5392754b"><p>Restore customized settings backed up in step 2 above. If you have the customized <code class="code">[TOMCAT_HOME]/conf/server.xml</code> file, apply your changes into the appropriate sections of the default file.</p></li><li class="list__item" id="d9a5d6c3"><p>Make sure the previously configured <a href="configuring-teamcity-server-startup-properties.html">TeamCity server startup properties</a> (if any) are still actual.</p></li><li class="list__item" id="094ace01"><p>Start up the TeamCity server.</p></li><li class="list__item" id="7b3c35c6"><p>Review the <a href="teamcity-maintenance-mode.html">TeamCity Maintenance Mode</a> page to make sure there are no problems encountered, and confirm the upgrade by clicking the corresponding button. Only after that, all the configuration data and database scheme are updated by TeamCity converters.</p></li></ol></div><a name="UpgradingTeamCitystartedfromDockerimages"></a><a name="Upgrading-TeamCity-started-from-Docker-images"></a><div class="chapter"><h4 id="Upgrade-UpgradingTeamCitystartedfromDockerimages">Upgrading TeamCity started from Docker images</h4><p id="58c94709">If you made no changes to the container, you can just stop the running container, pull the new version of the <a href="https://hub.docker.com/r/jetbrains/teamcity-server/" data-external="true" target="_blank" rel="noopener noreferrer">official TeamCity image</a> and the server in it via the usual command. If you changed the image, you will need to replicate the changes to the new TeamCity server image.</p></div><a name="UpgradingTeamCitystartedfromAWSCloudFormationtemplate"></a><a name="Upgrading-TeamCity-started-from-AWS-CloudFormation-template"></a><div class="chapter"><h4 id="Upgrade-UpgradingTeamCitystartedfromAWSCloudFormationtemplate">Upgrading TeamCity started from AWS CloudFormation template</h4><p id="e7d74d8b">Please see the <a href="running-teamcity-stack-in-aws.html#Upgrading-TeamCity-in-AWS">dedicated page</a>.</p></div></div></div><a name="IDEPlugins"></a><a name="IDE-Plugins"></a><div class="chapter"><h2 id="Upgrade-IDEPlugins">IDE Plugins</h2><p id="e7454836">It is recommended for all users to regularly update their IDE plugins to the latest version compatible with the TeamCity server version in use. At least to the version available from the TeamCity server's Tools section on user profile.<br>Generally, versions of the IntelliJ IDEA TeamCity plugin, Eclipse TeamCity plugin, and Visual Studio TeamCity Addin have to be the same as the TeamCity server version. Users with non-matching plugin versions get a message on an attempt to log in to the TeamCity server with a non-matching version.<br>The only exception is TeamCity versions 9.0 - 9.1.x, which use a compatible protocol, and any plugin of these versions can be used with any server of these versions. Updating IDE plugins to the matching server version is still recommended.</p></div><a name="UpgradingBuildAgents"></a><a name="Upgrading-Build-Agents"></a><div class="chapter"><h2 id="Upgrade-UpgradingBuildAgents">Upgrading Build Agents</h2><ul class="list _ul"><li class="list__item" id="2ae8c4f7"><a href="#Automatic-Build-Agent-Upgrading">Automatic Build Agent Upgrading</a></li><li class="list__item" id="85c48649"><a href="#Upgrading-Build-Agents-Manually">Upgrading Build Agents Manually</a><ul class="list _ul"><li class="list__item" id="ca2b51ff"><a href="#Upgrading-the-Build-Agent-Windows-Service-Wrapper">Upgrading the Build Agent Windows Service Wrapper</a></li></ul></li></ul><a name="AutomaticBuildAgentUpgrading"></a><a name="Automatic-Build-Agent-Upgrading"></a><div class="chapter"><h3 id="Upgrade-AutomaticBuildAgentUpgrading">Automatic Build Agent Upgrading</h3><p id="3e827c46">On starting TeamCity server (and updating agent distribution or plugins on the server), TeamCity agents connected to the server and <a href="setting-up-and-running-additional-build-agents.html#Necessary-OS-and-environment-permissions">correctly installed</a> are automatically updated to the version corresponding to the server. This occurs for both server upgrades and downgrades. If there is a running build on the agent, the build finishes. No new builds are started on the agent unless the agent is up to date with the server.</p><p id="997e91b1"><b id="3afd962b">Since TeamCity 2018.2</b>, before starting the agent upgrade, the agent is checked for free disk space, 3 gb by default. To modify the value required for the upgrade, configure the <code class="code">teamcity.agent.upgrade.ensure.free.space</code> <a href="build-agent-configuration.html">agent property</a>.</p><p id="2626e37b">The agent update procedure is as follows: The agent (<code class="code">agent.bat</code>, <code class="code">agent.sh</code>, or agent service) will download the current agent package from the TeamCity server. When the download is complete and the agent is idle, it will start the upgrade process (the agent is stopped, the agent files are updated, and the agent is restarted). This process may take several minutes depending on the agent hardware and network bandwidth. <b id="945d99c6">Do not interrupt the upgrade process</b>, as doing so may cause the upgrade to fail and you will need to manually reinstall the agent.</p><p id="87214ff4">If you see that an agent is identified as "Agent disconnected (Will upgrade)" in the TeamCity web UI, do not close the agent console or restart the agent process, but wait for several minutes.</p><p id="40449ae7">Various console windows can open and close during the agent upgrade. Please be patient and do not interrupt the process until the agent upgrade is finished.</p></div><a name="UpgradingBuildAgentsManually"></a><a name="Upgrading-Build-Agents-Manually"></a><div class="chapter"><h3 id="Upgrade-UpgradingBuildAgentsManually">Upgrading Build Agents Manually</h3><p id="efda90f4">All connected agents upgrade automatically, provided they are correctly <a href="setting-up-and-running-additional-build-agents.html">installed</a>, so manual upgrade is not necessary.</p><p id="f2375fc7">If you need to upgrade agent manually, you can follow the steps below:</p><p id="ec45c871">As TeamCity agent does not hold any unique information, the easiest way to upgrade an agent if to</p><ul class="list _ul"><li class="list__item" id="98bc138b"><p>back up the <code class="code">&lt;Agent Home&gt;/conf/buildAgent.properties</code> file.</p></li><li class="list__item" id="7a437bbc"><p>uninstall/delete existing agent.</p></li><li class="list__item" id="4c167b52"><p>install the new agent version.</p></li><li class="list__item" id="a64d58f0"><p>restore the previously saved <code class="code">buildAgent.properties</code> file to the same location.</p></li><li class="list__item" id="1dd914cf"><p>start the agent.</p></li></ul><p id="5f1058ca">If you need to preserve all the agent data (for example, to eliminate clean checkouts after the upgrade), you can:</p><ul class="list _ul"><li class="list__item" id="9cbc2446"><p>stop the agent.</p></li><li class="list__item" id="100a2c39"><p>delete all the directories in the agent installation present in the agent .zip distribution except <code class="code">conf</code>.</p></li><li class="list__item" id="ae64b300"><p>unpack the <code class="code">.zip</code> distribution to the agent installation directory, skipping the "conf" directory.</p></li><li class="list__item" id="fa1ae90b"><p>start the agent.</p></li></ul><p id="ee082a45">In the latter case, if you run the agent under Windows using a service, you may also need to upgrade the Windows service as described <a href="#Upgrading-from-TeamCity-version-2.x">below</a>.</p><a name="UpgradingtheBuildAgentWindowsServiceWrapper"></a><a name="Upgrading-the-Build-Agent-Windows-Service-Wrapper"></a><div class="chapter"><h4 id="Upgrade-UpgradingtheBuildAgentWindowsServiceWrapper">Upgrading the Build Agent Windows Service Wrapper</h4></div><a name="UpgradingfromTeamCityversion1.x"></a><a name="Upgrading-from-TeamCity-version-1.x"></a><div class="chapter"><h4 id="Upgrade-UpgradingfromTeamCityversion1.x">Upgrading from TeamCity version 1.x</h4><p id="2e79d616">Version 2.0 of TeamCity migrated to the new way of managing Windows service (service wrapper) for the build agent: Java Service Wrapper library.</p><p id="f6419792">One of the advantages of using the new service wrapper is the ability to change any JVM parameters of the build agent process.</p><p id="78b21345">1.x versions installed Windows service under the name of <b id="c9bc2c86">agentd</b>, while 2.x versions use the <b id="84c4c09f">TeamCity Build Agent Service &lt;build number&gt;</b> name.</p><p id="187b6fea">The service wrapper will not be migrated to the new version automatically. You do not need to use the new service wrapper unless you need its functionality (like changing the agent's JVM parameters).</p><p id="51ab4af2">To use the new service wrapper, uninstall the old version of the agent (with <b id="5d232bc7">Control Panel | Add/Remove Programs</b>) and then install a new one.</p><p id="3e06792c">If you customized the user under which the service is started, do not forget to customize it in the newly installed service.</p></div><a name="UpgradingfromTeamCityversion2.x"></a><a name="Upgrading-from-TeamCity-version-2.x"></a><div class="chapter"><h4 id="Upgrade-UpgradingfromTeamCityversion2.x">Upgrading from TeamCity version 2.x</h4><p id="b015a7ea">If the service wrapper needs an update, the new version is downloaded into the <code class="code">&lt;agent&gt;/launcher.latest</code> folder, however the changes are not applied automatically.</p><p id="f4631883">To upgrade the service wrapper manually, do the following:</p><ol class="list _decimal"><li class="list__item" id="4ab1604f"><p>Ensure the <code class="code">&lt;agent&gt;/launcher.latest</code> folder exists.</p></li><li class="list__item" id="73895140"><p>Stop the service using <code class="code">&lt;agent&gt;\bin\service.stop.bat</code>.</p></li><li class="list__item" id="39907cc1"><p>Uninstall the service using <code class="code">service.uninstall.bat</code>.</p></li><li class="list__item" id="aaddb35c"><p>Backup the <code class="code">&lt;agent&gt;/launcher/conf/wrapper.conf</code> file.</p></li><li class="list__item" id="320b3a5d"><p>Delete <code class="code">&lt;agent&gt;/launcher</code>.</p></li><li class="list__item" id="b5861a8f"><p>Rename <code class="code">&lt;agent&gt;/launcher.latest</code> to <code class="code">&lt;agent&gt;/launcher</code>.</p></li><li class="list__item" id="00d45ef9"><p>Edit the <code class="code">&lt;agent&gt;/launcher/conf/wrapper.conf</code> file. Check that the <code class="code">wrapper.java.command</code> property points to the <code class="code">java.exe</code> file. Leave it blank to use the registry to look up java. Leave 'java.exe' to look up <code class="code">java.exe</code> in <code class="code">PATH</code>. For a standalone agent, the service value should be <code class="code">../jre/bin/java</code>, for an agent installation on the server the value should be <code class="code">../../jre/bin/java</code>. The backup version of the <code class="code">wrapper.conf</code> file can be used.</p></li><li class="list__item" id="8b563ae9"><p>Install the service using <code class="code">&lt;agent&gt;\bin\service.install.bat</code>.</p></li><li class="list__item" id="e72666dc"><p>Make sure the service is running under the proper user account. Please note that using SYSTEM can result in failing builds which use MSBuild/Sln2005 configurations.</p></li><li class="list__item" id="27bc4e45"><p>Start the service using <code class="code">&lt;agent&gt;\bin\service.start.bat</code>.</p></li></ol><aside class="note " data-title="" rel="f85ef251" id="9309e9ad"><p id="e00c043e">This procedure is applicable ONLY to an agent running with <i id="3fe2070c">new</i> service wrapper. Make sure you are not running the <b id="466d3387">agentd</b> service.</p></aside><hr id="01b9ea63"><p id="10ca0f59"><b id="bbee38fc">See also:</b></p><p id="6b6e6e3b"><b id="b3c575d3">Concepts</b>: <a href="teamcity-data-directory.html">TeamCity Data Directory</a><br><b id="75cf539c">Administrator's Guide</b>: <a href="teamcity-maintenance-mode.html">TeamCity Maintenance Mode</a> | <a href="teamcity-data-backup.html">TeamCity Data Backup</a></p><hr id="51547977"></div></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>