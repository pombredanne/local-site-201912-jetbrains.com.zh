<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>项目导入-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Projects Import" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/projects-import.md|Projects Import" data-main-title="Projects Import" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/projects-import.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="projects-import.md" data-toc="Projects Import">项目导入</h1><p id="2e25c6bb">在此页：</p><p id="1947af16"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ProjectsImport-ProjectsImportorServerMove">项目导入或服务器移动</a></li><li class="list__item"><a href="#ProjectsImport-Importingprojects">汇入专案</a><ul class="list _bullet"><li class="list__item"><a href="#ProjectsImport-Selectingprojectsforimport">选择要导入的项目</a></li><li class="list__item"><a href="#ProjectsImport-Definingimportscope">定义进口范围</a></li><li class="list__item"><a href="#ProjectsImport-Configurationfilesimport">配置文件导入</a></li><li class="list__item"><a href="#ProjectsImport-Importingusersandgroups">导入用户和组</a></li><li class="list__item"><a href="#ProjectsImport-Conflicts">矛盾冲突</a></li></ul></li><li class="list__item"><a href="#ProjectsImport-Datanotincludedintoimport">数据未包含在导入中</a></li><li class="list__item"><a href="#ProjectsImport-Movingartifactsandlogs">移动工件和日志</a></li><li class="list__item"><a href="#ProjectsImport-ViewingImportResults">查看导入结果</a></li></ul><p></p><p id="fd6c4e9f">您可以将项目及其所有数据和用户帐户从备份文件导入到现有的TeamCity服务器，即将项目从一台服务器添加到通常使用的目标服务器。</p><a name="ProjectsImportorServerMove"></a><a name="Projects-Import-or-Server-Move"></a><div class="chapter"><h2 id="ProjectsImport-ProjectsImportorServerMove">项目导入或服务器移动</h2><p id="a285e38c">仅当需要将某些项目添加到包含某些其他项目的现有服务器时，即需要将两个服务器合并为一个时，才应使用“项目导入”。这是因为导入是一种破坏性操作， <a href="#Data-not-included-into-import">并非所有数据都被导入</a> 。<br>如果需要将所有服务器数据移动到另一台计算机上，请使用<a href="how-to.html#Move-TeamCity-Installation-to-a-New-Machine">server move</a> 。</p></div><a name="Importingprojects"></a><a name="Importing-projects"></a><div class="chapter"><h2 id="ProjectsImport-Importingprojects">汇入专案</h2><p id="6d5b0320">在源TeamCity服务器上：</p><ul class="list _ul"><li class="list__item" id="cee3aa04"><p><a href="creating-backup-from-teamcity-web-ui.html">创建一个</a>包含要导入项目<a href="creating-backup-from-teamcity-web-ui.html">的常规备份</a>文件（请注意， <b id="8aba064d">源TeamCity服务器和目标TeamCity服务器</b>的<b id="8aba064d"><a href="upgrade.html#Upgrading-TeamCity-Server">主要版本和次要版本</a>必须相同</b> ）</p></li></ul><p id="de5e0229">在目标TeamCity服务器上：</p><ul class="list _ul"><li class="list__item" id="90e62f73"><p>转到“ <b id="3fd6687b">服务器管理”</b>区域，然后选择左侧的“ <b id="ce6e6c2a">项目导入</b> ”。上载您的项目设置并遵循向导。导入完成后，TeamCity将显示结果。</p></li></ul><aside class="warning " rel="4fcb69dc" id="4617436e" data-title=""><p id="9624664f">要完成导入，您需要通过运行<a href="#Moving-artifacts-and-logs">提供的脚本</a>将工件从旧服务器复制到新服务器：检查导入日志中的详细信息。</p></aside><aside class="tip sideblock" rel="ProjectsImport-Importingprojects" id="74b21aae" data-title=""><p id="3c21b342">项目导入功能不支持外部工件存储。如果您使用外部构件存储，则需要使用导入期间生成的构建ID映射将外部存储的构件手动移动到新位置。有关详细信息，请联系<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity支持</a> 。</p></aside><a name="Selectingprojectsforimport"></a><a name="Selecting-projects-for-import"></a><div class="chapter"><h3 id="ProjectsImport-Selectingprojectsforimport">选择要导入的项目</h3><p id="6b61df48">选择备份文件后，需要指定要导入的项目。</p><p id="8cf362e9">TeamCity将分析所选项目，以查看它们是否将被导入，合并或跳过。</p><ul class="list _ul"><li class="list__item" id="05393739"><p>如果项目对于目标服务器而言是新项目，则将<b id="56443772">导入</b>该项目。其所有实体（构建配置，模板，构建等）及其数据将在目标服务器上创建。</p></li><li class="list__item" id="cfe8754a"><p>如果目标服务器上已经存在相同的项目，则该项目将被<b id="3e49af71">合并</b> （如果源项目和目标项目具有相同的<a href="identifier.html#Universally-Unique-IDs">UUID</a>和<a href="identifier.html#External-IDs">external ID</a> ）。<br>在合并过程中，现有实体将保持不变，并且只有与目标相关的新实体才会与相关数据一起导入。<br>现有实体的数据将不会导入或合并：新数据将不会添加到现有实体（例如，更改不会添加到现有VCS根目录），现有文件将不会更改（例如，如果两台服务器上存在相同的模板，但设置不同，将保留目标文件）。<br>例如，这意味着您不能将缺少的构建导入到现有的构建配置中。如果需要将丢失的数据添加到现有实体中，例如，将新的构建导入到已导入的构建配置中，则应使用UI删除此构建配置，然后重新导入其项目。</p></li><li class="list__item" id="efb24648"><p>如果发生<a href="#Conflicts">冲突，</a>则将<b id="1279a832">跳过</b>该项目：项目的<a href="identifier.html">UUID</a>是新的，但其<a href="identifier.html#External-IDs">外部ID</a>在目标上已经存在；或者或者源项目和目标项目具有相同的<a href="identifier.html#Universally-Unique-IDs">UUID</a>但具有不同的<a href="identifier.html#External-IDs">外部ID</a> 。</p></li></ul></div><a name="Definingimportscope"></a><a name="Defining-import-scope"></a><div class="chapter"><h3 id="ProjectsImport-Definingimportscope">定义进口范围</h3><p id="c56b24d9">您可以选择导入范围：在项目设置，构建和更改历史记录以及用户帐户中进行选择，或全部导入。由于导入的项目还可以使用其父项的设置，因此TeamCity还将为父项导入所有vcs根目录，模板，元运行器和其他与项目相关的设置。如果目标服务器上已经存在相同的项目，则现有对象将不会被覆盖。</p></div><a name="Configurationfilesimport"></a><a name="Configuration-files-import"></a><div class="chapter"><h3 id="ProjectsImport-Configurationfilesimport">配置文件导入</h3><p id="560b2986">对于每个导入或合并的项目，只要配置文件是目标的新配置文件，它们都将导入到目标服务器上的<a href="teamcity-data-directory.html">数据目录中</a> 。现有文件将不会更改。</p><p id="be301a42">导入了以下文件：</p><ul class="list _ul"><li class="list__item" id="162085d0"><p>项目的配置xml文件及其构建配置，模板和VCS根目录及其子项目。</p></li><li class="list__item" id="71155975"><p>< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > / plugins目录中的所有文件。</p></li><li class="list__item" id="f21843e8"><p>新添加的内部配置的内部编号文件。</p></li></ul></div><a name="Importingusersandgroups"></a><a name="Importing-users-and-groups"></a><div class="chapter"><h3 id="ProjectsImport-Importingusersandgroups">导入用户和组</h3><p id="186e9835">选择要导入的用户后，TeamCity将分析用户名以查看用户是否将被<b id="52473662">导入</b>或<b id="7580ea35">合并</b> 。</p><p id="fcd1b1f6">TeamCity用户必须具有唯一的用户名。</p><ul class="list _ul"><li class="list__item" id="df69102e"><p id="f8cf4716">将<b id="f1666025">导入</b>目标服务器的新用户名的用户帐户。这些用户在目标服务器上显示为标记为“已<i id="ed852cce">导入”</i>的单独组。 <i id="ed852cce"><import date="" time=""></import></i> 。所有相关数据（个人构建，更改，测试静音和调查）将在目标服务器上创建。导入期间将保留<a href="managing-your-user-account.html">用户帐户设置</a> （角色，权限，VCS名称，通知设置等：系统范围的设置以及与导入项目相关的设置）。</p></li><li class="list__item" id="99b36174"><p id="eedf34b6">可以<b id="640009ce">合并</b>源服务器和目标服务器上具有相同用户名的用户帐户。在合并期间，现有数据将保持不变，并且仅添加目标的新数据：所有新的与用户相关的数据（个人构建，更改，测试静音和调查）以及<a href="managing-your-user-account.html">用户帐户设置</a> （角色，权限，VCS名称） ，通知设置等：系统范围的设置以及与导入项目相关的设置）将添加到目标服务器上的用户。<br>（！）如果相同的用户名属于源服务器和目标服务器上的不同用户，则合并可能会导致问题：在导入期间，无论如何用户信息都将被合并。<br><b id="72f8f6e0">请注意</b> ，导入后目标上的用户权限范围可能会更改，例如：</p><ul class="list _ul"><li class="list__item" id="32926e73"><p>如果用户在源上具有系统管理员角色，则该角色将在导入后添加到目标上的用户中，</p></li><li class="list__item" id="bd14b554"><p>如果用户在源上的多个项目中具有多个角色，则仅将导入范围内项目的新角色添加到目标中。</p></li></ul><p id="3d289819"><b id="158dbe6c">项目导入</b>页面| <b id="b09b1446">导入范围</b>部分| <b id="5439aad9">用户</b>将显示冲突数量，您可以查看它们并确定是否要合并它们。</p><p id="51621d24">TeamCity将在两台服务器上显示具有相同用户名和不同电子邮件的用户，以及具有相同用户名和相同电子邮件的用户数。<a href="enabling-email-verification.html">可以</a>为服务器<a href="enabling-email-verification.html">启用</a>电子邮件验证，并根据用户名和电子邮件比较具有相同用户名和电子邮件的用户。您可以查看冲突信息并选择是否合并找到的用户。如果源或目标TeamCity服务器上或这两个服务器上同时存在带有已验证电子邮件的用户，则该选项处于活动状态。</p></li></ul><p id="b81b4a63">导入用户组的方式相同：导入新组，而现有组可以合并。</p><p id="33d20b84">如果发生<a href="#Conflicts">冲突</a> （源和目标上都存在组，但组角色不同），则在导入后，目标服务器上的组可能会获得其他角色。结果，目标上该组的成员也将获得其他角色和权限。</p><p id="49913a62"><b id="218f924c">项目导入</b>页面| <b id="7fa34ecd">导入范围</b>部分| <b id="f8ac0596">组</b>将显示找到了多少个冲突的组。您可以查看具有相同组密钥的所有组，并确定是否要合并它们。请注意， <a href="user-group.html#" all-user="-group" ="">“所有用户”组</a>始终被列为冲突组，因为它是所有TeamCity服务器上的默认组。</p></div><a name="Conflicts"></a><a name="Conflicts"></a><div class="chapter"><h3 id="ProjectsImport-Conflicts">矛盾冲突</h3><p id="fe599b8c">如果TeamCity与目标服务器上的某些实体发生冲突，则不会从备份文件中导入它们。导入之前，TeamCity将分析备份文件并在“ <b id="e2fe509c">导入范围”</b>配置页面上显示所有检测到的冲突。</p><p id="7b31b6d2"><b id="1f6757c4">强烈建议</b>在进行导入之前<b id="1f6757c4">解决所有冲突</b> ，因为未解决的冲突可能导致导入后出现无法预测的行为，例如：</p><ul class="list _ul"><li class="list__item" id="b8211c95"><p>例如，如果跳过了某些VCS根目录，但是导入了取决于它的构建配置，则可能会显示严重错误。</p></li><li class="list__item" id="93a452e4"><p>如果源服务器和目标服务器中的模板之间未解决<a href="identifier.html#External-IDs">外部ID</a>冲突，则导入的内部配置可能会引用错误的模板。</p></li></ul><p id="8cb7b301">如果在导入之前尚未解决冲突，则可以在<code class="code">conflictingFiles</code>导入结果日志下的目录。</p></div></div><a name="Datanotincludedintoimport"></a><a name="Data-not-included-into-import"></a><div class="chapter"><h2 id="ProjectsImport-Datanotincludedintoimport">数据未包含在导入中</h2><p id="007fa02c">有关导入有很多限制：</p><ul class="list _ul"><li class="list__item" id="06d64b93"><p>代理和代理池未导入（ <a href="https://youtrack.jetbrains.com/issue/TW-39797" rel="noopener noreferrer" data-external="true" target="_blank">TW-39797</a> ）。</p></li><li class="list__item" id="9c778e51"><p>设置基于“按文件”合并。这意味着将添加新文件，但不会合并任何设置文件。例如，如果目标服务器上已经存在要导入的项目，则其参数，项目功能和插件设置将不会合并。</p></li><li class="list__item" id="81180878"><p>如果使用“在VCS外部存储安全值（例如密码或API令牌）”选项进行版本设置，则不会为服务器上已经存在的项目导入凭据。</p></li><li class="list__item" id="0d1e70cb"><p>仅当在范围中选择用户时，才导入审核记录。</p></li><li class="list__item" id="111e26fe"><p>运行中的构建和构建队列不包括在备份中，也不会导入。</p></li><li class="list__item" id="92b3bec9"><p>导入期间不会保留内部ID（例如内部版本的ID）。这意味着即使导入时构建ID发生更改，即使重定向到新服务器，从旧服务器到构建结果页面的URL也会显示为损坏。</p></li><li class="list__item" id="9b2a0582"><p>备份文件不包含构件和日志（构建日志存储在构建构件下），因此它们不会自动导入，但是TeamCity提供了脚本来<a href="#Moving-artifacts-and-logs">手动</a>移动它们。</p></li><li class="list__item" id="4c0ed8dc"><p>不会导入全局服务器设置（身份验证方案，自定义角色等）。</p></li></ul><aside class="note " rel="0589f882" id="62047943" data-title=""><p id="11789c64">导入项目可能需要花费大量时间。每个服务器只能有一个导入过程。</p></aside></div><a name="Movingartifactsandlogs"></a><a name="Moving-artifacts-and-logs"></a><div class="chapter"><h2 id="ProjectsImport-Movingartifactsandlogs">移动工件和日志</h2><p id="353ddcf9">尽管没有直接从备份文件导入工件和日志，但是您可以使用以下命令将它们从源复制/移动到目标服务器： <code class="code">.bat</code>和<code class="code">.sh</code>来自的脚本<code class="code">projectsImport-<date></code>目录在TeamCity日志下。这些脚本通过命令行接受源和目标数据目录。脚本接受源<a href="build-artifact.html">工件目录</a>和目标<a href="build-artifact.html">工件目录</a> 。其余的将自动完成。可以在服务器运行时执行脚本。</p><p id="c2eaf045">TeamCity可能需要一些时间才能显示导入的构建工件。</p></div><a name="ViewingImportResults"></a><a name="Viewing-Import-Results"></a><div class="chapter"><h2 id="ProjectsImport-ViewingImportResults">查看导入结果</h2><p id="5ff323ff">每个导入过程都会创建一个<code class="code">projectsImport-<date></code>在TeamCity日志下的目录中，您可以查看导入结果。</p><p id="f8eaa56f">该目录包含以下内容：</p><ul class="list _ul"><li class="list__item" id="e1c1143d"><p>冲突的文件文件夹，其中包含已合并的所有数据</p></li><li class="list__item" id="67db6a3c"><p>映射，包含源数据库和目标数据库中字段的映射</p></li><li class="list__item" id="9d98a443"><p>用于复制工件和日志的脚本（请参见<a href="#Moving-artifacts-and-logs">以上</a>部分）</p></li><li class="list__item" id="708338c5"><p>导入报告，列出导入结果，包括有关尚未导入的数据的信息（如果有）</p></li></ul><hr id="dc93cee1"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>