<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Kotlin DSL-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Kotlin DSL" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/storing-project-settings-in-version-control.md|Storing Project Settings in Version Control/kotlin-dsl.md|Kotlin DSL/upgrading-dsl.md|Upgrading DSL" data-main-title="Kotlin DSL" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/kotlin-dsl.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="kotlin-dsl.md" data-toc="Kotlin DSL">Kotlin DSL</h1><p id="6f1b84bc">除了以XML格式<a href="storing-project-settings-in-version-control.html">在版本控制</a>中<a href="storing-project-settings-in-version-control.html">存储设置</a>外，TeamCity还允许将设置存储在DSL（基于<a href="https://kotlinlang.org/" rel="noopener noreferrer" data-external="true" target="_blank">Kotlin语言</a> ）中。</p><p id="0228aa94">使用版本控制存储的DSL，您可以以编程方式定义设置。由于Kotlin是静态类型的，因此您会在IDE中自动获得自动补全功能，这使发现可用的API选项变得更加简单。</p><p id="d056a3f5">查看有关在TeamCity中使用Kotlin DSL的<a href="https://blog.jetbrains.com/teamcity/2019/03/configuration-as-code-part-1-getting-started-with-kotlin-dsl" rel="noopener noreferrer" data-external="true" target="_blank">博客文章系列</a> 。</p><p id="a05ea4e8">在此页：</p><p id="08bd538e"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#KotlinDSL-GettingStartedwithKotlinDSL">Kotlin DSL入门</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-ProjectSettingsStructure">项目设置结构</a></li><li class="list__item"><a href="#KotlinDSL-OpeningProjectinIntelliJIDEA">在IntelliJ IDEA中打开项目</a></li><li class="list__item"><a href="#KotlinDSL-EditingKotlinDSL">编辑Kotlin DSL</a></li><li class="list__item"><a href="#KotlinDSL-Patches">补丁</a></li><li class="list__item"><a href="#KotlinDSL-SharingKotlinDSLScripts">共享Kotlin DSL脚本</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-AdvancedTopics">进阶主题</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-RestoringBuildHistoryAfterIDChange">ID更改后还原构建历史记录</a></li><li class="list__item"><a href="#KotlinDSL-Non-PortableDSL">不可携式DSL</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-settings.kts">settings.kts</a></li><li class="list__item"><a href="#KotlinDSL-Project.kt">项目.kt</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-DebuggingMavengenerateTask">调试Maven“生成”任务</a></li><li class="list__item"><a href="#KotlinDSL-AbilitytoUseExternalLibraries">使用外部库的能力</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-ViewDSLinUI">在UI中查看DSL</a></li><li class="list__item"><a href="#KotlinDSL-FAQandCommonProblems">常见问题和常见问题</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-WhyportableDSLrequiresthesameprefixforallIDs?">为什么便携式DSL要求所有ID都使用相同的前缀？</a></li><li class="list__item"><a href="#KotlinDSL-HowtoAdd.teamcityasaNewModuletoaProject?">如何将.teamcity作为新模块添加到项目中？</a></li><li class="list__item"><a href="#KotlinDSL-NewURLofSettingsVCSRoot(Nonportableformat)">设置VCS根目录的新URL（非便携式格式）</a></li><li class="list__item"><a href="#KotlinDSL-HowtoReadFilesinKotlinDSL">如何在Kotlin DSL中读取文件</a></li><li class="list__item"><a href="#KotlinDSL-KotlinDSLAPIdocumentationisnotinitializedyet">Kotlin DSL API文档尚未初始化</a></li><li class="list__item"><a href="#KotlinDSL-Passwords-RelatedQuestions">密码相关问题</a></li></ul></li></ul><p></p><a name="GettingStartedwithKotlinDSL"></a><a name="Getting-Started-with-Kotlin-DSL"></a><div class="chapter"><h2 id="KotlinDSL-GettingStartedwithKotlinDSL">Kotlin DSL入门</h2><p id="c2b93363">本<a href="https://play.kotlinlang.org/koans/overview" rel="noopener noreferrer" data-external="true" target="_blank">Kotlin教程</a>可帮助您快速学习大多数Kotlin功能。</p><p id="1d453ad2">要开始使用Kotlin DSL，请在服务器上创建一个空的沙箱项目，然后执行以下步骤：</p><ol class="list _decimal"><li class="list__item" id="dbc0e60c"><p>为您的项目<a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">启用版本设置</a> 。</p></li><li class="list__item" id="1933c5a8"><p>选择Kotlin作为格式。确保已启用“ <i id="9a7cc960">生成可移植DSL脚本”</i>选项。</p></li><li class="list__item" id="ddca8fd5"><p>点击<b id="3c32f1b2">Apply</b> ，TeamCity会将设置提交到您的存储库。</p></li></ol><aside class="note " rel="739af979" id="9669d0c2" data-title=""><p id="fd3ef797">在为项目设置启用Kotlin之后，您可能无法立即在Web UI中编辑项目。TeamCity需要在存储库中检测其自己的提交，并且仅在启用该编辑之后。通常需要一两分钟。</p></aside><p id="65011b6d"><a name="portableDSL"></a><a name="KotlinDSL-portableDSL"></a></p><a name="ProjectSettingsStructure"></a><a name="Project-Settings-Structure"></a><div class="chapter"><h3 id="KotlinDSL-ProjectSettingsStructure">项目设置结构</h3><p id="eafaf9f8">提交到存储库后，您将获得<code class="code">.teamcity</code>包含以下文件的设置目录：</p><ul class="list _ul"><li class="list__item" id="c057c7f1"><p><code class="code">settings.kts</code> –包含所有项目配置的主文件</p></li><li class="list__item" id="2dc11387"><p><code class="code">pom.xml</code> –仅当在IDE中打开项目以获得自动完成功能以及编译代码和编写单元测试功能时才需要</p></li></ul></div><a name="OpeningProjectinIntelliJIDEA"></a><a name="Opening-Project-in-IntelliJ-IDEA"></a><div class="chapter"><h3 id="KotlinDSL-OpeningProjectinIntelliJIDEA">在IntelliJ IDEA中打开项目</h3><p id="32640a7b">要在IntelliJ IDEA中打开Kotlin DSL项目，请打开<code class="code">.teamcity/pom.xml</code>文件作为项目。所有必要的依赖关系将立即自动解决。如果所有的依赖关系都已解决，则不会出现红色错误。 <code class="code">settings.kts</code> 。如果您已经有IntelliJ IDEA项目，并想向其中添加Kotlin DSL模块，请按照<a href="#How-to-Add-.teamcity-as-a-New-Module-to-a-Project?">相关说明进行操作</a> 。</p><aside class="note " rel="32640a7b" id="cc3e41f9" data-title=""><p id="1cd17509">如果您使用macOS，请注意<code class="code">.teamcity</code>默认情况下，该目录将被隐藏，并且IntelliJ IDEA不会在文件选择器中显示该目录。要显示隐藏的文件和目录，请按<code class="code">Command</code> + <code class="code">Shift</code> + <code class="code">.</code>在文件选择器中。</p></aside></div><a name="EditingKotlinDSL"></a><a name="Editing-Kotlin-DSL"></a><div class="chapter"><h3 id="KotlinDSL-EditingKotlinDSL">编辑Kotlin DSL</h3><p id="90e658c8">如果您创建了一个空项目，那么当您打开它时，您将在IDE中看到它<code class="code">settings.kts</code> ：</p><div class="code-block" data-lang="none">导入jetbrains.buildServer.configs.kotlin.v2018_1。* / *一些注释文本* /版本=“ 2018.1”项目{}</div><p id="2df4150e"><code class="code">project { }</code>代表您将在DSL中定义其设置的当前项目。这是在上一步中启用版本设置的同一项目。可以通过特殊的方式访问此项目ID和名称<code class="code">DslContext</code>对象，但不能通过DSL更改。</p><p id="28eb7e31">您可以通过调用以下内容在此项目中创建不同的实体<code class="code">vcsRoot()</code> ， <code class="code">buildType()</code> ， <code class="code">template()</code> ， 要么<code class="code">subProject()</code>方法。</p><p id="04d2a6bd">例如，要添加带有命令行脚本的构建配置，请执行以下操作：</p><div class="code-block" data-lang="none">导入jetbrains.buildServer.configs.kotlin.v2018_1。* import jetbrains.buildServer.configs.kotlin.v2018_1.buildSteps.script版本=“ 2018.1”项目{buildType {id（“ HelloWorld”）name =“ Hello world”步骤{脚本{scriptContent =“ echo'Hello world！'“}}}}</div><p id="6c6b59d4"><a name="id-or-name"></a><a name="KotlinDSL-id-or-name"></a></p><p id="71c66e90">这里， <code class="code">id</code>将用作TeamCity中“ <i id="4b94b543"><a href="identifier.html">构建配置ID”</a></i>字段的值。如果<code class="code">id</code>未指定，则<code class="code">name</code>参数将用作构建配置ID。</p><p id="3ccfecbc">之后，您可以将此更改提交到存储库– TeamCity将检测并应用它。如果脚本执行过程中没有错误，则应该在项目中看到名为“ Hello world”的构建配置。</p><aside class="note " rel="3ccfecbc" id="0eed8bc0" data-title=""><p id="a53017a3">要熟悉Kotlin API，请参阅本地服务器上的在线文档，可通过用户界面中“ <b id="9d7fa723">版本设置”</b>项目标签上的链接或通过运行<code class="code">mvn -U dependency:sources</code> IDE中的命令。作为<a href="https://teamcity.jetbrains.com/app/dsl-documentation/jetbrains.build-server.configs.kotlin.v2018_1/index.html" rel="noopener noreferrer" data-external="true" target="_blank">示例，</a>请参见公共TeamCity服务器上的文档。</p><p id="d1c98675">该文档是在单独的Java流程中生成的，并且在服务器重新启动后可能需要花费几分钟的时间来构建。</p><p id="c8c37f5e">您还可以使用项目“ <b id="8209c57c">操作”</b>菜单中的“ <b id="106a3a82">以Kotlin格式下载设置”</b>选项。例如，您可以找到一个项目，该项目定义了一些您想在Kotlin DSL项目中使用的设置，并使用此“下载”操作来查看TeamCity生成的DSL的外观。</p></aside></div><a name="Patches"></a><a name="Patches"></a><div class="chapter"><h3 id="KotlinDSL-Patches">补丁</h3><p id="62577f82">即使项目设置存储在Kotlin DSL中，TeamCity仍可以通过Web界面编辑项目。对于通过Web界面在项目中进行的每个更改，TeamCity都会以Kotlin格式生成一个补丁，该补丁将在项目<i id="3a290a00">补丁</i>目录下带有不同TeamCity实体的子目录的位置进行检入。例如，如果您更改构建配置，TeamCity将提交<code class="code">.teamcity/patches/buildTypes/<id>.kt</code>脚本进行必要的更改到存储库。</p><p id="f7bdfb7d">例如，以下修补程序将<a href="build-files-cleaner-swabra.html">构建文件清理器（Swabra）的</a>构建功能添加到具有ID的构建配置中<code class="code">SampleProject_Build</code> ：</p><div class="code-block" data-lang="none">changeBuildType（RelativeId（“ SampleProject_Build”））{//此部分查找必须进行更改的构建配置功能{add {//这是应复制到settings.kts文件交换的相应位置的部分{filesCleanup = Swabra。FilesCleanup。禁用}}}}</div><p id="21b80269">暗示您将更改从补丁文件移至您的<code class="code">settings.kts</code>并删除补丁文件。补丁生成允许从编辑设置通过Web UI平滑过渡到Kotlin DSL。</p></div><a name="SharingKotlinDSLScripts"></a><a name="Sharing-Kotlin-DSL-Scripts"></a><div class="chapter"><h3 id="KotlinDSL-SharingKotlinDSLScripts">共享Kotlin DSL脚本</h3><p id="4454b463">除了简单之外，便携式DSL脚本的优点之一是该脚本可以由多个项目或多个服务器使用（因此名称：可移植）。</p><p id="6a35f185">如果您有一个存储库<code class="code">.teamcity</code>包含可移植格式的设置，您可以基于这些设置轻松创建另一个项目。可以使用<a href="creating-and-editing-projects.html">“从URL创建项目”</a>功能。</p><p id="e191021f">将TeamCity指向您的存储库，它将检测到<code class="code">.teamcity</code>目录并提供从那里导入设置的信息：</p><p id="0059ceec"></p><figure><img alt="从URL创建项目时导入Kotlin设置" title="从URL创建项目时导入Kotlin设置" src="/help/img/teamcity/2019.1/NewKotlinProjectURL.png" id="24844ced" width="638" height="500"></figure><p></p><aside class="note " rel="0059ceec" id="67ab7a02" data-title=""><p id="ccfdd3c3">的<code class="code">settings.kts</code>脚本始终可以访问<code class="code">DslContext</code>包含ID和当前项目的其他一些设置的对象。</p></aside><p id="47d1ca79">根据上下文，DSL脚本可以生成略有不同的设置，例如：</p><div class="code-block" data-lang="none">var deployTarget = if（DslContext.projectId == AbsoluteId（“ Trunk”））{“登台”} else {“生产”}</div></div></div><a name="AdvancedTopics"></a><a name="Advanced-Topics"></a><div class="chapter"><h2 id="KotlinDSL-AdvancedTopics">进阶主题</h2><a name="RestoringBuildHistoryAfterIDChange"></a><a name="Restoring-Build-History-After-ID-Change"></a><div class="chapter"><h3 id="KotlinDSL-RestoringBuildHistoryAfterIDChange">ID更改后还原构建历史记录</h3><p id="a790dbcf">为了在基于便携式DSL的项目中标识构建配置，TeamCity使用分配给DSL中此构建配置的<a href="#id-or-name">ID</a> 。我们建议保持此ID不变，以便将DSL源中所做的更改一致地应用于TeamCity中的相应构建配置。<br>但是，如果您需要在DSL中修改构建配置ID，请注意，对于TeamCity而言，看起来好像已删除了具有先前ID的配置，并创建了具有新ID的新配置。在这种情况下，您仍然可以还原已删除配置的构建历史记录。</p><p id="75649418">如果基于DSL的项目使用<a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">版本设置</a> ，则TeamCity将检测源DSL中的任何更改，并将所有更改的设置重新应用到受影响的TeamCity实体。当您在<a href="#id-or-name">VCS源代码中</a>修改构建配置的ID时，TeamCity从Web UI删除“旧”配置，但将其构建历史记录保留在数据库中5天，然后对其进行清理。TeamCity提供了一种将此历史记录附加到任何现有的基于DSL的构建配置的方法。</p><p id="1e41c881">要在更改构建配置ID后恢复构建历史，请转到TeamCity中新创建的配置的“ <b id="e95e03fc">构建配置设置”</b> ，打开“ <b id="c539c146">操作”</b>菜单，然后单击“ <b id="0c17aef8">附加构建历史”</b> 。您将被重定向到临时的“ <b id="6e8f5b54">附加构建历史记录”</b>选项卡。在列表中选择最近删除的构建配置，然后单击“ <b id="a9fd250e">附加”</b> 。</p><p id="6613622b"></p><figure><img alt="附加构建历史" title="附加构建历史" src="/help/img/teamcity/2019.1/attach-build-history.png" id="6d29d08c" width="1283" height="1121"></figure><p></p><p id="1b72fc0e">TeamCity将还原所选配置的构建历史记录，并将其附加到新配置的构建历史记录中。</p></div><a name="Non-PortableDSL"></a><a name="Non-Portable-DSL"></a><div class="chapter"><h3 id="KotlinDSL-Non-PortableDSL">不可携式DSL</h3><p id="2b3539cb">2018.1之前的版本对Kotlin DSL设置使用了不同的格式。通过关闭“ <b id="e24db644">版本设置”</b>页面上的<b id="e24db644">“</b> <i id="4c8f8b73">生成便携式DSL脚本”</i>复选框，仍可以启用此格式。</p><p id="11c3e58c">当TeamCity生成非便携式DSL时， <code class="code">.teamcity</code>目录如下：</p><ul class="list _ul"><li class="list__item" id="9eaafc55"><code class="code">pom.xml</code></li><li class="list__item" id="4c8a4a5f"><code class="code"><project id>/settings.kts</code></li><li class="list__item" id="3b9e1e85"><code class="code"><project id>/Project.kt</code></li><li class="list__item" id="2b200b84"><code class="code"><project id>/buildTypes/<build conf id>.kt</code></li><li class="list__item" id="bc473fa7"><code class="code"><project id>/vcsRoots/<vcs root id>.kt</code></li></ul><p id="d9cd032f">哪里<code class="code"><project id></code>是启用版本控制的项目的ID。生成构建配置和VCS根目录的Kotlin DSL文件位于相应的子目录下。</p><a name="settings.kts"></a><a name="settings.kts"></a><div class="chapter"><h4 id="KotlinDSL-settings.kts">settings.kts</h4><p id="75567b57">在非便携式格式中，每个项目都具有以下内容<code class="code">settings.kts</code>文件：</p><div class="code-block" data-lang="none">包MyProject导入jetbrains.buildServer.configs.kotlin.v2018_1。* / * ...* /版本=“ 2018.1”项目（MyProjectId。项目）</div><p id="fa1f8132">这是生成项目设置的入口。基本上，它表示生成项目设置的Project实例。</p></div><a name="Project.kt"></a><a name="Project.kt"></a><div class="chapter"><h4 id="KotlinDSL-Project.kt">项目.kt</h4><p id="2b458f20">的<code class="code">Project.kt</code>文件外观如下：</p><div class="code-block" data-lang="none">软件包MyPackage导入jetbrains.buildServer.configs.kotlin.v2018_1。*导入jetbrains.buildServer.configs.kotlin.v2018_1。项目对象Project：Project（{uuid =“ 05acd964-b90f-4493-aa09-c2229f8c76c0” id（“ MyProjectId”）parentId（“ MyParent”）name =“我的项目” ...}）</div><p id="e0d1c838">哪里：</p><ul class="list _ul"><li class="list__item" id="5d82011a"><p><code class="code">id</code>是项目的绝对ID，如果您导航到该项目，则将在浏览器地址栏中看到相同的ID</p></li><li class="list__item" id="390cca8b"><p><code class="code">parentId</code>是附加有该项目的父项目的绝对ID</p></li><li class="list__item" id="b4c990ac"><p><code class="code">uuid</code>是一些独特的字符序列。<br>的<code class="code">uuid</code>是将项目，构建配置或VCS根与其数据相关联的唯一标识符。如果<code class="code">uuid</code>被更改，则数据丢失。还原数据的唯一方法是还原<code class="code">uuid</code>还原为原始值。另一方面， <code class="code">id</code>可以自由更改实体的<code class="code">uuid</code>保持不变。这是非便携式DSL格式与便携式格式的主要区别。可移植格式不需要指定<code class="code">uuid</code> ，但是如果发生这种情况，那么构建配置会丢失其历史记录（例如，在更改构建配置外部ID时），您可以使用“ <b id="de0b2371">操作”</b>菜单中的“ <b id="1cfa0a41">附加构建历史记录”</b>选项<b id="1cfa0a41">将历史记录</b>重新附加到构建配置中。查看<a href="#Restoring-Build-History-After-ID-Change">详细信息</a> 。</p></li></ul><aside class="note " rel="f45f6c92" id="27a18e96" data-title=""><p id="80e9b7c4">如果构建历史记录很重要，则应尽快恢复：删除后，在构建历史记录清理期间删除已删除配置的构建之前，存在可<a href="clean-up.html">配置的</a>超时（默认为5天）。</p></aside><p id="b430bc51">如果是不可移植的DSL，则修补程序存储在以下位置的项目<i id="f0cc8b92">修补程序</i>目录下： <code class="code">.teamcity</code> ：</p><ul class="list _ul"><li class="list__item" id="73987b39"><code class="code">pom.xml</code></li><li class="list__item" id="64c2618d"><code class="code"><project id>/settings.kts</code></li><li class="list__item" id="103e4e79"><code class="code"><project id>/Project.kt</code></li><li class="list__item" id="5d97f6c5"><code class="code"><project id>/patches/<uuid>.kt</code></li></ul><p id="49b9521b">使用补丁程序与在便携式DSL中相同：您需要将实际设置从补丁程序移至脚本并删除补丁程序。</p></div></div><a name="DebuggingMavengenerateTask"></a><a name="Debugging-Maven--generate--Task"></a><div class="chapter"><h3 id="KotlinDSL-DebuggingMavengenerateTask">调试Maven“生成”任务</h3><p id="541a0295">的<code class="code">pom.xml</code>为Kotlin项目提供的文件具有<code class="code">generate</code>任务，可用于从Kotlin DSL文件本地生成TeamCity XML文件。该任务支持调试。如果使用的是IntelliJ IDEA，则可以轻松开始调试Maven任务：</p><ol class="list _decimal"><li class="list__item" id="97ec21a1"><p>导航到<b id="e2a438bb">查看|工具窗口| Maven项目</b> 。显示“ <b id="fc05e337">Maven项目”</b>工具窗口。</p></li><li class="list__item" id="d560d1f5"><p>找到任务节点： <b id="b1dd56cd">Plugins | teamcity-configs | teamcity-configs：generate</b> ，上下文菜单中的<b id="3254584d">调试</b>选项可用：</p></li></ol><p id="a4eafcc3"></p><figure><img alt="在IDEA中调试任务" title="在IDEA中调试任务" src="/help/img/teamcity/2019.1/NewKotlinDebug.png" id="7482a27f" width="1320" height="1900"></figure><p></p></div><a name="AbilitytoUseExternalLibraries"></a><a name="Ability-to-Use-External-Libraries"></a><div class="chapter"><h3 id="KotlinDSL-AbilitytoUseExternalLibraries">使用外部库的能力</h3><p id="159f1432">您可以在Kotlin DSL代码中使用外部库，该库允许在基于Kotlin DSL的不同项目之间共享代码。</p><p id="13ed2838">要在您的Kotlin DSL代码中使用外部库，请将对此库的依赖项添加到<code class="code">.teamcity/pom.xml</code>文件添加到设置存储库中，然后提交此更改，以便TeamCity检测到它。然后，在开始生成过程之前，TeamCity服务器将从Maven存储库中获取必要的依赖项，并使用它们编译代码，然后启动设置生成器。</p></div></div><a name="ViewDSLinUI"></a><a name="View-DSL-in-UI"></a><div class="chapter"><h2 id="KotlinDSL-ViewDSLinUI">在UI中查看DSL</h2><p id="2d6e2fd3">在用户界面中查看构建配置设置时，可以单击侧栏中的“ <b id="652df5a9">查看DSL</b> ”：将显示当前配置的DSL表示，并突出显示正在查看的设置（例如，构建步骤，触发器，依赖项） 。要返回，请点击<b id="d989af66">UI中的编辑</b> 。</p></div><a name="FAQandCommonProblems"></a><a name="FAQ-and-Common-Problems"></a><div class="chapter"><h2 id="KotlinDSL-FAQandCommonProblems">常见问题和常见问题</h2><a name="WhyportableDSLrequiresthesameprefixforallIDs?"></a><a name="Why-portable-DSL-requires-the-same-prefix-for-all-IDs?"></a><div class="chapter"><h3 id="KotlinDSL-WhyportableDSLrequiresthesameprefixforallIDs?">为什么便携式DSL要求所有ID都使用相同的前缀？</h3><p id="70cc9599">模板，构建配置和VCS根在服务器上所有TeamCity项目中均具有<a href="identifier.html#Universally-Unique-IDs">唯一的ID</a> 。这些ID通常如下所示： <code class="code"><parent project id>_<entity id></code> 。</p><p id="235997a6">由于这些ID必须是唯一的，因此系统中不能有两个具有相同ID的不同实体。</p><p id="0efcfaa5">但是，将便携式DSL称为便携式的原因之一是因为相同<code class="code">settings.kts</code>即使在同一台服务器上，脚本也可以用于为两个不同项目生成设置。<br>为了在克服ID唯一性的同时实现这一目标，TeamCity使用便携式DSL脚本中的相对ID进行操作。这些相对ID中没有父项目ID前缀。因此，当TeamCity生成可移植的Kotlin DSL脚本时，它必须从所有生成的实体的ID中删除父项目ID前缀。</p><p id="9dd466d7">但是，如果不是所有的项目实体在其ID中都具有此前缀，则此方法将无效。在这种情况下，可能会显示以下错误：</p><p id="b6c9448d"><i id="189e53ee">构建配置ID“ <some id="">”应具有与其父项目ID相对应的前缀：“ <parent id="" project="">”</parent></some></i></p><p id="d713ab44">要解决此问题，请更改受影响实体的ID。如果有很多这样的ID，请使用“ <b id="289b44d9">批量编辑ID”</b>项目操作一次更改所有<b id="289b44d9">ID</b> 。</p></div><a name="HowtoAdd.teamcityasaNewModuletoaProject?"></a><a name="How-to-Add-.teamcity-as-a-New-Module-to-a-Project?"></a><div class="chapter"><h3 id="KotlinDSL-HowtoAdd.teamcityasaNewModuletoaProject?">如何将.teamcity作为新模块添加到项目中？</h3><p id="642db896"><i id="41ae94a4">问题</i> ：如何添加<code class="code">.teamcity</code>设置目录作为IntelliJ IDEA中现有项目的新模块？</p><p id="bf2ae299"><i id="3102f5cd">解决方案</i> ：在IntelliJ IDEA中的现有项目中：</p><ul class="list _ul"><li class="list__item" id="3d2c672c"><p>转到<b id="0d28d384">文件|项目结构</b> ，或按<b id="b8e4b323">Ctrl + Shift + Alt + S。</b></p></li><li class="list__item" id="dc4c814c"><p>在“ <b id="9dfc8b1f">项目设置”</b>部分下选择“ <b id="7fe38b8b">模块</b> <b id="9dfc8b1f">”</b> 。</p></li><li class="list__item" id="f20c1f83"><p>单击加号，选择<b id="9417a507">导入模块，</b>然后选择包含项目设置的文件夹。单击<b id="944cdbb2">确定，</b>然后按照向导进行操作。</p></li><li class="list__item" id="dc8bc989"><p>点击<b id="b8b94b28">应用</b> 。新模块将添加到您的项目结构中。</p></li></ul></div><a name="NewURLofSettingsVCSRoot(Nonportableformat)"></a><a name="New-URL-of-Settings-VCS-Root-(Non-portable-format)"></a><div class="chapter"><h3 id="KotlinDSL-NewURLofSettingsVCSRoot(Nonportableformat)">设置VCS根目录的新URL（非便携式格式）</h3><p id="8d9ef023"><i id="dfd5ca33">问题</i> ：我更改了在Kotlin中存储设置的VCS根目录的URL，现在TeamCity在新位置的存储库中找不到任何设置。</p><p id="173baa9c"><i id="8ce1d351">解决方案</i> ：</p><ul class="list _ul"><li class="list__item" id="dd5826fc"><p>在版本控制中修复Kotlin DSL中的URL，然后推送修复。</p></li><li class="list__item" id="13b1ef5a"><p>禁用版本设置以启用UI。</p></li><li class="list__item" id="b5afb522"><p>在用户界面的VCS根目录中修复URL。</p></li><li class="list__item" id="422cb843"><p><a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">重新启用</a>具有相同VCS根目录和Kotlin格式的<a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">版本设置</a> 。TeamCity将检测到存储库中包含<code class="code">.teamcity</code>目录并询问您是否要导入设置。</p></li><li class="list__item" id="1e2927b1"><p>选择导入设置。</p></li></ul></div><a name="HowtoReadFilesinKotlinDSL"></a><a name="How-to-Read-Files-in-Kotlin-DSL"></a><div class="chapter"><h3 id="KotlinDSL-HowtoReadFilesinKotlinDSL">如何在Kotlin DSL中读取文件</h3><p id="ed1f11f0"><i id="e1502c03">问题</i> ：我想根据驻留在VCS内部VCS中某些文件中的数据生成一个TeamCity构建配置<code class="code">.teamcity</code>目录。</p><p id="5b7a9292"><i id="bc2cd926">解决方案</i> ：TeamCity通过以下方式执行DSL <code class="code">.teamcity</code>作为当前目录，因此可以使用相对于<code class="code">.teamcity</code>目录，例如， <code class="code">File("data/setup.xml")</code> 。以外的文件<code class="code">.teamcity</code> Kotlin DSL无法访问该目录。</p></div><a name="KotlinDSLAPIdocumentationisnotinitializedyet"></a><a name="Kotlin-DSL-API-documentation-is-not-initialized-yet"></a><div class="chapter"><h3 id="KotlinDSL-KotlinDSLAPIdocumentationisnotinitializedyet">Kotlin DSL API文档尚未初始化</h3><p id="2e92e392"><i id="761ec4aa">问题</i> ：</p><ul class="list _ul"><li class="list__item" id="46976765"><p><code class="code">app/dsl-documentation/index.html</code>我们的Teamcity服务器上显示“ Kotlin DSL API文档尚未初始化”</p></li><li class="list__item" id="1b84b267"><p><code class="code">OutOfMemoryError</code>在TeamCity启动期间<code class="code">org.jetbrains.dokka</code>在堆栈中</p></li></ul><p id="07524853"><i id="8f8a470c">解决方案</i> ：设置内部属性<code class="code">teamcity.kotlinConfigsDsl.docsGenerationXmx=768m</code> 。</p></div><a name="Passwords-RelatedQuestions"></a><a name="Passwords-Related-Questions"></a><div class="chapter"><h3 id="KotlinDSL-Passwords-RelatedQuestions">密码相关问题</h3><p id="8772f532"><b id="2fcfdd66">在TeamCity 2017.1之前</b></p><p id="328e4bbd"><i id="7d538aa1">问题</i> ：我不希望将密码提交到VCS，即使是以加扰的形式。</p><p id="3717e01f"><i id="39605b94">解决方案</i> ：您可以将密码移到其设置未提交到VCS的父项目中。</p><p id="5dfcfab5"><i id="151e41d9">问题</i> ：生成设置后，我想更改密码。</p><p id="c6b9270c"><i id="9caf4419">解决方案</i> ：必须在具有设置的Maven项目中使用以下命令手动对密码进行加密：</p><div class="code-block" data-lang="bash">mvn -Dtext = <text to="" scramble="">org.jetbrains.teamcity：teamcity-configs-maven-plugin：scramble</text></div><p id="8d64d688"><b id="01c87453">从TeamCity 2017.1开始</b></p><p id="19dba57d"><i id="fd131e66">解决方案</i> ：使用令牌代替密码。请参阅<a href="storing-project-settings-in-version-control.html#Generating-Tokens">相关章节</a> 。</p><hr id="4a2374c8"><p id="9dd71581"><b id="1d2f65c0">也可以看看：</b></p><p id="a5676a9a"><b id="83529c60">管理员指南</b> ： <a href="storing-project-settings-in-version-control.html">在版本控制中存储项目设置</a><br><b id="a23539a2">TeamCity博客</b> ： <a href="https://blog.jetbrains.com/teamcity/2019/03/configuration-as-code-part-1-getting-started-with-kotlin-dsl/" rel="noopener noreferrer" data-external="true" target="_blank">以代码配置，第1部分：Kotlin DSL入门</a></p><hr id="ef24120b"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>