<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Kotlin DSL - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Kotlin DSL" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/storing-project-settings-in-version-control.md|Storing Project Settings in Version Control/kotlin-dsl.md|Kotlin DSL/upgrading-dsl.md|Upgrading DSL" data-main-title="Kotlin DSL" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/kotlin-dsl.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Kotlin DSL" id="kotlin-dsl.md">Kotlin DSL</h1><p id="6f1b84bc">Besides <a href="storing-project-settings-in-version-control.html">storing settings in version control</a> in XML format, TeamCity allows storing the settings in the DSL (based on the <a href="https://kotlinlang.org/" data-external="true" target="_blank" rel="noopener noreferrer">Kotlin language</a>).</p><p id="0228aa94">Using the version control-stored DSL enables you to define settings programmatically. Since Kotlin is statically typed, you automatically receive the autocompletion feature in an IDE which makes the discovery of available API options much simpler.</p><p id="d056a3f5">Check out the <a href="https://blog.jetbrains.com/teamcity/2019/03/configuration-as-code-part-1-getting-started-with-kotlin-dsl" data-external="true" target="_blank" rel="noopener noreferrer">blog post series</a> on using Kotlin DSL in TeamCity.</p><p id="a05ea4e8">On this page:</p><p id="08bd538e"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#KotlinDSL-GettingStartedwithKotlinDSL">Getting Started with Kotlin DSL</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-ProjectSettingsStructure">Project Settings Structure</a></li><li class="list__item"><a href="#KotlinDSL-OpeningProjectinIntelliJIDEA">Opening Project in IntelliJ IDEA</a></li><li class="list__item"><a href="#KotlinDSL-EditingKotlinDSL">Editing Kotlin DSL</a></li><li class="list__item"><a href="#KotlinDSL-Patches">Patches</a></li><li class="list__item"><a href="#KotlinDSL-SharingKotlinDSLScripts">Sharing Kotlin DSL Scripts</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-AdvancedTopics">Advanced Topics</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-RestoringBuildHistoryAfterIDChange">Restoring Build History After ID Change</a></li><li class="list__item"><a href="#KotlinDSL-Non-PortableDSL">Non-Portable DSL</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-settings.kts">settings.kts</a></li><li class="list__item"><a href="#KotlinDSL-Project.kt">Project.kt</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-DebuggingMavengenerateTask">Debugging Maven ‘generate’ Task</a></li><li class="list__item"><a href="#KotlinDSL-AbilitytoUseExternalLibraries">Ability to Use External Libraries</a></li></ul></li><li class="list__item"><a href="#KotlinDSL-ViewDSLinUI">View DSL in UI</a></li><li class="list__item"><a href="#KotlinDSL-FAQandCommonProblems">FAQ and Common Problems</a><ul class="list _bullet"><li class="list__item"><a href="#KotlinDSL-WhyportableDSLrequiresthesameprefixforallIDs?">Why portable DSL requires the same prefix for all IDs?</a></li><li class="list__item"><a href="#KotlinDSL-HowtoAdd.teamcityasaNewModuletoaProject?">How to Add .teamcity as a New Module to a Project?</a></li><li class="list__item"><a href="#KotlinDSL-NewURLofSettingsVCSRoot(Nonportableformat)">New URL of Settings VCS Root (Non portable format)</a></li><li class="list__item"><a href="#KotlinDSL-HowtoReadFilesinKotlinDSL">How to Read Files in Kotlin DSL</a></li><li class="list__item"><a href="#KotlinDSL-KotlinDSLAPIdocumentationisnotinitializedyet">Kotlin DSL API documentation is not initialized yet</a></li><li class="list__item"><a href="#KotlinDSL-Passwords-RelatedQuestions">Passwords-Related Questions</a></li></ul></li></ul></p><a name="GettingStartedwithKotlinDSL"></a><a name="Getting-Started-with-Kotlin-DSL"></a><div class="chapter"><h2 id="KotlinDSL-GettingStartedwithKotlinDSL">Getting Started with Kotlin DSL</h2><p id="c2b93363">This <a href="https://play.kotlinlang.org/koans/overview" data-external="true" target="_blank" rel="noopener noreferrer">Kotlin tutorial</a> helps quickly learn most Kotlin features.</p><p id="1d453ad2">To start working with Kotlin DSL, create an empty sandbox project on your server and follow these steps:</p><ol class="list _decimal"><li class="list__item" id="dbc0e60c"><p><a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">Enable versioned settings</a> for your project.</p></li><li class="list__item" id="1933c5a8"><p>Select Kotlin as the format. Make sure the <i id="9a7cc960">Generate portable DSL scripts</i> option is enabled.</p></li><li class="list__item" id="ddca8fd5"><p>Click <b id="3c32f1b2">Apply</b>, and TeamCity will commit the settings to your repository.</p></li></ol><aside class="note " data-title="" rel="739af979" id="9669d0c2"><p id="fd3ef797">You might not be able to edit a project in the web UI right after enabling Kotlin for the project settings. TeamCity needs to detect its own commit in the repository, and only after that editing will be enabled. Usually it takes a minute or two.</p></aside><p id="65011b6d"><a name="portableDSL"></a><a name="KotlinDSL-portableDSL"></a></p><a name="ProjectSettingsStructure"></a><a name="Project-Settings-Structure"></a><div class="chapter"><h3 id="KotlinDSL-ProjectSettingsStructure">Project Settings Structure</h3><p id="eafaf9f8">After the commit to the repository, you will get the <code class="code">.teamcity</code> settings directory with the following files:</p><ul class="list _ul"><li class="list__item" id="c057c7f1"><p><code class="code">settings.kts</code> – the main file containing all the project configuration</p></li><li class="list__item" id="2dc11387"><p><code class="code">pom.xml</code> – only required when opening the project in an IDE to get the autocompletion feature, and ability to compile code and write unit tests for it</p></li></ul></div><a name="OpeningProjectinIntelliJIDEA"></a><a name="Opening-Project-in-IntelliJ-IDEA"></a><div class="chapter"><h3 id="KotlinDSL-OpeningProjectinIntelliJIDEA">Opening Project in IntelliJ IDEA</h3><p id="32640a7b">To open the Kotlin DSL project in IntelliJ IDEA, open the <code class="code">.teamcity/pom.xml</code> file as a project. All necessary dependencies will be resolved automatically right away. If all dependencies have been resolved, no errors in red will be visible in <code class="code">settings.kts</code>. If you already have an IntelliJ IDEA project and want to add a Kotlin DSL module to it, follow <a href="#How-to-Add-.teamcity-as-a-New-Module-to-a-Project?">related instructions</a>.</p><aside class="note " data-title="" rel="32640a7b" id="cc3e41f9"><p id="1cd17509">If you use macOS, note that the <code class="code">.teamcity</code> directory will be hidden, and IntelliJ IDEA will not show it in the file chooser by default. To display the hidden files and directories, press <code class="code">Command</code> + <code class="code">Shift</code> + <code class="code">.</code> inside the file chooser.</p></aside></div><a name="EditingKotlinDSL"></a><a name="Editing-Kotlin-DSL"></a><div class="chapter"><h3 id="KotlinDSL-EditingKotlinDSL">Editing Kotlin DSL</h3><p id="90e658c8">If you created an empty project, that's what you'll see in your IDE when you open <code class="code">settings.kts</code>:</p><div class="code-block" data-lang="none">import jetbrains.buildServer.configs.kotlin.v2018_1.*
/* some comment text  */
version = "2018.1"
 
project {
}

</div><p id="2df4150e"><code class="code">project { }</code> represents the current project whose settings you'll define in the DSL. This is the same project where you enabled versioned settings on the previous step. This project ID and name can be accessed via a special <code class="code">DslContext</code> object but cannot be changed via the DSL.</p><p id="28eb7e31">You can create different entities in this project by calling <code class="code">vcsRoot()</code>, <code class="code">buildType()</code>, <code class="code">template()</code>, or <code class="code">subProject()</code> methods.</p><p id="04d2a6bd">For instance, to add a build configuration with a command line script, do the following:</p><div class="code-block" data-lang="none">import jetbrains.buildServer.configs.kotlin.v2018_1.*
import jetbrains.buildServer.configs.kotlin.v2018_1.buildSteps.script 

version = "2018.1"

project {
  buildType {
    id("HelloWorld")
    name = "Hello world"
    steps {
        script {
            scriptContent = "echo 'Hello world!'"
        }
    }
  }
}

</div><p id="6c6b59d4"><a name="id-or-name"></a><a name="KotlinDSL-id-or-name"></a></p><p id="71c66e90">Here, <code class="code">id</code> will be used as the value of the <i id="4b94b543"><a href="identifier.html">Build configuration ID</a></i> field in TeamCity. If <code class="code">id</code> is not specified, the value of the <code class="code">name</code> parameter will be used as the build configuration ID instead.</p><p id="3ccfecbc">After that, you can submit this change to the repository – TeamCity will detect and apply it. If there are no errors during the script execution, you should see a build configuration named "Hello world" in your project.</p><aside class="note " data-title="" rel="3ccfecbc" id="0eed8bc0"><p id="a53017a3">To get familiar with Kotlin API, see the online documentation on your local server, accessible via the link on the <b id="9d7fa723">Versioned Settings</b> project tab in the UI or by running the <code class="code">mvn -U dependency:sources</code> command in the IDE. See the documentation on the public TeamCity server as an <a href="https://teamcity.jetbrains.com/app/dsl-documentation/jetbrains.build-server.configs.kotlin.v2018_1/index.html" data-external="true" target="_blank" rel="noopener noreferrer">example</a>.</p><p id="d1c98675">The documentation is generated in a separate Java process and might take several minutes to build after the server restart.</p><p id="c8c37f5e">You can also use the <b id="106a3a82">Download settings in Kotlin format</b> option from the project <b id="8209c57c">Actions</b> menu. For instance, you can find a project that defines some settings that you want to use in your Kotlin DSL project and use this "download" action to see what the DSL generated by TeamCity looks like.</p></aside></div><a name="Patches"></a><a name="Patches"></a><div class="chapter"><h3 id="KotlinDSL-Patches">Patches</h3><p id="62577f82">TeamCity allows editing a project via the web interface, even though the project settings are stored in Kotlin DSL. For every change made in the project via the web interface, TeamCity will generate a patch in the Kotlin format, which will be checked in under the project <i id="3a290a00">patches</i> directory with subdirectories for different TeamCity entities. For example, if you change a build configuration, TeamCity will submit the <code class="code">.teamcity/patches/buildTypes/&lt;id&gt;.kt</code> script to the repository with necessary changes.</p><p id="f7bdfb7d">For instance, the following patch adds the <a href="build-files-cleaner-swabra.html">Build files cleaner (Swabra)</a> build feature to the build configuration with the ID <code class="code">SampleProject_Build</code>:</p><div class="code-block" data-lang="none">changeBuildType(RelativeId("SampleProject_Build")) { // this part finds the build configuration where the change has to be done  
    features {
        add {
            // this is the part which should be copied to a corresponding place of the settings.kts file
            swabra {
                filesCleanup = Swabra.FilesCleanup.DISABLED
            }
        }
    }
}

</div><p id="21b80269">It is implied that you move the changes from the patch file to your <code class="code">settings.kts</code> and delete the patch file. Patches generation allows smooth transition from editing settings via the web UI to Kotlin DSL.</p></div><a name="SharingKotlinDSLScripts"></a><a name="Sharing-Kotlin-DSL-Scripts"></a><div class="chapter"><h3 id="KotlinDSL-SharingKotlinDSLScripts">Sharing Kotlin DSL Scripts</h3><p id="4454b463">Besides simplicity, one of the advantages of the portable DSL script is that the script can be used by more than one project or more than one server (hence the name: portable).</p><p id="6a35f185">If you have a repository with <code class="code">.teamcity</code> containing settings in portable format, you can easily create another project based on these settings. The <a href="creating-and-editing-projects.html">Create Project From URL</a> feature can be used for this.</p><p id="e191021f">Point TeamCity to your repository, and it will detect the <code class="code">.teamcity</code> directory and offer to import settings from there:</p><p id="0059ceec"><figure><img alt="Importing Kotlin settings when creating a project from URL" title="Importing Kotlin settings when creating a project from URL" src="/help/img/teamcity/2019.1/NewKotlinProjectURL.png" id="24844ced" width="638" height="500"></figure></p><aside class="note " data-title="" rel="0059ceec" id="67ab7a02"><p id="ccfdd3c3">The <code class="code">settings.kts</code> script can always access a <code class="code">DslContext</code> object which contains the ID and some other settings of the current project.</p></aside><p id="47d1ca79">Based on the context, the DSL script can generate slightly different settings, for instance:</p><div class="code-block" data-lang="none">var deployTarget = if (DslContext.projectId == AbsoluteId("Trunk")) {
    "staging"
} else {
    "production"
}

</div></div></div><a name="AdvancedTopics"></a><a name="Advanced-Topics"></a><div class="chapter"><h2 id="KotlinDSL-AdvancedTopics">Advanced Topics</h2><a name="RestoringBuildHistoryAfterIDChange"></a><a name="Restoring-Build-History-After-ID-Change"></a><div class="chapter"><h3 id="KotlinDSL-RestoringBuildHistoryAfterIDChange">Restoring Build History After ID Change</h3><p id="a790dbcf">To identify a build configuration in a project based on the portable DSL, TeamCity uses the <a href="#id-or-name">ID</a> assigned to this build configuration in DSL. We recommend keeping this ID constant, so the changes made in the DSL source are consistently applied to the respective build configuration in TeamCity.<br>However, if you need to modify the build configuration ID in the DSL, note that for TeamCity it looks like the configuration with the previous ID was deleted and a new configuration with the new ID was created. In this case, you can still restore the history of builds of the deleted configuration.</p><p id="75649418">If your DSL-based project uses <a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">versioned settings</a>, TeamCity detects any change in the source DSL and reapplies all the changed settings to affected TeamCity entities. When you modify the ID of a build configuration in the <a href="#id-or-name">VCS source</a>, TeamCity deletes the "old" configuration from the web UI, but keeps the history of its builds in the database for 5 days and only then cleans it up. TeamCity provides a way to attach this history to any existing DSL-based build configuration.</p><p id="1e41c881">To restore the build history after changing the build configuration ID, go to the <b id="e95e03fc">Build Configuration Settings</b> of the newly created configuration in TeamCity, open the <b id="c539c146">Actions</b> menu, and click <b id="0c17aef8">Attach build history</b>. You will be redirected to the temporary <b id="6e8f5b54">Attach Build History</b> tab. Select the recently deleted build configuration in the list and click <b id="a9fd250e">Attach</b>.</p><p id="6613622b"><figure><img alt="Attaching a build history" title="Attaching a build history" src="/help/img/teamcity/2019.1/attach-build-history.png" id="6d29d08c" width="1283" height="1121"></figure></p><p id="1b72fc0e">TeamCity will restore the history of builds of the selected configuration and attach it to the history of builds of the new configuration.</p></div><a name="Non-PortableDSL"></a><a name="Non-Portable-DSL"></a><div class="chapter"><h3 id="KotlinDSL-Non-PortableDSL">Non-Portable DSL</h3><p id="2b3539cb">Versions before 2018.1 used a different format for Kotlin DSL settings. This format can still be enabled by turning off the <i id="4c8f8b73">Generate portable DSL scripts</i> checkbox on the <b id="e24db644">Versioned Settings</b> page.</p><p id="11c3e58c">When TeamCity generates a non-portable DSL, the project structure in the <code class="code">.teamcity</code> directory looks as follows:</p><ul class="list _ul"><li class="list__item" id="9eaafc55"><code class="code">pom.xml</code></li><li class="list__item" id="4c8a4a5f"><code class="code">&lt;project id&gt;/settings.kts</code></li><li class="list__item" id="3b9e1e85"><code class="code">&lt;project id&gt;/Project.kt</code></li><li class="list__item" id="2b200b84"><code class="code">&lt;project id&gt;/buildTypes/&lt;build conf id&gt;.kt</code></li><li class="list__item" id="bc473fa7"><code class="code">&lt;project id&gt;/vcsRoots/&lt;vcs root id&gt;.kt</code></li></ul><p id="d9cd032f">where <code class="code">&lt;project id&gt;</code> is the ID of the project where versioned settings are enabled. The Kotlin DSL files producing build configurations and VCS roots are placed under the corresponding subdirectories.</p><a name="settings.kts"></a><a name="settings.kts"></a><div class="chapter"><h4 id="KotlinDSL-settings.kts">settings.kts</h4><p id="75567b57">In the non-portable format each project has the following <code class="code">settings.kts</code> file:</p><div class="code-block" data-lang="none">package MyProject
import jetbrains.buildServer.configs.kotlin.v2018_1.*
/* ... */
version = "2018.1"

project(MyProjectId.Project)

</div><p id="fa1f8132">This is the entry point for project settings generation. Basically, it represents a Project instance which generates project settings.</p></div><a name="Project.kt"></a><a name="Project.kt"></a><div class="chapter"><h4 id="KotlinDSL-Project.kt">Project.kt</h4><p id="2b458f20">The <code class="code">Project.kt</code> file looks as follows:</p><div class="code-block" data-lang="none">package MyPackage
import jetbrains.buildServer.configs.kotlin.v2018_1.*
import jetbrains.buildServer.configs.kotlin.v2018_1.Project

object Project : Project({
   uuid = "05acd964-b90f-4493-aa09-c2229f8c76c0"
   id("MyProjectId")
   parentId("MyParent")
   name = "My project"
   ...
})

</div><p id="e0d1c838">where:</p><ul class="list _ul"><li class="list__item" id="5d82011a"><p><code class="code">id</code> is the absolute ID of the project, the same ID you'll see in browser address bar if you navigate to this project</p></li><li class="list__item" id="390cca8b"><p><code class="code">parentId</code> is the absolute ID of a parent project where this project is attached</p></li><li class="list__item" id="b4c990ac"><p><code class="code">uuid</code> is some unique sequence of characters.<br>The<code class="code">uuid</code> is a unique identifier which associates a project, build configuration or VCS root with its data. If the <code class="code">uuid</code> is changed, then the data is lost. The only way to restore the data is to revert the <code class="code">uuid</code> to the original value. On the other hand, the <code class="code">id</code> of an entity can be changed freely, if the <code class="code">uuid</code> remains the same. This is the main difference of the non-portable DSL format from portable. The portable format does not require specifying the <code class="code">uuid</code>, but if it happened so that a build configuration lost its history (e.g. on changing build configuration external id) you can reattach the history to the build configuration using the <b id="1cfa0a41">Attach build history</b> option from the <b id="de0b2371">Actions</b> menu. See <a href="#Restoring-Build-History-After-ID-Change">details</a>.</p></li></ul><aside class="note " data-title="" rel="f45f6c92" id="27a18e96"><p id="80e9b7c4">If the build history is important, it should be restored as soon as possible: after the deletion, there is a <a href="clean-up.html">configurable</a> timeout (5 days by default) before the builds of the deleted configuration are removed during the build history clean-up.</p></aside><p id="b430bc51">In case of a non-portable DSL, patches are stored under the project <i id="f0cc8b92">patches</i> directory of <code class="code">.teamcity</code>:</p><ul class="list _ul"><li class="list__item" id="73987b39"><code class="code">pom.xml</code></li><li class="list__item" id="64c2618d"><code class="code">&lt;project id&gt;/settings.kts</code></li><li class="list__item" id="103e4e79"><code class="code">&lt;project id&gt;/Project.kt</code></li><li class="list__item" id="5d97f6c5"><code class="code">&lt;project id&gt;/patches/&lt;uuid&gt;.kt</code></li></ul><p id="49b9521b">Working with patches is the same as in portable DSL: you need to move the actual settings from the patch to your script and remove the patch.</p></div></div><a name="DebuggingMavengenerateTask"></a><a name="Debugging-Maven--generate--Task"></a><div class="chapter"><h3 id="KotlinDSL-DebuggingMavengenerateTask">Debugging Maven ‘generate’ Task</h3><p id="541a0295">The <code class="code">pom.xml</code> file provided for a Kotlin project has the <code class="code">generate</code> task, which can be used to generate TeamCity XML files locally from the Kotlin DSL files. This task supports debugging. If you are using IntelliJ IDEA, you can easily start debugging of a Maven task:</p><ol class="list _decimal"><li class="list__item" id="97ec21a1"><p>Navigate to <b id="e2a438bb">View | Tool Windows | Maven Projects</b>. The <b id="fc05e337">Maven Projects</b> tool window is displayed.</p></li><li class="list__item" id="d560d1f5"><p>Locate the task node: <b id="b1dd56cd">Plugins | teamcity-configs | teamcity-configs:generate</b>, the <b id="3254584d">Debug</b> option is available in the context menu for the task:</p></li></ol><p id="a4eafcc3"><figure><img alt="Debugging a task in IDEA" title="Debugging a task in IDEA" src="/help/img/teamcity/2019.1/NewKotlinDebug.png" id="7482a27f" width="1320" height="1900"></figure></p></div><a name="AbilitytoUseExternalLibraries"></a><a name="Ability-to-Use-External-Libraries"></a><div class="chapter"><h3 id="KotlinDSL-AbilitytoUseExternalLibraries">Ability to Use External Libraries</h3><p id="159f1432">You can use external libraries in your Kotlin DSL code, which allows sharing code between different Kotlin DSL-based projects.</p><p id="13ed2838">To use an external library in your Kotlin DSL code, add a dependency on this library to the <code class="code">.teamcity/pom.xml</code> file in the settings repository and commit this change so that TeamCity detects it. Then, before starting the generation process, the TeamCity server will fetch the necessary dependencies from the Maven repository, compile code with them, and then start the settings generator.</p></div></div><a name="ViewDSLinUI"></a><a name="View-DSL-in-UI"></a><div class="chapter"><h2 id="KotlinDSL-ViewDSLinUI">View DSL in UI</h2><p id="2d6e2fd3">When viewing your build configuration settings in the UI, you can click <b id="652df5a9">View DSL</b> in the sidebar: the DSL representation of the current configuration will be displayed and the setting being viewed (for example, a build step, a trigger, dependencies) will be highlighted. To go back, click <b id="d989af66">Edit in UI</b>.</p></div><a name="FAQandCommonProblems"></a><a name="FAQ-and-Common-Problems"></a><div class="chapter"><h2 id="KotlinDSL-FAQandCommonProblems">FAQ and Common Problems</h2><a name="WhyportableDSLrequiresthesameprefixforallIDs?"></a><a name="Why-portable-DSL-requires-the-same-prefix-for-all-IDs?"></a><div class="chapter"><h3 id="KotlinDSL-WhyportableDSLrequiresthesameprefixforallIDs?">Why portable DSL requires the same prefix for all IDs?</h3><p id="70cc9599">Templates, build configurations, and VCS roots have <a href="identifier.html#Universally-Unique-IDs">unique IDs</a> throughout all the TeamCity projects on the server. These IDs usually look like: <code class="code">&lt;parent project id&gt;_&lt;entity id&gt;</code>.</p><p id="235997a6">Since these IDs must be unique, there cannot be two different entities in the system with the same ID.</p><p id="0efcfaa5">However, one of the reasons why portable DSL is called portable is because the same <code class="code">settings.kts</code> script can be used to generate settings for two different projects even on the same server.<br>To achieve this while overcoming IDs uniqueness, TeamCity operates with relative IDs in portable DSL scripts. These relative IDs do not have parent project ID prefix in them. So when TeamCity generates portable Kotlin DSL scripts, it has to remove the parent project ID prefix from the IDs of all of the generated entities.</p><p id="9dd466d7">But this will not work if not all of the project entities have this prefix in their IDs. In this case the following error can be shown:</p><p id="b6c9448d"><i id="189e53ee">Build configuration id '&lt;some id&gt;' should have a prefix corresponding to its parent project id: '&lt;parent project id&gt;'</i></p><p id="d713ab44">To fix this problem, change the ID of the affected entity. If there are many such IDs, use the <b id="289b44d9">Bulk edit IDs</b> project action to change all of them at once.</p></div><a name="HowtoAdd.teamcityasaNewModuletoaProject?"></a><a name="How-to-Add-.teamcity-as-a-New-Module-to-a-Project?"></a><div class="chapter"><h3 id="KotlinDSL-HowtoAdd.teamcityasaNewModuletoaProject?">How to Add .teamcity as a New Module to a Project?</h3><p id="642db896"><i id="41ae94a4">Question</i>: How to add the <code class="code">.teamcity</code> settings directory as a new module to an existing project in IntelliJ IDEA?</p><p id="bf2ae299"><i id="3102f5cd">Solution</i>: In your existing project in  IntelliJ IDEA:</p><ul class="list _ul"><li class="list__item" id="3d2c672c"><p>Go to <b id="0d28d384">File | Project Structure</b>, or press <b id="b8e4b323">Ctrl+Shift+Alt+S</b>.</p></li><li class="list__item" id="dc4c814c"><p>Select <b id="7fe38b8b">Modules</b> under the <b id="9dfc8b1f">Project Settings</b> section.</p></li><li class="list__item" id="f20c1f83"><p>Click the plus sign, select <b id="9417a507">Import module</b> and choose the folder containing your project settings. Click <b id="944cdbb2">Ok</b> and follow the wizard.</p></li><li class="list__item" id="dc8bc989"><p>Click <b id="b8b94b28">Apply</b>. The new module is added to your project structure.</p></li></ul></div><a name="NewURLofSettingsVCSRoot(Nonportableformat)"></a><a name="New-URL-of-Settings-VCS-Root-(Non-portable-format)"></a><div class="chapter"><h3 id="KotlinDSL-NewURLofSettingsVCSRoot(Nonportableformat)">New URL of Settings VCS Root (Non portable format)</h3><p id="8d9ef023"><i id="dfd5ca33">Problem</i>: I changed the URL of the VCS root where settings are stored in Kotlin, and now TeamCity cannot find any settings in the repository at the new location.</p><p id="173baa9c"><i id="8ce1d351">Solution</i>:</p><ul class="list _ul"><li class="list__item" id="dd5826fc"><p>Fix the URL in the Kotlin DSL in the version control and push the fix.</p></li><li class="list__item" id="13b1ef5a"><p>Disable versioned settings to enable the UI.</p></li><li class="list__item" id="b5afb522"><p>Fix the URL in the VCS root in the UI.</p></li><li class="list__item" id="422cb843"><p><a href="storing-project-settings-in-version-control.html#Synchronizing-Settings-with-VCS">Enable versioned settings</a> with the same VCS root and the Kotlin format again. TeamCity will detect that the repository contains the <code class="code">.teamcity</code> directory and ask you if you want to import settings.</p></li><li class="list__item" id="1e2927b1"><p>Choose to import settings.</p></li></ul></div><a name="HowtoReadFilesinKotlinDSL"></a><a name="How-to-Read-Files-in-Kotlin-DSL"></a><div class="chapter"><h3 id="KotlinDSL-HowtoReadFilesinKotlinDSL">How to Read Files in Kotlin DSL</h3><p id="ed1f11f0"><i id="e1502c03">Problem</i>: I want to generate a TeamCity build configuration based on the data in some file residing in the VCS inside the <code class="code">.teamcity</code> directory.</p><p id="5b7a9292"><i id="bc2cd926">Solution</i>: TeamCity executes DSL with <code class="code">.teamcity</code> as the current directory, so files can be read using the paths relative to the <code class="code">.teamcity</code> directory, for example, <code class="code">File("data/setup.xml")</code>. Files outside the <code class="code">.teamcity</code> directory are not accessible to Kotlin DSL.</p></div><a name="KotlinDSLAPIdocumentationisnotinitializedyet"></a><a name="Kotlin-DSL-API-documentation-is-not-initialized-yet"></a><div class="chapter"><h3 id="KotlinDSL-KotlinDSLAPIdocumentationisnotinitializedyet">Kotlin DSL API documentation is not initialized yet</h3><p id="2e92e392"><i id="761ec4aa">Problem</i>:</p><ul class="list _ul"><li class="list__item" id="46976765"><p><code class="code">app/dsl-documentation/index.html</code> on our Teamcity server displays "Kotlin DSL API documentation is not initialized yet"</p></li><li class="list__item" id="1b84b267"><p><code class="code">OutOfMemoryError</code> during TeamCity startup with <code class="code">org.jetbrains.dokka</code> in stack trace</p></li></ul><p id="07524853"><i id="8f8a470c">Solution</i>: set the internal property <code class="code">teamcity.kotlinConfigsDsl.docsGenerationXmx=768m</code>.</p></div><a name="Passwords-RelatedQuestions"></a><a name="Passwords-Related-Questions"></a><div class="chapter"><h3 id="KotlinDSL-Passwords-RelatedQuestions">Passwords-Related Questions</h3><p id="8772f532"><b id="2fcfdd66">Prior to TeamCity 2017.1</b></p><p id="328e4bbd"><i id="7d538aa1">Problem</i>: I do not want the passwords to be committed to the VCS, even in a scrambled form.</p><p id="3717e01f"><i id="39605b94">Solution</i>: You can move the passwords to the parent project whose settings are not committed to a VCS.</p><p id="5dfcfab5"><i id="151e41d9">Problem</i>: I want to change passwords after the settings have been generated.</p><p id="c6b9270c"><i id="9caf4419">Solution</i>: The passwords will have to be scrambled manually using the following command in the Maven project with settings:</p><div class="code-block" data-lang="bash">mvn -Dtext=&lt;text to scramble&gt; org.jetbrains.teamcity:teamcity-configs-maven-plugin:scramble

</div><p id="8d64d688"><b id="01c87453">Since TeamCity 2017.1</b></p><p id="19dba57d"><i id="fd131e66">Solution</i>: Use tokens instead of passwords. Refer to the <a href="storing-project-settings-in-version-control.html#Generating-Tokens">related section</a>.</p><hr id="4a2374c8"><p id="9dd71581"><b id="1d2f65c0">See also:</b></p><p id="a5676a9a"><b id="83529c60">Administrator's Guide</b>: <a href="storing-project-settings-in-version-control.html">Storing Project Settings in Version Control</a><br><b id="a23539a2">TeamCity blog</b>: <a href="https://blog.jetbrains.com/teamcity/2019/03/configuration-as-code-part-1-getting-started-with-kotlin-dsl/" data-external="true" target="_blank" rel="noopener noreferrer">Configuration as Code, Part 1: Getting Started with Kotlin DSL</a></p><hr id="ef24120b"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>