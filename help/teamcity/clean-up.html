<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Clean-Up - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Clean-Up" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/concepts.md|Concepts/clean-up.md|Clean-Up" data-main-title="Clean-Up" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/clean-up.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Clean-Up" id="clean-up.md">Clean-Up</h1><p id="cbb945f0">On this page</p><p id="4793c8cc"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Clean-Up-ServerClean-upSettings">Server Clean-up Settings</a><ul class="list _bullet"><li class="list__item"><a href="#Clean-Up-ManualClean-upLaunch">Manual Clean-up Launch</a></li></ul></li><li class="list__item"><a href="#Clean-Up-ProjectClean-upRules">Project Clean-up Rules</a><ul class="list _bullet"><li class="list__item"><a href="#Clean-Up-Clean-upforDependentBuilds">Clean-up for Dependent Builds</a></li><li class="list__item"><a href="#Clean-Up-Clean-upinBuildConfigurationswithFeatureBranches">Clean-up in Build Configurations with Feature Branches</a></li><li class="list__item"><a href="#Clean-Up-Clean-upofPersonalBuilds">Clean-up of Personal Builds</a></li><li class="list__item"><a href="#Clean-Up-DeletedBuildConfigurationsCleanup">Deleted Build Configurations Cleanup</a></li></ul></li></ul></p><p id="9aedbdb6">Clean-up in TeamCity is a feature allowing an automatic deletion of data belonging to old builds.</p><p id="ff0306f8">The server clean-up configuration is available in the server <b id="840dbf20">Administration | Clean-up Settings</b>.</p><p id="ff8f2a0a">Project-related clean-up settings are configured in the <b id="e620f2e0">Project Settings | Clean-up Rules</b>.</p><p id="f2a8ae29">It is recommended to configure clean-up rules to remove obsolete builds and their artifacts, purge unnecessary data from database and caches in order to free disk space, remove builds from the TeamCity UI and reduce the TeamCity workload.</p><p id="7df4738b">Clean-up deletes the data stored under <code class="code">&lt;</code><a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a><code class="code">&gt;/system</code> and in the database. Also, during the clean-up time the server performs various maintenance tasks (for example, resets VCS full patch caches).</p><a name="ServerClean-upSettings"></a><a name="Server-Clean-up-Settings"></a><div class="chapter"><h2 id="Clean-Up-ServerClean-upSettings">Server Clean-up Settings</h2><p id="16e83841">The server settings are configured on the <b id="6f9c1f75">Administration | Server Administration | clean-up Settings</b>.</p><p id="8a122344">The build history clean-up is run as a background process, which means that there is no server maintenance down-time.</p><aside class="note " data-title="" rel="8a122344" id="c513e216"><p id="4c6a6987">If you use the default HSQL database, there is a short period of server unavailability when the HSQL database is being compacted.</p></aside><p id="6c7552d7">Depending on the amount of data to clean up, the process may take significant time, during which the server might be less performant. Therefore, it is recommended to schedule clean-up for off-peak hours. By default, TeamCity will start cleaning up daily at 3.00 AM. It is also possible to <a href="#Manual-Clean-up-Launch">start clean-up manually</a>.</p><p id="362f91af">You can also specify the time limit for the clean-up process. In case not all the data is purged within the time-frame specified, the remaining data will be removed during the next clean-up process.</p><p id="9d606d22">With clean-up enabled, TeamCity will keep the server <a href="tracking-user-actions.html">audit records</a> for a year (365 days) by default.</p><a name="ManualClean-upLaunch"></a><a name="Manual-Clean-up-Launch"></a><div class="chapter"><h3 id="Clean-Up-ManualClean-upLaunch">Manual Clean-up Launch</h3><p id="3250a933">The <b id="35d151ce">Previous clean-up</b> section of the server clean-up settings enables you to:</p><ul class="list _ul"><li class="list__item" id="345acd81"><p>review the information on the previous server clean-up date and duration helping you decide whether to launch the clean-up process at a given moment</p></li><li class="list__item" id="3d8932d9"><p>run clean-up manually using the <b id="8c7ab226">Start clean-up now</b> button.During clean-up, TeamCity reports the progress. If you need, you can stop the clean-up process and the remaining data will be removed during the next clean-up.</p></li></ul></div></div><a name="ProjectClean-upRules"></a><a name="Project-Clean-up-Rules"></a><div class="chapter"><h2 id="Clean-Up-ProjectClean-upRules">Project Clean-up Rules</h2><p id="fa5eab16"><i id="4b03b0b4">clean-up</i> rules are configured per project and define when and what data to clean.</p><p id="d3630e08">To manage the rules, use the <b id="12cc9df1">Project-Settings | Clean-up Rules</b> page where you can specify different rules for a project or a build configuration. You can also specify them for a template, and then they will be inherited by all build configurations using this template.</p><p id="790ade9d">The following inheritance rules apply:</p><ul class="list _ul"><li class="list__item" id="a4182f82"><p>if a clean-up rule is assigned to a project, it becomes default for all build configurations or subprojects in this project</p></li><li class="list__item" id="267aa36a"><p>if a clean-up rule is assigned to a template, it becomes default for all configurations inherited from this template, but if clean-up rules are assigned to both a template and a project, the rule from the project will override the rule from the template</p></li><li class="list__item" id="230206aa"><p>if a clean-up rule is assigned to a build configuration, it will override the clean-up rule from the project or a template it is based on.</p></li></ul><p id="a73c9976">In each rule, you can define a number of successful builds to preserve, and/or the period of time to keep builds in history (for example, keep builds for 7 days).</p><p id="6aad52e1">The following clean-up levels are available:</p><ul class="list _ul"><li class="list__item" id="2993f24a"><p><b id="b28e5224">Artifacts</b> (all other data including build logs is preserved. <a href="build-artifact.html#Hidden-Artifacts">Hidden Artifacts</a> are also preserved);</p></li><li class="list__item" id="8c7ed650"><p><b id="0cccd6ef">History</b> (all the build data is deleted except for builds statistics values that are visible in the <a href="statistic-charts.html">statistics charts</a>);</p></li><li class="list__item" id="9df3b783"><p><b id="d52d1174">Everything</b> (no build data remains in TeamCity).</p></li></ul><p id="6124dc23">Each level includes the one(s) listed above it.</p><p id="155a7789">By default, everything is kept forever. When you select custom settings, for each of the items above you can specify:</p><ul class="list _ul"><li class="list__item" id="69ca0bab"><p>the number of days. Builds older than the number of days specified will be cleaned with the specified level. The starting point is the date of the last build, not the current date. A day is equivalent to a 24-hour period, not a calendar day;</p></li><li class="list__item" id="1a93d079"><p>the number of successful builds. Only builds older than the last matching successful build will be cleaned with the level specified (all the failed builds between the preserved successful ones are kept). This rule is only taken into account if there are successful builds in the build configuration.</p></li></ul><p id="9fc0b704">When both conditions are specified, only the builds which must be cleaned according to all rules will be actually removed: TeamCity finds the oldest build to preserve according to each of the rules and then cleans all builds older than the oldest one of the two found.</p><p id="47259d36">For the <b id="dcce1136">Artifacts</b> level you can also specify the patterns for the artifact names: the artifacts matching the specified pattern will be in/excluded from the clean-up. Use newline-delimited rules following <a href="http://ant.apache.org/manual/dirtasks.html#patterns" data-external="true" target="_blank" rel="noopener noreferrer">Ant-like pattern</a>. For example:</p><ul class="list _ul"><li class="list__item" id="d0a8018e"><p>to clean-up artifacts with 'file' as a part of the name, use the following syntax: <code class="code">+:**/file*.*</code>.</p></li><li class="list__item" id="36e83e01"><p>to exclude <code class="code">*.jar</code> artifacts with <code class="code">file</code> as a part of the name from clean-up, use <code class="code">-:**/file*.jar</code>.</p></li></ul><p id="77041730">There are builds that preserve all their data and are not affected during cleanup. These are:</p><ul class="list _ul"><li class="list__item" id="ba22865a"><p><a href="pinned-build.html">pinned builds</a>;</p></li><li class="list__item" id="ba911558"><p>builds used as an <a href="configuring-dependencies.html">artifact of shanpshot dependency</a> in other builds when the "Prevent clean-up" option for dependencies is enabled in the build configuration. See <a href="#Clean-up-for-Dependent-Builds">Clean-Up for Dependent Builds</a> below. Such builds are marked with the <img alt="link.png" title="link.png" src="/help/img/teamcity/2019.1/link.png" id="6c24e05e" width="16" height="16" class="inline-icon-16"> icon in the build history list;</p></li><li class="list__item" id="62e39351"><p>builds of build configurations that were deleted less than one day ago.</p></li></ul><a name="Clean-upforDependentBuilds"></a><a name="Clean-up-for-Dependent-Builds"></a><div class="chapter"><h3 id="Clean-Up-Clean-upforDependentBuilds">Clean-up for Dependent Builds</h3><p id="b46aa271">The settings in the <b id="6974b861">Dependencies</b> section of the <b id="e798c2a6">Edit Clean Up Rules</b> dialog affect clean-up of artifacts in builds that the builds of the current build configuration depend on.</p><p id="66a56113">TeamCity always preserves builds which are used as <a href="dependent-build.html#Snapshot-Dependency">snapshot dependencies</a> in other builds. These builds are not deleted from builds history by the clean-up procedure until dependent builds are deleted. Artifacts of these builds can be deleted based on the option below.TeamCity can optionally preserve builds and their artifacts which are used in other builds by <a href="dependent-build.html#Artifact-Dependency">artifact dependencies</a>.</p><ul class="list _ul"><li class="list__item" id="ce17aa30"><p><b id="af39ec2b">Use default</b> choice uses the option configured in the default cleanup rule.</p></li><li class="list__item" id="56f87039"><p><b id="aaa5d74f">Prevent clean-up</b> choice protects builds (and their artifacts) which were used as a source of artifact or snapshot dependencies for the builds of the current build configuration.</p></li><li class="list__item" id="cbf0317d"><p><b id="5f76f699">Do not prevent clean-up</b> (default) choice makes cleanup-related processing of the dependency builds disregard the fact that they are used by the builds of the current build configuration.</p></li></ul><p id="a4dfd33e">Example:</p><p id="3d5aec9f">Say, a dependent build configuration A has an artifact dependency on B. If the <b id="130bcd80">Prevent clean-up</b> option is used for A, the builds of B that provide artifacts for the builds of A will not be processed while cleaning the builds, so the builds and their artifacts will be preserved.</p><p id="13b3577e">There is a <a href="https://youtrack.jetbrains.com/issue/TW-59344" data-external="true" target="_blank" rel="noopener noreferrer">known issue</a>: when a build is used via an artifact dependency by a build that has any snapshot dependency, then, even if the build configuration of the dependent build has the <b id="28fae954">Do not prevent clean-up</b> option set, the original artifact dependency build and its artifacts will not be cleaned, as if the <b id="2cc2f44d">Prevent clean-up</b> option is set in the dependent build configuration.</p></div><a name="Clean-upinBuildConfigurationswithFeatureBranches"></a><a name="Clean-up-in-Build-Configurations-with-Feature-Branches"></a><div class="chapter"><h3 id="Clean-Up-Clean-upinBuildConfigurationswithFeatureBranches">Clean-up in Build Configurations with Feature Branches</h3><p id="40dc2920">If a build configuration has builds from several <a href="working-with-feature-branches.html">branches</a>, before applying clean-up rules, TeamCity splits the build history of this configuration into several groups. TeamCity creates one group per each <a href="working-with-feature-branches.html#Active-branches">active branch</a>, and a single group for all builds from inactive branches. Then clean-up rules are applied to each group independently.</p></div><a name="Clean-upofPersonalBuilds"></a><a name="Clean-up-of-Personal-Builds"></a><div class="chapter"><h3 id="Clean-Up-Clean-upofPersonalBuilds">Clean-up of Personal Builds</h3><p id="edc6141a">clean-up rules are applied separately for the non-personal builds and then for the personal builds. That is, if you have a rule to preserve 3 successful builds, 3 non-personal builds and 3 personal builds are preserved (in each branch group as per description above).</p></div><a name="DeletedBuildConfigurationsCleanup"></a><a name="Deleted-Build-Configurations-Cleanup"></a><div class="chapter"><h3 id="Clean-Up-DeletedBuildConfigurationsCleanup">Deleted Build Configurations Cleanup</h3><p id="4a47f9f3">When a project or a build configuration is deleted, the corresponding builds data is removed during the cleanup, but only if 5 days (432, 000 seconds) have passed since the deletion. To change the timeout, set the <code class="code">teamcity.deletedBuildTypes.cleanupTimeout</code> <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">internal property</a> to the required number of seconds to protect the data from deletion.</p><hr id="b11895d5"><p id="bd9cd2f6"><b id="62c3d504">See also:</b></p><p id="3e373725"><b id="699a04f7">Concepts</b>: <a href="dependent-build.html">Dependent Build</a></p><hr id="8c69c68a"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>