<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Upgrading DSL - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Upgrading DSL" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/storing-project-settings-in-version-control.md|Storing Project Settings in Version Control/kotlin-dsl.md|Kotlin DSL/upgrading-dsl.md|Upgrading DSL" data-main-title="Upgrading DSL" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/upgrading-dsl.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Upgrading DSL" id="upgrading-dsl.md">Upgrading DSL</h1><p id="2ba077a6">On this page:</p><p id="e3e9ea81"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#UpgradingDSL-TeamCitysettingsformatchanges">TeamCity settings format changes</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Changeswhichcanbeperformedautomatically">Changes which can be performed automatically</a></li><li class="list__item"><a href="#UpgradingDSL-Changeswhichcannotbeperformedautomatically">Changes which cannot be performed automatically</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-VersionsinDSLcode">Versions in DSL code</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-KotlinDSLAPIversion">Kotlin DSL API version</a></li><li class="list__item"><a href="#UpgradingDSL-Configsversion">Configs version</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-DSLupgradeprocedure">DSL upgrade procedure</a></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2018.2.xto2019.1.x">Update DSL from 2018.2.x to 2019.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingMavenbuildsteps">Updating Maven build steps</a></li><li class="list__item"><a href="#UpgradingDSL-AddversiontoMSBuildandVS.Solutionbuildsteps">Add version to MSBuild and VS.Solution build steps</a></li><li class="list__item"><a href="#UpgradingDSL-BuildconfigurationparameterbuildDefaultBranchisdeprecated">Build configuration parameter buildDefaultBranch is deprecated</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2018.1.xto2018.2.x">Update DSL from 2018.1.x to 2018.2.x</a></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2017.2.xto2018.1.x">Update DSL from 2017.2.x to 2018.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingDockerparameters">Updating Docker parameters</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Dockerpushcommandsupport">Docker push command support</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher">Adding label property to Gerrit publisher settings in Commit Status Publisher</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2017.1.xto2017.2.x">Update DSL from 2017.1.x to 2017.2.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-DSLversion">DSL version</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingDockerparameters2">Updating Docker parameters</a></li><li class="list__item"><a href="#UpgradingDSL-Updatingdefaultprojecttemplate">Updating default project template</a></li><li class="list__item"><a href="#UpgradingDSL-Updating.NETCLIparameters">Updating .NET CLI parameters</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Commonparameters">Common parameters</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetbuild">dotnet build</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetclean">dotnet clean</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetmsbuild">dotnet msbuild</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetnugetdelete">dotnet nuget delete</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetnugetpush">dotnet nuget push</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetpack">dotnet pack</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetpublish">dotnet publish</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetrestore">dotnet restore</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetrun">dotnet run</a></li><li class="list__item"><a href="#UpgradingDSL-dotnettest">dotnet test</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetvstest">dotnet vstest</a></li></ul></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom10.0.xto2017.1.x">Update DSL from 10.0.x to 2017.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-ChangesrequiringmanualKotlinDSLscriptsupdate">Changes requiring manual Kotlin DSL scripts update</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Convertingcloudprofiles">Converting cloud profiles</a></li><li class="list__item"><a href="#UpgradingDSL-Namesinentities">Names in entities</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdatingKotlinDSLconfigsversionto10.0to2017.1">Updating Kotlin DSL configs version to 10.0 to 2017.1</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingDotCoverparameters">Updating DotCover parameters</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingMavenbuildstepparameters">Updating Maven build step parameters</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingPowerShellbuildstepparameters">Updating PowerShell build step parameters</a></li></ul></li></ul></li></ul></p><p id="53df61a0">The TeamCity XML settings format is usually <a href="storing-project-settings-in-version-control.html#Enabling-Versioned-Settings-after-TeamCity-Upgrade">changed</a> in the major releases. During the first start after the server update, TeamCity converts XML settings files in the TeamCity Data Directory to the new format.<br>When settings are stored in Kotlin DSL, the Kotlin code might need to be changed to be still functional. It is also recommended to update the Kotlin code to the latest config version with each version.<br>These recommendations are displayed as server health reports on the corresponding pages of the server administration UI.</p><a name="TeamCitysettingsformatchanges"></a><a name="TeamCity-settings-format-changes"></a><div class="chapter"><h2 id="UpgradingDSL-TeamCitysettingsformatchanges">TeamCity settings format changes</h2><p id="35b2e632">As far as the DSL is concerned, there are the following types of TeamCity settings changes.</p><a name="Changeswhichcanbeperformedautomatically"></a><a name="Changes-which-can-be-performed-automatically"></a><div class="chapter"><h3 id="UpgradingDSL-Changeswhichcanbeperformedautomatically">Changes which can be performed automatically</h3><p id="fb54a0a1">These types of settings changes do not require changing the Kotlin DSL as the changes are applied by the server automatically on each settings regeneration from the DSL. It is recommended though to update the DSL to a newer configs version to reduce performance hit and make Kotlin scripts closer to the settings you see in the UI.<br>A lot of changes in TeamCity settings fall into this category. For example, some plugin implementing a build step may rename its parameters. The DSL from the previous TeamCity version generates a parameter with the old name, but TeamCity can automatically replace the old parameter name with the new one after DSL execution.</p></div><a name="Changeswhichcannotbeperformedautomatically"></a><a name="Changes-which-cannot-be-performed-automatically"></a><div class="chapter"><h3 id="UpgradingDSL-Changeswhichcannotbeperformedautomatically">Changes which cannot be performed automatically</h3><p id="387f8842">Some TeamCity settings changes require external information and cannot be performed automatically. For example, in TeamCity 10.0 the settings of the cloud integration were stored in a dedicated file which was not committed to a VCS. In TeamCity 2017.1 these settings were moved to the project level. TeamCity cannot perform such a transformation of settings automatically without external data,so manual DSL code update is required.</p></div></div><a name="VersionsinDSLcode"></a><a name="Versions-in-DSL-code"></a><div class="chapter"><h2 id="UpgradingDSL-VersionsinDSLcode">Versions in DSL code</h2><a name="KotlinDSLAPIversion"></a><a name="Kotlin-DSL-API-version"></a><div class="chapter"><h3 id="UpgradingDSL-KotlinDSLAPIversion">Kotlin DSL API version</h3><p id="2d20fc31">This is the version included in the Kotlin DSL API package name: <code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code>. New backward-incompatible API will be provided in a new package and the API from older versions will continue to work.</p></div><a name="Configsversion"></a><a name="Configs-version"></a><div class="chapter"><h3 id="UpgradingDSL-Configsversion">Configs version</h3><p id="be1dc0b8">This is the version specified in <code class="code">settings.kts</code>, it looks like this:</p><div class="code-block" data-lang="none">
version = "2019.1"
project(Some_Project)

</div><p id="ddb4ef95">TeamCity uses this version to perform transformations DSL execution to make settings up-to-date.<br>For instance, your DSL scripts could be generated by TeamCity 2017.2 and have the version set to "2017.2". When you upgrade your server to version 2019.1, TeamCity will execute your DSL and apply additional transformations to modify the settings according to the format expected by version 2019.1.</p></div></div><a name="DSLupgradeprocedure"></a><a name="DSL-upgrade-procedure"></a><div class="chapter"><h2 id="UpgradingDSL-DSLupgradeprocedure">DSL upgrade procedure</h2><p id="61791314">After a TeamCity upgrade, the versioned settings are disabled globally on the whole TeamCity server, and a corresponding health report is shown in the administration UI. This is done to prevent TeamCity from changing the settings in the version control if you upgrade a non-production copy of the TeamCity server.</p><p id="7a2931a5">If the server is a production installation, enable versioned settings using the action in the health report. This will make TeamCity commit converted XML file to the VCS. For settings in Kotlin format the files inside plugin-settings directory and meta-runners will be committed.</p><p id="b5670b85">At this point, the version control has the previous version of Kotlin DSL scripts.</p><p id="4d509aa8">If some of the settings conversions cannot be applied automatically, TeamCity will disable the versioned settings for the affected projects and a corresponding health report is shown. You should update the DSL as per the notes below and then the versioned settings can be enabled in the project.</p><p id="9afd5580">For the projects with settings in Kotlin DSL which were not affected by the settings conversions or if the settings can be converted automatically, the Kotlin DSL scripts do not require any immediate changes and you can continue using the projects as usual (versioned settings stay enabled in such projects). However, it is recommended to update the Kotlin scripts to the up-to-date configs version. TeamCity displays a health report for each affected project with instructions on how to update DSL. In order to check if DSL code update is required, load the settings from VCS and see the <b id="b7f32cae">Current status</b> on the <b id="93b6b532">Versioned settings</b> tab: it will show a warning if update is required.</p><p id="6fa98178"><a name="dsl20191"></a><a name="UpgradingDSL-dsl20191"></a></p></div><a name="UpdateDSLfrom2018.2.xto2019.1.x"></a><a name="Update-DSL-from-2018.2.x-to-2019.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2018.2.xto2019.1.x">Update DSL from 2018.2.x to 2019.1.x</h2><p id="6986f765">This release introduces the new DSL API version, <b id="1c93aa05">v2019_1</b>, but its package is still <code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code> because there were no significant changes in the DSL between versions 2018.2.x and 2019.1.x.</p><a name="UpdatingMavenbuildsteps"></a><a name="Updating-Maven-build-steps"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingMavenbuildsteps">Updating Maven build steps</h3><p id="e5d980cb">The DSL producing Maven build steps should be updated. If a Maven build step did not have the <code class="code">useOwnLocalRepo</code> parameter set to <code class="code">true</code>,  the following <code class="code">localRepoScope</code> parameter should be added:</p><div class="code-block" data-lang="none">maven {
   ...
   localRepoScope = MavenBuildStep.RepositoryScope.MAVEN_DEFAULT
}

</div><p id="f186e938">If <code class="code">useOwnLocalRepo</code> was set to <code class="code">true</code>, then it should be replaced with:</p><div class="code-block" data-lang="none">maven {
   ...
   localRepoScope = MavenBuildStep.RepositoryScope.BUILD_CONFIGURATION
}

</div></div><a name="AddversiontoMSBuildandVS.Solutionbuildsteps"></a><a name="Add-version-to-MSBuild-and-VS.Solution-build-steps"></a><div class="chapter"><h3 id="UpgradingDSL-AddversiontoMSBuildandVS.Solutionbuildsteps">Add version to MSBuild and VS.Solution build steps</h3><p id="f02ffe2c">If MSBuild or VS.Solution build steps have the parameter <code class="code">toolsVersion</code> set to <code class="code">MSBuildStep.MSBuildToolsVersion.V15_0</code>, theadditional <code class="code">version = MSBuildStep.MSBuildVersion.V15_0</code> parameter should be added:</p><div class="code-block" data-lang="none">msBuild {
    ...
    toolsVersion = MSBuildStep.MSBuildToolsVersion.V15_0
    version = MSBuildStep.MSBuildVersion.V15_0
}

</div></div><a name="BuildconfigurationparameterbuildDefaultBranchisdeprecated"></a><a name="Build-configuration-parameter-buildDefaultBranch-is-deprecated"></a><div class="chapter"><h3 id="UpgradingDSL-BuildconfigurationparameterbuildDefaultBranchisdeprecated">Build configuration parameter buildDefaultBranch is deprecated</h3><p id="e6695d17">The build configuration version control settings parameter <code class="code">buildDefaultBranch</code> is deprecated: <code class="code">branchFilter</code> should be used instead.<br>For instance, if <code class="code">buildDefaultBranch</code> was set to <code class="code">false</code>, the following branch filter should be specified instead:</p><div class="code-block" data-lang="none">vcs {
   branchFilter = """
      +:*
      -:&lt;default&gt;
   """
}

</div><p id="8052cce4"><a name="dsl20182"></a><a name="UpgradingDSL-dsl20182"></a></p></div></div><a name="UpdateDSLfrom2018.1.xto2018.2.x"></a><a name="Update-DSL-from-2018.1.x-to-2018.2.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2018.1.xto2018.2.x">Update DSL from 2018.1.x to 2018.2.x</h2><p id="0e84606f">This release introduces the new DSL API version, <b id="191104d4">v2018_2</b>, its package is <code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code>.</p><p id="a2c10112"><a name="dsl20181"></a><a name="UpgradingDSL-dsl20181"></a></p></div><a name="UpdateDSLfrom2017.2.xto2018.1.x"></a><a name="Update-DSL-from-2017.2.x-to-2018.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2017.2.xto2018.1.x">Update DSL from 2017.2.x to 2018.1.x</h2><p id="4b036907">This release introduces the new DSL API version, v2018_1, its package is <b id="b55ebfdc">jetbrains.buildServer.configs.kotlin.v2018_1</b>. The previous API versions work and you can keep using them if you don't want to use portable DSL scripts.</p><p id="4a77c922"><a name="dslConverter850"></a><a name="UpgradingDSL-dslConverter850"></a></p><a name="UpdatingDockerparameters"></a><a name="Updating-Docker-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingDockerparameters">Updating Docker parameters</h3><p id="fe9029f2">If you used Kotlin DSL with TeamCity 2017.2 for Docker plugin configurations, you may need to perform some changes in your Kotlin configuration scripts to make your code compatible with TeamCity 2018.1.</p><p id="0d108a11">The essence of the changes:</p><ul class="list _ul"><li class="list__item" id="195ef912"><p>build step <b id="a659994e">dockerBuild</b> is now converted to <b id="3554b99c">dockerCommand</b></p></li><li class="list__item" id="5ec37eed"><p>the parameters for DockerBuild are now sub-parameter for commandType selector</p></li></ul><p id="f4199360">Note the difference:</p><p id="9b702f9f"><b id="d666ec43">Docker Build 2 Docker Command migration</b></p><div class="code-block" data-lang="none"># DockerBuild in 2017.2:
dockerBuild {
    name = "name of the build step"
    source = content {
        content = """
            FROM busybox
    
            MAINTAINER KIR &lt;kir@maxkir.com&gt;
        """.trimIndent()
    }
    namesAndTags = "maxkir/maxkir_test"
}
#----------------------------------------
# DockerBuild in 2018.1:
dockerCommand {
    name = "name of the build step"
    commandType = build {
        source = content {
            content = """
                FROM busybox
    
                MAINTAINER KIR &lt;kir@maxkir.com&gt;
            """.trimIndent()
        }
        namesAndTags = "maxkir/maxkir_test"
    }
}

</div><a name="Dockerpushcommandsupport"></a><a name="Docker-push-command-support"></a><div class="chapter"><h4 id="UpgradingDSL-Dockerpushcommandsupport">Docker push command support</h4><div class="code-block" data-lang="none">dockerCommand {
    name = "name of the push step"
    commandType = push {
        namesAndTags = "maxkir/maxkir_test"
    }
}

</div><p id="c8449fca"><a name="dslConverter839"></a><a name="UpgradingDSL-dslConverter839"></a></p></div></div><a name="AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher"></a><a name="Adding-label-property-to-Gerrit-publisher-settings-in-Commit-Status-Publisher"></a><div class="chapter"><h3 id="UpgradingDSL-AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher">Adding label property to Gerrit publisher settings in Commit Status Publisher</h3><p id="11a7c43d"><b id="f8effe4b">Since TeamCity 2018.1</b> Gerrit publisher settings in the <a href="commit-status-publisher.html">Commit Status Publisher</a> build feature allow customising the Gerrit label that reflects the build status, i.e. now you can use something other than Verified.</p><p id="249eab22">To manually modify Kotlin DSL settings, the <b id="13a49a82">label = "Verified"</b> statement must be added as follows:</p><div class="code-block" data-lang="none">features {
    ...
    commitStatusPublisher {
        publisher = gerrit {
            server = "&lt;server&gt;"
            gerritProject = "&lt;project&gt;"
            failureVote = "-1"
            successVote = "+1"
            userName = "&lt;user&gt;"
            uploadedKey = "&lt;key&gt;"
            label = "Verified"  // the statement to be added
        }
     }
    ...
}

</div><p id="cb147e0f"><a name="dsl20172"></a><a name="UpgradingDSL-dsl20172"></a></p></div></div><a name="UpdateDSLfrom2017.1.xto2017.2.x"></a><a name="Update-DSL-from-2017.1.x-to-2017.2.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2017.1.xto2017.2.x">Update DSL from 2017.1.x to 2017.2.x</h2><a name="DSLversion"></a><a name="DSL-version"></a><div class="chapter"><h3 id="UpgradingDSL-DSLversion">DSL version</h3><p id="a44bfaca">This release introduces the new DSL API version, <code class="code">v2017_2</code>. The previous API version works and you can keep using it if you do not need the <a href="https://confluence.jetbrains.com/display/TCD10/What's+New+in+TeamCity+2017.2" data-external="true" target="_blank" rel="noopener noreferrer">features provided by the new API</a>.</p><aside class="note " data-title="" rel="a44bfaca" id="268b11e6"><p id="c876f05f">To get sample DSL code for the newly supported features without switching a project to the Kotlin format, use the <b id="d3f7f3bd">Download settings in Kotlin format</b> action on the project administration page.</p></aside><p id="5c9ed731">If you used 2017.2 EAPs and tested changing DSL settings via the UI, you need to apply all the UI patches created by TeamCity before upgrading as some API is changed in an incompatible way.</p><p id="860c8307">The current package name for the settings generated by TeamCity is <code class="code">jetbrains.buildServer.configs.kotlin.v2017_2</code>.</p><p id="0bff7df2">With the new API, you can benefit from a number of <a href="https://confluence.jetbrains.com/display/TCD10/What%27s+New+in+TeamCity+2017.2#What'sNewinTeamCity2017.2-KotlinDSLImprovements" data-external="true" target="_blank" rel="noopener noreferrer">new features</a>, including the editable administration UI for Kotlin DSL projects and DSL documentation. To use them for your existing project, your <code class="code">.kt</code> files should be switched to packages from the <code class="code">v2017_2 version</code>.</p><ul class="list _ul"><li class="list__item" id="fe3e4431">To compile this project, you also need to update your pom.xml. The easiest way is to invoke the <b id="3ffd123f">Download settings in Kotlin format</b> action in your project and copy the <code class="code">pom.xml</code> from the generated zip archive. Alternatively you can update pom.xml yourself with the following:<ul class="list _ul"><li class="list__item" id="2f0bf632"><p>change <code class="code">teamcity.dsl.version</code> to: <code class="code">&lt;teamcity.dsl.version&gt;2017.2&lt;/teamcity.dsl.version&gt;</code></p></li><li class="list__item" id="432a035b"><p>change the kotlin version to: <code class="code">&lt;kotlin.version&gt;1.1.4-3&lt;/kotlin.version&gt;</code> and add a dependency on kotlin-runtime and kotlin-reflect:</p></li></ul></li></ul><div class="code-block" data-lang="none">&lt;dependency&gt;
  &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
  &lt;artifactId&gt;kotlin-runtime&lt;/artifactId&gt;
  &lt;version&gt;${kotlin.version}&lt;/version&gt;
  &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jetbrains.kotlin&lt;/groupId&gt;
  &lt;artifactId&gt;kotlin-reflect&lt;/artifactId&gt;
  &lt;version&gt;${kotlin.version}&lt;/version&gt;
  &lt;scope&gt;compile&lt;/scope&gt;
&lt;/dependency&gt;

</div><p id="42596ce4">Once you switch the project to new API and check in the changes, TeamCity will detect and apply them and after that web UI editing will be enabled.<br>To use the new DSL API in a repository with an existing <code class="code">pom.xml</code>, the maven dependency version has to be updated to <code class="code">2017.2</code>.</p></div><a name="UpdatingDockerparameters"></a><a name="Updating-Docker-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingDockerparameters2">Updating Docker parameters</h3><p id="0ccf2fa3">If you used Kotlin DSL with TeamCity 2017.1 for Docker plugin configurations, you may need to perform some changes in your kotlin configuration scripts to make your code compatible with TeamCity 2017.2. Basically, TeamCity provides a converter for Kotlin configuration scripts to perform those changes automatically, but if it does not work due to some reason, the following changes need to be made manually:</p><ul class="list _ul"><li class="list__item" id="87bc9240"><p>rename the build runner step with the <b id="1fef94aa">Docker Build</b> runType to <b id="58646534">DockerBuild</b></p></li><li class="list__item" id="56cdc07d"><p>rename the build runner step with the <b id="58e230ab">Docker Compose</b> runType to <b id="b701c117">DockerCompose</b></p></li><li class="list__item" id="47d16127"><p>rename the <code class="code">docker-compose.file</code> build parameter to <code class="code">dockerCompose.file</code></p></li></ul><p id="795acbd2">Starting from TeamCity 2017.2, the Docker plugin has its own typed DSL for the <a href="docker-support.html">Docker build feature</a>, <a href="docker-wrapper.html">Docker Wrapper</a>, <a href="docker.html">Docker</a>, and <a href="docker-compose.html">Docker Compose</a> runners.</p><p id="c7f951f3"><b id="e5401a4b">Docker Compose and Docker Build</b></p><div class="code-block" data-lang="none">steps {
    dockerCompose {
        name = "Start services"
        file = "db-tests/scripts/docker-compose.yml"
    }
 
    dockerBuild {
        name = "Docker build step"
        source = path {
            path = "some/context/Dockerfile"
        }
 
        // Case for Dockerfile specified by an URL:
        //source = url {
        //    url = "https://raw.githubusercontent.com/JetBrains/teamcity-docker-minimal-agent/master/ubuntu/Dockerfile"
        //}
 
        // Case for Dockerfile specified by text:
        //source = content {
        //    content = """
        //        FROM busybox
        //        MAINTAINER Kirill Maximov &lt;kir@jetbrains.com&gt;
        //    """.trimIndent()
        //}
 
        contextDir = "some/context"
        namesAndTags = "my:tag"
    }
}

</div><p id="4052d951"><b id="7d263e0a">Docker Build Feature</b></p><div class="code-block" data-lang="none">features {
    dockerSupport {
        cleanupPushedImages = true
        loginToRegistry = on {
            dockerRegistryId = "PROJECT_EXT_2"
        }
    }
}

</div><p id="892f7b16"><b id="ec826ee4">Command Line runner with Docker Wrapper</b></p><div class="code-block" data-lang="none">script {
    scriptContent = "ls -lR"
    dockerImage = "openjdk:8u121"
    dockerPull = true
    dockerRunParameters = "--rm -v /some/path:/another/path:ro"
}

</div></div><a name="Updatingdefaultprojecttemplate"></a><a name="Updating-default-project-template"></a><div class="chapter"><h3 id="UpgradingDSL-Updatingdefaultprojecttemplate">Updating default project template</h3><p id="32c04d5c">Since 2017.2 EAP3, TeamCity supports default templates in projects. This setting was stored in a project feature of the "DefaultTemplate" type in EAP3 and EAP4, but since 2017.2 RC the project configuration schema was changed to accommodate for default templates.<br>To manually convert a DSL project configuration that employs the default template, you will have to delete a corresponding project feature and replace it with the defaultTemplate property assignment as follows:</p><p id="79385b97">2017.2 EAP3/4 DSL project configuration with a default template configured:</p><div class="code-block" data-lang="none">object Project : Project({
    uuid = "2b241ffb-9019-4e60-9a3a-d5475ab1f312"
    extId = "ExampleProject"
    parentId = "_Root"
    name = "Example Project"
    ...
    features {
        ...
        feature {
            id = "PROJECT_EXT_4"
            type = "DefaultTemplate"
            param("template", "ExampleProject_MyDefaultTemplate")
        }
        ...
    }
    ...
})

</div><p id="7e5cba9d">2017.2 DSL project configuration with the default template configured:</p><div class="code-block" data-lang="none">object Project : Project({
    uuid = "2b241ffb-9019-4e60-9a3a-d5475ab1f312"
    extId = "ExampleProject"
    parentId = "_Root"
    name = "Example Project"
    defaultTemplate = "ExampleProject_MyDefaultTemplate"
    ...
    features {
        ...
    }
    ...
})

</div></div><a name="Updating.NETCLIparameters"></a><a name="Updating-.NET-CLI-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-Updating.NETCLIparameters">Updating .NET CLI parameters</h3><p id="4c5ce999"><b id="161101b6">Since 2017.2</b> TeamCity bundles .NET CLI plugin. If you were using Kotlin DSL for the plugin parameters in TeamCity 2017.1.x, you need to change the commands as follows. In TeamCity 2017.1.x:</p><div class="code-block" data-lang="none">steps {
    step {
        type = "dotnet"
        param("dotnet-command", "build")
        param("dotnet-paths", "WindowsAzure.sln")
    }
}

</div><p id="3ec50c0d">Since TeamCity 2017.2 you could explicitly specify build steps with parameters:</p><div class="code-block" data-lang="none">steps {
    dotnetBuild {
        projects = "WindowsAzure.sln"
    }
}

</div><a name="Commonparameters"></a><a name="Common-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-Commonparameters">Common parameters</h4><div class="table-wrapper"><table class=" wide" width="100%" id="570828ed"><thead><tr id="f4515731" class="ijRowHead"><th id="30545fe1"><p id="ab32d301">2017.1</p></th><th id="323e74a9"><p id="fe3f8bcf">2017.2</p></th><th id="544f27f4"><p id="c3c3eb15">Comment</p></th></tr></thead><tbody><tr id="2a968373" class="ijRowOdd"><td id="9525e157"><p id="53653d5e">dotnet-command</p></td><td id="5224b3f1"><p id="2ac0d174">dotnet&lt;Command&gt;</p></td><td id="f83f98cd"><p id="15cbaadc">Now the command name reflects the build step name, e.g. <code class="code">dotnetRestore</code></p></td></tr><tr id="759c1159" class="ijRowEven"><td id="d1161274"><p id="bbad74f3">dotnet-args</p></td><td id="866f085e"><p id="a9a20bfa">args</p></td><td id="d4ae3a66"></td></tr><tr id="24ce2894" class="ijRowOdd"><td id="b1189c49"><p id="15039c8e">dotnet-verbosity</p></td><td id="a145e464"><p id="95385c51">logging</p></td><td id="ade68813"></td></tr></tbody></table></div></div><a name="dotnetbuild"></a><a name="dotnet-build"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetbuild">dotnet build</h4><div class="table-wrapper"><table class=" wide" width="100%" id="12f064f9"><thead><tr id="b7e35c94" class="ijRowHead"><th id="5a13adc2"><p id="063e1497">2017.1</p></th><th id="cc798148"><p id="86e74093">2017.2</p></th><th id="b95196f9"><p id="579680cc">Comment</p></th></tr></thead><tbody><tr id="31a97385" class="ijRowOdd"><td id="901b584e"><p id="83c39d9b">dotnet-paths</p></td><td id="084df014"><p id="558754a3">projects</p></td><td id="df624524"></td></tr><tr id="9dd08958" class="ijRowEven"><td id="2588af58"><p id="c60a72f2">dotnet-build-config</p></td><td id="c45049da"><p id="eef9a4bc">configuration</p></td><td id="afc1aacc"></td></tr><tr id="b4a696f2" class="ijRowOdd"><td id="fea669d2"><p id="92b45c30">dotnet-build-framework</p></td><td id="566a8754"><p id="e877dd8c">framework</p></td><td id="05f2ee0d"></td></tr><tr id="79b6bf5c" class="ijRowEven"><td id="2f67ffd6"><p id="23f86de2">dotnet-build-output</p></td><td id="b0777c48"><p id="d362b9db">outputDir</p></td><td id="eac5797b"></td></tr><tr id="0d7c9c03" class="ijRowOdd"><td id="107d4014"><p id="9a8195c7">dotnet-build-runtime</p></td><td id="5a4af87b"><p id="cabbd47c">runtime</p></td><td id="f0be436e"></td></tr><tr id="3a5a3f81" class="ijRowEven"><td id="258a439a"><p id="b6108663">dotnet-build-no-deps</p></td><td id="16b0f29f"><p id="bde7a3d2">-</p></td><td id="4859170a"><p id="172eadb6">Should be added as the <code class="code">--no-dependencies</code> argument</p></td></tr><tr id="3a5d05b5" class="ijRowOdd"><td id="9fcdb832"><p id="691af934">dotnet-build-not-incremental</p></td><td id="00ca4eaa"><p id="057ee47d">-</p></td><td id="6917ec9a"><p id="2aa75b6d">Should be added as the <code class="code">--no-incremental</code> argument</p></td></tr></tbody></table></div></div><a name="dotnetclean"></a><a name="dotnet-clean"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetclean">dotnet clean</h4><div class="table-wrapper"><table width="100%" id="31f98a71"><thead><tr id="bc57502f" class="ijRowHead"><th id="d2ef9916"><p id="1618dd87">2017.1</p></th><th id="89eda6c4"><p id="5573c35c">2017.2</p></th></tr></thead><tbody><tr id="5553747e" class="ijRowOdd"><td id="d6b5c90e"><p id="bd1ff479">dotnet-paths</p></td><td id="c29015ae"><p id="f4f7e1c0">projects</p></td></tr><tr id="4dad90fa" class="ijRowEven"><td id="c92c039f"><p id="c71659a9">dotnet-clean-config</p></td><td id="ba82e336"><p id="2b3e13b1">configuration</p></td></tr><tr id="1ba9f4d8" class="ijRowOdd"><td id="ea1e7d7e"><p id="3105f9e3">dotnet-clean-framework</p></td><td id="fc549f75"><p id="c36f5c77">framework</p></td></tr><tr id="19415a66" class="ijRowEven"><td id="8efe07d3"><p id="f771a084">dotnet-clean-output</p></td><td id="63286100"><p id="882c563d">outputDir</p></td></tr><tr id="003ca1c0" class="ijRowOdd"><td id="e36c3f9a"><p id="01c09950">dotnet-clean-runtime</p></td><td id="95554bb7"><p id="fd81cad1">runtime</p></td></tr></tbody></table></div></div><a name="dotnetmsbuild"></a><a name="dotnet-msbuild"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetmsbuild">dotnet msbuild</h4><div class="table-wrapper"><table width="100%" id="79484712"><thead><tr id="a2d646d2" class="ijRowHead"><th id="850b58e3"><p id="7f180428">2017.1</p></th><th id="50100206"><p id="501f6aaf">2017.2</p></th></tr></thead><tbody><tr id="742a23f7" class="ijRowOdd"><td id="35ccc504"><p id="339bcf76">dotnet-paths</p></td><td id="ec713cea"><p id="ecc214e6">projects</p></td></tr><tr id="490d9cb0" class="ijRowEven"><td id="ced61a9c"><p id="4bdd3c56">dotnet-msbuild-config</p></td><td id="152c42a6"><p id="cb7d69b5">configuration</p></td></tr><tr id="df300b6b" class="ijRowOdd"><td id="1869c6c6"><p id="6d71d000">dotnet-msbuild-platform</p></td><td id="12c36eaf"><p id="bc1b48a9">platform</p></td></tr><tr id="2ba3cf95" class="ijRowEven"><td id="bd775faf"><p id="f4d3728d">dotnet-msbuild-targets</p></td><td id="59f6dddf"><p id="1faf7f97">targets</p></td></tr><tr id="4451f540" class="ijRowOdd"><td id="02b3f38a"><p id="556fae5c">dotnet-msbuild-runtime</p></td><td id="ce3dcecc"><p id="bb4d60e7">runtime</p></td></tr></tbody></table></div></div><a name="dotnetnugetdelete"></a><a name="dotnet-nuget-delete"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetnugetdelete">dotnet nuget delete</h4><div class="table-wrapper"><table width="100%" id="19d8652d"><thead><tr id="b8dfec8b" class="ijRowHead"><th id="1361a166"><p id="42c06954">2017.1</p></th><th id="f11abe91"><p id="f1b6bb30">2017.2</p></th></tr></thead><tbody><tr id="7c5ec2cc" class="ijRowOdd"><td id="b397cca5"><p id="d4882fd4">dotnet-nuget-delete-id</p></td><td id="4437203f"><p id="a2d96178">packageId</p></td></tr><tr id="f70a7a1f" class="ijRowEven"><td id="a920c0fd"><p id="c8d2f12e">dotnet-nuget-push-source /</p><p id="bba0486b">dotnet-nuget-delete-source</p></td><td id="ea957e9f"><p id="8a88a50f">packageSource</p></td></tr><tr id="ff101985" class="ijRowOdd"><td id="87b7f964"><p id="7852eeb5">secure:dotnet-nuget-delete-api-key</p></td><td id="e846966b"><p id="a6a0865e">apiKey</p></td></tr></tbody></table></div></div><a name="dotnetnugetpush"></a><a name="dotnet-nuget-push"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetnugetpush">dotnet nuget push</h4><div class="table-wrapper"><table class=" wide" width="100%" id="54e72640"><thead><tr id="cbfb4294" class="ijRowHead"><th id="272b3c4b"><p id="ead068be">2017.1</p></th><th id="e73c48d9"><p id="b00d74bb">2017.2</p></th><th id="d78cb524"><p id="b35f691d">Comment</p></th></tr></thead><tbody><tr id="0b5d9853" class="ijRowOdd"><td id="c70e3ab2"><p id="d756429f">dotnet-paths</p></td><td id="72912ce6"><p id="9c870645">packages</p></td><td id="f2bf314f"></td></tr><tr id="55b766b2" class="ijRowEven"><td id="bcb4356f"><p id="d7abd3af">dotnet-nuget-push-source</p></td><td id="857dca56"><p id="ecf127ab">packageSource</p></td><td id="b9fe4d00"></td></tr><tr id="ee41438c" class="ijRowOdd"><td id="fbcc6e10"><p id="becbd708">dotnet-nuget-push-no-symbols</p></td><td id="c411f9b7"><p id="5576dd1f">noSymbols</p></td><td id="b9dd9827"></td></tr><tr id="0ef495cb" class="ijRowEven"><td id="499a6a04"><p id="5c5fb813">secure:dotnet-nuget-push-api-key</p></td><td id="b54cbe63"><p id="16c05b92">outputDir</p></td><td id="eb15e782"></td></tr><tr id="7b00ab81" class="ijRowOdd"><td id="4efd21e6"><p id="91a864bb">dotnet-build-runtime</p></td><td id="08fc1a80"><p id="a6647de2">apiKey</p></td><td id="19e76426"></td></tr><tr id="f98c98df" class="ijRowEven"><td id="dafe047e"><p id="11c68ea6">dotnet-nuget-push-no-buffer</p></td><td id="387c4a3e"><p id="be8fb065">-</p></td><td id="13ad4e83"><p id="0c35bda7">Should be added as the <code class="code">--disable-buffering true</code> argument</p></td></tr></tbody></table></div></div><a name="dotnetpack"></a><a name="dotnet-pack"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetpack">dotnet pack</h4><div class="table-wrapper"><table class=" wide" width="100%" id="2bac988e"><thead><tr id="66b54fd9" class="ijRowHead"><th id="df003a22"><p id="a5c90c2e">2017.1</p></th><th id="e2799011"><p id="322ff306">2017.2</p></th><th id="3e41261c"><p id="ad05a628">Comment</p></th></tr></thead><tbody><tr id="5cb62701" class="ijRowOdd"><td id="68ea1df6"><p id="1a3a5e0c">dotnet-paths</p></td><td id="1cc4170a"><p id="8e617d7c">projects</p></td><td id="1bb22884"></td></tr><tr id="a610f122" class="ijRowEven"><td id="eefbceb9"><p id="7bb76308">dotnet-pack-config</p></td><td id="27d683f1"><p id="1b568aea">configuration</p></td><td id="b5cbf046"></td></tr><tr id="b56cbe58" class="ijRowOdd"><td id="99b6e195"><p id="d0a09f60">dotnet-pack-runtime</p></td><td id="9cc1ce94"><p id="69cd761a">runtime</p></td><td id="b65609c6"></td></tr><tr id="1e53f52a" class="ijRowEven"><td id="ca1bef2b"><p id="d37cdf95">dotnet-pack-no-build</p></td><td id="8cc58b66"><p id="398efe5b">skipBuild</p></td><td id="c0a4ba07"></td></tr><tr id="9c58622d" class="ijRowOdd"><td id="1631ec67"><p id="4b4e2a0e">dotnet-pack-output</p></td><td id="210698ec"><p id="c4a1c121">outputDir</p></td><td id="a359f741"></td></tr><tr id="c650553b" class="ijRowEven"><td id="f5e5cfd7"><p id="2143e60a">dotnet-pack-version-suffix</p></td><td id="3a3c7c6d"><p id="d88b8b68">versionSuffix</p></td><td id="579439e3"></td></tr><tr id="996f7d9b" class="ijRowOdd"><td id="b0886c99"><p id="da4d2810">dotnet-pack-serviceable</p></td><td id="cb9c69cb"><p id="a09db002">-</p></td><td id="91c15991"><p id="447caace">Should be added as the <code class="code">--serviceable</code> argument</p></td></tr></tbody></table></div></div><a name="dotnetpublish"></a><a name="dotnet-publish"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetpublish">dotnet publish</h4><div class="table-wrapper"><table width="100%" id="c8e618e3"><thead><tr id="294ba48b" class="ijRowHead"><th id="e99f5229"><p id="78282897">2017.1</p></th><th id="2c01273d"><p id="f2d5b346">2017.2</p></th></tr></thead><tbody><tr id="a466b371" class="ijRowOdd"><td id="ded35069"><p id="3d0a59dd">dotnet-paths</p></td><td id="e6a2aa85"><p id="c8892781">projects</p></td></tr><tr id="78d5c39f" class="ijRowEven"><td id="950beaf6"><p id="23989561">dotnet-publish-config</p></td><td id="b7a15a8b"><p id="a247ea45">configuration</p></td></tr><tr id="c284d1f0" class="ijRowOdd"><td id="46267684"><p id="8e6f2dd0">dotnet-publish-framework</p></td><td id="9f3961f5"><p id="1631d7c7">framework</p></td></tr><tr id="609105d4" class="ijRowEven"><td id="8ac1fcbd"><p id="dc29571c">dotnet-publish-output</p></td><td id="b1a849da"><p id="f4c1cf0c">outputDir</p></td></tr><tr id="dadbbc0f" class="ijRowOdd"><td id="589c3b68"><p id="ea3b569e">dotnet-publish-runtime</p></td><td id="2f6cd6fd"><p id="a4e868d2">runtime</p></td></tr><tr id="ba4d1b5e" class="ijRowEven"><td id="67cc40a3"><p id="062188e2">dotnet-publish-version-suffix</p></td><td id="a3042e4e"><p id="a0ffe738">versionSuffix</p></td></tr></tbody></table></div></div><a name="dotnetrestore"></a><a name="dotnet-restore"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetrestore">dotnet restore</h4><div class="table-wrapper"><table class=" wide" width="100%" id="761a7f86"><thead><tr id="332f2ba7" class="ijRowHead"><th id="e323def1"><p id="83f2a297">2017.1</p></th><th id="5f7ac30a"><p id="f06af309">2017.2</p></th><th id="8b2b872c"><p id="1d056a04">Comment</p></th></tr></thead><tbody><tr id="1563d681" class="ijRowOdd"><td id="7e20f9bc"><p id="1b7d829f">dotnet-paths</p></td><td id="aee7f4d9"><p id="5aa6d7d1">projects</p></td><td id="cae2d91a"></td></tr><tr id="cb1ecc62" class="ijRowEven"><td id="caa10a03"><p id="a99f83b1">dotnet-restore-config</p></td><td id="df8e1e57"><p id="02457f2d">configFile</p></td><td id="288e7217"></td></tr><tr id="f2015a8d" class="ijRowOdd"><td id="6775920e"><p id="dbdf8ae3">dotnet-restore-runtime</p></td><td id="afc66fc0"><p id="ee4a1a49">runtime</p></td><td id="aaead247"></td></tr><tr id="d0f764be" class="ijRowEven"><td id="c4a863f1"><p id="e39f4641">dotnet-restore-packages</p></td><td id="dfa0d17f"><p id="f9213e8f">packagesDir</p></td><td id="a620f226"></td></tr><tr id="c2c6fa11" class="ijRowOdd"><td id="e97856ad"><p id="b5451fee">dotnet-restore-source</p></td><td id="46d4168b"><p id="33439a89">packageSources</p></td><td id="b7848b9b"></td></tr><tr id="c40be500" class="ijRowEven"><td id="eddcf7a8"><p id="81af2a3f">dotnet-restore-ignore-failed</p></td><td id="0a9f6b29"><p id="5f2c3016">-</p></td><td id="aa8a4adc"><p id="1a399606">Should be added as the <code class="code">--ignore-failed-sources</code> argument</p></td></tr><tr id="7fe1e1ec" class="ijRowOdd"><td id="031d8f37"><p id="b99d419d">dotnet-restore-no-cache</p></td><td id="698c7f3e"><p id="f867e847">-</p></td><td id="91a2e611"><p id="4391c45c">Should be added as the <code class="code">--no-cache</code> argument</p></td></tr><tr id="4fb37d3d" class="ijRowEven"><td id="bcd968a2"><p id="714c66c8">dotnet-restore-parallel</p></td><td id="1b6b54d4"><p id="a4f54a4b">-</p></td><td id="97087be8"><p id="f1e09af2">Should be added as the <code class="code">--disable-parallel</code> argument</p></td></tr><tr id="f3cd92cd" class="ijRowOdd"><td id="4ad725a2"><p id="de8dce0c">dotnet-restore-root-project</p></td><td id="e65b6f99"><p id="5fee06a1">-</p></td><td id="f01fe04d"><p id="03ac2ce9">Should be added as the <code class="code">--no-dependencies</code> argument</p></td></tr></tbody></table></div></div><a name="dotnetrun"></a><a name="dotnet-run"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetrun">dotnet run</h4><div class="table-wrapper"><table width="100%" id="363fbc3b"><thead><tr id="cf1d7ad0" class="ijRowHead"><th id="1820bb4a"><p id="747dcdfd">2017.1</p></th><th id="4e66ec28"><p id="82acd401">2017.2</p></th></tr></thead><tbody><tr id="4f01e96e" class="ijRowOdd"><td id="c42e1d5d"><p id="aa2d732c">dotnet-paths</p></td><td id="aa41bd21"><p id="2c9201c4">projects</p></td></tr><tr id="0ccc5311" class="ijRowEven"><td id="caae6b54"><p id="8e8457b5">dotnet-run-config</p></td><td id="e25014af"><p id="1091bef3">configuration</p></td></tr><tr id="daf753cf" class="ijRowOdd"><td id="b1fb4d44"><p id="5aad8d93">dotnet-run-framework</p></td><td id="2a2e577c"><p id="d638615d">framework</p></td></tr><tr id="3497bd24" class="ijRowEven"><td id="20067311"><p id="e941f366">dotnet-run-runtime</p></td><td id="acfc41eb"><p id="f6ae0ecb">runtime</p></td></tr></tbody></table></div></div><a name="dotnettest"></a><a name="dotnet-test"></a><div class="chapter"><h4 id="UpgradingDSL-dotnettest">dotnet test</h4><div class="table-wrapper"><table width="100%" id="025ef34a"><thead><tr id="1601e26f" class="ijRowHead"><th id="0010bc1b"><p id="53e14da4">2017.1</p></th><th id="0828550e"><p id="a27c81ad">2017.2</p></th></tr></thead><tbody><tr id="b946a075" class="ijRowOdd"><td id="ae2ca0b5"><p id="eb55fccb">dotnet-paths</p></td><td id="edf77e2e"><p id="61260c2d">projects</p></td></tr><tr id="3316f73f" class="ijRowEven"><td id="7743ab5d"><p id="38636c9c">dotnet-test-config</p></td><td id="035ae6a6"><p id="092a9bd3">configuration</p></td></tr><tr id="39699103" class="ijRowOdd"><td id="c0327c22"><p id="b97135c4">dotnet-test-framework</p></td><td id="87e93151"><p id="a07d0c98">framework</p></td></tr><tr id="1af45793" class="ijRowEven"><td id="780c37f1"><p id="9f8069c3">dotnet-test-no-build</p></td><td id="3110ea64"><p id="c9fe5cc7">skipBuild</p></td></tr><tr id="41fc4ae4" class="ijRowOdd"><td id="4723d90f"><p id="3d6e9de4">dotnet-test-output</p></td><td id="5fb416fc"><p id="7a4fcbf9">outputDir</p></td></tr><tr id="24f689ca" class="ijRowEven"><td id="d2183c8c"><p id="85e07f7e">dotnet-test-settings-file</p></td><td id="24771cd4"><p id="b1acfc8d">settingsFile</p></td></tr><tr id="7f6e4e9d" class="ijRowOdd"><td id="c1a36bd2"><p id="82e0fd5b">dotnet-test-runtime</p></td><td id="3fec4eb1"><p id="a67daa90">runtime</p></td></tr><tr id="cf048b9c" class="ijRowEven"><td id="b73baec5"><p id="0f7a646f">dotnet-test-test-case-filter</p></td><td id="20d91ddb"><p id="9f596018">filter</p></td></tr></tbody></table></div></div><a name="dotnetvstest"></a><a name="dotnet-vstest"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetvstest">dotnet vstest</h4><div class="table-wrapper"><table class=" wide" width="100%" id="57508119"><thead><tr id="1b6d81b0" class="ijRowHead"><th id="54717377"><p id="3f77c197">2017.1</p></th><th id="45cf9204"><p id="c7df9bba">2017.2</p></th><th id="5a189fd5"><p id="c63a6b3c">Comment</p></th></tr></thead><tbody><tr id="ceb259cf" class="ijRowOdd"><td id="eda74db3"><p id="9235e094">dotnet-paths</p></td><td id="35f07ec6"><p id="e5b325c2">assemblies</p></td><td id="ea185f7f"></td></tr><tr id="0b5575ee" class="ijRowEven"><td id="6f756c21"><p id="3b5190f9">dotnet-vstest-config-file</p></td><td id="413f7cae"><p id="45551bf1">settingsFile</p></td><td id="b08a27a5"></td></tr><tr id="bc860922" class="ijRowOdd"><td id="07792008"><p id="eff7666e">dotnet-vstest-framework</p></td><td id="698cee62"><p id="44f911b5">framework</p></td><td id="796a4868"></td></tr><tr id="a89145bb" class="ijRowEven"><td id="b5f1d291"><p id="88bfe78e">dotnet-vstest-platform</p></td><td id="ebd5f08e"><p id="69fd56c6">platform</p></td><td id="99e0d433"></td></tr><tr id="bbc60dc3" class="ijRowOdd"><td id="2cf699c0"><p id="1239f82c">dotnet-vstest-filter-type</p></td><td id="3a4e4f00"><p id="341342c7">filter</p></td><td id="7f35d552"><p id="b753ebb5">To filter tests by name, use <code class="code">name { names = "..." }</code>; for the test case filter, use <code class="code">filter { filter = "..." }</code></p></td></tr><tr id="bc3d6b3e" class="ijRowEven"><td id="e8d93bc4"><p id="f0ef8bc8">dotnet-vstest-is-isolation</p></td><td id="53692108"><p id="b14e5ec8">-</p></td><td id="373a6ddb"><p id="5222f409">Should be added as the <code class="code">/InIsolation</code> argument</p></td></tr></tbody></table></div><p id="c9845c75"><a name="dsl20171 "></a><a name="UpgradingDSL-dsl20171 "></a></p></div></div></div><a name="UpdateDSLfrom10.0.xto2017.1.x"></a><a name="Update-DSL-from-10.0.x-to-2017.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom10.0.xto2017.1.x">Update DSL from 10.0.x to 2017.1.x</h2><p id="45385660">TeamCity 2017.1 does not introduce a new Kotlin DSL API, the same package as in TeamCity 10.0.x is used (<code class="code">jetbrains.buildServer.configs.kotlin.v10</code>). Several new properties were added to the existing API; to get the latest API for the scripts development, update <code class="code">teamcity.dsl.version</code> in <code class="code">pom.xml</code> to the <code class="code">2017.1-SNAPSHOT</code> for EAP builds and to the <code class="code">2017.1</code> for release builds.</p><a name="ChangesrequiringmanualKotlinDSLscriptsupdate"></a><a name="Changes-requiring-manual-Kotlin-DSL-scripts-update"></a><div class="chapter"><h3 id="UpgradingDSL-ChangesrequiringmanualKotlinDSLscriptsupdate">Changes requiring manual Kotlin DSL scripts update</h3><p id="a46dff85">These changes should be performed before enabling versioned settings in the projects where they were disabled on TeamCity upgrade with the message: "Versioned settings are disabled in this project because its settings files were modified during TeamCity upgrade".</p><a name="Convertingcloudprofiles"></a><a name="Converting-cloud-profiles"></a><div class="chapter"><h4 id="UpgradingDSL-Convertingcloudprofiles">Converting cloud profiles</h4><p id="4ae0bee3">This is only relevant if you use Kotlin DSL for the Root project settings and have cloud profiles.<br>In 2017.1 cloud profiles were moved from the server level to the Root project level. Since they were not defined in the Kotlin DSL, in case you enable the versioned settings the existing cloud profiles will be deleted form he server. Thus before continuing to use Kotlin DSL for the root project on the server make sure to add the cloud profiles definitions to the root project settings in Kotlin DSL.</p><p id="16a3a3d4">To update your settings with the cloud profile information, perform the following:</p><ol class="list _decimal"><li class="list__item" id="89c4959a"><p>Run the <b id="1497b77d">'Download settings in Kotlin format</b>' action in the Root project and save the zip with the generated DSL</p></li><li class="list__item" id="74ee242a"><p>Copy project features of type <code class="code">CloudIntegration</code> and <code class="code">CloudProfile</code> from the <code class="code">.teamcity/_Root/Project.kt</code> file to the root project config in your settings</p></li><li class="list__item" id="49459b66"><p>Commit your changes to the VCS</p></li><li class="list__item" id="7b52a69d"><p>Enable versioned settings on the <b id="10cd20b3">Versioned Settings</b> tab of the Root project.</p></li></ol></div><a name="Namesinentities"></a><a name="Names-in-entities"></a><div class="chapter"><h4 id="UpgradingDSL-Namesinentities">Names in entities</h4><p id="f2339798">Due to the fix of <a href="https://youtrack.jetbrains.com/issue/TW-48609" data-external="true" target="_blank" rel="noopener noreferrer">issue TW-48609</a>, if your settings contain nameless entities, TeamCity will report corresponding VCS settings errors. You need to manually set a name parameter to such entities to resolve the errors.</p></div></div><a name="UpdatingKotlinDSLconfigsversionto10.0to2017.1"></a><a name="Updating-Kotlin-DSL-configs-version-to-10.0-to-2017.1"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingKotlinDSLconfigsversionto10.0to2017.1">Updating Kotlin DSL configs version to 10.0 to 2017.1</h3><p id="c096e8a5">The changes in this section should be done to Kotlin scripts on changing the <a href="#Configs-version">scripts config version</a> from 10.0 to 2017.1</p><p id="62a8be48"><a name="dslConverter794"></a><a name="UpgradingDSL-dslConverter794"></a></p><a name="UpdatingDotCoverparameters"></a><a name="Updating-DotCover-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingDotCoverparameters">Updating DotCover parameters</h4><p id="09494023">Parameters used by DotCover were changed and if you use them,  make sure <code class="code">dotNetCoverage.tool</code> has the <code class="code">dotcover</code> value. If the <code class="code">dotNetCoverage.dotCover.home.path</code> parameter is missing, set it to <code class="code">%teamcity.tool.JetBrains.dotCover.CommandLineTools.bundled%</code>. The result should look like this:</p><div class="code-block" data-lang="none">param("dotNetCoverage.tool", "dotcover")
param("dotNetCoverage.dotCover.home.path", "%teamcity.tool.JetBrains.dotCover.CommandLineTools.bundled%")

</div><p id="be816fab">If you use DotCover with custom path (for example, <code class="code">/custom/path</code>), then the result should look like this:</p><div class="code-block" data-lang="none">param("dotNetCoverage.tool", "dotcover")
param("dotNetCoverage.dotCover.home.path", "/custom/path")

</div></div><a name="UpdatingMavenbuildstepparameters"></a><a name="Updating-Maven-build-step-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingMavenbuildstepparameters">Updating Maven build step parameters</h4><p id="14ab486d">If you use a typed maven DSL without raw parameters, then this change should not affect you, because typed DSL generates up-to-date settings.</p><p id="e9d3428b">If you specify maven build runner settings via the <code class="code">param("name", "value")</code> method, then parameters need to be updated. The easiest way to update settings is to switch to the typed DSL: you can generate settings in the Kotlin format to see what the typed DSL for Maven looks like.</p><p id="33c5d302">If you want to continue using the <code class="code">param("name", "value")</code> method, do the following:</p><ul class="list _ul"><li class="list__item" id="a38bd7dc"><p>rename the <code class="code">mavenSelection</code> parameter to <code class="code">maven.path</code>, change its old value to the new one:</p></li></ul><div class="table-wrapper"><table width="100%" id="7b03e278"><thead><tr id="44da777a" class="ijRowHead"><th id="63f1b1cf"><p id="ecef333b">Old value to be changed</p></th><th id="b520d2f6"><p id="8026b5f5">New value</p></th></tr></thead><tbody><tr id="85134db2" class="ijRowOdd"><td id="f802cbee"><p id="1f7eec3f"><code class="code">mavenSelection:bundledM2</code></p></td><td id="debea464"><p id="af1d2177"><code class="code">%teamcity.tool.maven%</code></p></td></tr><tr id="9164e451" class="ijRowEven"><td id="90cb08df"><p id="f37f751b"><code class="code">mavenSelection:bundledM3_0</code></p></td><td id="b6ba19c2"><p id="d6fb309f"><code class="code">%teamcity.tool.maven3%</code></p></td></tr><tr id="731f766c" class="ijRowOdd"><td id="61236775"><p id="c3cdd007"><code class="code">mavenSelection:bundledM3_1</code></p></td><td id="bf9697a8"><p id="ae633943"><code class="code">%teamcity.tool.maven3_1%</code></p></td></tr><tr id="e9ecf439" class="ijRowEven"><td id="f68a69b0"><p id="c84795d7"><code class="code">mavenSelection:bundledM3_2</code></p></td><td id="b03aa9f5"><p id="c371af78"><code class="code">%teamcity.tool.maven3_2%</code></p></td></tr><tr id="16bd645b" class="ijRowOdd"><td id="f6621851"><p id="10937060"><code class="code">mavenSelection:bundledM3_3</code></p></td><td id="2b68aa2e"><p id="92624aa2"><code class="code">%teamcity.tool.maven3_3%</code></p></td></tr><tr id="312a08fd" class="ijRowEven"><td id="1639f66b"><p id="f70f6131"><code class="code">mavenSelection:default</code></p></td><td id="fd952bb7"><p id="a13fa36e"><code class="code">%teamcity.tool.maven.AUTO%</code></p></td></tr><tr id="fd931f70" class="ijRowOdd"><td id="79a05664"><p id="67e3d8bd"><code class="code">mavenSelection:custom</code></p></td><td id="92a8b7e0"><p id="b792316d">value of the <code class="code">maven.home</code> parameter</p></td></tr></tbody></table></div><ul class="list _ul"><li class="list__item" id="f026662b"><p>remove the <code class="code">maven.home</code> parameter.</p></li></ul></div><a name="UpdatingPowerShellbuildstepparameters"></a><a name="Updating-PowerShell-build-step-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingPowerShellbuildstepparameters">Updating PowerShell build step parameters</h4><p id="ee2da2b3">TeamCity 2017.1 adds support for cross-platform PowerShell. Previously PowerShell builds used only the Desktop edition and were run only on Windows.</p><p id="f69311e2">To ensure that the existing builds remain restricted to the Desktop edition of PowerShell, set the following property in the existing PowerShell steps:</p><div class="code-block" data-lang="none">edition = PowerShellStep.Edition.Desktop

</div><p id="32b9357f">or if you use raw parameters:</p><div class="code-block" data-lang="none">param("jetbrains_powershell_edition", "Desktop")

</div><hr id="82f8c1bc"></div></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>