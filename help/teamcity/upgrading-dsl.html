<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>升级DSL-帮助|帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Upgrading DSL" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/storing-project-settings-in-version-control.md|Storing Project Settings in Version Control/kotlin-dsl.md|Kotlin DSL/upgrading-dsl.md|Upgrading DSL" data-main-title="Upgrading DSL" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/upgrading-dsl.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="upgrading-dsl.md" data-toc="Upgrading DSL">升级DSL</h1><p id="2ba077a6">在此页：</p><p id="e3e9ea81"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#UpgradingDSL-TeamCitysettingsformatchanges">TeamCity设置格式更改</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Changeswhichcanbeperformedautomatically">可以自动执行的更改</a></li><li class="list__item"><a href="#UpgradingDSL-Changeswhichcannotbeperformedautomatically">无法自动执行的更改</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-VersionsinDSLcode">DSL代码版本</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-KotlinDSLAPIversion">Kotlin DSL API版本</a></li><li class="list__item"><a href="#UpgradingDSL-Configsversion">配置版本</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-DSLupgradeprocedure">DSL升级步骤</a></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2018.2.xto2019.1.x">将DSL从2018.2.x更新到2019.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingMavenbuildsteps">更新Maven构建步骤</a></li><li class="list__item"><a href="#UpgradingDSL-AddversiontoMSBuildandVS.Solutionbuildsteps">将版本添加到MSBuild和VS.Solution的构建步骤</a></li><li class="list__item"><a href="#UpgradingDSL-BuildconfigurationparameterbuildDefaultBranchisdeprecated">不建议使用构建配置参数buildDefaultBranch</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2018.1.xto2018.2.x">将DSL从2018.1.x更新到2018.2.x</a></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2017.2.xto2018.1.x">将DSL从2017.2.x更新到2018.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingDockerparameters">更新Docker参数</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Dockerpushcommandsupport">Docker推送命令支持</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher">在“提交状态发布者”中的Gerrit发布者设置中添加标签属性</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom2017.1.xto2017.2.x">将DSL从2017.1.x更新到2017.2.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-DSLversion">DSL版本</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingDockerparameters2">更新Docker参数</a></li><li class="list__item"><a href="#UpgradingDSL-Updatingdefaultprojecttemplate">更新默认项目模板</a></li><li class="list__item"><a href="#UpgradingDSL-Updating.NETCLIparameters">更新.NET CLI参数</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Commonparameters">常用参数</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetbuild">网络构建</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetclean">网络清洁</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetmsbuild">dotnet msbuild</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetnugetdelete">dotnet nuget删除</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetnugetpush">dotnet nuget推送</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetpack">网络包</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetpublish">dotnet发布</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetrestore">点网还原</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetrun">网络运行</a></li><li class="list__item"><a href="#UpgradingDSL-dotnettest">网络测试</a></li><li class="list__item"><a href="#UpgradingDSL-dotnetvstest">dotnet vstest</a></li></ul></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdateDSLfrom10.0.xto2017.1.x">将DSL从10.0.x更新到2017.1.x</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-ChangesrequiringmanualKotlinDSLscriptsupdate">需要手动Kotlin DSL脚本更新的更改</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-Convertingcloudprofiles">转换云配置文件</a></li><li class="list__item"><a href="#UpgradingDSL-Namesinentities">实体名称</a></li></ul></li><li class="list__item"><a href="#UpgradingDSL-UpdatingKotlinDSLconfigsversionto10.0to2017.1">将Kotlin DSL配置版本更新为10.0至2017.1</a><ul class="list _bullet"><li class="list__item"><a href="#UpgradingDSL-UpdatingDotCoverparameters">更新DotCover参数</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingMavenbuildstepparameters">更新Maven构建步骤参数</a></li><li class="list__item"><a href="#UpgradingDSL-UpdatingPowerShellbuildstepparameters">更新PowerShell构建步骤参数</a></li></ul></li></ul></li></ul><p></p><p id="53df61a0">在主要版本中，通常会<a href="storing-project-settings-in-version-control.html#Enabling-Versioned-Settings-after-TeamCity-Upgrade">更改</a> TeamCity XML设置格式。在服务器更新后的第一次启动期间，TeamCity将TeamCity数据目录中的XML设置文件转换为新格式。<br>当设置存储在Kotlin DSL中时，可能需要更改Kotlin代码才能正常工作。还建议将每个版本的Kotlin代码更新为最新的配置版本。<br>这些建议作为服务器健康状况报告显示在服务器管理UI的相应页面上。</p><a name="TeamCitysettingsformatchanges"></a><a name="TeamCity-settings-format-changes"></a><div class="chapter"><h2 id="UpgradingDSL-TeamCitysettingsformatchanges">TeamCity设置格式更改</h2><p id="35b2e632">就DSL而言，TeamCity设置类型有以下几种。</p><a name="Changeswhichcanbeperformedautomatically"></a><a name="Changes-which-can-be-performed-automatically"></a><div class="chapter"><h3 id="UpgradingDSL-Changeswhichcanbeperformedautomatically">可以自动执行的更改</h3><p id="fb54a0a1">这些类型的设置更改不需要更改Kotlin DSL，因为更改是由服务器自动应用到从DSL再生的每个设置上。但是建议您将DSL更新为较新的配置版本，以减少性能损失并使Kotlin脚本更接近您在UI中看到的设置。<br>TeamCity设置中的许多更改都属于此类别。例如，某些实现构建步骤的插件可能会重命名其参数。先前TeamCity版本的DSL会生成一个具有旧名称的参数，但是DSL执行后，TeamCity可以自动将旧参数名称替换为新名称。</p></div><a name="Changeswhichcannotbeperformedautomatically"></a><a name="Changes-which-cannot-be-performed-automatically"></a><div class="chapter"><h3 id="UpgradingDSL-Changeswhichcannotbeperformedautomatically">无法自动执行的更改</h3><p id="387f8842">某些TeamCity设置更改需要外部信息，并且无法自动执行。例如，在TeamCity 10.0中，云集成的设置存储在未提交到VCS的专用文件中。在TeamCity 2017.1中，这些设置已移至项目级别。如果没有外部数据，TeamCity无法自动执行这种设置转换，因此需要手动更新DSL代码。</p></div></div><a name="VersionsinDSLcode"></a><a name="Versions-in-DSL-code"></a><div class="chapter"><h2 id="UpgradingDSL-VersionsinDSLcode">DSL代码版本</h2><a name="KotlinDSLAPIversion"></a><a name="Kotlin-DSL-API-version"></a><div class="chapter"><h3 id="UpgradingDSL-KotlinDSLAPIversion">Kotlin DSL API版本</h3><p id="2d20fc31">这是Kotlin DSL API软件包名称中包含的版本： <code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code> 。新的向后不兼容的API将在新的软件包中提供，并且旧版本的API将继续起作用。</p></div><a name="Configsversion"></a><a name="Configs-version"></a><div class="chapter"><h3 id="UpgradingDSL-Configsversion">配置版本</h3><p id="be1dc0b8">这是在中指定的版本<code class="code">settings.kts</code> ，它看起来像这样：</p><div class="code-block" data-lang="none">版本=“ 2019.1”项目（Some_Project）</div><p id="ddb4ef95">TeamCity使用此版本执行DSL执行转换，以使设置保持最新状态。<br>例如，您的DSL脚本可以由TeamCity 2017.2生成，其版本设置为“ 2017.2”。当您将服务器升级到版本2019.1时，TeamCity将执行DSL并应用其他转换，以根据版本2019.1。预期的格式修改设置。</p></div></div><a name="DSLupgradeprocedure"></a><a name="DSL-upgrade-procedure"></a><div class="chapter"><h2 id="UpgradingDSL-DSLupgradeprocedure">DSL升级步骤</h2><p id="61791314">TeamCity升级后，将在整个TeamCity服务器上全局禁用版本设置，并在管理UI中显示相应的运行状况报告。如果升级TeamCity服务器的非生产副本，这样做是为了防止TeamCity更改版本控制中的设置。</p><p id="7a2931a5">如果服务器是生产安装，请使用运行状况报告中的操作启用版本设置。这将使TeamCity将转换后的XML文件提交到VCS。对于Kotlin格式的设置，将提交plugin-settings目录和meta-runners中的文件。</p><p id="b5670b85">此时，版本控制具有Kotlin DSL脚本的先前版本。</p><p id="4d509aa8">如果某些设置转换无法自动应用，TeamCity将禁用受影响项目的版本设置，并显示相应的运行状况报告。您应该按照以下说明更新DSL，然后可以在项目中启用版本设置。</p><p id="9afd5580">对于Kotlin DSL中设置不受设置转换影响的项目，或者如果设置可以自动转换，则Kotlin DSL脚本不需要任何立即更改，您可以照常继续使用项目（版本设置保持启用状态）。这样的项目）。但是，建议将Kotlin脚本更新为最新的配置版本。TeamCity将为每个受影响的项目显示运行状况报告，其中包含有关如何更新DSL的说明。为了检查是否需要更新DSL代码，请从VCS加载设置，然后在“ <b id="93b6b532">版本设置”</b>选项卡上查看“ <b id="b7f32cae">当前状态</b> ”：如果需要更新，它将显示警告。</p><p id="6fa98178"><a name="dsl20191"></a><a name="UpgradingDSL-dsl20191"></a></p></div><a name="UpdateDSLfrom2018.2.xto2019.1.x"></a><a name="Update-DSL-from-2018.2.x-to-2019.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2018.2.xto2019.1.x">将DSL从2018.2.x更新到2019.1.x</h2><p id="6986f765">此版本引入了新的DSL API版本<b id="1c93aa05">v2019_1</b> ，但其软件包仍然<code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code>因为版本2018.2.x和2019.1.x之间的DSL没有明显变化。</p><a name="UpdatingMavenbuildsteps"></a><a name="Updating-Maven-build-steps"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingMavenbuildsteps">更新Maven构建步骤</h3><p id="e5d980cb">生成Maven的DSL生成步骤应更新。如果Maven构建步骤没有<code class="code">useOwnLocalRepo</code>参数设置为<code class="code">true</code> ， 下列<code class="code">localRepoScope</code>参数应添加：</p><div class="code-block" data-lang="none">专家{localRepoScope = MavenBuildStep。RepositoryScope。MAVEN_DEFAULT}</div><p id="f186e938">如果<code class="code">useOwnLocalRepo</code>设置为<code class="code">true</code> ，则应将其替换为：</p><div class="code-block" data-lang="none">专家{localRepoScope = MavenBuildStep。RepositoryScope。BUILD_CONFIGURATION}</div></div><a name="AddversiontoMSBuildandVS.Solutionbuildsteps"></a><a name="Add-version-to-MSBuild-and-VS.Solution-build-steps"></a><div class="chapter"><h3 id="UpgradingDSL-AddversiontoMSBuildandVS.Solutionbuildsteps">将版本添加到MSBuild和VS.Solution的构建步骤</h3><p id="f02ffe2c">如果MSBuild或VS.Solution构建步骤具有参数<code class="code">toolsVersion</code>调成<code class="code">MSBuildStep.MSBuildToolsVersion.V15_0</code> ，其他<code class="code">version = MSBuildStep.MSBuildVersion.V15_0</code>参数应添加：</p><div class="code-block" data-lang="none">msBuild {...toolsVersion = MSBuildStep。MSBuildToolsVersion。V15_0版本= MSBuildStep。MSBuildVersion。V15_0}</div></div><a name="BuildconfigurationparameterbuildDefaultBranchisdeprecated"></a><a name="Build-configuration-parameter-buildDefaultBranch-is-deprecated"></a><div class="chapter"><h3 id="UpgradingDSL-BuildconfigurationparameterbuildDefaultBranchisdeprecated">不建议使用构建配置参数buildDefaultBranch</h3><p id="e6695d17">构建配置版本控制设置参数<code class="code">buildDefaultBranch</code>不推荐使用： <code class="code">branchFilter</code>应该改为使用。<br>例如，如果<code class="code">buildDefaultBranch</code>设置为<code class="code">false</code> ，应改为指定以下分支过滤器：</p><div class="code-block" data-lang="none">vcs {branchFilter =“”“ +：*-： <default>”“”}</default></div><p id="8052cce4"><a name="dsl20182"></a><a name="UpgradingDSL-dsl20182"></a></p></div></div><a name="UpdateDSLfrom2018.1.xto2018.2.x"></a><a name="Update-DSL-from-2018.1.x-to-2018.2.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2018.1.xto2018.2.x">将DSL从2018.1.x更新到2018.2.x</h2><p id="0e84606f">此版本引入了新的DSL API版本<b id="191104d4">v2018_2</b> ，其软件包为<code class="code">jetbrains.buildServer.configs.kotlin.v2018_2</code> 。</p><p id="a2c10112"><a name="dsl20181"></a><a name="UpgradingDSL-dsl20181"></a></p></div><a name="UpdateDSLfrom2017.2.xto2018.1.x"></a><a name="Update-DSL-from-2017.2.x-to-2018.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2017.2.xto2018.1.x">将DSL从2017.2.x更新到2018.1.x</h2><p id="4b036907">此版本引入了新的DSL API版本v2018_1，其软件包为<b id="b55ebfdc">jetbrains.buildServer.configs.kotlin.v2018_1</b> 。以前的API版本有效，如果您不想使用可移植的DSL脚本，则可以继续使用它们。</p><p id="4a77c922"><a name="dslConverter850"></a><a name="UpgradingDSL-dslConverter850"></a></p><a name="UpdatingDockerparameters"></a><a name="Updating-Docker-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingDockerparameters">更新Docker参数</h3><p id="fe9029f2">如果您将Kotlin DSL与TeamCity 2017.2一起用于Docker插件配置，则可能需要对Kotlin配置脚本进行一些更改，以使代码与TeamCity 2018.1兼容。</p><p id="0d108a11">变化的实质：</p><ul class="list _ul"><li class="list__item" id="195ef912"><p>构建步骤<b id="a659994e">dockerBuild</b>现在已转换为<b id="3554b99c">dockerCommand</b></p></li><li class="list__item" id="5ec37eed"><p>DockerBuild的参数现在是commandType选择器的子参数</p></li></ul><p id="f4199360">注意区别：</p><p id="9b702f9f"><b id="d666ec43">Docker Build 2 Docker命令迁移</b></p><div class="code-block" data-lang="none">＃DockerBuild在2017.2：dockerBuild {name =“构建步骤的名称” source = content {content =“”“ FROM busybox MAINTAINER KIR <kir@maxkir.com>”“” .trimIndent（）} namesAndTags =“ maxkir / maxkir_test”}＃---- ------------------------------------＃DockerBuild in 2018.1：dockerCommand {name =“构建名称步骤“ commandType =构建{源=内容{内容=”“” FROM busybox MAINTAINER KIR <kir@maxkir.com>“”“ .trimIndent（）} namesAndTags =” maxkir / maxkir_test“}}</kir@maxkir.com></kir@maxkir.com></div><a name="Dockerpushcommandsupport"></a><a name="Docker-push-command-support"></a><div class="chapter"><h4 id="UpgradingDSL-Dockerpushcommandsupport">Docker推送命令支持</h4><div class="code-block" data-lang="none">dockerCommand {name =“推送步骤的名称” commandType = push {namesAndTags =“ maxkir / maxkir_test”}}</div><p id="c8449fca"><a name="dslConverter839"></a><a name="UpgradingDSL-dslConverter839"></a></p></div></div><a name="AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher"></a><a name="Adding-label-property-to-Gerrit-publisher-settings-in-Commit-Status-Publisher"></a><div class="chapter"><h3 id="UpgradingDSL-AddinglabelpropertytoGerritpublishersettingsinCommitStatusPublisher">在“提交状态发布者”中的Gerrit发布者设置中添加标签属性</h3><p id="11a7c43d"><b id="f8effe4b">自从TeamCity 2018.1</b> <a href="commit-status-publisher.html">提交状态发布者</a>构建功能中的Gerrit发布者设置<b id="f8effe4b">以来，</b>可以自定义反映构建状态的Gerrit标签，即，您现在可以使用经过验证的内容。</p><p id="249eab22">要手动修改Kotlin DSL设置，必须按如下所示添加<b id="13a49a82">label =“ Verified”</b>语句：</p><div class="code-block" data-lang="none">特征 { ...commitStatusPublisher {发布者= gerrit {服务器=“ <server>” gerritProject =“ <project>” failureVote =“ -1” successVote =“ +1” userName =“ <project>” uploadKey <user>=“ <key>” label =“ Verified” //要添加的语句}} .. 。}</key></user></project></project></server></div><p id="cb147e0f"><a name="dsl20172"></a><a name="UpgradingDSL-dsl20172"></a></p></div></div><a name="UpdateDSLfrom2017.1.xto2017.2.x"></a><a name="Update-DSL-from-2017.1.x-to-2017.2.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom2017.1.xto2017.2.x">将DSL从2017.1.x更新到2017.2.x</h2><a name="DSLversion"></a><a name="DSL-version"></a><div class="chapter"><h3 id="UpgradingDSL-DSLversion">DSL版本</h3><p id="a44bfaca">此版本引入了新的DSL API版本， <code class="code">v2017_2</code> 。先前的API版本有效，如果不需要<a href="https://confluence.jetbrains.com/display/TCD10/What's+New+in+TeamCity+2017.2" rel="noopener noreferrer" data-external="true" target="_blank">新API提供</a>的<a href="https://confluence.jetbrains.com/display/TCD10/What's+New+in+TeamCity+2017.2" rel="noopener noreferrer" data-external="true" target="_blank">功能</a> ，则可以继续使用它。</p><aside class="note " rel="a44bfaca" id="268b11e6" data-title=""><p id="c876f05f">要获得新支持的功能的示例DSL代码而不将项目切换到Kotlin格式，请使用项目管理页面上的<b id="d3f7f3bd">Kotlin格式</b>的<b id="d3f7f3bd">下载设置</b>操作。</p></aside><p id="5c9ed731">如果您使用2017.2 EAP并通过UI测试了更改的DSL设置，则由于升级某些API的方式不兼容，因此需要在升级之前应用TeamCity创建的所有UI补丁。</p><p id="860c8307">TeamCity生成的设置的当前软件包名称为<code class="code">jetbrains.buildServer.configs.kotlin.v2017_2</code> 。</p><p id="0bff7df2">使用新的API，您可以受益于许多<a href="https://confluence.jetbrains.com/display/TCD10/What%27s+New+in+TeamCity+2017.2#What'sNewinTeamCity2017.2-KotlinDSLImprovements" rel="noopener noreferrer" data-external="true" target="_blank">新功能</a> ，包括针对Kotlin DSL项目和DSL文档的可编辑管理UI。要将它们用于您现有的项目， <code class="code">.kt</code>文件应从<code class="code">v2017_2 version</code> 。</p><ul class="list _ul"><li class="list__item" id="fe3e4431">要编译该项目，您还需要更新pom.xml。最简单的方法是在项目中调用<b id="3ffd123f">Kotlin格式</b>的<b id="3ffd123f">Download设置</b>操作，然后复制<code class="code">pom.xml</code>从生成的zip存档中。另外，您可以使用以下内容自己更新pom.xml：<ul class="list _ul"><li class="list__item" id="2f0bf632"><p>更改<code class="code">teamcity.dsl.version</code>至：<code class="code"><teamcity.dsl.version>2017.2</teamcity.dsl.version></code></p></li><li class="list__item" id="432a035b"><p>将kotlin版本更改为： <code class="code"><kotlin.version>1.1.4-3</kotlin.version></code>并添加对kotlin-runtime和kotlin-reflect的依赖：</p></li></ul></li></ul><div class="code-block" data-lang="none"><dependency><groupid>org.jetbrains.kotlin</groupid> <artifactid>kotlin运行时</artifactid> <version>$ {kotlin.version}</version> <scope>编译</scope></dependency> <dependency><groupid>org.jetbrains.kotlin</groupid> <artifactid>kotlin-reflect</artifactid> <version>$ {kotlin.version}</version> <scope>编译</scope></dependency>

</div><p id="42596ce4">将项目切换到新的API并签入更改后，TeamCity将检测并应用它们，然后将启用Web UI编辑。<br>在现有存储库中使用新的DSL API <code class="code">pom.xml</code> ，必须将maven依赖版本更新为<code class="code">2017.2</code> 。</p></div><a name="UpdatingDockerparameters"></a><a name="Updating-Docker-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingDockerparameters2">更新Docker参数</h3><p id="0ccf2fa3">如果您将Kotlin DSL与TeamCity 2017.1一起用于Docker插件配置，则可能需要对kotlin配置脚本进行一些更改，以使代码与TeamCity 2017.2兼容。基本上，TeamCity为Kotlin配置脚本提供了一个转换器，以自动执行那些更改，但是如果由于某种原因它不起作用，则需要手动进行以下更改：</p><ul class="list _ul"><li class="list__item" id="87bc9240"><p>将具有<b id="1fef94aa">Docker Build</b> runType的构建运行器步骤重命名为<b id="58646534">DockerBuild</b></p></li><li class="list__item" id="56cdc07d"><p>将具有<b id="58e230ab">Docker Compose</b> runType的构建运行器步骤重命名为<b id="b701c117">DockerCompose</b></p></li><li class="list__item" id="47d16127"><p>重命名<code class="code">docker-compose.file</code>建立参数<code class="code">dockerCompose.file</code></p></li></ul><p id="795acbd2">从TeamCity 2017.2开始，Docker插件针对<a href="docker-support.html">Docker构建功能</a> ， <a href="docker-wrapper.html">Docker Wrapper</a> ， <a href="docker.html">Docker</a>和<a href="docker-compose.html">Docker Compose运行程序</a>具有自己的类型化DSL。</p><p id="c7f951f3"><b id="e5401a4b">Docker Compose和Docker Build</b></p><div class="code-block" data-lang="none">步骤{dockerCompose {名称=“启动服务”文件=“ db-tests / scripts / docker-compose.yml”} dockerBuild {名称=“ Docker构建步骤”源=路径{路径=“ some / context / Dockerfile”} / / URL指定的Dockerfile的案例：// source = url {// url =“ https://raw.githubusercontent.com/JetBrains/teamcity-docker-minimal-agent/master/ubuntu/Dockerfile” //} / /文本指定的Dockerfile的情况：// source = content {// content =“”“ // FROM busybox // MAINTAINER Kirill Maximov <kir@jetbrains.com>// //”“”。trimIndent（）//} contextDir =“ some / context” namesAndTags =“ my：tag”}}</kir@jetbrains.com></div><p id="4052d951"><b id="7d263e0a">Docker构建功能</b></p><div class="code-block" data-lang="none">功能{dockerSupport {cleanupPushedImages = true loginToRegistry = on {dockerRegistryId =“ PROJECT_EXT_2”}}}</div><p id="892f7b16"><b id="ec826ee4">Docker Wrapper的命令行运行程序</b></p><div class="code-block" data-lang="none">脚本{scriptContent =“ ls -lR” dockerImage =“ openjdk：8u121” dockerPull = true dockerRunParameters =“ --rm -v / some / path：/ another / path：ro”}</div></div><a name="Updatingdefaultprojecttemplate"></a><a name="Updating-default-project-template"></a><div class="chapter"><h3 id="UpgradingDSL-Updatingdefaultprojecttemplate">更新默认项目模板</h3><p id="32c04d5c">自2017.2 EAP3起，TeamCity支持项目中的默认模板。此设置存储在EAP3和EAP4中“ DefaultTemplate”类型的项目功能中，但是自2017.2 RC起，项目配置架构已更改为适应默认模板。<br>要手动转换使用默认模板的DSL项目配置，您将必须删除相应的项目功能并将其替换为defaultTemplate属性分配，如下所示：</p><p id="79385b97">2017.2 EAP3 / 4 DSL项目配置，其中配置了默认模板：</p><div class="code-block" data-lang="none">对象项目：项目（{uuid =“ 2b241ffb-9019-4e60-9a3a-d5475ab1f312” extId =“ ExampleProject” parentId =“ _Root”名称=“示例项目” ...特征 { ...功能{id =“ PROJECT_EXT_4” type =“ DefaultTemplate” param（“ template”，“ ExampleProject_MyDefaultTemplate”）} ...} ...}）</div><p id="7e5cba9d">2017.2 DSL项目配置，配置了默认模板：</p><div class="code-block" data-lang="none">对象项目：Project（{uuid =“ 2b241ffb-9019-4e60-9a3a-d5475ab1f312” extId =“ ExampleProject” parentId =“ _Root”名称=“示例项目” defaultTemplate =“ ExampleProject_MyDefaultTemplate” ...特征 { ...} ...}）</div></div><a name="Updating.NETCLIparameters"></a><a name="Updating-.NET-CLI-parameters"></a><div class="chapter"><h3 id="UpgradingDSL-Updating.NETCLIparameters">更新.NET CLI参数</h3><p id="4c5ce999"><b id="161101b6">从2017.2开始，</b> TeamCity捆绑了.NET CLI插件。如果您在TeamCity 2017.1.x中使用Kotlin DSL作为插件参数，则需要按以下方式更改命令。在TeamCity 2017.1.x中：</p><div class="code-block" data-lang="none">步骤{步骤{type =“ dotnet” param（“ dotnet-command”，“ build”）param（“ dotnet-paths”，“ WindowsAzure.sln”）}}</div><p id="3ec50c0d">从TeamCity 2017.2开始，您可以显式指定带有参数的构建步骤：</p><div class="code-block" data-lang="none">步骤{dotnetBuild {项目=“ WindowsAzure.sln”}}</div><a name="Commonparameters"></a><a name="Common-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-Commonparameters">常用参数</h4><div class="table-wrapper"><table class=" wide" width="100%" id="570828ed"><thead><tr id="f4515731" class="ijRowHead"><th id="30545fe1"><p id="ab32d301">2017.1</p></th><th id="323e74a9"><p id="fe3f8bcf">2017.2</p></th><th id="544f27f4"><p id="c3c3eb15">评论</p></th></tr></thead><tbody><tr id="2a968373" class="ijRowOdd"><td id="9525e157"><p id="53653d5e">点网命令</p></td><td id="5224b3f1"><p id="2ac0d174">网络<command></p></td><td id="f83f98cd"><p id="15cbaadc">现在，命令名称反映了构建步骤名称，例如<code class="code">dotnetRestore</code></p></td></tr><tr id="759c1159" class="ijRowEven"><td id="d1161274"><p id="bbad74f3">dotnet-args</p></td><td id="866f085e"><p id="a9a20bfa">args</p></td><td id="d4ae3a66"></td></tr><tr id="24ce2894" class="ijRowOdd"><td id="b1189c49"><p id="15039c8e">网络状态</p></td><td id="a145e464"><p id="95385c51">测井</p></td><td id="ade68813"></td></tr></tbody></table></div></div><a name="dotnetbuild"></a><a name="dotnet-build"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetbuild">网络构建</h4><div class="table-wrapper"><table class=" wide" width="100%" id="12f064f9"><thead><tr id="b7e35c94" class="ijRowHead"><th id="5a13adc2"><p id="063e1497">2017.1</p></th><th id="cc798148"><p id="86e74093">2017.2</p></th><th id="b95196f9"><p id="579680cc">评论</p></th></tr></thead><tbody><tr id="31a97385" class="ijRowOdd"><td id="901b584e"><p id="83c39d9b">网络路径</p></td><td id="084df014"><p id="558754a3">专案</p></td><td id="df624524"></td></tr><tr id="9dd08958" class="ijRowEven"><td id="2588af58"><p id="c60a72f2">dotnet构建配置</p></td><td id="c45049da"><p id="eef9a4bc">组态</p></td><td id="afc1aacc"></td></tr><tr id="b4a696f2" class="ijRowOdd"><td id="fea669d2"><p id="92b45c30">dotnet构建框架</p></td><td id="566a8754"><p id="e877dd8c">构架</p></td><td id="05f2ee0d"></td></tr><tr id="79b6bf5c" class="ijRowEven"><td id="2f67ffd6"><p id="23f86de2">dotnet构建输出</p></td><td id="b0777c48"><p id="d362b9db">outputDir</p></td><td id="eac5797b"></td></tr><tr id="0d7c9c03" class="ijRowOdd"><td id="107d4014"><p id="9a8195c7">dotnet构建运行时</p></td><td id="5a4af87b"><p id="cabbd47c">运行</p></td><td id="f0be436e"></td></tr><tr id="3a5a3f81" class="ijRowEven"><td id="258a439a"><p id="b6108663">dotnet建立没有deps</p></td><td id="16b0f29f"><p id="bde7a3d2">--</p></td><td id="4859170a"><p id="172eadb6">应该添加为<code class="code">--no-dependencies</code>论点</p></td></tr><tr id="3a5d05b5" class="ijRowOdd"><td id="9fcdb832"><p id="691af934">dotnet构建不是增量的</p></td><td id="00ca4eaa"><p id="057ee47d">--</p></td><td id="6917ec9a"><p id="2aa75b6d">应该添加为<code class="code">--no-incremental</code>论点</p></td></tr></tbody></table></div></div><a name="dotnetclean"></a><a name="dotnet-clean"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetclean">网络清洁</h4><div class="table-wrapper"><table width="100%" id="31f98a71"><thead><tr id="bc57502f" class="ijRowHead"><th id="d2ef9916"><p id="1618dd87">2017.1</p></th><th id="89eda6c4"><p id="5573c35c">2017.2</p></th></tr></thead><tbody><tr id="5553747e" class="ijRowOdd"><td id="d6b5c90e"><p id="bd1ff479">网络路径</p></td><td id="c29015ae"><p id="f4f7e1c0">专案</p></td></tr><tr id="4dad90fa" class="ijRowEven"><td id="c92c039f"><p id="c71659a9">dotnet-clean-config</p></td><td id="ba82e336"><p id="2b3e13b1">组态</p></td></tr><tr id="1ba9f4d8" class="ijRowOdd"><td id="ea1e7d7e"><p id="3105f9e3">dotnet-clean-framework</p></td><td id="fc549f75"><p id="c36f5c77">构架</p></td></tr><tr id="19415a66" class="ijRowEven"><td id="8efe07d3"><p id="f771a084">网络清洁输出</p></td><td id="63286100"><p id="882c563d">outputDir</p></td></tr><tr id="003ca1c0" class="ijRowOdd"><td id="e36c3f9a"><p id="01c09950">dotnet清洁运行时</p></td><td id="95554bb7"><p id="fd81cad1">运行</p></td></tr></tbody></table></div></div><a name="dotnetmsbuild"></a><a name="dotnet-msbuild"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetmsbuild">dotnet msbuild</h4><div class="table-wrapper"><table width="100%" id="79484712"><thead><tr id="a2d646d2" class="ijRowHead"><th id="850b58e3"><p id="7f180428">2017.1</p></th><th id="50100206"><p id="501f6aaf">2017.2</p></th></tr></thead><tbody><tr id="742a23f7" class="ijRowOdd"><td id="35ccc504"><p id="339bcf76">网络路径</p></td><td id="ec713cea"><p id="ecc214e6">专案</p></td></tr><tr id="490d9cb0" class="ijRowEven"><td id="ced61a9c"><p id="4bdd3c56">dotnet-msbuild-config</p></td><td id="152c42a6"><p id="cb7d69b5">组态</p></td></tr><tr id="df300b6b" class="ijRowOdd"><td id="1869c6c6"><p id="6d71d000">dotnet-msbuild-platform</p></td><td id="12c36eaf"><p id="bc1b48a9">平台</p></td></tr><tr id="2ba3cf95" class="ijRowEven"><td id="bd775faf"><p id="f4d3728d">dotnet-msbuild-targets</p></td><td id="59f6dddf"><p id="1faf7f97">目标</p></td></tr><tr id="4451f540" class="ijRowOdd"><td id="02b3f38a"><p id="556fae5c">dotnet-msbuild-runtime</p></td><td id="ce3dcecc"><p id="bb4d60e7">运行</p></td></tr></tbody></table></div></div><a name="dotnetnugetdelete"></a><a name="dotnet-nuget-delete"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetnugetdelete">dotnet nuget删除</h4><div class="table-wrapper"><table width="100%" id="19d8652d"><thead><tr id="b8dfec8b" class="ijRowHead"><th id="1361a166"><p id="42c06954">2017.1</p></th><th id="f11abe91"><p id="f1b6bb30">2017.2</p></th></tr></thead><tbody><tr id="7c5ec2cc" class="ijRowOdd"><td id="b397cca5"><p id="d4882fd4">dotnet-nuget-delete-id</p></td><td id="4437203f"><p id="a2d96178">packageId</p></td></tr><tr id="f70a7a1f" class="ijRowEven"><td id="a920c0fd"><p id="c8d2f12e">dotnet-nuget-push-source /</p><p id="bba0486b">dotnet-nuget-delete-source</p></td><td id="ea957e9f"><p id="8a88a50f">packageSource</p></td></tr><tr id="ff101985" class="ijRowOdd"><td id="87b7f964"><p id="7852eeb5">安全：dotnet-nuget-delete-api-key</p></td><td id="e846966b"><p id="a6a0865e">apiKey</p></td></tr></tbody></table></div></div><a name="dotnetnugetpush"></a><a name="dotnet-nuget-push"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetnugetpush">dotnet nuget推送</h4><div class="table-wrapper"><table class=" wide" width="100%" id="54e72640"><thead><tr id="cbfb4294" class="ijRowHead"><th id="272b3c4b"><p id="ead068be">2017.1</p></th><th id="e73c48d9"><p id="b00d74bb">2017.2</p></th><th id="d78cb524"><p id="b35f691d">评论</p></th></tr></thead><tbody><tr id="0b5d9853" class="ijRowOdd"><td id="c70e3ab2"><p id="d756429f">网络路径</p></td><td id="72912ce6"><p id="9c870645">包装</p></td><td id="f2bf314f"></td></tr><tr id="55b766b2" class="ijRowEven"><td id="bcb4356f"><p id="d7abd3af">dotnet-nuget-push-source</p></td><td id="857dca56"><p id="ecf127ab">packageSource</p></td><td id="b9fe4d00"></td></tr><tr id="ee41438c" class="ijRowOdd"><td id="fbcc6e10"><p id="becbd708">dotnet-nuget-push-no-symbols</p></td><td id="c411f9b7"><p id="5576dd1f">noSymbols</p></td><td id="b9dd9827"></td></tr><tr id="0ef495cb" class="ijRowEven"><td id="499a6a04"><p id="5c5fb813">安全：dotnet-nuget-push-api-key</p></td><td id="b54cbe63"><p id="16c05b92">outputDir</p></td><td id="eb15e782"></td></tr><tr id="7b00ab81" class="ijRowOdd"><td id="4efd21e6"><p id="91a864bb">dotnet构建运行时</p></td><td id="08fc1a80"><p id="a6647de2">apiKey</p></td><td id="19e76426"></td></tr><tr id="f98c98df" class="ijRowEven"><td id="dafe047e"><p id="11c68ea6">dotnet-nuget-push-no-buffer</p></td><td id="387c4a3e"><p id="be8fb065">--</p></td><td id="13ad4e83"><p id="0c35bda7">应该添加为<code class="code">--disable-buffering true</code>论点</p></td></tr></tbody></table></div></div><a name="dotnetpack"></a><a name="dotnet-pack"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetpack">网络包</h4><div class="table-wrapper"><table class=" wide" width="100%" id="2bac988e"><thead><tr id="66b54fd9" class="ijRowHead"><th id="df003a22"><p id="a5c90c2e">2017.1</p></th><th id="e2799011"><p id="322ff306">2017.2</p></th><th id="3e41261c"><p id="ad05a628">评论</p></th></tr></thead><tbody><tr id="5cb62701" class="ijRowOdd"><td id="68ea1df6"><p id="1a3a5e0c">网络路径</p></td><td id="1cc4170a"><p id="8e617d7c">专案</p></td><td id="1bb22884"></td></tr><tr id="a610f122" class="ijRowEven"><td id="eefbceb9"><p id="7bb76308">dotnet-pack-config</p></td><td id="27d683f1"><p id="1b568aea">组态</p></td><td id="b5cbf046"></td></tr><tr id="b56cbe58" class="ijRowOdd"><td id="99b6e195"><p id="d0a09f60">dotnet-pack-runtime</p></td><td id="9cc1ce94"><p id="69cd761a">运行</p></td><td id="b65609c6"></td></tr><tr id="1e53f52a" class="ijRowEven"><td id="ca1bef2b"><p id="d37cdf95">dotnet-pack-no-build</p></td><td id="8cc58b66"><p id="398efe5b">skipBuild</p></td><td id="c0a4ba07"></td></tr><tr id="9c58622d" class="ijRowOdd"><td id="1631ec67"><p id="4b4e2a0e">dotnet-pack-output</p></td><td id="210698ec"><p id="c4a1c121">outputDir</p></td><td id="a359f741"></td></tr><tr id="c650553b" class="ijRowEven"><td id="f5e5cfd7"><p id="2143e60a">dotnet-pack-version-后缀</p></td><td id="3a3c7c6d"><p id="d88b8b68">版本后缀</p></td><td id="579439e3"></td></tr><tr id="996f7d9b" class="ijRowOdd"><td id="b0886c99"><p id="da4d2810">可打包使用dotnet</p></td><td id="cb9c69cb"><p id="a09db002">--</p></td><td id="91c15991"><p id="447caace">应该添加为<code class="code">--serviceable</code>论点</p></td></tr></tbody></table></div></div><a name="dotnetpublish"></a><a name="dotnet-publish"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetpublish">dotnet发布</h4><div class="table-wrapper"><table width="100%" id="c8e618e3"><thead><tr id="294ba48b" class="ijRowHead"><th id="e99f5229"><p id="78282897">2017.1</p></th><th id="2c01273d"><p id="f2d5b346">2017.2</p></th></tr></thead><tbody><tr id="a466b371" class="ijRowOdd"><td id="ded35069"><p id="3d0a59dd">网络路径</p></td><td id="e6a2aa85"><p id="c8892781">专案</p></td></tr><tr id="78d5c39f" class="ijRowEven"><td id="950beaf6"><p id="23989561">dotnet发布配置</p></td><td id="b7a15a8b"><p id="a247ea45">组态</p></td></tr><tr id="c284d1f0" class="ijRowOdd"><td id="46267684"><p id="8e6f2dd0">dotnet-发布框架</p></td><td id="9f3961f5"><p id="1631d7c7">构架</p></td></tr><tr id="609105d4" class="ijRowEven"><td id="8ac1fcbd"><p id="dc29571c">dotnet发布输出</p></td><td id="b1a849da"><p id="f4c1cf0c">outputDir</p></td></tr><tr id="dadbbc0f" class="ijRowOdd"><td id="589c3b68"><p id="ea3b569e">dotnet发布运行时</p></td><td id="2f6cd6fd"><p id="a4e868d2">运行</p></td></tr><tr id="ba4d1b5e" class="ijRowEven"><td id="67cc40a3"><p id="062188e2">dotnet-publish-version-后缀</p></td><td id="a3042e4e"><p id="a0ffe738">版本后缀</p></td></tr></tbody></table></div></div><a name="dotnetrestore"></a><a name="dotnet-restore"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetrestore">点网还原</h4><div class="table-wrapper"><table class=" wide" width="100%" id="761a7f86"><thead><tr id="332f2ba7" class="ijRowHead"><th id="e323def1"><p id="83f2a297">2017.1</p></th><th id="5f7ac30a"><p id="f06af309">2017.2</p></th><th id="8b2b872c"><p id="1d056a04">评论</p></th></tr></thead><tbody><tr id="1563d681" class="ijRowOdd"><td id="7e20f9bc"><p id="1b7d829f">网络路径</p></td><td id="aee7f4d9"><p id="5aa6d7d1">专案</p></td><td id="cae2d91a"></td></tr><tr id="cb1ecc62" class="ijRowEven"><td id="caa10a03"><p id="a99f83b1">dotnet恢复配置</p></td><td id="df8e1e57"><p id="02457f2d">配置文件</p></td><td id="288e7217"></td></tr><tr id="f2015a8d" class="ijRowOdd"><td id="6775920e"><p id="dbdf8ae3">dotnet恢复运行时</p></td><td id="afc66fc0"><p id="ee4a1a49">运行</p></td><td id="aaead247"></td></tr><tr id="d0f764be" class="ijRowEven"><td id="c4a863f1"><p id="e39f4641">dotnet恢复软件包</p></td><td id="dfa0d17f"><p id="f9213e8f">包目录</p></td><td id="a620f226"></td></tr><tr id="c2c6fa11" class="ijRowOdd"><td id="e97856ad"><p id="b5451fee">dotnet-restore-source</p></td><td id="46d4168b"><p id="33439a89">packageSources</p></td><td id="b7848b9b"></td></tr><tr id="c40be500" class="ijRowEven"><td id="eddcf7a8"><p id="81af2a3f">dotnet恢复忽略失败</p></td><td id="0a9f6b29"><p id="5f2c3016">--</p></td><td id="aa8a4adc"><p id="1a399606">应该添加为<code class="code">--ignore-failed-sources</code>论点</p></td></tr><tr id="7fe1e1ec" class="ijRowOdd"><td id="031d8f37"><p id="b99d419d">dotnet恢复无缓存</p></td><td id="698c7f3e"><p id="f867e847">--</p></td><td id="91a2e611"><p id="4391c45c">应该添加为<code class="code">--no-cache</code>论点</p></td></tr><tr id="4fb37d3d" class="ijRowEven"><td id="bcd968a2"><p id="714c66c8">点网还原并行</p></td><td id="1b6b54d4"><p id="a4f54a4b">--</p></td><td id="97087be8"><p id="f1e09af2">应该添加为<code class="code">--disable-parallel</code>论点</p></td></tr><tr id="f3cd92cd" class="ijRowOdd"><td id="4ad725a2"><p id="de8dce0c">dotnet恢复根项目</p></td><td id="e65b6f99"><p id="5fee06a1">--</p></td><td id="f01fe04d"><p id="03ac2ce9">应该添加为<code class="code">--no-dependencies</code>论点</p></td></tr></tbody></table></div></div><a name="dotnetrun"></a><a name="dotnet-run"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetrun">网络运行</h4><div class="table-wrapper"><table width="100%" id="363fbc3b"><thead><tr id="cf1d7ad0" class="ijRowHead"><th id="1820bb4a"><p id="747dcdfd">2017.1</p></th><th id="4e66ec28"><p id="82acd401">2017.2</p></th></tr></thead><tbody><tr id="4f01e96e" class="ijRowOdd"><td id="c42e1d5d"><p id="aa2d732c">网络路径</p></td><td id="aa41bd21"><p id="2c9201c4">专案</p></td></tr><tr id="0ccc5311" class="ijRowEven"><td id="caae6b54"><p id="8e8457b5">dotnet运行配置</p></td><td id="e25014af"><p id="1091bef3">组态</p></td></tr><tr id="daf753cf" class="ijRowOdd"><td id="b1fb4d44"><p id="5aad8d93">dotnet运行框架</p></td><td id="2a2e577c"><p id="d638615d">构架</p></td></tr><tr id="3497bd24" class="ijRowEven"><td id="20067311"><p id="e941f366">dotnet-run-runtime</p></td><td id="acfc41eb"><p id="f6ae0ecb">运行</p></td></tr></tbody></table></div></div><a name="dotnettest"></a><a name="dotnet-test"></a><div class="chapter"><h4 id="UpgradingDSL-dotnettest">网络测试</h4><div class="table-wrapper"><table width="100%" id="025ef34a"><thead><tr id="1601e26f" class="ijRowHead"><th id="0010bc1b"><p id="53e14da4">2017.1</p></th><th id="0828550e"><p id="a27c81ad">2017.2</p></th></tr></thead><tbody><tr id="b946a075" class="ijRowOdd"><td id="ae2ca0b5"><p id="eb55fccb">网络路径</p></td><td id="edf77e2e"><p id="61260c2d">专案</p></td></tr><tr id="3316f73f" class="ijRowEven"><td id="7743ab5d"><p id="38636c9c">dotnet测试配置</p></td><td id="035ae6a6"><p id="092a9bd3">组态</p></td></tr><tr id="39699103" class="ijRowOdd"><td id="c0327c22"><p id="b97135c4">点网测试框架</p></td><td id="87e93151"><p id="a07d0c98">构架</p></td></tr><tr id="1af45793" class="ijRowEven"><td id="780c37f1"><p id="9f8069c3">dotnet测试没有建立</p></td><td id="3110ea64"><p id="c9fe5cc7">skipBuild</p></td></tr><tr id="41fc4ae4" class="ijRowOdd"><td id="4723d90f"><p id="3d6e9de4">点网测试输出</p></td><td id="5fb416fc"><p id="7a4fcbf9">outputDir</p></td></tr><tr id="24f689ca" class="ijRowEven"><td id="d2183c8c"><p id="85e07f7e">dotnet测试设置文件</p></td><td id="24771cd4"><p id="b1acfc8d">settings文件</p></td></tr><tr id="7f6e4e9d" class="ijRowOdd"><td id="c1a36bd2"><p id="82e0fd5b">dotnet测试运行时</p></td><td id="3fec4eb1"><p id="a67daa90">运行</p></td></tr><tr id="cf048b9c" class="ijRowEven"><td id="b73baec5"><p id="0f7a646f">dotnet测试案例测试过滤器</p></td><td id="20d91ddb"><p id="9f596018">过滤</p></td></tr></tbody></table></div></div><a name="dotnetvstest"></a><a name="dotnet-vstest"></a><div class="chapter"><h4 id="UpgradingDSL-dotnetvstest">dotnet vstest</h4><div class="table-wrapper"><table class=" wide" width="100%" id="57508119"><thead><tr id="1b6d81b0" class="ijRowHead"><th id="54717377"><p id="3f77c197">2017.1</p></th><th id="45cf9204"><p id="c7df9bba">2017.2</p></th><th id="5a189fd5"><p id="c63a6b3c">评论</p></th></tr></thead><tbody><tr id="ceb259cf" class="ijRowOdd"><td id="eda74db3"><p id="9235e094">网络路径</p></td><td id="35f07ec6"><p id="e5b325c2">组件</p></td><td id="ea185f7f"></td></tr><tr id="0b5575ee" class="ijRowEven"><td id="6f756c21"><p id="3b5190f9">dotnet-vstest-config-file</p></td><td id="413f7cae"><p id="45551bf1">settings文件</p></td><td id="b08a27a5"></td></tr><tr id="bc860922" class="ijRowOdd"><td id="07792008"><p id="eff7666e">dotnet-vstest-framework</p></td><td id="698cee62"><p id="44f911b5">构架</p></td><td id="796a4868"></td></tr><tr id="a89145bb" class="ijRowEven"><td id="b5f1d291"><p id="88bfe78e">dotnet-vstest-platform</p></td><td id="ebd5f08e"><p id="69fd56c6">平台</p></td><td id="99e0d433"></td></tr><tr id="bbc60dc3" class="ijRowOdd"><td id="2cf699c0"><p id="1239f82c">dotnet-vstest-filter-type</p></td><td id="3a4e4f00"><p id="341342c7">过滤</p></td><td id="7f35d552"><p id="b753ebb5">要按名称过滤测试，请使用<code class="code">name { names = "..." }</code> ;对于测试用例过滤器，使用<code class="code">filter { filter = "..." }</code></p></td></tr><tr id="bc3d6b3e" class="ijRowEven"><td id="e8d93bc4"><p id="f0ef8bc8">dotnet-vstest-is-isolation</p></td><td id="53692108"><p id="b14e5ec8">--</p></td><td id="373a6ddb"><p id="5222f409">应该添加为<code class="code">/InIsolation</code>论点</p></td></tr></tbody></table></div><p id="c9845c75"><a name="dsl20171 "></a><a name="UpgradingDSL-dsl20171 "></a></p></div></div></div><a name="UpdateDSLfrom10.0.xto2017.1.x"></a><a name="Update-DSL-from-10.0.x-to-2017.1.x"></a><div class="chapter"><h2 id="UpgradingDSL-UpdateDSLfrom10.0.xto2017.1.x">将DSL从10.0.x更新到2017.1.x</h2><p id="45385660">TeamCity 2017.1没有引入新的Kotlin DSL API，使用与TeamCity 10.0.x中相同的软件包（ <code class="code">jetbrains.buildServer.configs.kotlin.v10</code> ）。现有的API中添加了几个新属性；获取用于脚本开发的最新API，请进行更新<code class="code">teamcity.dsl.version</code>在<code class="code">pom.xml</code>到<code class="code">2017.1-SNAPSHOT</code>用于EAP版本和<code class="code">2017.1</code>用于发布版本。</p><a name="ChangesrequiringmanualKotlinDSLscriptsupdate"></a><a name="Changes-requiring-manual-Kotlin-DSL-scripts-update"></a><div class="chapter"><h3 id="UpgradingDSL-ChangesrequiringmanualKotlinDSLscriptsupdate">需要手动Kotlin DSL脚本更新的更改</h3><p id="a46dff85">在启用TeamCity升级的项目中启用版本化设置之前，应执行以下更改，并显示以下消息：“由于在TeamCity升级期间修改了其设置文件，因此在此项目中禁用了版本设置”。</p><a name="Convertingcloudprofiles"></a><a name="Converting-cloud-profiles"></a><div class="chapter"><h4 id="UpgradingDSL-Convertingcloudprofiles">转换云配置文件</h4><p id="4ae0bee3">仅当您将Kotlin DSL用于Root项目设置并具有云配置文件时，这才有意义。<br>在2017.1中，云配置文件已从服务器级别移至Root项目级别。由于未在Kotlin DSL中定义它们，因此如果启用了版本设置，则现有的云配置文件将从服务器中删除。因此，在继续将Kotlin DSL用于服务器上的根项目之前，请确保将云配置文件定义添加到Kotlin DSL中的根项目设置。</p><p id="16a3a3d4">要使用云配置文件信息更新设置，请执行以下操作：</p><ol class="list _decimal"><li class="list__item" id="89c4959a"><p>在Root项目中运行<b id="1497b77d">“以Kotlin格式下载设置</b> ”操作，并使用生成的DSL保存zip文件</p></li><li class="list__item" id="74ee242a"><p>复制类型的项目特征<code class="code">CloudIntegration</code>和<code class="code">CloudProfile</code>来自<code class="code">.teamcity/_Root/Project.kt</code>文件到您设置中的根项目配置</p></li><li class="list__item" id="49459b66"><p>提交对VCS的更改</p></li><li class="list__item" id="7b52a69d"><p>在<b id="10cd20b3">“</b>根”项目的“ <b id="10cd20b3">版本设置”</b>选项卡上启用版本设置。</p></li></ol></div><a name="Namesinentities"></a><a name="Names-in-entities"></a><div class="chapter"><h4 id="UpgradingDSL-Namesinentities">实体名称</h4><p id="f2339798">由于<a href="https://youtrack.jetbrains.com/issue/TW-48609" rel="noopener noreferrer" data-external="true" target="_blank">问题TW-48609</a>的修复，如果您的设置包含无名实体，TeamCity将报告相应的VCS设置错误。您需要为此类实体手动设置名称参数以解决错误。</p></div></div><a name="UpdatingKotlinDSLconfigsversionto10.0to2017.1"></a><a name="Updating-Kotlin-DSL-configs-version-to-10.0-to-2017.1"></a><div class="chapter"><h3 id="UpgradingDSL-UpdatingKotlinDSLconfigsversionto10.0to2017.1">将Kotlin DSL配置版本更新为10.0至2017.1</h3><p id="c096e8a5">本节中的更改应在将<a href="#Configs-version">脚本配置版本</a>从10.0更改为2017.1时对Kotlin脚本进行</p><p id="62a8be48"><a name="dslConverter794"></a><a name="UpgradingDSL-dslConverter794"></a></p><a name="UpdatingDotCoverparameters"></a><a name="Updating-DotCover-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingDotCoverparameters">更新DotCover参数</h4><p id="09494023">DotCover使用的参数已更改，如果使用它们，请确保<code class="code">dotNetCoverage.tool</code>有<code class="code">dotcover</code>值。如果<code class="code">dotNetCoverage.dotCover.home.path</code>参数丢失，将其设置为<code class="code">%teamcity.tool.JetBrains.dotCover.CommandLineTools.bundled%</code> 。结果应如下所示：</p><div class="code-block" data-lang="none">param（“ dotNetCoverage.tool”，“ dotcover”）param（“ dotNetCoverage.dotCover.home.path”，“％teamcity.tool。JetBrains.dotCover。CommandLineTools.bundled％“）</div><p id="be816fab">如果您将DotCover与自定义路径一起使用（例如， <code class="code">/custom/path</code> ），则结果应如下所示：</p><div class="code-block" data-lang="none">param（“ dotNetCoverage.tool”，“ dotcover”）param（“ dotNetCoverage.dotCover.home.path”，“ / custom / path”）</div></div><a name="UpdatingMavenbuildstepparameters"></a><a name="Updating-Maven-build-step-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingMavenbuildstepparameters">更新Maven构建步骤参数</h4><p id="14ab486d">如果您使用没有原始参数的类型化Maven DSL，则此更改不应影响您，因为类型化DSL会生成最新设置。</p><p id="e9d3428b">如果您通过指定maven构建运行器设置<code class="code">param("name", "value")</code>方法，则需要更新参数。更新设置的最简单方法是切换到类型化的DSL：您可以以Kotlin格式生成设置，以查看用于Maven的类型化DSL的外观。</p><p id="33c5d302">如果您想继续使用<code class="code">param("name", "value")</code>方法，请执行以下操作：</p><ul class="list _ul"><li class="list__item" id="a38bd7dc"><p>重命名<code class="code">mavenSelection</code>参数<code class="code">maven.path</code> ，将其旧值更改为新值：</p></li></ul><div class="table-wrapper"><table width="100%" id="7b03e278"><thead><tr id="44da777a" class="ijRowHead"><th id="63f1b1cf"><p id="ecef333b">待更改的旧值</p></th><th id="b520d2f6"><p id="8026b5f5">新价值</p></th></tr></thead><tbody><tr id="85134db2" class="ijRowOdd"><td id="f802cbee"><p id="1f7eec3f"><code class="code">mavenSelection:bundledM2</code></p></td><td id="debea464"><p id="af1d2177"><code class="code">%teamcity.tool.maven%</code></p></td></tr><tr id="9164e451" class="ijRowEven"><td id="90cb08df"><p id="f37f751b"><code class="code">mavenSelection:bundledM3_0</code></p></td><td id="b6ba19c2"><p id="d6fb309f"><code class="code">%teamcity.tool.maven3%</code></p></td></tr><tr id="731f766c" class="ijRowOdd"><td id="61236775"><p id="c3cdd007"><code class="code">mavenSelection:bundledM3_1</code></p></td><td id="bf9697a8"><p id="ae633943"><code class="code">%teamcity.tool.maven3_1%</code></p></td></tr><tr id="e9ecf439" class="ijRowEven"><td id="f68a69b0"><p id="c84795d7"><code class="code">mavenSelection:bundledM3_2</code></p></td><td id="b03aa9f5"><p id="c371af78"><code class="code">%teamcity.tool.maven3_2%</code></p></td></tr><tr id="16bd645b" class="ijRowOdd"><td id="f6621851"><p id="10937060"><code class="code">mavenSelection:bundledM3_3</code></p></td><td id="2b68aa2e"><p id="92624aa2"><code class="code">%teamcity.tool.maven3_3%</code></p></td></tr><tr id="312a08fd" class="ijRowEven"><td id="1639f66b"><p id="f70f6131"><code class="code">mavenSelection:default</code></p></td><td id="fd952bb7"><p id="a13fa36e"><code class="code">%teamcity.tool.maven.AUTO%</code></p></td></tr><tr id="fd931f70" class="ijRowOdd"><td id="79a05664"><p id="67e3d8bd"><code class="code">mavenSelection:custom</code></p></td><td id="92a8b7e0"><p id="b792316d">的价值<code class="code">maven.home</code>参数</p></td></tr></tbody></table></div><ul class="list _ul"><li class="list__item" id="f026662b"><p>去除<code class="code">maven.home</code>参数。</p></li></ul></div><a name="UpdatingPowerShellbuildstepparameters"></a><a name="Updating-PowerShell-build-step-parameters"></a><div class="chapter"><h4 id="UpgradingDSL-UpdatingPowerShellbuildstepparameters">更新PowerShell构建步骤参数</h4><p id="ee2da2b3">TeamCity 2017.1添加了对跨平台PowerShell的支持。以前，PowerShell构建仅使用桌面版，并且仅在Windows上运行。</p><p id="f69311e2">为确保现有版本仍限于桌面版PowerShell，请在现有PowerShell步骤中设置以下属性：</p><div class="code-block" data-lang="none">版本= PowerShellStep。版。桌面</div><p id="32b9357f">或者，如果您使用原始参数：</p><div class="code-block" data-lang="none">参数（“ jetbrains_powershell_edition”，“桌面”）</div><hr id="82f8c1bc"></div></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>