<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>构建代理配置-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Build Agent Configuration" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/installation.md|Installation/setting-up-and-running-additional-build-agents.md|Setting up and Running Additional Build Agents/build-agent-configuration.md|Build Agent Configuration" data-main-title="Build Agent Configuration" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/build-agent-configuration.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="build-agent-configuration.md" data-toc="Build Agent Configuration">构建代理配置</h1><p id="93d7adbd">在此页：</p><p id="ba2c8caf"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#BuildAgentConfiguration-GeneralAgentConfiguration">通用代理配置</a></li><li class="list__item"><a href="#BuildAgentConfiguration-OptionalProperties">可选属性</a></li><li class="list__item"><a href="#BuildAgentConfiguration-SetupAgentbehindProxy">在代理后面设置代理</a></li></ul><p></p><p id="adde4551">构建代理的配置设置存储在<code class="code"><TeamCity Agent Home>/conf/buildagent.properties</code>文件。</p><a name="GeneralAgentConfiguration"></a><a name="General-Agent-Configuration"></a><div class="chapter"><h2 id="BuildAgentConfiguration-GeneralAgentConfiguration">通用代理配置</h2><p id="4fe4773d">配置文件可以存储将作为<b id="c20dfaf8">代理属性</b>发布在服务器上的<b id="c20dfaf8">属性，</b>并且可以参与<a href="agent-requirements.html">代理要求</a>表达式。文件中定义的所有<a href="predefined-build-parameters.html#Agent-Properties">系统和环境属性</a>都将传递给在代理上运行的每个构建。</p><p id="308a54dc">该文件是<a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream)" rel="noopener noreferrer" data-external="true" target="_blank">Java属性</a>文件。</p><p id="05b619cf">快速指南是：</p><ul class="list _ul"><li class="list__item" id="345cfc83"><p>使用<code class="code">property_name=value<newline></code>句法</p></li><li class="list__item" id="7fbcfb32"><p>使用<code class="code">#</code>在该行的第一个位置进行评论</p></li><li class="list__item" id="5f5134b3"><p>使用<code class="code">/</code>代替<code class="code">\</code>作为路径分隔符。如果您需要包括<code class="code">\</code>用另一个逃避<code class="code">\</code> 。</p></li><li class="list__item" id="01831743"><p>行内的空白</p></li></ul><p id="f5c85bb5">文件示例：</p><div class="code-block" data-lang="bash">## TeamCity服务器的地址。与在浏览器中打开TeamCity Web界面相同。##请注意，建议使用https：// serverUrl = http：// localhost：8111 / ##用于在TeamCity服务器上标识此代理的代理的唯一名称##使用空白名称让服务器生成它。##默认情况下，将从构建代理的主机名name = Default agent ## Container目录创建此名称，以为构建配置创建默认检出目录。workDir = .. / work ##临时目录的容器目录。##请注意，在两次构建之间可能会清理目录。tempDir = .. / temp ##代理状态文件和缓存的容器目录。## TeamCity代理承担目录的所有权，可以删除其中的内容。systemDir = .. / system ####################################＃可选的代理属性＃＃ ####################################令牌，用于识别代理TeamCity服务器用于代理授权。##它是自动生成的，并保存在与服务器的第一个代理连接上。authorizationToken = 1234567890abcdefghijklml</div><aside class="note " rel="48f9957d" id="8efd1791" data-title=""><p id="6acfb4dc">确保该文件对于构建代理进程本身是可写的。例如，文件被更新以存储其在服务器端生成的授权令牌。</p></aside><p id="71a1ba78">如果<code class="code">name</code>如果未指定property，则服务器将自动生成一个构建代理名称。默认情况下，将从构建代理的主机名创建此名称。</p><p id="cf91695d">代理程序运行时可以编辑该文件：代理程序检测到更改，并且（在完成正在运行的构建时，如果有的话）重新启动并自动加载新设置。</p></div><a name="OptionalProperties"></a><a name="Optional-Properties"></a><div class="chapter"><h2 id="BuildAgentConfiguration-OptionalProperties">可选属性</h2><p id="60b6d2f6">如果更改了默认轮询协议以支持服务器和代理之间的传统<a href="setting-up-and-running-additional-build-agents.html#Bidirectional-Communication">双向通信</a> ，则服务器必须能够打开与代理的HTTP连接。</p><p id="01cdb092">通过以下方式确定TeamCity构建代理启动的端口以及侦听来自服务器的传入数据的端口。 <code class="code">ownPort</code>属性（默认为9090）。如果配置了防火墙，请确保在代理计算机上允许该端口的传入连接。</p><div class="code-block" data-lang="bash">ownPort = 9090</div><aside class="tip sideblock" rel="c9e6fa38" id="205bbce3" data-title=""><p id="e4fdeb61">如果同一台计算机上托管多个构建代理，则必须通过以下方式将不同的端口分配给它们： <code class="code">ownPort</code>物业<code class="code">buildAgent.properties</code>每个代理的文件。</p></aside><p id="6e0c42d7">当代理首次连接到TeamCity时，服务器会自动检测TeamCity服务器用于连接到构建代理的IP地址，除非定义了ownAddress属性。如果机器具有多个网络接口，则自动检测可能会失败，建议您指定<code class="code">ownAddress</code>属性：</p><div class="code-block" data-lang="bash">ownAddress = <own name="" ip="" address="" or="" server-accessible="" domain="">

</own></div></div><a name="SetupAgentbehindProxy"></a><a name="Set-up-Agent-behind-Proxy"></a><div class="chapter"><h2 id="BuildAgentConfiguration-SetupAgentbehindProxy">在代理后面设置代理</h2><p id="b507d953">从TeamCity 2017.1开始，可以为代理到服务器的连接配置正向代理服务器。</p><a name="agent-proxy-server"></a><p id="b553513f">在TeamCity代理端，使用以下属性指定代理以连接到TeamCity服务器： <a href=""><code class="code">buildAgent.properties</code></a>文件：</p><div class="code-block" data-lang="bash">##代理主机的域名或IP地址以及端口teamcity.http.proxyHost = 123.45.678.9 teamcity.http.proxyPort = 8080 ##如果代理服务器需要身份验证，请指定登录名和密码teamcity.http.proxyLogin =登录teamcity.http.proxyPassword =密码</div><p id="a47017e6">请注意，必须将代理配置为不缓存任何TeamCity服务器响应。例如，如果您使用Squid，则将“ cache deny all”行添加到<code class="code">squid.conf</code>文件。</p><hr id="4dd95b1d"><p id="29fac2c6"><b id="ca428656">也可以看看：</b></p><p id="2656be20"><b id="0559e714">概念</b> ： <a href="build-agent.html">生成代理</a><br><b id="5be06e1c">管理员指南</b> ： <a href="predefined-build-parameters.html">预定义的构建参数</a> | <a href="configuring-agent-requirements.html">配置代理要求</a> | <a href="configuring-build-parameters.html">配置构建参数</a></p><hr id="0072f35b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>