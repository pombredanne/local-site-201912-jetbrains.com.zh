<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Docker-帮助|帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Docker" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/docker.md|Docker" data-main-title="Docker" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/docker.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="docker.md" data-toc="Docker">码头工人</h1><p id="cc568aa8">TeamCity带有内置的<a href="integrating-teamcity-with-docker.html">Docker集成</a> ，其中包括Docker运行器（以前称为Docker Build），它是Docker命令的运行器。</p><a name="reqs-supported-env"></a><a name="SupportedEnvironments"></a><a name="Supported-Environments"></a><div class="chapter"><h2 id="Docker-SupportedEnvironments">支持的环境</h2><p id="0f1f1aae">TeamCity Docker支持可以在Mac，Linux和Windows构建代理上运行。它使用<code class="code">docker</code>可执行文件在构建代理机器上，因此它应该可由构建代理用户运行。</p><aside class="note " rel="0f1f1aae" id="7bcaf97b" data-title=""><ul class="list _ul"><li class="list__item" id="2405cb58"><p>在Linux上，如果检测到已安装的Docker，则集成将运行。</p></li><li class="list__item" id="434c4bda"><p>在Windows上，该集成适用于Linux和Windows容器模式。</p></li><li class="list__item" id="f91004dc"><p>在macOS上，应该为运行构建代理的用户安装对<a href="https://docs.docker.com/docker-for-mac/install/" rel="noopener noreferrer" data-external="true" target="_blank">Mac</a>的官方<a href="https://docs.docker.com/docker-for-mac/install/" rel="noopener noreferrer" data-external="true" target="_blank">Docker支持</a> 。</p></li></ul></aside><a name="docker-runner"></a><p id="25879ef5">Docker运行程序支持<code class="code">build</code> ， <code class="code">push</code>和<code class="code">tag</code> Docker命令。</p><p id="d675c98a">从存储库URL创建TeamCity项目/构建配置时，如果VCS存储库中存在Dockerfile，则会在自动检测过程中将运行器作为构建步骤提供。</p></div><a name="DockerCommand"></a><a name="Docker-Command"></a><div class="chapter"><h2 id="Docker-DockerCommand">Docker命令</h2><a name="docker-command"></a><p id="a710e844">这是Docker命令的列表。根据选择的命令，以下设置将有所不同。</p><div class="table-wrapper"><table class=" wide" width="100%" id="1a8d73b5"><thead><tr id="3c2cad13" class="ijRowHead"><th id="de7027d1"><p id="5fbe2394">命令</p></th><th id="9dd325ad"><p id="fac306ac">参数</p></th><th id="37eff9f7"><p id="b0767414">描述</p></th></tr></thead><tbody><tr id="8db09ab3" class="ijRowOdd"><td rowspan="8" id="0f3c9177"><p id="581510c4">建立</p></td><td id="462c958e"><p id="df31f944">Dockerfile源</p></td><td id="2a1568e7"><p id="97102051">根据选择的来源，以下设置将有所不同。可用选项包括文件，URL或文件内容。</p></td></tr><tr id="85486288" class="ijRowEven"><td id="baf99e4b"><p id="446b4d73">文件路径</p></td><td id="45382787"><p id="49d82161"><i id="8a4b4aca">如果选择文件作为源，则可用</i> 。指定Docker文件的路径。该路径应相对于<a href="build-checkout-directory.html">checkout目录</a> 。</p></td></tr><tr id="763f16da" class="ijRowOdd"><td id="004e4bb8"><p id="ffb318d9">上下文文件夹</p></td><td id="e4657bc7"><p id="d7b3c444"><i id="6e962540">如果选择文件作为源，则可用</i> 。指定Docker构建的上下文。如果为空，将使用Dockerfile的封闭文件夹。</p></td></tr><tr id="02eff51f" class="ijRowEven"><td id="5ca46c7f"><p id="f9fe2c02">档案网址</p></td><td id="c0136694"><p id="df5d0b34"><i id="85c81efe">如果选择URL作为源，则可用</i> 。该URL可以引用三种资源：Git存储库，预打包的tarball上下文和纯文本文件。有关详细信息，请参阅<a href="https://docs.docker.com/engine/reference/commandline/build/#extended-description" rel="noopener noreferrer" data-external="true" target="_blank">Docker文档</a> 。</p></td></tr><tr id="4aeabcb7" class="ijRowOdd"><td id="5df924e7"><p id="24219b71">文件内容</p></td><td id="a568be45"><p id="4fa75fc5"><i id="07154d6f">如果文件cis选择为源，则可用</i> 。您可以在字段中输入Dockerfile的内容。</p></td></tr><tr id="6f22d291" class="ijRowEven"><td id="0f0950c7"><p id="c847dfa9">影像平台</p></td><td id="8456e5d3"><p id="9c8d3365">选择<any>（默认），Linux或Windows。</any></p></td></tr><tr id="3714e469" class="ijRowOdd"><td id="98594916"><p id="3d07144d">图片名称：标签</p></td><td id="9f764225"><p id="5d891532">提供以换行符分隔的图像名称列表：标签</p></td></tr><tr id="3f3d89ef" class="ijRowEven"><td id="ae3a5ada"><p id="4a38df9a">的其他参数<code class="code">build</code>命令</p></td><td id="f8f361ed"><p id="2dd86ef7">向docker build命令提供其他参数。有关详细信息，请参见<a href="https://docs.docker.com/engine/reference/commandline/build/" rel="noopener noreferrer" data-external="true" target="_blank">Docker文档</a> 。</p></td></tr><tr id="79bef94c" class="ijRowOdd"><td rowspan="2" id="2098f24b"><p id="11398629">推</p></td><td id="ab6548de"><p id="a57e07bd">推送后从代理删除图像</p></td><td id="98694890"><p id="8b842546">如果选择，TeamCity将使用<code class="code">docker rmi</code>在步骤结束时</p></td></tr><tr id="571950a7" class="ijRowEven"><td id="586b4157"><p id="0e315031">图片名称：标签</p></td><td id="549a3b33"><p id="e3f205a7">提供以换行符分隔的图像名称列表：标签</p></td></tr><tr id="c7aa82ad" class="ijRowOdd"><td rowspan="3" id="8a00ff87"><p id="b081d81e">其他</p></td><td id="7e613d8f"><p id="513f8dc7">指令名称</p></td><td id="0cae8fc8"><p id="7d17267c">Docker子命令，例如<code class="code">push</code>要么<code class="code">tag</code> 。要运行，请使用<a href="docker-wrapper.html">Docker Wrapper</a></p></td></tr><tr id="3b0a19ec" class="ijRowEven"><td id="1840da8c"><p id="c8228c7a">工作目录</p></td><td id="7948be60"></td></tr><tr id="79e1ce98" class="ijRowOdd"><td id="e29495a0"><p id="bcc55444">命令的其他参数</p></td><td id="cd8dbcdd"><p id="d35569d5">将传递给Docker命令的其他参数。</p></td></tr></tbody></table></div><a name="RunningDockerviasudo"></a><a name="Running-Docker-via-sudo"></a><h4 id="Docker-RunningDockerviasudo">通过sudo运行Docker</h4><p id="6c3095d7"><b id="c467b560">从TeamCity 2019.1.2开始</b> ，您可以通过以下方式在TeamCity代理上强制启动Docker命令<code class="code">sudo</code> 。添加<code class="code">teamcity.docker.use.sudo=true</code>设置在<a href="build-agent-configuration.html">构建代理配置文件中</a>或作为代理的系统属性。在代理启动时，TeamCity代理日志将通知您<code class="code">sudo</code>前缀用于运行Docker命令。</p><p id="f06f4e41">配置<code class="code">sudoers</code>的档案<code class="code">sudo</code>命令，使用<a href="https://www.sudo.ws/man/1.8.17/visudo.man.html" rel="noopener noreferrer" data-external="true" target="_blank">visudo</a>如下：</p><div class="code-block" data-lang="bash">buildagentuser ALL =（全部）NOPASSWD：SETENV： <full_path_to_docker>

</full_path_to_docker></div><p id="f34851cd">我们建议删除（或注释掉） <code class="code">Defaults requiretty</code>从的行<code class="code">sudoers</code>文件以防止<a href="https://youtrack.jetbrains.com/issue/TW-60990" rel="noopener noreferrer" data-external="true" target="_blank">docker login问题</a> 。</p><hr id="b41ce6ba"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>