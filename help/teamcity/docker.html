<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Docker - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Docker" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/docker.md|Docker" data-main-title="Docker" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/docker.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Docker" id="docker.md">Docker</h1><p id="cc568aa8">TeamCity comes with built-in <a href="integrating-teamcity-with-docker.html">Docker integration</a>, which includes the Docker runner (formerly Docker Build), a runner for Docker commands.</p><a name="reqs-supported-env"></a><a name="SupportedEnvironments"></a><a name="Supported-Environments"></a><div class="chapter"><h2 id="Docker-SupportedEnvironments">Supported Environments</h2><p id="0f1f1aae">TeamCity Docker Support can run on Mac, Linux, and Windows build agents. It uses the <code class="code">docker</code> executable on the build agent machine, so it should be runnable by the build agent user.</p><aside class="note " data-title="" rel="0f1f1aae" id="7bcaf97b"><ul class="list _ul"><li class="list__item" id="2405cb58"><p>On Linux, the integration will run if the installed Docker is detected.</p></li><li class="list__item" id="434c4bda"><p>On Windows, the integration works for Linux and Windows container modes.</p></li><li class="list__item" id="f91004dc"><p>On macOS, the official <a href="https://docs.docker.com/docker-for-mac/install/" data-external="true" target="_blank" rel="noopener noreferrer">Docker support for Mac</a> should be installed for the user running the build agent.</p></li></ul></aside><a name="docker-runner"></a><p id="25879ef5">The Docker runner supports the <code class="code">build</code>, <code class="code">push</code>, and <code class="code">tag</code> Docker commands.</p><p id="d675c98a">When creating TeamCity projects / build configurations from a repository URL, the runner is offered as build step during auto-detection, provided a Dockerfile is present in the VCS repository.</p></div><a name="DockerCommand"></a><a name="Docker-Command"></a><div class="chapter"><h2 id="Docker-DockerCommand">Docker Command</h2><a name="docker-command"></a><p id="a710e844">Here is the list of the Docker commands. Depending on the selected command, the settings below will vary.</p><div class="table-wrapper"><table class=" wide" width="100%" id="1a8d73b5"><thead><tr id="3c2cad13" class="ijRowHead"><th id="de7027d1"><p id="5fbe2394">Command</p></th><th id="9dd325ad"><p id="fac306ac">Parameter</p></th><th id="37eff9f7"><p id="b0767414">Description</p></th></tr></thead><tbody><tr id="8db09ab3" class="ijRowOdd"><td rowspan="8" id="0f3c9177"><p id="581510c4">build</p></td><td id="462c958e"><p id="df31f944">Dockerfile source</p></td><td id="2a1568e7"><p id="97102051">Depending on the selected source, the settings below will vary. The available options include File, a URL or File content.</p></td></tr><tr id="85486288" class="ijRowEven"><td id="baf99e4b"><p id="446b4d73">Path to file</p></td><td id="45382787"><p id="49d82161"><i id="8a4b4aca">Available if File is selected as the source</i>. Specify the path to the Docker file. The path should be relative to the <a href="build-checkout-directory.html">checkout directory</a>.</p></td></tr><tr id="763f16da" class="ijRowOdd"><td id="004e4bb8"><p id="ffb318d9">Context folder</p></td><td id="e4657bc7"><p id="d7b3c444"><i id="6e962540">Available if File is selected as the source</i>. Specify the context for the Docker build. If blank, the enclosing folder for Dockerfile will be used.</p></td></tr><tr id="02eff51f" class="ijRowEven"><td id="5ca46c7f"><p id="f9fe2c02">URL to file</p></td><td id="c0136694"><p id="df5d0b34"><i id="85c81efe">Available if URL is selected as the source</i>. The URL can refer to three kinds of resources: Git repositories, pre-packaged tarball contexts, and plain text files. See the <a href="https://docs.docker.com/engine/reference/commandline/build/#extended-description" data-external="true" target="_blank" rel="noopener noreferrer">Docker documentation</a> for details.</p></td></tr><tr id="4aeabcb7" class="ijRowOdd"><td id="5df924e7"><p id="24219b71">File Content</p></td><td id="a568be45"><p id="4fa75fc5"><i id="07154d6f">Available if the file cis selected as the source</i>. You can enter the content of the Dockerfile into the field.</p></td></tr><tr id="6f22d291" class="ijRowEven"><td id="0f0950c7"><p id="c847dfa9">Image platform</p></td><td id="8456e5d3"><p id="9c8d3365">Select &lt;Any&gt; (default), Linux or Windows.</p></td></tr><tr id="3714e469" class="ijRowOdd"><td id="98594916"><p id="3d07144d">Image name:tag</p></td><td id="9f764225"><p id="5d891532">Provide a newline-separated list of image name:tag(s)</p></td></tr><tr id="3f3d89ef" class="ijRowEven"><td id="ae3a5ada"><p id="4a38df9a">Additional arguments for the <code class="code">build</code> command</p></td><td id="f8f361ed"><p id="2dd86ef7">Supply additional arguments to the docker build command. See <a href="https://docs.docker.com/engine/reference/commandline/build/" data-external="true" target="_blank" rel="noopener noreferrer">Docker documentation</a> for details.</p></td></tr><tr id="79bef94c" class="ijRowOdd"><td rowspan="2" id="2098f24b"><p id="11398629">push</p></td><td id="ab6548de"><p id="a57e07bd">Remove image from agent after push</p></td><td id="98694890"><p id="8b842546">If selected, TeamCity will remove the image with <code class="code">docker rmi</code> at the end of the step</p></td></tr><tr id="571950a7" class="ijRowEven"><td id="586b4157"><p id="0e315031">Image name:tag</p></td><td id="549a3b33"><p id="e3f205a7">Provide a newline-separated list of image name:tag(s)</p></td></tr><tr id="c7aa82ad" class="ijRowOdd"><td rowspan="3" id="8a00ff87"><p id="b081d81e">other</p></td><td id="7e613d8f"><p id="513f8dc7">Command name</p></td><td id="0cae8fc8"><p id="7d17267c">Docker sub-command, like <code class="code">push</code> or <code class="code">tag</code>. For run, use <a href="docker-wrapper.html">Docker Wrapper</a></p></td></tr><tr id="3b0a19ec" class="ijRowEven"><td id="1840da8c"><p id="c8228c7a">Working directory</p></td><td id="7948be60"></td></tr><tr id="79e1ce98" class="ijRowOdd"><td id="e29495a0"><p id="bcc55444">Additional arguments for the command</p></td><td id="cd8dbcdd"><p id="d35569d5">Additional arguments that will be passed to the Docker command.</p></td></tr></tbody></table></div><a name="RunningDockerviasudo"></a><a name="Running-Docker-via-sudo"></a><h4 id="Docker-RunningDockerviasudo">Running Docker via sudo</h4><p id="6c3095d7"><b id="c467b560">Since TeamCity 2019.1.2</b>, you can enforce starting Docker commands on a TeamCity agent via <code class="code">sudo</code>. Add the <code class="code">teamcity.docker.use.sudo=true</code> setting in the <a href="build-agent-configuration.html">build agent configuration file</a> or as an agent's system property. On an agent start, the TeamCity agent log will inform that the <code class="code">sudo</code> prefix is used to run Docker commands.</p><p id="f06f4e41">To configure the <code class="code">sudoers</code> file for the <code class="code">sudo</code> command, use <a href="https://www.sudo.ws/man/1.8.17/visudo.man.html" data-external="true" target="_blank" rel="noopener noreferrer">visudo</a> as follows:</p><div class="code-block" data-lang="bash">buildagentuser ALL=(ALL) NOPASSWD:SETENV:&lt;full_path_to_docker&gt;

</div><p id="f34851cd">We recommend removing (or commenting out) the <code class="code">Defaults requiretty</code> line from the <code class="code">sudoers</code> file to prevent the <a href="https://youtrack.jetbrains.com/issue/TW-60990" data-external="true" target="_blank" rel="noopener noreferrer">problem with docker login</a>.</p><hr id="b41ce6ba"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>