<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>PowerShell-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="PowerShell" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/powershell.md|PowerShell" data-main-title="PowerShell" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/powershell.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="powershell.md" data-toc="PowerShell">电源外壳</h1><p id="f7e17ec1"><i id="2e67c33a">PowerShell</i> <a href="build-runner.html">构建</a>运行器专门设计用于运行PowerShell脚本。</p><p id="411980ec">负责PowerShell集成的插件已<a href="https://github.com/JetBrains/teamcity-powershell" rel="noopener noreferrer" data-external="true" target="_blank">在GitHub上开源</a> 。</p><aside class="tip sideblock" rel="411980ec" id="5a572132" data-title=""><p id="0c819838">如果您需要使用提升的权限运行PowerShell脚本，请考虑使用TeamCity <a href="https://github.com/JetBrains/teamcity-runas-plugin" rel="noopener noreferrer" data-external="true" target="_blank">RunAs插件</a> 。</p></aside><p id="0642ca11">在此页：</p><p id="2c8937ec"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#PowerShell-Cross-PlatformPowerShell">跨平台PowerShell</a></li><li class="list__item"><a href="#PowerShell-DetectionofInstalledPowerShellonBuildAgents">检测Build Agent上已安装的PowerShell</a></li><li class="list__item"><a href="#PowerShell-PowerShellSettings">PowerShell设置</a></li><li class="list__item"><a href="#PowerShell-DockerSettings">Docker设置</a><ul class="list _bullet"><li class="list__item"><a href="#PowerShell-CurrentLimitations">电流限制</a></li></ul></li><li class="list__item"><a href="#PowerShell-InteractionwithTeamCity">与TeamCity的互动</a></li><li class="list__item"><a href="#PowerShell-ErrorHandling">错误处理</a></li><li class="list__item"><a href="#PowerShell-HandlingOutput">处理输出</a></li><li class="list__item"><a href="#PowerShell-TemporaryFiles">临时文件</a></li><li class="list__item"><a href="#PowerShell-DevelopmentLinks">开发链接</a></li></ul><p></p><a name="Cross-PlatformPowerShell"></a><a name="Cross-Platform-PowerShell"></a><div class="chapter"><h2 id="PowerShell-Cross-PlatformPowerShell">跨平台PowerShell</h2><ul class="list _ul"><li class="list__item" id="f7de07ed"><p>Windows，MacOS和Linux支持跨平台的PowerShell（ <a href="https://blogs.msdn.microsoft.com/powershell/2018/01/10/powershell-core-6-0-generally-available-ga-and-supported/" rel="noopener noreferrer" data-external="true" target="_blank">PowerShell Core</a> ）： <a href="https://github.com/PowerShell/PowerShell#get-powershell" rel="noopener noreferrer" data-external="true" target="_blank">下载</a>适用于您平台<a href="https://github.com/PowerShell/PowerShell#get-powershell" rel="noopener noreferrer" data-external="true" target="_blank">的PowerShell软件包</a>并将其安装在TeamCity代理上。</p></li><li class="list__item" id="49997593"><p>Windows下支持并行安装PowerShell桌面和PowerShell Core。</p></li></ul></div><a name="DetectionofInstalledPowerShellonBuildAgents"></a><a name="Detection-of-Installed-PowerShell-on-Build-Agents"></a><div class="chapter"><h2 id="PowerShell-DetectionofInstalledPowerShellonBuildAgents">检测Build Agent上已安装的PowerShell</h2><p id="aae0c449">在启动过程中，TeamCity代理在标准位置搜索PowerShell安装，例如<code class="code">Program Files</code>和<code class="code">Windows</code>目录。您可以在<code class="code">teamcity.powershell.detector.search.paths</code> <a href="predefined-build-parameters.html#Agent-Properties">agent属性</a> ，因此代理也可以在此目录（及其子目录）中检测PowerShell。<br>要列出多个位置，请使用<code class="code">;</code> 。</p></div><a name="PowerShellSettings"></a><a name="PowerShell-Settings"></a><div class="chapter"><h2 id="PowerShell-PowerShellSettings">PowerShell设置</h2><div class="table-wrapper"><table width="100%" id="50e709b4"><thead><tr id="f0b49dd3" class="ijRowHead"><th id="da7dede5"><p id="0b8141ba">选项</p></th><th id="9de14e52"><p id="444ecfcd">描述</p></th></tr></thead><tbody><tr id="6fc022e7" class="ijRowOdd"><td id="922ddb8c"><p id="838d0675">版</p></td><td id="6c0e6ede"><p id="c5b9106d">TeamCity支持的PowerShell版本列表。它被传递给<code class="code">powershell.exe</code>作为<code class="code">-Version</code>命令行参数。</p></td></tr><tr id="5d5e4483" class="ijRowEven"><td id="dea9a8fa"><p id="e9e697dc">PowerShell运行模式</p></td><td id="a7cd618c"><p id="29d97d6c">在x64机器上选择所需的执行模式：</p><p id="8ef0da83"><b id="148ae96a">版</b></p><p id="edcb3065">指定版本（例如1.0或2.0）。它将与代理上安装的版本进行比较，并将添加适当的要求。对于Core版本，它将用作下限。在桌面版上，将使用确切的版本（ <code class="code">-Version</code>命令行参数）。</p><p id="173586f5">如果版本字段为空，则不会添加版本要求的下限，否则<code class="code">-Version</code>参数将在PowerShell的桌面版本上使用。</p><p id="b2a17eb1"><b id="51365d30">平台</b></p><p id="689e5047">选择平台位数：</p><ul class="list _ul"><li class="list__item" id="7b8008c1"><p><code class="code">x64</code> -64位（默认），将添加相应的要求</p></li><li class="list__item" id="c3588f34"><p><code class="code">x86</code> -32位，将添加相应的要求</p></li><li class="list__item" id="4fdab91e"><p><code class="code">Auto</code> -选择该选项时，不会对构建配置添加任何平台要求，并且如果同时安装了32位和64位PowerShell，则将首选64位。</p></li></ul><p id="63d524a9"><b id="9feb199d">版</b></p><p id="95d09c72">选择要使用的PowerShell版本：（ <b id="67f91935">自TeamCity 2017.1开始</b> ）</p><ul class="list _ul"><li class="list__item" id="0a1eec35"><p>桌面-与Windows捆绑在一起的封闭源版本，仅在Windows平台上可用。</p></li><li class="list__item" id="8801528f"><p>Core-基于.NET Core的开源版本，跨平台，仅64位</p></li></ul></td></tr><tr id="ce5c4b6e" class="ijRowOdd"><td id="e6ae0fb3"><p id="3d00db73">将stderr输出的格式设置为：</p></td><td id="459a4a6d"><p id="2a4911ba">指定运行程序如何处理错误输出：</p><ul class="list _ul"><li class="list__item" id="8b2ce5d9"><p><b id="8d9b6cc0">错误</b> ：任何输出到<code class="code">stderr</code>被视为错误</p></li><li class="list__item" id="204a3054"><p><b id="21232347">警告</b> ：默认；任何输出到<code class="code">stderr</code>作为警告处理</p></li></ul><aside class="tip sideblock" rel="3ff51afc" id="4f5d77b2" data-title=""><p id="6c991d67">要在“构建运行程序记录了错误消息”的情况下使<a href="build-failure-conditions.html">构建失败</a> （请参阅<a href="build-failure-conditions.html">构建失败条件</a> ），请将错误输出选择器的默认设置从<b id="378dcf8b">警告</b>更改为<b id="6549c40b">错误</b> 。</p></aside></td></tr><tr id="f5a1368d" class="ijRowEven"><td id="5c6e3278"><p id="37005185">工作目录</p></td><td id="838e684f"><p id="42f22d00">指定<a href="build-working-directory.html">构建工作目录</a>的路径。</p></td></tr><tr id="f627e302" class="ijRowOdd"><td id="b9fb2944"><p id="448d14d1">脚本</p></td><td id="4469274a"><p id="7efc1245">选择是要在TeamCity中直接输入脚本，还是指定脚本的路径：</p><ul class="list _ul"><li class="list__item" id="be9d839f"><p><b id="22998691">文件</b> ：输入PowerShell文件的路径。该路径必须相对于checkout目录。</p></li><li class="list__item" id="f92fa87e"><p><b id="cfa89d43">源</b> ：输入PowerShell脚本源。请注意，TeamCity <a href="configuring-build-parameters.html#Using-Build-Parameters-in-Build-Configuration-Settings">参数引用</a>将在代码中替换。</p></li></ul><aside class="note " rel="3d014f68" id="509febc0" data-title=""><p id="92fa067e">当脚本包含显式定义的参数时，PowerShell 2.0无法返回正确的退出代码存在问题。<a href="https://youtrack.jetbrains.com/issue/TW-42996" rel="noopener noreferrer" data-external="true" target="_blank">解决方法</a>是，升级您的PowerShell或使用<code class="code">[Environment]::Exit(code)</code> 。</p></aside></td></tr><tr id="801a7f23" class="ijRowEven"><td id="01740724"><p id="033cd679">脚本执行模式</p></td><td id="1be093eb"><p id="e5931b21">指定PowerShell脚本执行模式。默认情况下，PowerShell可能不允许执行任意<code class="code">.ps1</code>文件。TeamCity将尝试提供<code class="code">-ExecutionPolicy ByPass</code>论点。如果您选择了<b id="8cae7fd0">从外部文件执行.ps1脚本</b> ，则应该对脚本进行签名，或者应使PowerShell允许任意执行<code class="code">.ps1</code>文件。如果执行策略不允许运行脚本，请选择“ <b id="f0ecabdf">将脚本置于PowerShell stdin</b>模式”以避免此问题。</p><p id="447d5eb8">的<code class="code">-Command</code>不建议使用该模式，不建议将其与版本大于1.0的PowerShell一起使用</p></td></tr><tr id="c7d37e91" class="ijRowOdd"><td id="25b2fc53"><p id="5b21659b">脚本参数</p></td><td id="60da290b"><p id="d0933105"><i id="c541d0e5">如果“脚本执行模式”选项设置为“从外部文件执行.ps1脚本”，则可用。</i></p><p id="7a3b8f96">指定要作为参数传递到PowerShell脚本的生成参数。<br>使用命名参数时，请遵循以下模式： <code class="code">-<script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>