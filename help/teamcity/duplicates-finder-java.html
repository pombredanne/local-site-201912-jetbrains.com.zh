<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>重复查找器（Java）-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="viewpage.actionpageId113084078" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/duplicates-finder-java.md|Duplicates Finder (Java)" data-main-title="Duplicates Finder (Java)" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/duplicates-finder-java.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="duplicates-finder-java.md" data-toc="viewpage.actionpageId113084078">重复查找器（Java）</h1><p id="066925dd"><b id="23f2e209">Duplicates Finder（Java）</b>构建运行程序旨在捕获相似的代码片段，并提供有关发现的Java代码重复块的报告。该运行程序基于IntelliJ IDEA功能，因此是IntelliJ IDEA项目文件（.ipr）或目录（ <code class="code">.idea</code> ）是配置运行器所必需的。<b id="91b0cbde">从TeamCity 2017.1开始</b> ，除了捆绑版本外，还可以安装其他版本的JetBrains IntelliJ Inspections and Duplicates Engine和/或使用<b id="01a1d3db"><a href="installing-agent-tools.html">管理|</a></b>更改默认值<b id="01a1d3db"><a href="installing-agent-tools.html">。工具</a></b>页面。</p><p id="5774ec66"><b id="f29df0b2">重复项查找器（Java）</b>也可以在Maven2或更高版本构建的项目中查找Java重复项。</p><aside class="note " rel="5774ec66" id="1c664fbf" data-title=""><p id="4d6f63f8">为了对项目进行检查，您应该具有IntelliJ IDEA项目文件（.ipr）/项目目录（ <code class="code">.idea</code> ），或项目的Maven2或更高版本pom.xml签入版本控件。</p></aside><p id="8e6e36c5">此页面包含有关以下“ <b id="3e377822">重复查找器（Java）</b>构建运行器”字段的参考信息：</p><ul class="list _links" data-skip-index="skip"></ul><a name="IntelliJIDEAProjectSettings"></a><a name="IntelliJ-IDEA-Project-Settings"></a><h3 id="DuplicatesFinder(Java)-IntelliJIDEAProjectSettings">IntelliJ IDEA项目设置</h3><div class="table-wrapper"><table width="100%" id="df5ea344"><thead><tr id="70300ef2" class="ijRowHead"><th id="47cc3445"><p id="31275a22">选项</p></th><th id="a111a046"><p id="559a9371">描述</p></th></tr></thead><tbody><tr id="fc4c91cc" class="ijRowOdd"><td id="632b33bc"><p id="2ddefe88">项目文件类型</p></td><td id="d3d650d6"><p id="d43b8b28">为了能够在代码上运行IntelliJ IDEA检查，TeamCity需要在此处指定IntelliJ IDEA项目文件\目录，Maven pom.xml或Gradle build.gradle。</p></td></tr><tr id="eabb8259" class="ijRowEven"><td id="faa0b383"><p id="cf6034e4">项目路径</p></td><td id="d447e0a0"><p id="4ed217ab">根据在<b id="1d828d00">项目文件类型中</b>选择的<b id="1d828d00">项目类型</b> ，在此处指定：</p><ul class="list _ul"><li class="list__item" id="00ea14a5"><p><b id="62ac404c">对于IntelliJ IDEA项目</b> ：项目文件（.ipr）的路径或项目目录的路径，即包含以下内容的项目的根目录<code class="code">.idea</code>夹）。</p></li><li class="list__item" id="5b5f6b1c"><p><b id="8861a639">对于Maven项目</b> ： <code class="code">pom.xml</code>文件。</p></li><li class="list__item" id="3a5f8596"><p><b id="487ef25b">对于Gradle项目</b> ： <code class="code">.gradle</code>文件。</p></li></ul><p id="eaa6a710">该构建跑步者需要此信息来了解项目的结构。</p><aside class="tip sideblock" rel="eaa6a710" id="91d54666" data-title=""><p id="cb126f51">指定的路径应相对于checkout目录。</p></aside></td></tr><tr id="016ca2ee" class="ijRowOdd"><td id="8d7b580b"><p id="dc6da1f5">在* .iml文件中检测全局库和基于模块的JDK</p></td><td id="4a41d03d"><p id="83b3a897"><i id="5c7d944d">如果您使用IntelliJ IDEA项目，则此选项可用。</i> 在IntelliJ IDEA中，模块设置存储在* .iml文件中，因此，如果选中此选项，则保存时将自动扫描所有模块文件以查找对全局库和模块JDK的引用。这有助于确保将正确解析所有引用。</p><aside class="warning " rel="83b3a897" id="0c26ad08" data-title=""><p id="f65f47d7">选择此选项时，打开和保存构建运行器设置的过程可能会很耗时，因为它涉及加载和解析所有项目模块文件。</p></aside></td></tr><tr id="d8d172c3" class="ijRowEven"><td id="69d04f43"><p id="afd693f1">检查/修复项目</p></td><td id="2f8df830"><p id="7758d131"><i id="3dd39a7b">如果您使用IntelliJ IDEA项目，则此选项可用。</i> 单击此按钮可以重新分析IntelliJ IDEA项目，并直接从项目（例如JDK列表）导入构建设置。</p><aside class="note " rel="7758d131" id="6e375e85" data-title=""><p id="129ac21a">如果您在IntelliJ IDEA中更新项目设置（例如，添加新的JDK，库），请记住通过单击<b id="23cc59f0">Check / Reparse Project</b>来更新构建运行器设置。</p></aside></td></tr><tr id="672319f7" class="ijRowOdd"><td id="efd58c46"><p id="9ab997bc">工作目录</p></td><td id="4dc45fac"><p id="f7b20904">如果<a href="build-working-directory.html">构建工作目录</a>与<a href="build-checkout-directory.html">Build Checkout目录</a>不同，请输入路径。</p><p id="8a01d357">可选，指定是否不同于签出目录。</p></td></tr></tbody></table></div><a name="UnresolvedProjectModulesandPathVariables"></a><a name="Unresolved-Project-Modules-and-Path-Variables"></a><h3 id="DuplicatesFinder(Java)-UnresolvedProjectModulesandPathVariables">未解决的项目模块和路径变量</h3><p id="98718ed7">从IPR文件引用IntelliJ IDEA模块文件（.iml）时，将显示此部分：</p><ul class="list _ul"><li class="list__item" id="d9b68838"><p>找不到</p></li><li class="list__item" id="dffe2fee"><p>允许您输入IPR文件中使用的路径变量的值。</p></li></ul><p id="2bf3a0f7">要刷新此部分中的值，请单击<b id="a7260d7d">Check / Reparse Project</b> 。</p><div class="table-wrapper"><table width="100%" id="881b9800"><thead><tr id="2561cd91" class="ijRowHead"><th id="9ac8e14f"><p id="04f44e3d">选项</p></th><th id="4ce56105"><p id="44f4e4fb">描述</p></th></tr></thead><tbody><tr id="68bff146" class="ijRowOdd"><td id="a29f7a68"><p id="a17f9764"><path_variable_name></path_variable_name></p></td><td id="fb049cdd"><p id="bad3891a">如果项目文件包含路径宏（在IntelliJ IDEA的“设置”对话框的“路径变量”对话框中定义），则会出现此字段。在“ <b id="00f64e10">将值设置为字段”中</b> ，指定要在不同构建代理上使用的项目资源的路径。</p></td></tr></tbody></table></div><p id="aa68fdd3"><a name="projectJdk"></a><a name="DuplicatesFinder(Java)-projectJdk"></a></p><a name="ProjectJDKs"></a><a name="Project-JDKs"></a><h3 id="DuplicatesFinder(Java)-ProjectJDKs">项目JDK</h3><p id="79d1db08">本节提供了在项目中检测到的JDK的列表。</p><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="275d56ea"><thead><tr id="b052f8ba" class="ijRowHead"><th id="59dcd2e8"><p id="3d7d402d">选项</p></th><th id="7150e4f3"><p id="f72edebc">描述</p></th></tr></thead><tbody><tr id="931e2036" class="ijRowOdd"><td id="c0ba5834"><p id="144b2a8b">JDK主页</p></td><td id="efd90b4c"><p id="54c3a71a">使用此字段为项目指定JDK主页。</p><aside class="note " rel="54c3a71a" id="c3ae12b8" data-title=""><p id="6d6f115c">与<b id="e1c5c404">Ipr运行程序</b>一起构建时，将使用此JDK编译相应的IDEA模块的源。对于“ <b id="2ddf9d7f">检查</b>和<b id="ca1a011a">重复查找器”</b>内部版本，此JDK将在内部用于解析项目中使用的Java API。要运行构建过程，请在<code class="code">JAVA_HOME</code>将使用环境变量。</p></aside></td></tr><tr id="d1f413a1" class="ijRowEven"><td id="10ed7129"><p id="7963638e">JDK Jar文件模式</p></td><td id="304fb370"><p id="3c82bdd5">单击此链接打开一个文本区域，您可以在其中为项目JDK的jar文件定义模板。使用Ant规则定义jar文件模式。缺省值用于Linux和Windows操作系统：</p><div class="code-block" data-lang="bash">jre / lib / *。jar</div><p id="5cbc614c">对于Mac OS X，使用以下几行：</p><div class="code-block" data-lang="bash">lib / *。jar ../classes/*.jar</div></td></tr><tr id="f9c3d6c0" class="ijRowOdd"><td id="929d78cf"><p id="c5009dea">IDEA首页</p></td><td id="d77cf59c"><p id="64b656d7">如果您的项目使用IDEA JDK，请指定IDEA主目录的位置</p></td></tr><tr id="d1eab40e" class="ijRowEven"><td id="0f236296"><p id="4bbc3913">IDEA Jar文件模式</p></td><td id="2b1da6e2"><p id="b99bb7fa">单击此链接打开一个文本区域，您可以在其中定义IDEA JDK的jar文件的模板。</p></td></tr></tbody></table></div><aside class="note " rel="275d56ea" id="2a9babdb" data-title=""><p id="ae311e19">您可以在定义值时使用对外部属性的引用，例如<code class="code">%system.idea_home%</code>要么<code class="code">%env.JDK_1_3%</code> 。这将增加对相应属性的<a href="agent-requirements.html">要求</a> 。</p></aside><a name="java-param"></a><a name="JavaParameters"></a><a name="Java-Parameters"></a><h3 id="Ant-JavaParameters">Java参数</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="d31a35ed"><thead><tr id="fc25f2df" class="ijRowHead"><th id="5affbb23"><p id="3803b6e9">选项</p></th><th id="4f0a09a5"><p id="da2152e2">描述</p></th></tr></thead><tbody><tr id="d9f47888" class="ijRowOdd"><td id="b0820226"><p id="0c979f65">JDK</p></td><td id="9df67686"><p id="f1e5c791">选择一个JDK。 <a href="predefined-build-parameters.html#Defining-Java-related-Environment-Variables">本节</a>详细介绍了可用的选项。默认是<code class="code">JAVA_HOME</code>环境变量或代理程序自己的Java。</p></td></tr><tr id="0d2a016e" class="ijRowEven"><td id="8922e545"><p id="823f0304">JDK主页路径</p></td><td id="b314193d"><p id="6869dda2"><i id="8ed0ce48" origin="teamcity-help"><custom>上面选择</custom>时，此选项可用<custom>。</custom></i> 使用此字段可以指定用于运行构建的自定义JDK的路径。如果该字段为空，则从<code class="code">JAVA_HOME</code>代理计算机上的环境变量，或来自<code class="code">env.JAVA_HOME</code>在<a href="build-agent-configuration.html">构建代理配置</a>文件中指定的属性（ <code class="code">buildAgent.properties</code> ）。如果未指定这些值，TeamCity将使用构建代理进程本身的Java主页。</p></td></tr><tr id="2d43ed01" class="ijRowOdd"><td id="ed70ec92"><p id="e93aae41">JVM命令行参数</p></td><td id="ba68f7a3"><p id="ad6c534d">您可以指定此类JVM命令行参数，例如<i id="ba8c0c65" origin="teamcity-help">最大堆大小</i>或启用<i id="0b693505" origin="teamcity-help">远程调试的</i>参数。这些值由用于运行构建的JVM传递。<br>例：</p><div class="code-block" data-lang="bash">-Xmx512m -Xms256m</div></td></tr></tbody></table></div><p id="79e1e8ae"><a name="duplicatorSearcherSettingsOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorSearcherSettingsOptionDescription"></a></p><a name="DuplicateFinderSettings"></a><a name="Duplicate-Finder-Settings"></a><h3 id="DuplicatesFinder(Java)-DuplicateFinderSettings">Finder重复设置</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="f301e38d"><thead><tr id="40d150ef" class="ijRowHead"><th id="0feff6b1"><p id="5e60a150">选项</p></th><th id="198e2cf1"><p id="5654f0bb">描述</p></th></tr></thead><tbody><tr id="9859f7f8" class="ijRowOdd"><td id="6237bf7a"><a name="duplicatorTestSourcesOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorTestSourcesOptionDescription"></a><p id="6d09533b">测试来源</p></td><td id="71dd2117"><p id="4fdb6639">如果选中此选项，则测试源将包含在重复项分析中。</p><aside class="tip sideblock" rel="4fdb6639" id="bdfddb37" data-title=""><p id="c3a2442d">测试可能包含有意复制的数据，验证重复项的测试可能会产生大量结果，从而导致构建时间过长并“散布”您的报告。我们建议您不要选择此选项。</p></aside></td></tr><tr id="7c465854" class="ijRowEven"><td id="76d761cd"><p id="c24d9755">包含/排除模式</p></td><td id="b7e0b1ca"><p id="e44df8e7">可选，指定以限制源范围以对其进行重复分析。有关详细信息，请参考<a href="#IdeaPatterns">以下</a></p></td></tr><tr id="47302e89" class="ijRowOdd"><td id="0314134c"><a name="duplicatorDetalizationLevelOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDetalizationLevelOptionDescription"></a><p id="4e25df52">严重程度</p></td><td id="e186ad24"><p id="a86c6e1c">使用这些选项来定义搜索重复代码片段时应区分源代码的哪些元素。如果代码片段在结构上相似，但包含不同的变量，字段，方法，类型或文字，则可以认为它们是重复的。请参阅以下示例：</p></td></tr><tr id="4741545b" class="ijRowEven"><td id="ff103936"><a name="duplicatorDistinguishVariablesOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishVariablesOptionDescription"></a><p id="cf4457e8">区分变量</p></td><td id="3ca2bfd8"><p id="8474e4e1">如果选中此选项，则具有不同变量名称的相似内容将被识别为不同内容。如果未选中此选项，则这些内容将被识别为重复项：</p><div class="code-block" data-lang="java">公共静态无效main（String [] args）{int i = 0; int j = 0;如果（i == j）{System.out.println（“” + i +“和” + j +“ =” + i + j的总和）； } long k = 0;长n = 0;如果（k == n）{System.out.println（“” + k +“和” + n +“ =” + k + n）之和； }}</div></td></tr><tr id="40ad8797" class="ijRowOdd"><td id="5db4661c"><a name="duplicatorDistinguishFieldsOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishFieldsOptionDescription"></a><p id="72e79d3c">区分领域</p></td><td id="a533a27e"><p id="a9c2fde8">如果选中此选项，则具有不同字段名称的相似内容将被识别为不同内容。如果未选中此选项，则这些内容将被识别为重复项：</p><div class="code-block" data-lang="java">myTable.addSelectionListener（new SelectionListener（）{public void widgetDefaultSelected（SelectionEvent e）{} / * .....** /}）; myTree.addSelectionListener（new SelectionListener（）{public void widgetDefaultSelected（SelectionEvent e）{} / * .....** /}）;</div></td></tr><tr id="c9529182" class="ijRowEven"><td id="3641525a"><a name="duplicatorDistinguishMethodsOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishMethodsOptionDescription"></a><p id="7437a0fc">区分方法</p></td><td id="0f373e79"><p id="a98befd6">如果选中此选项，则结构相似的方法将被识别为不同的方法。如果未选中此选项，则这些方法将被识别为重复方法。在这种情况下，可以将它们提取并重新使用。初始版本：</p><div class="code-block" data-lang="java">public void buildCanceled（Build build，SessionData data）{/ * ...** / for（IListener listener：getListeners（））{listener.buildCanceled（build，data）; }} public void buildFinished（Build build，SessionData data）{/ * ...** / for（IListener listener：getListeners（））{listener.buildFinished（build，data）; }}</div><p id="c122c016">在分析了重复项的代码而没有区分方法之后，可以提取出重复的片段：</p><div class="code-block" data-lang="java">public void buildCanceled（final Build build，最终的SessionData数据）{enumerateListeners（new Processor（）{public void process（final IListener listener）{listener.buildCanceled（build，data）;}））; } public void buildFinished（最终的Build构建，最终的SessionData数据） } private void enumerateListeners（Processor Processor）{/ * ...** / for（IListener listener：getListeners（））{Processor.process（listener）; }}私有接口Processor {void process（IListener listener）; }</div></td></tr><tr id="4156ad98" class="ijRowOdd"><td id="610f82aa"><a name="duplicatorDistinguishTypeOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishTypeOptionDescription"></a><p id="30b3ff95">区分类型</p></td><td id="61baa56d"><p id="a4638576">如果选中此选项，则具有不同类型名称的相似代码片段将被识别为不同的代码片段。如果未选中此选项，则此类代码片段将被识别为重复项。</p><div class="code-block" data-lang="java">新的MyIDE（）。updateStatus（）新的他们的IDE（）。updateStatus（）</div></td></tr><tr id="0a8f16f9" class="ijRowEven"><td id="056f435d"><a name="duplicatorDistinguishLiteralesOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishLiteralesOptionDescription"></a><p id="73058f36">区分文字</p></td><td id="12628c4d"><p id="38583ec0">如果选中此选项，则具有不同标识的相似代码行将被视为不同。如果未选中此选项，则这些行将被识别为重复行。</p><div class="code-block" data-lang="java">myWatchedLabel.setToolTipText（“未登录”）;</div><div class="code-block" data-lang="java">myWatchedLabel.setToolTipText（“正在登录...”）;</div></td></tr><tr id="777f2202" class="ijRowOdd"><td id="c2ad56aa"><a name="duplicatorIgnoreComplexityOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorIgnoreComplexityOptionDescription"></a><p id="0d42dde6">忽略重复性低于的重复项</p></td><td id="2e4a4081"><p id="17e2e8de">源代码的复杂性由语句，表达式，声明和方法调用的数量来定义。它们各自的复杂性由其成本决定。源代码片段的所有这些元素的汇总成本产生了总的复杂性。使用此字段可以指定检测重复项时要考虑的最低级别的源代码。为获得有意义的结果，请从值10开始。</p></td></tr><tr id="b35c48dd" class="ijRowEven"><td id="5adb4277"><a name="duplicatorDistinguishSubexprOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishSubexprOptionDescription"></a><p id="83aa6c7f">忽略重复性低于以下子表达式</p></td><td id="1f10fee3"><p id="7e01fd8a">使用此字段可以指定检测重复项时要考虑的最低级别的子表达式的复杂性。</p></td></tr><tr id="73582218" class="ijRowOdd"><td id="fd58bbca"><a name="duplicatorDistinguishSubexprOptionDescription"></a><a name="DuplicatesFinder(Java)-duplicatorDistinguishSubexprOptionDescription"></a><p id="588ef51c">检查是否可以提取子表达式</p></td><td id="771e4ca2"><p id="f6d974f2">如果选中此选项，则可以提取重复的子表达式。</p></td></tr></tbody></table></div><aside class="note " rel="f301e38d" id="25dcb8a7" data-title=""><p id="b04a6c47"><a name="IdeaPatterns"></a><a name="DuplicatesFinder(Java)-IdeaPatterns"></a></p><p id="cc2929d4">包含/排除模式是用换行符分隔的规则集，其形式为：</p><div class="code-block" data-lang="bash">[+：|-：]模式</div><p id="0095fa66">模式必须满足以下规则的地方：</p><ul class="list _ul"><li class="list__item" id="f7229866"><p>必须以**或*结尾（这实际上将模式限制为仅目录级别，它们不支持文件级别的模式）</p></li><li class="list__item" id="a230e582"><p>对模块的引用可以包括为<code class="code">[module_name]/<path_within_module></code>关于模式处理的一些注意事项：</p></li><li class="list__item" id="d85f46c8"><p>排除优先于包括</p></li><li class="list__item" id="5c0df5e5"><p>如果指定了包含模式，则仅包含与这些模式匹配的目录，所有其他目录将被排除</p></li><li class="list__item" id="1e7a213f"><p>“ include”模式有一个特殊的行为（由于潜在的限制）：它包括指定的目录以及直接位于指定目录之上的目录中的所有文件。</p></li></ul><p id="18fc504e">例：</p><div class="code-block" data-lang="bash">+：testData /表/ **-：testData / **-：testdata / **-：[testData] / **</div></aside><aside class="tip sideblock" rel="duplicates-finder-java.md" id="e7489194" data-title=""><p id="7ed0da2e">为了正确报告文件路径，应在IDEA项目中将项目和所有模块的“对项目/模块文件目录外部资源的引用”选项设置为“相对”。</p></aside><hr id="2428adcb"></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>