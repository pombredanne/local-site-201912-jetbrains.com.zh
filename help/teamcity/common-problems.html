<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>常见问题-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Common Problems" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/troubleshooting.md|Troubleshooting/common-problems.md|Common Problems" data-main-title="Common Problems" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/common-problems.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="common-problems.md" data-toc="Common Problems">常见问题</h1><p id="5b951623"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#CommonProblems-Mostfrequentlyuseddocumentationsections">最常用的文档部分</a></li><li class="list__item"><a href="#CommonProblems-BuildworkslocallybutfailsormisbehavesinTeamCity">构建工作在本地进行，但在TeamCity中失败或行为异常</a></li><li class="list__item"><a href="#CommonProblems-BuildisslowunderTeamCity">在TeamCity下构建缓慢</a></li><li class="list__item"><a href="#CommonProblems-StartedBuildAgentisnotavailableontheservertorunbuilds">服务器上没有已启动的构建代理程序来运行构建程序</a></li><li class="list__item"><a href="#CommonProblems-Artifactsofabuildarenotcleaned">未清除构件的工件</a></li><li class="list__item"><a href="#CommonProblems-Database-relatedissues">与数据库有关的问题</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-" outofmemor="errorwithinternal(hsqldb)database" ="">内部（HSQLDB）数据库出现“内存不足”错误</a></li><li class="list__item"><a href="#CommonProblems-Thetransaction...logisfull">事务...日志已满</a></li><li class="list__item"><a href="#CommonProblems-Thetabletablenameisfull">表“ table_name”已满</a></li><li class="list__item"><a href="#CommonProblems-Unabletoextend...segment...intablespace...">无法扩展...表空间中的...段...</a></li><li class="list__item"><a href="#CommonProblems-NOCOUNTisenabledonMSSQLServer">在MS SQL Server上启用了NOCOUNT</a></li><li class="list__item"><a href="#CommonProblems-MySQLJDBCdrivererror:PacketTooBigException">MySQL JDBC驱动程序错误：PacketTooBigException</a></li><li class="list__item"><a href="#CommonProblems-Databasecharacterset/collation-relatedproblems">数据库字符集/排序规则相关的问题</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-Characterset/collationmismatch">字符集/排序规则不匹配</a></li><li class="list__item"><a href="#CommonProblems-TeamCitydisplays????insteadofnationalsymbols">TeamCity显示????代替国家符号</a></li><li class="list__item"><a href="#CommonProblems-" uniquekeyviolation="or" duplicatesfoun="erroronrestorefrombackup" ="">从备份还原时出现“唯一密钥冲突”或“找到重复项”错误</a></li><li class="list__item"><a href="#CommonProblems-Resolvecharacterset/collation-relatedproblems">解决与字符集/归类相关的问题</a></li><li class="list__item"><a href="#CommonProblems-MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes">MySQL异常：指定的密钥太长；最大密钥长度为767字节</a></li><li class="list__item"><a href="#CommonProblems-Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes">索引列大小太大。最大列大小为767字节</a></li></ul></li><li class="list__item"><a href="#CommonProblems-IncorrectstringvalueerrorinMySQL">MySQL中的“字符串值不正确”错误</a></li><li class="list__item"><a href="#CommonProblems-ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase">MS SQL数据库出现“此驱动程序未配置为进行集成身份验证”错误</a></li><li class="list__item"><a href="#CommonProblems-Protocolviolationerror(Oracleonly)">协议违规错误（仅Oracle）</a></li></ul></li><li class="list__item"><a href="#CommonProblems-CommonMavenissues">常见的Maven问题</a></li><li class="list__item"><a href="#CommonProblems-" criticalerrorinconfigurationfil="errors" ="">“配置文件严重错误”错误</a></li><li class="list__item"><a href="#CommonProblems-TeamCityinstallationproblems">TeamCity安装问题</a></li><li class="list__item"><a href="#CommonProblems-ProblemswithTeamCityNuGetFeed">TeamCity NuGet Feed的问题</a></li><li class="list__item"><a href="#CommonProblems-Problemswith.Net-relatedTeamCityTools">与.Net相关的TeamCity工具的问题</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-Startupperformanceissues">启动性能问题</a></li></ul></li><li class="list__item"><a href="#CommonProblems-Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning">使用需要手动输入的工具，尤其是扩展验证码签名</a></li></ul><p></p><a name="Mostfrequentlyuseddocumentationsections"></a><a name="Most-frequently-used-documentation-sections"></a><div class="chapter"><h2 id="CommonProblems-Mostfrequentlyuseddocumentationsections">最常用的文档部分</h2><ul class="list _ul"><li class="list__item" id="76d4666b"><a href="installing-and-configuring-the-teamcity-server.html">配置服务器内存设置</a></li><li class="list__item" id="52178cb0"><a href="reporting-issues.html#Collect-Data">报告服务器速度慢的问题</a></li></ul><p id="2dac58b9"><b id="62ce60c4"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="BuildworkslocallybutfailsormisbehavesinTeamCity"></a><a name="Build-works-locally-but-fails-or-misbehaves-in-TeamCity"></a><div class="chapter"><h2 id="CommonProblems-BuildworkslocallybutfailsormisbehavesinTeamCity">构建工作在本地进行，但在TeamCity中失败或行为异常</h2><p id="99be8e63">如果构建失败或在TeamCity中出现异常，但您认为应该不会，那么第一件事就是检查问题是否与TeamCity有关。</p><p id="1ad5957e">为此，请按照以下步骤操作：</p><ul class="list _ul"><li class="list__item" id="ffe34a22"><p>在命令提示符下找到一种运行任务的方法。确保它在TeamCity代理计算机上运行，并且与该TeamCity代理所使用的用户相同，并与该代理接收的环境相同。如有必要，请在其他用户下运行TeamCity代理或调整其环境。</p></li><li class="list__item" id="4fc5b0f7"><p>当命令运行正常时，使用带有自定义脚本设置的命令行运行程序在TeamCity构建中配置相同的命令。</p></li><li class="list__item" id="8dd81b01"><p>如果可行，请尝试其他跑步者。</p></li></ul><p id="9e86a69b">以下是有关此方法的详细信息：</p><p id="810f7d9a">当在与TeamCity代理相同的计算机上，在与代理运行相同的用户，具有相同的环境变量和相同的工作目录，相同的体系结构（32/64位）下运行时，从命令提示符处检查构建是否运行正常命令行。</p><p id="155f996e">如果将TeamCity构建代理作为服务运行（例如，它作为Windows服务安装），请尝试在具有管理员权限的常规用户下<a href="setting-up-and-running-additional-build-agents.html#Starting-the-Build-Agent">从命令行</a>运行TeamCity代理。另请参阅<a href="known-issues.html#Agent-running-as-Windows-Service-Limitations">Windows服务限制</a> 。</p><p id="34d4363c">如果这解决了问题，则可以尝试找出为什么在服务下运行对构建而言是一个问题。通常，这是特定于服务的，与TeamCity没有直接关系。另外，您可以将TeamCity代理设置为始终从控制台运行（例如， <a href="setting-up-and-running-additional-build-agents.html#Automatic-Agent-Start-under-Windows">配置</a>自动用户登录并在用户登录时运行代理）。</p><p id="90954584">这是可用于从命令行运行构建的详细步骤。</p><p id="c61115bc">假设您在TeamCity中配置的构建失败，请执行以下操作：</p><ul class="list _ul"><li class="list__item" id="b506659d"><p>在TeamCity中运行该构建，并查看其行为异常</p></li><li class="list__item" id="4aab5517"><p>禁用该代理，以使其上没有其他版本运行。这可以在构建仍在进行时完成</p></li><li class="list__item" id="bb8ce752"><p>使用与运行TeamCity代理的用户相同的用户身份登录到代理计算机（在计算机进程列表中检查正确的用户）</p></li><li class="list__item" id="0384f63b"><p>停止代理</p></li><li class="list__item" id="15c1168b"><p>在命令行控制台中， <code class="code">cd</code>到相关构建的检出目录（可以在TeamCity中的构建日志开头查找该目录）</p></li><li class="list__item" id="3b5847e8"><p>就像在开发人员机器上一样，使用命令行运行构建。这取决于跑步者。（对于某些跑步者，您可以在构建日志中查找TeamCity使用的命令行，另请参阅<code class="code">logs\teamcity-agent.log</code> TeamCity使用的命令行的代理日志文件）</p></li><li class="list__item" id="e6e5dd5a"><p>如果构建失败，请调查原因，因为问题可能与TeamCity不相关，应在计算机上进行调查。</p></li><li class="list__item" id="7f3af1b3"><p>如果运行正常，请继续</p></li><li class="list__item" id="ee25d7f5"><p>在同一控制台窗口中<code class="code">cd</code>到< <a href="agent-home-directory.html">TeamCity代理主目录</a> > / bin并从此处启动TeamCity代理<code class="code">agent start</code>命令</p></li><li class="list__item" id="a01471c0"><p>确保TeamCity中的跑步者设置适当，并且应生成与手动使用的命令行相同的命令行。例如，将“ <i id="6a56b642">命令行</i>构建”步骤与“ <i id="61cc0e0e">自定义脚本”</i>选项以及可以保存在<code class="code">.sh</code>要么<code class="code">.bat</code>文件并从命令提示符运行</p></li><li class="list__item" id="d04a6f2d"><p>在TeamCity中运行构建，在“运行自定义构建”对话框中选择代理</p></li><li class="list__item" id="67a08650"><p>完成后，启用代理</p></li></ul><p id="087a654b">如果构建从控制台成功完成，但在TeamCity中仍然失败，请在TeamCity中使用命令行运行程序启动与控制台中相同的命令。</p><p id="361f96b4">如果它在TeamCity中的行为仍然不同，则很可能是环境或工具问题。</p><p id="2c3f39f9">如果命令行运行器正常运行，但专用运行器在选项都相同时却无法运行，请在<a href="http://youtrack.jetbrains.net/issues/TW" rel="noopener noreferrer" data-external="true" target="_blank">跟踪器中</a>创建一个新问题，详细说明情况。请附加所有构建步骤设置，构建日志，涵盖该构建的所有代理日志，您在控制台中用于运行该构建的命令以及该构建的完整控制台输出。</p><p id="115c0d09"><b id="747c5c68"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="BuildisslowunderTeamCity"></a><a name="Build-is-slow-under-TeamCity"></a><div class="chapter"><h2 id="CommonProblems-BuildisslowunderTeamCity">在TeamCity下构建缓慢</h2><p id="cdaf9246">如果您的构建速度很慢，那么要做的第一件事就是检查构建日志，以查看是否有一些长时间的操作，或者时间是否分散在整个过程中。您可以比较速度较慢和速度较快的构建日志，以找出区别。您还可以从控制台在<a href="#Build-works-locally-but-fails-or-misbehaves-in-TeamCity">如上所述</a>的同一台计算机上运行构建<a href="#Build-works-locally-but-fails-or-misbehaves-in-TeamCity">，</a>以查看从控制台运行的构建与TeamCity中的构建之间是否存在差异。</p><p id="4374b666">如果慢度分布在所有操作上，则在构建过程中将分析代理计算机资源（CPU，磁盘，内存，网络），以查看其中是否存在瓶颈。您可以在构建配置中启用<a href="performance-monitor.html">Performance Monitor</a>构建功能，以查看构建使用了多少CPU，内存和磁盘I / O，以及在什么阶段使用。</p><p id="542675b9">如果构建过程已挂起，则正在运行的构建结果页面上的“查看线程转储”链接可以帮助您了解其发生原因。</p><p id="185cb399">如果进行了长时间的操作，并且是与TeamCity有关的操作（在实际构建过程开始之前或结束之前），则将分析TeamCity代理和服务器（日志和线程转储）。</p><p id="ee108c6e">如果你想<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">谈谈我们</a>这个问题，一定要描述明显的影响，具体调查的过程中，重视构建日志，全权代理日志和收集其它数据。</p><p id="b0214bee"><b id="5b55ee10"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="StartedBuildAgentisnotavailableontheservertorunbuilds"></a><a name="Started-Build-Agent-is-not-available-on-the-server-to-run-builds"></a><div class="chapter"><h2 id="CommonProblems-StartedBuildAgentisnotavailableontheservertorunbuilds">服务器上没有已启动的构建代理程序来运行构建程序</h2><p id="926f4063">安装或TeamCity服务器升级/插件安装后首次启动代理可能会花费一些时间，因为代理会从服务器下载更新并自动升级。</p><p id="dea853c6">通常，代理应在1至10分钟内建立连接，具体取决于代理/服务器网络的连接速度。</p><p id="3a408735">如果在此时间内未连接代理，请检查代理的名称（如<code class="code">conf\buildAgent.properties</code>文件），然后检查“代理服务器用户界面”部分下的标签：</p><ul class="list _ul"><li class="list__item" id="44a2361b"><p>代理处于“已连接”状态-代理已准备好运行构建</p></li><li class="list__item" id="9aa758a1"><p>代理处于断开连接状态-代理已连接到服务器，但已断开连接。检查表中的“不活动原因”。如果原因是“代理已注销（将升级）”，则请再等待几分钟</p></li><li class="list__item" id="00c9eb57"><p>代理处于未授权状态-首次连接到服务器的所有代理均应由服务器管理员授权</p></li></ul><p id="2adf786e">如果代理保持状态超过10分钟，并且代理与服务器之间存在快速网络连接，请执行以下操作：</p><ul class="list _ul"><li class="list__item" id="aac6caf7"><p>检查相关的代理计算机以确保代理进程正在运行，并且<code class="code">serverURL</code>在<code class="code">conf\buildAgent.properties</code>是正确的（并且服务器可以通过机器上的该URL访问服务器）；</p></li><li class="list__item" id="0b68e09f"><p>检查是否满足所有相关的环境<a href="setting-up-and-running-additional-build-agents.html#Necessary-OS-and-environment-permissions">要求</a> ；</p></li><li class="list__item" id="a90dd98c"><p>检查<a href="viewing-build-agent-logs.html">代理日志</a> （ <code class="code">teamcity-agent.log</code> ， <code class="code">launcher.log</code> ， <code class="code">upgrade.log</code> ）的任何相关消息/错误；</p></li><li class="list__item" id="acf5a75d"><p>检查<a href="teamcity-server-logs.html">服务器日志</a> （ <code class="code">teamcity-server.log</code> ）以获取提及代理名称或IP的任何消息/错误。</p></li></ul><p id="f7e834dd">如果您在日志中找不到导致代理升级延迟的原因，请<a href="https://confluence.jetbrains.com/display/TW/Feedback" rel="noopener noreferrer" data-external="true" target="_blank">与我们联系</a>并提供完整的代理和服务器日志。确保在代理计算机上检查/包括代理进程（Java进程）的状态。</p><p id="c584fc94"><b id="94db3f6a"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="Artifactsofabuildarenotcleaned"></a><a name="Artifacts-of-a-build-are-not-cleaned"></a><div class="chapter"><h2 id="CommonProblems-Artifactsofabuildarenotcleaned">未清除构件的工件</h2><p id="b5172c5b">如果遇到保留工件但应通过服务器清理过程将其删除的情况，请检查以下内容：</p><ul class="list _ul"><li class="list__item" id="e289d206"><p>有关构建配置的清理规则，工件清理部分</p></li><li class="list__item" id="3701d170"><p>在构建历史记录行中出现“此构建已被其他构建使用”图标（在“构建历史”上固定操作/图标之前）</p></li><li class="list__item" id="2c11a3ba"><p>构建的“依赖关系”选项卡的“已交付工件”部分。对于每个构建配置，请检查“防止依赖项工件清理”是否已打开（这是默认值）。如果是，则由于该设置，不会清除构建的工件。</p></li></ul><p id="7abaaa1f">阅读更多有关<a href="clean-up.html#Clean-up-for-Dependent-Builds">清理设置的信息</a> 。</p><p id="f58f409d"><b id="b57c15a8"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="Database-relatedissues"></a><a name="Database-related-issues"></a><div class="chapter"><h2 id="CommonProblems-Database-relatedissues">与数据库有关的问题</h2><a name="" outofmemor="errorwithinternal(hsqldb)database" =""></a><a name="" out-of-memor="-error-with-internal-(hsqldb)-database" =""></a><div class="chapter"><h3 id="CommonProblems-" outofmemor="errorwithinternal(hsqldb)database" ="">内部（HSQLDB）数据库出现“内存不足”错误</h3><p id="69fd65b4">如果在TeamCity服务器启动期间遇到以下错误，例如： <i id="72542c5f">“脚本文件行中的错误：...内存不足”</i> ， <i id="d2f8efc8">“ java.sql。SQLException：内存不足”</i> ，请执行以下操作：</p><ul class="list _ul"><li class="list__item" id="437d4ca6"><p>尝试<a href="installing-and-configuring-the-teamcity-server.html#Setting-Up-Memory-settings-for-TeamCity-Server">增加服务器内存</a> 。如果这没有帮助，则很可能意味着您遇到了<b id="d60b34d2">内部数据库损坏</b> 。您可以尝试使用基于HSQLDB文档的<a href="http://www.hsqldb.org/doc/1.8/guide/apc.html" rel="noopener noreferrer" data-external="true" target="_blank">注释</a>来处理这种损坏。</p></li></ul><p id="bf08c4f1">这是尝试手动还原数据库的方法：</p><ul class="list _ul"><li class="list__item" id="7f1f9d05"><p>停止TeamCity服务器</p></li><li class="list__item" id="3745faee"><p>备份< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > /system/buildserver.data文件</p></li><li class="list__item" id="7f6b3f3c"><p>删除< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > /system/buildserver.data文件，并将其替换为同名的零大小文件</p></li><li class="list__item" id="66f72f1f"><p>启动TeamCity服务器</p></li></ul><p id="192b5991">但是，如果数据库无法自动恢复，则可以手动修复的可能性很小。</p><p id="6c63368c">内部（HSQL）数据库对于生产使用来说不够稳定，我们强烈建议使用<a href="setting-up-an-external-database.html">外部数据库</a>来进行TeamCity非评估使用。如果遇到数据库损坏，则可以还原上一个良好的备份或删除构建历史记录和用户，但保留设置，请参阅<a href="migrating-to-an-external-database.html#Switch-with-No-Data-Migration">迁移到外部数据库</a> 。</p></div><a name="Thetransaction...logisfull"></a><a name="The-transaction...-log-is-full"></a><div class="chapter"><h3 id="CommonProblems-Thetransaction...logisfull">事务...日志已满</h3><p id="9e26e6ad">MS SQL或Sybase数据库可能会发生此错误。在这种情况下，我们建议增加TeamCity数据库的事务日志。日志大小可以为1-16 GB，具体取决于系统中的构建代理程序数量以及所有代理程序每天报告的测试数量。</p></div><a name="Thetabletablenameisfull"></a><a name="The-table--table-name--is-full"></a><div class="chapter"><h3 id="CommonProblems-Thetabletablenameisfull">表“ table_name”已满</h3><p id="6e33a883">MySQL数据库可能会发生此错误。该错误表明数据库文件所在的磁盘上或temp目录中的数据库可用空间都已用完。</p></div><a name="Unabletoextend...segment...intablespace..."></a><a name="Unable-to-extend-...-segment-...-in-tablespace-..."></a><div class="chapter"><h3 id="CommonProblems-Unabletoextend...segment...intablespace...">无法扩展...表空间中的...段...</h3><p id="1a9a4f54">Oracle数据库可能会发生此错误。该错误表明Oracle无法为表或索引获取更多空间，因为数据库磁盘空间不足或指定的配额不足。</p></div><a name="NOCOUNTisenabledonMSSQLServer"></a><a name="NOCOUNT-is-enabled-on-MS-SQL-Server"></a><div class="chapter"><h3 id="CommonProblems-NOCOUNTisenabledonMSSQLServer">在MS SQL Server上启用了NOCOUNT</h3><p id="4c2b4b8e"><code class="code">teamcity-server.log</code>报告不支持<code class="code">NOCOUNT</code> MS SQL数据库服务器上启用了该选项。请与您的DBA联系以禁用该设置。</p></div><a name="MySQLJDBCdrivererror:PacketTooBigException"></a><a name="MySQL-JDBC-driver-error:-PacketTooBigException"></a><div class="chapter"><h3 id="CommonProblems-MySQLJDBCdrivererror:PacketTooBigException">MySQL JDBC驱动程序错误：PacketTooBigException</h3><p id="0bfb8294"><a href="https://dev.mysql.com/doc/refman/5.7/en/error-messages-server.html#error_er_net_packet_too_large" rel="noopener noreferrer" data-external="true" target="_blank">ER_NET_PACKET_TOO_LARGE</a>错误（PacketTooBigException /用于查询的数据包太大）是由服务器端引起的<code class="code">max_allowed_packet</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" rel="noopener noreferrer" data-external="true" target="_blank">配置变量</a>设置为低值或保留为默认值。</p><p id="ee770578">该变量控制MySQL通信缓冲区的最大大小，对于Windows版本的MySQL 5.6，默认为4MB，而在流行的Linux发行版中（例如Debian和Fedora Core），对于i686和amd64架构，此变量默认为16MB。</p><ol class="list _decimal"><li class="list__item" id="ca15229e"><p id="f7e8dfae">检查值<code class="code">max_allowed_packet</code>通过检查任一<a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" rel="noopener noreferrer" data-external="true" target="_blank">配置变量</a> <code class="code">my.cnf / my.ini</code> ，或通过</p><div class="code-block" data-lang="bash">mysql>显示类似'max_allowed_packet'的变量；</div></li><li class="list__item" id="77705d1d"><p id="5b6f6dd1">增加（或明确设置） <code class="code">max_allowed_packet</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" rel="noopener noreferrer" data-external="true" target="_blank">中的配置变量</a> <code class="code">my.cnf</code>要么<code class="code">my.ini</code> ：</p><div class="code-block" data-lang="bash">[mysqld] max_allowed_packet = 16M</div></li></ol><aside class="note " rel="e594beb6" id="df136e77" data-title=""><p id="d62af438">设置客户端值（通过<code class="code">maxAllowedPacket</code> JDBC URL中的<a href="https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html" rel="noopener noreferrer" data-external="true" target="_blank">connection属性</a> ）将无效，因为该值不能超过服务器端限制。</p></aside></div><a name="Databasecharacterset/collation-relatedproblems"></a><a name="Database-character-set/collation-related-problems"></a><div class="chapter"><h3 id="CommonProblems-Databasecharacterset/collation-relatedproblems">数据库字符集/排序规则相关的问题</h3><a name="Characterset/collationmismatch"></a><a name="Character-set/collation-mismatch"></a><div class="chapter"><h4 id="CommonProblems-Characterset/collationmismatch">字符集/排序规则不匹配</h4><p id="58680d13">TeamCity报告字符集/排序规则不匹配错误：数据库表/列的字符集或排序规则与数据库架构中的默认字符集或排序规则不同。如果您正在使用非Unicode字符集作为数据库的默认设置，则可能会看到此消息，因为TeamCity对某些数据库实施了Unicode字符集。 <code class="code">varchar</code>领域。确保根据我们的<a href="setting-up-an-external-database.html">建议</a>配置了数据库。</p></div><a name="TeamCitydisplays????insteadofnationalsymbols"></a><a name="TeamCity-displays-????-instead-of-national-symbols"></a><div class="chapter"><h4 id="CommonProblems-TeamCitydisplays????insteadofnationalsymbols">TeamCity显示????代替国家符号</h4><p id="aaede9e4">如果要允许在TeamCity的文本中使用本地字符（例如，VCS消息，测试名称，用户名），则需要迁移到具有适当字符集的数据库。</p></div><a name="" uniquekeyviolation="or" duplicatesfoun="erroronrestorefrombackup" =""></a><a name="" unique-key-violation="-or-" duplicates-foun="-error-on-restore-from-backup" =""></a><div class="chapter"><h4 id="CommonProblems-" uniquekeyviolation="or" duplicatesfoun="erroronrestorefrombackup" ="">从备份还原时出现“唯一密钥冲突”或“找到重复项”错误</h4><p id="709380fa">从备份中还原TeamCity服务器可能会失败，并显示以下错误： <code class="code">"Unique key violation"</code>要么<code class="code">"Duplicates found"</code>如果源数据库和目标数据库的字符集（或归类）不同，并且目标字符集的基数小于源数据库的基数。</p><p id="483a2f33">要解决此问题，请为目标数据库选择并设置正确的字符集（和排序规则）。</p><p id="14d93f06">至于区分大小写，可能的转换是：</p><ul class="list _ul"><li class="list__item" id="78e5a65b"><p>CS> CS</p></li><li class="list__item" id="9aae7a2b"><p>CI> CS</p></li><li class="list__item" id="67137266"><p>CI> CI</p></li></ul><p id="f599c764">但是，建议始终使用CS。</p><p id="6d1a3b08">如果源字符集是Unicode或UTF，则目标字符集也必须是Unicode或UTF。如果源字符集是8位非UTF，则目标字符集可以相同，也可以是Unicode / UTF。</p><p id="f83dd28f">这适用于TeamCity 6.0及更高版本。</p></div><a name="Resolvecharacterset/collation-relatedproblems"></a><a name="Resolve-character-set/collation-related-problems"></a><div class="chapter"><h4 id="CommonProblems-Resolvecharacterset/collation-relatedproblems">解决与字符集/归类相关的问题</h4><p id="4ea661fb">要解决问题，请执行以下步骤：</p><ol class="list _decimal"><li class="list__item" id="a91b9307"><p id="4ba6b416">用适当的字符集和排序规则创建一个新的数据库。我们建议使用<b id="2576d73b">Unicode区分大小写的</b>排序规则：请参阅<a href="setting-up-an-external-database.html#On-PostgreSQL-server-side">PostgreSQL</a>和<a href="setting-up-an-external-database.html#On-MS-SQL-server-side">MySQL的说明</a> 。对于MySQL， <code class="code">utf8_bin</code>要么<code class="code">utf8mb4_bin</code>是首选。<br>有关字符集的详细信息，另请参见<a href="http://www.postgresql.org/docs/9.3/static/multibyte.html" rel="noopener noreferrer" data-external="true" target="_blank">PostgreSQL</a> ， <a href="http://dev.mysql.com/doc/refman/5.0/en/charset-mysql.html" rel="noopener noreferrer" data-external="true" target="_blank">MySQL</a> ， <a href="http://technet.microsoft.com/en-us/library/ms180175(v=sql.105).aspx" rel="noopener noreferrer" data-external="true" target="_blank">MS SQL</a>文档。</p></li><li class="list__item" id="2a93c586"><p id="b00889f7">复制当前的< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > /config/database.properties文件，并将副本中的数据库引用更改为新创建的数据库。</p></li><li class="list__item" id="e5da67ba"><p id="45f10d19">停止TeamCity服务器。</p></li><li class="list__item" id="b3d9e644"><p id="ff033557">使用<code class="code">maintainDB</code>迁移到新数据库的工具：</p><div class="code-block" data-lang="bash">维护数据库迁移[-A <path-to-data-dir>] -T <new-database-properties-file>

</new-database-properties-file></path-to-data-dir></div><p id="48e95e54">根据数据库的大小，迁移可能需要几分钟到几小时。有关的更多信息<code class="code">maintainDB tool</code> ，请参阅<a href="migrating-to-an-external-database.html#Full-Migration">本节</a> 。</p></li><li class="list__item" id="515ec823"><p id="baf5542f">成功完成数据库迁移后， <code class="code">maintainDB</code>工具应使用对新数据库的引用来更新< <a href="teamcity-data-directory.html">TeamCity数据目录</a> > /config/database.properties文件。确保文件已更新。如果工具无法自动编辑文件，请手动编辑。</p></li><li class="list__item" id="a0a2510a"><p id="2d587520">启动TeamCity服务器。</p></li></ol><p id="7092be72"><b id="286c4d91"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes"></a><a name="MySQL-exception:-Specified-key-was-too-long--max-key-length-is-767-bytes"></a><div class="chapter"><h4 id="CommonProblems-MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes">MySQL异常：指定的密钥太长；最大密钥长度为767字节</h4></div><a name="Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes"></a><a name="Index-column-size-too-large.-The-maximum-column-size-is-767-bytes"></a><div class="chapter"><h4 id="CommonProblems-Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes">索引列大小太大。最大列大小为767字节</h4><p id="ede738da">检查MySQL数据库的字符集。建议使用<code class="code">utf8</code>字符集。</p><p id="9e0b0369">如果您的数据库使用<code class="code">utf8mb4</code>字符集（自MySQL 5.5起可用），设置以下InnoDB配置选项（在<code class="code">[mysqld]</code>在部分<code class="code">my.cnf</code>要么<code class="code">my.ini</code> ），以使TeamCity 2017.2.1+运行：</p><ul class="list _ul"><li class="list__item" id="988fccd0"><p><code class="code">innodb_large_prefix=1</code>对于使用DYNAMIC行格式（在MySQL 5.7.7中已弃用）的InnoDB表允许的索引键前缀长于767字节（最多3072字节）。</p></li><li class="list__item" id="9b19a827"><p><code class="code">innodb_file_format=Barracuda</code>启用DYNAMIC行格式。</p></li><li class="list__item" id="046cc1e3"><p><code class="code">innodb_file_per_table=1</code>启用梭子鱼文件格式上面的参数具有以下默认值：</p></li></ul><div class="table-wrapper"><table class=" wide" width="100%" id="b5ffe637"><thead><tr id="4b820995" class="ijRowHead"><th id="33ea7023"></th><th id="1b947d5c"><p id="cdf0ebd1">MySQL 5.5</p></th><th id="751d7609"><p id="bb537717">MySQL 5.6</p></th><th id="51367a33"><p id="0b9ce21f">MySQL 5.7</p></th><th id="11c7b44c"><p id="03fc5f3a">MariaDB 5.5</p></th><th id="60b39c00"><p id="efcf383b">的MariaDB 10.0</p></th><th id="bc98180a"><p id="9838fc40">MariaDB 10.1</p></th><th id="a087a32d"><p id="48562daf">MariaDB 10.2</p></th></tr></thead><tbody><tr id="7e7beb7c" class="ijRowOdd"><td id="dd235fb1"><p id="d08422a7">innodb_large_prefix</p></td><td id="d2fd6935"><p id="bdf9034d">0</p></td><td id="0a9164a0"><p id="675ff711">0</p></td><td id="d65c4d43"><p id="3b574e8d">1个</p></td><td id="47e63d94"><p id="f51b07fc">0</p></td><td id="5ffcce8a"><p id="1a150a8a">0</p></td><td id="2b82663e"><p id="cbc01d2e">0</p></td><td id="e2d4dc82"><p id="df6bd9b7">1个</p></td></tr><tr id="b5eed29d" class="ijRowEven"><td id="1e60ad89"><p id="7748cc6e">innodb_file_format</p></td><td id="8b1398fb"><p id="07b9c876">羚羊</p></td><td id="ad831561"><p id="f653ea93">羚羊</p></td><td id="faab055d"><p id="dc214323">梭子鱼</p></td><td id="0559dd04"><p id="00167aa1">羚羊</p></td><td id="12647eb5"><p id="500f26a4">羚羊</p></td><td id="d99245c3"><p id="13339098">羚羊</p></td><td id="6bd82a62"><p id="60e576b8">梭子鱼</p></td></tr><tr id="c6d1ba76" class="ijRowOdd"><td id="7640931d"><p id="af34a6b3">innodb_file_per_table</p></td><td id="cc842adb"><p id="1588b31e">0</p></td><td id="3a1e165b"><p id="131ee2f6">1个</p></td><td id="dcb68124"><p id="ca48ab79">1个</p></td><td id="9c6f7809"><p id="28bbec7f">1个</p></td><td id="302db4ab"><p id="bcfc44dc">1个</p></td><td id="c93fc333"><p id="3d3c81cd">1个</p></td><td id="667f1004"><p id="c997fffa">1个</p></td></tr></tbody></table></div><p id="2694240c">根据数据库服务器版本，需要进行以下配置更改：</p><p id="29628f42"><b id="f8a472b6">MySQL 5.5：</b></p><ul class="list _ul"><li class="list__item" id="41574bb4"><code class="code">innodb_large_prefix=1</code></li><li class="list__item" id="cb85e03d"><code class="code">innodb_file_format=Barracuda</code></li><li class="list__item" id="e8534c01"><code class="code">innodb_file_per_table=1</code></li></ul><p id="f1d43bba"><b id="2b42d3e4">从5.5到10.1的MySQL 5.6和MariaDB：</b></p><ul class="list _ul"><li class="list__item" id="fc1f52ef"><code class="code">innodb_file_format=Barracuda</code></li><li class="list__item" id="73ae8790"><code class="code">innodb_file_per_table=1</code></li></ul><p id="f0f30c15">对于<b id="e67fa23f">MySQL 5.7+和MariaDB 10.2+，请</b>使用默认值，无需更改。</p></div></div><a name="IncorrectstringvalueerrorinMySQL"></a><a name="-Incorrect-string-value--error-in-MySQL"></a><div class="chapter"><h3 id="CommonProblems-IncorrectstringvalueerrorinMySQL">MySQL中的“字符串值不正确”错误</h3><ol class="list _decimal"><li class="list__item" id="7d8c6d47"><p id="225cb81f">使用<code class="code">utf8mb4</code>在MySQL中设置字符并设置要使用的MySQL服务器<code class="code">utf8mb4</code>默认情况下，在<code class="code">[mysqld]</code>在部分<code class="code">my.cnf</code> ：</p><p id="224d5265"><code class="code">character_set_server = utf8mb4</code><br><code class="code">collation_server = utf8mb4_bin</code></p></li><li class="list__item" id="2a134d99"><p id="ab25aadc">重新启动MySQL以进行更改<code class="code">my.cnf</code>生效。</p></li></ol><p id="e4ec729a"><b id="cee17e8a"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase"></a><a name="-This-driver-is-not-configured-for-integrated-authentication--error-with-MS-SQL-database"></a><div class="chapter"><h3 id="CommonProblems-ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase">MS SQL数据库出现“此驱动程序未配置为进行集成身份验证”错误</h3><p id="ffc77077">在TeamCity安装过程中，使用Windows集成安全性连接和创建MS SQL数据库时，可能会发生以下错误：“执行时出现SQL错误：从数据源获取连接：未为集成身份验证配置此驱动程序。”</p><p id="abf4193e">问题最常见的原因是<code class="code">sqljdbc_auth.dll</code> MS SQL共享库和TeamCity使用的JRE。</p><p id="7ffa66c8">要解决此问题，请执行以下操作：</p><ol class="list _decimal"><li class="list__item" id="4ef3218b"><p>确保使用MS SQL本机驱动程序（可从<a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&id=11774" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft下载中心下载</a> ）。</p></li><li class="list__item" id="0ba9a7d7"><p>使用正确的JRE位：确保您使用与您的位相同的Java运行TeamCity。 <code class="code">sqljdbc_auth.dll</code> MS SQL共享库。默认情况下，TeamCity使用32位Java。然而，32位和64位的Java版本<a href="installing-and-configuring-the-teamcity-server.html#Java-Installation">可以使用</a> 。</p></li></ol><p id="0162fbdd">要使用所需的JRE运行TeamCity，请执行以下一项操作：*设置<code class="code">TEAMCITY_JRE</code>环境变量*或从< <a href="teamcity-home-directory.html">TeamCity主页</a> > \ jre中删除与TeamCity捆绑在一起的JRE并进行设置<code class="code">JAVA_HOME</code> 。</p><aside class="note " rel="0162fbdd" id="d43649db" data-title=""><p id="728b4687">请注意，在升级时，TeamCity将使用默认的32位版本覆盖现有的JRE，因此，升级后，您将不得不再次更新到64位的JRE。</p></aside><p id="7d3d5e80">另请参阅此相关<a href="http://www.mikeobrien.net/blog/teamcity-sqlserver-integrated-security/" rel="noopener noreferrer" data-external="true" target="_blank">外部过帐</a> 。</p></div><a name="Protocolviolationerror(Oracleonly)"></a><a name="Protocol-violation-error-(Oracle-only)"></a><div class="chapter"><h3 id="CommonProblems-Protocolviolationerror(Oracleonly)">协议违规错误（仅Oracle）</h3><p id="ef6e4cfb">当Oracle JDBC驱动程序与Oracle服务器不兼容时，会发生此错误。例如，Oracle JDBC驱动程序版本11.1与Oracle服务器版本10.2不兼容。</p><p id="2fc34020">为了解决该问题，请从Oracle服务器安装中使用Oracle JDBC驱动程序，或<a href="http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html" rel="noopener noreferrer" data-external="true" target="_blank">下载</a>与Oracle服务器版本相同<a href="http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html" rel="noopener noreferrer" data-external="true" target="_blank">的驱动程序</a> 。</p><p id="f8997adf"><b id="51140a65"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div></div><a name="CommonMavenissues"></a><a name="Common-Maven-issues"></a><div class="chapter"><h2 id="CommonProblems-CommonMavenissues">常见的Maven问题</h2><p id="e2a0500a">在TeamCity构建配置中常见两种与Maven相关的问题：</p><ul class="list _ul"><li class="list__item" id="43f2985e"><p>生成配置的“ Maven”选项卡上的错误消息：“收集Maven项目信息时发生错误...”</p></li><li class="list__item" id="3fce5742"><p>具有Maven依赖项触发器的构建配置中的错误消息已激活：“无法检查Maven依赖关系更新...”如果尽管显示了此类错误消息，构建配置仍能成功生成，则这些错误很可能是由<b id="7d67ea73">服务器端Maven配置错误</b>引起的。</p></li></ul><p id="39886a0f">为了收集有关<b id="ae7b54f2">Maven</b>选项卡的信息，或执行Maven依赖项检查（针对触发器），TeamCity运行嵌入式Maven。执行是在<i id="0fd404ce">服务器</i>计算机上执行的，并且任何<i id="15adc56e">代理端</i> maven设置均<b id="7c73e0f5">不可访问</b> 。TeamCity解决了<code class="code">settings.xml</code>分别在服务器端存储文件，如<a href="maven-server-side-settings.html">Maven服务器端设置中所述</a> 。</p><p id="cb6c28b5">检查是否<code class="code">server-side settings.xml</code>文件包含有关远程存储库，代理，镜像，配置文件，凭据等的正确信息。</p><p id="f0577d30"><b id="1356a04f"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="" criticalerrorinconfigurationfil="errors" =""></a><a name="" critical-error-in-configuration-fil="-errors" =""></a><div class="chapter"><h2 id="CommonProblems-" criticalerrorinconfigurationfil="errors" ="">“配置文件严重错误”错误</h2><p id="cc61f6a8">如果遇到错误，则表示TeamCity数据目录中存储的设置处于不一致状态。手动更改文件后，或者更新版本的TeamCity开始报告不一致情况时，可能会发生这种情况。<br>要解决此问题，您可以编辑服务器文件系统上消息中指出的文件。 （确保在进行任何手动编辑之前创建文件的备份副本）。通常，无需重新启动服务器即可使更改生效。</p><p id="2b7617db"><b id="dc19cccf">ID为“ XXX”的VCS根目录不存在</b></p><p id="a44fc67a">构建配置或模板引用系统中未定义的VCS根目录。补救措施：还原VCS根目录，或创建一个新的VCS根目录，并标明ID，或编辑消息中标明的文件，以删除对VCS根目录的引用。</p><p id="cb2375c4"><b id="fa89d556"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="TeamCityinstallationproblems"></a><a name="TeamCity-installation-problems"></a><div class="chapter"><h2 id="CommonProblems-TeamCityinstallationproblems">TeamCity安装问题</h2><p id="a8f76c11">如果安装后无法访问TeamCity Web UI，则可能是在另一个程序已经在使用的端口上运行TeamCity。<a href="installing-and-configuring-the-teamcity-server.html#Installation-Configuration">检查并配置</a> TeamCity安装。</p><p id="188e2461"><b id="8f044f57"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="ProblemswithTeamCityNuGetFeed"></a><a name="Problems-with-TeamCity-NuGet-Feed"></a><div class="chapter"><h2 id="CommonProblems-ProblemswithTeamCityNuGetFeed">TeamCity NuGet Feed的问题</h2><p id="d2ffc3db">如果您遇到部分TeamCity NuGet Feed的问题，即缺少NuGet软件包等，则可能必须为TeamCity NuGet Feed重新编制索引。</p><p id="541a561e">要强制TeamCity重新索引所有可用软件包并重置NuGet软件包列表，请导航至服务器<b id="5d6133cd">。诊断|缓存</b>并使用<a href="teamcity-monitoring-and-diagnostics.html#Caches">buildsMetadata Reset</a>链接。</p><p id="776860d4">对于早期版本，请参考<a href="https://confluence.jetbrains.com/display/TCD8/Common+Problems" rel="noopener noreferrer" data-external="true" target="_blank">本节</a> 。</p><p id="8226b66a"><b id="542029b2"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div><a name="Problemswith.Net-relatedTeamCityTools"></a><a name="Problems-with-.Net-related-TeamCity-Tools"></a><div class="chapter"><h2 id="CommonProblems-Problemswith.Net-relatedTeamCityTools">与.Net相关的TeamCity工具的问题</h2><a name="Startupperformanceissues"></a><a name="Startup-performance-issues"></a><div class="chapter"><h3 id="CommonProblems-Startupperformanceissues">启动性能问题</h3><p id="07aa941b">升级到TeamCity 9.0或更高版本后，由于Microsoft实施的代码访问安全性（CAS）策略，在TeamCity代理上安装的低于4.0版本的.NET Framework可能会导致与.Net相关的TeamCity工具的性能问题。</p><p id="513d620d">要解决此问题，请使用以下选项之一：</p><ol class="list _decimal"><li class="list__item" id="873214e6"><p id="c90bbcd5">将<a href="https://msdn.microsoft.com/en-us/library/bb629393%28v=vs.110%29.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft文档中</a>描述的以下设置添加到<code class="code">machine.config</code>在所有代理上归档：</p><div class="code-block" data-lang="bash"><configuration>
	    <runtime>
		    <generatepublisherevidence enabled="false"></generatepublisherevidence>
	    </runtime>
</configuration>

</div><p id="ad0f8c8e">您可以按照此外部<a href="http://blogs.msdn.com/b/amolravande/archive/2008/07/20/startup-performance-disable-the-generatepublisherevidence-property.aspx" rel="noopener noreferrer" data-external="true" target="_blank">博客文章中的</a>描述修改machine.config文件，并将此配置文件传递给所有代理，例如使用自定义脚本。</p></li><li class="list__item" id="6c96e44e"><p id="35cbbf0d">或者，将TeamCity代理上的.Net Framework升级到版本4.0及更高版本。有关详细信息，请参阅<a href="https://msdn.microsoft.com/en-us/library/dd233103%28v=vs.100%29.aspx#simplification" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft文档</a> 。</p></li></ol><p id="70ef1342"><b id="22e2c677"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p></div></div><a name="Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning"></a><a name="Using-tools-requiring-manual-input,-in-particular-Extended-Validation-code-signing"></a><div class="chapter"><h2 id="CommonProblems-Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning">使用需要手动输入的工具，尤其是扩展验证码签名</h2><p id="e6f70581">您可能想要使用需要在TeamCity代理上执行的生成过程中进行一些手动交互的工具。这不是TeamCity特有的问题，因此应使用通用方法进行处理。</p><p id="2cf3f777">在WIndows下，您可能希望将TeamCity代理配置为不作为服务运行，而是通过配置自动用户登录及<a href="setting-up-and-running-additional-build-agents.html#Automatic-Agent-Start-under-Windows">相关详细信息</a>来访问桌面。</p><p id="b97e811a">对于扩展验证（EV）代码签名，没有简单的解决方案，原因是该功能是内置的。关于<a href="https://stackoverflow.com/questions/17927895/automate-extended-validation-ev-code-signing=" rel="noopener noreferrer" data-external="true" target="_blank">堆栈溢出</a>的问题有一些讨论。适当的soltotoin似乎使用自己的授权方法来实现专用服务，并通过它对二进制文件进行签名。</p><p id="ed421d11"><b id="fbcd14ee"><a href="#Most-frequently-used-documentation-sections">回到顶部</a></b></p><hr id="156a4462"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>