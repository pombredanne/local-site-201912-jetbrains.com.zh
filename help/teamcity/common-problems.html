<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Common Problems - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Common Problems" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/troubleshooting.md|Troubleshooting/common-problems.md|Common Problems" data-main-title="Common Problems" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/common-problems.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Common Problems" id="common-problems.md">Common Problems</h1><p id="5b951623"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#CommonProblems-Mostfrequentlyuseddocumentationsections">Most frequently used documentation sections</a></li><li class="list__item"><a href="#CommonProblems-BuildworkslocallybutfailsormisbehavesinTeamCity">Build works locally but fails or misbehaves in TeamCity</a></li><li class="list__item"><a href="#CommonProblems-BuildisslowunderTeamCity">Build is slow under TeamCity</a></li><li class="list__item"><a href="#CommonProblems-StartedBuildAgentisnotavailableontheservertorunbuilds">Started Build Agent is not available on the server to run builds</a></li><li class="list__item"><a href="#CommonProblems-Artifactsofabuildarenotcleaned">Artifacts of a build are not cleaned</a></li><li class="list__item"><a href="#CommonProblems-Database-relatedissues">Database-related issues</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-&#34;outofmemory&#34;errorwithinternal(HSQLDB)database">"out of memory" error with internal (HSQLDB) database</a></li><li class="list__item"><a href="#CommonProblems-Thetransaction...logisfull">The transaction... log is full</a></li><li class="list__item"><a href="#CommonProblems-Thetabletablenameisfull">The table 'table_name' is full</a></li><li class="list__item"><a href="#CommonProblems-Unabletoextend...segment...intablespace...">Unable to extend ... segment ... in tablespace ...</a></li><li class="list__item"><a href="#CommonProblems-NOCOUNTisenabledonMSSQLServer">NOCOUNT is enabled on MS SQL Server</a></li><li class="list__item"><a href="#CommonProblems-MySQLJDBCdrivererror:PacketTooBigException">MySQL JDBC driver error: PacketTooBigException</a></li><li class="list__item"><a href="#CommonProblems-Databasecharacterset/collation-relatedproblems">Database character set/collation-related problems</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-Characterset/collationmismatch">Character set/collation mismatch</a></li><li class="list__item"><a href="#CommonProblems-TeamCitydisplays????insteadofnationalsymbols">TeamCity displays ???? instead of national symbols</a></li><li class="list__item"><a href="#CommonProblems-&#34;Uniquekeyviolations&#34;or&#34;Duplicatesfound&#34;erroronrestorefrombackup">"Unique key violations" or "Duplicates found" error on restore from backup</a></li><li class="list__item"><a href="#CommonProblems-Resolvecharacterset/collation-relatedproblems">Resolve character set/collation-related problems</a></li><li class="list__item"><a href="#CommonProblems-MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes">MySQL exception: Specified key was too long; max key length is 767 bytes</a></li><li class="list__item"><a href="#CommonProblems-Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes">Index column size too large. The maximum column size is 767 bytes</a></li></ul></li><li class="list__item"><a href="#CommonProblems-IncorrectstringvalueerrorinMySQL">'Incorrect string value' error in MySQL</a></li><li class="list__item"><a href="#CommonProblems-ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase">'This driver is not configured for integrated authentication' error with MS SQL database</a></li><li class="list__item"><a href="#CommonProblems-Protocolviolationerror(Oracleonly)">Protocol violation error (Oracle only)</a></li></ul></li><li class="list__item"><a href="#CommonProblems-CommonMavenissues">Common Maven issues</a></li><li class="list__item"><a href="#CommonProblems-&#34;Criticalerrorinconfigurationfile&#34;errors">"Critical error in configuration file" errors</a></li><li class="list__item"><a href="#CommonProblems-TeamCityinstallationproblems">TeamCity installation problems</a></li><li class="list__item"><a href="#CommonProblems-ProblemswithTeamCityNuGetFeed">Problems with TeamCity NuGet Feed</a></li><li class="list__item"><a href="#CommonProblems-Problemswith.Net-relatedTeamCityTools">Problems with .Net-related TeamCity Tools</a><ul class="list _bullet"><li class="list__item"><a href="#CommonProblems-Startupperformanceissues">Startup performance issues</a></li></ul></li><li class="list__item"><a href="#CommonProblems-Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning">Using tools requiring manual input, in particular Extended Validation code signing</a></li></ul></p><a name="Mostfrequentlyuseddocumentationsections"></a><a name="Most-frequently-used-documentation-sections"></a><div class="chapter"><h2 id="CommonProblems-Mostfrequentlyuseddocumentationsections">Most frequently used documentation sections</h2><ul class="list _ul"><li class="list__item" id="76d4666b"><a href="installing-and-configuring-the-teamcity-server.html">Configuring server memory settings</a></li><li class="list__item" id="52178cb0"><a href="reporting-issues.html#Collect-Data">Reporting server slowness issues</a></li></ul><p id="2dac58b9"><b id="62ce60c4"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="BuildworkslocallybutfailsormisbehavesinTeamCity"></a><a name="Build-works-locally-but-fails-or-misbehaves-in-TeamCity"></a><div class="chapter"><h2 id="CommonProblems-BuildworkslocallybutfailsormisbehavesinTeamCity">Build works locally but fails or misbehaves in TeamCity</h2><p id="99be8e63">If a build fails or otherwise misbehaves in TeamCity but you believe it should not, the first thing to do is to check whether the issue is related to TeamCity or not.</p><p id="1ad5957e">To do that, follow this procedure:</p><ul class="list _ul"><li class="list__item" id="ffe34a22"><p>Find a way to run the task from a command prompt. Make sure it works on the TeamCity agent machine, under the same user as the TeamCity agent runs under, with the same environment the agent receives. If necessary, run the TeamCity agent under a different user or tweak its environment.</p></li><li class="list__item" id="4fc5b0f7"><p>When the command runs OK, configure the same command in a TeamCity build using the command-line runner with the custom script setting.</p></li><li class="list__item" id="8dd81b01"><p>If that works, try other runner if that feels applicable.</p></li></ul><p id="9e86a69b">Here are details on the approach:</p><p id="810f7d9a">Check that the build runs fine from the command prompt when run on the same machine as the TeamCity agent and under the same user that the agent is running, with the same environment variables and the same working directory, same architecture (32/64 bit) command line.</p><p id="155f996e">If the TeamCity build agent is run as a service (for example, it is installed as a Windows service), try running the TeamCity agent under a regular user with administrative permissions <a href="setting-up-and-running-additional-build-agents.html#Starting-the-Build-Agent">from the command line</a>. See also <a href="known-issues.html#Agent-running-as-Windows-Service-Limitations">Windows Service limitations</a>.</p><p id="34d4363c">If this fixes the issue, you can try to figure out why running under the service is a problem for the build. Most often this is service-specific and is not related to TeamCity directly. Also, you can set up the TeamCity agent to be run from the console all the time (for example, <a href="setting-up-and-running-additional-build-agents.html#Automatic-Agent-Start-under-Windows">configure</a> an automatic user logon and run the agent on the user logon).</p><p id="90954584">Here are the detailed steps you can use to run a build from the command line.</p><p id="c61115bc">Assuming you have a configured build in TeamCity which is failing, do the following:</p><ul class="list _ul"><li class="list__item" id="b506659d"><p>run the build in TeamCity and see it misbehaving</p></li><li class="list__item" id="4aab5517"><p>disable the agent so that no other builds run on it. This can be done while the build is still in progress</p></li><li class="list__item" id="bb8ce752"><p>log in to the agent machine using the same user as the one running the TeamCity agent (check the right user in the machine processes list)</p></li><li class="list__item" id="0384f63b"><p>stop the agent</p></li><li class="list__item" id="15c1168b"><p>in a command line console, <code class="code">cd</code> to the checkout directory of the build in question (the directory can be looked up in the beginning of the build log in TeamCity)</p></li><li class="list__item" id="3b5847e8"><p>run the build with a command line as you would do on a developer machine. This is runner-dependent. (For some runners you can look up the command line used by TeamCity in the build log, see also the <code class="code">logs\teamcity-agent.log</code> agent log file for the command line used by TeamCity)</p></li><li class="list__item" id="e6e5dd5a"><p>if the build fails - investigate the reason as the issue is probably not TeamCity-related and should be investigated on the machine.</p></li><li class="list__item" id="7f3af1b3"><p>if it runs OK, continue</p></li><li class="list__item" id="ee25d7f5"><p>in the same console window <code class="code">cd</code> to  &lt;<a href="agent-home-directory.html">TeamCity agent home</a>&gt;/bin and start TeamCity agent from there with the <code class="code">agent start</code> command</p></li><li class="list__item" id="a01471c0"><p>ensure the runner settings in TeamCity are appropriate and should generate the same command line as you used manually. For example, use the <i id="6a56b642">Command Line</i> build step with the <i id="61cc0e0e">Custom script</i> option and the same command which can be saved in a <code class="code">.sh</code> or <code class="code">.bat</code> file and run from the command prompt</p></li><li class="list__item" id="d04a6f2d"><p>run the build in TeamCity selecting the agent in the Run custom build dialog</p></li><li class="list__item" id="67a08650"><p>when finished, enable the agent</p></li></ul><p id="087a654b">If the build succeeds from the console but still fails in TeamCity, use a command line runner in TeamCity to launch the same command as in the console.</p><p id="361f96b4">If it still behaves differently in TeamCity, most probably this is an environment or a tool issue.</p><p id="2c3f39f9">If the command line runner works but the dedicated runner does not while the options are all the same, create a new issue in our <a href="http://youtrack.jetbrains.net/issues/TW" data-external="true" target="_blank" rel="noopener noreferrer">tracker</a> detailing the case. Please attach all the build step settings, the build log, all agent logs covering the build, the command you used in the console to run the build and the full console output of the build.</p><p id="115c0d09"><b id="747c5c68"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="BuildisslowunderTeamCity"></a><a name="Build-is-slow-under-TeamCity"></a><div class="chapter"><h2 id="CommonProblems-BuildisslowunderTeamCity">Build is slow under TeamCity</h2><p id="cdaf9246">If you experience slow builds, the first thing to do is to check the build log to see if there are some long operations or the time is just spread over the entire process. You can compare build logs of slower and faster builds to figure out what the difference is. You can also run the build from the console on the same machine as detailed <a href="#Build-works-locally-but-fails-or-misbehaves-in-TeamCity">above</a> to see if there is any difference between the build run from the console and the build in TeamCity.</p><p id="4374b666">If the slowness is spread over all the operations, the agent machine resources (CPU, disk, memory, network) are to be analyzed during the build to see if there is a bottleneck in any of those. You can enable <a href="performance-monitor.html">Performance Monitor</a> build feature in the build configuration to see how much CPU, memory and disk I/O is used by the build and at what stage.</p><p id="542675b9">If build process is hanging, then "View thread dump" link on the running build results page can help with understanding why it happens.</p><p id="185cb399">If there is some long operation and it is a TeamCity-related one (before start or after end of the actual build process), the TeamCity agent and server are to be analyzed (logs and thread dumps).</p><p id="ee108c6e">If you want to <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">turn to us</a> with the issue, make sure to describe the visible effects, detail the process of investigation and attach the build log, full agent logs and other data collected.</p><p id="b0214bee"><b id="5b55ee10"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="StartedBuildAgentisnotavailableontheservertorunbuilds"></a><a name="Started-Build-Agent-is-not-available-on-the-server-to-run-builds"></a><div class="chapter"><h2 id="CommonProblems-StartedBuildAgentisnotavailableontheservertorunbuilds">Started Build Agent is not available on the server to run builds</h2><p id="926f4063">First start of agent after installation or TeamCity server upgrade/plugin installation can take time as agent downloads updates form the server and auto-upgrades.</p><p id="dea853c6">Regularly, agent should become connected in 1 to 10 minutes, depending on the agent/server network connection speed.</p><p id="3a408735">If the agent is not connected within that time, check the name of the agent (as configured in <code class="code">conf\buildAgent.properties</code> file) and check the tabs under the Agents server UI section:</p><ul class="list _ul"><li class="list__item" id="44a2361b"><p>the agent is under Connected - the agent is ready to run builds</p></li><li class="list__item" id="9aa758a1"><p>the agent is under Disconnected - the agent was connected to the server, but became disconnected. Check the "Inactivity reason" in the table. If the reason is "Agent has unregistered (will upgrade)", then wait for several more minutes</p></li><li class="list__item" id="00c9eb57"><p>the agent is under Unauthorized - all the agents connected to the server for the first time should be authorized by a server administrator</p></li></ul><p id="2adf786e">If the agent stays in the state for more than 10 minutes and you have a fast network connection between the agent and the server, do the following:</p><ul class="list _ul"><li class="list__item" id="aac6caf7"><p>check the related agent machine to ensure that the agent process is running and <code class="code">serverURL</code> in <code class="code">conf\buildAgent.properties</code> is correct (and that the server is reachable by that URL from the machine);</p></li><li class="list__item" id="0b68e09f"><p>check that all the related environment <a href="setting-up-and-running-additional-build-agents.html#Necessary-OS-and-environment-permissions">requirements</a> are met;</p></li><li class="list__item" id="a90dd98c"><p>check <a href="viewing-build-agent-logs.html">agent logs</a> (<code class="code">teamcity-agent.log</code>, <code class="code">launcher.log</code>, <code class="code">upgrade.log</code>) for any related messages/errors;</p></li><li class="list__item" id="acf5a75d"><p>check <a href="teamcity-server-logs.html">server logs</a> (<code class="code">teamcity-server.log</code>) for any messages/errors mentioning agent name or IP.</p></li></ul><p id="f7e834dd">If you cannot find the cause of the delayed agent upgrade in the logs, <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">contact us</a> and provide the full agent and server logs. Be sure to check/include the state of the agent processes (java ones) on the agent machine.</p><p id="c584fc94"><b id="94db3f6a"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="Artifactsofabuildarenotcleaned"></a><a name="Artifacts-of-a-build-are-not-cleaned"></a><div class="chapter"><h2 id="CommonProblems-Artifactsofabuildarenotcleaned">Artifacts of a build are not cleaned</h2><p id="b5172c5b">If you encounter a case when artifacts are preserved while they should have been removed by the server cleanup process, check the following:</p><ul class="list _ul"><li class="list__item" id="e289d206"><p>the cleanup rules of the build configuration in question, artifacts cleanup section</p></li><li class="list__item" id="3701d170"><p>presence of the icon "This build is used by other builds" in the build history line (prior to Pin action/icon on Build History)</p></li><li class="list__item" id="2c11a3ba"><p>build's Dependencies tab, "Delivered Artifacts" section. For every build configuration, check whether "Prevent dependency artifacts clean-up" is turned ON (this is default value). If it is, then the build's artifacts are not cleaned because of the setting.</p></li></ul><p id="7abaaa1f">Read more on <a href="clean-up.html#Clean-up-for-Dependent-Builds">cleanup settings</a>.</p><p id="f58f409d"><b id="b57c15a8"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="Database-relatedissues"></a><a name="Database-related-issues"></a><div class="chapter"><h2 id="CommonProblems-Database-relatedissues">Database-related issues</h2><a name="&#34;outofmemory&#34;errorwithinternal(HSQLDB)database"></a><a name="&#34;out-of-memory&#34;-error-with-internal-(HSQLDB)-database"></a><div class="chapter"><h3 id="CommonProblems-&#34;outofmemory&#34;errorwithinternal(HSQLDB)database">"out of memory" error with internal (HSQLDB) database</h3><p id="69fd65b4">If during the TeamCity server start-up you encounter errors like: <i id="72542c5f">"error in script file line: ... out of memory"</i>, <i id="d2f8efc8">"java.sql.SQLException: out of memory"</i>, perform the following:</p><ul class="list _ul"><li class="list__item" id="437d4ca6"><p>try <a href="installing-and-configuring-the-teamcity-server.html#Setting-Up-Memory-settings-for-TeamCity-Server">increasing server memory</a>. If this does not help, most probably this means that you have encountered <b id="d60b34d2">internal database corruption</b>. You can try to deal with this corruption using the <a href="http://www.hsqldb.org/doc/1.8/guide/apc.html" data-external="true" target="_blank" rel="noopener noreferrer">notes</a> based on the HSQLDB documentation.</p></li></ul><p id="bf08c4f1">Here is a way to attempt a manual database restore:</p><ul class="list _ul"><li class="list__item" id="7f1f9d05"><p>stop the TeamCity server</p></li><li class="list__item" id="3745faee"><p>backup the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/buildserver.data file</p></li><li class="list__item" id="7f6b3f3c"><p>remove the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/system/buildserver.data file and replace it with zero-size file of the same name</p></li><li class="list__item" id="66f72f1f"><p>start the TeamCity server</p></li></ul><p id="192b5991">However, if the database does not recover automatically, chances that it can be fixed manually are minimal.</p><p id="6c63368c">The internal (HSQL) database is not stable enough for production use and we highly recommend using an <a href="setting-up-an-external-database.html">external database</a> for TeamCity non-evaluation usage.If you encountered database corruption, you can restore the last good backup or drop builds history and users, but preserve the settings, see <a href="migrating-to-an-external-database.html#Switch-with-No-Data-Migration">Migrating to an External Database</a>.</p></div><a name="Thetransaction...logisfull"></a><a name="The-transaction...-log-is-full"></a><div class="chapter"><h3 id="CommonProblems-Thetransaction...logisfull">The transaction... log is full</h3><p id="9e26e6ad">This error can occur with an MS SQL or Sybase database. In this case we recommend increasing the transaction log for the TeamCity database. The log size can be 1 - 16 GB depending on the number of build agents in the system and the number of tests all agents report daily.</p></div><a name="Thetabletablenameisfull"></a><a name="The-table--table-name--is-full"></a><div class="chapter"><h3 id="CommonProblems-Thetabletablenameisfull">The table 'table_name' is full</h3><p id="6e33a883">This error can occur with a MySQL database. The error indicates that the database has run out of free space either on the disk where the database files are located or in the temp directory.</p></div><a name="Unabletoextend...segment...intablespace..."></a><a name="Unable-to-extend-...-segment-...-in-tablespace-..."></a><div class="chapter"><h3 id="CommonProblems-Unabletoextend...segment...intablespace...">Unable to extend ... segment ... in tablespace ...</h3><p id="1a9a4f54">This error can occur with an Oracle database. The error indicates that Oracle could not obtain more space for a table or an index as the database has run out of space on the disk or the specified quotas are insufficient.</p></div><a name="NOCOUNTisenabledonMSSQLServer"></a><a name="NOCOUNT-is-enabled-on-MS-SQL-Server"></a><div class="chapter"><h3 id="CommonProblems-NOCOUNTisenabledonMSSQLServer">NOCOUNT is enabled on MS SQL Server</h3><p id="4c2b4b8e"><code class="code">teamcity-server.log</code> reports that the unsupported <code class="code">NOCOUNT</code> option is enabled on the MS SQL database server. Contact your DBA to disable the setting.</p></div><a name="MySQLJDBCdrivererror:PacketTooBigException"></a><a name="MySQL-JDBC-driver-error:-PacketTooBigException"></a><div class="chapter"><h3 id="CommonProblems-MySQLJDBCdrivererror:PacketTooBigException">MySQL JDBC driver error: PacketTooBigException</h3><p id="0bfb8294">The <a href="https://dev.mysql.com/doc/refman/5.7/en/error-messages-server.html#error_er_net_packet_too_large" data-external="true" target="_blank" rel="noopener noreferrer">ER_NET_PACKET_TOO_LARGE</a> error (PacketTooBigException / Packet for query is too large) is caused by the server-side  <code class="code">max_allowed_packet</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" data-external="true" target="_blank" rel="noopener noreferrer">configuration variable</a> set to a low value or left at the default one.</p><p id="ee770578">The variable controls the maximum size of MySQL communication buffer with 4MB being the default for Windows builds of MySQL 5.6, whereas in popular Linux distributions (e. g. Debian and Fedora Core), this variable defaults to 16MB, for both i686 and amd64 architectures.</p><ol class="list _decimal"><li class="list__item" id="ca15229e"><p id="f7e8dfae">Check the value of the <code class="code">max_allowed_packet</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" data-external="true" target="_blank" rel="noopener noreferrer">configuration variable</a> by either examining <code class="code">my.cnf / my.ini</code>, or via</p><div class="code-block" data-lang="bash">mysql&gt; show variables like 'max_allowed_packet';
</div></li><li class="list__item" id="77705d1d"><p id="5b6f6dd1">Increase (or explicitly set) the value of the <code class="code">max_allowed_packet</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/packet-too-large.html" data-external="true" target="_blank" rel="noopener noreferrer">configuration variable</a> in <code class="code">my.cnf</code> or <code class="code">my.ini</code>:</p><div class="code-block" data-lang="bash">[mysqld]
max_allowed_packet=16M

</div></li></ol><aside class="note " data-title="" rel="e594beb6" id="df136e77"><p id="d62af438">Setting a client-side value (via <code class="code">maxAllowedPacket</code> <a href="https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html" data-external="true" target="_blank" rel="noopener noreferrer">connection property</a> ) in the JDBC URL will have no effect,  as this value cannot exceed the server-side limit.</p></aside></div><a name="Databasecharacterset/collation-relatedproblems"></a><a name="Database-character-set/collation-related-problems"></a><div class="chapter"><h3 id="CommonProblems-Databasecharacterset/collation-relatedproblems">Database character set/collation-related problems</h3><a name="Characterset/collationmismatch"></a><a name="Character-set/collation-mismatch"></a><div class="chapter"><h4 id="CommonProblems-Characterset/collationmismatch">Character set/collation mismatch</h4><p id="58680d13">TeamCity reports character set/collation mismatch error: database tables/columns have a character set or collation that is not the same as the default character set or collation in your database schema. You may see this message if you are using a non-unicode character set as default for your database as TeamCity enforces unicode charset for some of the <code class="code">varchar</code> fields. Make sure you configured the database according to our <a href="setting-up-an-external-database.html">recommendations</a>.</p></div><a name="TeamCitydisplays????insteadofnationalsymbols"></a><a name="TeamCity-displays-????-instead-of-national-symbols"></a><div class="chapter"><h4 id="CommonProblems-TeamCitydisplays????insteadofnationalsymbols">TeamCity displays ???? instead of national symbols</h4><p id="aaede9e4">If you want to allow your local characters in texts in TeamCity (for example, VCS messages, test names, user names), you need to migrate to a database with the appropriate character set.</p></div><a name="&#34;Uniquekeyviolations&#34;or&#34;Duplicatesfound&#34;erroronrestorefrombackup"></a><a name="&#34;Unique-key-violations&#34;-or-&#34;Duplicates-found&#34;-error-on-restore-from-backup"></a><div class="chapter"><h4 id="CommonProblems-&#34;Uniquekeyviolations&#34;or&#34;Duplicatesfound&#34;erroronrestorefrombackup">"Unique key violations" or "Duplicates found" error on restore from backup</h4><p id="709380fa">TeamCity server restoration from a backup may fail with errors like <code class="code">"Unique key violation"</code> or <code class="code">"Duplicates found"</code> if the character sets (or collations) of the source and destination databases are not the same, and the cardinality of the destination character set is less than that of the source database.</p><p id="483a2f33">To resolve the problem, select and set up the proper character set (and collation) for the destination database.</p><p id="14d93f06">As for case sensitivity, the possible transitions are:</p><ul class="list _ul"><li class="list__item" id="78e5a65b"><p>CS &gt; CS</p></li><li class="list__item" id="9aae7a2b"><p>CI &gt; CS</p></li><li class="list__item" id="67137266"><p>CI &gt; CI</p></li></ul><p id="f599c764">However, it is recommended to always use CS.</p><p id="6d1a3b08">If the source character set is Unicode or UTF, the destination one must also be Unicode or UTF. If the source character set is 8-bit non-UTF, the destination one can be the same or Unicode/UTF.</p><p id="f83dd28f">This applies to TeamCity 6.0 and above.</p></div><a name="Resolvecharacterset/collation-relatedproblems"></a><a name="Resolve-character-set/collation-related-problems"></a><div class="chapter"><h4 id="CommonProblems-Resolvecharacterset/collation-relatedproblems">Resolve character set/collation-related problems</h4><p id="4ea661fb">To fix a problem, perform the following steps:</p><ol class="list _decimal"><li class="list__item" id="a91b9307"><p id="4ba6b416">Create a new database with the appropriate character set and collation. We recommend using a <b id="2576d73b">unicode case-sensitive</b> collation: see instructions for <a href="setting-up-an-external-database.html#On-PostgreSQL-server-side">PostgreSQL</a> and <a href="setting-up-an-external-database.html#On-MS-SQL-server-side">MySQL</a>. For MySQL, <code class="code">utf8_bin</code> or <code class="code">utf8mb4_bin</code> is preferred.<br>See also <a href="http://www.postgresql.org/docs/9.3/static/multibyte.html" data-external="true" target="_blank" rel="noopener noreferrer">PostgreSQL</a>, <a href="http://dev.mysql.com/doc/refman/5.0/en/charset-mysql.html" data-external="true" target="_blank" rel="noopener noreferrer">MySQL</a>, <a href="http://technet.microsoft.com/en-us/library/ms180175(v=sql.105).aspx" data-external="true" target="_blank" rel="noopener noreferrer">MS SQL</a> documentation for details on character set.</p></li><li class="list__item" id="2a93c586"><p id="b00889f7">Copy the current &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/config/database.properties file, and change the database references in the copy to the newly created database.</p></li><li class="list__item" id="e5da67ba"><p id="45f10d19">Stop the TeamCity server.</p></li><li class="list__item" id="b3d9e644"><p id="ff033557">Use the <code class="code">maintainDB</code> tool to migrate to the new database:</p><div class="code-block" data-lang="bash">maintainDB migrate [-A &lt;path-to-data-dir&gt;] -T &lt;new-database-properties-file&gt;

</div><p id="48e95e54">Depending on the size of your database, the migration may take from several minutes to several hours. For more information on the <code class="code">maintainDB tool</code>, see <a href="migrating-to-an-external-database.html#Full-Migration">this section</a>.</p></li><li class="list__item" id="515ec823"><p id="baf5542f">Upon the successful completion of the database migration, the <code class="code">maintainDB</code> tool should update the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/config/database.properties file with references to the new database. Ensure that the file has been updated. Edit the file manually if the tool fails to do it automatically.</p></li><li class="list__item" id="a0a2510a"><p id="2d587520">Start the TeamCity server.</p></li></ol><p id="7092be72"><b id="286c4d91"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes"></a><a name="MySQL-exception:-Specified-key-was-too-long--max-key-length-is-767-bytes"></a><div class="chapter"><h4 id="CommonProblems-MySQLexception:Specifiedkeywastoolongmaxkeylengthis767bytes">MySQL exception: Specified key was too long; max key length is 767 bytes</h4></div><a name="Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes"></a><a name="Index-column-size-too-large.-The-maximum-column-size-is-767-bytes"></a><div class="chapter"><h4 id="CommonProblems-Indexcolumnsizetoolarge.Themaximumcolumnsizeis767bytes">Index column size too large. The maximum column size is 767 bytes</h4><p id="ede738da">Check if the charater set of your MySQL  database. It is recommended to use the <code class="code">utf8</code> character set.</p><p id="9e0b0369">If your database uses the <code class="code">utf8mb4</code> character set (available since MySQL 5.5), set the following InnoDB configuration options (under <code class="code">[mysqld]</code> section in <code class="code">my.cnf</code> or <code class="code">my.ini</code>) for TeamCity 2017.2.1+ to run:</p><ul class="list _ul"><li class="list__item" id="988fccd0"><p><code class="code">innodb_large_prefix=1</code> for index key prefixes longer than 767 bytes (up to 3072 bytes) to be allowed for InnoDB tables that use DYNAMIC row format (deprecated in MySQL 5.7.7).</p></li><li class="list__item" id="9b19a827"><p><code class="code">innodb_file_format=Barracuda</code> to enable the DYNAMIC row format.</p></li><li class="list__item" id="046cc1e3"><p><code class="code">innodb_file_per_table=1</code> to enable the Barracuda file formatThe parameters above have the following default values:</p></li></ul><div class="table-wrapper"><table class=" wide" width="100%" id="b5ffe637"><thead><tr id="4b820995" class="ijRowHead"><th id="33ea7023"></th><th id="1b947d5c"><p id="cdf0ebd1">MySQL 5.5</p></th><th id="751d7609"><p id="bb537717">MySQL 5.6</p></th><th id="51367a33"><p id="0b9ce21f">MySQL 5.7</p></th><th id="11c7b44c"><p id="03fc5f3a">MariaDB 5.5</p></th><th id="60b39c00"><p id="efcf383b">MariaDB 10.0</p></th><th id="bc98180a"><p id="9838fc40">MariaDB 10.1</p></th><th id="a087a32d"><p id="48562daf">MariaDB 10.2</p></th></tr></thead><tbody><tr id="7e7beb7c" class="ijRowOdd"><td id="dd235fb1"><p id="d08422a7">innodb_large_prefix</p></td><td id="d2fd6935"><p id="bdf9034d">0</p></td><td id="0a9164a0"><p id="675ff711">0</p></td><td id="d65c4d43"><p id="3b574e8d">1</p></td><td id="47e63d94"><p id="f51b07fc">0</p></td><td id="5ffcce8a"><p id="1a150a8a">0</p></td><td id="2b82663e"><p id="cbc01d2e">0</p></td><td id="e2d4dc82"><p id="df6bd9b7">1</p></td></tr><tr id="b5eed29d" class="ijRowEven"><td id="1e60ad89"><p id="7748cc6e">innodb_file_format</p></td><td id="8b1398fb"><p id="07b9c876">Antelope</p></td><td id="ad831561"><p id="f653ea93">Antelope</p></td><td id="faab055d"><p id="dc214323">Barracuda</p></td><td id="0559dd04"><p id="00167aa1">Antelope</p></td><td id="12647eb5"><p id="500f26a4">Antelope</p></td><td id="d99245c3"><p id="13339098">Antelope</p></td><td id="6bd82a62"><p id="60e576b8">Barracuda</p></td></tr><tr id="c6d1ba76" class="ijRowOdd"><td id="7640931d"><p id="af34a6b3">innodb_file_per_table</p></td><td id="cc842adb"><p id="1588b31e">0</p></td><td id="3a1e165b"><p id="131ee2f6">1</p></td><td id="dcb68124"><p id="ca48ab79">1</p></td><td id="9c6f7809"><p id="28bbec7f">1</p></td><td id="302db4ab"><p id="bcfc44dc">1</p></td><td id="c93fc333"><p id="3d3c81cd">1</p></td><td id="667f1004"><p id="c997fffa">1</p></td></tr></tbody></table></div><p id="2694240c">Depending on the database server version, the following configuration changes need to be made:</p><p id="29628f42"><b id="f8a472b6">MySQL 5.5:</b></p><ul class="list _ul"><li class="list__item" id="41574bb4"><code class="code">innodb_large_prefix=1</code></li><li class="list__item" id="cb85e03d"><code class="code">innodb_file_format=Barracuda</code></li><li class="list__item" id="e8534c01"><code class="code">innodb_file_per_table=1</code></li></ul><p id="f1d43bba"><b id="2b42d3e4">MySQL 5.6 and MariaDB from 5.5 to 10.1:</b></p><ul class="list _ul"><li class="list__item" id="fc1f52ef"><code class="code">innodb_file_format=Barracuda</code></li><li class="list__item" id="73ae8790"><code class="code">innodb_file_per_table=1</code></li></ul><p id="f0f30c15">For <b id="e67fa23f">MySQL 5.7+ and MariaDB 10.2+</b> use the defaults, no changes are required.</p></div></div><a name="IncorrectstringvalueerrorinMySQL"></a><a name="-Incorrect-string-value--error-in-MySQL"></a><div class="chapter"><h3 id="CommonProblems-IncorrectstringvalueerrorinMySQL">'Incorrect string value' error in MySQL</h3><ol class="list _decimal"><li class="list__item" id="7d8c6d47"><p id="225cb81f">Use the <code class="code">utf8mb4</code> character set in MySQL and set up the MySQL server to use <code class="code">utf8mb4</code> by default using the following options in the <code class="code">[mysqld]</code> section in <code class="code">my.cnf</code>:</p><p id="224d5265"><code class="code">character_set_server = utf8mb4</code><br><code class="code">collation_server = utf8mb4_bin</code></p></li><li class="list__item" id="2a134d99"><p id="ab25aadc">Restart MySQL for the changes to <code class="code">my.cnf</code> to take effect.</p></li></ol><p id="e4ec729a"><b id="cee17e8a"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase"></a><a name="-This-driver-is-not-configured-for-integrated-authentication--error-with-MS-SQL-database"></a><div class="chapter"><h3 id="CommonProblems-ThisdriverisnotconfiguredforintegratedauthenticationerrorwithMSSQLdatabase">'This driver is not configured for integrated authentication' error with MS SQL database</h3><p id="ffc77077">During TeamCity installation, the following error might occur when connecting and creating the MS SQL database with Windows integrated security: "SQL error when doing: Taking a connection from the data source: This driver is not configured for integrated authentication."</p><p id="abf4193e">The most common reason for the problem is the different bitness of the <code class="code">sqljdbc_auth.dll</code> MS SQL shared library and the JRE used by TeamCity.</p><p id="7ffa66c8">To solve the problem, do the following:</p><ol class="list _decimal"><li class="list__item" id="4ef3218b"><p>Make sure you use the MS SQL native driver (downloadable from the <a href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=11774" data-external="true" target="_blank" rel="noopener noreferrer">Microsoft Download Center</a>).</p></li><li class="list__item" id="0ba9a7d7"><p>Use the right JRE bitness: ensure that you are running TeamCity using Java with the same bitness as your <code class="code">sqljdbc_auth.dll</code> MS SQL shared library. By default, TeamCity uses the 32-bit Java. However, both 32-bit and 64-bit Java versions <a href="installing-and-configuring-the-teamcity-server.html#Java-Installation">can be used</a>.</p></li></ol><p id="0162fbdd">To run TeamCity with the required JRE, do one of the following:* either set the <code class="code">TEAMCITY_JRE</code> environment variable* or remove the JRE bundled with TeamCity from  &lt;<a href="teamcity-home-directory.html">TeamCity home</a>&gt;\jre and set <code class="code">JAVA_HOME</code>.</p><aside class="note " data-title="" rel="0162fbdd" id="d43649db"><p id="728b4687">Note that on upgrade, TeamCity will overwrite the existing JRE with the default 32-bit version, so you'll have to update to the 64-bit JRE again after upgrade.</p></aside><p id="7d3d5e80">See also this related <a href="http://www.mikeobrien.net/blog/teamcity-sqlserver-integrated-security/" data-external="true" target="_blank" rel="noopener noreferrer">external posting</a>.</p></div><a name="Protocolviolationerror(Oracleonly)"></a><a name="Protocol-violation-error-(Oracle-only)"></a><div class="chapter"><h3 id="CommonProblems-Protocolviolationerror(Oracleonly)">Protocol violation error (Oracle only)</h3><p id="ef6e4cfb">This error can occur when the Oracle JDBC driver is not compatible with the Oracle server. For example, Oracle JDBC driver version 11.1 is not compatible with Oracle server version 10.2.</p><p id="2fc34020">In order to resolve the problem, use the Oracle JDBC driver from your Oracle server installation, or <a href="http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html" data-external="true" target="_blank" rel="noopener noreferrer">download the driver</a> of the same version as the Oracle server.</p><p id="f8997adf"><b id="51140a65"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div></div><a name="CommonMavenissues"></a><a name="Common-Maven-issues"></a><div class="chapter"><h2 id="CommonProblems-CommonMavenissues">Common Maven issues</h2><p id="e2a0500a">There are two kinds of Maven-related issues commonly seen in the TeamCity build configurations:</p><ul class="list _ul"><li class="list__item" id="43f2985e"><p>Error message on "Maven" tab of build configuration: "An error occurred during collecting Maven project information ... "</p></li><li class="list__item" id="3fce5742"><p>Error message in build configuration with Maven dependencies trigger activated: "Unable to check for Maven dependency Update ..."If the build configuration produces successful builds despite displaying such error messages, these errors are likely to be caused by the <b id="7d67ea73">server-side Maven misconfiguration</b>.</p></li></ul><p id="39886a0f">To collect information for the <b id="ae7b54f2">Maven</b> tab, or to perform Maven dependencies check (for the trigger), TeamCity runs the embedded Maven. The execution is performed on the <i id="0fd404ce">server</i> machine, and any <i id="15adc56e">agent-side</i> maven settings are <b id="7c73e0f5">not accessible</b>. TeamCity resolves the <code class="code">settings.xml</code> files on the server-side separately, as described in <a href="maven-server-side-settings.html">Maven Server-Side Settings</a>.</p><p id="cb6c28b5">It makes sense to check if the <code class="code">server-side settings.xml</code> files contain correct information about remote repositories, proxies, mirrors, profiles, credentials, and so on.</p><p id="f0577d30"><b id="1356a04f"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="&#34;Criticalerrorinconfigurationfile&#34;errors"></a><a name="&#34;Critical-error-in-configuration-file&#34;-errors"></a><div class="chapter"><h2 id="CommonProblems-&#34;Criticalerrorinconfigurationfile&#34;errors">"Critical error in configuration file" errors</h2><p id="cc61f6a8">If you encounter the error, it means the settings stored in the TeamCity Data Directory are in an inconsistent state. This can occur after manual change of the files or if newer version of TeamCity starts to report the inconsistencies.<br>To resolve the issue, you can edit the file noted in the message on the server file system. (make sure to create backup copy of the file before any manual edits). Usually server restart is not necessary for the changes to take effect.</p><p id="2b7617db"><b id="dc19cccf">VCS root with id "XXX" does not exist</b></p><p id="a44fc67a">The build configuration or template reference a VCS root which is not defined in the system. Remedy actions: Restore the VCS root or create a new VCS root with the id noted or edit the file noted in the message to remove the reference to the VCS root.</p><p id="cb2375c4"><b id="fa89d556"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="TeamCityinstallationproblems"></a><a name="TeamCity-installation-problems"></a><div class="chapter"><h2 id="CommonProblems-TeamCityinstallationproblems">TeamCity installation problems</h2><p id="a8f76c11">If the TeamCity web UI cannot be accessed after installation, you might be running TeamCity on a port that is already in use by another program. <a href="installing-and-configuring-the-teamcity-server.html#Installation-Configuration">Check and configure</a> your TeamCity installation.</p><p id="188e2461"><b id="8f044f57"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="ProblemswithTeamCityNuGetFeed"></a><a name="Problems-with-TeamCity-NuGet-Feed"></a><div class="chapter"><h2 id="CommonProblems-ProblemswithTeamCityNuGetFeed">Problems with TeamCity NuGet Feed</h2><p id="d2ffc3db">If you are experiencing issues with partial TeamCity NuGet Feed, i.e. missing NuGet packages etc., you might have to reindex the TeamCity NuGet Feed.</p><p id="541a561e">To force TeamCity to reindex all available packages and reset the NuGet package list, navigate to the server <b id="5d6133cd">Administration | Diagnostics | Caches</b> and use the <a href="teamcity-monitoring-and-diagnostics.html#Caches">buildsMetadata Reset</a> link.</p><p id="776860d4">For earlier versions, refer to <a href="https://confluence.jetbrains.com/display/TCD8/Common+Problems" data-external="true" target="_blank" rel="noopener noreferrer">this section</a>.</p><p id="8226b66a"><b id="542029b2"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div><a name="Problemswith.Net-relatedTeamCityTools"></a><a name="Problems-with-.Net-related-TeamCity-Tools"></a><div class="chapter"><h2 id="CommonProblems-Problemswith.Net-relatedTeamCityTools">Problems with .Net-related TeamCity Tools</h2><a name="Startupperformanceissues"></a><a name="Startup-performance-issues"></a><div class="chapter"><h3 id="CommonProblems-Startupperformanceissues">Startup performance issues</h3><p id="07aa941b">After upgrade to TeamCity 9.0 or later, .NET Framework below version 4.0 installed on TeamCity agents may cause performance issues of .Net-related TeamCity tools due to Code access security (CAS) policy imposed by Microsoft.</p><p id="513d620d">To solve the issue, use one of the options:</p><ol class="list _decimal"><li class="list__item" id="873214e6"><p id="c90bbcd5">Add the following setting described in the <a href="https://msdn.microsoft.com/en-us/library/bb629393%28v=vs.110%29.aspx" data-external="true" target="_blank" rel="noopener noreferrer">Microsoft documentation</a> to the <code class="code">machine.config</code> file on all agents:</p><div class="code-block" data-lang="bash">&lt;configuration&gt;
	    &lt;runtime&gt;
		    &lt;generatePublisherEvidence enabled="false"/&gt;
	    &lt;/runtime&gt;
&lt;/configuration&gt;

</div><p id="ad0f8c8e">You can modify the machine.config file as described in this <a href="http://blogs.msdn.com/b/amolravande/archive/2008/07/20/startup-performance-disable-the-generatepublisherevidence-property.aspx" data-external="true" target="_blank" rel="noopener noreferrer">external blog post</a> and pass this config file to all agents, e.g. using a custom script.</p></li><li class="list__item" id="6c96e44e"><p id="35cbbf0d">Alternatively, upgrade .Net Framework on the TeamCity agents to version 4.0 and above. Details are available in the <a href="https://msdn.microsoft.com/en-us/library/dd233103%28v=vs.100%29.aspx#simplification" data-external="true" target="_blank" rel="noopener noreferrer">Microsoft documentation</a>.</p></li></ol><p id="70ef1342"><b id="22e2c677"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p></div></div><a name="Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning"></a><a name="Using-tools-requiring-manual-input,-in-particular-Extended-Validation-code-signing"></a><div class="chapter"><h2 id="CommonProblems-Usingtoolsrequiringmanualinput,inparticularExtendedValidationcodesigning">Using tools requiring manual input, in particular Extended Validation code signing</h2><p id="e6f70581">You might want to use tools which require some manual interaction during the build procedure executed on the TeamCity agent. This is not a TeamCity-specific problem, so it should be approached using generic means.</p><p id="2cf3f777">Under WIndows, you might want to configure TeamCity agent to run not as a Service, but with access to the desktop by configuring automatic user logon, <a href="setting-up-and-running-additional-build-agents.html#Automatic-Agent-Start-under-Windows">related details</a>.</p><p id="b97e811a">There is no simple solution for Extended Validation (EV) code signing as the feature is built in for a reason. There is some discussion on the issue on <a href="https://stackoverflow.com/questions/17927895/automate-extended-validation-ev-code-signing=" data-external="true" target="_blank" rel="noopener noreferrer">stack overflow</a>. The appropriate solutoin seems to implement a dedicated service with own authorization approach and sign the binariies through it.</p><p id="ed421d11"><b id="fbcd14ee"><a href="#Most-frequently-used-documentation-sections">Back to top</a></b></p><hr id="156a4462"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>