<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>配置构建参数-帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Configuring Build Parameters" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-parameters.md|Configuring Build Parameters/project-and-agent-level-build-parameters.md|Project and Agent Level Build Parameters/typed-parameters.md|Typed Parameters/predefined-build-parameters.md|Predefined Build Parameters" data-main-title="Configuring Build Parameters" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/configuring-build-parameters.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="configuring-build-parameters.md" data-toc="Configuring Build Parameters">配置构建参数</h1><p id="3ea933d6">在此页：</p><p id="b2d061eb"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ConfiguringBuildParameters-TypesofBuildParameters">构建参数的类型</a></li><li class="list__item"><a href="#ConfiguringBuildParameters-Parameternamerestrictions">参数名称限制</a></li><li class="list__item"><a href="#ConfiguringBuildParameters-DefiningBuildParametersinBuildConfiguration">在构建配置中定义构建参数</a></li><li class="list__item"><a href="#ConfiguringBuildParameters-UsingBuildParametersinBuildConfigurationSettings">在构建配置设置中使用构建参数</a></li><li class="list__item"><a href="#ConfiguringBuildParameters-UsingBuildParametersinVCSLabelingPatternandBuildNumber">在VCS标记模式和内部版本号中使用内部版本参数</a></li><li class="list__item"><a href="#ConfiguringBuildParameters-UsingBuildParametersintheBuildScripts">在构建脚本中使用构建参数</a></li></ul><p></p><p id="10eea90f"><i id="97475124">构建参数</i>为您提供共享设置的灵活方法，以及将设置传递到构建中的便捷方法。</p><a name="TypesofBuildParameters"></a><a name="Types-of-Build-Parameters"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-TypesofBuildParameters">构建参数的类型</h2><p id="1d3efc0f">构建参数是由用户定义或由TeamCity提供的名称/值对，可在构建中使用。</p><p id="f3244d40">有三种类型的构建参数：</p><ul class="list _ul"><li class="list__item" id="61160b19"><p>环境变量（使用<code class="code">env.</code>前缀）作为环境传递到生成的生成过程中。</p></li><li class="list__item" id="9811d204"><p>系统属性（使用“ system。”前缀定义）作为特定于构建工具的变量传递到受支持的运行程序的构建脚本中（例如，Ant，MSBuild）。</p></li><li class="list__item" id="09b17452"><p>配置参数（无前缀）不会传递到构建中，仅用于共享构建配置中的设置。它们是自定义基于<a href="build-configuration-template.html">模板</a>或使用<a href="working-with-meta-runner.html">meta-runner</a>的构建配置的主要方法。</p></li></ul><p id="9629f442">TeamCity提供了一组<a href="predefined-build-parameters.html">预定义的参数</a> ，管理员也可以添加自定义参数。</p><p id="e422ea97">可以在不同级别（优先顺序）定义参数：</p><ul class="list _ul"><li class="list__item" id="d6cc6210"><p>特定的构建（通过<a href="triggering-a-custom-build.html">“运行自定义构建”</a>对话框）</p></li><li class="list__item" id="1c09210a"><p><b id="fef923d7">构建配置设置</b>或<a href="build-configuration-template.html">构建配置模板的</a> <b id="fef923d7">“</b> <b id="41a9cccd">参数”</b>页面</p></li><li class="list__item" id="29447cdf"><p><b id="46675860">项目设置</b>的<b id="2f9a74f4">参数</b>页;这些会影响项目及其子项目的所有构建配置和模板</p></li><li class="list__item" id="76a20cf0"><p>代理人（ <code class="code"><</code> <a href="agent-home-directory.html"><code class="code">Agent home</code></a> <code class="code">>/conf/buildAgent.properties</code>代理上的文件）</p></li></ul><p id="cd968753">任何文本设置都可以引用使字符串格式为<code class="code">%parameter.name%</code>在构建时用实际值替换。如果存在对未定义参数的引用，则将其视为<a href="agent-requirements.html#Implicit-Requirements">隐式代理要求，</a>因此，该构建将仅在定义了该参数的代理上运行。</p></div><a name="Parameternamerestrictions"></a><a name="Parameter-name-restrictions"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-Parameternamerestrictions">参数名称限制</h2><p id="a0ec827f"><b id="7ef51261">从2018.1开始</b> ，配置参数的名称应满足以下要求：</p><ul class="list _ul"><li class="list__item" id="85cd7b5f"><p>它仅应包含以下特征：<code class="code">[a-zA-Z0-9._-*]</code></p></li><li class="list__item" id="d95cbf36"><p>它应该以ASCII字母开头</p></li></ul><p id="aec66d05">如果参数名称不满足这些要求，TeamCity将在编辑参数页面上显示警告。</p><p id="ee25c318">对名称不满足上述限制的参数的引用不会产生<a href="agent-requirements.html#Implicit-Requirements">隐含的要求</a> 。</p></div><a name="DefiningBuildParametersinBuildConfiguration"></a><a name="Defining-Build-Parameters-in-Build-Configuration"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-DefiningBuildParametersinBuildConfiguration">在构建配置中定义构建参数</h2><p id="57a54347">在“构建配置”设置的“ <b id="2e65c72a">参数”</b>页面上，您可以定义启动构建时要传递到构建脚本和环境的必需系统属性和环境变量。请注意，您可以在启动<a href="triggering-a-custom-build.html">Custom Build</a>时重新定义它们。</p><p id="1912c4aa">在构建配置中定义的构建参数仅在此配置中使用。有关其他方式，请参考<a href="project-and-agent-level-build-parameters.html">项目和代理级别的构建参数</a> 。</p><p id="c4dd2c79">任何用户定义的构建参数（系统属性或环境变量）都可以使用以下格式来引用其他参数：</p><div class="code-block" data-lang="bash">％[env | system] .property_name％例如：system.tomcat.libs =％env.CATALINA_HOME％/ lib / *。jar</div></div><a name="UsingBuildParametersinBuildConfigurationSettings"></a><a name="Using-Build-Parameters-in-Build-Configuration-Settings"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-UsingBuildParametersinBuildConfigurationSettings">在构建配置设置中使用构建参数</h2><p id="814fdff9">在大多数构建配置设置中，您可以使用对构建参数的引用，而不使用实际值。开始构建之前，TeamCity使用可用参数解析所有引用。如果存在无法解析的引用，则将其保留下来，并且构建日志中将显示警告。</p><p id="098ce747">要引用构建参数，请使用百分号括起来的名称：例如， <code class="code">%teamcity.build.number%</code> 。</p><p id="520f97ba">在百分号之间出现的任何文本均被TeamCity视为对属性的引用。如果在构建配置中找不到该属性，则该引用将成为<i id="1e9ca0ed">隐式代理要求，</i>并且此类构建配置只能在定义了该属性的代理上运行。代理定义的值将在构建中使用。</p><p id="4f75ca77">如果要防止TeamCity将百分号中的文本视为对属性的引用，请使用两个百分号。每次出现“ <code class="code">%%</code> “在支持属性引用的值中将替换为” <code class="code">%</code>在将值传递给构建之前。例如，如果您想传递“ <code class="code">%Y%m%d%H%M%S</code>在构建中，将其更改为<code class="code">%%Y%%m%%d%%H%%M%%S</code> ”。</p><a name="WhereReferencesCanBeUsed"></a><a name="Where-References-Can-Be-Used"></a><h4 id="ConfiguringBuildParameters-WhereReferencesCanBeUsed">可以在哪里使用参考</h4><div class="table-wrapper"><table width="100%" id="c633cdd7"><thead><tr id="fd0cf725" class="ijRowHead"><th id="c48658d6"><p id="4f77e17c">设置组</p></th><th id="cc77ba8b"><p id="b30d1e5e">参考说明</p></th></tr></thead><tbody><tr id="59fdfbc8" class="ijRowOdd"><td id="0a6ff0a6"><p id="5b24d9b9">Build Runner设置，工件规范</p></td><td id="22a69c78"><p id="d98764bb">传递到构建中的任何属性</p></td></tr><tr id="e59747da" class="ijRowEven"><td id="2bedab4a"><p id="f483ad2f">用户定义的属性和环境变量</p></td><td id="c338bb5a"><p id="8e72538b">传递到构建中的任何属性</p></td></tr><tr id="a9e08028" class="ijRowOdd"><td id="fd1011a0"><p id="52cca6f4">内部编号格式</p></td><td id="40ecee89"><p id="acff76f0">仅<a href="predefined-build-parameters.html">预定义的服务器构建属性</a></p></td></tr><tr id="ee207348" class="ijRowEven"><td id="8dd41b11"><p id="bc7cc01b">VCS根目录和签出规则设置</p></td><td id="03e4fbc2"><p id="21a713a6">传递到构建中的任何属性</p></td></tr><tr id="cf160d7d" class="ijRowOdd"><td id="05ad3c38"><p id="13d93368">VCS标签图案</p></td><td id="55f383ab"><p id="ab41c77c"><code class="code">system.build.number</code>和<a href="predefined-build-parameters.html">服务器构建预定义属性</a></p></td></tr><tr id="a640f53e" class="ijRowEven"><td id="aab4876c"><p id="8380af2c">工件依赖项设置</p></td><td id="834b1378"><p id="8375d6da">仅<a href="predefined-build-parameters.html">预定义的服务器构建属性</a></p></td></tr></tbody></table></div><p id="a05904a8">如果在构建配置中引用了构建参数，但未在其中定义该参数，它将成为该配置的<a href="agent-requirements.html">代理要求</a> 。构建配置将仅在定义了此属性的代理上运行。</p><p id="05e8843e">密码字段也可以包含对参数的引用，尽管在这种情况下您看不到该引用，因为该引用被掩码为任何密码值。</p><p id="cda40651">有关使用和从依赖项覆盖参数的详细信息，请参阅<a href="predefined-build-parameters.html#Dependencies-Properties">本节</a> 。</p></div><a name="UsingBuildParametersinVCSLabelingPatternandBuildNumber"></a><a name="Using-Build-Parameters-in-VCS-Labeling-Pattern-and-Build-Number"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-UsingBuildParametersinVCSLabelingPatternandBuildNumber">在VCS标记模式和内部版本号中使用内部版本参数</h2><p id="61921172">在内部版本号模式和VCS标签模式中，您可以使用<code class="code">%[env|system].property_name%</code>引用服务器端已知属性的语法。这些是<a href="predefined-build-parameters.html#Server-Build-Properties">服务器</a>和<a href="predefined-build-parameters.html#Configuration-Parameters">参考的</a>预定义属性，以及在“ <b id="c719d499">参数”</b>页面上的构建配置设置中定义的属性。<br>例如，VCS版本号： <code class="code">%build.vcs.number%</code> 。</p></div><a name="UsingBuildParametersintheBuildScripts"></a><a name="Using-Build-Parameters-in-the-Build-Scripts"></a><div class="chapter"><h2 id="ConfiguringBuildParameters-UsingBuildParametersintheBuildScripts">在构建脚本中使用构建参数</h2><p id="0e31ecbc">所有构建参数均以<code class="code">env.</code>前缀（环境变量）被传递到构建的过程环境中（省略前缀）。</p><p id="ce44d0a6">所有构建参数均以<code class="code">system.</code>前缀（系统属性）被传递到受支持的<b id="9f608189">构建脚本引擎，并且可以在此处由属性名引用</b> ，而无需<code class="code">system.</code>字首。<br>请注意，此语法将<b id="878966e7">在构建脚本中</b>起作用（ <b id="b76af1c6">不适</b>用于TeamCity设置）：</p><ul class="list _ul"><li class="list__item" id="602cdf35"><p id="c1868512">对于<a href="ant.html">Ant</a> ， <a href="maven.html">Maven</a>和<a href="nant.html">NAnt</a> ，请使用<code class="code">$(<property name>)</code></p></li><li class="list__item" id="4c2e3091"><p id="6fe4bd93">对于<a href="msbuild.html">MSBuild</a> （Visual Studio 2005/2008项目文件），请使用<code class="code">$(<property name>)</code> 。请注意，MSBuild不支持带点号（ <code class="code">.</code> “），因此您需要替换” <code class="code">.</code> “与” <code class="code">_</code>在构建脚本中使用属性时”。</p></li><li class="list__item" id="ccbd5adc"><p id="6bd60d2d">对于<a href="gradle.html">Gradle</a> ：TeamCity系统属性可以作为Gradle属性来访问（类似于<code class="code">gradle.properties</code>文件），并按以下方式引用：<br>a）允许用作Groovy标识符的名称（属性名称不包含点）：</p><div class="code-block" data-lang="bash">“自定义用户属性值为$ \ {customUserProperty \}”</div><p id="4fd09469">b）不允许将名称用作Groovy标识符（属性名称包含点：例如， <code class="code">build.vcs.number.1</code> ）：<code class="code">project.ext["build.vcs.number.1"]</code></p></li></ul><aside class="note " rel="120bc23b" id="9da78502" data-title=""><p id="760080db">使用<code class="code">teamcity["<property name>"]</code>不建议使用，尽管仍受支持。</p></aside><p id="420d8fca">当TeamCity启动构建过程时，将使用以下优先级的构建参数（顶部的优先级更高）：</p><ul class="list _ul"><li class="list__item" id="83a978fc"><p><a href="project-and-agent-level-build-parameters.html">项目和代理级别构建参数</a>文件中的<a href="project-and-agent-level-build-parameters.html">参数</a> 。</p></li><li class="list__item" id="537f9067"><p><a href="predefined-build-parameters.html">预定义</a>参数。</p></li><li class="list__item" id="83a0163d"><p>在“运行自定义构建”对话框中定义的参数。</p></li><li class="list__item" id="09c8f863"><p>构建配置中定义的参数。</p></li><li class="list__item" id="e0f0ae9b"><p>项目中定义的参数（为项目定义的参数将被其所有子项目和构建配置继承。如果需要，可以在构建配置中重新定义它们。</p></li><li class="list__item" id="94525c53"><p>模板中定义的参数（如果有）。</p></li><li class="list__item" id="a882f227"><p>代理程序中定义的参数<code class="code">buildAgent.properties</code>文件。</p></li><li class="list__item" id="b9852f4c"><p>Build Agent进程本身的环境变量。</p></li></ul><p id="0646fd72">生成的参数集也保存到文件中，构建脚本可以访问该文件。看到<code class="code">teamcity.build.properties.file</code>系统属性或<code class="code">TEAMCITY_BUILD_PROPERTIES_FILE</code>有关详细信息，请参见<a href="predefined-build-parameters.html">预定义的构建参数中的</a>环境变量描述。</p><hr id="ead7a869"><p id="64cddfde"><b id="5533c010">也可以看看：</b></p><p id="1091311f"><b id="7b3bc66b">管理员指南</b> ： <a href="project-and-agent-level-build-parameters.html">项目和代理级别的构建参数</a> <a href="predefined-build-parameters.html">预定义的构建参数</a> | <a href="configuring-agent-requirements.html">配置代理要求</a></p><hr id="5246b587"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>