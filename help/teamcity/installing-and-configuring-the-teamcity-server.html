<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Installing and Configuring the TeamCity Server - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Installing and Configuring the TeamCity Server" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/installation-and-upgrade.md|Installation and Upgrade/installation.md|Installation/installing-and-configuring-the-teamcity-server.md|Installing and Configuring the TeamCity Server/csrf-protection.md|CSRF Protection/running-teamcity-stack-in-aws.md|Running TeamCity Stack in AWS" data-main-title="Installing and Configuring the TeamCity Server" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/installing-and-configuring-the-teamcity-server.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Installing and Configuring the TeamCity Server" id="installing-and-configuring-the-teamcity-server.md">Installing and Configuring the TeamCity Server</h1><p id="899336ca">This page covers a new TeamCity server installation. For <b id="e7afdee9">upgrade instructions</b>, refer to <a href="upgrade.html">Upgrade</a>.</p><p id="c3cab793">On this page:</p><p id="74c25b6d"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-InstallingTeamCityServer">Installing TeamCity Server</a><ul class="list _bullet"><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-InstallingTeamCityviaWindowsinstallationpackage">Installing TeamCity via Windows installation package</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-InstallingTeamCitybundledwithTomcatservletcontainer(Linux,macOS,Windows)">Installing TeamCity bundled with Tomcat servlet container (Linux, macOS, Windows)</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-InstallingTeamCityintoExistingJ2EEContainer">Installing TeamCity into Existing J2EE Container</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-UnattendedTeamCityserverinstallation">Unattended TeamCity server installation</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-UsinganotherVersionofTomcat">Using another Version of Tomcat</a></li></ul></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-StartingTeamCityserver">Starting TeamCity server</a><ul class="list _bullet"><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-AutostartTeamCityserveronmacOS">Autostart TeamCity server on macOS</a></li></ul></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-InstallationConfiguration">Installation Configuration</a><ul class="list _bullet"><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-TroubleshootingTeamCityInstallation">Troubleshooting TeamCity Installation</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-ChangingServerPort">Changing Server Port</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-ChangingServerContext">Changing Server Context</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-JavaInstallation">Java Installation</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-Using64bitJavatoRunTeamCityServer">Using 64 bit Java to Run TeamCity Server</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-SettingUpMemorysettingsforTeamCityServer">Setting Up Memory settings for TeamCity Server</a></li></ul></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-ConfiguringTeamCityServer">Configuring TeamCity Server</a><ul class="list _bullet"><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-ConfiguringTeamCityDataDirectory">Configuring TeamCity Data Directory</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-EditingServerConfiguration">Editing Server Configuration</a></li><li class="list__item"><a href="#InstallingandConfiguringtheTeamCityServer-ConfiguringServerforProductionUse">Configuring Server for Production Use</a></li></ul></li></ul></p><p id="c621053a">To install a TeamCity server, perform the following:</p><ol class="list _decimal"><li class="list__item" id="cc27b9fa"><p>Choose the appropriate TeamCity distribution (<code class="code">.exe</code>, <code class="code">.tar.gz</code> or <a href="https://hub.docker.com/r/jetbrains/teamcity-server/" data-external="true" target="_blank" rel="noopener noreferrer">Docker image</a>) based on the details below. You can also <a href="running-teamcity-stack-in-aws.html">run TeamCity on AWS</a> stack.</p></li><li class="list__item" id="c53a196d"><p><a href="http://www.jetbrains.com/teamcity/download/" data-external="true" target="_blank" rel="noopener noreferrer">Download</a> the distribution.</p></li><li class="list__item" id="128be71f"><p>Review <a href="supported-platforms-and-environments.html">software requirements</a> and <a href="how-to.html#Estimate-Hardware-Requirements-for-TeamCity">hardware requirements notes</a> and <a href="how-to.html#Choose-OS/Platform-for-TeamCity-Server">platform selection</a>.</p></li><li class="list__item" id="c46dc508"><p>Review TeamCity <a href="licensing-policy.html">Licensing Policy</a>.</p></li><li class="list__item" id="a15c7c09"><p>Install and configure the TeamCity server per instructions below.</p></li></ol><a name="InstallingTeamCityServer"></a><a name="Installing-TeamCity-Server"></a><div class="chapter"><h2 id="InstallingandConfiguringtheTeamCityServer-InstallingTeamCityServer">Installing TeamCity Server</h2><p id="8ab33540">After you have selected one of the <a href="installation.html#Select-TeamCity-Installation-Package">TeamCity installation options</a>, proceed with corresponding installation instructions:</p><ul class="list _ul"><li class="list__item" id="e5a65836"><p><a href="#Installing-TeamCity-via-Windows-installation-package">Windows .exe distribution</a> - the executable which provides the installation wizard for Windows platforms and allows installing the server as a Windows service;</p></li><li class="list__item" id="c6d6c88e"><p><a href="#Installing-TeamCity-bundled-with-Tomcat-servlet-container-(Linux,-macOS,-Windows)">.tar.gz distribution</a> - the archive with a "portable" version suitable for all platforms;</p></li><li class="list__item" id="b53c5764"><p>Docker image - check the instructions at the <a href="https://hub.docker.com/r/jetbrains/teamcity-server/" data-external="true" target="_blank" rel="noopener noreferrer">image page</a>;</p></li><li class="list__item" id="2112c99c"><p><a href="#Installing-TeamCity-into-Existing-J2EE-Container">.war distribution</a> - for experienced users who want to run TeamCity in a separately installed Web application server. Consider using <code class="code">.tar.gz</code> distribution instead. <code class="code">.war</code> is not recommended to use unless really required (please <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">let us know</a> the reasons).</p></li></ul><p id="0e1cd5af">Compared to the <code class="code">.war</code> distribution, the <code class="code">.exe</code> and <code class="code">.tar.gz</code> distributions:</p><ul class="list _ul"><li class="list__item" id="b2eeb799"><p>include a Tomcat version which TeamCity is tested with, so it is known to be a working combination. This might not be the case with an external Tomcat.</p></li><li class="list__item" id="da9d1d53"><p>define additional JRE options which are usually recommended for running the server</p></li><li class="list__item" id="5f10c2b8"><p>have the <a href="#Starting-TeamCity-server">teamcity-server startup script</a> which provides several convenience options (for example, separate environment variable for memory settings) and configures TeamCity correctly (for example,. log4j configuration)</p></li><li class="list__item" id="5fbf85cb"><p>(at least under Windows) provide better error reporting for some cases (like a missing Java installation)</p></li><li class="list__item" id="ef9e15f0"><p>under Windows, allow running TeamCity as a service with the ability to use the same configuration as if run from the console</p></li><li class="list__item" id="3e74ff9f"><p>come bundled with a build agent distribution and single startup script which allows for easy TeamCity server evaluation with one agent</p></li><li class="list__item" id="f0850989"><p>come bundled with the devPackage for <a href="https://confluence.jetbrains.com/display/TCD18/Developing+TeamCity+Plugins" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity plugin development</a>.</p></li><li class="list__item" id="7bdfde61"><p>may provide more convenience features in the future</p></li></ul><p id="7cda3336">After installation, the TeamCity web UI can be accessed via a web browser. The default addresses are <a href="http://localhost/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost/</a> for Windows distribution and <a href="http://localhost:8111/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost:8111/</a> for the <code class="code">tar.gz</code> distribution.</p><p id="f4b13bfe">If you cannot access the TeamCity web UI after successful installation, please refer to the <a href="#Troubleshooting-TeamCity-Installation">Troubleshooting TeamCity Installation</a> section.</p><p id="6aa0b469">The build server and one build agent will be installed by default for Windows, Linux or macOS. If you need more build agents, refer to the <a href="setting-up-and-running-additional-build-agents.html">Installing Additional Build Agents</a> section.</p><aside class="warning " data-title="" rel="6aa0b469" id="dd80ebd2"><p id="da21e41d">During the server setup you can select either an internal database or an existing external database. By default, TeamCity uses an HSQLDB database that does not require configuring. This database suites the purposes of testing and evaluating the system. For <a href="#Configuring-Server-for-Production-Use">production purposes</a>, using a standalone external database is recommended.</p></aside><a name="InstallingTeamCityviaWindowsinstallationpackage"></a><a name="Installing-TeamCity-via-Windows-installation-package"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-InstallingTeamCityviaWindowsinstallationpackage">Installing TeamCity via Windows installation package</h3><p id="99107590">For the Windows platform, run the executable file and follow the installation instructions. You have options to install the TeamCity web server and one build agent that can be run as a Windows service.</p><p id="5c0f662b">If you opted to install the services, use the standard Windows <code class="code">Services</code> applet to manage the service. Otherwise, use standard <a href="#Starting-TeamCity-server">scripts</a>.</p><p id="58a665d0">If you did not change the default port (80) during the installation, the TeamCity web UI can be accessed via <a href="http://localhost/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost/</a> in a web browser running on the same machine where the server is installed. Note that port 80 can be used by other programs (for example, Skype, or other web servers like IIS). In this case you can specify another port during the installation and use <a href="http://localhost:<port&gt;/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost:&lt;port&gt;/</a> address in the browser.</p><p id="7e58f421">If you want to edit the TeamCity server's service parameters, memory settings or system properties after the installation, refer to the <a href="configuring-teamcity-server-startup-properties.html">Configuring TeamCity Server Startup Properties</a> page.</p><aside class="warning " data-title="" rel="7e58f421" id="571a01bb"><p id="990a4784">Make sure the user account specified for the service has:</p><ul class="list _ul"><li class="list__item" id="3e01cb66"><p>log on as service right (<a href="https://technet.microsoft.com/en-us/library/cc794944%28v=ws.10%29.aspx" data-external="true" target="_blank" rel="noopener noreferrer">related Microsoft page</a>)</p></li><li class="list__item" id="999ec99b"><p>write permissions for the <a href="teamcity-data-directory.html">TeamCity Data Directory</a>,</p></li><li class="list__item" id="3d18879c"><p>write permissions for the <a href="teamcity-home-directory.html">TeamCity Home</a>, i.e. directory where TeamCity was installed,</p></li><li class="list__item" id="e9d19450"><p>all the necessary permissions to work with the external systems like version controls, etc.</p></li></ul><p id="aefdcabe">By default, the Windows service is installed under the SYSTEM account. To change it, use the Services applet (<b id="f3492cd7">Control Panel | Administrative Tools | Services</b>).</p></aside></div><a name="InstallingTeamCitybundledwithTomcatservletcontainer(Linux,macOS,Windows)"></a><a name="Installing-TeamCity-bundled-with-Tomcat-servlet-container-(Linux,-macOS,-Windows)"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-InstallingTeamCitybundledwithTomcatservletcontainer(Linux,macOS,Windows)">Installing TeamCity bundled with Tomcat servlet container (Linux, macOS, Windows)</h3><p id="5ea8bc54">Review <a href="supported-platforms-and-environments.html#TeamCity-Server">software requirements</a> before the installation.</p><p id="fcc2582f">Unpack the <code class="code">TeamCity&lt;version number&gt;.tar.gz</code> archive (for example, using the <code class="code">tar xfz TeamCity&lt;version number&gt;.tar.gz</code> command under Linux, or the WinZip, WinRar or similar utility under Windows). Use GNU tar to unpack (for example, Solaris 10 tar is reported to truncate too long file names and may cause a <code class="code">ClassNotFoundException</code> when using the server after such unpacking. Consider getting GNU tar at <a href="http://sunfreeware.com/" data-external="true" target="_blank" rel="noopener noreferrer">Solaris packages</a> or using the <code class="code">gtar xfz</code> command).</p><p id="abdf34ad">Ensure you have JRE or JDK installed and the JAVA_HOME environment variable is pointing to the Java installation directory. Java JDK 1.8.0_16 or later is required.</p></div><a name="InstallingTeamCityintoExistingJ2EEContainer"></a><a name="Installing-TeamCity-into-Existing-J2EE-Container"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-InstallingTeamCityintoExistingJ2EEContainer">Installing TeamCity into Existing J2EE Container</h3><p id="626b892f">It is <b id="4dde7350">not recommended</b> to use .war distribution. Use the <a href="#Installing-TeamCity-bundled-with-Tomcat-servlet-container-(Linux,-macOS,-Windows)">TeamCity .tar.gz</a> distribution (bundled with Tomcat web server) instead. If you have important reasons to deploy TeamCity into existing web server and want to use .war distribution, please <a href="https://confluence.jetbrains.com/display/TW/Feedback" data-external="true" target="_blank" rel="noopener noreferrer">let us know</a> the reasons.See <a href="supported-platforms-and-environments.html#TeamCity-Server">Supported Platforms and Environments</a> for J2EE container requirements.</p><ol class="list _decimal"><li class="list__item" id="f77ce3e0"><p id="c102abe4">Make sure your web application server is stopped.</p></li><li class="list__item" id="e6dd33fe"><p id="cfea5c6a">Copy the downloaded <code class="code">TeamCity&lt;version number&gt;.war</code> file into the web applications directory of your J2EE container under the <code class="code">TeamCity.war</code> name (the name of the file is generally used as a part of the URL) or deploy the .war following the documentation of the web server. Make sure there is no other version of TeamCity deployed (e.g. do not preserve the old TeamCity web application directory under the web server applications directory).</p></li><li class="list__item" id="a676475e"><p id="3b58d15f">Ensure the TeamCity web application gets sufficient amount of <a href="#Setting-Up-Memory-settings-for-TeamCity-Server">memory</a>. Increase the memory accordingly if you have other web applications running in the same JVM.</p></li><li class="list__item" id="60b1a901"><p id="6994f69e">If you are deploying TeamCity to the <b id="2be8f80e">Tomcat</b> container, add the <code class="code">useBodyEncodingForURI="true"</code> attribute to the main <code class="code">Connector</code> tag for the server in the <code class="code">Tomcat/conf/server.xml</code> file.</p></li><li class="list__item" id="7680f86c"><p id="61369a85">If you are deploying TeamCity to <b id="bcbdbd89">Jetty</b> container version &gt; 7.5.5 (including 8.x.x), make sure the system property <code class="code">org.apache.jasper.compiler.disablejsr199</code> is set to <code class="code">true</code></p></li><li class="list__item" id="4c8fd2f6"><p id="17dba097">Ensure that the servlet container is configured to unpack the deployed war files. Though for most servlet containers it is the default behavior, for some it is not (for example, Jetty version &gt; 7.0.2) and should be explicitly configured. TeamCity is not able to work from a packed .war: if started this way, there will be a note on this the logs and UI.</p></li><li class="list__item" id="fb33e85c"><p id="0f23903a">Configure the appropriate <a href="teamcity-data-directory.html">TeamCity Data Directory</a> to be used by TeamCity. Note that it is recommended to start with an empty TeamCity Data Directory. After completing the installation and performing the first TeamCity server start, the required data (for example, <a href="setting-up-an-external-database.html#Database-Configuration-Properties">database settings</a> file) can be moved to the directory.</p></li><li class="list__item" id="5fd4ec13"><p id="73b038c3">Check/configure the TeamCity <a href="teamcity-server-logs.html#General-Logging-Configuration">logging properties</a> by specifying the <code class="code">log4j.configuration</code> and <code class="code">teamcity_logs</code> internal properties.</p></li><li class="list__item" id="a55bdd08"><p id="335c3d42">Restart the server or deploy the application via the servlet container administration interface and access <a href="http://serverport" data-external="true" target="_blank" rel="noopener noreferrer">http://server:port/TeamCity/</a>, where <code class="code">TeamCity</code> is the name of the <code class="code">war</code> file.</p></li></ol></div><a name="UnattendedTeamCityserverinstallation"></a><a name="Unattended-TeamCity-server-installation"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-UnattendedTeamCityserverinstallation">Unattended TeamCity server installation</h3><p id="afe9a639">For automated server installation, use the <code class="code">.tar.gz</code> distribution.</p><p id="44636974">Typically, you will need to unpack it and make the script perform the steps noted in the <a href="#Configuring-Server-for-Production-Use">Configuring Server for Production Use</a> section.</p><p id="e5a974ac">If you want to get a pre-configured server right away, put files from a previously configured server into the Data Directory. For each new server you will need to ensure it points to a new database (configured in <code class="code">&lt;Data Directory&gt;\config\database.properties</code>) and change <code class="code">&lt;Data Directory&gt;\config\main-config.xml</code> file not to have the <code class="code">uuid</code> attribute in the root XML element (so new one can be generated) and setting appropriate value for "rootURL" attribute.</p></div><a name="UsinganotherVersionofTomcat"></a><a name="Using-another-Version-of-Tomcat"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-UsinganotherVersionofTomcat">Using another Version of Tomcat</h3><p id="4bc52238">To use another version of the Tomcat web server instead of the one bundled in the <code class="code">.tar.gz</code> and <code class="code">.exe</code> distributions), you can either use the <a href="#Installing-TeamCity-into-Existing-J2EE-Container">.war TeamCity distribution</a> (not recommended) or perform the Tomcat upgrade/patch for TeamCity installed from the <code class="code">.exe</code> or <code class="code">.tar.gz</code> distributions.</p><p id="c7ec27c7">For the latter, you might want to:</p><ul class="list _ul"><li class="list__item" id="2321ee03"><p>backup the current <a href="teamcity-home-directory.html">TeamCity home</a></p></li><li class="list__item" id="b89afb9a"><p>delete/move out the directories from the <a href="teamcity-home-directory.html">TeamCity home</a> which are also present in the Tomcat distribution</p></li><li class="list__item" id="33f89c63"><p>unpack the Tomcat distribution into the <a href="teamcity-home-directory.html">TeamCity home directory</a></p></li><li class="list__item" id="a5e9c310">copy TeamCity-specific files from the previously backed-up/moved directories to the <a href="teamcity-home-directory.html">TeamCity home</a>. Namely:<ul class="list _ul"><li class="list__item" id="54f69690"><p>files under <code class="code">bin</code> which are not present in the Tomcat distribution</p></li><li class="list__item" id="e468b7e6"><p>review differences between the default Tomcat <code class="code">conf</code> directory and one from TeamCity, update Tomcat files with TeamCity-specific settings (teamcity-* files, and portions of <code class="code">server.xml</code>)</p></li><li class="list__item" id="153adb73"><p>delete the default Tomcat <code class="code">webapps/ROOT</code> directory and replace it with the one provided by TeamCity</p></li></ul></li></ul></div></div><a name="StartingTeamCityserver"></a><a name="Starting-TeamCity-server"></a><div class="chapter"><h2 id="InstallingandConfiguringtheTeamCityServer-StartingTeamCityserver">Starting TeamCity server</h2><p id="89affe64">Under Windows, if TeamCity server is installed as a Windows service, follow the usual procedure of starting and stopping services.</p><p id="b5e9d9ad">If TeamCity is installed using the <code class="code">.exe</code> or <code class="code">.tar.gz</code> distributions, the TeamCity server can be started and stopped by the <code class="code">teamcity-server</code> scripts provided in the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;/bin directory. The script accepts <code class="code">run</code> (run in the same console), <code class="code">start</code> (start new detached process and exit from the script), and <code class="code">stop</code> commands.</p><ul class="list _ul"><li class="list__item" id="871983fe"><p id="881434de"><b id="73e9a986">(evaluation only) To start/stop the TeamCity server and one default agent at the same time</b>, use the <code class="code">runAll</code> script, for example:</p><ul class="list _ul"><li class="list__item" id="da3d1ed3"><p>Use <code class="code">runAll.bat start</code> to start the server and the default agent</p></li><li class="list__item" id="077fafec"><p>Use <code class="code">runAll.bat stop</code> to stop the server and the default agent</p></li></ul></li><li class="list__item" id="9d3eccd0"><p id="479ec412"><b id="b07613fd">To start/stop the TeamCity server only</b>, use the <code class="code">teamcity-server</code> scripts and pass the required parameters. Start the script without parameters to see the usage instructions. The <code class="code">teamcity-server</code> scripts support the following options for the <code class="code">stop</code> command:</p><ul class="list _ul"><li class="list__item" id="50707fba"><p><code class="code">stop n</code> – sends the stop command to the TeamCity server and waits up to n seconds for the process to end.</p></li><li class="list__item" id="6f1f1154"><p><code class="code">stop n -force</code> – sends the stop command to the TeamCity server, waits up to n seconds for the process to end, and terminates the server process if it did not stop.</p></li></ul></li></ul><aside class="tip sideblock" data-title="" rel="eed939c0" id="3dd28af9"><p id="e949fc82">The TeamCity server will restart automatically if the server process exits (crashes or is killed) without invoking <code class="code">teamcity-server stop</code> script.</p></aside><p id="9bab7d26">By default, TeamCity runs on <a href="http://localhost:8111/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost:8111/</a>. See the information <a href="#Changing-Server-Port">below</a> for changing the server port.</p><p id="b49f1ba2">If you need to pass special properties to the server, refer to <a href="configuring-teamcity-server-startup-properties.html">Configuring TeamCity Server Startup Properties</a>.</p><p id="41350a93">If TeamCity is installed into an existing web server (.war distribution), start the server according to its documentation. Make sure you configure TeamCity-specific logging-related properties and pass suitable <a href="#Setting-Up-Memory-settings-for-TeamCity-Server">memory options</a>.</p><a name="AutostartTeamCityserveronmacOS"></a><a name="Autostart-TeamCity-server-on-macOS"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-AutostartTeamCityserveronmacOS">Autostart TeamCity server on macOS</h3><p id="9110544b">Starting up TeamCity server on macOS is quite similar to starting Tomcat on macOS.</p><p id="78bc89f6">1. Install TeamCity and make sure it works if started from the command line with <code class="code">bin/teamcity-server.sh start</code>. We'll assume that TeamCity is installed in the /Library/TeamCity folder</p><p id="54190e7d">2. Create the <code class="code">/Library/LaunchDaemons/jetbrains.teamcity.server.plist</code> file with the following content:</p><div class="code-block" data-lang="markup">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
	&lt;key&gt;WorkingDirectory&lt;/key&gt;
	&lt;string&gt;/Library/TeamCity&lt;/string&gt;
	&lt;key&gt;Debug&lt;/key&gt;
	&lt;false/&gt;
	&lt;key&gt;Label&lt;/key&gt;
	&lt;string&gt;jetbrains.teamcity.server&lt;/string&gt;
	&lt;key&gt;OnDemand&lt;/key&gt;
	&lt;false/&gt;
	&lt;key&gt;KeepAlive&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;ProgramArguments&lt;/key&gt;
	&lt;array&gt;
        &lt;string&gt;/bin/bash&lt;/string&gt;
        &lt;string&gt;--login&lt;/string&gt;
        &lt;string&gt;-c&lt;/string&gt;
        &lt;string&gt;bin/teamcity\-server.sh run&lt;/string&gt;
    &lt;/array&gt;
	&lt;key&gt;RunAtLoad&lt;/key&gt;
	&lt;true/&gt;
	&lt;key&gt;StandardErrorPath&lt;/key&gt;
	&lt;string&gt;logs/launchd.err.log&lt;/string&gt;
	&lt;key&gt;StandardOutPath&lt;/key&gt;
	&lt;string&gt;logs/launchd.out.log&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;

</div><p id="6dd4cfab">3. Test your file by running this command:</p><div class="code-block" data-lang="bash">launchctl load /Library/LaunchDaemons/jetbrains.teamcity.server.plist

</div><p id="437d8af8">This command should start the TeamCity server (you can see this from <code class="code">logs/teamcity-server.log</code> and in your browser).</p><p id="c63e30e6">4. If you don't want TeamCity to start under the root permissions, specify the <b id="2b6b1fdd">UserName</b> key in the plist file, for example:</p><div class="code-block" data-lang="markup">&lt;key&gt;UserName&lt;/key&gt;
&lt;string&gt;teamcity_user&lt;/string&gt;

</div><p id="c3c7f8ed">The TeamCity server will now start automatically when the machine starts. To configure automatic start of a TeamCity Build Agent, see the <a href="setting-up-and-running-additional-build-agents.html#Automatic-Start">dedicated section</a>.</p></div></div><a name="InstallationConfiguration"></a><a name="Installation-Configuration"></a><div class="chapter"><h2 id="InstallingandConfiguringtheTeamCityServer-InstallationConfiguration">Installation Configuration</h2><a name="TroubleshootingTeamCityInstallation"></a><a name="Troubleshooting-TeamCity-Installation"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-TroubleshootingTeamCityInstallation">Troubleshooting TeamCity Installation</h3><p id="92063359">Upon successful installation, the TeamCity server web UI can be accessed via a web browser. The default address that can be used to access TeamCity from the same machine depends on the installation package and installation options. (Port 80 is used for Windows installation, unless another port is specified, port 8111 for <code class="code">.tar.gz</code> installation unless not changed in the server configuration).</p><p id="a3939048">If the TeamCity web UI cannot be accessed, check the following:</p><ul class="list _ul"><li class="list__item" id="2ac2f7b2"><p>the "TeamCity Server" service is running (if you installed TeamCity as a Windows service)</p></li><li class="list__item" id="1b50be08"><p>the TeamCity server process (Tomcat) is running (it is a <code class="code">java</code> process run in the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;/bin directory)</p></li><li class="list__item" id="c4ec85b9"><p>the console output if you run the server from a console</p></li><li class="list__item" id="572135af"><p>the <code class="code">teamcity-server.log</code> and other files in the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\logs directory for error messages</p></li></ul><p id="74cf9b7b">One of the most common issues with the server installation is using a port that is already used by another program. See <a href="#Changing-Server-Port">below</a> on changing the default port.</p></div><a name="ChangingServerPort"></a><a name="Changing-Server-Port"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-ChangingServerPort">Changing Server Port</h3><p id="aa23942d">If you use the TeamCity server Windows installer, you can set the port to be used during installation.</p><p id="91e12c31">Use the following instructions to change the port if you use the <code class="code">.tar.gz</code> distribution. If another application uses the same port as the TeamCity server, the TeamCity server (Tomcat server) won't start and this will be identified by "Address already in use" errors in the server logs or server console.</p><p id="a68092e6">To change the server port, in the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;/conf/server.xml file, change the port number in the not commented <code class="code">&lt;Connector&gt;</code> XML node (here the port number is 8111):</p><div class="code-block" data-lang="markup">&lt;Connector port="8111" ...

</div><p id="dc610df9">To apply the changes, restart the server. If the server was working with the old port previously, you would need to change the port in all the stored URLs of the server (browser bookmarks, agents' serverUrl <a href="build-agent-configuration.html">property</a>, URL in user's IDEs, <code class="code">Server URL</code> setting on the <b id="32ea897b">Administration | Global Settings</b> page).</p><p id="7a7590d9">If you run another Tomcat server on the same machine, you might need to also change other Tomcat server service ports (search for <code class="code">port=</code> in the <code class="code">server.xml</code> file).</p><p id="0db240aa">If you want to use the <code class="code">https://</code> protocol, it should be enabled separately and the process is not specific to TeamCity, but rather for the web server used (Tomcat by default). See also <a href="how-to.html#Configure-HTTPS-for-TeamCity-Web-UI">Configure HTTPS for TeamCity Web UI</a>.</p></div><a name="ChangingServerContext"></a><a name="Changing-Server-Context"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-ChangingServerContext">Changing Server Context</h3><p id="6cf0f2aa">By default, the TeamCity server is accessible under the root context of the server address (for example, <a href="http://localhost:8111/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost:8111/</a> ). To make it available under a nested path instead (for example, <a href="http://localhost:8111/teamcity/" data-external="true" target="_blank" rel="noopener noreferrer">http://localhost:8111/teamcity/</a> ), you need to:</p><ol class="list _decimal"><li class="list__item" id="97953a74"><p>Stop the TeamCity server.</p></li><li class="list__item" id="9fda1f37"><p>Rename the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\webapps\ROOT directory to &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\teamcity.</p></li><li class="list__item" id="5cbc26d6"><p>Start the TeamCity server.</p></li></ol><aside class="tip sideblock" data-title="" rel="ea112c44" id="cd93dbf0"><p id="94415fb3">Note that after this change <a href="upgrade.html#Automatic-Update">automatic update</a> will be disabled for your installation and you will have to upgrade TeamCity <a href="upgrade.html#Manual-Upgrade">manually</a>.</p></aside></div><a name="JavaInstallation"></a><a name="Java-Installation"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-JavaInstallation">Java Installation</h3><p id="52a6d3e9">The TeamCity server is a web application that runs in an J2EE application server (a JVM application). TeamCity server requires a Java SE JRE installation to run.</p><p id="658bd0dc">The TeamCity server <b id="bce592cd">requires</b> JRE 8 to operate. The recommended Java distribution is <a href="https://adoptopenjdk.net" data-external="true" target="_blank" rel="noopener noreferrer">AdoptOpenJDK</a>.We recommend using the 32-bit installation unless you need to <a href="#Setting-Up-Memory-settings-for-TeamCity-Server">dedicate more memory</a> to the TeamCity server. Please check the <a href="#Using-64-bit-Java-to-Run-TeamCity-Server">64-bit Java notes</a> before upgrading.If you have configured any native libraries for use with TeamCity (like <code class="code">.dll</code> for using the Integrated Security option of the Microsoft SQL database), you need to update the libraries to match the JVM x86/x64 platform.</p><p id="446c2f8b">TeamCity selects the Java to run the server process as follows:</p><ul class="list _ul"><li class="list__item" id="e4dc9f20"><p>If your TeamCity installation has a bundled JRE (there is the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre  directory), it will <b id="4bc29c68">always</b> be used to run the TeamCity server process.</p></li><li class="list__item" id="b192119b"><p>If there is no &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre  directory present, set <code class="code">JRE_HOME</code> or <code class="code">JAVA_HOME</code> environment variables pointing to the installation directories of JRE or JVM (Java SDK) respectively. JRE will be used if both are present.</p></li></ul><p id="876907e3">The necessary steps to update the Java installation depend on the distribution used.</p><ul class="list _ul"><li class="list__item" id="c6de0284"><p>if your TeamCity installation has a bundled JRE (there is the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre directory), update it by installing a newer JRE per installation instructions and copying the content of the resulting directory to replace the content of the existing &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre directory.<br>If you also run a TeamCity agent from the &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\buildAgent directory, install JDK (Java SDK) installation instead of JRE and copy content of JDK installation directory into &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre.</p></li></ul><aside class="note " data-title="" rel="090439bc" id="011115d6"><p id="e8f989e3">Note that on upgrade, TeamCity will overwrite the existing JRE with the bundled 32-bit version, so you'll have to update to the 64-bit JRE again after upgrade.</p></aside><ul class="list _ul"><li class="list__item" id="813213a3"><p>if there is no &lt;<a href="teamcity-home-directory.html">TeamCity Home</a>&gt;\jre directory present, set <code class="code">JRE_HOME</code> or <code class="code">JAVA_HOME</code> environment variables to be available for the process launching the TeamCity server (setting global OS environment variables and system restart is recommended). The variables should point to the home directory of the installed JRE or JVM (Java SDK) respectively and if both are present, the installed <code class="code">JRE</code> will be used.</p></li><li class="list__item" id="7918196e"><p>if you use the <code class="code">.war</code> distribution, Java update depends on the application server used. Refer to the manual of your application server.</p></li></ul></div><a name="Using64bitJavatoRunTeamCityServer"></a><a name="Using-64-bit-Java-to-Run-TeamCity-Server"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-Using64bitJavatoRunTeamCityServer">Using 64 bit Java to Run TeamCity Server</h3><p id="f969f447">TeamCity server can run under both the 32- and 64-bit JVM. It is recommended to use the 32-bit JVM unless you need to dedicate more than 1Gb of memory (via <code class="code">-Xmx</code> JVM option) to the TeamCity process (see <a href="#Setting-Up-Memory-settings-for-TeamCity-Server">details</a>) or your <a href="setting-up-an-external-database.html">database requirements</a> are different.</p><p id="e4d8c825">If you choose to use the 64-bit JVM, note that the memory usage is almost doubled when switching from the 32- to 64-bit JVM, so make sure you specify at least twice as much memory as for 32-bit JVM, see <a href="#Setting-Up-Memory-settings-for-TeamCity-Server">Setting Up Memory settings for TeamCity Server</a>.</p><p id="c912693b"><b id="f4cd0ef9">To update to the 64-bit Java</b>:</p><ul class="list _ul"><li class="list__item" id="f4a6a843"><p><a href="#Java-Installation">update</a> Java to be used by the server</p></li><li class="list__item" id="7b08319d"><p><a href="configuring-teamcity-server-startup-properties.html">set JVM memory options</a>. It is recommended to set the following options for the 64-bit JVM: <code class="code">-Xmx4g -XX:ReservedCodeCacheSize=350m</code></p></li></ul></div><a name="SettingUpMemorysettingsforTeamCityServer"></a><a name="Setting-Up-Memory-settings-for-TeamCity-Server"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-SettingUpMemorysettingsforTeamCityServer">Setting Up Memory settings for TeamCity Server</h3><p id="2ee9e708">TeamCity server has the main process which can also launch child processes. Child processes use available memory on the machine, this section covers the memory settings of the main TeamCity server process only as it requires special configuration.<br>As a JVM application, TeamCity main server process only utilizes memory devoted to the JVM. The required memory may depend on the JVM used (32 bit or 64 bit). The memory used by JVM usually consists of: heap (configured via <code class="code">-Xmx</code>) and metaspace (limited by the amount of available native memory), internal JVM (usually tens of Mb), and OS-dependent memory features like memory-mapped files. TeamCity mostly depends on the heap memory and this settings can be configured for the TeamCity application manually by <a href="configuring-teamcity-server-startup-properties.html#JVM-Options">passing</a> <code class="code">-Xmx</code> (heap space) option to the JVM running the TeamCity server.</p><p id="d7c013e6">Once you start using TeamCity for <a href="#Configuring-Server-for-Production-Use">production</a> purposes or you want to load the server during evaluation, you should manually set the appropriate memory settings for the TeamCity server.</p><p id="63fb2bb7">To <b id="13d5c049">change the memory settings</b>, refer to <a href="configuring-teamcity-server-startup-properties.html#JVM-Options">Configuring TeamCity Server Startup Properties</a>, or to the documentation of your application server, if you run TeamCity using the <code class="code">.war</code> distribution.<br>Generally this means setting <code class="code">TEAMCITY_SERVER_MEM_OPTS</code> environment variable to the value like <code class="code">-Xmx750m</code></p><p id="e678c7e2">We recommend removing the <code class="code">-XX:MaxPermSize</code> JVM option from the <code class="code">TEAMCITY_SERVER_MEM_OPTS</code> environment variable, if previously configured, since it is ignored in Java 8.</p><p id="34dc363f">If slowness, OutOfMemory errors occur, or you consistently see a memory-related warning in the TeamCity UI, increase the setting to the next level.</p><ul class="list _ul"><li class="list__item" id="0ee8048f"><p><b id="3a89dd01">minimum setting</b> (the 32-bit Java should be used (bundled in .exe distribution)): <code class="code">-Xmx750m</code></p></li><li class="list__item" id="f169da48"><p><b id="7d6e1a32">recommended setting</b> for <b id="b7cf3058">medium</b> server use (the 32-bit Java should be used): <code class="code">-Xmx1024m</code>.  Greater settings with the 32-bit Java can cause an OutOfMemoryError with "Native memory allocation (malloc) failed" JVM crashes or "unable to create new native thread" messages</p></li><li class="list__item" id="3cd82bbe"><p><b id="260b3994">recommended setting</b> for <b id="d4aa874e">large</b> server use (<a href="#Using-64-bit-Java-to-Run-TeamCity-Server">64-bit Java</a> should be used): <code class="code">-Xmx4g -XX:ReservedCodeCacheSize=450m</code>.  These settings should be suitable for an installation with up to two hundreds of agents and thousands of build configurations. Custom plugins installed might require increasing the value defined via the Xmx parameter.</p></li><li class="list__item" id="ed038f15"><p><b id="4b79b8b9">maximum settings</b> for large-scale server use (<a href="#Using-64-bit-Java-to-Run-TeamCity-Server">64-bit Java</a> should be used): <code class="code">-Xmx10g -XX:ReservedCodeCacheSize=640m</code>. Greater values can be used for larger TeamCity installations. However, generally it is not recommended to use values greater than 10g without consulting TeamCity support.</p></li></ul><p id="b43fc0fb"><b id="36b48376">Tips</b>:</p><ul class="list _ul"><li class="list__item" id="65885939"><p>the 32-bit JVM can reliably work with up to 1Gb heap memory (<code class="code">Xmx1024m</code>). (This can be increased to <code class="code">-Xmx1200m</code>, but JVM under Windows might crash occasionally with this setting.) If more memory is necessary, the 64-bit JVM should be used with not less than 2.5Gb assigned (<code class="code">-Xmx2500m</code>). Unless the TeamCity server runs with more than 100 agents or serves very active builds / thousands of users, it's unlikely that you will need to dedicate more than 4Gb of memory to the TeamCity process.</p></li><li class="list__item" id="1335a8f4"><p>A rule of thumb is that the 64-bit JVM should be assigned twice as much memory as the 32-bit for the same application. If you switch to the 64-bit JVM, make sure you adjust the memory setting ( <code class="code">-Xmx</code>) accordingly. It does not make sense to switch to 64 bit if you dedicate less than the double amount of memory to the application.</p></li><li class="list__item" id="da6ccb85"><p>Large TeamCity installations might benefit from fine-tuning of the memory settings. The amount of memory dedicated to TeamCity server JVM should not regularly exceed 60% of the total available physical memory on the machine (to allow for nested process and OS-level caches usage). Also, with heaps (<code class="code">–Xmx</code>) set to more than 8Gb, if the machine has many CPU cores (for example, more than 8) and current CPU usage is below 60%, enabling G1 JVM garbage collector via the <code class="code">-XX:+UseG1GC</code> JVM option might reduce the length of stop-the-world GC pauses.</p></li></ul><p id="959ea367">The recommended approach is to start with initial settings and monitor for the percentage of used memory using the <b id="7b8001ce">Administration | Diagnostics</b> page. If the server uses more than 80% of memory consistently without drops for tens of minutes, that is probably a sign to increase the <code class="code">-Xmx</code> memory value by another 20%.</p></div></div><a name="ConfiguringTeamCityServer"></a><a name="Configuring-TeamCity-Server"></a><div class="chapter"><h2 id="InstallingandConfiguringtheTeamCityServer-ConfiguringTeamCityServer">Configuring TeamCity Server</h2><aside class="note " data-title="" rel="InstallingandConfiguringtheTeamCityServer-ConfiguringTeamCityServer" id="5a599f00"><ul class="list _ul"><li class="list__item" id="db6c3e4b"><p>If you have a lot of projects or build configurations, we recommend you avoid using the <b id="b3706acd">Default agent</b> in order to free up the TeamCity server resources. The TeamCity Administrator can <a href="build-agents-configuration-and-maintenance.html#Enabling/Disabling-Agents-via-UI">disable</a> the default agent on the <b id="82576edd">Agents</b> page of the web UI.</p></li><li class="list__item" id="ea1d3700"><p>When changing the TeamCity Data Directory or database, make sure they do not get out of sync.</p></li></ul></aside><a name="ConfiguringTeamCityDataDirectory"></a><a name="Configuring-TeamCity-Data-Directory"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-ConfiguringTeamCityDataDirectory">Configuring TeamCity Data Directory</h3><p id="43c00e82">The default placement of the TeamCity Data Directory can be changed. See <a href="teamcity-data-directory.html">TeamCity Data Directory</a> for details.</p></div><a name="EditingServerConfiguration"></a><a name="Editing-Server-Configuration"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-EditingServerConfiguration">Editing Server Configuration</h3><p id="89c9b781">After successful server start, any TeamCity page request will redirect to prompt for the server administrator username and password. Make sure that no one can access the server pages until the administrator account is setup.</p><p id="ecb45543">After administration account setup you may begin to create Project and Build Configurations in the TeamCity server. You may also want to configure the following settings in the Server Administration section:</p><ul class="list _ul"><li class="list__item" id="f01eb555"><p>Server URL</p></li><li class="list__item" id="d14e3fc2"><p>Email server address and settings</p></li><li class="list__item" id="c5b39387"><p>Jabber server address and settings</p></li></ul></div><a name="ConfiguringServerforProductionUse"></a><a name="Configuring-Server-for-Production-Use"></a><div class="chapter"><h3 id="InstallingandConfiguringtheTeamCityServer-ConfiguringServerforProductionUse">Configuring Server for Production Use</h3><p id="6a975767">Out-of-the-box TeamCity server installation is suitable for evaluation purposes. For production use you will need to perform additional configuration which typically includes:</p><ul class="list _ul"><li class="list__item" id="9fdb7a2e"><p>Check that the server is using due <a href="#Changing-Server-Port">server port</a> and configure <a href="how-to.html#Configure-HTTPS-for-TeamCity-Web-UI">access via https</a>.</p></li><li class="list__item" id="3fe8c2ca"><p>Make sure server URL, email and (optionally) Jabber server settings are specified and are correct</p></li><li class="list__item" id="a624385a"><p>Configuring the server process for OS-dependent autostart on machine reboot</p></li><li class="list__item" id="efbd13f5"><p>Using reliable storage for <a href="teamcity-data-directory.html">TeamCity Data Directory</a></p></li><li class="list__item" id="d5074509"><a href="setting-up-an-external-database.html">Using external database</a></li><li class="list__item" id="e22bae16"><p><a href="#Setting-Up-Memory-settings-for-TeamCity-Server">Configuring recommended memory settings</a>, use "maximum settings" for active or growing servers</p></li><li class="list__item" id="9e9247c3"><p>Planning for regular <a href="teamcity-data-backup.html">backups</a></p></li><li class="list__item" id="503e4832"><p>Planning for regular <a href="upgrade.html">upgrades</a> to the latest TeamCity releases</p></li><li class="list__item" id="87edc436"><p>(since TeamCity 10.0.3) Consider adding the <code class="code">teamcity.installation.completed=true</code> line into the &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;\conf\teamcity-startup.properties file – this will prevent the server from creating an administrator user if no such user is found</p></li></ul><p id="46506fe8">Make sure to review the <a href="how-to.html#Configuring-TeamCity-Server-for-Performance">notes on configuring the server for performance</a> and <a href="how-to.html#TeamCity-Security-Notes">security notes</a>.</p><hr id="dd21a3b4"><p id="b3f24fe5"><b id="d1359c0c">See also:</b></p><p id="3e25e1cc"><b id="661bb8e7">Installation and Upgrade</b>: <a href="setting-up-and-running-additional-build-agents.html">Setting up and Running Additional Build Agents</a></p><hr id="9e291ece"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>