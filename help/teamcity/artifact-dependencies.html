<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Artifact Dependencies - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Artifact Dependencies" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-dependencies.md|Configuring Dependencies/artifact-dependencies.md|Artifact Dependencies" data-main-title="Artifact Dependencies" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/artifact-dependencies.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Artifact Dependencies" id="artifact-dependencies.md">Artifact Dependencies</h1><p id="89b36bf3">This page details configuration of the TeamCity <a href="dependent-build.html#Artifact-Dependency">Artifact Dependencies</a>.</p><p id="5f2d60f4">On this page:</p><p id="b6e70263"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ArtifactDependencies-ConfiguringArtifactDependenciesUsingWebUI">Configuring Artifact Dependencies Using Web UI</a></li><li class="list__item"><a href="#ArtifactDependencies-ConfiguringArtifactDependenciesUsingAntBuildScript">Configuring Artifact Dependencies Using Ant Build Script</a></li><li class="list__item"><a href="#ArtifactDependencies-Build-levelauthentication">Build-level authentication</a></li></ul></p><p id="f079bada">The <b id="b2966516">Build Configuration Settings | Dependencies | Artifact Dependencies</b> section allows configuring the dependencies.  It is possible to disable a configured dependency temporarily or permanently using the corresponding option in the last column of the Artifact Dependencies list.</p><a name="ConfiguringArtifactDependenciesUsingWebUI"></a><a name="Configuring-Artifact-Dependencies-Using-Web-UI"></a><div class="chapter"><h2 id="ArtifactDependencies-ConfiguringArtifactDependenciesUsingWebUI">Configuring Artifact Dependencies Using Web UI</h2><p id="193eae7f"><b id="14286187">To add an artifact dependency to a build configuration:</b></p><ol class="list _decimal"><li class="list__item" id="39abd965"><p>When <a href="creating-and-editing-build-configurations.html">creating/editing a build configuration</a>, open the <b id="fa62985e">Dependencies</b> page.</p></li><li class="list__item" id="f53877ee"><p>Click the <b id="886afb19">Add new artifact dependency</b> link and specify the following settings:</p></li></ol><div class="table-wrapper"><table width="100%" id="3bbf7d63"><thead><tr id="22e1c7fb" class="ijRowHead"><th id="b9d068a7"><p id="f218dff1">Option</p></th><th id="b6bc0d0a"><p id="516cc962">Description</p></th></tr></thead><tbody><tr id="20197afb" class="ijRowOdd"><td id="3807090c"><p id="a292970c">Depend on</p></td><td id="4de069f5"><p id="3b3bc50b">Specify the build configuration for the current build configuration to depend on. A dependency can be configured on a previous build of the same build configuration.</p></td></tr><tr id="685ac23d" class="ijRowEven"><td id="ce8a0f0a"><p id="9d60864a">Get artifacts from</p></td><td id="e53690e2"><p id="0de02b79">Specify the type of build whose artifacts are to be taken: last successful build, last <a href="pinned-build.html">pinned build</a>, last finished build, build from the same chain (this option is useful when you have a <a href="snapshot-dependencies.html">snapshot dependency</a> and want to obtain artifacts from a build with the same sources), build with a specific build number or the last finished build with a specified tag.</p><aside class="note " data-title="" rel="0de02b79" id="50b85ffd"><ul class="list _ul"><li class="list__item" id="29438790"><p>When selecting the build configuration, take your <a href="clean-up.html">clean-up policy settings</a> into account.<br>Builds are cleaned and deleted on a regular basis, thus the build configuration could become dependent on a non-existent build. When artifacts are taken from a build with a specific number, then the specific build will not be deleted during clean-up.</p></li><li class="list__item" id="af249f9f"><p>If both a dependency by sources and a dependency by artifacts on the last finished build are configured for a build configuration, then artifacts will be taken from the build with the same sources.</p></li></ul></aside></td></tr><tr id="2ddfeb9c" class="ijRowOdd"><td id="3f2fb562"><p id="95ccec89">Build number</p></td><td id="3d0e08db"><p id="8ddda38c"><i id="b3f9e101">This field appears if you have selected</i> <i id="16c3802b"><b id="6a092c35">build with specific build number</b></i> <i id="d57ae7b1">in the</i> <i id="1b844b4a"><b id="3941630d">Get artifacts from</b></i> <i id="9f708d31">list</i>.<br>Specify here the exact <a href="configuring-general-settings.html#Build-Number-Format">build number</a> of the artifact.</p></td></tr><tr id="326fb586" class="ijRowEven"><td id="dd247c19"><p id="0cac2b7a">Build tag</p></td><td id="774fbf22"><p id="f359b10b"><i id="4df7604e">This field appears if you have selected</i> <i id="406bb001"><b id="a443104a">last finished build with specified tag</b></i> <i id="05a777ac">in the</i> <i id="ee0d8895"><b id="1e1ba6d5">Get artifacts from</b></i> <i id="b0ce9fa7">list</i>.<br>Specify here the tag of the build whose artifacts are to be used. When resolving the dependency, TeamCity will look for the last successful build with the given tag and use its artifacts.</p></td></tr><tr id="78fe85c4" class="ijRowOdd"><td id="4a80f693"><p id="3b4570be">Build branch</p></td><td id="91f6b874"><p id="b5edbab8"><i id="24ce7b39">This field appears if the dependency has a <a href="working-with-feature-branches.html#Configuring-branches">branch specified</a> in the VCS Root settings</i>. Allows setting a <a href="working-with-feature-branches.html">branch</a> to limit source builds only to those with the branch. If not specified, the default branch is used. The logic branch name (shown in the UI for the build) is to be used. Patterns are not supported.</p></td></tr><tr id="0103a4f3" class="ijRowEven"><td id="ea319caa"><p id="fd61f599">Artifacts Rules</p></td><td id="8016ccc1"><p id="4e12fee0">Here you specify the artifacts of the source build to be downloaded and the location on the agent they will be downloaded to before the dependent build starts.</p><p id="3e88771b">A newline-delimited set of rules. Each rule must have the following syntax:</p><p id="72e8c19a"><code class="code">[+:|-:]SourcePath[!ArchivePath][=&gt;DestinationPath]</code></p><p id="dd79576f">Each rule specifies the files to be downloaded from the "source" build. The <i id="521fd93d">SourcePath</i> should be relative to the artifacts directory of the "source" build. The path can either identify a specific file, directory, or use wildcards to match multiple files. <a href="wildcards.html">Ant-like wildcards</a> are supported.<br>Downloaded artifacts will keep the "source" directory structure starting with the first <code class="code">*</code> or <code class="code">?</code>.<br><i id="05fcef7e">DestinationPath</i> specifies the destination directory on the agent where downloaded artifacts are to be placed. If the path is relative (which is recommended), it will be resolved against the build checkout directory. If needed, the destination directories can be cleaned before downloading artifacts. If the destination path is empty, artifacts will be downloaded directly to the checkout root.</p><p id="2a62a95a">Basic examples:</p><ul class="list _ul"><li class="list__item" id="4cfa61c2"><p>Use <code class="code">a/b/**=&gt;lib</code> to download all files from <code class="code">a/b</code> directory of the source build to the <code class="code">lib</code> directory. If there is a <code class="code">a/b/c/file.txt</code> file in the source build artifacts, it will be downloaded into the file <code class="code">lib/c/file.txt</code>.</p></li><li class="list__item" id="222f396b"><p>At the same time, artifact dependency <code class="code">**/*.txt=&gt;lib</code> will preserve the directories structure: the <code class="code">a/b/c/file.txt</code> file from source build artifacts will be downloaded to <code class="code">lib/a/b/c/file.txt</code>.</p></li></ul><p id="c823fc9a"><i id="80f6970b">ArchivePath</i> is used to extract downloaded <a href="configuring-general-settings.html#Artifact-Paths">compressed</a> artifacts. Zip, 7-zip, jar, tar and tar.gz are supported.<br><i id="43b9acc9">ArchivePath</i> follows general rules for <i id="53eca667">SourcePath</i>: ant-like wildcards are allowed, the files matched inside the archive will be placed in the directory corresponding to the first wildcard match (relative to destination path)<br>For example: <code class="code">release.zip!*.dll</code> command will extract all .dll files residing in the root of the <code class="code">release.zip</code> artifact.</p><p id="4922915a">Archive processing examples:</p><ul class="list _ul"><li class="list__item" id="34155ca2"><p><code class="code">release-*.zip!*.dll=&gt;dlls</code> will extract *.dll from all archives matching the <code class="code">release-*.zip</code> pattern to the <code class="code">dlls</code> directory.</p></li><li class="list__item" id="d8dcbeaa"><p><code class="code">a.zip!**=&gt;destination</code> will unpack the entire archive saving the path information.</p></li><li class="list__item" id="b599fc20"><p><code class="code">a.zip!a/b/c/**/*.dll=&gt;dlls</code> will extract all .dll files from <code class="code">a/b/c</code> and its subdirectories into the <code class="code">dlls</code> directory, without the <code class="code">a/b/c</code> prefix.</p></li></ul><p id="73f9223a"><code class="code">+:</code> and <code class="code">-:</code> can be used to include or exclude specific files from download or unpacking. As <code class="code">+:</code> prefix can be omitted: rules are inclusive by default, and at least one inclusive rule is required. The order of rules is unimportant. For each artifact the most specific rule (the one with the longest prefix before the first wildcard symbol) is applied. When excluding a file, <i id="ebce7f26">DestinationPath</i> is ignored: the file won't be downloaded at all. Files can also be excluded from archive unpacking. The set of rules applied to the archive content is determined by the set of rules matched by the archive itself.</p><p id="d633aed0">Exclusive patterns examples:</p><ul class="list _ul"><li class="list__item" id="24d3bd74"><p><code class="code">**/*.txt=&gt;texts</code><br><code class="code">-:bad/exclude.txt</code>  Will download all *.txt files from all directories, excluding <code class="code">exclude.txt</code> from the <code class="code">bad</code> directory</p></li><li class="list__item" id="73bd9c97"><p><code class="code">+:release-*.zip!**/*.dll=&gt;dlls</code><code class="code">-:release-0.0.1.zip!Bad.dll</code>  Will download and unpack all dlls from <code class="code">release-*.zip</code> files to the <code class="code">dlls</code> directory. The <code class="code">Bad.dll</code> file from <code class="code">release-0.0.1.zip</code> will be skipped</p></li><li class="list__item" id="190d078f"><p><code class="code">**/*.*=&gt;target</code><br><code class="code">-:excl/**/*.*</code><br><code class="code">+:excl/must_have.txt=&gt;target</code>  Will download all artifacts to the <code class="code">target</code> directory. Will not download anything from the <code class="code">excl</code> directory, but the file called <code class="code">must_have.txt</code></p></li></ul><aside class="tip sideblock" data-title="" rel="413c65a8" id="db9b2495"><p id="1cc55d61">Click the <img alt="ArtifactsBrowserIcon.png" title="ArtifactsBrowserIcon.png" src="/help/img/teamcity/2019.1/ArtifactsBrowserIcon.png" id="8fcf3b7b" width="19" height="23" class="inline-icon-19"> icon to invoke the Artifact Browser. TeamCity will try to locate artifacts according to the specified settings and show them in a tree. Select the required artifacts from the tree and TeamCity will place the paths to them into the input field.</p></aside><p id="9fbd9a0a">The artifacts placed under the <code class="code">.teamcity</code> directory are considered <a href="build-artifact.html#Hidden-Artifacts">hidden</a>. These artifacts are ignored by wildcards by default.<br>If you want to include files from the <code class="code">.teamcity</code> directory for any purpose, be sure to add the artifact path starting with <code class="code">.teamcity</code> explicitly.</p><p id="90dc34db">Example of accessing hidden artifacts:</p><ul class="list _ul"><li class="list__item" id="cdfde2fa"><code class="code">.teamcity/properties/*.properties</code></li><li class="list__item" id="52c06bff"><code class="code">.teamcity/*.*</code></li></ul><p id="bb76c31e">By default, downloading artifact dependencies to the <a href="agent-work-directory.html">agent work directory</a> is allowed, the <a href="agent-home-directory.html">agent home directory</a> is prohibited. To override the defaults, set custom rules to download artifacts by specifying the comma-separated paths in the <a href="build-agent-configuration.html"><code class="code">buildAgent.properties</code></a>: <code class="code">teamcity.artifactDependenciesResolution.blackList</code> and <code class="code">teamcity.artifactDependenciesResolution.whiteList</code>. Blacklisting a path forbids artifacts download to the directory unless it is whitelisted.</p></td></tr><tr id="70c9b886" class="ijRowOdd"><td id="62914b25"><p id="3cb6400d">Clean destination paths before downloading artifacts</p></td><td id="a0718334"><p id="3695cd66">Check this option to delete the content of the destination directories before copying artifacts. It will be applied to all inclusive rules</p></td></tr></tbody></table></div><p id="c4e970a9">At any point you can launch a build with <a href="triggering-a-custom-build.html#Promoting-Build">custom artifact dependencies</a>.</p></div><a name="ConfiguringArtifactDependenciesUsingAntBuildScript"></a><a name="Configuring-Artifact-Dependencies-Using-Ant-Build-Script"></a><div class="chapter"><h2 id="ArtifactDependencies-ConfiguringArtifactDependenciesUsingAntBuildScript">Configuring Artifact Dependencies Using Ant Build Script</h2><p id="529f9031">This section describes how to download TeamCity build artifacts inside the build script. These instructions can also be used to download artifacts from outside of TeamCity.</p><p id="85a01e1f">To handle artifact dependencies between builds, this solution is more complicated then configuring dependencies in the TeamCity UI but allows for greater flexibility. For example, managing dependencies this way will allow you to start a personal build and verify that your build is still compatible with dependencies.</p><p id="c87bdce7"><b id="a4a76176">To configure dependencies via Ant build script:</b></p><p id="0c27ea21">1. Download Ivy.</p><aside class="tip sideblock" data-title="" rel="0c27ea21" id="9758a206"><p id="a15c2903">TeamCity itself acts as an Ivy repository. You can read more about the Ivy dependency manager <a href="http://ant.apache.org/ivy/" data-external="true" target="_blank" rel="noopener noreferrer">here</a>.</p></aside><p id="0e258a59">2. Add Ivy to the classpath of your build.</p><p id="5b1b5e28">3. Create the <code class="code">ivyconf.xml</code> file that contains some meta information about TeamCity repository. This file is to have the following content:</p><div class="code-block" data-lang="markup">
&lt;ivysettings&gt;
&lt;property name='ivy.checksums' value=''/&gt;
&lt;caches defaultCache="${teamcity.build.tempDir}/.ivy/cache"/&gt;
&lt;statuses&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;status name='integration' integration='true'/&gt;
&lt;/statuses&gt;
&lt;resolvers&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;url name='teamcity-rep' alwaysCheckExactRevision='yes' checkmodified='true'&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;ivy pattern='http://YOUR_TEAMCITY_HOST_NAME/httpAuth/repository/download/[module]/[revision]/teamcity-ivy.xml' /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifact pattern='http://YOUR_TEAMCITY_HOST_NAME/httpAuth/repository/download/[module]/[revision]/[artifact](.[ext])' /&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/url&gt;
&lt;/resolvers&gt;
&lt;modules&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;module organisation='.*' name='.*' matcher='regexp' resolver='teamcity-rep' /&gt;
&lt;/modules&gt;
&lt;/ivysettings&gt;

</div><p id="e64bd8c9">4. Replace <code class="code">YOUR_TEAMCITY_HOST_NAME</code> with the host name of your TeamCity server.</p><p id="708bdb4e">5. Place <code class="code">ivyconf.xml</code> in the directory where your <code class="code">build.xml</code> will be running.</p><p id="edbe557c">6. In the same directory create the <code class="code">ivy.xml</code> file defining which artifacts to download and where to put them, for example:</p><div class="code-block" data-lang="markup">&lt;ivy-module version="1.3"&gt;
  &lt;info organisation="YOUR_ORGANIZATION" module="YOUR_MODULE"/&gt;
  &lt;dependencies&gt;
    &lt;dependency org="org" name="BUILD_TYPE_EXT_ID" rev="BUILD_REVISION"&gt;
      &lt;include name="ARTIFACT_FILE_NAME_WITHOUT_EXTENSION" ext="ARTIFACT_FILE_NAME_EXTENSION" matcher="exactOrRegexp"/&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/ivy-module&gt;

</div><p id="c6cfcb70">where:</p><ul class="list _ul"><li class="list__item" id="5ad19a9a"><p><code class="code">YOUR_ORGANIZATION</code> replace with the name of your organization.</p></li><li class="list__item" id="f74a9a0b"><p><code class="code">YOUR_MODULE</code> replace with the name of your project or module where artifacts will be used.</p></li><li class="list__item" id="701145f5"><p><code class="code">BUILD_TYPE_EXT_ID</code> replace with the <a href="build-configuration.html#Status-Display-for-Set-of-Build-Configurations">external ID</a> of the build configuration whose artifacts are downloaded.</p></li><li class="list__item" id="49490386"><code class="code">BUILD_REVISION</code> can be either a build number or one of the following strings: * <code class="code">latest.lastFinished</code><ul class="list _ul"><li class="list__item" id="ad0026bf"><code class="code">latest.lastSuccessful</code></li><li class="list__item" id="66c410e8"><code class="code">latest.lastPinned</code></li></ul></li><li class="list__item" id="a8c68773"><p><code class="code">TAG_NAME.tcbuildtag</code> - last build tagged with the TAG_NAME tag</p></li></ul><ul class="list _ul"><li class="list__item" id="f866da15"><p><code class="code">ARTIFACT_FILE_NAME_WITHOUT_EXTENSION</code> file name or regular expression of the artifact without the extension part.</p></li><li class="list__item" id="7ba447e9"><p><code class="code">ARTIFACT_FILE_NAME_EXTENSION</code> the extension part of the artifact file name.</p></li></ul><p id="fb48f95b">7. Modify your <code class="code">build.xml</code> file and add tasks for downloading artifacts, for example (applicable for Ant 1.6 and later):</p><div class="code-block" data-lang="markup">&lt;&lt;target name="fetchArtifacts" description="Retrieves artifacts for TeamCity" xmlns:ivy="antlib:org.apache.ivy.ant"&gt;
     &lt;taskdef uri="antlib:org.apache.ivy.ant"  resource="org/apache/ivy/ant/antlib.xml"/&gt;
       &lt;classpath&gt;
         &lt;pathelement location="${basedir}/lib/ivy-2.0.jar"/&gt;
         &lt;pathelement location="${basedir}/lib/commons-httpclient-3.0.1.jar"/&gt;
         &lt;pathelement location="${basedir}/lib/commons-logging.jar"/&gt;
         &lt;pathelement location="${basedir}/lib/commons-codec-1.3.jar"/&gt;
       &lt;/classpath&gt;
     &lt;/taskdef&gt;
     &lt;ivy:configure file="${basedir}/ivyconf.xml" /&gt;
     &lt;!--&lt;ivy:cleancache /&gt;--&gt;
     &lt;ivy:retrieve pattern="${basedir}/[artifact].[ext]"/&gt;
   &lt;/target&gt;

</div><aside class="note " data-title="" rel="ac3c9932" id="ac4a7f97"><ul class="list _ul"><li class="list__item" id="ff7c01fc"><p><code class="code">commons-httpclient</code>, <code class="code">commons-logging</code>, and <code class="code">commons-codec</code> are to be in the <code class="code">classpath</code> of Ivy tasks.</p></li><li class="list__item" id="a0648b1f"><p>To clean the Ivy cache directory before retrieving dependencies, uncomment the <code class="code">&lt;ivy:cleancache /&gt;</code> element in the example above.</p></li></ul></aside><p id="e42db7a0">Artifacts repository is protected by a basic authentication. To access the artifacts, you need to provide credentials to the &lt;ivy:configure/&gt; task. For example:</p><div class="code-block" data-lang="markup">&lt;ivy:configure file="${basedir}/ivyconf.xml"
                 host="TEAMCITY_HOST"
                 realm="TeamCity"
                 username="USER_ID"
                 passwd="PASSWORD"/&gt;

</div><p id="417d51d8">where <code class="code">TEAMCITY_HOST</code> is hostname or IP address of your TeamCity server (without port and servlet context).<br>As <code class="code">USER_ID/PASSWORD</code> you can use either username/password of a regular TeamCity user (the user should have corresponding permissions to access artifacts of the source build configuration) or system properties <code class="code">teamcity.auth.userId/teamcity.auth.password</code>.</p></div><a name="Build-levelauthentication"></a><a name="Build-level-authentication"></a><div class="chapter"><h2 id="ArtifactDependencies-Build-levelauthentication">Build-level authentication</h2><p id="2d9d87b8">The system properties <code class="code">teamcity.auth.userId</code> and <code class="code">teamcity.auth.password</code> store automatically generated build-unique values which can be used to authenticate on TeamCity server. The values are valid only during the time the build is running. This generated user has limited permissions which allow build-related operations. The primary intent for the user is to use the authentication to download artifacts from other TeamCity builds within the build script.</p><p id="d44f590b">Using the properties is preferable to using real user credentials since it allows the server to track the artifacts downloaded by your build. If the artifacts were downloaded by the build configuration artifact dependencies or using the supplied properties, the specific artifacts used by the build will be displayed at the <b id="d18b80d9">Dependencies</b> tab on the build results page. In addition, the builds which were used to get the artifacts from, can be configured to have different <a href="clean-up.html">clean-up</a> logic.</p><hr id="40423e74"><p id="20d00a4c"><b id="2bd60c51">See also:</b></p><p id="5b9ac5f6"><b id="f634d8ba">Concepts</b>: <a href="dependent-build.html">Dependent Build</a></p><hr id="da3f6d60"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>