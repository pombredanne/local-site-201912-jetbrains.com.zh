<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>使用Meta-Runner-帮助|帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Working with Meta-Runner" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/working-with-meta-runner.md|Working with Meta-Runner" data-main-title="Working with Meta-Runner" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/working-with-meta-runner.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="working-with-meta-runner.md" data-toc="Working with Meta-Runner">与Meta-Runner合作</h1><p id="36e440c4"><i id="d75631dd">Meta-Runner</i>可让您从构建配置中提取构建步骤，需求和参数，并从中创建<a href="build-runner.html">构建运行器</a> 。然后，可以将此构建运行器用作任何其他构建配置或模板的构建步骤中的任何其他构建运行器。</p><p id="5fbbfc18">基本上，元运行器是一个构建配置中的一组构建步骤，您可以在另一个构建配置中重复使用这些步骤。它是一个xml定义，其中包含可以在其他构建配置的xml定义中使用的构建步骤，要求和参数。TeamCity允许使用Web UI提取元运行者。</p><p id="56a6c7dd">使用元运行器，您可以轻松地重用现有运行器，为典型任务（例如，发布到FTP，删除目录）创建新的运行器，可以简化构建配置并减少构建步骤。</p><p id="599acc30">所有元运行器都存储在项目级别，因此它们仅在此项目及其子项目中可用，并且在外部不可见。如果元运行器存储在<b id="3d0158c1"><root project=""></root></b>级别，它在全球范围内可用（在所有项目中）。</p><p id="52506e63">您可以使用TeamCity Meta-Runners Power Pack中的现有元运行器，也可以创建自己的元运行器。</p><p id="b9a0afd0">在此页：</p><p id="4d0ce4b4"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#WorkingwithMeta-Runner-UsingMeta-RunnersPowerPack">使用Meta-Runners Power Pack</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-InstallingMeta-Runner">安装Meta-Runner</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-CreatingMeta-Runner">创建元运行器</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-CreatingYourOwnMeta-RunnerfromUI">通过UI创建自己的Meta-Runner</a><ul class="list _bullet"><li class="list__item"><a href="#WorkingwithMeta-Runner-PreparingBuildConfiguration">准备构建配置</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-VerifyingBuildConfigurationWorksProperly">验证构建配置是否正常工作</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-ExtractingandUsingMeta-Runner">提取和使用Meta-Runner</a></li></ul></li><li class="list__item"><a href="#WorkingwithMeta-Runner-CreatingMeta-RunnerfromXMLDefinitionofBuildConfiguration">通过构建配置的XML定义创建Meta-Runner</a></li><li class="list__item"><a href="#WorkingwithMeta-Runner-CreatingBuildConfigurationfromMeta-Runner">从Meta-Runner创建构建配置</a></li></ul><p></p><a name="UsingMeta-RunnersPowerPack"></a><a name="Using-Meta-Runners-Power-Pack"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-UsingMeta-RunnersPowerPack">使用Meta-Runners Power Pack</h2><p id="30e344a5">GitHub上适用于<a href="https://github.com/jetbrains/meta-runner-power-pack" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity的Meta-runners Power Pack</a>是用于各种任务的meta- <a href="https://github.com/jetbrains/meta-runner-power-pack" rel="noopener noreferrer" data-external="true" target="_blank">runner</a>的集合，这些任务包括下载文件，触发构建，标记构建，更改构建状态，运行PHP任务等等。</p><p id="9c171f9e">每个文件都叫<code class="code">*MRPP_\<some text\>.xml*</code>包含单个Meta-runner的定义。下载所需的meta-runner（或将其定义复制到文件中）并按照以下部分中的说明进行安装。</p></div><a name="InstallingMeta-Runner"></a><a name="Installing-Meta-Runner"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-InstallingMeta-Runner">安装Meta-Runner</h2><p id="c37f06aa">您可以使用TeamCity Web UI安装元运行器。或者，您可以直接通过文件系统执行此操作。</p><ul class="list _ul"><li class="list__item" id="7b1b16eb"><p>要通过Web UI安装Meta-runner，请转到“项目设置”页面，从左侧的设置列表中选择“ Meta-Runners”，然后单击“上<b id="d337cb5c">载Meta-Runner”</b>并选择“ Meta-runner”定义文件。保存更改。</p></li><li class="list__item" id="6e6a2ada"><p>将Meta-runner直接安装到文件系统中，获取Meta-runner定义文件并将其放入<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">\config\projects\<project ID>\pluginData\metaRunners</code>目录，位置<code class="code"><project ID></code>是您要放置元运行器的项目的标识符。<br>如果<code class="code">metaRunners</code>目录不存在，应该创建它。将文件放置在磁盘上后，TeamCity将对其进行检测并加载此Meta-runner。无需重新启动服务器。</p></li></ul><p id="253853f2">如果Meta-runner成功加载，您将在项目的Meta-Runners页面上看到它；如果您具有适当的权限，则可以直接在TeamCity UI中修改定义。</p><p id="eb934866">现在，该运行器在构建配置“构建步骤”页面上的构建运行器列表中可用，并表示为具有便捷UI的本地TeamCity运行器。</p><p id="1625ff52">放置到项目中的元运行器将可用于其所有子项目和构建配置。要使Meta-runner对所有项目可用，请将其放置在Root项目中。</p></div><a name="CreatingMeta-Runner"></a><a name="Creating-Meta-Runner"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-CreatingMeta-Runner">创建元运行器</h2><p id="08eccf2a">您可以通过TeamCity Web UI创建构建配置，并从中提取一个元运行器，或将现有构建配置的xml定义用作元运行器。</p></div><a name="CreatingYourOwnMeta-RunnerfromUI"></a><a name="Creating-Your-Own-Meta-Runner-from-UI"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-CreatingYourOwnMeta-RunnerfromUI">通过UI创建自己的Meta-Runner</h2><p id="11073c8b">让我们考虑一个创建元运行器的示例。</p><p id="b98945de">要创建元运行器，请按照以下步骤操作（下面将详细介绍）：</p><ol class="list _decimal"><li class="list__item" id="cf106f43"><p>准备一个<a href="#Preparing-Build-Configuration">构建配置，以测试我们将在meta-runner中使用的构建步骤</a> 。</p></li><li class="list__item" id="0e933834"><p><a href="#Verifying-Build-Configuration-Works-Properly">确保构建配置正常运行</a> 。</p></li><li class="list__item" id="0299276f"><p><a href="#Extracting-and-Using-Meta-Runner">将meta-runner提取到所需的项目</a> 。</p></li></ol><p id="b1de6573">在此示例中，我们将创建一个元运行器，以借助相应的<a href="build-script-interaction-with-teamcity.html#Publishing-Artifacts-while-the-Build-is-Still-in-Progress">服务message</a>将一些工件发布到TeamCity。</p><p id="690fda44">通常，在构建完成时会发布在构建配置中配置的工件。但是，有时对于具有多个构建步骤的长构建，我们需要更快的工件。在此示例中，我们将创建一个运行器，该运行器可以插入任何构建步骤之间，并且可以配置为发布由先前步骤生成的工件。</p><a name="PreparingBuildConfiguration"></a><a name="Preparing-Build-Configuration"></a><div class="chapter"><h3 id="WorkingwithMeta-Runner-PreparingBuildConfiguration">准备构建配置</h3><p id="bec11164">第一步是准备一个构建配置，该配置将与我们要生成的元运行器相同的方式工作。让我们通过一个Ant构建步骤使用该配置：Ant可以在运行TeamCity代理的任何平台上执行；此外，TeamCity中的Ant运行程序还支持在运行程序设置中指定的build.xml。这很重要，因为我们的构建配置必须是独立的，不能从版本控制存储库中获取build.xml。因此，在我们的案例中，Ant步骤设置将如下所示：</p><p id="f57c01f4"></p><figure><img alt="添加Ant构建步骤" title="添加Ant构建步骤" src="/help/img/teamcity/2019.1/ant-build-step.png" id="227f90d0" width="1323" height="1814"></figure><p></p><p id="e23f7bd6">哪里<code class="code">artifact.paths</code>是系统属性。我们需要将其添加到构建配置设置的“ <b id="ed2296e0">参数”</b>选项卡上：</p><p id="293ee26a"></p><figure><img alt="构建参数中工件的路径" title="构建参数中工件的路径" src="/help/img/teamcity/2019.1/paths-to-artifacts-parameter.png" id="db315f38" width="1224" height="1112"></figure><p></p><p id="39c14062">请注意，每个参数都可以有一个规范，我们可以在其中提供标签，描述，控制类型并指定验证条件。在8.0版之前，此规范仅由自定义生成对话框使用。现在，元运行者也使用此规范。</p><aside class="tip sideblock" rel="39c14062" id="e0cf0386" data-title=""><p id="f1514592">这里以Ant构建步骤为例。在初始构建配置中，您可以使用任何可用的构建运行器（例如MSBuild，.Net进程等）并配置设置，定义此构建步骤的参数。从此构建配置中提取元运行器时，构建步骤中定义的所有设置以及所有构建参数都将添加到元运行器中。</p></aside></div><a name="VerifyingBuildConfigurationWorksProperly"></a><a name="Verifying-Build-Configuration-Works-Properly"></a><div class="chapter"><h3 id="WorkingwithMeta-Runner-VerifyingBuildConfigurationWorksProperly">验证构建配置是否正常工作</h3><p id="5de73189">定义了构建步骤和参数后，我们需要通过自定义构建对话框运行几个构建，以确保构建配置能够正常工作：</p><p id="33661887"></p><figure><img alt="运行带有工件路径的定制构建" title="运行带有工件路径的定制构建" src="/help/img/teamcity/2019.1/cutom-build-with-paths-to-artifacts.png" id="d5912268" width="752" height="1230"></figure><p></p></div><a name="ExtractingandUsingMeta-Runner"></a><a name="Extracting-and-Using-Meta-Runner"></a><div class="chapter"><h3 id="WorkingwithMeta-Runner-ExtractingandUsingMeta-Runner">提取和使用Meta-Runner</h3><p id="7532f312">如果构建配置正常工作，我们可以使用右上角的“ <b id="62cfdd9a">操作”</b>按钮的“ <b id="bb4e1dc2">提取元运行器”</b>选项来创建元运行器：</p><p id="efabf112"></p><figure><img alt="提取元运行器" title="提取元运行器" src="/help/img/teamcity/2019.1/extract-meta-runner.png" id="3a084714" width="650" height="841"></figure><p></p><p id="c735ee8c">“ <b id="bc978d33">提取元运行器”</b>对话框需要指定将在其中创建元运行器的项目。在项目中创建的元运行器将在该项目及其所有子项目中可用。在我们的情况下<b id="0af1279f"><root project=""></root></b>处于选中状态，因此meta-runner将在所有项目中可用。</p><p id="101b6cdd">我们还需要提供元运行程序的名称，描述和ID：名称和描述将显示在Web界面中，需要一个ID才能将该元运行程序与其他运行程序区分开。</p><p id="ed7ca9eb">单击“ <b id="bc1c574f">提取”</b>按钮后，TeamCity将在此构建配置中获取所有构建步骤和参数的定义，并从中创建构建运行器。</p><aside class="tip sideblock" rel="ed7ca9eb" id="aae5741f" data-title=""><p id="eb3cb804">除了构建步骤和参数之外，元运行器还可以具有需求：如果在构建配置中定义了需求，则需求将自动提取到元运行器中。如果meta-runner使用的工具仅在特定平台上可用，则要求可能很有用。</p></aside><p id="e7f970a6">提取元运行器后，它就可以在构建运行器选择器中使用，并且可以像任何其他构建运行器一样在任何构建步骤中使用：</p><p id="cd6eaa6d"></p><figure><img alt="发布工件构建步骤" title="发布工件构建步骤" src="/help/img/teamcity/2019.1/meta-runner-build-step.png" id="b9e6a259" width="827" height="923"></figure><p></p><p id="2014abfa">当前的meta-runner用法可以在项目<b id="d0cba23b">Meta-Runners</b>页面上看到：</p><p id="425dcbea"></p><figure><img alt="元跑者" title="元跑者" src="/help/img/teamcity/2019.1/meta-runners.png" id="85e266da" width="1418" height="934"></figure><p></p><p id="7a82b947">提取元运行器时，将提取所有步骤。如果您需要重新排序参数，或者使亚军脚本一些快速修复，您可以编辑在Web浏览器中的原始XML定义：去<b id="324959ca">项目管理</b> | <b id="a838ceb4">Meta-Runners，</b>并使用meta-runner旁边的<b id="99c6d913">Edit</b>选项。参数的显示顺序与<code class="code"><param></code> xml定义中的元素。元流浪者的定义存储在<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">\config\projects\<project ID>\pluginData\metaRunners</code>夹。</p></div></div><a name="CreatingMeta-RunnerfromXMLDefinitionofBuildConfiguration"></a><a name="Creating-Meta-Runner-from-XML-Definition-of-Build-Configuration"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-CreatingMeta-RunnerfromXMLDefinitionofBuildConfiguration">通过构建配置的XML定义创建Meta-Runner</h2><p id="315a7560">另外，您可以将现有构建配置的xml定义用作元运行器。为此，请将此构建配置的定义保存到以下文件中： <runner id="">.xml，其中<runner id="">是此构建运行器的<a href="identifier.html">ID</a> 。<a href="#Installing-Meta-Runner">如上所述</a>安装meta-runner。</runner></runner></p><p id="b5c190ea">由于元运行器的外观和工作方式与其他运行器相同，因此也可以在现有元运行器的基础上创建另一个元运行器。</p></div><a name="CreatingBuildConfigurationfromMeta-Runner"></a><a name="Creating-Build-Configuration-from-Meta-Runner"></a><div class="chapter"><h2 id="WorkingwithMeta-Runner-CreatingBuildConfigurationfromMeta-Runner">从Meta-Runner创建构建配置</h2><p id="d35f50c2">如果您需要修复元运行程序并测试您的修复，则可以从元运行程序创建构建配置，可以更改其步骤，调整参数和要求，检查其工作方式，然后使用“ <b id="15b3b164">提取元运行程序”</b>操作将更改应用到具有相同ID的现有元运行器。</p><hr id="8e0ab05e"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>