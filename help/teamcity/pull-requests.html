<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>拉取请求-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Pull Requests" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/pull-requests.md|Pull Requests" data-main-title="Pull Requests" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/pull-requests.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="pull-requests.md" data-toc="Pull Requests">拉取请求</h1><p id="34a4d3ac">利用“ <i id="75db9328">拉取请求”</i>构建功能，您可以自动加载拉取请求（或在GitLab的情况下<i id="8582a3ad">合并请求</i> ）信息，并在以下VCS（版本控制系统）托管服务的拉取请求分支上运行构建：</p><ul class="list _ul"><li class="list__item" id="1eb62c89"><a href="#GitHub-Pull-Requests">的GitHub</a></li><li class="list__item" id="0e9f61c3"><a href="#Bitbucket-Server-Pull-Requests">Bitbucket服务器</a></li><li class="list__item" id="037835ad"><a href="#GitLab-Merge-Requests">亚搏体育app</a></li></ul><p id="6617039b">该功能扩展了VCS根目录的原始分支规范，该规范附加到当前的构建配置中，以包括与指定过滤条件匹配的拉取请求。它仅监视和触发构建<code class="code">head</code>分支机构（例如<code class="code">refs/pull/*/head</code> ）。<br>根据拉取请求运行构建后，TeamCity在“构建概述”页面上为拉取请求分支提供其他详细信息。</p><p id="c0f1f41d"></p><figure><img alt="拉取请求详细信息" title="拉取请求详细信息" src="/help/img/teamcity/2019.1/pr-info.png" id="60d409e4" width="923" height="525"></figure><p></p><aside class="note " rel="c0f1f41d" id="24522c43" data-title=""><p id="72c30aed">VCS根目录的分支规范<b id="e4a5bd0c">不得</b>包含与拉取请求分支匹配的模式。</p></aside><p id="43d9845a">添加此构建功能时，需要指定VCS根目录并选择VCS托管类型。</p><p id="3c9df0d0">构建功能参数取决于所选的VCS托管类型。</p><aside class="tip sideblock" rel="3c9df0d0" id="1130a0a8" data-title=""><p id="afc9946f">对于来自GitHub和GitLab的请求，您可以将TeamCity设置为在每个请求上自动运行构建，如果构建成功，则合并请求。<br>为此，请启用并配置“拉取请求”和“ <a href="automatic-merge.html">自动合并”</a>构建功能。</p></aside><p id="8df86660">请参阅有关如何设置TeamCity以在拉取请求上运行构建的<a href="#Workflow-example-for-the-Pull-Requests-build-feature">示例</a> 。</p><a name="VCS-specificsettings"></a><a name="VCS-specific-settings"></a><div class="chapter"><h2 id="PullRequests-VCS-specificsettings">VCS特定的设置</h2><a name="GitHubPullRequests"></a><a name="GitHub-Pull-Requests"></a><div class="chapter"><h3 id="PullRequests-GitHubPullRequests">GitHub拉取请求</h3><p id="ef93b07a">TeamCity支持<a href="https://github.com/" rel="noopener noreferrer" data-external="true" target="_blank">GitHub</a>和<a href="https://github.com/enterprise" rel="noopener noreferrer" data-external="true" target="_blank">GitHub Enterprise</a> 。</p><p id="2b5cf0f3">以下参数可用于GitHub托管类型：</p><div class="table-wrapper"><table class=" wide" width="100%" id="47b20a33"><thead><tr id="1e2aa335" class="ijRowHead"><th width="150" id="fa5ef336"><p id="f561c357">参数</p></th><th width="150" id="c6385fba"><p id="6234ac35">选项</p></th><th id="82730a27"><p id="ddfc0a6c">描述</p></th></tr></thead><tbody><tr id="0cab4e57" class="ijRowOdd"><td id="6bf6c041"><p id="39729b3a">认证类型</p></td><td id="3b593d50"><p id="6253dc16">使用VCS根凭证</p></td><td id="4dffed90"><p id="9a6851b7">TeamCity将尝试提取用户名/密码凭证或个人访问令牌/ <code class="code">x-oauth-basic</code>如果VCS根目录使用HTTP（S）提取URL，则从VCS根目录设置中删除。</p><p id="da8852a3">如果VCS根使用匿名身份验证或SSH，则此选项将不起作用。</p><p id="20ab9205">对于GitHub Enterprise存储库，仅个人访问令牌/ <code class="code">x-oauth-basic</code>对将工作。</p></td></tr><tr id="970418df" class="ijRowEven"><td id="8a6ddfc5"></td><td id="a0ee0df8"><p id="d5088653">访问令牌</p></td><td id="90f9c398"><p id="dbd23b89">出现“ <i id="4c2c7695">令牌</i> ”字段。</p><p id="a9d0eb84">使用个人访问令牌或通过OAuth连接获取令牌。它必须具有<code class="code">public_repo</code> （用于公共场所）或<code class="code">repo</code> （对于私有存储库）范围。</p></td></tr><tr id="f1d4510c" class="ijRowOdd"><td id="f428226d"><p id="e13bbd0f">作者</p><aside class="note " rel="e13bbd0f" id="09c66213" data-title=""><p id="70c42b67">该过滤器仅适用于公共存储库。</p></aside></td><td id="299ce124"><p id="b107e01c">同一组织的成员</p></td><td id="9a295bf4"><p id="6dafd23c">仅检测GitHub中<a href="https://help.github.com/en/articles/about-organization-membership" rel="noopener noreferrer" data-external="true" target="_blank">同一组织</a>的<a href="https://help.github.com/en/articles/about-organization-membership" rel="noopener noreferrer" data-external="true" target="_blank">成员</a>提交的请求请求。</p></td></tr><tr id="1552bd1c" class="ijRowEven"><td id="5f0a0221"></td><td id="195cb4d9"><p id="4ce50c78">成员和外部合作者</p></td><td id="fdf540fa"><p id="93fe14fe">仅检测GitHub中相同组织的成员和<a href="https://help.github.com/en/articles/adding-outside-collaborators-to-repositories-in-your-organization" rel="noopener noreferrer" data-external="true" target="_blank">外部协作者</a>提交的拉取请求。</p></td></tr><tr id="ec2c0d41" class="ijRowOdd"><td id="66069727"></td><td id="34036292"><p id="d16821ae">每个人</p></td><td id="160cd4ef"><p id="5ccaa809">检测所有拉取请求。请注意，选择此选项可能允许任意用户在您的构建代理上执行恶意代码。</p></td></tr><tr id="c7923abf" class="ijRowEven"><td id="38c2e7b1"><p id="622b0913">按目标分支</p></td><td id="14417112"></td><td id="9cb9a361"><p id="889e586a">指定目标分支的名称。如果留为空白，则不应用任何过滤器。</p></td></tr><tr id="dd1a79f1" class="ijRowOdd"><td id="b3b1ce33"><p id="718bdd3c">服务器网址</p></td><td id="915cc70d"></td><td id="c971408a"><p id="779f7118">指定用于连接的GitHub URL。</p><p id="bea97ca3">如果保留为空白，则将从VCS根获取URL中提取URL。</p></td></tr></tbody></table></div></div><a name="BitbucketServerPullRequests"></a><a name="Bitbucket-Server-Pull-Requests"></a><div class="chapter"><h3 id="PullRequests-BitbucketServerPullRequests">Bitbucket服务器拉取请求</h3><p id="ceba9138">以下参数可用于<a href="https://www.atlassian.com/software/bitbucket/enterprise/data-center" rel="noopener noreferrer" data-external="true" target="_blank">Bitbucket Server</a>托管类型：</p><div class="table-wrapper"><table class=" wide" width="100%" id="84596c0c"><thead><tr id="2eacb8e3" class="ijRowHead"><th width="150" id="12bdf8a1"><p id="05e89ab6">参数</p></th><th width="150" id="174e2af8"><p id="c3a2f8b4">选件</p></th><th id="e97247d1"><p id="2bbd380c">描述</p></th></tr></thead><tbody><tr id="f8f943aa" class="ijRowOdd"><td id="fad357bf"><p id="537c691a">认证类型</p></td><td id="20f5965b"><p id="d0f06775">使用VCS根凭证</p></td><td id="d6564ec5"><p id="34c267c4">如果VCS根目录使用HTTP（S）提取URL，TeamCity将尝试从VCS根目录设置中提取用户名/密码凭据。</p><p id="65cfb525">如果VCS根使用匿名身份验证，则此选项将不起作用。</p></td></tr><tr id="c56e0eee" class="ijRowEven"><td id="a1740fda"></td><td id="4d5a6757"><p id="8c16ffad">用户名密码</p></td><td id="184b8f83"><p id="6778af6e">出现“ <i id="c658cb1f">用户名</i> ”和“ <i id="b0b41881">密码</i> ”字段。</p><p id="c31f3440">指定用于连接到Bitbucket Server的用户名和密码。</p></td></tr><tr id="7c72482b" class="ijRowOdd"><td id="a7b70976"><p id="60fcd521">按目标分支</p></td><td id="f97a13e7"></td><td id="d853d016"><p id="37f85fa0">指定目标分支的名称。如果留为空白，则不应用任何过滤器。</p></td></tr><tr id="51eaea76" class="ijRowEven"><td id="71ce2784"><p id="333789e8">服务器网址</p></td><td id="8c23bf74"></td><td id="435f9062"><p id="830e9f24">指定用于连接的Bitbucket URL。</p><p id="14206438">如果保留为空白，则将从VCS根获取URL中提取URL。</p></td></tr></tbody></table></div></div><a name="GitLabMergeRequests"></a><a name="GitLab-Merge-Requests"></a><div class="chapter"><h3 id="PullRequests-GitLabMergeRequests">GitLab合并请求</h3><p id="96c7e1a6">TeamCity处理GitLab <a href="https://docs.gitlab.com/ee/user/project/merge_requests/index.html" rel="noopener noreferrer" data-external="true" target="_blank">合并请求的</a>方式与其处理其他托管服务中的拉取<a href="https://docs.gitlab.com/ee/user/project/merge_requests/index.html" rel="noopener noreferrer" data-external="true" target="_blank">请求的</a>方式类似。当前，TeamCity仅在启用此构建功能后才检测提交的合并请求。</p><p id="998c7522">以下参数可用于<a href="https://gitlab.com/" rel="noopener noreferrer" data-external="true" target="_blank">GitLab</a>托管类型：</p><div class="table-wrapper"><table width="100%" id="b1fd42a5"><thead><tr id="6972a136" class="ijRowHead"><th width="150" id="6a6772a8"><p id="73cd2f68">参数</p></th><th id="1f634ddb"><p id="40f07ba3">描述</p></th></tr></thead><tbody><tr id="95164209" class="ijRowOdd"><td id="c1745ac1"><p id="5061b146">访问令牌</p></td><td id="349996a5"><p id="7ad1994c">使用个人访问令牌进行连接。令牌必须具有<code class="code">api</code>范围。</p></td></tr><tr id="feb56412" class="ijRowEven"><td id="2e0f8520"><p id="98e2d30e">按目标分支</p></td><td id="05998e48"><p id="8db17454">指定目标分支的名称。如果留为空白，则不应用任何过滤器。</p></td></tr><tr id="b881776b" class="ijRowOdd"><td id="e61be5b1"><p id="a08730cd">服务器网址</p></td><td id="67171d09"><p id="94748147">指定用于连接的GitLab URL。</p><p id="a96e78fe">如果保留为空白，则将从VCS根获取URL中提取URL。</p></td></tr></tbody></table></div></div></div><a name="PullRequestsworkflowexample"></a><a name="Pull-Requests-workflow-example"></a><div class="chapter"><h2 id="PullRequests-PullRequestsworkflowexample">拉取请求工作流程示例</h2><p id="e7b95ad9">假设您设置了以下环境：</p><ul class="list _ul"><li class="list__item" id="c5c99a44"><p>公开的GitHub存储库<code class="code">web-app</code>与默认分支<code class="code">master</code></p></li><li class="list__item" id="7aadd372">TeamCity项目<ul class="list _ul"><li class="list__item" id="6cf6012d"><p>构建配置<code class="code">web-app</code>使用来自<code class="code">web-app</code>建立Web应用程序的资源库</p></li></ul></li></ul><p id="cd963c69">您的<a href="https://help.github.com/en/articles/about-organizations" rel="noopener noreferrer" data-external="true" target="_blank">组织</a>成员可以通过将拉取请求发送到<code class="code">master</code>分支，并且您希望在合并之前在TeamCity中自动构建和测试这些更改。<br>TeamCity可以检测发送到<code class="code">master</code>分支并基于更新的源构建Web应用程序。</p><aside class="note " rel="cd963c69" id="f5cf3637" data-title=""><p id="0e21ae3d">的<code class="code">web-app</code>构建配置必须启用VCS触发器。</p></aside><p id="57641192">为以下配置管道<code class="code">web-app</code>在TeamCity中构建配置：</p><ol class="list _decimal"><li class="list__item" id="6e84f872"><b id="5488bafd">将<a href="vcs-root.html">VCS根目录</a>添加到构建配置中</b> ：<ul class="list _ul"><li class="list__item" id="51921065"><p>转到<b id="07b63816">构建配置设置|版本控制设置</b> ，然后单击<b id="a3e46660">附加VCS根目录</b> 。</p></li><li class="list__item" id="576c5308">配置根参数：<ul class="list _ul"><li class="list__item" id="d28ec7a4"><p><b id="5a3f5839">VCS类型</b> ： <i id="7fc88749">Git</i></p></li><li class="list__item" id="c841c44a"><p><b id="e4824554">VCS根名称</b> ：<i id="f7d14884"><unique_root_name></unique_root_name></i></p></li><li class="list__item" id="350d3b7a"><p><b id="bfc28c01">获取网址</b> ：<i id="d3d295e4"><github_repository_url></github_repository_url></i></p></li><li class="list__item" id="343c175c"><p><b id="742a79d2">默认分支</b> ：要监视的分支；默认， <i id="5f0098f7"><code class="code">refs/heads/master</code></i> （了解<a href="working-with-feature-branches.html">有关功能分支的</a>更多<a href="working-with-feature-branches.html">信息</a> ）</p></li><li class="list__item" id="f09698db"><p><b id="de1a3c9f">分支规范</b> ：用于监视其他分支的过滤器（例如， <i id="e02c4657"><code class="code">+:refs/heads/*</code></i> ）</p></li><li class="list__item" id="1ea2ba5e"><p>有权访问的GitHub用户的<b id="f121e00e">身份验证参数</b> <code class="code">web-app</code>资料库</p></li></ul></li><li class="list__item" id="3ed02361"><p>测试连接，如果成功，请单击<b id="56cb32a6">创建</b> 。</p></li></ul></li><li class="list__item" id="e973fe50"><b id="7152f171">将<i id="f35104c3">Pull Requests</i> <a href="adding-build-features.html">构建功能</a>添加到构建配置中</b> ：<ul class="list _ul"><li class="list__item" id="219169ae"><p>转到<b id="2f5fb064">构建配置设置|构建功能</b> ，然后单击<b id="4f2eb73c">添加构建功能</b> 。</p></li><li class="list__item" id="4d40df87">配置功能部件参数：<ul class="list _ul"><li class="list__item" id="97ddf2e5"><p><b id="c68b3c16">VCS根</b> ：在步骤1中创建的VCS根</p></li><li class="list__item" id="5de89737"><p><b id="bc26595a">VCS托管类型</b> ： <i id="5e2d7f49">GitHub</i></p></li><li class="list__item" id="e3bc8659"><p><b id="daf0be9b">身份验证类型</b> ： <i id="f65ee282">使用VCS根凭据</i> ，或选择<i id="654c99a3">访问令牌</i>以使用GitHub令牌代替</p></li><li class="list__item" id="621ecb33"><b id="324e09ba">拉取请求过滤</b> ：<ul class="list _ul"><li class="list__item" id="abf2a49d"><p><b id="b616e1f4">作者</b> ： <i id="9560ed73">同一组织的成员</i></p></li><li class="list__item" id="c0d2c106"><p><b id="792d78d9">按目标分支</b> ：留空以不应用任何过滤器并监视存储库中的所有新请求请求，或显式指定目标分支（在此示例中， <i id="b862f9c5"><code class="code">master</code></i> ）</p></li></ul></li></ul></li><li class="list__item" id="1506859f"><p>测试连接，如果成功，请单击<b id="f4bc6b31">保存</b> 。</p></li></ul></li></ol><p id="5bbde2a7">而已！现在，当您的GitHub组织的成员将拉取请求发送到<code class="code">master</code>分支机构，TeamCity的行为如下：</p><ol class="list _decimal"><li class="list__item" id="f0252852"><p>检测发送到<code class="code">master</code>科。</p></li><li class="list__item" id="b0744177"><p>运行<code class="code">web-app</code>构建配置：根据您预定义的构建步骤收集源，构建和测试应用程序。</p></li><li class="list__item" id="ab1f1400"><p>在构建配置<b id="fd05d9e5">概述</b>页面上显示有关已处理的拉取请求的信息。您可以立即看到拉取请求状态（1），并刷新有关其状态（2）的信息。</p></li></ol><p id="4efcadd2"></p><figure><img alt="构建概述中的请求请求信息" title="构建概述中的请求请求信息" src="/help/img/teamcity/2019.1/PullRequestOverviewInfo.png" id="28f2c030" width="500" height="552"></figure><p></p><p id="6f67a118"><b id="a2d5c95e">专家提示</b></p><p id="2e389d64">您可以进一步自动化设置，因此TeamCity：</p><ul class="list _ul"><li class="list__item" id="042ebe9f"><p>构建完成后，使用“ <a href="commit-status-publisher.html">提交状态发布者”</a>构建功能将构建状态发送回GitHub</p></li><li class="list__item" id="67ff431a"><p>如果构建成功完成，则使用<a href="automatic-merge.html">自动合并</a>构建功能在GitHub中合并拉取请求</p></li></ul><hr id="1b6fe79b"><p id="62b5a8a1"><b id="17b651b3">另请参阅</b> ：</p><p id="fa7c00e2"><b id="1800a21d">TeamCity博客</b> ： <a href="https://blog.jetbrains.com/teamcity/2019/08/building-github-pull-requests-with-teamcity/" rel="noopener noreferrer" data-external="true" target="_blank">使用TeamCity构建GitHub拉取请求</a></p><hr id="6de39aca"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>