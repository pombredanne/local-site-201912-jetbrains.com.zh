<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Getting Started with NUnit - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Getting Started with NUnit" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/getting-started-with-nunit.md|Getting Started with NUnit" data-main-title="Getting Started with NUnit" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/getting-started-with-nunit.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Getting Started with NUnit" id="getting-started-with-nunit.md">Getting Started with NUnit</h1><p id="b16941c9">This tutorial aims at describing the basic practices of using <a href="http://www.nunit.org/" data-external="true" target="_blank" rel="noopener noreferrer">NUnit 3</a> in TeamCity. The test project and script samples can be found <a href="https://github.com/JetBrains/teamcity-nunit-samples" data-external="true" target="_blank" rel="noopener noreferrer">here</a>. The order of use cases is based on the number of the TeamCity features involved: the first case is the most basic, more complex cases that follow utilize a larger number of features. We recommend you familiarizing yourself with all features, finding their advantages and disadvantages, and then decide in favor of one or another.</p><p id="aebc2337">On this page:</p><p id="2190fe30"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#GettingStartedwithNUnit-InstallingNUnit">Installing NUnit</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case1.CommandLine">Case 1. Command Line</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case2.MSBuild">Case 2. MSBuild</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case3.NUnitBuildStep">Case 3. NUnit Build Step</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case4.NUnitBuildStep,options">Case 4. NUnit Build Step, options</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-DebuggingNUnittests">Debugging NUnit tests</a></li></ul></p><a name="InstallingNUnit"></a><a name="Installing-NUnit"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-InstallingNUnit">Installing NUnit</h2><a name="installing-nunit"></a><p id="2a445970">To use the TeamCity NUnit build runner, install the <a href="https://www.nuget.org/packages/NUnit/" data-external="true" target="_blank" rel="noopener noreferrer">NUnit NuGet package</a> on TeamCity agents first <b origin="teamcity-help" id="54c5ffec">using one of the following options</b>:</p><ul class="list _ul"><li class="list__item" id="aa069fd6"><p id="e1498f4e">Add the NuGet Install build step as the first step of your build configuration.<br>For example, you can add a <a href="command-line.html">Command Line</a> build step before the NUnit build step which will install the <code class="code">NUnit.Console</code> NuGet package as follows:</p><div class="code-block" data-lang="bash">%teamcity.tool.NuGet.CommandLine.DEFAULT%tools\nuget.exe install NUnit.Console -version 3.6.0 -o packages

</div><p id="3ba3ff64">Note that <code class="code">%teamcity.tool.NuGet.CommandLine.DEFAULT%</code> is a reference to the NuGet installed under the TeamCity agent.<br>You can install NuGet on agents from the <b origin="teamcity-help" id="aaa770b8">Administration | Tools</b> page, where you can also mark one of the installed NuGet versions as default.</p><p id="60f7ec56">After that, the <code class="code">%teamcity.tool.NuGet.CommandLine.DEFAULT%</code> parameter reference should properly resolve to the NuGet installation path on the agent.<br>Then nunit3-console should appear under the packages directory.</p><p id="66c954eb">To run tests, in the next NUnit build step specify the NUnit path in the NUnit settings as <code class="code">packages\NUnit.ConsoleRunner.3.6.0\tools\nunit3-console.exe</code>.</p><p id="c4e597c6"><i origin="teamcity-help" id="d3762213">or</i></p></li><li class="list__item" id="d53ed8a9"><p id="69b12eff">Install NUnit manually on all of the agents in some standard location and configure the path to <code class="code">nunit-console.exe</code> in your NUnit build step.</p></li></ul></div><a name="Case1.CommandLine"></a><a name="Case-1.-Command-Line"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case1.CommandLine">Case 1. Command Line</h2><p id="2d20e5f7">Starting from version 3, NUnit supports TeamCity out-of-the-box, which allows running tests from the command line, preserving the basic features TeamCity-NUnit integration. NUnit automatically detects if it is run by TeamCity and, if so, switches to the integration mode.</p><p id="4374a2b2">In addition to auto-detection, the NUnit 3 console handles the special <code class="code">--teamcity</code> argument, which also includes the integration with TeamCity. This argument can be used for the purposes of debugging, when you need to see what information NUnit sends to TeamCity: detailed test information, the order of tests, and so on.</p><p id="56b9a26d">Using the NUnit console from the command line is the simplest way to run tests. TeamCity provides the following basic features of integration for the command line:</p><ul class="list _ul"><li class="list__item" id="1d1513c2"><p>reporting the test run information in Build Log while the tests are executing</p></li><li class="list__item" id="631bc86f"><p>reporting the test results upon the tests finish</p></li><li class="list__item" id="2b75195e"><p>all the <a href="investigating-and-muting-build-failures.html">TeamCity investigation features</a></p></li></ul><p id="e3d2cac3">This is what the TeamCity build step to run tests from the command line looks like:</p><p id="99d012e9"><figure><img alt="Build step: Command Line" title="Build step: Command Line" src="/help/img/teamcity/2019.1/nunit-cmd.png" id="5683537e" width="780" height="542"></figure></p><p id="24cd617f">To sum up, with this simple case you can use the basic features of the TeamCity-NUnit 3 integration.</p></div><a name="Case2.MSBuild"></a><a name="Case-2.-MSBuild"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case2.MSBuild">Case 2. MSBuild</h2><p id="22314407">This use case is very similar to the previous one, but it aims at MSBuild which is the most widely used build platform for .NET projects.</p><p id="5bfca4e7">TeamCity supports collecting code coverage statistics out of the box; additional plugins can be <a href="installing-additional-plugins.html">installed</a> to use the <a href="https://github.com/JetBrains/teamcity-dottrace" data-external="true" target="_blank" rel="noopener noreferrer">JetBrains dotTrace</a> and <a href="https://github.com/JetBrains/teamcity-dotmemory" data-external="true" target="_blank" rel="noopener noreferrer">JetBrains dotMemory Unit</a> in TeamCity.</p><p id="49334844">The <a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/sample2.proj" data-external="true" target="_blank" rel="noopener noreferrer">project file</a> is trivial: the <a href="https://msdn.microsoft.com/en-us/library/x8zx72cd.aspx" data-external="true" target="_blank" rel="noopener noreferrer">Exec</a> task, which launches tests, is run:</p><a name="msbuild-examples-nunit"></a><div class="code-block" data-lang="bash">
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;Project ToolsVersion="14.0" DefaultTargets="RunTests" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt;
&nbsp;&lt;Target Name="RunTests"&gt;
&nbsp;&nbsp;&lt;Exec IgnoreExitCode="True" Command="nunit3-console.exe Tests.dll"&gt;
&nbsp;&lt;Output TaskParameter="ExitCode" ItemName="exitCode" /&gt;
&nbsp;&nbsp;&lt;/Exec&gt;
&nbsp;&lt;Error Text="Error while running tests" Condition="@(exitCode) &amp;lt; 0" /&gt;
&nbsp;&nbsp;&lt;/Target&gt;
&lt;/Project&gt;

</div><p id="0784e845">The NUnit console returns the number of failed tests as the positive exit code and, in case of the NUnit test infrastructure failure, as the negative exit code.</p><p id="eadfe657">TeamCity controls the test execution progress, but the NUnit infrastructure exceptions may not allow TeamCity to collect the required information. That is why the <code class="code">IgnoreExitCode="True"</code> attribute needs to be set, which will ignore the positive exit codes and will not interrupt the build due to several failed tests. The <a href="https://msdn.microsoft.com/en-us/library/8b08t3s4.aspx" data-external="true" target="_blank" rel="noopener noreferrer">Error</a> task will stop the build in case of the test infrastructure errors for the negative exit codes.</p><p id="8a72eb06"><figure><img alt="Build step: MSBuild" title="Build step: MSBuild" src="/help/img/teamcity/2019.1/nunit-msbuild.png" id="411821d4" width="830" height="1149"></figure></p><p id="ffa4a195">Besides the project file, you can define the MSBuild version and target platform, use profiles and other settings.</p><p id="96d2309d">To make the build more stable, you can introduce a few changes to the project file. For example, you can define the path to the NUnit console dynamically. This path may change with the updates of the NUnit console NuGet package, but our build configuration will not require any changes. The code below gets the path to the NUnit console to the <code class="code">pathToNUnitConsole</code> variable:</p><div class="code-block" data-lang="bash">&lt;GetNUnitConsolePath
BaseDir="$(MSBuildProjectDirectory)\packages"&gt;
 &lt;Output TaskParameter="PathToNUnitConsole" ItemName="pathToNUnitConsole"/&gt;
&lt;/GetNUnitConsolePath&gt;

</div><p id="8e130ad9">You can dynamically list the assemblies to be tested. For example, search for them in specific directories and filter them to match a regular expression pattern:</p><div class="code-block" data-lang="bash">&lt;ItemGroup&gt;
 &lt;Assemblies Include="Tests\bin\**\*.dll"/&gt;
&lt;/ItemGroup&gt;
 
&lt;CreateNUnitListOfAssemblies
Assemblies="@(Assemblies)" RegexpAssemblyFilter=".*Tests.dll$"&gt;
  &lt;Output TaskParameter="ListOfAssemblies" ItemName="listOfAssemblies"/&gt;
&lt;/CreateNUnitListOfAssemblies&gt;

</div><p id="eb3cab3e">The following project files contain some examples: <a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/sample2adv.proj" data-external="true" target="_blank" rel="noopener noreferrer">sample2adv.proj</a>, <a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/nunit-utils.targets" data-external="true" target="_blank" rel="noopener noreferrer">unit-utils.targets</a>.</p></div><a name="Case3.NUnitBuildStep"></a><a name="Case-3.-NUnit-Build-Step"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case3.NUnitBuildStep">Case 3. NUnit Build Step</h2><p id="1e21b204">Note that the NUnit runner supports only <a href="https://docs.microsoft.com/en-us/dotnet/framework/get-started/overview" data-external="true" target="_blank" rel="noopener noreferrer">.NET Framework</a>. To run tests for <a href="https://docs.microsoft.com/en-us/dotnet/framework/get-started/net-core-and-open-source" data-external="true" target="_blank" rel="noopener noreferrer">.NET Core</a> projects (and .NET Framework projects version 4.0 or later), use the .NET CLI (dotnet) build runner with the <a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-test" data-external="true" target="_blank" rel="noopener noreferrer">test</a> command instead. Refer to the <a href="nunit-support.html#Framework-Compatibility">NUnit Support</a> page for details.</p><p id="b5807eda">The <a href="nunit.html">NUnit</a> build step is probably the simplest and yet most powerful way to launch NUnit tests in TeamCity.<br>In most cases its sufficient to set only the 2 parameters: the path to the NUnit console runner and the list of assemblies to be tested.</p><p id="f43eb509"><figure><img alt="Build step: NUnit" title="Build step: NUnit" src="/help/img/teamcity/2019.1/nunit-step.png" id="4d14c7ab" width="1005" height="1219"></figure></p><p id="f0c6a1da">The <i id="e91e171b">NUnit runner</i> field defines the NUnit version used to run tests. When configuring your build step for NUnit 3, the <i id="6102c2a6">Path to NUnit console runner</i> field is required to contain the path to the NUnit console: prior to TeamCity 9.1.4 specify the <i id="4ce8e2e2">directory</i> containing the console executable file, in the later TeamCity versions specify <i id="f507cbcd">the path to the console executable file including the file name</i>.</p><p id="597eb7c5">In all the examples the NuGet package manager provides the NUnit infrastructure. Using NuGet enables the user to conveniently manage the test environment, update NUnit, and run test locally as they will be run by TeamCity.</p><p id="772f1045">The NUnit build step is a straightforward and user-friendly way to run NUnit tests in TeamCity. It provides the maximum range of options simultaneously concealing the specifics of running tests on different OSs by using <a href="http://www.mono-project.com/" data-external="true" target="_blank" rel="noopener noreferrer">Mono</a>.</p></div><a name="Case4.NUnitBuildStep,options"></a><a name="Case-4.-NUnit-Build-Step,-options"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case4.NUnitBuildStep,options">Case 4. NUnit Build Step, options</h2><p id="6f66b67c">When configuring the NUnit build step for NUnit 3, it requires specifying the NUnit Console runner (either selecting a preinstalled tool or entering a custom path).</p><p id="cba1ae69">The other fields provide a lot of useful options, and this section discusses some of them.</p><p id="7956b62d"><figure><img alt="Build step: NUnit, advanced options" title="Build step: NUnit, advanced options" src="/help/img/teamcity/2019.1/nunit-step-advanced.png" id="588f719b" width="1056" height="1479"></figure></p><p id="46690191">One of the options is defining the <b id="8ac706a0">application configuration file</b>. Sometimes tests obtain data from a configuration file, and to facilitate this, you need to define the path to the application configuration file to be used when running tests in the <i id="a09b7969">Path to application configuration file</i> field. The path can be absolute or relative to the <a href="build-checkout-directory.html">Build Checkout Directory</a>. Unfortunately, NUnit is limited by allowing only one configuration file per build step. Due to this limitation, if you need to test several assemblies with different configurations in one build step, you have to aggregate several application configuration files into a common configuration file. If it is not possible, split the test launch into several steps and define a configuration file in each of the steps.</p><p id="88232e2d">The NUnit 3 console has a great number of settings defined by command line arguments. The <i id="7b60d457"><a href="nunit.html#NUnit-Test-Settings">Additional command line parameters</a></i> field allows setting many of the command line parameters for the NUnit console, but there are some limitations:</p><ul class="list _ul"><li class="list__item" id="cbe8eba9"><p>The <code class="code">--where</code> command line argument is used as the priority test filtering setting. When it is used simultaneously with the <i id="b485a267">NUnit categories include</i> or/and <i id="f29e719f">NUnit categories exclude</i> fields to filter tests by category, TeamCity will ignore these options: a warning will be displayed and only the <code class="code">--where</code> argument will be used.</p></li><li class="list__item" id="07ae3651">Using the parameters below in the <i id="f9c8fa96">Additional command line parameters</i> field may cause your build to fail:<ul class="list _ul"><li class="list__item" id="5e17361e"><p>the list of assemblies to be tested, as the NUnit build step determines the list of assemblies from the NUnit project file due to the command line size limitations</p></li><li class="list__item" id="5e6763f0"><p>NUnit project file, as TeamCity creates its own temporary NUnit project file (see <a href="#Debugging-NUnit-tests">below</a>)</p></li><li class="list__item" id="4b3bdb68"><p><code class="code">--work</code>: the NUnit build step uses the <a href="build-checkout-directory.html">Build Checkout Directory</a> as the base directory</p></li><li class="list__item" id="49ac8680"><p><code class="code">--noheader</code> is used by default</p></li><li class="list__item" id="7ddd3804"><p><code class="code">--x86</code> if the <i id="16451690">.NET Runtime | Platform</i> field is set to <code class="code">x86</code></p></li><li class="list__item" id="f133730b"><p><code class="code">--framework</code> if the <i id="9be83f22">.NET Runtime | Version</i> is set to something other than <code class="code">auto</code></p></li><li class="list__item" id="b43744bb"><p><code class="code">--explore</code> if the algorithm below is used</p></li></ul></li></ul><p id="26aa7e41">The NUnit build step can be set to first run the tests which failed in the previous builds. The idea is that it saves time to conclude about a probable state of the finished build. If the <i id="ce011f75">Reduce test failure feedback time</i> flag is set, the tests are run in three steps provided that the previous build has failed tests:</p><p id="b037ab45">1. As the first step, TeamCity obtains all the list of tests for assemblies taking into account filters by category (the <code class="code">--explore</code> console argument is used), the statistics of the previous step run is analysed and 2 test lists are created: the priority list and the rest. The priority list includes the tests which failed in the previous build.</p><aside class="note " data-title="" rel="b037ab45" id="e9dea99b"><p id="e5370301">Note that when the <i id="7af7e2c7">Reduce test failure feedback time</i> option is enabled, the <code class="code">Explicit</code> attribute <b id="8f3bee68">will not work</b>.</p></aside><p id="86cb37b4">2. During this step the priority tests are run.<br>3. The remaining tests follow.</p><p id="d2540c14">Another great feature of the NUnit build step is the fact that it executes tests on different OSs the same way, without changing the configuration. This is true if the agents, where the full-blown .NET is unavailable, have <a href="http://www.mono-project.com/" data-external="true" target="_blank" rel="noopener noreferrer">Mono</a>. It allows the build configurations to be OS-independent.</p></div><a name="DebuggingNUnittests"></a><a name="Debugging-NUnit-tests"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-DebuggingNUnittests">Debugging NUnit tests</h2><p id="0fa9e0a4">All the actions performed by TeamCity to run tests a user can reproduce in the command line. This allows for quick and effective resolution of the potential issues with configuring a build.</p><p id="578c2abd">TeamCity records all the data related to running tests into the <a href="build-log.html">Build Log</a>. Thus the commands that TeamCity uses to run tests can be copied from the build log and can be run from the command line locally or on agents.</p><p id="493ec805">When running tests, besides commands, TeamCity creates temporary files:</p><ul class="list _ul"><li class="list__item" id="073cfb33"><p>NUnit project files</p></li><li class="list__item" id="66f59c4e"><p>JetBrains dotCover</p></li><li class="list__item" id="44fa2287"><p>JetBrains dotTrace or JetBrains dotMemory Unit configuration files</p></li></ul><p id="c1009b24">These are contained in <a href="build-artifact.html#Hidden-Artifacts">hidden build artifacts</a>. For example, the command line launching tests for <a href="#Case-4.-NUnit-Build-Step,-options">case 4</a> will look as follows in the build log:</p><div class="code-block" data-lang="bash">...\nunit3\-console.exe ...\5Oqkbf9J2qJNkUK4KEtKvxs8TFFnlrno.nunit

</div><p id="67980c19">In this case <code class="code">5Oqkbf9J2qJNkUK4KEtKvxs8TFFnlrno.nunit</code> is the NUnit project file, which can be downloaded from <a href="build-artifact.html#Hidden-Artifacts">hidden build artifacts</a>:</p><p id="0db87f48"><figure><img alt="NUnit hidden artifacts" title="NUnit hidden artifacts" src="/help/img/teamcity/2019.1/nunit-hidden-artifacts.png" id="5d58bdf1" width="692" height="571"></figure></p><hr id="f3358ed1"><p id="7ac82a53"><b id="089f0a59">See also:</b></p><p id="7340ec69"><b id="a116135d">Administrator's Guide</b>: <a href="nunit-support.html">NUnit Support</a></p><hr id="30c68796"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>