<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>NUnit入门-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Getting Started with NUnit" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/getting-started-with-nunit.md|Getting Started with NUnit" data-main-title="Getting Started with NUnit" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/getting-started-with-nunit.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="getting-started-with-nunit.md" data-toc="Getting Started with NUnit">NUnit入门</h1><p id="b16941c9">本教程旨在描述在TeamCity中使用<a href="http://www.nunit.org/" rel="noopener noreferrer" data-external="true" target="_blank">NUnit 3</a>的基本实践。测试项目和脚本样本可以在<a href="https://github.com/JetBrains/teamcity-nunit-samples" rel="noopener noreferrer" data-external="true" target="_blank">这里</a>找到。用例的顺序取决于所涉及的TeamCity功能的数量：第一种情况是最基本，更复杂的情况，随后使用大量功能。我们建议您熟悉所有功能，发现它们的优缺点，然后决定赞成其中一项。</p><p id="aebc2337">在此页：</p><p id="2190fe30"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#GettingStartedwithNUnit-InstallingNUnit">安装NUnit</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case1.CommandLine">情况1。命令行</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case2.MSBuild">情况二MSBuild</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case3.NUnitBuildStep">情况3。NUnit构建步骤</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-Case4.NUnitBuildStep,options">情况4NUnit构建步骤，选项</a></li><li class="list__item"><a href="#GettingStartedwithNUnit-DebuggingNUnittests">调试NUnit测试</a></li></ul><p></p><a name="InstallingNUnit"></a><a name="Installing-NUnit"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-InstallingNUnit">安装NUnit</h2><a name="installing-nunit"></a><p id="2a445970">要使用TeamCity NUnit构建运行器，请首先<b id="54c5ffec" origin="teamcity-help">使用以下选项之一</b>在TeamCity代理上安装<a href="https://www.nuget.org/packages/NUnit/" rel="noopener noreferrer" data-external="true" target="_blank">NUnit NuGet软件包</a> ：</p><ul class="list _ul"><li class="list__item" id="aa069fd6"><p id="e1498f4e">将NuGet安装构建步骤添加为构建配置的第一步。<br>例如，您可以在NUnit构建步骤之前添加一个<a href="command-line.html">命令行</a>构建步骤，该步骤将安装<code class="code">NUnit.Console</code> NuGet包如下：</p><div class="code-block" data-lang="bash">％teamcity.tool。NuGet。命令行。DEFAULT％tools \ nuget.exe安装NUnit。控制台-版本3.6.0 -o软件包</div><p id="3ba3ff64">注意<code class="code">%teamcity.tool.NuGet.CommandLine.DEFAULT%</code>是对TeamCity代理下安装的NuGet的引用。<br>您可以从<b id="aaa770b8" origin="teamcity-help">管理|</b>代理上安装NuGet。 <b id="aaa770b8" origin="teamcity-help">工具</b>页面，您还可以在其中将已安装的NuGet版本之一标记为默认版本。</p><p id="60f7ec56">之后， <code class="code">%teamcity.tool.NuGet.CommandLine.DEFAULT%</code>参数参考应正确解析为代理上的NuGet安装路径。<br>然后，nunit3-console应该出现在packages目录下。</p><p id="66c954eb">要运行测试，请在下一个NUnit构建步骤中，将NUnit设置中的NUnit路径指定为<code class="code">packages\NUnit.ConsoleRunner.3.6.0\tools\nunit3-console.exe</code> 。</p><p id="c4e597c6"><i id="d3762213" origin="teamcity-help">要么</i></p></li><li class="list__item" id="d53ed8a9"><p id="69b12eff">在某个标准位置的所有代理上手动安装NUnit并将路径配置为<code class="code">nunit-console.exe</code>在您的NUnit构建步骤中。</p></li></ul></div><a name="Case1.CommandLine"></a><a name="Case-1.-Command-Line"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case1.CommandLine">情况1。命令行</h2><p id="2d20e5f7">从版本3开始，NUnit开箱即用地支持TeamCity，它允许从命令行运行测试，并保留TeamCity-NUnit集成的基本功能。NUnit自动检测它是否由TeamCity运行，如果是，则切换到集成模式。</p><p id="4374a2b2">除了自动检测，NUnit 3控制台还可以处理特殊的<code class="code">--teamcity</code>论点，其中还包括与TeamCity的集成。当您需要查看NUnit发送到TeamCity的信息时，可以使用此参数进行调试：详细的测试信息，测试顺序等。</p><p id="56b9a26d">从命令行使用NUnit控制台是运行测试的最简单方法。TeamCity为命令行提供以下集成的基本功能：</p><ul class="list _ul"><li class="list__item" id="1d1513c2"><p>在执行测试时，在构建日志中报告测试运行信息</p></li><li class="list__item" id="631bc86f"><p>测试结束后报告测试结果</p></li><li class="list__item" id="2b75195e"><p>所有<a href="investigating-and-muting-build-failures.html">TeamCity调查功能</a></p></li></ul><p id="e3d2cac3">这是从命令行运行测试的TeamCity构建步骤，如下所示：</p><p id="99d012e9"></p><figure><img alt="构建步骤：命令行" title="构建步骤：命令行" src="/help/img/teamcity/2019.1/nunit-cmd.png" id="5683537e" width="780" height="542"></figure><p></p><p id="24cd617f">综上所述，通过这种简单的情况，您可以使用TeamCity-NUnit 3集成的基本功能。</p></div><a name="Case2.MSBuild"></a><a name="Case-2.-MSBuild"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case2.MSBuild">情况二MSBuild</h2><p id="22314407">此用例与前一个用例非常相似，但它针对的是MSBuild，它是.NET项目使用最广泛的构建平台。</p><p id="5bfca4e7">TeamCity支持开箱即用地收集代码覆盖率统计信息。可以<a href="installing-additional-plugins.html">安装</a>其他插件来使用TeamCity中的<a href="https://github.com/JetBrains/teamcity-dottrace" rel="noopener noreferrer" data-external="true" target="_blank">JetBrains dotTrace</a>和<a href="https://github.com/JetBrains/teamcity-dotmemory" rel="noopener noreferrer" data-external="true" target="_blank">JetBrains dotMemory Unit</a> 。</p><p id="49334844">该<a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/sample2.proj" rel="noopener noreferrer" data-external="true" target="_blank">项目文件</a>微不足道：运行启动测试的<a href="https://msdn.microsoft.com/en-us/library/x8zx72cd.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Exec</a>任务：</p><a name="msbuild-examples-nunit"></a><div class="code-block" data-lang="bash">
<!--?xml version="1.0" encoding="utf-8" ?=""-->
<project toolsversion="14.0" defaulttargets="RunTests" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
 <target name="RunTests">
  <exec ignoreexitcode="True" command="nunit3-console.exe Tests.dll">
 <output taskparameter="ExitCode" itemname="exitCode"></output>
  </exec>
 <error text="Error while running tests" condition="@(exitCode) < 0"></error>
  </target>
</project>

<!--?xml--></div><p id="0784e845">NUnit控制台将失败测试的数量作为正退出代码返回，如果NUnit测试基础结构失败，则将其作为负退出代码返回。</p><p id="eadfe657">TeamCity控制测试执行进度，但是NUnit基础结构异常可能不允许TeamCity收集所需的信息。这就是为什么<code class="code">IgnoreExitCode="True"</code>需要设置属性，它将忽略正退出代码，并且不会由于几次失败的测试而中断构建。如果测试基础结构针对负退出代码出现错误，则<a href="https://msdn.microsoft.com/en-us/library/8b08t3s4.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Error</a>任务将停止构建。</p><p id="8a72eb06"></p><figure><img alt="构建步骤：MSBuild" title="构建步骤：MSBuild" src="/help/img/teamcity/2019.1/nunit-msbuild.png" id="411821d4" width="830" height="1149"></figure><p></p><p id="ffa4a195">除了项目文件，您还可以定义MSBuild版本和目标平台，使用配置文件和其他设置。</p><p id="96d2309d">为了使构建更加稳定，您可以对项目文件进行一些更改。例如，您可以动态定义NUnit控制台的路径。该路径可能会随着NUnit控制台NuGet软件包的更新而更改，但是我们的构建配置将不需要任何更改。以下代码将NUnit控制台的路径获取到<code class="code">pathToNUnitConsole</code>变量：</p><div class="code-block" data-lang="bash"><getnunitconsolepath basedir="$(MSBuildProjectDirectory)\packages">
 <output taskparameter="PathToNUnitConsole" itemname="pathToNUnitConsole"></output>
</getnunitconsolepath>

</div><p id="8e130ad9">您可以动态列出要测试的程序集。例如，在特定目录中搜索它们并过滤它们以匹配正则表达式模式：</p><div class="code-block" data-lang="bash"><itemgroup>
 <assemblies include="Tests\bin\**\*.dll"></assemblies>
</itemgroup>
 
<createnunitlistofassemblies assemblies="@(Assemblies)" regexpassemblyfilter=".*Tests.dll$">
  <output taskparameter="ListOfAssemblies" itemname="listOfAssemblies"></output>
</createnunitlistofassemblies>

</div><p id="eb3cab3e">以下项目文件包含一些示例： <a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/sample2adv.proj" rel="noopener noreferrer" data-external="true" target="_blank">sample2adv.proj</a> ， <a href="https://github.com/JetBrains/teamcity-nunit-samples/blob/master/nunit-utils.targets" rel="noopener noreferrer" data-external="true" target="_blank">unit-utils.targets</a> 。</p></div><a name="Case3.NUnitBuildStep"></a><a name="Case-3.-NUnit-Build-Step"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case3.NUnitBuildStep">情况3。NUnit构建步骤</h2><p id="1e21b204">请注意，NUnit运行器仅支持<a href="https://docs.microsoft.com/en-us/dotnet/framework/get-started/overview" rel="noopener noreferrer" data-external="true" target="_blank">.NET Framework</a> 。要为<a href="https://docs.microsoft.com/en-us/dotnet/framework/get-started/net-core-and-open-source" rel="noopener noreferrer" data-external="true" target="_blank">.NET Core</a>项目（和.NET Framework项目4.0或更高版本）运行测试，请改用.NET CLI（dotnet）构建运行程序和<a href="https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-test" rel="noopener noreferrer" data-external="true" target="_blank">test</a>命令。有关详细信息，请参考<a href="nunit-support.html#Framework-Compatibility">NUnit支持</a>页面。</p><p id="b5807eda"><a href="nunit.html">NUnit</a>构建步骤可能是在TeamCity中启动NUnit测试的最简单但功能最强大的方法。<br>在大多数情况下，仅设置两个参数就足够了：NUnit控制台运行器的路径和要测试的程序集列表。</p><p id="f43eb509"></p><figure><img alt="构建步骤：NUnit" title="构建步骤：NUnit" src="/help/img/teamcity/2019.1/nunit-step.png" id="4d14c7ab" width="1005" height="1219"></figure><p></p><p id="f0c6a1da"><i id="e91e171b">NUnit</i>运行器字段定义用于运行测试的NUnit版本。在为NUnit 3配置构建步骤时， <i id="6102c2a6">需要NPath控制台运行器路径</i>字段包含NUnit控制台的路径：在TeamCity 9.1.4之前，请指定包含控制台可执行文件的<i id="4ce8e2e2">目录</i> ，在以后的TeamCity版本中，请指定<i id="f507cbcd">路径到控制台可执行文件，包括文件名</i> 。</p><p id="597eb7c5">在所有示例中，NuGet软件包管理器都提供了NUnit基础结构。使用NuGet可使用户方便地管理测试环境，更新NUnit并在本地运行测试，因为它们将由TeamCity运行。</p><p id="772f1045">NUnit构建步骤是在TeamCity中运行NUnit测试的直接且用户友好的方法。它使用<a href="http://www.mono-project.com/" rel="noopener noreferrer" data-external="true" target="_blank">Mono</a>提供了最大范围的选项，同时隐藏了在不同OS上运行测试的细节。</p></div><a name="Case4.NUnitBuildStep,options"></a><a name="Case-4.-NUnit-Build-Step,-options"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-Case4.NUnitBuildStep,options">情况4NUnit构建步骤，选项</h2><p id="6f66b67c">在为NUnit 3配置NUnit构建步骤时，它需要指定NUnit控制台运行程序（选择预安装的工具或输入自定义路径）。</p><p id="cba1ae69">其他字段提供了许多有用的选项，本节讨论其中的一些。</p><p id="7956b62d"></p><figure><img alt="构建步骤：NUnit，高级选项" title="构建步骤：NUnit，高级选项" src="/help/img/teamcity/2019.1/nunit-step-advanced.png" id="588f719b" width="1056" height="1479"></figure><p></p><p id="46690191">选项之一是定义<b id="8ac706a0">应用程序配置文件</b> 。有时，测试会从配置文件中获取数据，为方便起见，您需要在“应用程序配置文件的<i id="a09b7969">路径”</i>字段中定义运行测试时要使用的应用程序配置文件的<i id="a09b7969">路径</i> 。该路径可以是绝对路径，也可以是相对于<a href="build-checkout-directory.html">Build Checkout目录</a>的路径。不幸的是，NUnit受到限制，因为每个构建步骤仅允许一个配置文件。由于此限制，如果您需要在一个构建步骤中测试具有不同配置的多个程序集，则必须将多个应用程序配置文件聚合到一个公共配置文件中。如果不可能，请将测试启动分为几个步骤，并在每个步骤中定义一个配置文件。</p><p id="88232e2d">NUnit 3控制台具有许多由命令行参数定义的设置。“ <i id="7b60d457"><a href="nunit.html#NUnit-Test-Settings">其他命令行参数”</a></i>字段允许为NUnit控制台设置许多命令行参数，但是有一些限制：</p><ul class="list _ul"><li class="list__item" id="cbe8eba9"><p>的<code class="code">--where</code>命令行参数用作优先级测试过滤设置。与<i id="b485a267">NUnit类别包含</i>或/和/或<i id="f29e719f">NUnit类别排除</i>字段同时用于按类别过滤测试时，TeamCity将忽略这些选项：将显示警告，并且仅显示<code class="code">--where</code>参数将被使用。</p></li><li class="list__item" id="07ae3651">在“ <i id="f9c8fa96">其他命令行参数”</i>字段中使用以下<i id="f9c8fa96">参数</i>可能会导致构建失败：<ul class="list _ul"><li class="list__item" id="5e17361e"><p>由于命令行大小限制，由于NUnit构建步骤从NUnit项目文件确定了程序集列表，因此要测试的程序集列表</p></li><li class="list__item" id="5e6763f0"><p>NUnit项目文件，因为TeamCity创建了自己的临时NUnit项目文件（请参见<a href="#Debugging-NUnit-tests">下文</a> ）</p></li><li class="list__item" id="4b3bdb68"><p><code class="code">--work</code> ：NUnit构建步骤将<a href="build-checkout-directory.html">构建签出目录</a>用作基本目录</p></li><li class="list__item" id="49ac8680"><p><code class="code">--noheader</code>默认使用</p></li><li class="list__item" id="7ddd3804"><p><code class="code">--x86</code> <i id="16451690">.NET运行时|平台</i>字段设置为<code class="code">x86</code></p></li><li class="list__item" id="f133730b"><p><code class="code">--framework</code> <i id="9be83f22">.NET运行时|版本</i>设置为非<code class="code">auto</code></p></li><li class="list__item" id="b43744bb"><p><code class="code">--explore</code>如果使用以下算法</p></li></ul></li></ul><p id="26aa7e41">可以将NUnit构建步骤设置为首先运行在先前构建中失败的测试。这样做的想法是，它节省了得出结论的可能状态的时间。如果设置了<i id="ce011f75">减少测试失败反馈时间</i>标志，则只要先前的构建失败了，测试将分三步运行：</p><p id="b037ab45">1。第一步，TeamCity获取所有程序集测试列表，并考虑按类别（ <code class="code">--explore</code>使用console参数），分析上一步运行的统计信息，并创建2个测试列表：优先级列表和其余列表。优先级列表包括在先前版本中失败的测试。</p><aside class="note " rel="b037ab45" id="e9dea99b" data-title=""><p id="e5370301">请注意，启用<i id="7af7e2c7">减少测试失败反馈时间</i>选项后， <code class="code">Explicit</code>属性<b id="8f3bee68">将不起作用</b> 。</p></aside><p id="86cb37b4">2。在此步骤中，将运行优先级测试。<br>3。其余测试如下。</p><p id="d2540c14">NUnit构建步骤的另一个重要功能是，它可以以相同的方式在不同的OS上执行测试，而无需更改配置。如果没有完整的.NET的代理具有<a href="http://www.mono-project.com/" rel="noopener noreferrer" data-external="true" target="_blank">Mono</a> ，则为真。它允许构建配置独立于OS。</p></div><a name="DebuggingNUnittests"></a><a name="Debugging-NUnit-tests"></a><div class="chapter"><h2 id="GettingStartedwithNUnit-DebuggingNUnittests">调试NUnit测试</h2><p id="0fa9e0a4">TeamCity为运行测试而执行的所有操作都可以在命令行中重现用户的测试。这样可以快速有效地解决构建配置时可能出现的问题。</p><p id="578c2abd">TeamCity将与运行测试相关的所有数据记录到<a href="build-log.html">Build Log中</a> 。因此，TeamCity用于运行测试的命令可以从构建日志中复制，也可以从本地或代理上的命令行运行。</p><p id="493ec805">运行测试时，除命令外，TeamCity还创建临时文件：</p><ul class="list _ul"><li class="list__item" id="073cfb33"><p>NUnit项目文件</p></li><li class="list__item" id="66f59c4e"><p>JetBrains dotCover</p></li><li class="list__item" id="44fa2287"><p>JetBrains dotTrace或JetBrains dotMemory单元配置文件</p></li></ul><p id="c1009b24">这些包含在<a href="build-artifact.html#Hidden-Artifacts">隐藏的构建工件中</a> 。例如， <a href="#Case-4.-NUnit-Build-Step,-options">案例4</a>的命令行启动测试在构建日志中将如下所示：</p><div class="code-block" data-lang="bash">... \ nunit3 \ -console.exe ...\ 5Oqkbf9J2qJNkUK4KEtKvxs8TFFnlrno.nunit</div><p id="67980c19">在这种情况下<code class="code">5Oqkbf9J2qJNkUK4KEtKvxs8TFFnlrno.nunit</code>是NUnit项目文件，可以从<a href="build-artifact.html#Hidden-Artifacts">隐藏的构建工件中</a>下载该文件：</p><p id="0db87f48"></p><figure><img alt="NUnit隐藏的工件" title="NUnit隐藏的工件" src="/help/img/teamcity/2019.1/nunit-hidden-artifacts.png" id="5d58bdf1" width="692" height="571"></figure><p></p><hr id="f3358ed1"><p id="7ac82a53"><b id="089f0a59">也可以看看：</b></p><p id="7340ec69"><b id="a116135d">管理员指南</b> ： <a href="nunit-support.html">NUnit支持</a></p><hr id="30c68796"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>