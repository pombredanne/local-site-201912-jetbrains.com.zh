<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Shared Resources - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Shared Resources" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/shared-resources.md|Shared Resources" data-main-title="Shared Resources" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/shared-resources.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Shared Resources" id="shared-resources.md">Shared Resources</h1><p id="301f1eb7">The <i id="8ed96726">Shared Resources</i> <a href="adding-build-features.html">build feature</a> allows limiting concurrently running builds using a shared resource, such as an external (to the CI server) resource, <i id="4e332196">for example, a test database, or a server with a limited number of connections.</i></p><p id="60c72c14">Some of such resources may be accessed concurrently but allow only a limited number of connections, others require exclusive access. Adding different locks to shared resources addresses these cases: you can define a resource on the project level, configure its parameters (for example, type and quota), and then use this resource in specific build configurations by adding the Shared Resources build feature to them. The build starts once the lock on the resource is acquired; on the build completion, the lock is released. While the builds using the resource are <a href="build-state.html">running</a>, the resource is unavailable, and the other builds requiring locks will be waiting in the <a href="build-queue.html">queue</a>.</p><p id="d4f68d08">On this page:</p><p id="d2ed5d7a"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#SharedResources-AddingandEditingSharedResources">Adding and Editing Shared Resources</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-TypesofSharedResources">Types of Shared Resources</a></li></ul></li><li class="list__item"><a href="#SharedResources-UsingSharedResourcesinBuildConfigurations">Using Shared Resources in Build Configurations</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-LocksforResourceswithQuotas">Locks for Resources with Quotas</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-LockFairness">Lock Fairness</a></li></ul></li><li class="list__item"><a href="#SharedResources-LocksforResourceswithCustomValues">Locks for Resources with Custom Values</a></li><li class="list__item"><a href="#SharedResources-Locksforresourcesincompositebuilds">Locks for resources in composite builds</a></li></ul></li><li class="list__item"><a href="#SharedResources-ViewingSharedResourcesUsage">Viewing Shared Resources Usage</a></li><li class="list__item"><a href="#SharedResources-DevelopmentLinks">Development Links</a></li></ul></p><a name="AddingandEditingSharedResources"></a><a name="Adding-and-Editing-Shared-Resources"></a><div class="chapter"><h2 id="SharedResources-AddingandEditingSharedResources">Adding and Editing Shared Resources</h2><p id="719d648e">You can add, edit shared resources, and explore their details (origin of the resource, its usage, and so on) on the <b id="9e0f0bb2">Shared Resources</b> tab of the project configuration page.</p><p id="a1915f8d">The resource name can contain only alphanumeric characters and underscores ("<code class="code">_</code>") – maximum 80 characters – and should start with a Latin letter.</p><p id="36b3d686">Shared resources defined at the project level are available in all its subprojects and build configurations.</p><p id="8062cbe7">On the subproject level, it is not possible to edit a resource inherited from a project.<br>However, it is possible to redefine a resource inherited from a project by creating a resource with the same name but with different settings in a subproject. For example:</p><ol class="list _decimal"><li class="list__item" id="690b801f"><p>Create resource A with the infinitive quota in the project Parent.</p></li><li class="list__item" id="dcf7f3aa"><p>Go to its subproject Child 1, and created resource A (the same name as the resource in Parent) with the quota of 5.<br>TeamCity will treat this resource as redefined in the subproject Child 1: that is the settings of resource A defined at the project level (infinite quota) will be propagated to all its subprojects, with the exception of the subproject Child 1 where resource A will have the quota of 5.</p></li></ol><p id="a528ee18">The usage of a resource is calculated by scanning the subtree of the current project; thus, if several projects use the same resource, only the usages in the current one will be counted.</p><a name="TypesofSharedResources"></a><a name="Types-of-Shared-Resources"></a><div class="chapter"><h3 id="SharedResources-TypesofSharedResources">Types of Shared Resources</h3><p id="8896235f">When you click <b id="b21cdde5">Add new resource</b>, three types of resources are available:</p><ul class="list _ul"><li class="list__item" id="b335abdd"><p><i id="ecfcca73">Infinite resource</i> is a shared resource with an unlimited number of read locks.</p></li><li class="list__item" id="7bbc8bff"><p><i id="d92f3c79">Resource with quota</i>: quota is a maximum number of read locks that can be acquired on the resource.</p></li><li class="list__item" id="2ec0034d"><p><i id="46de4b12">Resource with custom values</i>: a custom value (for example, a URL) is passed to the build that has acquired a lock on such a resource.</p></li></ul></div></div><a name="UsingSharedResourcesinBuildConfigurations"></a><a name="Using-Shared-Resources-in-Build-Configurations"></a><div class="chapter"><h2 id="SharedResources-UsingSharedResourcesinBuildConfigurations">Using Shared Resources in Build Configurations</h2><p id="c8992dfc">To define which build configuration(s) will use the resources, add the Share Resources <a href="adding-build-features.html">build feature</a> to the build configuration settings.</p><p id="981318c0">When adding a shared resource, select a resource available to this build configuration and define a lock.</p><p id="bb7c7292">The following locks are available:</p><a name="LocksforResourceswithQuotas"></a><a name="Locks-for-Resources-with-Quotas"></a><div class="chapter"><h3 id="SharedResources-LocksforResourceswithQuotas">Locks for Resources with Quotas</h3><p id="fad7c1f4">For this resource type, two types of locks are supported:</p><ul class="list _ul"><li class="list__item" id="070b4209"><p><b id="d4f73b06">Read locks</b>: shared (multiple running builds with read locks are allowed).</p></li><li class="list__item" id="d58ba9a7"><p><b id="c85e4c9b">Write locks</b>: exclusive (only a single running build with a write lock is allowed).</p></li></ul><p id="25d9e9f3">A resource with a quota will allow concurrent access to multiple builds for reading but will restrict access to a single build for writes to the resource. Until all read locks are released, the build requiring a write lock will not start and will wait in the queue while new readers are able to acquire the lock.<br>A build with a resource quota set to zero will not run.</p><a name="LockFairness"></a><a name="Lock-Fairness"></a><div class="chapter"><h4 id="SharedResources-LockFairness">Lock Fairness</h4><p id="c2847bf9">While read locks enable multiple builds to concurrently access a shared resource with a quota &gt; 1, lock fairness ensures that the build queue is not violated. It means, that if there is a shared resource with a quota &gt; 1, and there are several queued builds with read locks and a build with a write lock in between the readers, the build with the write lock will wait until all builds with read locks <b id="005a07ca">earlier</b> in the queue finish and release the lock. Then the build requiring a write lock will be executed, and only after that the other readers can acquire the lock. Lock fairness does not allow builds with read locks interfere with build queue ordering and "slip" past the build that is waiting for a write lock to become available.</p></div></div><a name="LocksforResourceswithCustomValues"></a><a name="Locks-for-Resources-with-Custom-Values"></a><div class="chapter"><h3 id="SharedResources-LocksforResourceswithCustomValues">Locks for Resources with Custom Values</h3><p id="9246bd5a">Resources with custom values support three types of locks:</p><ul class="list _ul"><li class="list__item" id="252e266b"><p>Locks on <b id="05d656e7">any available value</b>: a build that uses the resource will start if at least one of the values is available. If all values are being used at the moment, the build will wait in the queue.</p></li><li class="list__item" id="30651e3d"><p>Locks on <b id="44f9e0fe">all</b> values: a build will lock all the values of the resource. No other builds that use this resource will start until the current one is finished.</p></li><li class="list__item" id="a75c0378"><p>Locks on a <b id="34fb12eb">specific</b> value: only a specific value of the resource will be passed to the build. If the value is already taken by a running build, the new build will wait in the <a href="build-queue.html">queue</a> until the value becomes available.</p></li></ul><p id="af86b260">When the resource is defined and the locks are added, the build gets a configuration parameter with the name of the lock and with the value of the resource string (<code class="code">teamcity.locks.readLock.&lt;lockName&gt;</code> or <code class="code">teamcity.locks.writeLock.&lt;lockName&gt;</code>), for example, the parameter name can be <code class="code">teamcity.locks.readLock.databaseUrl</code>.</p><aside class="note " data-title="" rel="af86b260" id="a83da795"><p id="a133ea0c">The locks for resources with custom values cannot be added to composite builds (see <a href="https://youtrack.jetbrains.com/issue/TW-54381" data-external="true" target="_blank" rel="noopener noreferrer">TW-54381</a> for details).</p></aside></div><a name="Locksforresourcesincompositebuilds"></a><a name="Locks-for-resources-in-composite-builds"></a><div class="chapter"><h3 id="SharedResources-Locksforresourcesincompositebuilds">Locks for resources in composite builds</h3><p id="fcec8dd6">Shared resources (except those with custom values) can now be locked for composite builds as well. A lock on the specified resource will be acquired when a composite build starts (when the first build of the composite build chain starts); the lock will be released when the composite build finishes (the last build in its chain is finished).</p><p id="331cdc8f">The locks acquired on composite builds affect only these composite builds and are not propagated to their individual parts. For example, if a resource has a quota of N, then N composite builds that have a read lock on this resource can be run concurrently. The number of concurrent individual builds inside these composite builds will not be affected by the resource quota.</p></div></div><a name="ViewingSharedResourcesUsage"></a><a name="Viewing-Shared-Resources-Usage"></a><div class="chapter"><h2 id="SharedResources-ViewingSharedResourcesUsage">Viewing Shared Resources Usage</h2><p id="5864d7a9">If at least one resource lock is defined in a build configuration, you can view the resources used by the build on the <b id="0c9cf482">Shared Resources</b> tab of the <b id="6c25b775"><a href="working-with-build-results.html">Build Results</a></b> page. The tab displays the resources and their type, including the locks used by the build for each resource.</p><p id="6e51f3e6">Clicking the resource name takes you back to the <a href="#Adding-and-Editing-Shared-Resources">shared resources configuration</a> page on the project level.</p></div><a name="DevelopmentLinks"></a><a name="Development-Links"></a><div class="chapter"><h2 id="SharedResources-DevelopmentLinks">Development Links</h2><p id="5ff592bb">See the <a href="https://plugins.jetbrains.com/plugin/9075-shared-resources" data-external="true" target="_blank" rel="noopener noreferrer">Shared Resources plugin</a> page.</p><hr id="42a12684"><p id="2b912434"><b id="5c327e3a">See also:</b></p><p id="0871f260"><b id="c19801b8">JetBrains TV</b>: <a href="http://tv.jetbrains.net/videocontent/teamcity-shared-resources" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity Shared Resources Screencast</a></p><hr id="f15a214f"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>