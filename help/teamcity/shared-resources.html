<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>共享资源-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Shared Resources" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/shared-resources.md|Shared Resources" data-main-title="Shared Resources" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/shared-resources.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="shared-resources.md" data-toc="Shared Resources">共享资源</h1><p id="301f1eb7"><i id="8ed96726">共享资源</i> <a href="adding-build-features.html">构建功能</a>允许使用共享资源（例如，外部（CI服务器）资源， <i id="4e332196">例如测试数据库或连接数量有限的</i>服务器）限制并发运行的构建<i id="4e332196">。</i></p><p id="60c72c14">某些此类资源可以同时访问，但仅允许有限数量的连接，其他资源则需要互斥访问。向共享资源添加不同的锁可以解决以下情况：您可以在项目级别定义资源，配置其参数（例如，类型和配额），然后通过向其添加共享资源构建功能在特定的构建配置中使用该资源。 。一旦获得对资源的锁定，构建便会开始；构建完成后，将释放锁定。当使用该资源的构建正在<a href="build-state.html">运行时</a> ，该资源不可用，并且其他需要锁定的构建将在<a href="build-queue.html">队列中</a>等待。</p><p id="d4f68d08">在此页：</p><p id="d2ed5d7a"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#SharedResources-AddingandEditingSharedResources">添加和编辑共享资源</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-TypesofSharedResources">共享资源的类型</a></li></ul></li><li class="list__item"><a href="#SharedResources-UsingSharedResourcesinBuildConfigurations">在构建配置中使用共享资源</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-LocksforResourceswithQuotas">带配额的资源锁</a><ul class="list _bullet"><li class="list__item"><a href="#SharedResources-LockFairness">锁公平</a></li></ul></li><li class="list__item"><a href="#SharedResources-LocksforResourceswithCustomValues">具有自定义值的资源锁</a></li><li class="list__item"><a href="#SharedResources-Locksforresourcesincompositebuilds">锁定复合构建中的资源</a></li></ul></li><li class="list__item"><a href="#SharedResources-ViewingSharedResourcesUsage">查看共享资源使用情况</a></li><li class="list__item"><a href="#SharedResources-DevelopmentLinks">开发链接</a></li></ul><p></p><a name="AddingandEditingSharedResources"></a><a name="Adding-and-Editing-Shared-Resources"></a><div class="chapter"><h2 id="SharedResources-AddingandEditingSharedResources">添加和编辑共享资源</h2><p id="719d648e">您可以在项目配置页面的“ <b id="9e0f0bb2">共享资源”</b>选项卡上添加，编辑共享资源，并浏览它们的详细信息（资源的来源，用途等）。</p><p id="a1915f8d">资源名称只能包含字母数字字符和下划线（“ <code class="code">_</code> “）-最多80个字符-且应以拉丁字母开头。</p><p id="36b3d686">在项目级别定义的共享资源可用于其所有子项目和构建配置。</p><p id="8062cbe7">在子项目级别，无法编辑从项目继承的资源。<br>但是，可以通过在子项目中创建具有相同名称但设置不同的资源来重新定义从项目继承的资源。例如：</p><ol class="list _decimal"><li class="list__item" id="690b801f"><p>在项目上级中使用无限定额创建资源A。</p></li><li class="list__item" id="dcf7f3aa"><p>转到其子项目子项1，并创建配额为5的资源A（与“父项”中的资源同名）。<br>TeamCity将在子项目Child 1中重新定义此资源，即在项目级别（无限配额）定义的资源A的设置将传播到其所有子项目，但子项目Child 1除外，其中资源A将具有配额为5。</p></li></ol><p id="a528ee18">资源的使用是通过扫描当前项目的子树来计算的；因此，如果多个项目使用相同的资源，则仅计算当前项目中的使用情况。</p><a name="TypesofSharedResources"></a><a name="Types-of-Shared-Resources"></a><div class="chapter"><h3 id="SharedResources-TypesofSharedResources">共享资源的类型</h3><p id="8896235f">单击<b id="b21cdde5">添加新资源时</b> ，三种类型的资源可用：</p><ul class="list _ul"><li class="list__item" id="b335abdd"><p><i id="ecfcca73">无限资源</i>是具有无限数量的读取锁的共享资源。</p></li><li class="list__item" id="7bbc8bff"><p><i id="d92f3c79">带配额的资源</i> ：配额是可以在资源上获取的最大读取锁数。</p></li><li class="list__item" id="2ec0034d"><p><i id="46de4b12">具有自定义值的资源</i> ：将自定义值（例如URL）传递给已获得对此类资源的锁定的构建。</p></li></ul></div></div><a name="UsingSharedResourcesinBuildConfigurations"></a><a name="Using-Shared-Resources-in-Build-Configurations"></a><div class="chapter"><h2 id="SharedResources-UsingSharedResourcesinBuildConfigurations">在构建配置中使用共享资源</h2><p id="c8992dfc">要定义将使用资源的构建配置，请将共享资源<a href="adding-build-features.html">构建功能</a>添加到构建配置设置中。</p><p id="981318c0">添加共享资源时，请选择可用于此构建配置的资源并定义一个锁。</p><p id="bb7c7292">以下锁可用：</p><a name="LocksforResourceswithQuotas"></a><a name="Locks-for-Resources-with-Quotas"></a><div class="chapter"><h3 id="SharedResources-LocksforResourceswithQuotas">带配额的资源锁</h3><p id="fad7c1f4">对于此资源类型，支持两种类型的锁：</p><ul class="list _ul"><li class="list__item" id="070b4209"><p><b id="d4f73b06">读取锁</b> ：共享（允许运行多个具有读取锁的内部版本）。</p></li><li class="list__item" id="d58ba9a7"><p><b id="c85e4c9b">写锁</b> ：排他（仅允许一个运行的具有写锁的构建）。</p></li></ul><p id="25d9e9f3">具有配额的资源将允许并发访问多个内部版本以进行读取，但将限制访问单个内部版本以写入该资源。在释放所有读取锁之前，需要写入锁的构建将不会启动，并且将在队列中等待，同时新的读取器可以获取该锁。<br>资源配额设置为零的构建将无法运行。</p><a name="LockFairness"></a><a name="Lock-Fairness"></a><div class="chapter"><h4 id="SharedResources-LockFairness">锁公平</h4><p id="c2847bf9">虽然读取锁定使多个构建可以并发访问配额> 1的共享资源，但锁定公平性可确保不违反构建队列。这意味着，如果存在一个配额大于1的共享资源，并且在多个读取器之间存在多个具有读取锁定的队列构建和一个具有写入锁定的构建，则具有写入锁定的构建将等待，直到所有具有读取锁定的构建为止在队列中<b id="005a07ca">更早的</b>时间完成锁并释放锁。然后将执行需要写锁的构建，只有在此之后，其他读者才能获取该锁。锁公平性不允许具有读取锁的生成干扰生成队列的顺序，并“滑过”等待写入锁可用的生成。</p></div></div><a name="LocksforResourceswithCustomValues"></a><a name="Locks-for-Resources-with-Custom-Values"></a><div class="chapter"><h3 id="SharedResources-LocksforResourceswithCustomValues">具有自定义值的资源锁</h3><p id="9246bd5a">具有自定义值的资源支持三种类型的锁：</p><ul class="list _ul"><li class="list__item" id="252e266b"><p>锁定<b id="05d656e7">任何可用值</b> ：如果至少有一个<b id="05d656e7">可用值</b> ，则将启动使用该资源的构建。如果目前正在使用所有值，则构建将在队列中等待。</p></li><li class="list__item" id="30651e3d"><p>锁定<b id="44f9e0fe">所有</b>值：构建将锁定资源的所有值。在当前版本完成之前，不会开始使用该资源的其他任何版本。</p></li><li class="list__item" id="a75c0378"><p>锁定<b id="34fb12eb">特定</b>值：仅资源的特定值将传递给构建。如果该值已由运行中的构建使用，则新构建将在<a href="build-queue.html">队列中</a>等待，直到该值可用为止。</p></li></ul><p id="af86b260">定义资源并添加锁后，构建将获得一个配置参数，其中包含锁的名称和资源字符串的值（ <code class="code">teamcity.locks.readLock.<lockName></code>要么<code class="code">teamcity.locks.writeLock.<lockName></code> ），例如，参数名称可以是<code class="code">teamcity.locks.readLock.databaseUrl</code> 。</p><aside class="note " rel="af86b260" id="a83da795" data-title=""><p id="a133ea0c">具有自定义值的资源锁不能添加到复合构建中（有关详细信息，请参阅<a href="https://youtrack.jetbrains.com/issue/TW-54381" rel="noopener noreferrer" data-external="true" target="_blank">TW-54381</a> ）。</p></aside></div><a name="Locksforresourcesincompositebuilds"></a><a name="Locks-for-resources-in-composite-builds"></a><div class="chapter"><h3 id="SharedResources-Locksforresourcesincompositebuilds">锁定复合构建中的资源</h3><p id="fcec8dd6">现在也可以锁定共享资源（具有自定义值的资源除外）以进行复合构建。复合构建开始时（复合构建链的第一个构建开始时），将获得对指定资源的锁定；复合构建完成时（该链中的最后一个构建完成），将释放该锁。</p><p id="331cdc8f">在复合构建上获取的锁仅影响这些复合构建，并且不会传播到它们的各个部分。例如，如果资源的配额为N，则可以同时运行对该资源具有读取锁定的N个复合构建。这些复合构建中并发的单个构建的数量将不受资源配额的影响。</p></div></div><a name="ViewingSharedResourcesUsage"></a><a name="Viewing-Shared-Resources-Usage"></a><div class="chapter"><h2 id="SharedResources-ViewingSharedResourcesUsage">查看共享资源使用情况</h2><p id="5864d7a9">如果在构建配置中定义了至少一个资源锁，则可以在“ <b id="6c25b775"><a href="working-with-build-results.html">构建结果”</a></b>页面的“ <b id="0c9cf482">共享资源”</b>选项卡上查看该构建使用的<b id="0c9cf482">资源</b> 。该选项卡显示资源及其类型，包括构建为每个资源使用的锁。</p><p id="6e51f3e6">单击资源名称可将您带回到项目级别的<a href="#Adding-and-Editing-Shared-Resources">共享资源配置</a>页面。</p></div><a name="DevelopmentLinks"></a><a name="Development-Links"></a><div class="chapter"><h2 id="SharedResources-DevelopmentLinks">开发链接</h2><p id="5ff592bb">请参阅<a href="https://plugins.jetbrains.com/plugin/9075-shared-resources" rel="noopener noreferrer" data-external="true" target="_blank">共享资源插件</a>页面。</p><hr id="42a12684"><p id="2b912434"><b id="5c327e3a">也可以看看：</b></p><p id="0871f260"><b id="c19801b8">JetBrains TV</b> ： <a href="http://tv.jetbrains.net/videocontent/teamcity-shared-resources" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity共享资源截屏</a></p><hr id="f15a214f"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>