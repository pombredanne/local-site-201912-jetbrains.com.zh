<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>配置辅助节点-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Configuring Secondary Node" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/multinode-setup.md|Multinode Setup/configuring-secondary-node.md|Configuring Secondary Node" data-main-title="Configuring Secondary Node" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/configuring-secondary-node.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="configuring-secondary-node.md" data-toc="Configuring Secondary Node">配置辅助节点</h1><p id="d4210fb0">除了主TeamCity服务器之外，您还可以启动与主服务器共享数据目录和数据库的辅助服务器（节点）。在“ <a href="multinode-setup.html">多节点设置”中</a>了解更多信息。</p><p id="456eb89b">本页介绍如何配置辅助节点。</p><p id="a9084c4d">在此页：</p><p id="5907ecbd"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ConfiguringSecondaryNode-InstallingSecondaryNode">安装辅助节点</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringSecondaryNode-SecondaryNodeMemorySettings">辅助节点内存设置</a></li></ul></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Startup&Shutdown">启动与关机</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-AssigningResponsibilities">分配职责</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringSecondaryNode-ProcessingDataProducedbyBuildsonSecondaryNode">处理由辅助节点上的构建生成的数据</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-VCSRepositoriesPollingonSecondaryNode">辅助节点上的VCS存储库轮询</a></li></ul></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Upgrade&Downgrade">升级与降级</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Authentication&License">验证和许可</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-GlobalSettings">全局设置</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-ProjectImport">项目导入</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-UsingPlugins">使用插件</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Cleanup">清理</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Backup&Restore">备份与还原</a></li></ul><p></p><a name="InstallingSecondaryNode"></a><a name="Installing-Secondary-Node"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-InstallingSecondaryNode">安装辅助节点</h2><p id="09742cac">要安装辅助节点，请按照下列步骤操作：</p><ol class="list _decimal"><li class="list__item" id="3a51903e"><p>在辅助节点计算机上，像往常一样<a href="installing-and-configuring-the-teamcity-server.html">安装</a> TeamCity软件：下载分发软件包并遵循安装向导。</p></li><li class="list__item" id="bf787b45"><p>通过以下路径提供共享数据目录的路径<code class="code">TEAMCITY_DATA_PATH</code>环境变量。</p></li><li class="list__item" id="23adde59"><p>将其他参数添加到<code class="code">TEAMCITY_SERVER_OPTS</code> <a href="configuring-teamcity-server-startup-properties.html">环境变量</a> ：</p></li></ol><div class="code-block" data-lang="none">TEAMCITY_SERVER_OPTS = -Dteamcity.server.nodeId = <nodeid>-Dteamcity.node.data.path = <path_to_node_data_directory>-Dteamcity.server.rootURL = <node url="">

</node></path_to_node_data_directory></nodeid></div><p id="3c4f69ac">哪里</p><ul class="list _ul"><li class="list__item" id="2fcea4a0"><p><code class="code"><nodeID></code>是将在“ <b id="0b9b7a41">管理” |</b> “ <b id="0b9b7a41">管理”中</b>显示的节点的ID。 <b id="0b9b7a41">节点配置</b>页面。</p></li><li class="list__item" id="0c91b170"><p><code class="code"><path_to_node_data_directory></code>是节点“数据目录”的路径（请参阅“ <a href="multinode-setup.html#Node-Specific-Data-Directory">特定于节点的数据目录”</a> ）。</p></li><li class="list__item" id="8d64716a"><p><code class="code"><node url></code>是辅助节点的根URL。确保可以从主服务器和代理访问此URL。</p></li></ul><a name="SecondaryNodeMemorySettings"></a><a name="Secondary-Node-Memory-Settings"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-SecondaryNodeMemorySettings">辅助节点内存设置</h3><p id="6f762b5f">辅助节点需要与主节点相同的内存设置。如果您已经配置了<code class="code">TEAMCITY_SERVER_MEM_OPTS</code>主节点的<a href="configuring-teamcity-server-startup-properties.html">环境变量</a> ，请确保对次节点使用相同的变量。如果您的主节点使用64位JVM，则辅助节点也必须使用64位JVM。</p></div></div><a name="Startup&Shutdown"></a><a name="Startup-&-Shutdown"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Startup&Shutdown">启动与关机</h2><p id="36922a8c">可以使用常规TeamCity脚本来启动/停止辅助节点（ <code class="code">teamcity-server.bat</code> ， <code class="code">teamcity-server.sh</code> ）或Windows服务。</p><p id="e49a8062">在启动多个辅助节点之前，请确保已将数据库配置为接受足够的并行连接以处理来自所有节点的请求。默认情况下，每个节点需要50个数据库连接。</p><p id="c46ab4d9">辅助节点服务器使用与主服务器相同的日志记录方法。您可以在窗口中检查启动状态<code class="code"><TeamCity_installation_directory>/logs/teamcity-server.log</code>文件。打开<code class="code"><secondary_node_URL></code>在浏览器中查看常规的TeamCity启动屏幕。</p><p id="8bb26b97">在运行构建时，可以停止或重新启动辅助节点以及主服务器。如果代理一段时间无法连接到辅助节点，则它们会将其数据重新路由到主服务器。如果主服务器或服务器都不可用，则代理将保留其数据并在服务器再次可用后重新发送。</p></div><a name="AssigningResponsibilities"></a><a name="Assigning-Responsibilities"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-AssigningResponsibilities">分配职责</h2><p id="8d81043a">默认情况下，新启动的辅助节点提供只读用户界面，并且不执行任何后台活动。您可以在<b id="8b650b8e">管理|管理中</b>为每个辅助节点分配以下附加职责<b id="8b650b8e">。服务器管理|节点配置</b> ：</p><ul class="list _ul"><li class="list__item" id="6d2a017e"><p>处理由构建产生的数据</p></li><li class="list__item" id="ac4fa878"><p>VCS存储库轮询</p></li></ul><p id="00517b4a"></p><figure><img alt="Nodes.png" title="Nodes.png" src="/help/img/teamcity/2019.1/Nodes.png" id="4edd2a42" width="2463" height="1322"></figure><p></p><p id="5dc6aa82">您可以随时启用和禁用节点职责。</p><a name="ProcessingDataProducedbyBuildsonSecondaryNode"></a><a name="Processing-Data-Produced-by-Builds-on-Secondary-Node"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-ProcessingDataProducedbyBuildsonSecondaryNode">处理由辅助节点上的构建生成的数据</h3><p id="84d6a8a5">可以使用一个或多个辅助节点来处理来自TeamCity代理的流量。这样可以将相关的负载移至与TeamCity主服务器不同的另一台计算机上，这在处理数百个并发的主动日志生成时将提高TeamCity的性能。</p><p id="fa2f227e">通常，除非有超过400个代理连接到单个服务器，否则不需要运行构建的单独节点。使用辅助节点可以使您显着增加设置可以处理的代理数量。</p><p id="53e78864"><i id="ad0c9858">将由构建</i>责任<i id="ad0c9858">产生</i>的<i id="ad0c9858">处理数据</i>分配给一个节点后，所有新启动的构建都将被路由到该节点。现有的正在运行的构建将继续在主服务器上执行。当您禁用职责时，只有新启动的构建将切换到主服务器。在辅助节点上已经运行的构建将继续在那里运行。</p></div><a name="VCSRepositoriesPollingonSecondaryNode"></a><a name="VCS-Repositories-Polling-on-Secondary-Node"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-VCSRepositoriesPollingonSecondaryNode">辅助节点上的VCS存储库轮询</h3><p id="4b8b9a83">通常，TeamCity主服务器会轮询VCS存储库以查找更改，以检测新提交。您可以将VCS轮询委派给辅助节点，从而提高主服务器的性能。只能将一个辅助节点分配给此职责。</p><p id="169e4995">将<i id="f215a91f">VCS存储库轮询</i>职责分配给一个节点后，主服务器可能需要一些时间才能完成正在进行的轮询活动，然后辅助节点将承担此任务。禁用此职责后，主服务器将开始轮询VCS存储库。</p><p id="eefece45">如果在主服务器上配置了提交挂钩，则无需更改挂钩：如果将VCS轮询委托给辅助节点，挂钩将继续工作。</p></div></div><a name="Upgrade&Downgrade"></a><a name="Upgrade-&-Downgrade"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Upgrade&Downgrade">升级与降级</h2><p id="6fcc471d">建议主TeamCity服务器和所有辅助节点具有相同版本。在“ <a href="multinode-setup.html#Upgrade-&-Downgrade">多节点设置”中</a>了解更多信息。</p></div><a name="Authentication&License"></a><a name="Authentication-&-License"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Authentication&License">验证和许可</h2><p id="506abeb5">主节点和辅助节点在相同的许可证下运行。</p><p id="b1cf71b5">辅助节点使用与主服务器相同的身份验证设置。</p></div><a name="GlobalSettings"></a><a name="Global-Settings"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-GlobalSettings">全局设置</h2><p id="b1f2492f">次要注释使用与主服务器相同的<a href="teamcity-configuration-and-maintenance.html">全局设置</a> （工件的路径，版本控制设置等）。</p></div><a name="ProjectImport"></a><a name="Project-Import"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-ProjectImport">项目导入</h2><p id="6ad5bb9e">您可以<a href="projects-import.html">像往常一样</a>将项目导入到主服务器。辅助节点将在运行时检测导入的数据，而无需重新启动。</p><p id="21b905e9">无法将项目导入到辅助服务器上。</p></div><a name="UsingPlugins"></a><a name="Using-Plugins"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-UsingPlugins">使用插件</h2><p id="04d5bf16">辅助节点可以访问主服务器上启用的所有插件。如果在主服务器上启用了插件，则需要重新加载辅助节点，以便它们可以使用此插件。</p><p id="501567db">当前，以下捆绑插件在辅助节点上被禁用：</p><ul class="list _ul"><li class="list__item" id="444e342e"><p>调查自动分配器</p></li><li class="list__item" id="8437fccc"><p>在远程主机上安装代理（代理推送）</p></li></ul><aside class="note " rel="ba86f69c" id="bfeb32d1" data-title=""><p id="62df88bc">辅助节点充当只读服务器，并且只能使用有限的一组外部插件。</p></aside></div><a name="Cleanup"></a><a name="Cleanup"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Cleanup">清理</h2><p id="8575a857">TeamCity <a href="clean-up.html">清理</a>任务仅在主TeamCity服务器上运行。在多节点配置以及单节点配置中，任务可以在辅助服务器处理其操作时运行。</p></div><a name="Backup&Restore"></a><a name="Backup-&-Restore"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Backup&Restore">备份与还原</h2><p id="7c326701">通过TeamCity Web界面进行的<a href="teamcity-data-backup.html">备份</a>只能在TeamCity主服务器上进行。可以从命令行在主服务器和辅助节点上进行备份。</p><p id="dc615f96">可以在任一节点上执行<a href="restoring-teamcity-data-from-backup.html">还原</a>操作，但前提是必须停止所有使用TeamCity数据库和数据目录的服务器。</p><hr id="5b4d5d4b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>