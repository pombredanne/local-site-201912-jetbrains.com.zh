<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Configuring Secondary Node - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Configuring Secondary Node" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/multinode-setup.md|Multinode Setup/configuring-secondary-node.md|Configuring Secondary Node" data-main-title="Configuring Secondary Node" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/configuring-secondary-node.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Configuring Secondary Node" id="configuring-secondary-node.md">Configuring Secondary Node</h1><p id="d4210fb0">In addition to the main TeamCity server, you can start a secondary server (node) sharing the Data Directory and database with the main one. Read more in <a href="multinode-setup.html">Multinode Setup</a>.</p><p id="456eb89b">This page describes how to configure a secondary node.</p><p id="a9084c4d">On this page:</p><p id="5907ecbd"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ConfiguringSecondaryNode-InstallingSecondaryNode">Installing Secondary Node</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringSecondaryNode-SecondaryNodeMemorySettings">Secondary Node Memory Settings</a></li></ul></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Startup&amp;Shutdown">Startup &amp; Shutdown</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-AssigningResponsibilities">Assigning Responsibilities</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringSecondaryNode-ProcessingDataProducedbyBuildsonSecondaryNode">Processing Data Produced by Builds on Secondary Node</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-VCSRepositoriesPollingonSecondaryNode">VCS Repositories Polling on Secondary Node</a></li></ul></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Upgrade&amp;Downgrade">Upgrade &amp; Downgrade</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Authentication&amp;License">Authentication &amp; License</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-GlobalSettings">Global Settings</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-ProjectImport">Project Import</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-UsingPlugins">Using Plugins</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Cleanup">Cleanup</a></li><li class="list__item"><a href="#ConfiguringSecondaryNode-Backup&amp;Restore">Backup &amp; Restore</a></li></ul></p><a name="InstallingSecondaryNode"></a><a name="Installing-Secondary-Node"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-InstallingSecondaryNode">Installing Secondary Node</h2><p id="09742cac">To install a secondary node, follow these steps:</p><ol class="list _decimal"><li class="list__item" id="3a51903e"><p>On the secondary node machine, <a href="installing-and-configuring-the-teamcity-server.html">install</a> the TeamCity software as usual: download the distribution package and follow the installation wizard.</p></li><li class="list__item" id="bf787b45"><p>Provide path to the shared Data Directory via the <code class="code">TEAMCITY_DATA_PATH</code> environment variable.</p></li><li class="list__item" id="23adde59"><p>Add additional arguments to the <code class="code">TEAMCITY_SERVER_OPTS</code> <a href="configuring-teamcity-server-startup-properties.html">environment variable</a>:</p></li></ol><div class="code-block" data-lang="none">TEAMCITY_SERVER_OPTS = -Dteamcity.server.nodeId=&lt;nodeID&gt; -Dteamcity.node.data.path=&lt;path_to_node_data_directory&gt;  -Dteamcity.server.rootURL=&lt;node url&gt;

</div><p id="3c4f69ac">where</p><ul class="list _ul"><li class="list__item" id="2fcea4a0"><p><code class="code">&lt;nodeID&gt;</code> is the ID of the node that will be displayed on the <b id="0b9b7a41">Administration | Nodes Configuration</b> page.</p></li><li class="list__item" id="0c91b170"><p><code class="code">&lt;path_to_node_data_directory&gt;</code> is the path to the node Data Directory (see <a href="multinode-setup.html#Node-Specific-Data-Directory">Node-Specific Data Directory</a>).</p></li><li class="list__item" id="8d64716a"><p><code class="code">&lt;node url&gt;</code> is the secondary node root URL. Make sure this URL is accessible from the main server and agents.</p></li></ul><a name="SecondaryNodeMemorySettings"></a><a name="Secondary-Node-Memory-Settings"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-SecondaryNodeMemorySettings">Secondary Node Memory Settings</h3><p id="6f762b5f">The secondary node requires the same memory settings as the main node. If you have already configured the <code class="code">TEAMCITY_SERVER_MEM_OPTS</code> <a href="configuring-teamcity-server-startup-properties.html">environment variable</a> for the main node, make sure to use the same variable for the secondary node. If your main node uses a 64-bit JVM, the secondary node must use a 64-bit JVM as well.</p></div></div><a name="Startup&amp;Shutdown"></a><a name="Startup-&amp;-Shutdown"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Startup&amp;Shutdown">Startup & Shutdown</h2><p id="36922a8c">A secondary node can be started/stopped using regular TeamCity scripts (<code class="code">teamcity-server.bat</code>, <code class="code">teamcity-server.sh</code>) or Windows services.</p><p id="e49a8062">Before starting more than one secondary node, make sure that the database is configured to accept enough parallel connections to handle requests from all nodes. By default, each node requires 50 connections to the database.</p><p id="c46ab4d9">The secondary node server uses the same approach to logging as the main server. You can check the state of the startup in the <code class="code">&lt;TeamCity_installation_directory&gt;/logs/teamcity-server.log</code> file. Open <code class="code">&lt;secondary_node_URL&gt;</code> in your browser to see the regular TeamCity startup screens.</p><p id="8bb26b97">A secondary node, as well as the main server, can be stopped or restarted while builds are running. If agents cannot connect to a secondary node for some time, they will reroute their data to the main server. If the main server is unavailable either, agents will keep their data and resend it once the servers are available again.</p></div><a name="AssigningResponsibilities"></a><a name="Assigning-Responsibilities"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-AssigningResponsibilities">Assigning Responsibilities</h2><p id="8d81043a">By default, a newly started secondary node provides a read-only user interface and does not perform any background activity. You can assign the following additional responsibilities to each secondary node in <b id="8b650b8e">Administration | Server Administration | Nodes Configuration</b>:</p><ul class="list _ul"><li class="list__item" id="6d2a017e"><p>Processing data produced by builds</p></li><li class="list__item" id="ac4fa878"><p>VCS repositories polling</p></li></ul><p id="00517b4a"><figure><img alt="Nodes.png" title="Nodes.png" src="/help/img/teamcity/2019.1/Nodes.png" id="4edd2a42" width="2463" height="1322"></figure></p><p id="5dc6aa82">You can enable and disable responsibilities for nodes at any moment.</p><a name="ProcessingDataProducedbyBuildsonSecondaryNode"></a><a name="Processing-Data-Produced-by-Builds-on-Secondary-Node"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-ProcessingDataProducedbyBuildsonSecondaryNode">Processing Data Produced by Builds on Secondary Node</h3><p id="84d6a8a5">It is possible to use one or more secondary nodes to process traffic from the TeamCity agents. This allows moving the related load to a separate machine from the main TeamCity server which will improve the TeamCity performance when handling hundreds of concurrent and actively logging builds.</p><p id="fa2f227e">In general, you do not need a separate node for running builds unless you have more than 400 agents connected to a single server. Using a secondary node allows you to significantly increase the number of agents which the setup can handle.</p><p id="53e78864">Once you assign the <i id="ad0c9858">Processing data produced by builds</i> responsibility to a node, all newly started builds will be routed to this node. The existing running builds will continue being executed on the main server. When you disable the responsibility, only the newly started builds will be switched to the main server. The builds that were already running on the secondary node will continue running there.</p></div><a name="VCSRepositoriesPollingonSecondaryNode"></a><a name="VCS-Repositories-Polling-on-Secondary-Node"></a><div class="chapter"><h3 id="ConfiguringSecondaryNode-VCSRepositoriesPollingonSecondaryNode">VCS Repositories Polling on Secondary Node</h3><p id="4b8b9a83">Usually, the main TeamCity server polls the VCS repositories for changes to detect new commits. You can delegate VCS polling to the secondary node thus improving the performance of the main server. Only one secondary node can be assigned to this responsibility.</p><p id="169e4995">Once you assign the <i id="f215a91f">VCS repositories polling</i> responsibility to a node, it may take some time for the main server to finish the polling activities in progress, and then the secondary node will pick up this task. When you disable the responsibility, the main server will start polling VCS repositories.</p><p id="eefece45">If you have commit hooks configured on the main server, no changes in hooks are required: the hooks will continue working if the VCS polling is delegated to the secondary node.</p></div></div><a name="Upgrade&amp;Downgrade"></a><a name="Upgrade-&amp;-Downgrade"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Upgrade&amp;Downgrade">Upgrade & Downgrade</h2><p id="6fcc471d">It is recommended that the main TeamCity server and all secondary nodes have the same version. Read more in <a href="multinode-setup.html#Upgrade-&amp;-Downgrade">Multinode Setup</a>.</p></div><a name="Authentication&amp;License"></a><a name="Authentication-&amp;-License"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Authentication&amp;License">Authentication & License</h2><p id="506abeb5">The main and secondary nodes operate under the same license.</p><p id="b1cf71b5">Secondary nodes use the same authentication settings as the main server.</p></div><a name="GlobalSettings"></a><a name="Global-Settings"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-GlobalSettings">Global Settings</h2><p id="b1f2492f">Secondary notes use the same <a href="teamcity-configuration-and-maintenance.html">global settings</a> (path to artifacts, version control settings, and so on) as the main server.</p></div><a name="ProjectImport"></a><a name="Project-Import"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-ProjectImport">Project Import</h2><p id="6ad5bb9e">You can import projects to the main server, <a href="projects-import.html">as usual</a>. Secondary nodes will detect the imported data in the runtime, without restarting.</p><p id="21b905e9">Projects cannot be imported on secondary servers.</p></div><a name="UsingPlugins"></a><a name="Using-Plugins"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-UsingPlugins">Using Plugins</h2><p id="04d5bf16">Secondary nodes have access to all plugins enabled on the main server. If you enable a plugin on the main server, you need to reload secondary nodes so they can use this plugin.</p><p id="501567db">Currently, the following bundled plugins are disabled on secondary nodes:</p><ul class="list _ul"><li class="list__item" id="444e342e"><p>Investigations Auto Assigner</p></li><li class="list__item" id="8437fccc"><p>Install Agent on remote host (agent push)</p></li></ul><aside class="note " data-title="" rel="ba86f69c" id="bfeb32d1"><p id="62df88bc">Secondary nodes operate as read-only servers and can use only a limited set of external plugins.</p></aside></div><a name="Cleanup"></a><a name="Cleanup"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Cleanup">Cleanup</h2><p id="8575a857">The TeamCity <a href="clean-up.html">cleanup</a> task runs on the main TeamCity server only. In a multinode configuration, as well as in a single node configuration, the task can run while the secondary servers are handling their operations.</p></div><a name="Backup&amp;Restore"></a><a name="Backup-&amp;-Restore"></a><div class="chapter"><h2 id="ConfiguringSecondaryNode-Backup&amp;Restore">Backup & Restore</h2><p id="7c326701">The <a href="teamcity-data-backup.html">backup</a> through the TeamCity web interface can be done on the main TeamCity server only. The backup from the command line can be done on both the main server and the secondary nodes.</p><p id="dc615f96">The <a href="restoring-teamcity-data-from-backup.html">restore</a> operation can be done on either of the nodes, but only if all servers using the TeamCity database and Data Directory are stopped.</p><hr id="5b4d5d4b"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>