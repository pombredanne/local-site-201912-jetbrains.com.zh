<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>EMMA-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="EMMA" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-unit-testing-and-code-coverage.md|Configuring Unit Testing and Code Coverage/configuring-java-code-coverage.md|Configuring Java Code Coverage/emma.md|EMMA" data-main-title="EMMA" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/emma.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="emma.md" data-toc="EMMA">埃玛</h1><p id="d0d24ce0">在此页：</p><p id="1ab104e2"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#EMMA-EMMAIntegrationNotes">EMMA集成说明</a></li><li class="list__item"><a href="#EMMA-ConfiguringCoveragewithEMMA">使用EMMA配置覆盖率</a></li><li class="list__item"><a href="#EMMA-Troubleshooting">故障排除</a></li></ul><p></p><a name="EMMAIntegrationNotes"></a><a name="EMMA-Integration-Notes"></a><div class="chapter"><h2 id="EMMA-EMMAIntegrationNotes">EMMA集成说明</h2><p id="556ddb83">收集EMMA的承保范围时，请执行以下步骤：</p><p id="747d3f21">1。在每个编译步骤（使用javac / javac2）之后，构建代理都会调用EMMA来检测已编译的类并存储源文件的位置。结果， <code class="code">coverage.em</code>在构建结帐目录中创建包含类元数据的文件。收集的Java文件的源路径用于生成最终的HTML报告。</p><aside class="note " rel="747d3f21" id="9db5ba29" data-title=""><p id="e2c9ced4">所有<code class="code">coverage.*</code>文件在构建开始时就被删除了，因此您必须确保在构建中执行了对源代码的完全重新编译，以获取实际的<code class="code">coverage.em</code>文件。</p></aside><p id="4515f01e">2。测试运行。在此阶段，将收集实际的运行时覆盖范围信息。此过程导致创建<code class="code">coverage.ec</code>文件。如果有多个测试任务，则将数据附加到<code class="code">coverage.ec</code> 。</p><p id="93b759dc">3。报告生成。构建结束后，TeamCity会生成HTML覆盖率报告，并创建<code class="code">coverage.zip</code>文件与报告一起上传到服务器。它还会生成摘要报告并将其上传到<code class="code">coverage.txt</code>文件和原始文件<code class="code">coverage.e(c|m)</code>文件以允许从IntelliJ IDEA的TeamCity插件查看覆盖范围。</p></div><a name="ConfiguringCoveragewithEMMA"></a><a name="Configuring-Coverage-with-EMMA"></a><div class="chapter"><h2 id="EMMA-ConfiguringCoveragewithEMMA">使用EMMA配置覆盖率</h2><p id="cb90ecd3">要通过EMMA引擎配置代码覆盖率，请按照下列步骤操作：</p><ol class="list _decimal"><li class="list__item" id="95042055"><p>在创建/编辑构建配置时，转到“ <b id="ca46e5c4">构建步骤”</b>页面。</p></li><li class="list__item" id="f0f648e0"><p>选择<a href="ant.html">Ant</a>构建运行器。</p></li><li class="list__item" id="58b1db56"><p>在“ <b id="dbd49df9">代码覆盖率”</b>部分中，从下拉列表中选择<b id="7e3c2935">EMMA</b>作为覆盖率工具。</p></li><li class="list__item" id="d43bb28d"><p>设置覆盖范围选项-请参阅以下可用选项的说明。</p></li></ol><div class="table-wrapper"><table width="100%" id="5c257e72"><thead><tr id="f7e60959" class="ijRowHead"><th id="36711cd4"><p id="8df668fd">选项</p></th><th id="2c428049"><p id="ba7d4f5f">描述</p></th></tr></thead><tbody><tr id="d591281f" class="ijRowOdd"><td id="9f1d1278"><p id="56aeb1e3">在覆盖率数据中包括源文件</p></td><td id="a30193d9"><p id="a26fa12b">选中此选项可将源文件包括在代码覆盖率报告中（您将能够在Web上查看源代码）。</p><aside class="warning " rel="a26fa12b" id="af619050" data-title=""><p id="5d9b0fe4">启用此选项会增加报告的大小，并可能减慢构建的创建速度。为了避免这种情况，请指定一些<a href="http://emma.sourceforge.net/reference_single/reference.html#prop-ref.tables" rel="noopener noreferrer" data-external="true" target="_blank">EMMA属性</a> 。</p></aside></td></tr><tr id="19323251" class="ijRowEven"><td id="0da0364e"><p id="de2d37d5">覆盖率仪器参数</p></td><td id="c1156260"><p id="0e3de8e6">使用此字段可以指定用于创建代码覆盖率报告的过滤器。这些过滤器定义了免除检测的类。有关过滤器的详细说明，请参阅<a href="http://emma.sourceforge.net/reference_single/reference.html#prop-ref.tables" rel="noopener noreferrer" data-external="true" target="_blank">EMMA文档</a> 。</p></td></tr></tbody></table></div></div><a name="Troubleshooting"></a><a name="Troubleshooting"></a><div class="chapter"><h2 id="EMMA-Troubleshooting">故障排除</h2><a name="Nocoverage,thereisamessage:EMMA:nooutputcreated:metadataisempty"></a><a name="No-coverage,-there-is-a-message:-EMMA:-no-output-created:-metadata-is-empty"></a><h4 id="EMMA-Nocoverage,thereisamessage:EMMA:nooutputcreated:metadataisempty">没有覆盖，有一条消息：EMMA：没有创建输出：元数据为空</h4><p id="164a442e">请确保在构建过程中重新编译所有类（要评估其覆盖范围）。通常，这需要在构建开始时添加“干净”任务。</p><a name="java.lang.NoClassDefFoundError:com/vladium/emma/rt/RT"></a><a name="java.lang.NoClassDefFoundError:-com/vladium/emma/rt/RT"></a><h4 id="EMMA-java.lang.NoClassDefFoundError:com/vladium/emma/rt/RT">java.lang。NoClassDefFoundError：com / vladium / emma / rt / RT</h4><p id="efc2c15f">当您的内部版本在运行时加载由EMMA插入的类文件并且在类路径中找不到emma.jar文件时，将出现此消息。对于测试任务，例如<code class="code">junit</code>要么<code class="code">testng</code> ，TeamCity添加<code class="code">emma.jar</code>自动分类。但是对于其他任务，情况并非如此，您可能需要修改构建脚本或从检测中排除某些类。</p><p id="3f85f2db">如果您的版本运行使用自己的已编译类的Java任务，则必须添加<code class="code">emma.jar</code>到Java任务的类路径，或确保未检测Java任务中使用的类。此外，您应该使用<code class="code">fork=true</code>属性。</p><p id="9154f3d7">相应的<code class="code">emma.jar</code>文件可以取自<code class="code">buildAgent/plugins/coveragePlugin/lib/emma.jar</code> 。对于典型的构建，相应的包含路径为<code class="code">../../plugins/coveragePlugin/lib/emma.jar</code> 。</p><p id="550e645e">要从编译中排除类，请使用EMMA工具任务的设置。TeamCity UI具有将这些参数传递给EMMA的字段，标记为“覆盖检测参数”。要从检测中排除某些软件包，请使用以下语法： <code class="code">-ix -com.foo.task.*,+com.foo.*,-*Test*</code> ，那里的包<code class="code">com.foo.task.*</code>包含用于自定义任务的文件。</p><a name="EMMAcoverageresultsareunstable"></a><a name="EMMA-coverage-results-are-unstable"></a><h4 id="EMMA-EMMAcoverageresultsareunstable">EMMA覆盖结果不稳定</h4><p id="2da43d7a">请确保您的junit任务具有<code class="code">fork=true</code>属性。推荐的属性组合为“ <code class="code">fork=true forkmode=once</code> ”。</p><hr id="fb16888c"><p id="d09ce999"><b id="4ffcbe0f">也可以看看：</b></p><p id="19967968"><b id="d79b46e1">概念</b> ： <a href="build-runner.html">Build Runner</a> | <a href="code-coverage.html">代码覆盖率</a><br><b id="a5861fa6">管理员指南</b> ： <a href="configuring-java-code-coverage.html">配置Java代码覆盖率</a> | <a href="intellij-idea.html">IntelliJ IDEA</a></p><hr id="75cc034a"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>