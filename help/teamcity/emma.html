<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>EMMA - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="EMMA" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-unit-testing-and-code-coverage.md|Configuring Unit Testing and Code Coverage/configuring-java-code-coverage.md|Configuring Java Code Coverage/emma.md|EMMA" data-main-title="EMMA" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/emma.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="EMMA" id="emma.md">EMMA</h1><p id="d0d24ce0">On this page:</p><p id="1ab104e2"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#EMMA-EMMAIntegrationNotes">EMMA Integration Notes</a></li><li class="list__item"><a href="#EMMA-ConfiguringCoveragewithEMMA">Configuring Coverage with EMMA</a></li><li class="list__item"><a href="#EMMA-Troubleshooting">Troubleshooting</a></li></ul></p><a name="EMMAIntegrationNotes"></a><a name="EMMA-Integration-Notes"></a><div class="chapter"><h2 id="EMMA-EMMAIntegrationNotes">EMMA Integration Notes</h2><p id="556ddb83">The following steps are performed when collecting coverage with EMMA:</p><p id="747d3f21">1. After each compilation step (with javac/javac2), the build agent invokes EMMA to instrument the compiled classes and to store the location of the source files. As a result, the <code class="code">coverage.em</code> file containing the classes metadata is created in the build checkout directory. The collected source paths of the Java files are used to generate the final HTML report.</p><aside class="note " data-title="" rel="747d3f21" id="9db5ba29"><p id="e2c9ced4">All <code class="code">coverage.*</code> files are removed in the beginning of the build, so you have to ensure that full recompilation of sources is performed in the build to have the actual <code class="code">coverage.em</code> file.</p></aside><p id="4515f01e">2. Test run. At this stage, the actual runtime coverage information is collected. This process results in creation of the <code class="code">coverage.ec</code> file. If there are several test tasks, data is appended to <code class="code">coverage.ec</code>.</p><p id="93b759dc">3. Report generation. When the build ends, TeamCity generates an HTML coverage report, creates the <code class="code">coverage.zip</code> file with the report and uploads it to the server. It also generates and uploads the summary report in the <code class="code">coverage.txt</code> file, and the original <code class="code">coverage.e(c|m)</code> files to allow viewing coverage from the TeamCity plugin for IntelliJ IDEA.</p></div><a name="ConfiguringCoveragewithEMMA"></a><a name="Configuring-Coverage-with-EMMA"></a><div class="chapter"><h2 id="EMMA-ConfiguringCoveragewithEMMA">Configuring Coverage with EMMA</h2><p id="cb90ecd3">To configure code coverage by means of EMMA engine, follow these steps:</p><ol class="list _decimal"><li class="list__item" id="95042055"><p>While creating/editing Build Configuration, go to the <b id="ca46e5c4">Build Step</b> page.</p></li><li class="list__item" id="f0f648e0"><p>Select the <a href="ant.html">Ant</a> build runner.</p></li><li class="list__item" id="58b1db56"><p>In the <b id="dbd49df9">Code Coverage</b> section, choose <b id="7e3c2935">EMMA</b> as a coverage tool in the drop-down.</p></li><li class="list__item" id="d43bb28d"><p>Set up the coverage options - refer to the description of the available options below.</p></li></ol><div class="table-wrapper"><table width="100%" id="5c257e72"><thead><tr id="f7e60959" class="ijRowHead"><th id="36711cd4"><p id="8df668fd">Option</p></th><th id="2c428049"><p id="ba7d4f5f">Description</p></th></tr></thead><tbody><tr id="d591281f" class="ijRowOdd"><td id="9f1d1278"><p id="56aeb1e3">Include Source Files in the Coverage Data</p></td><td id="a30193d9"><p id="a26fa12b">Check this option to include source files into the code coverage report (you'll be able to see sources on the Web).</p><aside class="warning " data-title="" rel="a26fa12b" id="af619050"><p id="5d9b0fe4">Enabling this option can increase the report size and may slow down the creation of your builds. To avoid this situation, specify some <a href="http://emma.sourceforge.net/reference_single/reference.html#prop-ref.tables" data-external="true" target="_blank" rel="noopener noreferrer">EMMA properties</a>.</p></aside></td></tr><tr id="19323251" class="ijRowEven"><td id="0da0364e"><p id="de2d37d5">Coverage Instrumentation Parameters</p></td><td id="c1156260"><p id="0e3de8e6">Use this field to specify the filters to be used for creating the code coverage report. These filters define classes to be exempted from instrumentation. For detailed description of filters, refer to <a href="http://emma.sourceforge.net/reference_single/reference.html#prop-ref.tables" data-external="true" target="_blank" rel="noopener noreferrer">EMMA documentation</a>.</p></td></tr></tbody></table></div></div><a name="Troubleshooting"></a><a name="Troubleshooting"></a><div class="chapter"><h2 id="EMMA-Troubleshooting">Troubleshooting</h2><a name="Nocoverage,thereisamessage:EMMA:nooutputcreated:metadataisempty"></a><a name="No-coverage,-there-is-a-message:-EMMA:-no-output-created:-metadata-is-empty"></a><h4 id="EMMA-Nocoverage,thereisamessage:EMMA:nooutputcreated:metadataisempty">No coverage, there is a message: EMMA: no output created: metadata is empty</h4><p id="164a442e">Please make sure that all your classes (whose coverage is to be evaluated) are recompiled during the build. Usually this requires adding a "clean" task at the beginning of the build.</p><a name="java.lang.NoClassDefFoundError:com/vladium/emma/rt/RT"></a><a name="java.lang.NoClassDefFoundError:-com/vladium/emma/rt/RT"></a><h4 id="EMMA-java.lang.NoClassDefFoundError:com/vladium/emma/rt/RT">java.lang.NoClassDefFoundError: com/vladium/emma/rt/RT</h4><p id="efc2c15f">This message appears when your build loads EMMA-instrumented class files in runtime, and it cannot find emma.jar file in classpath. For test tasks, like <code class="code">junit</code> or <code class="code">testng</code>, TeamCity adds <code class="code">emma.jar</code> to classpath automatically. But for other tasks, this is not the case and you might need to modify your build script or to exclude some classes from instrumentation.</p><p id="3f85f2db">If your build runs a java task which uses your own compiled classes, you'll have to either add <code class="code">emma.jar</code> to the classpath of the java task,  or to ensure that classes used in your java task are not instrumented. Besides, you should run your java task with the <code class="code">fork=true</code> attribute.</p><p id="9154f3d7">The corresponding <code class="code">emma.jar</code> file can be taken from <code class="code">buildAgent/plugins/coveragePlugin/lib/emma.jar</code>. For a typical build, the corresponding include path would be <code class="code">../../plugins/coveragePlugin/lib/emma.jar</code>.</p><p id="550e645e">To exclude classes from compilation, use settings for EMMA instrumentation task. TeamCity UI has a field to pass these parameters to EMMA, labeled "Coverage instrumentation parameters". To exclude some package from instrumenting, use the following syntax: <code class="code">-ix -com.foo.task.*,+com.foo.*,-*Test*</code>, where the package <code class="code">com.foo.task.*</code> contains files for your custom task.</p><a name="EMMAcoverageresultsareunstable"></a><a name="EMMA-coverage-results-are-unstable"></a><h4 id="EMMA-EMMAcoverageresultsareunstable">EMMA coverage results are unstable</h4><p id="2da43d7a">Please make sure that your junit task has the <code class="code">fork=true</code> attribute. The recommended combination of attributes is "<code class="code">fork=true forkmode=once</code>".</p><hr id="fb16888c"><p id="d09ce999"><b id="4ffcbe0f">See also:</b></p><p id="19967968"><b id="d79b46e1">Concepts</b>: <a href="build-runner.html">Build Runner</a> | <a href="code-coverage.html">Code Coverage</a><br><b id="a5861fa6">Administrator's Guide</b>: <a href="configuring-java-code-coverage.html">Configuring Java Code Coverage</a> | <a href="intellij-idea.html">IntelliJ IDEA</a></p><hr id="75cc034a"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>