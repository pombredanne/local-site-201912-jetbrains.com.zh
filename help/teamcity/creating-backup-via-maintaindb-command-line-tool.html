<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Creating Backup via maintainDB command-line tool - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Creating Backup via maintainDB command-line tool" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/teamcity-data-backup.md|TeamCity Data Backup/creating-backup-via-maintaindb-command-line-tool.md|Creating Backup via maintainDB command-line tool" data-main-title="Creating Backup via maintainDB command-line tool" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/creating-backup-via-maintaindb-command-line-tool.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Creating Backup via maintainDB command-line tool" id="creating-backup-via-maintaindb-command-line-tool.md">Creating Backup via maintainDB command-line tool</h1><p id="ffa663cd">TeamCity <a href="installing-and-configuring-the-teamcity-server.html">.tar.gz and .exe distributions</a> provide the <code class="code">maintainDB.bat|sh</code> utility located in the <code class="code">&lt;</code><a href="teamcity-home-directory.html"><code class="code">TeamCity Home</code></a><code class="code">&gt;/bin</code> directory.  This command-line tool enables you to back up the server data, <a href="restoring-teamcity-data-from-backup.html">restore it</a>, and <a href="migrating-to-an-external-database.html">migrate between different databases</a>. You can also create data backup using <a href="creating-backup-from-teamcity-web-ui.html">web UI</a>.</p><p id="cd37d47d"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-BeforeYouBackup">Before You Backup</a></li><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-BackupFileLocationandFormat">Backup File Location and Format</a></li><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-PerformingTeamCityDataBackupwithmaintainDBUtility">Performing TeamCity Data Backup with maintainDB Utility</a><ul class="list _bullet"><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-Configuringbackupscope">Configuring backup scope</a></li><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-maintainDBUsageExamplesforDataBackup">maintainDB Usage Examples for Data Backup</a></li></ul></li><li class="list__item"><a href="#CreatingBackupviamaintainDBcommand-linetool-maintainDBStartupOptions">maintainDB Startup Options</a></li></ul></p><a name="BeforeYouBackup"></a><a name="Before-You-Backup"></a><div class="chapter"><h2 id="CreatingBackupviamaintainDBcommand-linetool-BeforeYouBackup">Before You Backup</h2><p id="363e2f2c">Before backing up data, it is recommended to shut down the TeamCity server to include all builds into the backup. If the backup process is started when the TeamCity server is up, running and queued builds are not included into the backup.</p></div><a name="BackupFileLocationandFormat"></a><a name="Backup-File-Location-and-Format"></a><div class="chapter"><h2 id="CreatingBackupviamaintainDBcommand-linetool-BackupFileLocationandFormat">Backup File Location and Format</h2><p id="4763d02a">The default directory for backup files is the <code class="code">&lt;TeamCity Data Directory&gt;\backup</code>.</p><aside class="note " data-title="" rel="4763d02a" id="069fe574"><p id="6f78f55d">If not specified otherwise with the <code class="code">-A</code> option, TeamCity will read the TeamCity Data Directory path from the <code class="code">TEAMCITY_DATA_PATH</code> environment variable, or the default path (<code class="code">$HOME\.Buildserver</code>) will be used.</p></aside><p id="e330c0d4">The default format of the backup file name is <code class="code">TeamCity_Backup_&lt;timestamp&gt;.zip</code>; the <code class="code">&lt;timestamp&gt;</code> suffix is added in the <code class="code">YYYYMMDD_HHMMSS</code> format.</p></div><a name="PerformingTeamCityDataBackupwithmaintainDBUtility"></a><a name="Performing-TeamCity-Data-Backup-with-maintainDB-Utility"></a><div class="chapter"><h2 id="CreatingBackupviamaintainDBcommand-linetool-PerformingTeamCityDataBackupwithmaintainDBUtility">Performing TeamCity Data Backup with maintainDB Utility</h2><p id="2102aebc">This section describes some of the <code class="code">maintainDB</code> options. For a complete list of all available options, run <code class="code">maintainDB</code> from the command line with no parameters.</p><p id="40732eeb"><b id="0d45efe9">To create data backup file</b>, from the command line start <code class="code">maintainDB</code> utility with the <code class="code">backup</code> command:</p><div class="code-block" data-lang="none">maintainDB.[cmd|sh] backup

</div><p id="051d00e7">TeamCity data backup has <a href="teamcity-data-backup.html#Backing-up-Data">some limitations</a>. By default, if you run <code class="code">maintainDB</code> utility with no optional parameters,  only the database, server settings, projects and builds configurations, plugins and supplementary data (settings history, triggers states, plugins data, and so on) will be backed up, omitting build logs and personal changes.</p><a name="Configuringbackupscope"></a><a name="Configuring-backup-scope"></a><div class="chapter"><h3 id="CreatingBackupviamaintainDBcommand-linetool-Configuringbackupscope">Configuring backup scope</h3><p id="a1e97f27">To configure the scope of data to include in the backup file, use the following options:</p><ul class="list _ul"><li class="list__item" id="42e547ba"><p>-C or --include-config — includes build configurations settings</p></li><li class="list__item" id="5a84b842"><p>-D or --include-database — includes database</p></li><li class="list__item" id="07a834e0"><p>-L or --include-build-logs — includes build logs</p></li><li class="list__item" id="d2b515d6"><p>-P or --include-personal-changes — includes personal changes</p></li><li class="list__item" id="54c81eb7"><p>-U or --include-supplementary-data — includes supplementary (plugins') dataSpecifying different combinations of the above options, you can control the content of the backup file. For example, to create backup with all supported types of data, run</p></li></ul><div class="code-block" data-lang="none">maintainDB backup -C -D -L -P -U

</div></div><a name="maintainDBUsageExamplesforDataBackup"></a><a name="maintainDB-Usage-Examples-for-Data-Backup"></a><div class="chapter"><h3 id="CreatingBackupviamaintainDBcommand-linetool-maintainDBUsageExamplesforDataBackup">maintainDB Usage Examples for Data Backup</h3><p id="6a0e16ba"><b id="5f208bec">To create backup file with custom name</b>, run maintainDB with <code class="code">-F</code> or <code class="code">--backup-file</code> option and specify desired backup file name without extension:</p><div class="code-block" data-lang="none">maintainDB.cmd backup -F &lt;backup file custom name&gt;
or
maintainDB.cmd backup --backup-file &lt;backup file custom name&gt;

</div><p id="c77362c6">Executing the command above will create a new zip-file with the specified name in the default backup directory.</p><p id="a24da663"><b id="9325237b">To add the timestamp suffix to a custom filename</b>, add <code class="code">-M</code> or <code class="code">--timestamp</code> option:</p><div class="code-block" data-lang="none">maintainDB.cmd backup -F &lt;backup file custom name&gt; -M
or
maintainDB.cmd backup -F &lt;backup file custom name&gt; --timestamp

</div><p id="73db37de"><b id="a1c7237e">To create the backup file in a custom directory</b>, run maintainDB with the <code class="code">-F</code> option:</p><div class="code-block" data-lang="none">maintainDB backup -F &lt;absolute path to the custom backup directory&gt;
or
maintainDB backup --data-dir &lt;absolute path to the custom backup directory&gt;

</div></div></div><a name="maintainDBStartupOptions"></a><a name="maintainDB-Startup-Options"></a><div class="chapter"><h2 id="CreatingBackupviamaintainDBcommand-linetool-maintainDBStartupOptions">maintainDB Startup Options</h2><p id="9e1d504e">If you customize TeamCity server startup options via <code class="code">TEAMCITY_SERVER_OPTS/TEAMCITY_SERVER_MEM_OPTS</code> environment variables or use custom JDK installation to run the server, you might need to run <code class="code">maintainDB</code> script with related options added into <code class="code">TEAMCITY_MAINTAINDB_OPTS/TEAMCITY_MAINTAINDB_MEM_OPTS</code> environment variables and run the script with all the same environment as the TeamCity server, so that the same JVM is used.</p><hr id="bda327d6"><p id="26336998"><b id="d10c047c">See also:</b></p><p id="b1086387"><b id="327c9eef">Installation and Upgrade</b>: <a href="setting-up-an-external-database.html">Setting up an External Database</a> | <a href="migrating-to-an-external-database.html">Migrating to an External Database</a></p><hr id="65b12e8c"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>