<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>配置身份验证设置-帮助|团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Configuring Authentication Settings" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/configuring-authentication-settings.md|Configuring Authentication Settings/ldap-integration.md|LDAP Integration/typical-ldap-configurations.md|Typical LDAP Configurations/ldap-troubleshooting.md|LDAP Troubleshooting/ntlm-http-authentication.md|NTLM HTTP Authentication/enabling-guest-login.md|Enabling Guest Login/enabling-email-verification.md|Enabling Email Verification/security-actions.md|Security Actions" data-main-title="Configuring Authentication Settings" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/configuring-authentication-settings.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="configuring-authentication-settings.md" data-toc="Configuring Authentication Settings">配置身份验证设置</h1><p id="10117f4f">TeamCity可以通过内部数据库对用户进行身份验证，也可以集成到您的系统中并使用外部身份验证源，例如Windows Domain或LDAP。</p><p id="d26438c7"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-ConfiguringAuthentication">配置身份验证</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-SimpleMode">简单模式</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-AdvancedMode">高级模式</a></li></ul></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-UserAuthenticationSettings">用户验证设置</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-SpecialUserAccounts">特殊用户帐户</a></li></ul></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-CredentialsAuthenticationModules">凭证认证模块</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-Built-inAuthentication">内置认证</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-Token-BasedAuthentication">基于令牌的身份验证</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-WindowsDomainAuthentication">Windows域身份验证</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-SpecifyingDefaultDomain">指定默认域</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-RegisteringNewUsersonLogin">登录时注册新用户</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-Linux-SpecificConfiguration">特定于Linux的配置</a></li></ul></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-LDAPAuthentication">LDAP验证</a></li></ul></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-HTTPAuthenticationModules">HTTP验证模块</a><ul class="list _bullet"><li class="list__item"><a href="#ConfiguringAuthenticationSettings-BasicHTTPAuthentication">基本HTTP验证</a></li><li class="list__item"><a href="#ConfiguringAuthenticationSettings-NTLMHTTPAuthentication">NTLM HTTP身份验证</a></li></ul></li></ul><p></p><a name="ConfiguringAuthentication"></a><a name="Configuring-Authentication"></a><div class="chapter"><h2 id="ConfiguringAuthenticationSettings-ConfiguringAuthentication">配置身份验证</h2><p id="8d2c908a">身份验证在“ <b id="3c1ccc6b">管理” |“</b>配置”中进行配置。 <b id="3c1ccc6b">认证</b>页面；当前使用的身份验证模块也在此处显示。</p><p id="0f465f75">TeamCity的提供了几种预先配置的认证选项（预设）以覆盖所述最常见的用例描述<a href="#Simple-Mode">下面</a> 。预设是TeamCity支持的身份验证模块的组合：三个凭据身份验证模块和两个HTTP身份验证模块：</p><ul class="list _ul"><li class="list__item" id="838b4564"><a href="#Credentials-Authentication-Modules">凭证认证模块</a><ul class="list _ul"><li class="list__item" id="cb2f085f"><a href="#Built-in-Authentication">内建</a></li><li class="list__item" id="66316937"><a href="#Windows-Domain-Authentication">Windows域身份验证</a></li><li class="list__item" id="18659c39"><p><a href="ldap-integration.html">LDAP集成</a> （单独页面）</p></li><li class="list__item" id="be11db90"><a href="#Token-Based-Authentication">基于令牌的身份验证</a></li></ul></li><li class="list__item" id="373ce638"><a href="#HTTP-Authentication-Modules">HTTP验证模块</a><ul class="list _ul"><li class="list__item" id="041d2139"><a href="#Basic-HTTP-Authentication">基本HTTP验证</a></li><li class="list__item" id="1ba72ca9"><p><a href="ntlm-http-authentication.html">NTLM HTTP身份验证</a> （单独页面）</p></li></ul></li></ul><aside class="tip sideblock" rel="5f045462" id="e9251462" data-title=""><p id="73d89a7c">如果您使用的是<a href="/hub/" rel="noopener noreferrer" data-external="true" target="_blank">JetBrains Hub</a> ，则可以使用<a href="https://plugins.jetbrains.com/plugin/9156-jetbrains-hub-integration" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity</a>的<a href="https://plugins.jetbrains.com/plugin/9156-jetbrains-hub-integration" rel="noopener noreferrer" data-external="true" target="_blank">单独插件</a>通过TeamCity登录表单和IDE中的JetBrains Hub配置单点登录（SSO）。</p></aside><p id="42530bd0">首次登录TeamCity时，将启用包括内置和基本HTTP身份验证模块在内的默认身份验证，并且在<a href="#Simple-Mode">简单模式下</a>编辑身份验证设置处于活动状态。</p><ul class="list _ul"><li class="list__item" id="bcd925cc"><p>要修改现有设置，请单击表中已启用身份验证模块说明旁边的“ <b id="47939a41">编辑”</b>链接。</p></li><li class="list__item" id="4c4d85dd"><p>要切换到其他预配置方案，请使用“ <b id="a5ebf7f1">加载预设”</b>按钮。有关更多选项，请切换到<a href="#Advanced-Mode">高级模式</a> 。</p></li></ul><aside class="tip sideblock" rel="de91b3c3" id="bb9cbf45" data-title=""><p id="c924d5a0">用户界面中对身份验证所做的任何更改都会反映在<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/auth-config.xml</code>文件，如果由于某些原因不适合通过Web UI编辑，则可用于配置身份验证。在<a href="https://confluence.jetbrains.com/display/TCD8/Configuring+Authentication+Settings" rel="noopener noreferrer" data-external="true" target="_blank">较早的文档版本中</a>提供了详细说明。</p></aside><a name="SimpleMode"></a><a name="Simple-Mode"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-SimpleMode">简单模式</h3><p id="f2c7c741">简单模式（默认）允许您选择为最常见的用例创建的预设。要覆盖现有的身份验证设置，请使用“ <b id="68bedbc4">加载预设...”</b>按钮，选择选项之一，然后<b id="2678218f">保存</b>更改。提供以下预设：</p><ul class="list _ul"><li class="list__item" id="39df042b"><p>默认值（ <a href="#Built-in-Authentication">内置身份验证</a> - <a href="#Token-Based-Authentication">基于令牌的身份验证</a>和<a href="accessing-server-by-http.html">基本HTTP</a> ）</p></li><li class="list__item" id="40145131"><a href="ldap-integration.html">LDAP</a></li><li class="list__item" id="bf2e779e"><p>活动目录（具有<a href="ntlm-http-authentication.html">NTLM</a>和<a href="rest-api.html">基于令牌的身份验证的</a> <a href="ldap-integration.html">LDAP</a> ）</p></li><li class="list__item" id="dc85cc02"><p>Microsoft Windows域（ <a href="ntlm-http-authentication.html">NTLM</a> ， <a href="rest-api.html">基于令牌的身份验证</a>和<a href="rest-api.html">基本HTTP</a> ）</p></li></ul></div><a name="AdvancedMode"></a><a name="Advanced-Mode"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-AdvancedMode">高级模式</h3><p id="f228f058">TeamCity允许使用TeamCity Web UI中的高级模式同时启用多个身份验证模块。</p><p id="9725613b">当用户尝试登录时，将逐个尝试所有模块。如果其中之一对用户进行身份验证，则登录将成功；否则，登录将失败。如果它们全部失败，则用户将无法登录TeamCity。</p><aside class="note " rel="9725613b" id="66f05bd0" data-title=""><p id="077bfcb0">从TeamCity 10.0.2开始，如果系统管理员在服务器上启用了多种身份验证模式（包括<a href="#Built-in-Authentication">内置</a>身份验证）的情况下创建了没有密码的用户，然后又将授权从混合身份验证更改为<a href="#Built-in-Authentication">内置</a>身份验证，则没有密码的用户将无法使用登录TeamCity。</p></aside><p id="d8b5f792">可以使用内部和外部身份验证的组合。推荐的方法是先为内部员工配置<a href="ldap-integration.html">LDAP集成</a> ，然后为外部用户添加<a href="#Built-in-Authentication">内置</a>身份验证。</p><ol class="list _decimal"><li class="list__item" id="0621c429"><p>使用“ <b id="f4e4b947">管理” |</b> “ <b id="f4e4b947">管理”中</b>的相应链接切换到高级模式<b id="f4e4b947">。认证</b>页面。</p></li><li class="list__item" id="fe27a7f5"><p>单击<b id="7ee05a7c">添加模块，</b>然后从下拉列表中选择一个模块。</p></li><li class="list__item" id="75035e0f"><p>通过选择/取消选中“ <b id="e8b9c0b7">添加模块”</b>对话框中的复选框来使用模块可用的属性。</p></li><li class="list__item" id="d98cf2cd"><p>单击<b id="1856d660">应用</b>并<b id="176367f2">保存</b>更改。</p></li></ol><p id="8dc590c4">而且，TeamCity插件可以提供<a href="https://plugins.jetbrains.com/docs/teamcity/custom-authentication-module.html" rel="noopener noreferrer" data-external="true" target="_blank">其他身份验证模块</a> 。</p></div></div><a name="UserAuthenticationSettings"></a><a name="User-Authentication-Settings"></a><div class="chapter"><h2 id="ConfiguringAuthenticationSettings-UserAuthenticationSettings">用户验证设置</h2><p id="f5816552">TeamCity服务器首次启动时没有用户（也没有管理员），因此系统将提示您输入管理员帐户。如果未提示您输入管理员帐户，请参考<a href="how-to.html#Retrieve-Administrator-Password">如何检索管理员密码</a>以获取解决方案。</p><p id="70fc6879">TeamCity管理员可以在其个人资料页面上为每个用户修改身份验证设置。</p><p id="8d125e84">用户和身份验证模块的TeamCity列表仅将外部凭据映射到用户。这意味着，只要输入的凭据映射到同一TeamCity用户，单个TeamCity用户就可以使用不同的模块进行身份验证。身份验证模块具有如何将外部用户数据映射到TeamCity用户的配置，某些模块（Windows域，JetBrains Hub）允许编辑TeamCity用户配置文件上的外部用户链接数据。</p><p id="d1a3039a">捆绑的认证模块对用户映射的处理：</p><ul class="list _ul"><li class="list__item" id="4860747f"><p>内置身份验证为每个用户存储由TeamCity维护的密码</p></li><li class="list__item" id="4cc186f8"><p>Windows域身份验证允许指定默认域，并假定域帐户名等于TeamCity用户。可以在用户个人资料页面上编辑域帐户</p></li><li class="list__item" id="148f6892"><p>LDAP集成允许设置LDAP属性以从用户的LDAP条目获取TeamCity用户名</p></li></ul><p id="a2636e14">修改身份验证设置时应小心：在更改身份验证模块后，管理员可能无法登录：</p><p id="f0e89dc7">假设管理员拥有“ jsmith” TeamCity用户名并使用了默认身份验证。然后，将身份验证模块更改为Windows域身份验证（即，添加了Windows域身份验证模块，并删除了默认模块）。例如，如果该管理员的Windows域用户名是“ john.smith”，则他/她将无法登录：由于禁用了默认身份验证，因此他/她无法使用默认身份验证登录，并且无法使用Windows域身份验证进行登录。因为他/她的Windows域用户名不等于TeamCity用户名。但是，该解决方案非常简单：管理员可以使用超级用户帐户登录并更改其TeamCity用户名，或在自己的个人资料页面上指定其Windows域用户名。</p><a name="SpecialUserAccounts"></a><a name="Special-User-Accounts"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-SpecialUserAccounts">特殊用户帐户</h3><p id="a8fdc62d">默认情况下，TeamCity具有一个具有最大权限的<a href="super-user.html">超级用户</a>帐户和一个具有最小权限的<a href="guest-user.html">访客用户</a> 。这些帐户没有任何个人设置，例如“ <a href="viewing-your-changes.html">更改”</a>页面和“个人资料”信息，因为它们与任何特定人员都不相关，而仅用于特殊用例。</p></div></div><a name="CredentialsAuthenticationModules"></a><a name="Credentials-Authentication-Modules"></a><div class="chapter"><h2 id="ConfiguringAuthenticationSettings-CredentialsAuthenticationModules">凭证认证模块</h2><a name="Built-inAuthentication"></a><a name="Built-in-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-Built-inAuthentication">内置认证</h3><p id="37b14ad5">默认情况下，TeamCity使用内置身份验证，这意味着用户及其密码由TeamCity维护。</p><p id="ac3ced79">首次登录TeamCity时，将提示用户创建TeamCity用户名和密码，该用户名和密码将存储在TeamCity中并用于身份验证。如果安装并登录了TeamCity，则意味着启用了内置身份验证，并且所有用户数据都存储在TeamCity中。</p><p id="047f33e4">开始时，用户数据库为空，并且<a href="managing-users-and-user-groups.html#Creating-New-User">TeamCity管理员添加了</a>新用户，或者用户进行了自注册：默认设置允许用户从登录页面进行注册。所有新创建的用户都属于“ <a href="user-group.html#" all-user="-group" ="">所有用户”</a>组，并且已将所有角色分配给该组。如果新注册的用户需要某些特定<a href="role-and-permission.html">角色</a> ，则应通过“ <b id="8ee1cf8b">所有用户”</b>组<a href="managing-roles.html">授予</a>这些角色。</p><p id="22f2fba2">默认情况下，允许用户在其个人资料页面上更改其密码。</p></div><a name="Token-BasedAuthentication"></a><a name="Token-Based-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-Token-BasedAuthentication">基于令牌的身份验证</h3><p id="6a2c8351">允许用户通过可以创建并使其自身无效的<a href="managing-your-user-account.html#Managing-Access-Tokens">访问令牌</a>进行身份验证。</p><p id="7bb3b4b6">默认情况下启用此身份验证模块。</p></div><a name="WindowsDomainAuthentication"></a><a name="Windows-Domain-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-WindowsDomainAuthentication">Windows域身份验证</h3><p id="5ec1d5a0">允许用户使用Windows域名和密码登录。凭据检查是在TeamCity服务器端执行的，因此服务器应了解用户用于登录的域。用户名支持的语法是<code class="code">DOMAIN\user.name</code>以及<code class="code"><username>@<domain></code> 。</p><p id="2bcb4ee3">除了使用登录表单登录之外，您还可以启用<a href="ntlm-http-authentication.html">NTLM HTTP身份验证</a>单点登录。<br>如果选择“ Microsoft Windows域”预设，则除了通过Windows域登录外，默认情况下还将启用<a href="#Basic-HTTP-Authentication">基本HTTP</a>和<a href="ntlm-http-authentication.html">NTLM</a>身份验证模块。</p><a name="SpecifyingDefaultDomain"></a><a name="Specifying-Default-Domain"></a><div class="chapter"><h4 id="ConfiguringAuthenticationSettings-SpecifyingDefaultDomain">指定默认域</h4><p id="58bfe135">要使用户能够使用登录表单进入系统而无需将域指定为用户名的一部分，请执行以下操作：</p><ol class="list _decimal"><li class="list__item" id="b3e3f29d"><p>转到<b id="95e9f48d">管理|认证</b>页面。</p></li><li class="list__item" id="6aa5b7f2"><p>单击表中<b id="51889791">Microsoft Windows域</b>身份验证说明旁边的<b id="0e318ab7">编辑</b>链接。</p></li><li class="list__item" id="9d977a35"><p>在“ <b id="6b21bbda">默认域：”</b>字段中设置名称。</p></li><li class="list__item" id="99836233"><p>单击<b id="07ffbd61">完成</b>并<b id="66666202">保存</b>更改。</p></li></ol></div><a name="RegisteringNewUsersonLogin"></a><a name="Registering-New-Users-on-Login"></a><div class="chapter"><h4 id="ConfiguringAuthenticationSettings-RegisteringNewUsersonLogin">登录时注册新用户</h4><p id="12d8c5c5">默认设置允许用户从登录页面进行注册，新用户的TeamCity用户名将与其Windows域帐户相同。<br>所有新创建的用户都属于“ <a href="user-group.html#" all-user="-group" ="">所有用户”</a>组，并且已将所有角色分配给该组。如果新注册的用户需要某些特定<a href="role-and-permission.html">角色</a> ，则应通过“ <b id="af9dd3f8">所有用户”</b>组<a href="managing-roles.html">授予</a>这些角色。</p><p id="e649663b">要在登录时禁用新用户注册：</p><ol class="list _decimal"><li class="list__item" id="94dba289"><p>转到<b id="174019a2">管理|认证</b>页面。</p></li><li class="list__item" id="1dc473a4"><p>单击表中<b id="11bdc814">Microsoft Windows域</b>身份验证说明旁边的<b id="b000443c">编辑</b>链接。<b id="de0361a6">在登录页面上</b>取消选中<b id="de0361a6">允许用户注册</b> 。</p></li><li class="list__item" id="3e702a94"><p>单击表中<b id="5ff6f2a5">NTLM HTTP</b>身份验证说明旁边的<b id="024a7137">编辑</b>链接。<b id="45841e02">在登录页面上</b>取消选中<b id="45841e02">允许用户注册</b> 。</p></li></ol></div><a name="Linux-SpecificConfiguration"></a><a name="Linux-Specific-Configuration"></a><div class="chapter"><h4 id="ConfiguringAuthenticationSettings-Linux-SpecificConfiguration">特定于Linux的配置</h4><p id="231f1cc2">如果您的TeamCity服务器在Linux下运行，则JCIFS库用于Windows域登录。这仅支持启用了SMB（SMBv1）的Windows域服务器。不支持SMB2。该库是使用在<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/ntlm-config.properties</code>文件。对该文件所做的更改将在不重新启动服务器的情况下立即生效。</p><p id="94ff51cf">只能在通过传递的属性文件中设置无法在运行时更改的JCIFS库设置或影响HTTP NTLM设置的设置<code class="code">-Djcifs.properties</code> JVM选项。</p><p id="19c6ab12">如果默认设置不适用于您的环境，请参阅<a href="http://jcifs.samba.org/src/docs/api/" rel="noopener noreferrer" data-external="true" target="_blank">http://jcifs.samba.org/src/docs/api/</a>了解所有可用的配置属性。<br>如果该库找不到要验证的域控制器，请考虑添加<code class="code">jcifs.netbios.wins</code>财产<code class="code">ntlm-config.properties</code>文件与您的WINS服务器的地址。有关其他域服务的定位属性，请参见<a href="http://jcifs.samba.org/src/docs/resolver.html" rel="noopener noreferrer" data-external="true" target="_blank">http://jcifs.samba.org/src/docs/resolver.html</a> 。</p></div></div><a name="LDAPAuthentication"></a><a name="LDAP-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-LDAPAuthentication">LDAP验证</h3><p id="dc3a95b4">请参考<a href="ldap-integration.html">专用页面</a> 。</p></div></div><a name="HTTPAuthenticationModules"></a><a name="HTTP-Authentication-Modules"></a><div class="chapter"><h2 id="ConfiguringAuthenticationSettings-HTTPAuthenticationModules">HTTP验证模块</h2><a name="BasicHTTPAuthentication"></a><a name="Basic-HTTP-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-BasicHTTPAuthentication">基本HTTP验证</h3><p id="30a79aaf">有关基本HTTP身份验证的详细信息，请参阅“ <a href="accessing-server-by-http.html">通过HTTP访问服务器”</a> 。</p><aside class="tip sideblock" rel="30a79aaf" id="9028c5bc" data-title=""><p id="517a326e">有关直接在服务器中配置基本HTTP身份验证的信息<code class="code"><</code> <a href="teamcity-data-directory.html"><code class="code">TeamCity Data Directory</code></a> <code class="code">>/config/auth-config.xml</code> ，请参考<a href="https://confluence.jetbrains.com/display/TCD8/Configuring+Authentication+Settings" rel="noopener noreferrer" data-external="true" target="_blank">早期的文档版本</a> 。</p></aside></div><a name="NTLMHTTPAuthentication"></a><a name="NTLM-HTTP-Authentication"></a><div class="chapter"><h3 id="ConfiguringAuthenticationSettings-NTLMHTTPAuthentication">NTLM HTTP身份验证</h3><p id="3445881a">请参考<a href="ntlm-http-authentication.html">专用页面</a> 。</p><hr id="528582c3"><p id="f8c35687"><b id="b1add398">也可以看看：</b></p><p id="66fcd9e4"><b id="c7b4a4d9">概念</b> ： <a href="authentication-modules.html">身份验证模块</a></p><hr id="2f89d785"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>