<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Customizing Notifications - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Customizing Notifications" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/customizing-notifications.md|Customizing Notifications" data-main-title="Customizing Notifications" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/customizing-notifications.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Customizing Notifications" id="customizing-notifications.md">Customizing Notifications</h1><p id="c392c15b">TeamCity users can <a href="subscribing-to-notifications.html">select the events to be notified about</a>. The default notification messages can be customized globally on a per-server basis. Customizing notifications received via Atom/RSS syndication feeds requires a <a href="#TeamCity-Notification-Properties">special approach</a> since the feeds use the "pull" model for receiving notifications instead of "push".</p><p id="bba73dc9">On this page:</p><p id="a9bb98d1"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#CustomizingNotifications-NotificationsLifecycle">Notifications Lifecycle</a></li><li class="list__item"><a href="#CustomizingNotifications-CustomizingNotificationsTemplates">Customizing Notifications Templates</a><ul class="list _bullet"><li class="list__item"><a href="#CustomizingNotifications-NotificationTemplatesLocation">Notification Templates Location</a></li><li class="list__item"><a href="#CustomizingNotifications-SupportedOutputValues">Supported Output Values</a></li><li class="list__item"><a href="#CustomizingNotifications-CustomizationExamples">Customization Examples</a><ul class="list _bullet"><li class="list__item"><a href="#CustomizingNotifications-IncludingERRORSfromthelog">Including ERRORS from the log</a></li><li class="list__item"><a href="#CustomizingNotifications-Listingbuildartifacts">Listing build artifacts</a></li><li class="list__item"><a href="#CustomizingNotifications-Listingbuildparameters">Listing build parameters</a></li></ul></li><li class="list__item"><a href="#CustomizingNotifications-DefaultDataModel">Default Data Model</a></li><li class="list__item"><a href="#CustomizingNotifications-TeamCityNotificationProperties">TeamCity Notification Properties</a></li><li class="list__item"><a href="#CustomizingNotifications-SyndicationFeedTemplate">Syndication Feed Template</a></li></ul></li></ul></p><a name="NotificationsLifecycle"></a><a name="Notifications-Lifecycle"></a><div class="chapter"><h2 id="CustomizingNotifications-NotificationsLifecycle">Notifications Lifecycle</h2><p id="86ebf9fd">TeamCity supports a set of events that can generate user notifications (such as build failures, investigation state changes, etc). On an event occurrence, for each notifier type, TeamCity processes notification settings for all the users to determine which users to notify.</p><p id="a359cbe7">When the set of users is determined, TeamCity fills the notification model (the objects relevant to the notification, such as "build", investigation data, and so on) and evaluates a notification template that corresponds to the notification event.<br>The template uses the data model objects to generate the output values (for example, notification message text). The output values are then used by the notifier to send the message. Each notifier supports a specific set of output values.</p><p id="02f5a97e">Note that the template is evaluated once for an event which means that notification properties cannot be adjusted on a per-user basis.</p><p id="af4f62df">The output values defined by the template are then used by the notifier to send alerts to the selected users.</p></div><a name="CustomizingNotificationsTemplates"></a><a name="Customizing-Notifications-Templates"></a><div class="chapter"><h2 id="CustomizingNotifications-CustomizingNotificationsTemplates">Customizing Notifications Templates</h2><a name="NotificationTemplatesLocation"></a><a name="Notification-Templates-Location"></a><div class="chapter"><h3 id="CustomizingNotifications-NotificationTemplatesLocation">Notification Templates Location</h3><p id="801c8bb0">Each of the bundled <a href="notifier.html">notifiers</a> has a directory in &lt;<a href="teamcity-data-directory.html">TeamCity Data Directory</a>&gt;/config_notifications/, which stores <a href="http://freemarker.sourceforge.net/" data-external="true" target="_blank" rel="noopener noreferrer">FreeMarker</a> (<code class="code">.ftl</code>) templates. There are also <a href="teamcity-data-directory.html#.dist-Template-Configuration-Files"><code class="code">.dist</code></a> files that store the default templates. Each notification type evaluates a template file with a corresponding name. The template files can be modified while the server is running.</p><p id="244d1284">By default, the server checks for changes in the files every 60 seconds, but this can be changed by setting the <code class="code">teamcity.notification.template.update.interval</code> <a href="configuring-teamcity-server-startup-properties.html#TeamCity-internal-properties">internal property</a> to the desired number of seconds.</p><p id="3ac89145">If an error occurs during the template evaluation, TeamCity logs the error details to <code class="code">teamcity-notifications.log</code>. There can be non-critical errors that result in ignoring part of the template or critical errors that result in the inability to send notification at all. Whenever you make changes to the notification templates ensure the notification can still be sent.</p><p id="7330a1e4">This document doesn't describe the FreeMarker template language, so if you need guidance on the FreeMarker syntax, refer to the corresponding template manual at <a href="http://freemarker.org/docs/dgui.html" data-external="true" target="_blank" rel="noopener noreferrer">http://freemarker.org/docs/dgui.html</a>.</p></div><a name="SupportedOutputValues"></a><a name="Supported-Output-Values"></a><div class="chapter"><h3 id="CustomizingNotifications-SupportedOutputValues">Supported Output Values</h3><p id="17c050dd">TeamCity notifiers use templates to evaluate output values (global template variables) which are then retrieved by name. The following output values are supported:</p><p id="edf092ac"><b id="fd9e0528">Email Notifier</b></p><ul class="list _ul"><li class="list__item" id="7c8cfeeb"><p><b id="8ee9ee5c">subject</b> - subject of the email message to send</p></li><li class="list__item" id="b012e521"><p><b id="e1f58059">body</b> - plain text of the email message to send</p></li><li class="list__item" id="d4d2cc13"><p><b id="8c84381d">bodyHtml</b> - This is the optional HTML text of the email message to send. It will be included together with plain text part of the message. However, if it is present in the template, it should be customized as well.</p></li><li class="list__item" id="d836f484"><p><b id="4fa8f1b5">headers</b> - (optional) Raw list of additional headers to include into an email. One header per line. For example:</p></li></ul><div class="code-block" data-lang="markup">&lt;#global headers&gt;
  X-Priority: 1 (Highest)
  Importance: High
&lt;/#global&gt;

</div><p id="40c69ad7"><b id="41ed94e7">Jabber</b></p><ul class="list _ul"><li class="list__item" id="5f614cd0"><p><b id="e1768525">message</b> - plain text of the message to send<b id="eb0a9060">IDE Notifications</b> and <b id="1b060ddf">Windows Tray Notifications</b></p></li><li class="list__item" id="7afa65a0"><p><b id="225d22d3">message</b> - plain text of the message to send</p></li><li class="list__item" id="f02cceb1"><p><b id="73fa8595">link</b> - URL of the TeamCity page that contains detailed information about the event(i)The Atom/RSS feeds template differs from the others. Refer to the <a href="#TeamCity-Notification-Properties">dedicated section</a> for details.</p></li></ul></div><a name="CustomizationExamples"></a><a name="Customization-Examples"></a><div class="chapter"><h3 id="CustomizingNotifications-CustomizationExamples">Customization Examples</h3><p id="1a4a468c">This section provides Freemaker code snippets that can be used for customization of notifications:</p><a name="IncludingERRORSfromthelog"></a><a name="Including-ERRORS-from-the-log"></a><div class="chapter"><h4 id="CustomizingNotifications-IncludingERRORSfromthelog">Including ERRORS from the log</h4><div class="code-block" data-lang="markup">&lt;#list build.buildLog.messages[1..] as message&gt;&lt;#-- skipping the first message (it is a root node)--&gt;
  &lt;#if message.status == "ERROR" || message.status == "FAILURE" &gt;
    ${message.text}
  &lt;/#if&gt;
&lt;/#list&gt;

</div><p id="1689da4a">The example below shows the snippet included into the <code class="code">build_failed.ftl</code> template: the errors will be listed in both the plain text and the html part of the e-mail:</p><div class="code-block" data-lang="markup">&lt;#-- Uses FreeMarker template syntax, template guide can be found at http://freemarker.org/docs/dgui.html --&gt;
 
&lt;#import "common.ftl" as common&gt;
 
&lt;#global subject&gt;[&lt;@common.subjMarker/&gt; FAILED] ${project.name}:${buildType.name} - Build: ${build.buildNumber}&lt;/#global&gt;
 
&lt;#global body&gt;TeamCity build: ${project.name}:${buildType.name} - Build: ${build.buildNumber} failed ${var.buildShortStatusDescription}.
Agent: ${agentName}
Build results: ${link.buildResultsLink}
 
${var.buildCompilationErrors}${var.buildFailedTestsErrors}${var.buildChanges}
 
 &lt;#list build.buildLog.messages[1..] as message&gt;&lt;#-- skipping the first message (it is a root node)--&gt;
   &lt;#if message.status == "ERROR" || message.status == "FAILURE" &gt;
     ${message.text}
   &lt;/#if&gt;
 &lt;/#list&gt;
 
&lt;@common.footer/&gt;&lt;/#global&gt;
 
&lt;#global bodyHtml&gt;
&lt;div&gt;
  &lt;div&gt;
    TeamCity build: &lt;i&gt;${project.name}:${buildType.name} - &lt;a href='${link.buildResultsLink}'&gt;Build: ${build.buildNumber}&lt;/a&gt;&lt;/i&gt; failed
    ${var.buildShortStatusDescription}
  &lt;/div&gt;
  &lt;@common.build_agent build/&gt;
  &lt;@common.build_comment build/&gt;
  &lt;br&gt;
  &lt;@common.build_changes var.changesBean/&gt;
  &lt;@common.compilation_errors var.compilationBean/&gt;
  &lt;@common.test_errors var.failedTestsBean/&gt;
 
    &lt;#list build.buildLog.messages[1..] as message&gt;&lt;#-- skipping the first message (it is a root node)--&gt;
   &lt;#if message.status == "ERROR" || message.status == "FAILURE" &gt;
     ${message.text}
   &lt;/#if&gt;
 &lt;/#list&gt;
 
  &lt;@common.footerHtml/&gt;
&lt;/div&gt;
&lt;/#global&gt;

</div></div><a name="Listingbuildartifacts"></a><a name="Listing-build-artifacts"></a><div class="chapter"><h4 id="CustomizingNotifications-Listingbuildartifacts">Listing build artifacts</h4><p id="0cdf35cd">There is no default way of listing build artifacts in an email template at the moment. See a <a href="https://youtrack.jetbrains.com/issue/TW-50431" data-external="true" target="_blank" rel="noopener noreferrer">related issue</a> with a simple plugin allowing you to list artifacts via a relevant API.</p><p id="212ab913"><b id="e370c0e4">Current workaround</b></p><p id="595e13b5">This assumes direct access to disk from the template and ignores external artifacts storage (like S3) as well as artifacts browsing policies (not showing internal artifacts). Also, this way is likely to become deprecated in the future TeamCity versions.</p><div class="code-block" data-lang="markup">&lt;p&gt;Build artifacts:&lt;/p&gt;
  &lt;#list build.artifactsDirectory.listFiles() as file&gt;
    &lt;a href="${webLinks.getDownloadArtefactUrl(build.buildTypeExternalId, build.buildId, file.name)}"&gt;${file.name}&lt;/a&gt; (${file.length()}B)&lt;br/&gt;
  &lt;/#list&gt;

</div><p id="6c8d9995">This will list only the root artifacts and include the <code class="code">.teamcity</code> directory, which can be changed by modifications to the code.</p></div><a name="Listingbuildparameters"></a><a name="Listing-build-parameters"></a><div class="chapter"><h4 id="CustomizingNotifications-Listingbuildparameters">Listing build parameters</h4><div class="code-block" data-lang="markup">&lt;#list build.parametersProvider.all?keys as param&gt;
  ${param} - ${build.parametersProvider.all[param]}
  &lt;br&gt;
&lt;/#list&gt;

</div><p id="6cd10d17">This will list the parameters that are passed to the build from the server.</p></div></div><a name="DefaultDataModel"></a><a name="Default-Data-Model"></a><div class="chapter"><h3 id="CustomizingNotifications-DefaultDataModel">Default Data Model</h3><p id="202ff0ef">For the template evaluation, TeamCity provides the default data model that can be used inside the template. The objects exposed in the model are instances of the corresponding classes from <a href="https://plugins.jetbrains.com/docs/teamcity/server-side-object-model.html" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity server-side open API</a>.<br>The set of available objects model differs for different events.You can also add your own objects into the model via a plugin. See <a href="https://plugins.jetbrains.com/docs/teamcity/extending-notification-templates-model.html" data-external="true" target="_blank" rel="noopener noreferrer">Extending Notification Templates Model</a>) for details.</p><p id="92800b07">Here is an example description of the model (the code can be used in IntelliJ IDEA to edit the template with completion). Note that not all entities listed below will be available in any template, for example, all test responsibilities are assigned in the project scope and notifications on test responsibilities can be configured to point to a project where an investigation was assigned (not to a build configuration).</p><div class="code-block" data-lang="markup">&lt;#-- @ftlvariable name="project" type="jetbrains.buildServer.serverSide.SProject" --&gt;
&lt;#-- @ftlvariable name="buildType" type="jetbrains.buildServer.serverSide.SBuildType" --&gt;
&lt;#-- @ftlvariable name="build" type="jetbrains.buildServer.serverSide.SBuild" --&gt;
&lt;#-- @ftlvariable name="agentName" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="buildServer" type="jetbrains.buildServer.serverSide.SBuildServer" --&gt;
&lt;#-- @ftlvariable name="webLinks" type="jetbrains.buildServer.serverSide.WebLinks" --&gt;
 
&lt;#-- @ftlvariable name="var.buildFailedTestsErrors" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="var.buildShortStatusDescription" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="var.buildChanges" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="var.buildCompilationErrors" type="java.lang.String" --&gt;
 
&lt;#-- @ftlvariable name="link.editNotificationsLink" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="link.buildResultsLink" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="link.buildChangesLink" type="java.lang.String" --&gt;
&lt;#-- @ftlvariable name="responsibility" type="jetbrains.buildServer.responsibility.ResponsibilityEntry" --&gt;
&lt;#-- @ftlvariable name="oldResponsibility" type="jetbrains.buildServer.responsibility.ResponsibilityEntry" --&gt;

</div></div><a name="TeamCityNotificationProperties"></a><a name="TeamCity-Notification-Properties"></a><div class="chapter"><h3 id="CustomizingNotifications-TeamCityNotificationProperties">TeamCity Notification Properties</h3><p id="8ed38bcf">The following <a href="configuring-teamcity-server-startup-properties.html">properties</a> can be useful to customize the notifications behavior:</p><ul class="list _ul"><li class="list__item" id="8411b37a"><p><code class="code">teamcity.notification.template.update.interval</code> – how often the templates are reread by the system (integer, in seconds, default 60)</p></li><li class="list__item" id="ca40de6d"><p><code class="code">teamcity.notification.includeDebugInfo</code> – include debugging information into the message in case of template processing errors (boolean, default false)</p></li><li class="list__item" id="ce2d96d0"><p><code class="code">teamcity.notification.maxChangesNum</code> – max number of changes to list in an email message (integer, default 10)</p></li><li class="list__item" id="2a484c29"><p><code class="code">teamcity.notification.maxCompilationDataSize</code> – max size (in bytes) of compilation error data to include in an email message (integer, default 20480)</p></li><li class="list__item" id="0c0419fa"><p><code class="code">teamcity.notification.maxFailedTestNum</code> – max number of failed tests to list in an email message (integer, default 50)</p></li><li class="list__item" id="64dc6aea"><p><code class="code">teamcity.notification.maxFailedTestStacktraces</code> – max number of test stacktraces in an email message (integer, default 5)</p></li><li class="list__item" id="42615f43"><p><code class="code">teamcity.notification.maxFailedTestDataSize</code> – max size (in bytes) of failed test output data to include in a single email message (integer, default 10240)</p></li></ul></div><a name="SyndicationFeedTemplate"></a><a name="Syndication-Feed-Template"></a><div class="chapter"><h3 id="CustomizingNotifications-SyndicationFeedTemplate">Syndication Feed Template</h3><p id="f0924b23">The template uses a configuration approach different from other notification engines.</p><p id="08485699">The default template is stored in the file: <code class="code">&lt;TeamCity Data Directory&gt;/config/default-feed-item-template.ftl</code>. This file should never be edited: it is overwritten on every server startup with the default copy. To specify a new template to use, copy the file named <code class="code">feed-item-template.ftl</code> into the same directory. This file can be edited and will not be overwritten. It will be used by the engine if present.</p><p id="3a5e5cde">The template is a <a href="http://freemarker.org/docs/dgui.html" data-external="true" target="_blank" rel="noopener noreferrer">FreeMarker</a> template and can be freely edited.</p><p id="33eb30dd">You can use several templates on a single server. The template name can be passed as a <a href="subscribing-to-notifications.html#Additional-Supported-URL-Parameters">URL parameter</a> of the feed URL.</p><p id="7c0b3d19">During feed rendering, the template is evaluated to get the feed content. The resultant content is defined by the global variables defined in the template.</p><p id="c6090e62">See the default template for an example of available input variables and output variables.</p><hr id="5db4c166"><p id="c9c3c461"><b id="738161eb">See also:</b></p><p id="5ac1ddf0"><b id="54cced85">User's Guide</b>: <a href="subscribing-to-notifications.html">Subscribing to Notifications</a></p><hr id="e83b34b9"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>