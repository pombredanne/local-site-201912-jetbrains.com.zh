<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>可用磁盘空间-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Free Disk Space" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/free-disk-space.md|Free Disk Space" data-main-title="Free Disk Space" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/free-disk-space.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="free-disk-space.md" data-toc="Free Disk Space">可用磁盘空间</h1><p id="06ea6654"><i id="e305ce8e">可用磁盘空间</i> <a href="adding-build-features.html">构建功能</a>允许通过删除TeamCity代理管理的文件（其他构建的签出目录和各种缓存）来确保在构建之前<b id="f6274483">代理上的</b>某些可用磁盘空间。<br>未配置功能时，构建的默认可用空间为3 GB。</p><p id="40aaddbb">在此页：</p><p id="c9176112"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#FreeDiskSpace-Analyzingandfreeingdiskspace">分析并释放磁盘空间</a></li><li class="list__item"><a href="#FreeDiskSpace-Configuringfreediskspace">配置可用磁盘空间</a></li><li class="list__item"><a href="#FreeDiskSpace-Otherwaystosetthefreediskspacevalue">设置可用磁盘空间值的其他方法</a><ul class="list _bullet"><li class="list__item"><a href="#FreeDiskSpace-Configuringartifactscache">配置工件缓存</a></li></ul></li></ul><p></p><a name="Analyzingandfreeingdiskspace"></a><a name="Analyzing-and-freeing-disk-space"></a><div class="chapter"><h2 id="FreeDiskSpace-Analyzingandfreeingdiskspace">分析并释放磁盘空间</h2><p id="d55a39b8">在构建之前和每个构建准备阶段之前，代理将在以下三个位置检查当前可用的磁盘空间：代理的系统，代理的temp目录和构建签出目录。所有位置都必须满足相同的指定要求。如果指定了失败条件，则如果两个位置中的任何一个都不满足要求，构建都将失败。</p><p id="25e21214">如果数量少于要求的数量，则代理将尝试在继续之前删除其他版本的数据。</p><p id="ffaa2c34">清除的数据包括：</p><ul class="list _ul"><li class="list__item" id="aa8dd6d1"><p>标记为<a href="build-checkout-directory.html#Automatic-Checkout-Directory-Cleaning">删除</a>的检出目录</p></li><li class="list__item" id="5e52638a"><p>其他版本的结帐目录的内容，按最新倒序使用</p></li><li class="list__item" id="5046e482"><p>先前下载的工件的缓存（已通过TeamCity工件依赖项下载到代理）</p></li><li class="list__item" id="2e227261"><p>清理本地<a href="integrating-teamcity-with-docker.html#Docker-Disk-Space-Cleaner">Docker缓存</a></p></li><li class="list__item" id="1b3a1db2"><p>清理本地<a href="nuget.html#NuGet-Packages-Cache-Clean-up-on-Agents">NuGet包缓存</a></p></li></ul><p id="c2a6969d">如果您需要确保在释放磁盘空间时从未删除结帐目录，请设置<code class="code">system.teamcity.build.checkoutDir.expireHours</code>财产<code class="code">never</code> 。在<a href="build-checkout-directory.html">Build Checkout Directory中</a>查看更多信息。</p></div><a name="Configuringfreediskspace"></a><a name="Configuring-free-disk-space"></a><div class="chapter"><h2 id="FreeDiskSpace-Configuringfreediskspace">配置可用磁盘空间</h2><p id="cd547a0d">您可以使用“可用磁盘空间” <a href="adding-build-features.html">构建功能</a>来更改默认的3 GB所需磁盘空间。配置以下设置：</p><div class="table-wrapper"><table width="100%" id="4150508f"><thead><tr id="a9770798" class="ijRowHead"><th id="f53b97d0"><p id="f0c38e1e">设置</p></th><th id="eb25bc3c"><p id="b00a0dc1">描述</p></th></tr></thead><tbody><tr id="65025186" class="ijRowOdd"><td id="51d812e5"><p id="0d689a10">所需的可用空间</p></td><td id="98e86c72"><p id="78720ead">您可以在此处指定自定义的可用磁盘空间值（以字节为单位，或者使用kb，mb，gb或tb后缀之一）。</p></td></tr><tr id="e5f81a85" class="ijRowEven"><td id="29961177"><p id="e64b7d2e">如果无法释放足够的磁盘空间，则构建失败</p></td><td id="0f74ab0f"><p id="904c4d19">选中复选框以添加相应的构建失败条件。</p></td></tr></tbody></table></div></div><a name="Otherwaystosetthefreediskspacevalue"></a><a name="Other-ways-to-set-the-free-disk-space-value"></a><div class="chapter"><h2 id="FreeDiskSpace-Otherwaystosetthefreediskspacevalue">设置可用磁盘空间值的其他方法</h2><p id="81b17363">出于兼容性原因，可以通过以下属性指定可用磁盘空间值。但是，建议使用“可用磁盘空间”构建功能，因为可以在将来的TeamCity版本中删除这些属性。</p><p id="21ffaf89">可以定义属性：</p><ul class="list _ul"><li class="list__item" id="3dac676d"><p>全球范围内的建筑代理（在代理的<a href="build-agent-configuration.html"><code class="code">buildAgent.properties</code></a>文件）</p></li><li class="list__item" id="9fa2f5a6"><p>通过指定特定的构建配置的系统属性来进行配置。</p></li></ul><p id="95754eef">所需的可用空间值由以下属性定义：</p><ul class="list _ul"><li class="list__item" id="961ef00b"><p><code class="code">system.teamcity.agent.ensure.free.space</code>用于构建结帐目录</p></li><li class="list__item" id="f0c77f6a"><p><code class="code">system.teamcity.agent.ensure.free.temp.space</code>对于代理商的<code class="code">temp</code>目录</p></li></ul><p id="7bc9e47c">如果<code class="code">teamcity.agent.ensure.free.temp.space</code>没有定义， <code class="code">teamcity.agent.ensure.free.space property</code>用来。</p><p id="5ad3cc6b">这些属性的值指定在生成开始之前要确保的可用磁盘空间量。该值应为数字，后跟kb，mb，gb，kib，mib或gib后缀。字节不使用后缀。<br>例：<code class="code">system.teamcity.agent.ensure.free.space = 5gb</code></p><a name="Configuringartifactscache"></a><a name="Configuring-artifacts-cache"></a><div class="chapter"><h3 id="FreeDiskSpace-Configuringartifactscache">配置工件缓存</h3><p id="8ae1e6e3">TeamCity构建代理会维护已发布和下载的构建工件的缓存，以减少向同一代理的网络传输。高速缓存存储在< <a href="agent-home-directory.html">Build Agent Home</a> > \ system.artifacts_cache目录中，并且只要正确配置了<i id="59ddb7f8">可用磁盘空间</i>构建功能，该高速缓存就会自动清除。</p><p id="48333a0b">如果不希望缓存工件（例如，工件很大且不在TeamCity中使用时，或者工件缓存目录与构建签出目录不在同一磁盘上，或者构建未定义<i id="3660053f">可用磁盘空间）</i>构建功能，而默认的3Gb不足以进行构建），可以通过添加以下命令来<b id="90be1f94">关闭</b>代理上的缓存工件<code class="code">teamcity.agent.filecache.publishing.disabled=true</code>项目或项目的构建配置之一的配置参数。但是，代理仍将缓存作为工件依赖项下载的工件。</p><hr id="870fa3fc"><p id="744ade2a"><b id="08ffe5f2">也可以看看：</b></p><p id="aacc1449"><b id="abb4f4d6">管理员指南</b> ： <a href="teamcity-disk-space-watcher.html">TeamCity服务器磁盘空间监视程序</a> | <a href="build-failure-conditions.html">构建失败条件</a></p><hr id="07199ad9"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>