<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Free Disk Space - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Free Disk Space" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/adding-build-features.md|Adding Build Features/free-disk-space.md|Free Disk Space" data-main-title="Free Disk Space" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/free-disk-space.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Free Disk Space" id="free-disk-space.md">Free Disk Space</h1><p id="06ea6654">The <i id="e305ce8e">Free disk space</i> <a href="adding-build-features.html">build feature</a> allows ensuring certain free disk space <b id="f6274483">on the agent</b> before the build by deleting files managed by the TeamCity agent (other build's checkout directories and various caches).<br>When the feature is not configured, the default free space for a build is 3 GB.</p><p id="40aaddbb">On this page:</p><p id="c9176112"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#FreeDiskSpace-Analyzingandfreeingdiskspace">Analyzing and freeing disk space</a></li><li class="list__item"><a href="#FreeDiskSpace-Configuringfreediskspace">Configuring free disk space</a></li><li class="list__item"><a href="#FreeDiskSpace-Otherwaystosetthefreediskspacevalue">Other ways to set the free disk space value</a><ul class="list _bullet"><li class="list__item"><a href="#FreeDiskSpace-Configuringartifactscache">Configuring artifacts cache</a></li></ul></li></ul></p><a name="Analyzingandfreeingdiskspace"></a><a name="Analyzing-and-freeing-disk-space"></a><div class="chapter"><h2 id="FreeDiskSpace-Analyzingandfreeingdiskspace">Analyzing and freeing disk space</h2><p id="d55a39b8">Before the build and before each build preparation stage, the agent will check the currently available free disk space in three locations: the agent's system, the agent's temp directory, and the build checkout directory. All the locations have to meet the same specified requirement. If the failure condition is specified, the build will fail if either of the locations does not meet the requirement.</p><p id="25e21214">If the amount is less than required, the agent will try to delete the data of other builds before proceeding.</p><p id="ffaa2c34">The data cleaned includes:</p><ul class="list _ul"><li class="list__item" id="aa8dd6d1"><p>the checkout directories that were marked for <a href="build-checkout-directory.html#Automatic-Checkout-Directory-Cleaning">deletion</a></p></li><li class="list__item" id="5e52638a"><p>contents of other build's checkout directories in the reversed most recently used order</p></li><li class="list__item" id="5046e482"><p>the cache of previously downloaded artifacts (that were downloaded to the agent via TeamCity artifact dependencies)</p></li><li class="list__item" id="2e227261"><p>cleaning the local <a href="integrating-teamcity-with-docker.html#Docker-Disk-Space-Cleaner">Docker caches</a></p></li><li class="list__item" id="1b3a1db2"><p>cleaning the local <a href="nuget.html#NuGet-Packages-Cache-Clean-up-on-Agents">NuGet packages caches</a></p></li></ul><p id="c2a6969d">If you need to make sure a checkout directory is never deleted while freeing disk space, set the <code class="code">system.teamcity.build.checkoutDir.expireHours</code> property to <code class="code">never</code>. See more at <a href="build-checkout-directory.html">Build Checkout Directory</a>.</p></div><a name="Configuringfreediskspace"></a><a name="Configuring-free-disk-space"></a><div class="chapter"><h2 id="FreeDiskSpace-Configuringfreediskspace">Configuring free disk space</h2><p id="cd547a0d">You can use the Free disk space <a href="adding-build-features.html">build feature</a> to alter the default 3 GB of required disk space. Configure the settings below:</p><div class="table-wrapper"><table width="100%" id="4150508f"><thead><tr id="a9770798" class="ijRowHead"><th id="f53b97d0"><p id="f0c38e1e">Setting</p></th><th id="eb25bc3c"><p id="b00a0dc1">Description</p></th></tr></thead><tbody><tr id="65025186" class="ijRowOdd"><td id="51d812e5"><p id="0d689a10">Required free space</p></td><td id="98e86c72"><p id="78720ead">You can specify a custom free disk space value here (in bytes or using one of the kb, mb, gb or tb suffixes).</p></td></tr><tr id="e5f81a85" class="ijRowEven"><td id="29961177"><p id="e64b7d2e">Fail build if sufficient disk space cannot be freed</p></td><td id="0f74ab0f"><p id="904c4d19">Check the box to add the corresponding build failure condition.</p></td></tr></tbody></table></div></div><a name="Otherwaystosetthefreediskspacevalue"></a><a name="Other-ways-to-set-the-free-disk-space-value"></a><div class="chapter"><h2 id="FreeDiskSpace-Otherwaystosetthefreediskspacevalue">Other ways to set the free disk space value</h2><p id="81b17363">For compatibility reasons  the free disk space value can be specified via the properties below. However, using the Free disk space build feature is recommended as the properties can be removed in the future TeamCity versions.</p><p id="21ffaf89">The properties can be defined:</p><ul class="list _ul"><li class="list__item" id="3dac676d"><p>globally for a build agent (in agent's <a href="build-agent-configuration.html"><code class="code">buildAgent.properties</code></a> file)</p></li><li class="list__item" id="9fa2f5a6"><p>for a particular build configuration by specifying its system properties.</p></li></ul><p id="95754eef">The required free space value is defined with the following properties:</p><ul class="list _ul"><li class="list__item" id="961ef00b"><p><code class="code">system.teamcity.agent.ensure.free.space</code> for the build checkout directory</p></li><li class="list__item" id="f0c77f6a"><p><code class="code">system.teamcity.agent.ensure.free.temp.space</code> for the agent's <code class="code">temp</code> directory</p></li></ul><p id="7bc9e47c">If <code class="code">teamcity.agent.ensure.free.temp.space</code> is not defined, the value of the <code class="code">teamcity.agent.ensure.free.space property</code> is used.</p><p id="5ad3cc6b">The values of these properties specify the amount of the available free disk space to be ensured before the build starts. The value should be a number followed by kb, mb, gb, kib, mib, or gib suffix. Use no suffix for bytes.<br>Example: <code class="code">system.teamcity.agent.ensure.free.space = 5gb</code></p><a name="Configuringartifactscache"></a><a name="Configuring-artifacts-cache"></a><div class="chapter"><h3 id="FreeDiskSpace-Configuringartifactscache">Configuring artifacts cache</h3><p id="8ae1e6e3">A TeamCity build agent maintains a cache of published and downloaded build artifacts to reduce network transfers to the same agent. The cache is stored in the &lt;<a href="agent-home-directory.html">Build Agent Home</a>&gt;\system.artifacts_cache directory and is cleaned automatically provided the <i id="59ddb7f8">Free disk space</i> build feature is configured correctly.</p><p id="48333a0b">If caching artifacts is undesirable (for example, when the artifacts are large and not used within TeamCity, or if the artifacts cache directory is located not on the same disk as the build checkout directory, or if the builds do not define the <i id="3660053f">Free disk space</i> build feature and the default 3Gb is not sufficient for a build), caching artifacts on the agent can be <b id="90be1f94">turned off</b> by adding the <code class="code">teamcity.agent.filecache.publishing.disabled=true</code> configuration parameter to a project or one of the build configurations of a project. However, the agent will still cache artifacts downloaded as artifact dependencies.</p><hr id="870fa3fc"><p id="744ade2a"><b id="08ffe5f2">See also:</b></p><p id="aacc1449"><b id="abb4f4d6">Administrator's Guide</b>: <a href="teamcity-disk-space-watcher.html">TeamCity Server Disk Space Watcher</a> | <a href="build-failure-conditions.html">Build Failure Conditions</a></p><hr id="07199ad9"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>