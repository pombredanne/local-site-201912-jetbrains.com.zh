<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>使用HTTPS访问TeamCity服务器-帮助|帮助团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Using HTTPS to access TeamCity server" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/using-https-to-access-teamcity-server.md|Using HTTPS to access TeamCity server" data-main-title="Using HTTPS to access TeamCity server" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/using-https-to-access-teamcity-server.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="using-https-to-access-teamcity-server.md" data-toc="Using HTTPS to access TeamCity server">使用HTTPS访问TeamCity服务器</h1><p id="7b1a3527">在此页：</p><p id="b13506a3"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-AccessingtheserverviaHTTPS">通过HTTPS访问服务器</a></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringJVM">配置JVM</a><ul class="list _bullet"><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringclientJVMfortrustingservercertificate">配置客户端JVM以信任服务器证书</a></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringJVMforauthenticationwithclientcertificate">配置JVM以使用客户端证书进行身份验证</a></li></ul></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-Usefultoolsinanalyzingcertificatesissues">分析证书问题的有用工具</a></li></ul><p></p><p id="c3a0c0ab">本文档介绍了如何配置Java应用程序以使用HTTPS与服务器进行通信。</p><aside class="note " rel="c3a0c0ab" id="6a7e2d88" data-title=""><p id="a4377d70">如果您需要将TeamCity服务器连接到自签名证书（例如Git）后面的服务，或者需要使用自签名证书将TeamCity代理连接到TeamCity服务器，请使用<a href="uploading-ssl-certificates.html">受信任证书配置</a> 。</p></aside><p id="a2825fc2">我们假设您<a href="how-to.html#Configure-HTTPS-for-TeamCity-Web-UI">已经</a>在TeamCity Web服务器中<a href="how-to.html#Configure-HTTPS-for-TeamCity-Web-UI">配置了HTTPS</a> 。最常见和推荐的方法是设置一个反向代理服务器，例如Nginx或Apache，它为仅HTTP的TeamCity服务器的Tomcat端口提供HTTPS访问。在设置中，请确保“反向代理”具有“ <a href="how-to.html#Set-Up-TeamCity-behind-a-Proxy-Server">代理服务器”</a>部分<a href="how-to.html#Set-Up-TeamCity-behind-a-Proxy-Server">后面的“设置TeamCity”的</a>正确配置。</p><a name="AccessingtheserverviaHTTPS"></a><a name="Accessing-the-server-via-HTTPS"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-AccessingtheserverviaHTTPS">通过HTTPS访问服务器</h2><p id="bea911d5"><b id="ae598c2e">如果您的证书有效</b> （即由知名证书颁发机构，如Verisign签署），则TeamCity客户端应使用HTTPS进行任何其他配置。您要做的就是使用<code class="code">https://</code>链接到TeamCity服务器，而不是<code class="code">http://</code> 。</p><p id="07a8f035"><b id="b08a2ee5">如果您的证书无效（是自签名的）：（</b>即未由已知的证书颁发机构签名，并且可能导致“ PKIX路径构建失败：sun.security.provider.certpath。SunCertPathBuilderException：无法找到到请求目标的有效证书路径”错误消息）</p><ul class="list _ul"><li class="list__item" id="9a47ce91"><p>要从TeamCity <a href="visual-studio-addin.html">Visual Studio插件</a>和<a href="windows-tray-notifier.html">Windows托盘通知程序</a>启用HTTPS连接，请使用以下命令将Internet Explorer指向TeamCity服务器<code class="code">https://</code> URL并将服务器证书导入浏览器。在那之后，Visual Studio插件和Windows托盘通知程序应该能够通过HTTPS连接。</p></li><li class="list__item" id="1ad0a73b"><p>要启用来自Java客户端（TeamCity代理，IntelliJ IDEA，Eclipse等）的HTTPS连接，请参阅以下<a href="#Configuring-JVM">部分</a> ，配置连接应用程序使用的JVM安装。</p></li></ul></div><a name="ConfiguringJVM"></a><a name="Configuring-JVM"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-ConfiguringJVM">配置JVM</h2><a name="ConfiguringclientJVMfortrustingservercertificate"></a><a name="Configuring-client-JVM-for-trusting-server-certificate"></a><div class="chapter"><h3 id="UsingHTTPStoaccessTeamCityserver-ConfiguringclientJVMfortrustingservercertificate">配置客户端JVM以信任服务器证书</h3><p id="88460e4f"><b id="154193fa">如果您的证书有效</b> （也就是说，它是有问题的，并由知名证书颁发机构（如Verisign）签名），则Java客户端应使用HTTPS且无需任何其他配置。要使用“让我们加密”颁发的证书，请确保将客户端使用的JVM升级到最新版本。</p><p id="c3a87163"><b id="cf3b0519">如果您的证书无效（具有自签名）：</b></p><p id="d02ea584">要启用来自Java客户端的HTTPS连接，您需要将服务器证书（或服务器证书所签署的组织证书）作为受信任证书安装到JVM中。这些是通用Java应用程序步骤（不是特定于TeamCity）：</p><ul class="list _ul"><li class="list__item" id="21e1aa1f"><p>将服务器证书的CA Root证书以一种<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html#keytool_option_importcert" rel="noopener noreferrer" data-external="true" target="_blank">受支持的格式</a>保存到一个文件中（该文件<cert file="">如下所示）。这可以在浏览器中通过检查证书数据并将其导出为Base64编码的X.509证书来完成。</cert></p></li><li class="list__item" id="a8407607"><p>找到该流程使用的JRE。获取正确的Java安装路径的最佳方法是查找正在运行的进程的命令行。*如果已安装JDK（例如IntelliJ IDEA）， <path to="" jre="" installation="">则应为<path to="" used="" jdk="">/ jre</path></path></p></li><li class="list__item" id="1208b822"><p>对于Windows下安装的TeamCity代理或服务器，默认位置为<path to="" jre="" installation=""><teamcity installation="" path="">/ jre</teamcity></path></p></li><li class="list__item" id="07e2108d"><p>使用JVM将服务器证书导入默认的JRE安装密钥库<code class="code">keytool</code>工具：</p></li></ul><div class="code-block" data-lang="none">keytool -importcert-文件<cert file="">-keystore <path to="" jre="" installation="">/ lib / security / cacerts</path></cert></div><p id="3b201ab4">默认情况下，Java密钥库受密码“ <code class="code">changeit</code> “，您需要在提示符下输入</p><ul class="list _ul"><li class="list__item" id="9167e1d3"><p>重新启动JVM</p></li></ul></div><a name="ConfiguringJVMforauthenticationwithclientcertificate"></a><a name="Configuring-JVM-for-authentication-with-client-certificate"></a><div class="chapter"><h3 id="UsingHTTPStoaccessTeamCityserver-ConfiguringJVMforauthenticationwithclientcertificate">配置JVM以使用客户端证书进行身份验证</h3><p id="174b1f9f">如果已在TeamCity服务器之前基于客户端证书实现了自定义身份验证，则需要使JVM客户端使用其证书正确进行身份验证。</p><p id="6ccfde00"><b id="cd1eb194">导入客户证书</b></p><p id="bd28f391">如果您需要使用客户端证书通过https访问服务器（例如，从IntelliJ IDEA，Eclipse或构建代理），则需要将该证书添加到Java密钥库中，并将密钥库提供给Java密钥库所使用的JVM。连接过程。</p><p id="093da459">1。如果您的证书位于<b id="052136b3">p12</b>文件中，则可以使用以下命令将其转换为Java密钥库。确保您使用<code class="code">keytool</code>从JDK 1.6-1.8开始：早期版本可能不理解p12格式。</p><div class="code-block" data-lang="none">keytool -importkeystore -srckeystore <path to="" your="" .p12="" certificate="">-srcstoretype PKCS12 -srcstorepass <password of="" your="" p12="" certificate="">-destkeystore <path to="" keystore="" file="">-deststorepass <keystore password="">-destkeypass <keystore password="">-srcalias 1</keystore></keystore></path></password></path></div><p id="020fc2ee">此命令从您的.p12文件中提取别名为“ 1”的证书，并将其添加到Java密钥库中，您应该知道<path to="" your="" .p12="" certificate="">并且<password of="" your="" p12="" certificate="">可以为<path to="" keystore="" file="">和</path>提供新值<path to="" keystore="" file=""><keystore password="">。</keystore></path></password></path></p><p id="9c3379b3">这里， <code class="code">keypass</code>应该等于<code class="code">storepass</code>因为只有<code class="code">storepass</code>提供给JVM，如果<code class="code">keypass</code>有所不同，可能会出现以下错误：“ java.security。NoSuchAlgorithmException：构造实现时出错（算法：默认，提供程序：SunJSSE，类：com.sun.net.ssl.internal.ssl。DefaultSSLContextImpl）”。</p><p id="18196472"><b id="24ed63ba">导入根证书以组织信任链</b></p><p id="ed70065f">如果您的证书不是由受信任的权威机构签名的，则还需要将证书链中的根证书添加到受信任的密钥库中，并将此受信任的密钥库提供给JVM。</p><p id="b17968aa">2。您应该首先从证书中提取根证书。如果已安装证书，则可以从Web浏览器执行此操作，也可以使用<a href="http://openssl.org/" rel="noopener noreferrer" data-external="true" target="_blank">OpenSSL</a>工具使用以下命令执行此操作：</p><div class="code-block" data-lang="none">openssl.exe PKCS12 -in <path to="" your="" .p12="" certificate="">退房手续<path to="" your="" certificate="" in="" .pem="" format="">

</path></path></div><p id="5c976658">你应该知道<code class="code"><path to your .p12 certificate></code>及其密码（在出现提示时输入密码）。<path to="" your="" certificate="" in="" .pem="" format="">出现提示时，</path>您应该<path to="" your="" certificate="" in="" .pem="" format="">为pem密码短语</path>指定新的值<path to="" your="" certificate="" in="" .pem="" format="">。</path></p><p id="60980ae8">3。然后，您应该将Pem文件（具有文本格式）中的根证书（根证书应具有相同的颁发者和主题字段）提取到单独的文件中。该文件应如下所示：</p><div class="code-block" data-lang="none">----- BEGIN证书----- MIIGUjCCBDqgAwIBAgIEAKmKxzANBgkqhkiG9w0BAQQFADBwMRUwEwYDVQQDEwxK ...-----结束证书-----</div><p id="1a29a4d6">假设其名称为<path to="" root="" certificate="">。</path></p><p id="897b1a82">4。现在，使用以下命令将根证书导入到受信任的密钥库中：</p><div class="code-block" data-lang="none">keytool -importcert -trustcacerts-文件<path to="" root="" certificate="">-keystore <path to="" trust="" keystore="" file="">-storepass <trust keystore="" password="">

</trust></path></path></div><p id="5e9a22c3">在这里，您可以使用和的新值<trust keystore="" path=""><trust keystore="" password="">（或使用现有的信任密钥库）。</trust></trust></p><aside class="note " rel="5e9a22c3" id="4d8d1524" data-title=""><p id="a02206fb">在某些情况下，如果<b id="08759783">Windows代理</b>具有以下<i id="fa9517b2">问题</i> ，则TeamCity构建可能会因“ <i id="fa9517b2">SSL证书问题：无法获取本地发行者证书</i> ”错误而失败。 <b id="d1bab6f8"><code class="code">curl</code></b>库已安装。如果当前构建配置的VCS根目录仅使用自签名证书而不是根证书，则会发生这种情况。要解决此问题，请同时上传<a href="#Configuring-JVM-for-authentication-with-client-certificate">根证书</a> 。</p></aside><p id="cb6ee98d"><b id="f321e008">启动连接的应用程序JVM</b></p><p id="2816c040">现在，您需要在运行应用程序时将以下参数传递给JVM：</p><div class="code-block" data-lang="none">-Djavax.net.ssl.keyStore = <path to="" keystore="" file="">-Djavax.net.ssl.keyStorePassword = <keystore password="">-Djavax.net.ssl.trustStore = <path to="" trust="" keystore="" file="">-Djavax.net.ssl.trustStorePassword = <trust keystore="" password="">

</trust></path></keystore></path></div><p id="eb504ad1">对于IntelliJ IDEA，您可以将这些行添加到<code class="code">bin\idea.exe.vmoptions</code>文件（每行一个选项）。对于TeamCity构建代理，请参阅<a href="configuring-build-agent-startup-properties.html">代理启动属性</a> 。</p></div></div><a name="Usefultoolsinanalyzingcertificatesissues"></a><a name="Useful-tools-in-analyzing-certificates-issues"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-Usefultoolsinanalyzingcertificatesissues">分析证书问题的有用工具</h2><p id="4be1baf9">在线HTTPS服务器配置分析： <a href="https://www.ssllabs.com/ssltest/analyze.html" rel="noopener noreferrer" data-external="true" target="_blank">https:</a> <a href="https://gist.github.com/4ndrej/4547029" rel="noopener noreferrer" data-external="true" target="_blank">//www.ssllabs.com/ssltest/analyze.html SSLPoke</a> Java类</p><hr id="aedbf8fe"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>