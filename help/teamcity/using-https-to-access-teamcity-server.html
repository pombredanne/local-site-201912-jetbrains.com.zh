<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Using HTTPS to access TeamCity server - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Using HTTPS to access TeamCity server" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/teamcity-configuration-and-maintenance.md|TeamCity Configuration and Maintenance/using-https-to-access-teamcity-server.md|Using HTTPS to access TeamCity server" data-main-title="Using HTTPS to access TeamCity server" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/using-https-to-access-teamcity-server.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Using HTTPS to access TeamCity server" id="using-https-to-access-teamcity-server.md">Using HTTPS to access TeamCity server</h1><p id="7b1a3527">On this page:</p><p id="b13506a3"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-AccessingtheserverviaHTTPS">Accessing the server via HTTPS</a></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringJVM">Configuring JVM</a><ul class="list _bullet"><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringclientJVMfortrustingservercertificate">Configuring client JVM for trusting server certificate</a></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-ConfiguringJVMforauthenticationwithclientcertificate">Configuring JVM for authentication with client certificate</a></li></ul></li><li class="list__item"><a href="#UsingHTTPStoaccessTeamCityserver-Usefultoolsinanalyzingcertificatesissues">Useful tools in analyzing certificates issues</a></li></ul></p><p id="c3a0c0ab">This document describes how to configure Java applications to use HTTPS for communicating with the server.</p><aside class="note " data-title="" rel="c3a0c0ab" id="6a7e2d88"><p id="a4377d70">If you need to connect the TeamCity server to a service behind a self-signed certificate (for example, Git) or if you need to connect a TeamCity agent to the TeamCity server using the self-signed certificate, use <a href="uploading-ssl-certificates.html">trusted certificates configuration</a>.</p></aside><p id="a2825fc2">We assume that you have <a href="how-to.html#Configure-HTTPS-for-TeamCity-Web-UI">already configured HTTPS</a> in your TeamCity web server. The most common and recommended approach for this is to set up a reverse proxy server like Nginx or Apache that provides HTTPS access for HTTP-only TeamCity server's Tomcat port. In the setup make sure that the reverse proxy has correct configuration as per <a href="how-to.html#Set-Up-TeamCity-behind-a-Proxy-Server">Set Up TeamCity behind a Proxy Server</a> section.</p><a name="AccessingtheserverviaHTTPS"></a><a name="Accessing-the-server-via-HTTPS"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-AccessingtheserverviaHTTPS">Accessing the server via HTTPS</h2><p id="bea911d5"><b id="ae598c2e">If your certificate is valid</b> (i.e. it was signed by a well known Certificate Authority like Verisign), then TeamCity clients should work with HTTPS without any additional configuration. All you have to do is use <code class="code">https://</code> links to the TeamCity server instead of <code class="code">http://</code>.</p><p id="07a8f035"><b id="b08a2ee5">If your certificate is not valid (is self-signed):</b> (i.e. is not signed by a known Certificate Authority and likely to result in "PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target" error message)</p><ul class="list _ul"><li class="list__item" id="9a47ce91"><p>To enable HTTPS connections from the TeamCity <a href="visual-studio-addin.html">Visual Studio Addin</a> and <a href="windows-tray-notifier.html">Windows Tray Notifier</a>, point your Internet Explorer to the TeamCity server using <code class="code">https://</code> URL and import the server certificate into the browser. After that, the Visual Studio Addin and Windows Tray Notifier should be able to connect by HTTPS.</p></li><li class="list__item" id="1ad0a73b"><p>To enable HTTPS connections from Java clients (TeamCity Agents, IntelliJ IDEA, Eclipse, and so on), see the <a href="#Configuring-JVM">section below</a> for configuring the JVM installation used by the connecting application.</p></li></ul></div><a name="ConfiguringJVM"></a><a name="Configuring-JVM"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-ConfiguringJVM">Configuring JVM</h2><a name="ConfiguringclientJVMfortrustingservercertificate"></a><a name="Configuring-client-JVM-for-trusting-server-certificate"></a><div class="chapter"><h3 id="UsingHTTPStoaccessTeamCityserver-ConfiguringclientJVMfortrustingservercertificate">Configuring client JVM for trusting server certificate</h3><p id="88460e4f"><b id="154193fa">If your certificate is valid</b> (that is it was issues and signed by a well-known Certificate Authority like Verisign), then the Java clients should work with HTTPS without any additional configuration. To use Let's Encrypt-issued certificates, make sure to upgrade the JVM used by the client to the latest.</p><p id="c3a87163"><b id="cf3b0519">If your certificate is not valid (is self-signed):</b></p><p id="d02ea584">To enable HTTPS connections from Java clients, you need to install the server certificate (or your organization's certificate the server's certificate is signed by) into the JVM as a trusted certificate. These are generic Java application steps (not TeamCity-specific):</p><ul class="list _ul"><li class="list__item" id="21e1aa1f"><p>save the CA Root certificate of the server's certificate to a file in one of the <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html#keytool_option_importcert" data-external="true" target="_blank" rel="noopener noreferrer">supported formats</a> (the file is referred as &lt;cert file&gt; below). This can be done in a browser by inspecting certificate data and exporting it as Base64 encoded X.509 certificate.</p></li><li class="list__item" id="a8407607"><p>locate the JRE used by the process. The best way to get the path to the proper Java installation is to look up the command line of the running process. * If there is a JDK installed (like for IntelliJ IDEA), &lt;path to JRE installation&gt; should be &lt;path to used JDK&gt;/jre</p></li><li class="list__item" id="1208b822"><p>For TeamCity agent or server installed under Windows, the default location for &lt;path to JRE installation&gt; is &lt;TeamCity installation path&gt;/jre</p></li><li class="list__item" id="07e2108d"><p>import the server certificate into the default JRE installation keystore using JVM's <code class="code">keytool</code> tool:</p></li></ul><div class="code-block" data-lang="none">keytool -importcert -file &lt;cert file&gt; -keystore &lt;path to JRE installation&gt;/lib/security/cacerts

</div><p id="3b201ab4">By default, Java keystore is protected by password "<code class="code">changeit</code>" which you need to type on prompt</p><ul class="list _ul"><li class="list__item" id="9167e1d3"><p>restart the JVM</p></li></ul></div><a name="ConfiguringJVMforauthenticationwithclientcertificate"></a><a name="Configuring-JVM-for-authentication-with-client-certificate"></a><div class="chapter"><h3 id="UsingHTTPStoaccessTeamCityserver-ConfiguringJVMforauthenticationwithclientcertificate">Configuring JVM for authentication with client certificate</h3><p id="174b1f9f">If you have implemented a custom authentication based on client certificates in front of TeamCity server, you will need to make the JVM clients correctly authenticate with their certificate.</p><p id="6ccfde00"><b id="cd1eb194">Importing client certificate</b></p><p id="bd28f391">If you need to use a client certificate to access a server via https (for example, from IntelliJ IDEA, Eclipse or the build agents), you will need to add the certificate to the Java keystore and supply the keystore to the JVM used by the connecting process.</p><p id="093da459">1. If you have your certificate in a <b id="052136b3">p12</b> file, you can use the following command to convert it to a Java keystore. Make sure you use <code class="code">keytool</code> from JDK 1.6-1.8: earlier versions may not understand p12 format.</p><div class="code-block" data-lang="none">keytool -importkeystore -srckeystore &lt;path to your .p12 certificate&gt; -srcstoretype PKCS12 -srcstorepass &lt;password of your p12 certificate&gt; -destkeystore &lt;path to keystore file&gt;&nbsp; -deststorepass &lt;keystore password&gt; -destkeypass &lt;keystore password&gt; -srcalias 1

</div><p id="020fc2ee">This commands extracts the certificate with the alias "1" from your .p12 file and adds it to Java keystore You should know &lt;path to your .p12 certificate&gt; and &lt;password of your p12 certificate&gt; and you can provide new values for &lt;path to keystore file&gt; and &lt;keystore password&gt;.</p><p id="9c3379b3">Here, <code class="code">keypass</code> should be equal to <code class="code">storepass</code> because only <code class="code">storepass</code> is supplied to the JVM, and if <code class="code">keypass</code> is different, the following error may accur: "java.security.NoSuchAlgorithmException: Error constructing implementation (algorithm: Default, provider: SunJSSE, class: com.sun.net.ssl.internal.ssl.DefaultSSLContextImpl)".</p><p id="18196472"><b id="24ed63ba">Importing root certificate to organize a chain of trust</b></p><p id="ed70065f">If your certificate is not signed by a trusted authority, you will also need to add the root certificate from your certificate chain to a trusted keystore and supply this trusted keystore to JVM.</p><p id="b17968aa">2. You should first extract the root certificate from your certificate. You can do this from a web browser if you have the certificate installed, or you can do this with the <a href="http://openssl.org/" data-external="true" target="_blank" rel="noopener noreferrer">OpenSSL</a> tool using the command:</p><div class="code-block" data-lang="none">openssl.exe pkcs12 -in &lt;path to your .p12 certificate&gt; -out &lt;path to your certificate in .pem format&gt;

</div><p id="5c976658">You should know <code class="code">&lt;path to your .p12 certificate&gt;</code> and its password (to enter it when prompted). You should specify new values for &lt;path to your certificate in .pem format&gt; and for the pem pass phrase when prompted.</p><p id="60980ae8">3. Then you should extract the root certificate (the root certificate should have the same issuer and subject fields) from the pem file (it has text format) to a separate file. The file should look like:</p><div class="code-block" data-lang="none">-----BEGIN CERTIFICATE-----
MIIGUjCCBDqgAwIBAgIEAKmKxzANBgkqhkiG9w0BAQQFADBwMRUwEwYDVQQDEwxK
...
-----END CERTIFICATE-----

</div><p id="1a29a4d6">Let's assume its name is &lt;path to root certificate&gt;.</p><p id="897b1a82">4. Now import the root certificate to the trusted keystore with the command:</p><div class="code-block" data-lang="none">keytool -importcert -trustcacerts -file &lt;path to root certificate&gt; -keystore &lt;path to trust keystore file&gt; -storepass &lt;trust keystore password&gt;

</div><p id="5e9a22c3">Here you can use new values for &lt;trust keystore path&gt; and &lt;trust keystore password&gt; (or use existing trust keystore).</p><aside class="note " data-title="" rel="5e9a22c3" id="4d8d1524"><p id="a02206fb">In some scenarios, TeamCity builds may fail with the "<i id="fa9517b2">SSL certificate problem: unable to get local issuer certificate</i>" error <b id="08759783">on Windows agents</b> if they have the <b id="d1bab6f8"><code class="code">curl</code></b> library installed. This happens if only a self-signed certificate, but not a root certificate, is used by a VCS root of the current build configuration. To solve the problem, upload the <a href="#Configuring-JVM-for-authentication-with-client-certificate">root certificate</a> as well.</p></aside><p id="cb6ee98d"><b id="f321e008">Starting the connecting application JVM</b></p><p id="2816c040">Now you need to pass the following parameters to the JVM when running the application:</p><div class="code-block" data-lang="none">-Djavax.net.ssl.keyStore=&lt;path to keystore file&gt;
-Djavax.net.ssl.keyStorePassword=&lt;keystore password&gt;
-Djavax.net.ssl.trustStore=&lt;path to trust keystore file&gt;
-Djavax.net.ssl.trustStorePassword=&lt;trust keystore password&gt;

</div><p id="eb504ad1">For IntelliJ IDEA, you can add the lines into the <code class="code">bin\idea.exe.vmoptions</code> file (one option per line). For the TeamCity build agent, see <a href="configuring-build-agent-startup-properties.html">agent startup properties</a>.</p></div></div><a name="Usefultoolsinanalyzingcertificatesissues"></a><a name="Useful-tools-in-analyzing-certificates-issues"></a><div class="chapter"><h2 id="UsingHTTPStoaccessTeamCityserver-Usefultoolsinanalyzingcertificatesissues">Useful tools in analyzing certificates issues</h2><p id="4be1baf9">Online HTTPS server configuration analysis: <a href="https://www.ssllabs.com/ssltest/analyze.html" data-external="true" target="_blank" rel="noopener noreferrer">https://www.ssllabs.com/ssltest/analyze.html</a><a href="https://gist.github.com/4ndrej/4547029" data-external="true" target="_blank" rel="noopener noreferrer">SSLPoke</a> Java class</p><hr id="aedbf8fe"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>