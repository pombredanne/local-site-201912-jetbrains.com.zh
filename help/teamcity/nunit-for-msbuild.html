<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>NUnit for MSBuild-帮助|帮助团队城市</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="NUnit for MSBuild" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-unit-testing-and-code-coverage.md|Configuring Unit Testing and Code Coverage/net-testing-frameworks-support.md|.NET Testing Frameworks Support/nunit-support.md|NUnit Support/nunit-for-msbuild.md|NUnit for MSBuild" data-main-title="NUnit for MSBuild" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/nunit-for-msbuild.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="nunit-for-msbuild.md" data-toc="NUnit for MSBuild">用于MSBuild的NUnit</h1><p id="b03a6712">本页介绍如何使用MS build中的NUnit。</p><ul class="list _ul"><li class="list__item" id="be417515"><p>对于<b id="986e9ebc">3.0之前</b>的<b id="986e9ebc">NUnit，</b>请参阅<a href="#Working-with-NUnit-Task-in-MSBuild-Build">使用TeamCity提供的NUnit任务</a></p></li><li class="list__item" id="e478a43b"><p>对于<b id="ae6b2b61">NUnit 3.0及更高版本，</b>请参阅<a href="#Working-with-NUnit-3.0">使用NUnit 3.0</a></p></li></ul><a name="WorkingwithNUnitTaskinMSBuildBuild"></a><a name="Working-with-NUnit-Task-in-MSBuild-Build"></a><div class="chapter"><h2 id="NUnitforMSBuild-WorkingwithNUnitTaskinMSBuildBuild">在MSBuild构建中使用NUnit任务</h2><p id="35b260e6">如果您使用的<b id="1a88ac56">是版本3.0之前的NUnit</b> ，则本节中的信息适用。对于更高版本，请参阅以下<a href="#Working-with-NUnit-3.0">部分</a> 。</p><p id="909f6fdc">本节假定您已经拥有一个MSBuild构建脚本，其中包含已配置的<code class="code">NUnit</code>任务，并希望TeamCity跟踪测试报告，而不对现有的构建脚本进行任何更改。否则，请考虑将<a href="nunit.html">NUnit构建运行器</a>添加为构建配置的步骤之一。</p><a name="UsingNUnitTeamCitytaskinMSBuildBuildScript"></a><a name="Using-NUnitTeamCity-task-in-MSBuild-Build-Script"></a><div class="chapter"><h3 id="NUnitforMSBuild-UsingNUnitTeamCitytaskinMSBuildBuildScript">在MSBuild构建脚本中使用NUnitTeamCity任务</h3><p id="9cc3046b">TeamCity提供自定义<code class="code">NUnitTeamCity</code>任务与<code class="code">NUnit</code> <a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">MSBuild社区任务</a>项目中的<a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">任务</a> 。如果您提供<code class="code">NUnitTeamCity</code>在构建脚本中执行任务时，TeamCity将根据任务中指定的选项启动自己的测试运行程序。因此，您不需要任何NUnit运行程序，因为TeamCity将运行测试。</p><p id="bb091203">为了正确使用<code class="code">NUnitTeamCity</code>任务，请执行以下步骤：</p><ol class="list _decimal"><li class="list__item" id="ebbec700"><p>确保<code class="code">teamcity_dotnet_nunitlauncher</code>在构建代理程序上可以访问系统属性。运行Windows的生成代理应自动将这些属性检测为环境变量。如果需要手动设置它们，请参阅定义<a href="project-and-agent-level-build-parameters.html#Agent-Level-Build-Parameters">特定</a>于<a href="project-and-agent-level-build-parameters.html#Agent-Level-Build-Parameters">代理的</a>属性以获取更多信息。</p></li><li class="list__item" id="e2a30afb"><p>使用以下命令配置您的MSBuild构建脚本<code class="code">NUnitTeamCity</code>任务使用以下语法：</p><div class="code-block" data-lang="markup"><usingtask taskname="NUnitTeamCity" assemblyfile="$(teamcity_dotnet_nunitlauncher_msbuild_task)"></usingtask>

<nunitteamcity assemblies="@(assemblies_to_test)"></nunitteamcity>

</div><p></p></li></ol><p id="ecde033c">的<code class="code">NUnitTeamCity</code>任务支持以下属性：</p><div class="table-wrapper"><table width="100%" id="7156d1be"><thead><tr id="930f19c0" class="ijRowHead"><th width="200" id="8db399ff"><p id="364421b5">属性</p></th><th id="ed9842b4"><p id="6fa9958c">描述</p></th></tr></thead><tbody><tr id="19c55547" class="ijRowOdd"><td id="ffc10097"><p id="8b16b03c"><code class="code">Platform</code></p></td><td id="fa2fe6c5"><p id="cf2321d6">x64计算机上的执行模式。支持的值为： <b id="318ef710">x86</b> ， <b id="4855d467">x64</b>和<b id="163127e9">ANY</b> 。</p></td></tr><tr id="7b5dc14a" class="ijRowEven"><td id="7a57357d"><p id="905f288d"><code class="code">RuntimeVersion</code></p></td><td id="c413ea80"><p id="6f5999fa">要使用的.NET Framework： <b id="c7967528">v1.1</b> ， <b id="50f6a6b3">v2.0</b> ， <b id="146a005c">v4.0</b> ， <b id="16c780a0">ANY</b> 。默认情况下，使用MSBuild运行时。对于MSBuild 2.0和3.5，默认值为<b id="193bf69a">v2.0</b> 。对于MSBuild 4.0，默认值为<b id="3bdac802">v4.0</b> 。</p></td></tr><tr id="001a6be5" class="ijRowOdd"><td id="b1d81035"><p id="d6e2e1eb"><code class="code">IncludeCategory</code></p></td><td id="541b5ebe"><p id="8ffa4c81">如在<code class="code">NUnit</code> <a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">MSBuild社区任务</a>项目中的<a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">任务</a> 。</p></td></tr><tr id="7248dd62" class="ijRowEven"><td id="21301c27"><p id="b0d84ce9"><code class="code">ExcludeCategory</code></p></td><td id="d139116f"><p id="80d235f2">如在<code class="code">NUnit</code> <a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">MSBuild社区任务</a>项目中的<a href="http://msbuildtasks.tigris.org/" rel="noopener noreferrer" data-external="true" target="_blank">任务</a> 。</p></td></tr><tr id="3fe91d50" class="ijRowOdd"><td id="a4065b47"><p id="579a97db"><code class="code">NUnitVersion</code></p></td><td id="22a6b791"><p id="e8e09dbf">用于运行测试的NUnit版本。支持NUnit的版本<b id="ca941792"><b id="52e73611"><b id="d9669488"><b id="427553db"><b id="72b1f041"><b id="cfb378e6"><b id="ea62051f"><b id="29febc6b"><b id="9da62e20"><b id="21c4832d"><b id="3792b922"><b id="95edc374">：2.2.10，2.4.1，2.4.6，2.4.7，2.4.8，2.5.0，2.5.2，2.5.3，2.5.4，2.5.5，2.5.6，2.5。</b></b></b></b></b></b></b></b></b></b></b> <b id="af0067b9"><b id="97875fba"><b id="0a510b44"><b id="749fd1f0"><b id="91e609be"><b id="9d65b8fa"><b id="05c11690">7，2.5.8，2.5.9，2.5.10，2.6.0，2.6.1，2.6.2，2.6.3。</b></b></b></b></b></b></b></b>例如， <code class="code">NUnit-2.2.10</code> 。</p><p id="cdfefe53">要使用NUnit 3.0及更高版本，请参见以下<a href="#Working-with-NUnit-3.0">部分</a> 。</p></td></tr><tr id="ea0d70ae" class="ijRowEven"><td id="294e3d20"><p id="de0d1a5b"><code class="code">Addins</code></p></td><td id="5fb82fd5"><p id="842228b4">要使用的第三方NUnit插件列表。有关使用NUnit插件的更多信息，请参阅<a href="nunit-addins-support.html">NUnit插件支持</a>页面。</p></td></tr><tr id="bbb48c2b" class="ijRowOdd"><td id="bad87667"><p id="3f8e91af"><code class="code">HaltIfTestFailed</code></p></td><td id="43503853"><p id="e5c5339b">如果任何测试失败，则为“ <b id="971cff63">真</b>至失败”任务。</p></td></tr><tr id="324d613c" class="ijRowEven"><td id="3664d34f"><p id="32b71d46"><code class="code">Assemblies</code></p></td><td id="22a8fd67"><p id="7ed9cbcd">用于运行测试的程序集列表。</p></td></tr><tr id="74574e63" class="ijRowOdd"><td id="070e6b52"><p id="ebaf4859"><code class="code">RunProcessPerAssembly</code></p></td><td id="ecfb781f"><p id="a0113d0c">如果要在新进程中运行每个程序集，请设置<b id="b5585e33">true</b> 。</p></td></tr></tbody></table></div><p id="ed1aa333">自定义TeamCity <code class="code">NUnit</code>任务还支持其他属性。有关可用属性的列表，请参阅<a href="#Using-NUnitTeamCity-task-in-MSBuild-Build-Script">本节</a> 。</p><p id="0a91ffab">如果您需要TeamCity测试运行程序来支持第三方NUnit插件，请参阅“ <a href="nunit-addins-support.html">NUnit插件支持”</a>部分以获取详细信息。</p><p id="5f5c6271">示例（MSBuild构建脚本的一部分）：</p><div class="code-block" data-lang="markup"><project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <usingtask taskname="NUnitTeamCity" assemblyfile="$(teamcity_dotnet_nunitlauncher_msbuild_task)"></usingtask>
 
  <target name="SayHello">
     <nunitteamcity assemblies="!!!*put here item group of assemblies to run tests on*!!!"></nunitteamcity>
  </target>
</project>

</div><p id="39f5da63"><b id="f614801f">重要笔记</b></p><ul class="list _ul"><li class="list__item" id="4b3b64b8"><p>请务必更换“ <code class="code">.</code> “与” <code class="code">_</code>在MSBuild脚本中<a href="configuring-build-parameters.html#Using-Build-Parameters-in-the-Build-Scripts">使用“系统属性</a> ”时。例如使用<code class="code">teamcity_dotnet_nunitlauncher_msbuild_task</code>代替<code class="code">teamcity.dotnet.nunitlauncher.msbuild.task</code> 。</p></li><li class="list__item" id="7663794e"><p>TeamCity还为Microsoft Visual Studio 2005及更高版本的解决方案文件提供了<a href="visual-studio-sln.html">Visual Studio Solution Runner</a> 。它允许您使用MSBuild样式的通配符对程序集进行单元测试。</p></li></ul></div><a name="Examples"></a><a name="Examples"></a><div class="chapter"><h3 id="NUnitforMSBuild-Examples">例子</h3><p id="238979fe">使用特定的NUnit运行器版本运行NUnit测试：</p><div class="code-block" data-lang="markup"><target name="build_01">
     <!-- start tests for NUnit-2.2.10 -->
     <nunitteamcity assemblies="@(TestAssembly)" nunitversion="NUnit-2.2.10"></nunitteamcity>
 
     <!-- start tests for NUnit-2.4.6 -->
     <nunitteamcity assemblies="@(TestAssembly)" nunitversion="NUnit-2.4.8"></nunitteamcity>
  </target>

</div><p id="d1779a0e">使用带有NUnit 2.4.6的自定义插件运行NUnit测试：</p><div class="code-block" data-lang="markup"><target name="build">
     <nunitteamcity assemblies="@(TestAssembly)" addins="NUnitExtension.RowTest.AddIn.dll" nunitversion="NUnit-2.4.6"></nunitteamcity>
  </target>

</div><p id="e049e04a"><b id="039aca43">在每个组合件模式下，</b>使用带有NUnit 2.4.6的自定义加载项运行NUnit测试<b id="039aca43">：</b></p><div class="code-block" data-lang="markup"><target name="build">
     <nunitteamcity assemblies="@(TestAssembly)" addins="NUnitExtension.RowTest.AddIn.dll" nunitversion="NUnit-2.4.6" runprocessperassembly="True"></nunitteamcity>
</target>

</div><p id="a8cb36d2">要制作TeamCity独立构建脚本，请考虑以下技巧：</p><div class="code-block" data-lang="markup"><nunitteamcity ...="" condition=" '$(TEAMCITY_VERSION)' != '' "></nunitteamcity>

</div><p id="5c549637">MSBuild属性<code class="code">TEAMCITY_VERSION</code>从TeamCity启动时将被添加到msbuild。</p></div></div><a name="WorkingwithNUnit3.0"></a><a name="Working-with-NUnit-3.0"></a><div class="chapter"><h2 id="NUnitforMSBuild-WorkingwithNUnit3.0">使用NUnit 3.0</h2><p id="c456f4e1">如果您使用的是NUnit 3.0及更高版本，则本节中的信息适用。对于NUnit的早期版本，请参考<a href="#Working-with-NUnit-Task-in-MSBuild-Build">以上部分</a> 。</p><p id="c1336175">从3.0版开始，NUnit本身就支持TeamCity，因此无需对MSBuild使用特殊任务，就像对<a href="#Working-with-NUnit-Task-in-MSBuild-Build">早期NUnit版本</a>所做的<a href="#Working-with-NUnit-Task-in-MSBuild-Build">那样</a> 。最简单的方法是通过标准<a href="https://msdn.microsoft.com/en-us/library/x8zx72cd.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Exec任务</a>运行NUnit控制台。例如：</p><a name="msbuild-examples-nunit"></a><div class="code-block" data-lang="bash">
<!--?xml version="1.0" encoding="utf-8" ?=""-->
<project toolsversion="14.0" defaulttargets="RunTests" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
 <target name="RunTests">
  <exec ignoreexitcode="True" command="nunit3-console.exe Tests.dll">
 <output taskparameter="ExitCode" itemname="exitCode"></output>
  </exec>
 <error text="Error while running tests" condition="@(exitCode) < 0"></error>
  </target>
</project>

<!--?xml--></div><p id="95686222">NUnit控制台将失败测试的数量作为正退出代码返回，如果NUnit测试基础结构失败，则将其作为负退出代码返回。</p><p id="201d2b79">TeamCity控制测试执行进度，但是NUnit基础结构异常可能不允许TeamCity收集所需的信息。这就是为什么<code class="code">IgnoreExitCode="True"</code>需要设置属性，它将忽略正退出代码，并且不会由于几次失败的测试而中断构建。如果测试基础结构针对负退出代码出现错误，则<a href="https://msdn.microsoft.com/en-us/library/8b08t3s4.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Error</a>任务将停止构建。</p><p id="5a1f172f"></p><figure><img alt="构建步骤：MSBuild" title="构建步骤：MSBuild" src="/help/img/teamcity/2019.1/nunit-msbuild.png" id="ff434f33" width="830" height="1149"></figure><p></p><p id="af69275e">除了项目文件，您还可以定义MSBuild版本和目标平台，使用配置文件和其他设置。</p><aside class="note " rel="af69275e" id="3a9836f8" data-title=""><p id="a12b0a28">在这种情况下，MSBuild运行器选项“ <a href="msbuild.html#General-Build-Runner-Options">减少测试失败反馈时间”</a> <b id="80628f66">将无法立即使用</b> 。要使用此功能，请配置<a href="nunit.html">NUnit</a>构建步骤。</p></aside><p id="617d9685"><a href="getting-started-with-nunit.html">NUnit入门</a>包含详细信息和更多示例。</p><hr id="e208fd64"></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>