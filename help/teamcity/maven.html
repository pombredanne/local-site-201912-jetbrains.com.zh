<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Maven - Help | TeamCity</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body data-id="Maven" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/maven.md|Maven" data-main-title="Maven" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/maven.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search TeamCity Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Maven" id="maven.md">Maven</h1><p id="92b4f2d5">Note that you can create a new Maven-based build configuration <a href="creating-and-editing-projects.html#Creating-project-pointing-to-repository-URL">automatically from URL</a>, and set up a <a href="configuring-maven-triggers.html#Maven-Artifact-Dependency-Trigger">dependency build trigger</a>, if a specific Maven artifact has changed.</p><aside class="note " data-title="" rel="92b4f2d5" id="750c175a"><p id="37478d91"><b id="f7d9b649">Remote Run Limitations related to Maven runner</b><br>As a rule, a personal build in TeamCity doesn't affect any "regular" builds run on the TeamCity server, and its results are visible to its initiator only. However, in case of using Maven runner, this behavior may differ.<br>TeamCity doesn't interfere anyhow with the Maven dependencies model. Hence, if your Maven configuration deploys artifacts to a remote repository, <b id="d5ff07c3">they will be deployed there even if you run a personal build</b>. Thereby, a personal build may affect builds that depend on your configuration.<br>For example, you have a configuration A that deploys artifacts to a remote repository, and these artifacts are used by configuration B. When a personal build for A has finished, your personal artifacts will appear in B. This can be especially injurious, if configuration A is to produce release-version artifacts, because proper artifacts will be replaced with developer's ones, which will be hard to investigate because of Maven versioning model. Plus these artifacts will become available to all dependent builds, not only to those managed by TeamCity.<br>To avoid this, we recommend not using remote run for build configurations which perform deployment of artifacts.</p></aside><p id="34904a6a">On this page:</p><p id="487fa65d"><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Maven-Mavenrunnersettings">Maven runner settings</a><ul class="list _bullet"><li class="list__item"><a href="#Maven-MavenSettings">Maven Settings</a></li><li class="list__item"><a href="#Maven-UserSettings">User Settings</a></li><li class="list__item"><a href="#Maven-JavaParameters">Java Parameters</a></li><li class="list__item"><a href="#Maven-LocalArtifactRepositorySettings">Local Artifact Repository Settings</a></li><li class="list__item"><a href="#Maven-IncrementalBuilding">Incremental Building</a></li><li class="list__item"><a href="#Maven-DockerSettings">Docker Settings</a></li><li class="list__item"><a href="#Maven-CodeCoverage">Code Coverage</a></li></ul></li><li class="list__item"><a href="#Maven-MavenReleasewithDifferentVCSs">Maven Release with Different VCSs</a><ul class="list _bullet"><li class="list__item"><a href="#Maven-UsingMavenReleasewithPerforce">Using Maven Release with Perforce</a></li><li class="list__item"><a href="#Maven-UsingMavenReleasewithGitVCS">Using Maven Release with Git VCS</a></li></ul></li></ul></p><a name="Mavenrunnersettings"></a><a name="Maven-runner-settings"></a><div class="chapter"><h2 id="Maven-Mavenrunnersettings">Maven runner settings</h2><div class="table-wrapper"><table width="100%" id="f5b23547"><thead><tr id="b715754e" class="ijRowHead"><th id="2138188d"><p id="19144e59">Option</p></th><th id="3f1e1efa"><p id="5d5ce651">Description</p></th></tr></thead><tbody><tr id="282f6cbd" class="ijRowOdd"><td id="eed37c2e"><p id="a9805a32">Goals</p></td><td id="743c37d4"><p id="8735eccf">In the <b id="84222704">Goals</b> field, specify the sequence of space-separated Maven goals that you want TeamCity to execute.  Some Maven goals can use version control systems, and, thus, they may become incompatible with some <a href="configuring-vcs-settings.html">Configuring VCS Settings</a>. If you want TeamCity to execute such a goal:</p><ul class="list _ul"><li class="list__item" id="299f24d0"><p>Select "<i id="236e85e2">Automatically on agent</i>" in the <b id="ac22e2da"><a href="vcs-checkout-mode.html">VCS Checkout Mode</a></b> drop-down list on the <b id="36d76633">Version Control Settings</b> page. This makes the version control system available to the goal execution software. To use the <code class="code">release:prepare</code> goal with Perforce VCS, see the <a href="#Using-Maven-Release-with-Perforce">section</a> below.</p></li></ul></td></tr><tr id="2ccb8b99" class="ijRowEven"><td id="249283ef"><p id="f2543b26">Path to POM file</p></td><td id="d0f2c915"><p id="317842b7">Specify the path to the POM file relative to the <a href="build-working-directory.html">build working directory</a>.<br>By default, the property contains a <code class="code">pom.xml</code> file. If you leave this field blank, the same value is put in this field. The path may also point to a subdirectory, and as such <code class="code">&lt;subdirectory&gt;/pom.xml</code> is used.</p></td></tr><tr id="5ce1b1e9" class="ijRowOdd"><td id="78903704"><p id="a1528889">Additional Maven command line parameters</p></td><td id="e7cc07a6"><p id="37a1251a">Specify the list of command line parameters.</p><aside class="note " data-title="" rel="37a1251a" id="1ff6d42e"><p id="e6222d82">The following parameters are ignored: <code class="code">-q</code>, <code class="code">-f</code>, <code class="code">-s</code> (if <b id="4392c48c">User settings path</b> is provided)</p></aside></td></tr><tr id="a7345562" class="ijRowEven"><td id="b794c973"><p id="3ac2b66c">Working directory</p></td><td id="45072ab3"><p id="0669f08f">Specify the <a href="build-working-directory.html">Build Working Directory</a> if it differs from the <a href="build-checkout-directory.html">build checkout directory</a>.</p></td></tr></tbody></table></div><aside class="note " data-title="" rel="f5b23547" id="1adec2bc"><p id="023ca2b1">When TeamCity discovers a Maven build step automatically, it sets the goal automatically to <code class="code">clean test</code> and an additional Maven command line parameter <code class="code">-Dmaven.test.failure.ignore</code> to <code class="code">true</code> to ignore failed tests. This parameter is helpful when the <code class="code">test</code> goal is used for a Maven project with multiple modules. With this property set to <code class="code">true</code>, even if the tests fail in some module, all the following modules will be tested as well.<br>If you change the goal from <code class="code">test</code> to <code class="code">deploy</code> (or any other sequential goal from the Maven build lifecycle: <code class="code">package</code>, <code class="code">verify</code>, or <code class="code">install</code>), make sure to set <code class="code">-Dmaven.test.failure.ignore</code> to <code class="code">false</code> so the failed tests are not ignored.</p></aside><a name="MavenSettings"></a><a name="Maven-Settings"></a><div class="chapter"><h3 id="Maven-MavenSettings">Maven Settings</h3><p id="1200469a">Choose the Maven version you want to use. <b id="7b8d0c88">Since TeamCity 2017.1</b>, you can <a href="installing-agent-tools.html">manage the installed versions</a>.</p><div class="table-wrapper"><table width="100%" id="fd19c53e"><thead><tr id="1b73fb15" class="ijRowHead"><th id="761a8f33"></th><th id="cea65e9a"></th></tr></thead><tbody><tr id="e529535e" class="ijRowOdd"><td id="0d54337e"><p id="c46a9337">&lt;Auto&gt;</p></td><td id="4e78c8d1"><p id="837efc40">The path to Maven installation is taken from the <code class="code">M2_HOME</code> environment variable, otherwise the current default version is used.</p></td></tr><tr id="8768ace3" class="ijRowEven"><td id="37f479cc"><p id="7ccbb825">&lt;Default&gt;</p></td><td id="769710a4"><p id="bd6dd388">The bundled version 3.0.5 is used as default. <b id="6074baa4">Since TeamCity 2017.1</b>, you can <a href="installing-agent-tools.html">change the defaults</a>.</p></td></tr><tr id="17a3d77e" class="ijRowOdd"><td id="ea84dd22"><p id="24277c80">&lt;Custom&gt;</p></td><td id="da628a7e"><p id="137e6181">Provide a path to a custom Maven version.</p></td></tr></tbody></table></div></div><a name="UserSettings"></a><a name="User-Settings"></a><div class="chapter"><h3 id="Maven-UserSettings">User Settings</h3><p id="54cc7110">Specify what kind of user settings to use here. This is equivalent to the Maven command line option <code class="code">-s</code> or <code class="code">--settings</code>. The available options are:</p><div class="table-wrapper"><table width="100%" id="7295e982"><thead><tr id="78fcbf6a" class="ijRowHead"><th id="9d841c56"></th><th id="cc6f1c8c"></th></tr></thead><tbody><tr id="31699a51" class="ijRowOdd"><td id="622a3b01"><p id="0680fefd">&lt;Default&gt;</p></td><td id="4a0b90c3"><p id="4f7ff85a">Settings are taken from the default Maven locations on the agent. For the server logic, see <a href="maven-server-side-settings.html">Maven Server-Side Settings</a>.</p></td></tr><tr id="2eb15793" class="ijRowEven"><td id="212aef10"><p id="5db176a3">&lt;Custom&gt;</p></td><td id="23ae48e0"><p id="9e06f2c1">Enter the path to an alternative user settings file. The path should be valid on agent and also on the server, see <a href="maven-server-side-settings.html">Maven Server-Side Settings</a>.</p></td></tr><tr id="5e0bbd3c" class="ijRowOdd"><td id="47507b76"><p id="6fb0a2e2">Predefined settings</p></td><td id="3e8cffb3"><p id="4c9997e5">If there are settings files uploaded to the TeamCity server via the administration UI, you can select one of the available options here. To upload settings file to TeamCity, click <i id="1f312129">Manage settings files</i>.  Maven settings are defined on the project level. You can see the settings files defined in the current project or upload files on the <b id="d6e77292">Project Settings</b> page using <b id="e06880d1">Maven Settings</b>. The files will be available in the project and its subprojects. The uploaded files are stored in the &lt;TeamCity Data Directory&gt;/config/projects/%projectID%/pluginData/mavenSettings directory. If necessary, they can be edited right there. The uploaded files are used both for the agent and server-side Maven functionality.<br>If Custom or Predefined settings are used, the path to the effective user settings file is available inside the maven process as the <code class="code">teamcity.maven.userSettings.path</code> system property.</p></td></tr></tbody></table></div><a name="java-param"></a></div><a name="JavaParameters"></a><a name="Java-Parameters"></a><div class="chapter"><h3 id="Maven-JavaParameters">Java Parameters</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="ff050453"><thead><tr id="1d6a3847" class="ijRowHead"><th id="2f8d3b48"><p id="e602b1fc">Option</p></th><th id="cd802640"><p id="f08711a1">Description</p></th></tr></thead><tbody><tr id="2b44e850" class="ijRowOdd"><td id="092c9091"><p id="aa7f752b">JDK</p></td><td id="74cc80c5"><p id="f7ef4a06">Select a JDK. <a href="predefined-build-parameters.html#Defining-Java-related-Environment-Variables">This section</a> details the available options. The default is <code class="code">JAVA_HOME</code> environment variable or the agent's own Java.</p></td></tr><tr id="b4843372" class="ijRowEven"><td id="2687ed28"><p id="aa158777">JDK home path</p></td><td id="ab4f826e"><p id="56d3e0a9"><i origin="teamcity-help" id="a1ec52a8">The option is available when &lt;Custom&gt; is selected above.</i> Use this field to specify the path to your custom JDK used to run the build. If the field is left blank, the path to JDK Home is read either from the <code class="code">JAVA_HOME</code> environment variable on agent the computer, or from the <code class="code">env.JAVA_HOME</code> property specified in the <a href="build-agent-configuration.html">build agent configuration</a> file (<code class="code">buildAgent.properties</code>). If these values are not specified, TeamCity uses the Java home of the build agent process itself.</p></td></tr><tr id="638633c7" class="ijRowOdd"><td id="20ec7715"><p id="ae814436">JVM command line parameters</p></td><td id="0e0a423e"><p id="5247362b">You can specify such JVM command line parameters, for example, <i origin="teamcity-help" id="2670ef09">maximum heap size</i> or parameters enabling <i origin="teamcity-help" id="8177b91d">remote debugging</i>. These values are passed by the JVM used to run your build.<br>Example:</p><div class="code-block" data-lang="bash">-Xmx512m -Xms256m

</div></td></tr></tbody></table></div></div><a name="LocalArtifactRepositorySettings"></a><a name="Local-Artifact-Repository-Settings"></a><div class="chapter"><h3 id="Maven-LocalArtifactRepositorySettings">Local Artifact Repository Settings</h3><p id="5c81e174">Select one of the following options:</p><div class="table-wrapper"><table width="100%" id="2211944f"><thead><tr id="eadf6879" class="ijRowHead"><th id="d96bcde6"><p id="1ad5800f">Option</p></th><th id="9ba6319e"><p id="b8d5a4e4">Description</p></th></tr></thead><tbody><tr id="1d9ce0af" class="ijRowOdd"><td id="9513ee7d"><p id="8c2aa33e">Per agent (default)</p></td><td id="82a88fd5"><p id="ed69c30b">Use a separate repository to store artifacts, produced by all builds run by an agent, under the agent system directory.</p></td></tr><tr id="1f8f975e" class="ijRowEven"><td id="0ef6d1d6"><p id="49950afc">Per build configuration</p></td><td id="e61a130e"><p id="6d523192">Use a separate repository to store artifacts, produced by all builds of the current build configuration.</p></td></tr><tr id="54b4b17c" class="ijRowOdd"><td id="7803c1d2"><p id="1100a78a">Maven default</p></td><td id="2db7cf0b"><p id="fc12246c">Use the default Maven repository location. The repository is shared between all build configurations and all agents on the machine.</p></td></tr></tbody></table></div></div><a name="IncrementalBuilding"></a><a name="Incremental-Building"></a><div class="chapter"><h3 id="Maven-IncrementalBuilding">Incremental Building</h3><p id="f91f5d94">Select the <b id="f874b9db">Build only modules affected by changes</b> check box to enable incremental building of Maven modules. The general idea is that if you have a number of modules interconnected by dependencies, a change most probably affects (directly or transitively) only some of them; so if we build only the affected modules and take the result of building the rest of the modules from the previous build, we will get the overall result equal to the result of building the whole project from scratch with less effort and time.</p><p id="704ef118">Since Maven itself has very limited support for incremental builds, TeamCity uses its own change impact analysis algorithm for determining the set of affected modules and uses a special preliminary phase for making dependencies of the affected modules.</p><p id="03c6957e">First TeamCity performs own change impact analysis taking into account parent relationship and different dependency scopes and determines affected modules. Then the build is split into two sequential Maven executions.</p><p id="46490450">The first Maven execution called preparation phase is intended for building the dependencies of the affected modules. The preparation phase is to assure there will be no compiler or other errors during the second execution caused by the absence or inconsistency of dependency classes.</p><p id="c85c4296">The second Maven execution called main phase executes the main goal (for example, <code class="code">test</code>), thus performing only those tests affected by the change.</p><p id="8a43d115">Also check a related <a href="http://blogs.jetbrains.com/teamcity/2012/03/14/incremental-building-with-maven-and-teamcity/" data-external="true" target="_blank" rel="noopener noreferrer">blog post</a> on the topic.</p></div><a name="DockerSettings"></a><a name="Docker-Settings"></a><div class="chapter"><h3 id="Maven-DockerSettings">Docker Settings</h3><p id="5907c19e">In this section, you can specify a Docker image which will be <a href="docker-wrapper.html">used to run the build step</a>.</p></div><a name="CodeCoverage"></a><a name="Code-Coverage"></a><div class="chapter"><h3 id="Maven-CodeCoverage">Code Coverage</h3><p id="655ae9b2">Coverage support based on IDEA coverage engine is added to Maven runner. To learn about configuring code coverage options, refer to the <a href="configuring-java-code-coverage.html">Configuring Java Code Coverage</a> page.</p><aside class="note " data-title="" rel="655ae9b2" id="3f150043"><p id="7db76a09">Only Surefire version 2.4 and higher is supported.</p></aside><p id="614ce798">If you have several build agents installed on the same machine, by default they use the same local repository. However, there are two ways to allocate a custom local repository to each build agent:</p><ul class="list _ul"><li class="list__item" id="1092e49b"><p>Specify the following property in the <code class="code">teamcity-agent/conf/buildAgent.properties</code>:</p></li></ul><div class="code-block" data-lang="none">system.maven.repo.local=%system.agent.work.dir%/&lt;subdirectory_name&gt;

</div><p id="efbaea3a">For instance, <code class="code">%system.agent.work.dir%/m2-repository</code>.</p><ul class="list _ul"><li class="list__item" id="d4791909"><p>Run each build agent under different user account.</p></li></ul></div></div><a name="MavenReleasewithDifferentVCSs"></a><a name="Maven-Release-with-Different-VCSs"></a><div class="chapter"><h2 id="Maven-MavenReleasewithDifferentVCSs">Maven Release with Different VCSs</h2><p id="1b3e089c">To run the <code class="code">release:prepare</code> Maven task with different VCS's supported by TeamCity, make sure you're using at least 2.0 version of the <a href="http://maven.apache.org/maven-release/maven-release-plugin/" data-external="true" target="_blank" rel="noopener noreferrer">Maven Release Plugin</a>.</p><a name="UsingMavenReleasewithPerforce"></a><a name="Using-Maven-Release-with-Perforce"></a><div class="chapter"><h3 id="Maven-UsingMavenReleasewithPerforce">Using Maven Release with Perforce</h3><p id="d8d92b09">Check the following:</p><ol class="list _decimal"><li class="list__item" id="05efee75"><p>Use <a href="http://www.perforce.com/perforce/doc.current/manuals/p4sag/chapter.superuser.html#1080319" data-external="true" target="_blank" rel="noopener noreferrer">ticket-based authentication</a> for Maven Release plugin.</p></li><li class="list__item" id="9a8cac05"><p>Make sure that your <code class="code">release:prepare</code> Maven task works when it is run from the command line without TeamCity.</p></li></ol><p id="44cf79bb">In the <a href="perforce.html">Perforce VCS Root</a> Settings of your build configuration in TeamCity:</p><ol class="list _decimal"><li class="list__item" id="43c02edb"><p>Enable the <a href="perforce.html#Checkout-On-Agent-Settings">checkout on agent</a>.</p></li><li class="list__item" id="d22fc80d"><p>Enable <a href="perforce.html#P4-Connection-Settings">Use ticket-based authentication</a> in Perforce VCS root settings.</p></li><li class="list__item" id="b2f2248f"><p>Make sure your build agent environment doesn't have any occasional P4 variables which can interfere with the execution of Maven Release Plugin.</p></li><li class="list__item" id="3f70c351"><p>Specify <code class="code">release:prepare</code> in the <b id="2bfb8394">Goals</b> field of the Maven build step and run the build.</p></li></ol></div><a name="UsingMavenReleasewithGitVCS"></a><a name="Using-Maven-Release-with-Git-VCS"></a><div class="chapter"><h3 id="Maven-UsingMavenReleasewithGitVCS">Using Maven Release with Git VCS</h3><ol class="list _decimal"><li class="list__item" id="514a5c9c"><p>Use Git SSH URL as <a href="https://maven.apache.org/scm/git.html" data-external="true" target="_blank" rel="noopener noreferrer">SCM URL</a> in your <code class="code">pom.xml</code>.</p></li><li class="list__item" id="a991ea71"><p>Make sure that your <code class="code">release:prepare</code> maven task works when it is run from the command line without TeamCity.</p></li></ol><p id="b5b752f7"><b id="d5abee58">On the TeamCity agent</b>:</p><p id="fbe69d96">1. Make sure that the agent has Git installed and added to the agent's <code class="code">$PATH</code> on Unix-like OS's and to the <code class="code">%PATH%</code> environment variable on Windows.</p><p id="b7b632d7">2. On the agent, set your account's identity by executing</p><div class="code-block" data-lang="bash">git config --system user.email "buildserver@example.com"
git config --system user.name "TeamCity Server"

</div><p id="7824a3e0">3. Make sure your Git VCS is added to the known hosts database on the agent.</p><p id="6b7948ba"><b id="2021a2cf">On the TeamCity server</b>:</p><p id="9460dd5d">1. Upload <a href="ssh-keys-management.html">Git SSH key</a> to your TeamCity server.</p><p id="ac78304b"><i id="a2c29498">In the settings for your build configuration in TeamCity</i>:</p><p id="12e8b34c">2. On the <b id="0c3b6cfd">Version Control Settings</b> page, enable the checkout on agent.</p><p id="b92acafa">3. In your Git VCS root, enable <i id="eabafa96">Private Key</i> authentication.</p><p id="de97cf8a">4. Add the <a href="ssh-agent.html">SSH Agent</a> build feature to your configuration.</p><p id="cb0aaee1">5. Specify <code class="code">release:prepare</code> in the <b id="f62b3351">Goals</b> field of the Maven build step and run the build.</p><hr id="ee183d27"><p id="07da9c70"><b id="1c1454be">See also:</b></p><p id="4596741b"><b id="bdff8e76">Concepts</b>: <a href="build-runner.html">Build Runner</a><br><b id="2a63eca6">Administrator's Guide</b>: <a href="configuring-maven-triggers.html">Maven Artifact Dependency Trigger</a> | <a href="creating-and-editing-build-configurations.html">Creating Maven Build Configuration</a></p><hr id="dbe1eab2"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>