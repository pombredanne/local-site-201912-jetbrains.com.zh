<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v2/analytics.js"></script><title>Maven-帮助|团队城市</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v2/app.css"></head><body  data-id="Maven" data-breadcrumbs="teamcity-documentation.md|TeamCity Documentation/administrator-s-guide.md|Administrator's Guide/managing-projects-and-build-configurations.md|Managing Projects and Build Configurations/creating-and-editing-build-configurations.md|Creating and Editing Build Configurations/configuring-build-steps.md|Configuring Build Steps/maven.md|Maven" data-main-title="Maven" data-edit-url="https://github.com/JetBrains/teamcity-documentation/edit/2019.1/topics/maven.md"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索TeamCity帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>TeamCity 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="maven.md" data-toc="Maven">马文</h1><p id="92b4f2d5">请注意，如果特定的Maven工件已更改，则<a href="creating-and-editing-projects.html#Creating-project-pointing-to-repository-URL">可以从URL自动</a>创建新的基于Maven的构建配置，并设置<a href="configuring-maven-triggers.html#Maven-Artifact-Dependency-Trigger">依赖项构建触发器</a> 。</p><aside class="note " rel="92b4f2d5" id="750c175a" data-title=""><p id="37478d91"><b id="f7d9b649">与Maven运行程序有关的远程运行限制</b><br>通常，TeamCity中的个人构建不会影响在TeamCity服务器上运行的任何“常规”构建，并且其结果仅对发起者可见。但是，在使用Maven运行程序的情况下，此行为可能会有所不同。<br>TeamCity不会干扰Maven依赖模型。因此，如果您的Maven配置将工件部署到远程存储库， <b id="d5ff07c3">则即使您运行个人构建</b> ， <b id="d5ff07c3">它们也将部署在</b>该存储库中。因此，个人构建可能会影响取决于您的配置的构建。<br>例如，您有一个将工件部署到远程存储库的配置A，并且这些工件由配置B使用。当针对A的个人构建完成时，您的个人工件将出现在B中。如果进行了配置，这尤其有害A是产生发行版工件的原因，因为适当的工件将被开发人员的工件所替代，由于Maven版本控制模型，这将很难进行调查。另外，这些工件将不仅对TeamCity管理的工件可用，而且对所有相关的构建可用。<br>为了避免这种情况，我们建议不要对执行工件部署的构建配置使用远程运行。</p></aside><p id="34904a6a">在此页：</p><p id="487fa65d"></p><ul class="list" data-skip-index="skip"><li class="list__item"><a href="#Maven-Mavenrunnersettings">Maven运行程序设置</a><ul class="list _bullet"><li class="list__item"><a href="#Maven-MavenSettings">Maven设置</a></li><li class="list__item"><a href="#Maven-UserSettings">用户设置</a></li><li class="list__item"><a href="#Maven-JavaParameters">Java参数</a></li><li class="list__item"><a href="#Maven-LocalArtifactRepositorySettings">本地工件存储库设置</a></li><li class="list__item"><a href="#Maven-IncrementalBuilding">增量建筑</a></li><li class="list__item"><a href="#Maven-DockerSettings">Docker设置</a></li><li class="list__item"><a href="#Maven-CodeCoverage">代码覆盖率</a></li></ul></li><li class="list__item"><a href="#Maven-MavenReleasewithDifferentVCSs">具有不同VCS的Maven版本</a><ul class="list _bullet"><li class="list__item"><a href="#Maven-UsingMavenReleasewithPerforce">在Perforce中使用Maven Release</a></li><li class="list__item"><a href="#Maven-UsingMavenReleasewithGitVCS">在Git VCS中使用Maven Release</a></li></ul></li></ul><p></p><a name="Mavenrunnersettings"></a><a name="Maven-runner-settings"></a><div class="chapter"><h2 id="Maven-Mavenrunnersettings">Maven运行程序设置</h2><div class="table-wrapper"><table width="100%" id="f5b23547"><thead><tr id="b715754e" class="ijRowHead"><th id="2138188d"><p id="19144e59">选项</p></th><th id="3f1e1efa"><p id="5d5ce651">描述</p></th></tr></thead><tbody><tr id="282f6cbd" class="ijRowOdd"><td id="eed37c2e"><p id="a9805a32">目标</p></td><td id="743c37d4"><p id="8735eccf">在“ <b id="84222704">目标”</b>字段中，指定要TeamCity执行的以空格分隔的Maven目标的顺序。一些Maven目标可以使用版本控制系统，因此，它们可能与某些<a href="configuring-vcs-settings.html">配置VCS设置</a>不兼容。如果您希望TeamCity执行这样的目标：</p><ul class="list _ul"><li class="list__item" id="299f24d0"><p><i id="236e85e2">在</i> “ <b id="36d76633">版本控制设置”</b>页面上的<b id="ac22e2da"><a href="vcs-checkout-mode.html">VCS Checkout模式</a></b>下拉列表中选择“ <i id="236e85e2">在代理上自动</i> ”。这使得版本控制系统可用于目标执行软件。要使用<code class="code">release:prepare</code> Perforce VCS的目标，请参阅以下<a href="#Using-Maven-Release-with-Perforce">部分</a> 。</p></li></ul></td></tr><tr id="2ccb8b99" class="ijRowEven"><td id="249283ef"><p id="f2543b26">POM文件的路径</p></td><td id="d0f2c915"><p id="317842b7">指定相对于<a href="build-working-directory.html">构建工作目录</a>的POM文件的路径。<br>默认情况下，该属性包含一个<code class="code">pom.xml</code>文件。如果将此字段留为空白，则会在该字段中输入相同的值。路径也可能指向子目录，因此<code class="code"><subdirectory>/pom.xml</code>用来。</p></td></tr><tr id="5ce1b1e9" class="ijRowOdd"><td id="78903704"><p id="a1528889">其他Maven命令行参数</p></td><td id="e7cc07a6"><p id="37a1251a">指定命令行参数列表。</p><aside class="note " rel="37a1251a" id="1ff6d42e" data-title=""><p id="e6222d82">以下参数将被忽略： <code class="code">-q</code> ， <code class="code">-f</code> ， <code class="code">-s</code> （如果提供了<b id="4392c48c">用户设置路径</b> ）</p></aside></td></tr><tr id="a7345562" class="ijRowEven"><td id="b794c973"><p id="3ac2b66c">工作目录</p></td><td id="45072ab3"><p id="0669f08f">如果<a href="build-working-directory.html">构建工作目录</a>与<a href="build-checkout-directory.html">构建签出目录</a>不同，则指定它。</p></td></tr></tbody></table></div><aside class="note " rel="f5b23547" id="1adec2bc" data-title=""><p id="023ca2b1">当TeamCity自动发现Maven构建步骤时，它将自动将目标设置为<code class="code">clean test</code>和一个附加的Maven命令行参数<code class="code">-Dmaven.test.failure.ignore</code>至<code class="code">true</code>忽略失败的测试。当<code class="code">test</code>目标用于具有多个模块的Maven项目。将此属性设置为<code class="code">true</code> ，即使某些模块测试失败，也会对以下所有模块进行测试。<br>如果您将目标从<code class="code">test</code>至<code class="code">deploy</code> （或Maven构建生命周期中的任何其他顺序目标： <code class="code">package</code> ， <code class="code">verify</code> ， 要么<code class="code">install</code> ），请务必进行设置<code class="code">-Dmaven.test.failure.ignore</code>至<code class="code">false</code>因此失败的测试不会被忽略。</p></aside><a name="MavenSettings"></a><a name="Maven-Settings"></a><div class="chapter"><h3 id="Maven-MavenSettings">Maven设置</h3><p id="1200469a">选择您要使用的Maven版本。<b id="7b8d0c88">从TeamCity 2017.1开始</b> ，您可以<a href="installing-agent-tools.html">管理已安装的版本</a> 。</p><div class="table-wrapper"><table width="100%" id="fd19c53e"><thead><tr id="1b73fb15" class="ijRowHead"><th id="761a8f33"></th><th id="cea65e9a"></th></tr></thead><tbody><tr id="e529535e" class="ijRowOdd"><td id="0d54337e"><p id="c46a9337"><auto></auto></p></td><td id="4e78c8d1"><p id="837efc40">Maven安装的路径来自<code class="code">M2_HOME</code>环境变量，否则使用当前的默认版本。</p></td></tr><tr id="8768ace3" class="ijRowEven"><td id="37f479cc"><p id="7ccbb825"><default></default></p></td><td id="769710a4"><p id="bd6dd388">捆绑的版本3.0.5被用作默认值。<b id="6074baa4">从TeamCity 2017.1开始</b> ，您可以<a href="installing-agent-tools.html">更改默认值</a> 。</p></td></tr><tr id="17a3d77e" class="ijRowOdd"><td id="ea84dd22"><p id="24277c80"><custom></custom></p></td><td id="da628a7e"><p id="137e6181">提供自定义Maven版本的路径。</p></td></tr></tbody></table></div></div><a name="UserSettings"></a><a name="User-Settings"></a><div class="chapter"><h3 id="Maven-UserSettings">用户设置</h3><p id="54cc7110">在此处指定要使用的用户设置类型。这等效于Maven命令行选项<code class="code">-s</code>要么<code class="code">--settings</code> 。可用的选项有：</p><div class="table-wrapper"><table width="100%" id="7295e982"><thead><tr id="78fcbf6a" class="ijRowHead"><th id="9d841c56"></th><th id="cc6f1c8c"></th></tr></thead><tbody><tr id="31699a51" class="ijRowOdd"><td id="622a3b01"><p id="0680fefd"><default></default></p></td><td id="4a0b90c3"><p id="4f7ff85a">设置是从代理上的默认Maven位置获取的。有关服务器逻辑，请参见<a href="maven-server-side-settings.html">Maven服务器端设置</a> 。</p></td></tr><tr id="2eb15793" class="ijRowEven"><td id="212aef10"><p id="5db176a3"><custom></custom></p></td><td id="23ae48e0"><p id="9e06f2c1">输入备用用户设置文件的路径。该路径在代理程序和服务器上均应有效，请参见<a href="maven-server-side-settings.html">Maven服务器端设置</a> 。</p></td></tr><tr id="5e0bbd3c" class="ijRowOdd"><td id="47507b76"><p id="6fb0a2e2">预定义设置</p></td><td id="3e8cffb3"><p id="4c9997e5">如果有设置文件通过管理UI上传到TeamCity服务器，则可以在此处选择可用选项之一。要将设置文件上传到TeamCity，请点击<i id="1f312129">管理设置文件</i> 。Maven设置在项目级别上定义。您可以查看当前项目中定义的设置文件，也可以使用<b id="e06880d1">Maven设置</b>在“ <b id="d6e77292">项目设置”</b>页面上载文件。这些文件将在项目及其子项目中可用。上载的文件存储在<teamcity data="" directory="">/ config / projects /％projectID％/ pluginData / mavenSettings目录中。如有必要，可以在此处进行编辑。上载的文件用于代理和服务器端Maven功能。<br>如果使用“自定义”或“预定义”设置，则有效的用户设置文件的路径在maven进程中可用，因为<code class="code">teamcity.maven.userSettings.path</code>系统属性。</teamcity></p></td></tr></tbody></table></div><a name="java-param"></a></div><a name="JavaParameters"></a><a name="Java-Parameters"></a><div class="chapter"><h3 id="Maven-JavaParameters">Java参数</h3><div class="table-wrapper"><table class="  _layout-fixed" width="100%" id="ff050453"><thead><tr id="1d6a3847" class="ijRowHead"><th id="2f8d3b48"><p id="e602b1fc">选项</p></th><th id="cd802640"><p id="f08711a1">描述</p></th></tr></thead><tbody><tr id="2b44e850" class="ijRowOdd"><td id="092c9091"><p id="aa7f752b">JDK</p></td><td id="74cc80c5"><p id="f7ef4a06">选择一个JDK。 <a href="predefined-build-parameters.html#Defining-Java-related-Environment-Variables">本节</a>详细介绍了可用的选项。默认是<code class="code">JAVA_HOME</code>环境变量或代理程序自己的Java。</p></td></tr><tr id="b4843372" class="ijRowEven"><td id="2687ed28"><p id="aa158777">JDK主页路径</p></td><td id="ab4f826e"><p id="56d3e0a9"><i id="a1ec52a8" origin="teamcity-help"><custom>上面选择</custom>时，此选项可用<custom>。</custom></i> 使用此字段可以指定用于运行构建的自定义JDK的路径。如果该字段为空，则从<code class="code">JAVA_HOME</code>代理计算机上的环境变量，或来自<code class="code">env.JAVA_HOME</code>在<a href="build-agent-configuration.html">构建代理配置</a>文件中指定的属性（ <code class="code">buildAgent.properties</code> ）。如果未指定这些值，TeamCity将使用构建代理进程本身的Java主页。</p></td></tr><tr id="638633c7" class="ijRowOdd"><td id="20ec7715"><p id="ae814436">JVM命令行参数</p></td><td id="0e0a423e"><p id="5247362b">您可以指定此类JVM命令行参数，例如<i id="2670ef09" origin="teamcity-help">最大堆大小</i>或启用<i id="8177b91d" origin="teamcity-help">远程调试的</i>参数。这些值由用于运行构建的JVM传递。<br>例：</p><div class="code-block" data-lang="bash">-Xmx512m -Xms256m</div></td></tr></tbody></table></div></div><a name="LocalArtifactRepositorySettings"></a><a name="Local-Artifact-Repository-Settings"></a><div class="chapter"><h3 id="Maven-LocalArtifactRepositorySettings">本地工件存储库设置</h3><p id="5c81e174">选择以下选项之一：</p><div class="table-wrapper"><table width="100%" id="2211944f"><thead><tr id="eadf6879" class="ijRowHead"><th id="d96bcde6"><p id="1ad5800f">选项</p></th><th id="9ba6319e"><p id="b8d5a4e4">描述</p></th></tr></thead><tbody><tr id="1d9ce0af" class="ijRowOdd"><td id="9513ee7d"><p id="8c2aa33e">每个代理（默认）</p></td><td id="82a88fd5"><p id="ed69c30b">使用单独的存储库在代理系统目录下存储由代理运行的所有构建生成的工件。</p></td></tr><tr id="1f8f975e" class="ijRowEven"><td id="0ef6d1d6"><p id="49950afc">每个构建配置</p></td><td id="e61a130e"><p id="6d523192">使用单独的存储库来存储由当前构建配置的所有构建产生的工件。</p></td></tr><tr id="54b4b17c" class="ijRowOdd"><td id="7803c1d2"><p id="1100a78a">Maven默认</p></td><td id="2db7cf0b"><p id="fc12246c">使用默认的Maven存储库位置。该存储库在计算机上的所有构建配置和所有代理之间共享。</p></td></tr></tbody></table></div></div><a name="IncrementalBuilding"></a><a name="Incremental-Building"></a><div class="chapter"><h3 id="Maven-IncrementalBuilding">增量建筑</h3><p id="f91f5d94">选中<b id="f874b9db">仅构建受更改影响的模块</b>复选框以启用Maven模块的增量构建。通常的想法是，如果您有许多通过依赖关系相互连接的模块，那么更改很可能仅影响（直接或传递）它们中的一些模块。因此，如果我们仅构建受影响的模块，并从上一个构建中获取构建其余模块的结果，则所获得的总体结果将与从头开始构建整个项目所花费的时间和精力更少。</p><p id="704ef118">由于Maven本身对增量构建的支持非常有限，因此TeamCity使用其自己的变更影响分析算法来确定受影响的模块集，并使用特殊的初步阶段来使受影响的模块相互依赖。</p><p id="03c6957e">First TeamCity在考虑父级关系和不同依赖项范围的情况下执行自己的变更影响分析，并确定受影响的模块。然后将构建分为两个顺序的Maven执行。</p><p id="46490450">称为准备阶段的第一个Maven执行旨在建立受影响模块的依赖关系。准备阶段是为了确保在第二次执行期间不会因依赖项类的缺乏或不一致而导致编译器或其他错误。</p><p id="c85c4296">第二个Maven执行称为“主要阶段”执行主要目标（例如， <code class="code">test</code> ），从而仅执行受更改影响的测试。</p><p id="8a43d115">另外，请查看有关该主题的相关<a href="http://blogs.jetbrains.com/teamcity/2012/03/14/incremental-building-with-maven-and-teamcity/" rel="noopener noreferrer" data-external="true" target="_blank">博客文章</a> 。</p></div><a name="DockerSettings"></a><a name="Docker-Settings"></a><div class="chapter"><h3 id="Maven-DockerSettings">Docker设置</h3><p id="5907c19e">在本部分中，您可以指定一个Docker映像，该映像将<a href="docker-wrapper.html">用于运行构建步骤</a> 。</p></div><a name="CodeCoverage"></a><a name="Code-Coverage"></a><div class="chapter"><h3 id="Maven-CodeCoverage">代码覆盖率</h3><p id="655ae9b2">基于IDEA覆盖引擎的覆盖支持已添加到Maven运行程序。要了解有关配置代码覆盖率选项的信息，请参阅“ <a href="configuring-java-code-coverage.html">配置Java代码覆盖率”</a>页面。</p><aside class="note " rel="655ae9b2" id="3f150043" data-title=""><p id="7db76a09">仅支持Surefire 2.4和更高版本。</p></aside><p id="614ce798">如果您在同一台计算机上安装了多个构建代理，则默认情况下它们使用相同的本地存储库。但是，有两种方法可以将自定义本地存储库分配给每个构建代理：</p><ul class="list _ul"><li class="list__item" id="1092e49b"><p>在中指定以下属性<code class="code">teamcity-agent/conf/buildAgent.properties</code> ：</p></li></ul><div class="code-block" data-lang="none">system.maven.repo.local =％system.agent.work.dir％/ <subdirectory_name>

</subdirectory_name></div><p id="efbaea3a">例如， <code class="code">%system.agent.work.dir%/m2-repository</code> 。</p><ul class="list _ul"><li class="list__item" id="d4791909"><p>在不同的用户帐户下运行每个构建代理。</p></li></ul></div></div><a name="MavenReleasewithDifferentVCSs"></a><a name="Maven-Release-with-Different-VCSs"></a><div class="chapter"><h2 id="Maven-MavenReleasewithDifferentVCSs">具有不同VCS的Maven版本</h2><p id="1b3e089c">运行<code class="code">release:prepare</code> TeamCity支持具有不同VCS的Maven任务，请确保您使用的<a href="http://maven.apache.org/maven-release/maven-release-plugin/" rel="noopener noreferrer" data-external="true" target="_blank">Maven Release Plugin</a>至少为2.0版本。</p><a name="UsingMavenReleasewithPerforce"></a><a name="Using-Maven-Release-with-Perforce"></a><div class="chapter"><h3 id="Maven-UsingMavenReleasewithPerforce">在Perforce中使用Maven Release</h3><p id="d8d92b09">检查以下内容：</p><ol class="list _decimal"><li class="list__item" id="05efee75"><p>对Maven Release插件使用<a href="http://www.perforce.com/perforce/doc.current/manuals/p4sag/chapter.superuser.html#1080319" rel="noopener noreferrer" data-external="true" target="_blank">基于票证的身份验证</a> 。</p></li><li class="list__item" id="9a8cac05"><p>确保您的<code class="code">release:prepare</code>当从不带TeamCity的命令行运行Maven任务时，该任务即可工作。</p></li></ol><p id="44cf79bb">在TeamCity中构建配置的<a href="perforce.html">Perforce VCS根目录</a>设置中：</p><ol class="list _decimal"><li class="list__item" id="43c02edb"><p>启用<a href="perforce.html#Checkout-On-Agent-Settings">代理结帐</a> 。</p></li><li class="list__item" id="d22fc80d"><p>在Perforce VCS根目录设置中启用“ <a href="perforce.html#P4-Connection-Settings">使用基于票证的身份验证”</a> 。</p></li><li class="list__item" id="b2f2248f"><p>确保您的构建代理环境没有任何偶然的P4变量，这些变量可能会干扰Maven Release Plugin的执行。</p></li><li class="list__item" id="3f70c351"><p>指定<code class="code">release:prepare</code>在Maven构建步骤的“ <b id="2bfb8394">目标”</b>字段中并运行构建。</p></li></ol></div><a name="UsingMavenReleasewithGitVCS"></a><a name="Using-Maven-Release-with-Git-VCS"></a><div class="chapter"><h3 id="Maven-UsingMavenReleasewithGitVCS">在Git VCS中使用Maven Release</h3><ol class="list _decimal"><li class="list__item" id="514a5c9c"><p>使用Git SSH URL作为<a href="https://maven.apache.org/scm/git.html" rel="noopener noreferrer" data-external="true" target="_blank">SCM URL</a> <code class="code">pom.xml</code> 。</p></li><li class="list__item" id="a991ea71"><p>确保您的<code class="code">release:prepare</code>当从不带TeamCity的命令行运行maven任务时，该任务即可工作。</p></li></ol><p id="b5b752f7"><b id="d5abee58">在TeamCity代理上</b> ：</p><p id="fbe69d96">1。确保代理已安装Git并将其添加到代理的<code class="code">$PATH</code>在类似Unix的操作系统上以及<code class="code">%PATH%</code> Windows上的环境变量。</p><p id="b7b632d7">2。在代理上，通过执行以下操作来设置您帐户的身份</p><div class="code-block" data-lang="bash">git config --system user.email“ buildserver@example.com” git config --system user.name“ TeamCity Server”</div><p id="7824a3e0">3。确保您的Git VCS已添加到代理上的已知主机数据库。</p><p id="6b7948ba"><b id="2021a2cf">在TeamCity服务器上</b> ：</p><p id="9460dd5d">1。将<a href="ssh-keys-management.html">Git SSH密钥</a>上传到TeamCity服务器。</p><p id="ac78304b"><i id="a2c29498">在TeamCity中构建配置的设置中</i> ：</p><p id="12e8b34c">2。在“ <b id="0c3b6cfd">版本控制设置”</b>页面上，启用代理签出。</p><p id="b92acafa">3。在您的Git VCS根目录中，启用<i id="eabafa96">私钥</i>身份验证。</p><p id="de97cf8a">4。将<a href="ssh-agent.html">SSH代理</a>构建功能添加到您的配置中。</p><p id="cb0aaee1">5，指定<code class="code">release:prepare</code>在Maven构建步骤的“ <b id="f62b3351">目标”</b>字段中并运行构建。</p><hr id="ee183d27"><p id="07da9c70"><b id="1c1454be">也可以看看：</b></p><p id="4596741b"><b id="bdff8e76">概念</b> ： <a href="build-runner.html">Build Runner</a><br><b id="2a63eca6">管理员指南</b> ： <a href="configuring-maven-triggers.html">Maven工件依赖触发器</a> <a href="creating-and-editing-build-configurations.html">创建Maven构建配置</a></p><hr id="dbe1eab2"></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v2/app.js"></script></body></html>