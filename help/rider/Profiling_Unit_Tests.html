<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Profiling Unit Tests - Help | JetBrains Rider</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Profiling_Unit_Tests" data-breadcrumbs="Building_Running_and_Debugging.xml|Build, Execute, Deploy/Performance_Profiling.xml|Performance Profiling of .NET Code/Profiling_Unit_Tests.xml|Profiling Unit Tests" data-main-title="Profiling Unit Tests" data-disqus-id="Profiling_Unit_Tests_rdr"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search JetBrains Rider Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>JetBrains Rider 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="visual_studio">Visual Studio</option><option data-group="primary" value="resharper">ReSharper</option><option data-group="primary" value="_default">Default (IntelliJ IDEA)</option><option data-group="secondary" value="visual_studio_osx">Visual Studio (macOS)</option><option data-group="secondary" value="resharper_osx">ReSharper (macOS)</option><option data-group="secondary" value="mac_os_x_10.5_">Mac OS X 10.5+ (IntelliJ IDEA)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="Profiling_Unit_Tests" id="Profiling_Unit_Tests.xml">Profiling Unit Tests</h1>    <a name="content"></a>                        <p id="59634ebe">            Along with applications, dotTrace allows you to profile unit tests.            The profiling workflow looks like follows:        </p>        <ol class="list _decimal"><li class="list__item" id="fdb1f563">                <a href="#step-1-configure-a-profiling-session">Configuring a profiling session</a>            </li><li class="list__item" id="f963384a">                <a href="#step-2-running-the-session-and-getting-snapshots">Running the session and getting                    snapshots                </a>            </li><li class="list__item" id="62c28539">                <a href="#step-3-analyzing-collected-snap">Analyzing the collected snapshots</a>            </li></ol>        <div class="chapter"><h2 id="step-1-configure-a-profiling-session" data-toc="Profiling_Unit_Tests#step-1-configure-a-profiling-session">Step 1. Configuring a profiling session</h2>                        <figure><img alt="Profiling configurations in Rider" title="Profiling configurations in Rider" src="/help/img/rider/2019.2/profiler_configurations_tests.png" id="3568604b" width="464" height="243"></figure>                        <p id="fc94c8ca">                Before starting a profiling session, you must select a profiling configuration:            </p>                        <ul class="list _ul"><li class="list__item" id="35680f79"><p>                    The profiling configuration specifies profiling session settings like which profiling type will be                    used,                    whether child processes must be profiled, and so on.                </p></li><li class="list__item" id="30c9b7a7"><p>                    The profiling target is a unit test runner that runs selected tests.                </p></li></ul>            <section class="procedure-steps"><h3 id="c8e3bf52">To select a profiling configuration</h3><ul class="list "><li class="list__item" id="b979a3e5">                    <p id="dba1fb8b">                        In the toolbar, in the list of profiling configurations, select:                    </p>                    <ul class="list _ul"><li class="list__item" id="c96bb5ec"><p>                            either one of the                            <a href="#profiling_types">predefined configurations</a>:                            <span class="control">Sampling</span>,                                                            <span class="control">Tracing</span>, <span class="control">Line-by-line</span>,                                                        <span class="control">Timeline</span>, <span class="control">Timeline (Mono)</span> (for Mono apps),                            <span class="control">Timeline (Unity)</span>                            (for Unity apps).                        </p></li><li class="list__item" id="b8c92b1e"><p>                            or your own                            <a href="#add_config">custom configuration</a>.                        </p></li></ul>                </li></ul></section>            <section class="procedure-steps"><h3 id="add_config">To create a profiling configuration</h3><ol class="list _decimal"><li class="list__item" id="13855de6"><p>                    In the toolbar, in the list of profiling configurations, select                    <span class="control">Edit Configurationsâ€¦</span>.                </p></li><li class="list__item" id="3cb79737"><p>                    In the opened                    <span class="control">Profiling Configurations</span>                    window, click                    <img alt="Add profiling configuration" title="Add profiling configuration" src="/help/img/rider/2019.2/ThemedIcon.AddPattern.Screen.[Gray].png" id="58485e53" width="12" height="12" class="inline-icon-12">                    to add a new profiling configuration.                </p></li><li class="list__item" id="1f924057">                    <p id="74e9d510">                        Specify configuration <span class="control">Name</span> and other profiling options:                    </p>                    <ul class="list _ul"><li class="list__item" id="0b6fad46">                            <span class="control">Profiling type</span>                                                            <a name="profiling_type"></a>                                <div class="table-wrapper"><table class=" wide" width="100%" id="704e1098"><thead><tr id="b4fc8fc2" class="ijRowHead"><th id="d8fad951"><p>Profiling Method</p></th><th id="871acd39" width="120"><p>Profiling Type</p></th><th id="ac70e48d"><p>Description</p></th><th id="1d8b5734"><p>Use Case</p></th></tr></thead><tbody><tr id="5d271753" class="ijRowOdd"><td id="990e2246" rowspan="3"><p>                            <b id="8be7de18" origin="dotnet">                                <font style="color:#003399">                                    <b id="0e66963d" origin="dotnet">Performance Profiling</b>                                </font>                            </b>                            <br>                            Detailed timing information about function calls.                                                                                </p></td><td id="d6a66e6f">                            <span class="control">Sampling</span>                        </td><td id="88878164"><p>Accurate time measurement, number of calls is not measured.                        </p></td><td id="90611b2a"><p>                            <i id="35390e36" origin="dotnet">Recommended for most cases</i>. Ideal when you look for performance issues in your                            app                            for the first time.                        </p></td></tr><tr id="6744b8e0" class="ijRowEven"><td id="8d1d31bb">                            <span class="control">Tracing</span>                        </td><td id="d8660965"><p>Accurate calls number measurement, time measurement may be inaccurate due to profiling                            overhead.                        </p></td><td id="4516a7a0"><p>When sampling data is not enough. For example, for analyzing algorithm complexity (when                            info                            about number of calls is more valuable than call time values).                        </p></td></tr><tr id="31d4f4bf" class="ijRowOdd"><td id="6ea88f5d">                            <span class="control">Line-by-line</span>                        </td><td id="72891163"><p>Each line of code is measured, call time values are inaccurate due to huge profiler                            overhead.                            <br>                                                    </p></td><td id="c794ba04"><p>For advanced use cases only. For example, when you already know what function causes                            issues                            and                            want to analyze each line of it.                        </p></td></tr><tr id="de5aea38" class="ijRowEven"><td id="47b1a75a"><p>                            <b id="ce457ae6" origin="dotnet">                                <font style="color:#003399">                                    <b id="ec1b29f3" origin="dotnet">Timeline Profiling</b>                                </font>                            </b>                            <br>                            Detailed temporal data about application threads and events.                                                    </p></td><td id="4db3b1ea">                            <span class="control">Timeline</span>                        </td><td id="95338467">                            <p id="7acdfeab">Collects temporal data about thread states, application events, and other                                multi-threading                                data.                                Based on Event Tracing for Windows (ETW).                            </p>                            <p id="fee5c8e7">                                If you want to create a configuration for profiling Mono or Unity                                applications, select <span class="control">Timeline (Mono)</span> or                                <span class="control">Timeline (Unity)</span> correspondingly.                            </p>                        </td><td id="202dab86"><p><i id="a80027ac" origin="dotnet">Recommended for most cases</i>. Especially, for analyzing multithreaded apps. Use it,                            for example, to determine the cause of UI freezes, excessive                            garbage collections, uneven workload distribution, insufficient I/O, and so on.                        </p></td></tr></tbody></table></div>                                                                                            </li><li class="list__item" id="4de4fb98">                            <ul class="list _ul"><li class="list__item" id="f04e4ca0">                                    <p id="c9f10f63">                                        <span class="control">Control profiling manually</span>                                        <br>                                        Enables you to control profiling manually via the profiler controls. For                                        example,                                        to take a snapshot, you will have to click                                        <span class="control">Get Snapshot</span>.                                    </p>                                    <ul class="list _ul"><li class="list__item" id="d6127539">                                            <p id="6ede7024">                                                <span class="control">Collect profiling data from start</span>*                                            </p>                                                                                        <p id="786aa7b1">                                                <span class="control">Collect profiling data from start</span>:                                                This setting is ignored when profiling unit tests.                                            </p>                                        </li></ul>                                </li><li class="list__item" id="44d2a191"><p>                                    <span class="control">Control profiling via API</span>                                    <br>                                    Enables you to control profiling directly from the code of the profiled application.                                    For example, to take a snapshot in the exact point of your code.                                    Learn more about using the API in the                                    <a href="https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html" data-external="true" target="_blank" rel="noopener noreferrer">dotTrace documentation</a>.                                </p></li></ul>                        </li><li class="list__item" id="2ad242e3"><p>                            <span class="control">Profile child processes</span>                            <br>                            If selected, dotTrace will profile not only the main app process but the processes                            it runs as well.                        </p></li><li class="list__item" id="b6e3ebdd">            <p id="5868465f">                <span class="control">Time measurement</span>                <br>                This option defines how dotTrace must calculate calls time.                For more details, refer to                 <a href="https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Setting_the_Right_Meter_Kind.html" data-external="true" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Setting_the_Right_Meter_Kind.html</a>.                <br>Typically, this is a choice between whether                    dotTrace should calculate time when a thread is not working or should not. More specifically, there are                    four options:            </p>            <ul class="list _ul"><li class="list__item" id="64d7a894"><p>                    <span class="control">Real time (performance counter)</span>                    <br>                    <i id="44e54b2b" origin="dotnet">Recommended</i>. dotTrace calculates the overall real time passed between method entry and exit.                    This time does not depend on app threads states.                    Time is calculated using system performance counter.                </p></li><li class="list__item" id="873aebfc"><p>                    <span class="control">Real time (CPU instruction)</span>                    <br>                    dotTrace calculates the overall real time passed between method entry and exit. This time does not                    depend on app threads states.                    Time is calculated using the CPU register.                </p></li><li class="list__item" id="234fb4f5"><p>                    <span class="control">Thread time</span>                    <br>                    dotTrace calculates only the time when a certain thread is running. The time when the thread is                    waiting or sleeping is not included in calculation.                </p></li><li class="list__item" id="d347f073"><p>                    <span class="control">Thread cycle time</span>                    <br>                    dotTrace calculates only the time when a certain thread is running. The time when the thread is                    waiting or sleeping is not included in calculation. Time is calculated using the CPU register.                </p></li></ul>            <p id="b9c09bff">                The table next in this section will help you to choose a time measurement method better suitable for your            case.            </p>        </li><li class="list__item" id="ee5e665f"><p>            <span class="control">Enable inlining</span>            <br>            (Tracing, Line-by-line) Clear this option if you want dotTrace to turn off JIT-inlining and get call stacks that closely resemble            the structure of application's source code.        </p></li><li class="list__item" id="f4c83645"><p>            <span class="control">High accuracy</span>            <br>            (Tracing, Line-by-line)            If selected, dotTrace will take into account time spent in profiler itself by taking more time samples.        </p></li><li class="list__item" id="native"><p>            <span class="control">Collect native allocations</span>            <br>            (Timeline) If selected, dotTrace will collect information about all memory allocations the profiled application            does in the native (unmanaged) heap. To be able to select this option, you must have            <a href="https://msdn.microsoft.com/en-gb/windows/hardware/commercialize/test/wpt/index" data-external="true" target="_blank" rel="noopener noreferrer">Windows Performance Toolkit</a>            installed on your computer.        </p></li><li class="list__item" id="debug"><p>            <span class="control">Collect debug output</span>            <br>            (Timeline) If selected, dotTrace will collect information about all messages the profiled application sends to            the                        <a href="https://www.jetbrains.com/help/profiler/Debug_Output.html" data-external="true" target="_blank" rel="noopener noreferrer">debug output</a>.        </p></li><li class="list__item" id="tpl"><p>            <span class="control">Collect TPL events</span>            <br>            (Timeline) If selected, profiling performance may be affected but dotTrace will collect Task Parallel Library (TPL)            data. If cleared, there will be no <code class="code">Task</code> nodes in            <span class="control">Call Tree</span>            and            <code class="code">async</code>            call nodes will lack their <span class="control">await</span> and            <span class="control">continuations</span>            parts. Learn more about how dotTrace works with asynchronous code            in                        <a href="https://www.jetbrains.com/help/profiler/Analyzing_Async_Calls.xml" data-external="true" target="_blank" rel="noopener noreferrer">https://www.jetbrains.com/help/profiler/Analyzing_Async_Calls.xml</a>.            <br>            Clear this option in case your application does not use multitasking or you do not            need this info.        </p></li></ul>                </li></ol></section>        </div>        <div class="chapter"><h2 id="step-2-running-the-session-and-getting-snapshots" data-toc="Profiling_Unit_Tests#step-2-running-the-session-and-getting-snapshots">Step 2. Running the session and getting snapshots</h2>            <section class="procedure-steps"><h3 id="5c9bb64b">To start a session and get snapshots</h3><ol class="list _decimal"><li class="list__item" id="d2572cbb">                    <p id="6524e956">                        Do one of the following:                    </p>                    <ul class="list _ul"><li class="list__item" id="be2f1501"><p>                            Open the <a href="Reference_Windows_Unit_Tests.html">Unit Tests</a>                            window, select unit tests you want to profile, and click the                            <img alt="Profile Unit Tests" title="Profile Unit Tests" src="/help/img/rider/2019.2/icon_profile_unit_tests.png" id="fe7ff61c" width="15" height="17" class="inline-icon-15">                            <span class="control">Profile Unit Tests</span>                            button or select                            <span data-skip-index="skip" class="menupath">Tests | Profile Unit Tests</span> in the main menu.                        </p></li><li class="list__item" id="0d0eee05"><p>                            In the code editor, open the menu in the left gutter for a desired unit test or                            test class and select <span class="control">Profile</span>.                            <figure><img alt="Profile Unit Tests" title="Profile Unit Tests" src="/help/img/rider/2019.2/profile_unit_tests_gutter.png" id="c84ce01b" width="454" height="203"></figure>                        </p></li></ul>                    <p id="944c511c">                        Once the profiling is started, you will see the                        <a href="Performance_Profiler_window.html">Performance Profiler</a>                        tool window opened on the <span class="control">Profiling</span> tab with the profiling controller inside.                    </p>                </li><li class="list__item" id="d17a953f"><p>                    When profiling unit tests, you don't have to manually control the profiling session (get snapshots                    and finish the session).                    dotTrace will automatically take a performance snapshot once a unit test session is over.                    The collected snapshot will be added to the list of snapshots inside the                    <span class="control">Performance Profiler</span>                    window.                </p></li></ol></section>        </div>        <div class="chapter"><h2 id="step-3-analyzing-collected-snap" data-toc="Profiling_Unit_Tests#step-3-analyzing-collected-snap">Step 3. Analyzing collected snapshots</h2>            <p id="630fa4dc">                For more details on how to analyze performance snapshots, refer to                <a href="Analyzing_Profiling_Snapshots.html">Analyzing Profiling Results</a>.            </p>            <section class="procedure-steps"><h3 id="e18bf036">To analyze a snapshot</h3><ol class="list _decimal"><li class="list__item" id="3935eba2"><p>                    On the                    <span class="control">All Snapshots</span>                    tab of the                    <a href="Performance_Profiler_window.html">Performance Profiler</a>                    tool window, select the snapshot you want to analyze.                </p></li><li class="list__item" id="4efd7094">                    <p id="610c2fcc">                        Analyze the collected data using one of the views:                    </p>                    <ul class="list _ul"><li class="list__item" id="91d3f86b"><p>                            <span class="control">Call Tree</span>: a "classic" call tree that shows you all method calls in all                            threads.                            Each top-level node represents a top-level function which was executed by a certain thread.                            Use this view to quickly get down to actual application activity.                            <a href="https://www.jetbrains.com/help/profiler/Call_Tree.html" data-external="true" target="_blank" rel="noopener noreferrer">Learn more</a>                                                    </p></li><li class="list__item" id="b5571890"><p>                            <span class="control">Top Methods</span>: the best place to start when analyzing application                            performance.                            It is a simple plain list of methods with the highest execution time. Note that you can                            reduce                            the system functions "noise" by excluding them from the list using the                            <img alt="Hide system functions" title="Hide system functions" src="/help/img/rider/2019.2/icon_hide_system_functions_profiler.png" id="5d509c32" width="16" height="16" class="inline-icon-16">                            toggle: if enabled, method's execution time is calculated as a sum of method's own time                            and the time of all child system methods (down to the next user method in the stack).                            <a href="https://www.jetbrains.com/help/profiler/Plain_List.html" data-external="true" target="_blank" rel="noopener noreferrer">Learn more</a>                                                    </p></li></ul>                </li><li class="list__item" id="aa1e896e"><p>                    Once the suspicious method is found, press <kbd data-visual_studio="F4" data-resharper="F4" data-_default="F4" data-visual_studio_osx="âŒ˜ Down" data-resharper_osx="âŒ˜ Down" data-mac_os_x_10.5_="âŒ˜ Down">F4</kbd> or select                    <span class="control">Jump to Source</span> from the context menu.                    Rider will navigate you right to the method's source code.                </p></li></ol></section>        </div>    <div class="last-modified" data-skip-index="skip">Last modified: 29 November 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profiling_Applications.html">Profiling Applications</a><a class="navigation-links__next" href="Profiling_Any_.NET_Processes.html">Attaching to and Profiling .NET Processes</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>