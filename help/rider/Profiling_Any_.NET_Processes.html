<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>附加和分析.NET进程-帮助|帮助JetBrains骑士</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Profiling_Any_.NET_Processes" data-breadcrumbs="Building_Running_and_Debugging.xml|Build, Execute, Deploy/Performance_Profiling.xml|Performance Profiling of .NET Code/Profiling_Any_.NET_Processes.xml|Attaching to and Profiling .NET Processes" data-main-title="Attaching to and Profiling .NET Processes" data-disqus-id="Profiling_Any_.NET_Processes_rdr"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索JetBrains Rider帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>JetBrains Rider 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="visual_studio" data-group="primary">视觉工作室</option><option value="resharper" data-group="primary">锐化器</option><option value="_default" data-group="primary">默认（IntelliJ IDEA）</option><option value="visual_studio_osx" data-group="secondary">Visual Studio（macOS）</option><option value="resharper_osx" data-group="secondary">ReSharper（macOS）</option><option value="mac_os_x_10.5_" data-group="secondary">Mac OS X 10.5+（IntelliJ IDEA）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Profiling_Any_.NET_Processes.xml" data-toc="Profiling_Any_.NET_Processes">附加和分析.NET进程</h1>    <a name="content"></a>                <p id="34675735">dotTrace允许您分析系统中已经在运行的任何.NET进程。分析工作流程如下所示：</p>                <ol class="list _decimal"><li class="list__item" id="5adf77e8">                <a href="#step-1-configure-a-profiling-session">配置分析会话</a>            </li><li class="list__item" id="9b5fb557">                <a href="#step-2-running-the-session-and-getting-snapshots">运行会话并获取快照</a>            </li><li class="list__item" id="6d1ef848">                <a href="#step-3-analyzing-collected-snap">分析收集的快照</a>            </li></ol>        <div class="chapter"><h2 id="step-1-configure-a-profiling-session" data-toc="Profiling_Any_.NET_Processes#step-1-configure-a-profiling-session">步骤1。配置分析会话</h2>                                    <figure><img alt="Rider中的配置文件配置" title="Rider中的配置文件配置" src="/help/img/rider/2019.2/profiler_configurations_attach.png" id="e7ce8c51" width="463" height="248"></figure>                        <p id="b887ba53">在开始性能分析会话之前，请确保您至少具有一个适用的性能分析配置。</p>            <ul class="list _ul"><li class="list__item" id="06c59a69"><p>配置文件配置指定配置文件会话设置，例如将使用哪种配置文件类型，是否必须配置子进程等等。</p></li><li class="list__item" id="bb89fa67"><p>分析目标是您要附加的正在运行的.NET进程。</p></li><li class="list__item" id="ee47653b"><p><span class="control">追踪</span>和<span class="control">线由行</span>仿形类型附加到处理时不可用。</p></li></ul>            <section class="procedure-steps"><h3 id="2f844ebf">选择配置文件配置</h3><ul class="list "><li class="list__item" id="94402f65">                    <p id="c296c84d">在工具栏中的配置文件配置列表中，选择：</p>                    <ul class="list _ul"><li class="list__item" id="a61a49dc"><p><a href="#profiling_types">预定义配置之一</a> ： <span class="control">采样</span> ， <span class="control">时间轴</span> ， <span class="control">时间轴（单声道）</span> （对于Mono应用程序）， <span class="control">时间轴（统一）</span> （对于Unity应用程序）。</p></li><li class="list__item" id="523900ca"><p>或您自己的<a href="#add_config">自定义配置</a> 。</p></li></ul>                </li></ul></section>            <section class="procedure-steps"><h3 id="add_config">创建配置文件配置</h3><ol class="list _decimal"><li class="list__item" id="6a88d84b"><p>在工具栏中的配置文件配置列表中，选择<span class="control">Edit Configurations…</span> 。</p></li><li class="list__item" id="32fe92a6"><p>在打开的“性能<span class="control">分析配置”</span>窗口中，单击<img alt="添加配置文件配置" title="添加配置文件配置" src="/help/img/rider/2019.2/ThemedIcon.AddPattern.Screen.[Gray].png" id="9d34aced" width="12" height="12" class="inline-icon-12">添加新的配置文件配置。</p></li><li class="list__item" id="736c9623">                    <p id="dbe99438">指定配置<span class="control">名称</span>和其他分析选项：</p>                    <ul class="list _ul"><li class="list__item" id="51e197b7">                            <span class="control">分析类型</span> <a name="profiling_type"></a>                <aside class="prompt" rel="51e197b7" id="0ab19aa5" data-type="note" data-title="">                    <p id="3fe928ed">*当dotTrace附加到概要分析进程时不支持。</p>                </aside>                <div class="table-wrapper"><table class=" wide" width="100%" id="b49fb405"><thead><tr id="f7ea611b" class="ijRowHead"><th id="a4ea24c9"><p>分析方法</p></th><th id="aecf3ebb" width="120"><p>分析类型</p></th><th id="fb6ca220"><p>描述</p></th><th id="40c6a177"><p>用例</p></th></tr></thead><tbody><tr id="b864a602" class="ijRowOdd"><td id="388278fa" rowspan="3"><p>                            <b id="3ed02660" origin="dotnet">                                <font style="color:#003399">                                    <b id="b044daca" origin="dotnet">性能分析</b>                                </font>                            </b>                            <br>有关函数调用的详细时序信息。</p></td><td id="9bdb4e46">                            <span class="control">采样</span>                        </td><td id="838bb770"><p>准确的时间测量，未测量通话次数。</p></td><td id="ccea3d98"><p>                            <i id="e7840054" origin="dotnet">推荐用于大多数情况</i> 。首次在应用程序中发现性能问题时的理想选择。</p></td></tr><tr id="78fc9bb2" class="ijRowEven"><td id="82c6e2a2">                            <span class="control">追踪*</span>                        </td><td id="f927853c"><p>准确的电话号码测量，时间测量可能由于配置开销而不准确。</p></td><td id="a6859a08"><p>采样数据不足时。例如，用于分析算法复杂性（当有关呼叫次数的信息比呼叫时间值更有价值时）。</p></td></tr><tr id="6d19cfeb" class="ijRowOdd"><td id="b1f47f23">                            <span class="control">逐行*</span>                        </td><td id="90d5fc5f"><p>测量每一行代码，由于巨大的分析器开销，因此调用时间值不正确。<br>                                                    </p></td><td id="06020873"><p>仅用于高级用例。例如，当您已经知道什么功能导致问题并希望分析它的每一行时。</p></td></tr><tr id="f85385bd" class="ijRowEven"><td id="76580538"><p>                            <b id="07ef1710" origin="dotnet">                                <font style="color:#003399">                                    <b id="50adeeaa" origin="dotnet">时间线分析</b>                                </font>                            </b>                            <br>有关应用程序线程和事件的详细时间数据。</p></td><td id="04571b61">                            <span class="control">时间线</span>                        </td><td id="829d4d0e">                            <p id="2c9f7189">收集有关线程状态，应用程序事件的时间数据以及其他多线程数据。基于Windows事件跟踪（ETW）。</p>                            <p id="8f19cfb4">如果要创建用于分析Mono或Unity应用程序的配置，请相应地选择“ <span class="control">时间轴（Mono）”</span>或“ <span class="control">时间轴（Unity）”</span> 。</p>                        </td><td id="0d1f925e"><p><i id="42c9305f" origin="dotnet">推荐用于大多数情况</i> 。特别是用于分析多线程应用程序。例如，使用它来确定UI死机，垃圾回收过多，工作负载分配不均匀，I / O不足等的原因。</p></td></tr></tbody></table></div>                                                                </li><li class="list__item" id="aad53999">                            <ul class="list _ul"><li class="list__item" id="736f649a">                                    <p id="fd6c3569">                                        <span class="control">手动控制配置文件</span>                                        <br>使您可以通过探查器控件手动控制配置文件。例如，要拍摄快照，您必须单击<span class="control">获取快照</span> 。</p>                                    <ul class="list _ul"><li class="list__item" id="9f053c94">                                            <p id="723d1846">                                                <span class="control">从开始收集分析数据</span> *</p>                                            <p id="2b4979e0">                                                <span class="control">从开始收集概要分析数据</span> ：如果选中，则dotTrace将在启动后立即开始收集概要分析数据。否则，仅在您单击<a href="Performance_Profiler_window.html">Performance Profiler</a>工具窗口中的“ <span class="control">开始记录”</span>后，dotTrace才会开始收集数据。</p>                                                                                    </li></ul>                                </li><li class="list__item" id="c648433b"><p>                                    <span class="control">通过API控制配置文件</span>                                    <br>使您可以直接从配置文件应用程序的代码控制配置文件。例如，在代码的确切位置拍摄快照。在<a href="https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html" rel="noopener noreferrer" data-external="true" target="_blank">dotTrace文档中</a>了解有关使用API的更多信息。</p></li></ul>                        </li><li class="list__item" id="cb5f98d0"><p>                            <span class="control">分析子进程</span>                            <br>如果选中，则dotTrace不仅将概要分析主应用程序进程，而且还将概要分析其运行的进程。</p></li><li class="list__item" id="93ab3225">            <p id="82ac1592">                <span class="control">时间测量</span>                <br>此选项定义dotTrace如何计算呼叫时间。有关更多详细信息，请参阅<a href="https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Setting_the_Right_Meter_Kind.html" rel="noopener noreferrer" data-external="true" target="_blank">https://www.jetbrains.com/help/profiler/Profiling_Guidelines__Setting_the_Right_Meter_Kind.html</a> 。<br>通常，这是在线程不工作时dotTrace是否应该计算时间之间进行选择。更具体地说，有四个选项：</p>            <ul class="list _ul"><li class="list__item" id="4753fd50"><p>                    <span class="control">实时（性能计数器）</span>                    <br>                    <i id="19d73c75" origin="dotnet">推荐</i> 。 dotTrace计算方法进入和退出之间传递的整体实时时间。这一次不取决于应用程序线程状态。使用系统性能计数器计算时间。</p></li><li class="list__item" id="82f21eb2"><p>                    <span class="control">实时（CPU指令）</span>                    <br>dotTrace计算方法进入和退出之间传递的整体实时时间。这一次不取决于应用程序线程状态。时间是使用CPU寄存器计算的。</p></li><li class="list__item" id="6c98603d"><p>                    <span class="control">线程时间</span>                    <br>dotTrace仅计算特定线程正在运行的时间。计算中不包括线程等待或休眠的时间。</p></li><li class="list__item" id="a9f482d1"><p>                    <span class="control">线程循环时间</span>                    <br>dotTrace仅计算特定线程正在运行的时间。计算中不包括线程等待或休眠的时间。时间是使用CPU寄存器计算的。</p></li></ul>            <p id="5e2b9101">本节接下来的表格将帮助您选择一种更适合您的情况的时间测量方法。</p>        </li><li class="list__item" id="355913eb"><p>            <span class="control">启用内联</span>            <br>（逐行跟踪）如果希望dotTrace关闭JIT内联并获得与应用程序源代码结构极为相似的调用堆栈，请清除此选项。</p></li><li class="list__item" id="eeef9458"><p>            <span class="control">高精确度</span>            <br>（跟踪，逐行）如果选中，则dotTrace将通过获取更多时间样本来考虑在探查器自身中花费的时间。</p></li><li class="list__item" id="native"><p>            <span class="control">收集本地分配</span>            <br>（时间轴）如果选中，则dotTrace将收集有关配置文件的应用程序在本机（非托管）堆中进行的所有内存分配的信息。为了能够选择此选项，您必须在计算机上安装<a href="https://msdn.microsoft.com/en-gb/windows/hardware/commercialize/test/wpt/index" rel="noopener noreferrer" data-external="true" target="_blank">Windows Performance Toolkit</a> 。</p></li><li class="list__item" id="debug"><p>            <span class="control">收集调试输出</span>            <br>（时间轴）如果选中，则dotTrace将收集有关已概要分析的应用程序发送到<a href="https://www.jetbrains.com/help/profiler/Debug_Output.html" rel="noopener noreferrer" data-external="true" target="_blank">调试输出的</a>所有消息的信息。</p></li><li class="list__item" id="tpl"><p>            <span class="control">收集TPL事件</span>            <br>（时间轴）如果选择此选项，则性能可能会受到影响，但是dotTrace将收集任务并行库（TPL）数据。如果清除，将不会有<code class="code">Task</code> <span class="control">呼叫树中的</span>节点和<code class="code">async</code>呼叫节点将缺少<span class="control">等待</span>和<span class="control">继续</span>部分。在<a href="https://www.jetbrains.com/help/profiler/Analyzing_Async_Calls.xml" rel="noopener noreferrer" data-external="true" target="_blank">https://www.jetbrains.com/help/profiler/Analyzing_Async_Calls.xml中</a>了解有关dotTrace如何与异步代码一起使用的更多信息。<br>如果您的应用程序不使用多任务处理或您不需要此信息，请清除此选项。</p></li></ul>                </li></ol></section>        </div>        <div class="chapter"><h2 id="step-2-running-the-session-and-getting-snapshots" data-toc="Profiling_Any_.NET_Processes#step-2-running-the-session-and-getting-snapshots">第2步。运行会话并获取快照</h2>            <section class="procedure-steps"><h3 id="37f5148f">开始会话并获取快照</h3><ol class="list _decimal"><li class="list__item" id="1f19f497">                    <p id="d56d68a8">在主菜单中，选择<span class="menupath" data-skip-index="skip">运行|附加到带有分析的流程</span>或单击相应的按钮<img alt="附加到带有分析的流程" title="附加到带有分析的流程" src="/help/img/rider/2019.2/icon_attach_profile.png" id="ce880979" width="16" height="16" class="inline-icon-16">在工具栏上。这将打开正在运行的进程的列表。</p>                </li><li class="list__item" id="e8443df0">                    <aside class="prompt" rel="e8443df0" id="da549b97" data-type="note" data-title=""><p>附加到.NET Core进程时，请注意仅支持.NET Core 3.0 Preview 7（或更高版本）进程。</p></aside>                    <p id="212ea34d">选择要分析的进程（请注意，该进程必须是托管的.NET进程）和要使用的配置文件配置。</p>                    <p id="5e03b485">分析开始后，您将在“ <span class="control">分析”</span>选项卡上打开“ <a href="Performance_Profiler_window.html">性能分析器”</a>工具窗口，其中包含分析控制器。</p>                </li><li class="list__item" id="e9c847e4"><p>如果在性能分析配置中禁用了<span class="control">从一开始就收集性能数据</span> ，请单击<img alt="开始录音" title="开始录音" src="/help/img/rider/2019.2/icon_start_profiling.png" id="faad995b" width="12" height="12" class="inline-icon-12"> <span class="control">开始记录</span>开始记录分析数据。<br>基本上，现在您所需要的只是重现您正在寻找的性能问题，或者，如果您只是评估应用程序的整体性能，请在应用程序中仔细查看所需的使用场景。</p></li><li class="list__item" id="96aa2da2"><p>请点击<img alt="获取性能快照骑士" title="获取性能快照骑士" src="/help/img/rider/2019.2/icon_get_snapshot.png" id="3d379dbe" width="10" height="10" class="inline-icon-10"> <span class="control">获取快照</span> 。收集的快照将被添加到<span class="control">Performance Profiler</span>窗口内的快照列表中。要再次开始收集分析数据，请单击<img alt="开始录音" title="开始录音" src="/help/img/rider/2019.2/icon_start_profiling.png" id="42cd1f2c" width="12" height="12" class="inline-icon-12"> <span class="control">再开始录制</span>一次。</p></li><li class="list__item" id="53e9a2f5"><p>收集快照后，即可完成性能分析会话。通常，您可以通过关闭已概要分析的应用程序或通过<img alt="分离探查器" title="分离探查器" src="/help/img/rider/2019.2/icon_detach_profiler.png" id="a2862032" width="16" height="16" class="inline-icon-16"> <span class="control">分离</span>按钮（ <img alt="杀死进程" title="杀死进程" src="/help/img/rider/2019.2/icon_kill_profiled_app.png" id="3bac2d95" width="16" height="15" class="inline-icon-16"> <span class="control">Kill</span>强行终止已配置的应用程序和会话，因此，仅在紧急情况下使用它）。</p></li></ol></section>        </div>        <div class="chapter"><h2 id="step-3-analyzing-collected-snap" data-toc="Profiling_Any_.NET_Processes#step-3-analyzing-collected-snap">第三步分析收集的快照</h2>            <p id="8397122b">有关如何分析性能快照的更多详细信息，请参阅分析性能<a href="Analyzing_Profiling_Snapshots.html">分析结果</a> 。</p>            <section class="procedure-steps"><h3 id="3a61d3d6">分析快照</h3><ol class="list _decimal"><li class="list__item" id="114d6b14"><p>在“ <a href="Performance_Profiler_window.html">性能分析器”</a>工具窗口的“ <span class="control">所有快照”</span>选项卡上，选择要分析的快照。</p></li><li class="list__item" id="6ff9a209">                    <p id="62c9db18">使用以下视图之一分析收集的数据：</p>                    <ul class="list _ul"><li class="list__item" id="fe5c8eab"><p>                            <span class="control">调用树</span> ：“经典”调用树，向您显示所有线程中的所有方法调用。每个顶级节点代表一个由某个线程执行的顶级功能。使用此视图可以快速了解实际的应用程序活动。<a href="https://www.jetbrains.com/help/profiler/Call_Tree.html" rel="noopener noreferrer" data-external="true" target="_blank">学到更多</a>                                                    </p></li><li class="list__item" id="e77caa47"><p>                            <span class="control">最佳方法</span> ：分析应用程序性能时的最佳起点。它是执行时间最长的简单方法列表。请注意，您可以使用以下命令将系统功能“噪声”从列表中排除： <img alt="隐藏系统功能" title="隐藏系统功能" src="/help/img/rider/2019.2/icon_hide_system_functions_profiler.png" id="4188c4ac" width="16" height="16" class="inline-icon-16">切换：如果启用，则方法的执行时间将计算为方法本身的时间与所有子系统方法的时间（直到堆栈中的下一个用户方法）之和。<a href="https://www.jetbrains.com/help/profiler/Plain_List.html" rel="noopener noreferrer" data-external="true" target="_blank">学到更多</a>                                                    </p></li></ul>                </li><li class="list__item" id="83c29fe6"><p>找到可疑方法后，按<kbd data-visual_studio="F4" data-resharper="F4" data-_default="F4" data-visual_studio_osx="⌘ Down" data-resharper_osx="⌘ Down" data-mac_os_x_10.5_="⌘ Down">F4</kbd>或从上下文菜单中选择“ <span class="control">跳转到源代码</span> ”。骑士将向您导航该方法的源代码。</p></li></ol></section>        </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profiling_Unit_Tests.html">分析单元测试</a> <a class="navigation-links__next" href="Analyzing_Profiling_Snapshots.html">分析结果</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>