<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta content="&#xA;        External annotations. Using JetBrains annotations (ReSharper annotations) on compiled libraries.&#xA;    " name="description" data-skip-index="skip"><meta charset="UTF-8"><title>External Annotations - Help | JetBrains Rider</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Code_Analysis__External_Annotations" data-disqus-id="Code_Analysis__External_Annotations_rdr"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search JetBrains Rider Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>JetBrains Rider 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="visual_studio" selected>Visual Studio</option><option data-group="primary" value="resharper">ReSharper</option><option data-group="primary" value="_default">Default (IntelliJ IDEA)</option><option data-group="secondary" value="visual_studio_osx">Visual Studio (macOS)</option><option data-group="secondary" value="resharper_osx">ReSharper (macOS)</option><option data-group="secondary" value="mac_os_x_10.5_">Mac OS X 10.5+ (IntelliJ IDEA)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="Code_Analysis__External_Annotations" id="Code_Analysis__External_Annotations.xml">External Annotations</h1>        <div class="chapter"><h2 id="how_it_works" data-toc="Code_Analysis__External_Annotations#how_it_works">How it works</h2>        <p id="7dbe5e9f">            If you are using an external library, whose sources are not available to you,            it does not seem feasible to use the attributes there for specifying code annotations.        </p>        <p id="e9275625">            In this case, you can use            <i id="12f2600a">External Annotations</i>, which allow you to complement the already compiled entities with attributes            recognized by JetBrains Rider's code analysis engine.            External annotations let you 'cheat' the engine, by making it see the attributes            (for methods, parameters and other declarations),            which were not declared at the time the library was compiled.        </p>        <p id="17506119">            External annotations are specified in XML files.            When loading solution, JetBrains Rider looks for specifically named XML files in specific locations and            reads annotations from there.            These XML files have a structure similar to XmlDoc.            For example, to annotate the method            <code class="code">XmlReader.Create(Stream input)</code>            from the assembly            <code class="code">System.Xml</code>            of .NET Framework 4.0, with the            <code class="code">NotNull</code>            contracts, the XML file would look as follows:        </p>        <div class="code-block" data-lang="XML">
&lt;assembly name="System.Xml, Version=4.0.0.0"&gt;
    &lt;!--The attribute name contains the assembly name. If you don't specify the version,
    this file's attributes will be applied to all versions of the assemblies of that name --&gt;
    &lt;member name="M:System.Xml.XmlReader.Create(System.IO.Stream)"&gt;
        &lt;!--This shows the name of the member whose attributes are complemented;
        the notation is the same as XmlDoc --&gt;
        &lt;attribute ctor="M:JetBrains.Annotations.NotNullAttribute.#ctor" /&gt;
            &lt;!--attribute constructor names are also specified using XmlDoc notation --&gt;
        &lt;parameter name="input"&gt;
            &lt;attribute ctor="M:JetBrains.Annotations.NotNullAttribute.#ctor" /&gt;
        &lt;/parameter&gt;
    &lt;/member&gt;
&lt;/assembly&gt;</div>    </div>    <div class="chapter"><h2 id="jb" data-toc="Code_Analysis__External_Annotations#jb">JetBrains external annotations</h2>        <p id="34e7a195">            The approach described above was used to annotate a huge amount of symbols in the .NET Framework Class            Library, as well as in other frequently used libraries.            External annotations for these libraries are installed with JetBrains Rider to ensure better code analysis.            Some features (for example, ASP.NET MVC 5.2 support) are also rely on external annotations.        </p>        <p id="e43cd23f">            The source code of JetBrains external annotations is available under the MIT license on GitHub:            <a href="https://github.com/JetBrains/ExternalAnnotations" data-external="true" target="_blank" rel="noopener noreferrer"><span>https://github.com/JetBrains/ExternalAnnotations</span></a>.            You are welcome to contribute to this repository or use it as an example for your own external annotations.        </p>    </div>    <div class="chapter"><h2 id="creating" data-toc="Code_Analysis__External_Annotations#creating">Creating external annotations</h2>        <p id="9b21904a">            You can create external annotations to specify contracts for any compiled assembly.            To make sure JetBrains Rider recognizes the XML file with external annotations, this file should be named            <span class="filepath">[AssemblyName].ExternalAnnotations.xml</span>.            Depending on how you are going to use the annotated binaries, you can create annotations files in            the following places:        </p>        <ul class="list _ul"><li class="list__item" id="5495c180"><p>                If you are going to publish some binaries (for example, via NuGet), place the annotations                <span class="filepath">*.xml</span> file in the same folder where the annotated                <span class="filepath">*.dll</span>                file is located.            </p></li><li class="list__item" id="859920c4"><p>                If you want to annotate some binaries included in your project, place the annotations                <span class="filepath">*.xml</span> files with the corresponding name for each assembly in the                <span class="filepath">ExternalAnnotations</span> folder next to the project or solution file.                <br>                This way you can also keep the annotations under a VCS so that your team could benefit from them.            </p></li></ul>        <aside class="tip sideblock" data-title="" rel="b15e1832" id="f382079f">            <p id="43d66d3a">                You can use JetBrains Rider annotations as a reference when creating your own annotations.                To study JetBrains Rider external annotations, look at XML files in subdirectories of the                <span class="filepath">[JetBrains Rider installation directory]\ExternalAnnotations</span> directory.            </p>        </aside>        <p id="82eefbdf">            To illustrate creating external annotations, imagine that you use a            <span class="filepath">TestLib</span> assembly that has            <code class="code">MyTestClass</code> class with            <code class="code">static string ReverseString(String inputString)</code> method.            Suppose, that from the assembly documentation,            you know that the method is pure and never returns null, and its parameter should never be null.        </p>        <p id="98260846">            Initially, JetBrains Rider is not aware of how            <code class="code">ReverseString</code> works, and therefore it finds no problems in the following code:        </p>        <figure><img alt="External annotations" title="External annotations" src="/help/img/dotnet/2018.3/external_annotations_0.png" id="3ed2a2e2" width="370" height="59"></figure>        <section class="procedure-steps"><h2 id="fb04a67c">To create external annotations for a compiled assembly</h2><ol class="list _decimal"><li class="list__item" id="0afe00fd"><p>                Locate the                <span class="filepath">TestLib.dll</span> on your file system and create a file named                <span class="filepath">TestLib.ExternalAnnotations.xml</span> either in the same folder or in the                <span class="filepath">ExternalAnnotations</span> folder next to the project or solution file where                <span class="filepath">TestLib.dll</span> is referenced.            </p></li><li class="list__item" id="08615090">                Open                <span class="filepath">TestLib.ExternalAnnotations.xml</span> for editing and type in the following:                <p id="8f3b685a">                    <div class="code-block" data-lang="XML">&lt;assembly name="TestLib"&gt;
    &lt;member name="M:TestLib.MyTestClass.ReverseString(System.String)"&gt;
        &lt;attribute ctor="M:JetBrains.Annotations.NotNullAttribute.#ctor" /&gt;
        &lt;attribute ctor="M:JetBrains.Annotations.PureAttribute.#ctor" /&gt;
        &lt;parameter name="inputString"&gt;
            &lt;attribute ctor="M:JetBrains.Annotations.NotNullAttribute.#ctor" /&gt;
        &lt;/parameter&gt;
    &lt;/member&gt;
&lt;/assembly&gt;</div>                </p>            </li><li class="list__item" id="9b4a8488"><p>                                Restart JetBrains Rider and open your solution.                                Now JetBrains Rider detects incorrect usage of                <code class="code">ReverseString</code> and highlights the problem with the null parameter:                <figure><img alt="External annotations" title="External annotations" src="/help/img/dotnet/2018.3/external_annotations_1.png" id="e14d8a6a" width="540" height="72"></figure>                ... and the unnecessary check of the return value:                <figure><img alt="External annotations" title="External annotations" src="/help/img/dotnet/2018.3/external_annotations_2.png" id="8d422821" width="380" height="85"></figure>            </p></li><li class="list__item" id="9acfe97c"><p>                To see, which external annotations are applied to a library symbol, you can use the                <a href="Coding_Assistance__Quick_Documentation.html"><span>Quick Documentation</span></a> feature. Just press                                <kbd data-visual_studio="Ctrl+Shift+F1" data-resharper="Ctrl+Q" data-_default="Ctrl+Q" data-visual_studio_osx="^ ⇧ F1" data-resharper_osx="^ Q" data-mac_os_x_10.5_="F1">Ctrl+Shift+F1</kbd>                over the symbol to study its attributes.                In our case, we can see that                <code class="code">ReverseString</code> is annotated with                <code class="code">[NotNull]</code> and                <code class="code">[Pure]</code> attributes and the parameter is annotated with                <code class="code">[NotNull]</code>:                <figure><img alt="Viewing quick documentation" title="Viewing quick documentation" src="/help/img/dotnet/2018.3/attributes_quick_doc.png" id="6d03e414" width="445" height="180"></figure>                The grey color of the attributes means that they come not from assembly code, but from external annotations.            </p></li></ol></section>            </div>            <div class="last-modified" data-skip-index="skip">Last modified: 25 April 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Code_Analysis__Annotations_in_Source_Code.html">Annotations in Source Code</a><a class="navigation-links__next" href="Contract_Annotations.html">Contract Annotations</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>Concepts:</h3><ul class="list"><li class="list__item"><a href="Code_Analysis__Index.html"><span>Code Analysis</span></a></li><li class="list__item"><a href="Code_Analysis__Code_Annotations.html"><span>Using Annotations to Refine Code Inspection</span></a></li></ul></div><div class="seealso__col" data-skip-index="skip"><h3>Procedures:</h3><ul class="list"><li class="list__item"><a href="Code_Analysis__Annotations_in_Source_Code.html"><span>Annotations in Source Code</span></a></li><li class="list__item"><a href="Code_Analysis__String_Formatting_Methods.html"><span>Code Analysis and Helpers for String Literals</span></a></li><li class="list__item"><a href="Code_Analysis__Value_Analysis.html"><span>Value and Nullability Analysis</span></a></li></ul></div><div class="seealso__col" data-skip-index="skip"><h3>Reference:</h3><ul class="list"><li class="list__item"><a href="Reference__Code_Annotation_Attributes.html"><span>Code Annotation Attributes</span></a></li></ul></div><div class="seealso__col" data-skip-index="skip"><h3>External Links:</h3><ul class="list"><li class="list__item"><a href="http://hmemcpy.com/2013/03/even-more-resharper-annotations-hackery-marking-3rd-party-code-as-obsolete/" data-external="true" target="_blank" rel="noopener noreferrer"><span>Igal Tabachnik: Even more ReSharper Annotations hackery: marking 3rd party code as obsolete</span></a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>