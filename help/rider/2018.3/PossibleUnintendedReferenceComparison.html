<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Code Inspection: Possible unintended reference comparison - Help | JetBrains Rider</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="PossibleUnintendedReferenceComparison" data-disqus-id="PossibleUnintendedReferenceComparison_rdr"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search JetBrains Rider Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>JetBrains Rider 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="visual_studio" selected>Visual Studio</option><option data-group="primary" value="resharper">ReSharper</option><option data-group="primary" value="_default">Default (IntelliJ IDEA)</option><option data-group="secondary" value="visual_studio_osx">Visual Studio (macOS)</option><option data-group="secondary" value="resharper_osx">ReSharper (macOS)</option><option data-group="secondary" value="mac_os_x_10.5_">Mac OS X 10.5+ (IntelliJ IDEA)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PossibleUnintendedReferenceComparison" id="PossibleUnintendedReferenceComparison.xml">Code Inspection: Possible unintended reference comparison</h1>    <p id="ff690612">        C# compiler issues the 'Possible unintended reference comparison' warnings        (<a href="https://msdn.microsoft.com/en-us/library/f6dtw2ah.aspx" data-external="true" target="_blank" rel="noopener noreferrer"><span>CS0252</span></a>/        <a href="https://msdn.microsoft.com/en-us/library/etywy2s3.aspx" data-external="true" target="_blank" rel="noopener noreferrer"><span>CS0253</span></a>)        in cases where you use equality operators (<code class="code">==</code> or        <code class="code">!=</code>) on objects of types that inherit from one another and only one of the types overrides        these operators.    </p>    <p id="418399b1">        The fact that the equality operators are overridden in one of the types means that        <i id="f4a14b38">value equality</i> is expected when objects of this type are compared.        Comparing these objects with objects of types where the equality operators are not overridden will lead        to using the overload from        <code class="code">System.Object</code>, which checks        <i id="50185bb0">reference equality</i>.        So a warning is issued because comparing object references is most likely erroneous in this situation.    </p>    <p id="21e2a07c">        Although JetBrains Rider knows about these warnings and provides        <a href="Design_time_Inspection.html">design-time notifications</a> for them, it goes one step further        and detects another case of possible unintended reference comparison —        when only one of the compared types overrides        <code class="code">Equals()</code>.        <a href="https://msdn.microsoft.com/en-us/library/ms173147.aspx" data-external="true" target="_blank" rel="noopener noreferrer"><span>MSDN documentation</span></a> says:        <i id="cbd3566e">Any class that represents a value, essentially any value type,            or a set of values as a group, such as a complex number class, should override Equals.</i>        So if        <code class="code">Equals()</code> is not overridden for the second object's type, then the comparison falls back to        the implementation of        <code class="code">Equals()</code> in        <code class="code">System.Object</code>, which performs a reference identity check,        which is most probably not desired for a value type.    </p>            <aside class="tip sideblock" data-title="" rel="21e2a07c" id="3c5a5c52">            <p id="6a9dc53d">                You can configure this inspection:            </p>            <ul class="list _ul"><li class="list__item" id="de727f70"><a href="Code_Analysis__Configuring_Warnings.html#disable">disable it to ignore all related issues</a></li><li class="list__item" id="53944465"><a href="Code_Analysis__Configuring_Warnings.html#suppress">suppress it in any place in the code to ignore specific issues</a></li><li class="list__item" id="ede413ca"><p><a href="Code_Analysis__Configuring_Warnings.html#change_severity">change its severity level                    to make the detected issues less or more noticeable</a>                </p></li></ul>        </aside>        <p id="f9eebc0e">        Here is a code listing that illustrates both situations:    </p><div class="code-block" data-lang="C#">
class MyType
{
}

class TypeWithEquals : MyType
{
    public override bool Equals(object obj)
    {
      throw new NotImplementedException();
    }
}

class TypeWithEqOperators : MyType
{
    public static bool operator ==(TypeWithEqOperators left, TypeWithEqOperators right)
    {
      throw new NotImplementedException();
    }

    public static bool operator !=(TypeWithEqOperators left, TypeWithEqOperators right)
    {
      throw new NotImplementedException();
    }
}

class Test
{
    public Test(TypeWithEquals withEquals, TypeWithEqOperators withEqOperators, MyType parentObject)
    {
      bool a = withEqOperators == parentObject; // CS0253
      bool b = withEquals == parentObject;  // No compiler warnings, but JetBrains Rider issues its own warning here
    }
}
</div>    <p id="93ca10c0">        Another case for this inspection is comparing interface types using equality operators (<code class="code">==</code> or        <code class="code">!=</code>).        As these operators are static, the compiler will default to        <code class="code">System.Object.ReferenceEquals()</code> — that is to the reference comparison —        even if the equality operators are overridden to value comparison in the interface implementations.        <br>        JetBrains Rider looks for interface implementations that override equality operators and/or        <code class="code">Equals()</code>, and if it detects such an implementation it issues a warning:    </p>    <div class="code-block" data-lang="C#">

interface ISomeInterface{ }

class SomeImplementation : ISomeInterface
{
    public override bool Equals(object obj) =&gt; throw new NotImplementedException();

    public override int GetHashCode() =&gt;  throw new NotImplementedException();
}

void ATest(ISomeInterface x, ISomeInterface y)
{
    bool a = x == y; //Possible unintended reference comparison
}

    </div>    <p id="3fb567d1">        Note that this inspection will look for interface implementations in the whole solution        (including referenced libraries), whose locations are not always obvious.        In the example below, JetBrains Rider will detect implementations of        <code class="code">ICollection&lt;object&gt;</code> that override        <code class="code">Equals()</code> in the mscorlib and issue a warning even if none of your own implementations of        <code class="code">ICollection&lt;object&gt;</code> override        <code class="code">Equals()</code> or equality operators.    </p>    <div class="code-block" data-lang="C#">
        
void SomeTest(ICollection&lt;object&gt; x, ICollection&lt;object&gt; y)
{
    bool a = x == y; //Possible unintended reference comparison
}
        
    </div>    <p id="c32d003c">        Although this case may seem a bit defensive, your code might be more straightforward and probably safer        if you use non-static methods for comparing interfaces.        That is, you can use        <code class="code">ReferenceEquals()</code> if you mean to check reference equality, or        <code class="code">Equals()</code> if you expect it to be overridden in the implementations,        or any specific method, for example        <code class="code">Enumerable.SequenceEqual()</code>,        which checks whether collections contain equal objects in the same order.    </p>    <div class="last-modified" data-skip-index="skip">Last modified: 25 April 2019 </div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>Concepts:</h3><ul class="list"><li class="list__item"><a href="Finding_Code_Issues.html"><span>Finding Code Issues with Code Inspection</span></a></li><li class="list__item"><a href="Code_Analysis__Code_Inspections.html"><span>Code Inspections</span></a></li><li class="list__item"><a href="Design_time_Inspection.html"><span>Detecting Code Issues in Design Time</span></a></li></ul></div><div class="seealso__col" data-skip-index="skip"><h3>External Links:</h3><ul class="list"><li class="list__item"><a href="https://msdn.microsoft.com/en-us/library/ms173147.aspx" data-external="true" target="_blank" rel="noopener noreferrer"><span>MSDN: Guidelines for Overriding Equals() and Operator == (C# Programming Guide)</span></a></li><li class="list__item"><a href="http://stackoverflow.com/questions/12263715/possible-unintended-reference-comparison" data-external="true" target="_blank" rel="noopener noreferrer"><span>StackOverflow: Possible unintended reference comparison</span></a></li><li class="list__item"><a href="https://stackoverflow.com/questions/41495792/c-sharp-equality-operator-with-list-of-interface-type-not-working-as-expected" data-external="true" target="_blank" rel="noopener noreferrer"><span>StackOverflow: C# - equality operator with list of interface type not working as expected</span></a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>