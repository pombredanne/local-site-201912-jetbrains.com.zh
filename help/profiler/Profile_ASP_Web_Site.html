<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta name="description" content="
        ASP.NET performance profiling, performance profiling of web application,
        performance profile IIS site, IIS server performance profiling
    " data-skip-index="skip"><title>IIS服务器上的Profile Web Application-帮助|帮助dotTrace</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Profile_ASP_Web_Site" data-disqus-id="Profile_ASP_Web_Site_dt"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotTrace帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotTrace 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Profile_ASP_Web_Site.xml" data-toc="Profile_ASP_Web_Site">IIS服务器上的配置文件Web应用程序</h1>                <p id="f8251958">通常，当Web应用程序已经在服务器上运行时，需要确定其性能问题。下表总结了对应用程序进行性能分析的所有可能选项：</p>    <div class="table-wrapper"><table class=" wide" width="100%" id="c7c57835"><thead><tr id="0f237120" class="ijRowHead"><th id="9858458f"></th><th id="f171f33c" width="30%"><p>优点</p></th><th id="cf23f1ac" width="30%"><p>不是缺点而是功能</p></th></tr></thead><tbody><tr id="26a30912" class="ijRowOdd"><td id="643e840f">                <a href="#local-profiling">本地分析</a>            </td><td id="ada39f1a">                <ul class="list _ul"><li class="list__item" id="2ae997a9"><p>易于配置/使用：您可以通过dotTrace GUI进行配置</p></li></ul>            </td><td id="bb918776">                <ul class="list _ul"><li class="list__item" id="b91ca1e8"><p>必须在服务器上安装并运行dotTrace，由于安全限制，缺少GUI等原因，可能无法实现</p></li></ul>            </td></tr><tr id="5482d883" class="ijRowEven"><td id="14f5ed26">                <a href="#remote-profiling">远程分析</a>            </td><td id="dd2ff1c1">                <ul class="list _ul"><li class="list__item" id="a1e06344"><p>易于配置/使用：您可以通过dotTrace GUI进行配置</p></li><li class="list__item" id="4aad8983"><p>快照会自动上传到本地计算机</p></li></ul>            </td><td id="4ee59bf7">                <ul class="list _ul"><li class="list__item" id="87483890"><p>dotTrace远程代理必须已安装并在服务器上运行</p></li><li class="list__item" id="139f5db0"><p>需要通过网络通讯</p></li></ul>            </td></tr><tr id="8f4a1f35" class="ijRowOdd"><td id="7382e79b">                <a href="#profiling-via-console-tools">通过控制台工具进行性能分析</a>            </td><td id="7fef44f7">                <ul class="list _ul"><li class="list__item" id="cbf1c5c7"><p>无需网络通讯</p></li><li class="list__item" id="44dbcc63"><p>能够创建许多预定义的分析配置并按需运行它们</p></li></ul>            </td><td id="543ce73b">                <ul class="list _ul"><li class="list__item" id="bc275483"><p>控制台工具必须复制到服务器上并在服务器上运行</p></li><li class="list__item" id="ab4157b8"><p>必须使用dotTrace将生成的快照手动从服务器复制到计算机。</p></li></ul>            </td></tr></tbody></table></div>    <div class="chapter"><h2 id="local-profiling">本地分析</h2>        <figure><img alt="本地分析" title="本地分析" src="/help/img/dotnet/2019.2/how_to_app_server_local.png" id="2097401d" width="291" height="355"></figure>        <p id="247759a3">通常，当您需要对直接在（开发人员）计算机或某些测试环境上托管的应用进行配置文件时，会使用本地配置文件，而这并没有施加任何安全/性能限制。</p>        <section class="procedure-steps"><h3 id="dt_local">本地配置IIS服务器上托管的Web应用程序</h3><ol class="list _decimal"><li class="list__item" id="68fe22d9"><p>在服务器上安装dotTrace。</p></li><li class="list__item" id="2f7b8021"><p>                <a href="Profiling_Guidelines__Index.html">将dotTrace作为独立的应用程序运行</a> 。dotTrace <span class="control">主页</span>窗口将打开。</p></li><li class="list__item" id="b4af291e"><p>在右侧面板中，选择<span class="control">Profile Profile App</span> 。</p></li><li class="list__item" id="26bac3d3"><p>在中央面板的<span class="control">Profile Application中</span> ，选择<span class="control">IIS</span> 。</p></li><li class="list__item" id="02e77447"><p>在右面板的“ <span class="control">应用程序选项”中</span> ，选择“ <span class="control">打开URL”</span>并指定配置文件应用程序的URL。如果您不这样做，则dotTrace将开始对其能够找到的第一个正在运行的应用程序池进行性能分析。</p></li><li class="list__item" id="cd5a5d38"><p>在右侧面板的<span class="control">Profiler Options中</span> ，指定分析类型。<br>有关探查器选项的更多详细信息，请参阅<a href="Profiler_Options.html">探查器选项</a>部分。</p></li><li class="list__item" id="8c87c52d"><p>（可选）如果要使用API（而不是<span class="control">Controller</span>窗口）控制分析会话（拍摄快照，结束会话等），请选择<span class="control">通过API控制分析</span> 。有关如何使用API控制分析的更多详细信息，请参阅<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">通过API控制分析会话</a> 。</p></li><li class="list__item" id="590c25ea"><p>点击<span class="control">运行</span> 。请注意，执行此操作后，将重新启动IIS服务，并因此重新启动配置文件应用程序池。</p></li><li class="list__item" id="bfa9104b"><p>拍摄快照。有关如何控制性能分析会话的更多详细信息，请参阅控制性能<a href="Profiling_Guidelines__Launching_and_Controlling_the_Profiling_Process.html">分析会话</a> （如果您手动控制性能分析）或<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">通过API</a>控制性能<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">分析会话</a> （如果您使用API控制性能分析）。</p></li><li class="list__item" id="490dc3de"><p>收集快照后，在“ <span class="control">控制器”</span>窗口上单击“ <span class="control">分离</span> ”，以将分析器与应用程序池分离。</p></li><li class="list__item" id="57970b12"><p>在<a href="Studying_Profiling_Results__Index.html">Performance Viewer</a>或<a href="Analyzing_Concurrency_Profiling_Results_Timeline_.html">Timeline Viewer中</a>分析收集的快照（取决于您选择的配置文件类型）。<br>请注意，快照包含大量本机代码是正常的。</p></li></ol></section>    </div>    <div class="chapter"><h2 id="remote-profiling">远程分析</h2>        <figure><img alt="远程分析" title="远程分析" src="/help/img/dotnet/2019.2/how_to_app_server_remote.png" id="7d57af78" width="617" height="351"></figure>        <p id="fc020116">当突然出现性能下降/内存问题时，远程分析是最佳选择。</p>        <p id="a891ff89">工作原理：dotTrace在本地计算机上运行，远程代理在服务器上运行，都通过TCP进行通信，就这么简单。关于远程分析的最好之处在于，您仍然可以使用易于使用的dotTrace GUI，并且收集的快照会自动复制到dotTrace中并在其中打开。</p>        <section class="procedure-steps"><h3 id="e27164d1">远程配置IIS服务器上托管的Web应用程序</h3><ol class="list _decimal"><li class="list__item" id="5c4fe960">                <p id="61cf0a92">在Web服务器上，执行以下操作：</p>                <ul class="list _ul"><li class="list__item" id="d690772e"><p>将<span class="filepath">RemoteAgent.zip</span>存档从本地计算机上的dotTrace安装目录（默认为<span class="filepath">C：\ Users \ [用户名] \ AppData \ Local \ JetBrains \ Installations \ dotTrace [N]</span> ） <span class="filepath">复制</span>到服务器上的任何目录。</p></li><li class="list__item" id="b9d1a0c6"><p>在服务器上解压缩存档。</p></li><li class="list__item" id="68d22ebc"><p>从服务器上的控制台启动<span class="filepath">RemoteAgent.exe</span> 。</p></li><li class="list__item" id="fb7898cc"><p>确保防火墙没有阻止与Remote Agent的入站连接（默认情况下为端口9100）。</p></li></ul>            </li><li class="list__item" id="f97cf69f"><p>在本地计算机上， <a href="Profiling_Guidelines__Index.html">将dotTrace作为独立的应用程序</a> <span>运行将dotTrace作为独立的应用</span> <a href="Profiling_Guidelines__Index.html">程序</a> <span>运行</span> 。dotTrace窗口将打开。</p></li><li class="list__item" id="b5774814"><p>在右侧窗格中，选择<span class="control">New Session |。配置文件远程应用程序</span> 。</p></li><li class="list__item" id="7423af94"><p>在中央面板的“ <span class="control">远程代理URL”中</span>指定远程代理服务的<span class="control">地址</span> 。<br>默认情况下，URL为<span class="filepath">net.tcp：// [remote_computer_IP_address]：9100 / RemoteAgent</span> 。</p></li><li class="list__item" id="c1dca404"><p>单击“ <span class="control">连接”</span>以建立与远程主机的连接。</p></li><li class="list__item" id="f306634f"><p>在中央面板的“ <span class="control">附加到正在运行的应用程序”中，</span>选择与<span class="control">运行配置文件的应用程序</span>的应用程序池相对应的<span class="filepath">w3wp.exe</span>进程。</p></li><li class="list__item" id="43ab5ff4"><p>（可选）如果要使用API（而不是<span class="control">Controller</span>窗口）控制分析会话（拍摄快照，结束会话等），请选择<span class="control">通过API控制分析</span> 。有关如何使用API控制分析的更多详细信息，请参阅<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">通过API控制分析会话</a> 。</p></li><li class="list__item" id="04b321fd"><p>在右侧面板中，单击<span class="control">运行</span> 。</p></li><li class="list__item" id="edf6f1cf"><p>拍摄快照。有关如何控制性能分析会话的更多详细信息，请参阅控制性能<a href="Profiling_Guidelines__Launching_and_Controlling_the_Profiling_Process.html">分析会话</a> （如果您手动控制性能分析）或<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">通过API</a>控制性能<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">分析会话</a> （如果您使用API控制性能分析）。</p></li><li class="list__item" id="fd7298d9"><p>收集快照后，在“ <span class="control">控制器”</span>窗口上单击“ <span class="control">分离</span> ”，以将分析器与应用程序池分离。</p></li><li class="list__item" id="a56fc977"><p>在<a href="Studying_Profiling_Results__Index.html">Performance Viewer</a>或<a href="Analyzing_Concurrency_Profiling_Results_Timeline_.html">Timeline Viewer中</a>分析收集的快照（取决于您选择的配置文件类型）。<br>请注意，快照包含大量本机代码是正常的。</p></li></ol></section>        <figure id="03d39bd2" width="700" data-theme="light"><img class="js-gif" src="/help/img/dotnet/2019.2/remote-profiling.png" width="700" data-gif-src="/help/img/dotnet/2019.2/remote-profiling.animated.gif" style="width:700px"></figure>    </div>    <div class="chapter"><h2 id="profiling-via-console-tools">通过控制台工具进行性能分析</h2>        <figure><img alt="使用控制台工具进行性能分析" title="使用控制台工具进行性能分析" src="/help/img/dotnet/2019.2/how_to_app_server_console.png" id="bc95198d" width="620" height="356"></figure>        <p id="5c119241">如果需要自动进行性能分析，则控制台工具是最好的：例如，您应该不时地配置Web应用程序。另一种可能的情况是，当您无权访问服务器而其他人有权访问服务器时，则可以为他们提供配置工具和批处理文件。</p>        <p id="de030d08">它是如何工作的？简而言之，您可以将控制台工具复制到服务器，然后在性能分析下运行该应用程序（应用程序池将重新启动），或者将该工具附加到正在运行的应用程序池<span class="filepath">w3wp.exe</span> 。</p>        <section class="procedure-steps"><h3 id="f1ccdab7">使用控制台工具在IIS服务器上分析Web应用程序</h3><ol class="list _decimal"><li class="list__item" id="1d4288a0"><p>使用<span class="filepath">ConsoleProfiler.exe</span>工具下载<a href="/profiler/download/#section=dottraceclt" rel="noopener noreferrer" data-external="true" target="_blank">zip存档</a> ，然后将其复制/解压缩到服务器。</p></li><li class="list__item" id="95550517"><p>现在，您应该开始对承载您的应用程序的应用程序池进行性能分析：您可以将其附加到已在运行的应用程序池，也可以在性能分析下启动一个新的应用程序池。启动新附件并没有比附加<a href="Performance_Profiling__Profiling_Using_the_Command_Line.html#console_profiler">附件有</a>任何优势，因此，我们仅看一下后者（您仍然可以<a href="Performance_Profiling__Profiling_Using_the_Command_Line.html#console_profiler">使用ConsoleProfiler.exe工具</a>在<a href="Performance_Profiling__Profiling_Using_the_Command_Line.html#console_profiler">分析应用程序中</a>找到所有详细信息）。<br>要将<span class="filepath">ConsoleProfiler.exe</span>附加到正在运行的应用程序池：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe附加1234 --save-to = snapshot.dtp</div>哪里<code class="code">1234</code>是相应的<span class="filepath">w3wp.exe</span>进程的进程ID。<p></p></li><li class="list__item" id="07f649ac">                <p id="725ea608">拍摄性能快照时，有两种选择：</p>                <ul class="list _alpha-lower"><li class="list__item" id="35b4dc0a"><p>通过超时获取快照：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe附加1234 --save-to = snapshot.dtp --timeout = 5m</div>这里快照将在5分钟后拍摄，然后探查器将脱离该过程。<figure id="33ce341b" width="672" data-theme="light"><img class="js-gif" src="/help/img/dotnet/2019.2/dotTrace-console-tools-attach.png" width="672" data-gif-src="/help/img/dotnet/2019.2/dotTrace-console-tools-attach.animated.gif" style="width:672px"></figure>                    <p></p></li><li class="list__item" id="47ec1adb"><p>在进程退出时获取快照。配置<span class="filepath">文件</span>的应用程序成功完成工作后， <span class="filepath">ConsoleProfiler.exe</span>工具将拍摄快照（因此，如果该应用程序被“杀死”，则不会收集任何快照）。为此，例如，您可以在IIS管理器中<span class="control">回收</span>相应的应用程序池。</p><figure id="513d56b1" width="772" data-theme="light"><img class="js-gif" src="/help/img/dotnet/2019.2/dotTrace-IIS-recycle.png" width="772" data-gif-src="/help/img/dotnet/2019.2/dotTrace-IIS-recycle.animated.gif" style="width:772px"></figure>                    <p></p></li></ul>            </li><li class="list__item" id="9c758c2c"><p>将生成的快照复制到安装了dotTrace的计算机上，并在<a href="Studying_Profiling_Results__Index.html">Performance Viewer</a>或<a href="Analyzing_Concurrency_Profiling_Results_Timeline_.html">Timeline Viewer中</a>进行分析（取决于您选择的配置文件类型）。<br>请注意，快照包含大量本机代码是正常的。</p></li></ol></section>            </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年9月19日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profile_Web_Application_on_IIS_Express.html">IIS Express</a> <a class="navigation-links__next" href="Profile_.NET_Core_Application.html">Profile .NET Core应用</a> <a class="navigation-links__prev" href="Profile_Web_Application_on_IIS_Express.html">程序中的Profile Web应用</a> <a class="navigation-links__next" href="Profile_.NET_Core_Application.html">程序</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>