<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>使用dotTrace命令行分析器-帮助|帮助dotTrace</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Performance_Profiling__Profiling_Using_the_Command_Line" data-article-props="
                {
                
            " seeals=":{=" concept=":=" hre=":" profiling_guidelines__launching_and_controlling_the_profiling_process.htm="," titl=":" controlling="" profiling="" sessio="}=" profiling_guidelines__profiling_different_kinds_of_applications.htm="," application="" option="}=" ="" data-disqus-id="Performance_Profiling__Profiling_Using_the_Command_Line_dt"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotTrace帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotTrace 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Performance_Profiling__Profiling_Using_the_Command_Line.xml" data-toc="Performance_Profiling__Profiling_Using_the_Command_Line">使用dotTrace命令行分析器</h1>    <p id="297d021d">有时，有必要使收集性能快照的过程自动化，例如，如果要对连续集成构建的一部分进行概要分析（例如，这可以是对集成测试进行概要分析的构建步骤）。为此，dotTrace随附了几个命令行工具（位于dotTrace安装目录中）：</p>    <ul class="list _ul"><li class="list__item" id="f5e82c72"><p>            <span class="filepath">ConsoleProfiler.exe</span> ：分析<a href="#console_profiler">应用程序</a>并拍摄性能快照。</p></li><li class="list__item" id="4ae9f85c"><p>            <span class="filepath">Reporter.exe</span> ： <a href="#reporter">分析快照</a>或<a href="#diff_report">比较一对快照，</a>并<a href="#perf_report">生成</a>包含性能数据<a href="#perf_report">的XML报告</a> 。</p></li></ul>    <p id="081255af">这些工具还作为单独的<a href="https://www.jetbrains.com/profiler/download/" rel="noopener noreferrer" data-external="true" target="_blank">zip存档</a> *和<a href="https://www.nuget.org/packages/JetBrains.dotTrace.CommandLineTools/" rel="noopener noreferrer" data-external="true" target="_blank">NuGet软件包</a>分发。请注意，这些工具是免费的，不需要任何许可证密钥。</p>    <aside class="note " rel="081255af" id="79a6dac3" data-title="">        <p id="9ef3a963">*如果您的域策略将从Internet下载的文件视为不安全，请使用文件属性中的“取消<span class="control">阻止”</span>按钮来取消阻止zip存档。</p>    </aside>    <div class="chapter"><h2 id="console_profiler" data-toc="Performance_Profiling__Profiling_Using_the_Command_Line#console_profiler">使用ConsoleProfiler.exe工具分析应用程序</h2>        <section class="procedure-steps"><h3 id="225440af">使用命令行工具分析应用程序</h3><div id="94fb28ff">                <p id="468569d1">根据您的分析方案，使用所需的选项运行<span class="filepath">ConsoleProfiler.exe</span> 。例如：</p>                <ul class="list _ul"><li class="list__item" id="d9d2b1a7"><p>要使用“时间轴”分析类型运行和分析独立应用程序<span class="filepath">App.exe，请执行以下</span>操作：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe开始--save-to = c：\ Snapshots \ snapshot.dtt --profiling-type = Timeline c：\ MyApp \ App.exe</div>                    <p></p></li><li class="list__item" id="0c723aed"><p>要运行和配置独立的应用程序<span class="filepath">App.exe</span> （使用默认的采样配置文件类型）并使用<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">配置文件API</a>控制会话，请执行以下操作：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe开始--save-to = c：\ Snapshots \ snapshot.dtp c：\ MyApp \ App.exe --use-api</div>                    <p></p></li><li class="list__item" id="2a83cf91"><p>附加到正在运行的应用程序<code class="code">PID=1234</code>并使用采样配置文件类型进行分析：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe附加1234 --save-to = c：\ Snapshots \ snapshot.dtp</div>                    <p></p></li><li class="list__item" id="75307057"><p>要查看可用选项的完整列表，请运行不带任何参数的工具：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe</div>                    <p></p></li></ul>            </div></section>        <p id="f6b77ebc">配置文件的应用程序完成工作后， <span class="control">ConsoleProfiler.exe</span>工具将自动保存性能快照。</p>        <aside class="note " rel="f6b77ebc" id="cefa1e82" data-title="">            <p id="bebbdd77">快照以原始格式保存。对于“采样”分析类型，请指定<code class="code">.dtp</code>作为快照文件扩展名。对于时间轴，请指定<code class="code">.dtt</code> 。</p>        </aside>        <div class="chapter"><h3 id="c2f18ef9">ConsoleProfiler.exe退出代码</h3>            <p id="e94a3862">默认情况下，如果该工具成功完成工作，则其退出代码为<code class="code">0</code> 。在某些情况下，这可能会带来不便。例如，如果您在CI服务器上运行该工具，则可能需要获取配置文件应用程序的退出代码（例如，单元测试运行器）。要使<span class="filepath">ConsoleProfiler.exe</span>返回分析目标的退出代码，请使用<code class="code">--propagate-exit-code</code>论点。</p>            <p id="c2763682">例如：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe开始--save-to = c：\ Snapshots \ snapshot.dtp --profiling-type =采样c：\ MyApp \ App.exe --propagate-exit-code</div>            <p></p>        </div>        <div class="chapter"><h3 id="dd1979f1">（可选）使用XML文件配置分析</h3>            <p id="1afdaf54">在<a href="#console_profiler">以上部分中</a> ，我们提供了配置配置（配置目标，配置方法等）作为<span class="filepath">ConsoleProfiler.exe</span>参数。如果由于某种原因您不想以这种方式配置会话，则可以在XML文件中提供配置。</p>            <p id="7ec6b82c">为了简化文件创建，可以使用<span class="filepath">Configuration2Xml32.exe</span> （和64位版本的<span class="filepath">Configuration2Xml64.exe</span> ）工具。使用此工具，您可以使用dotTrace主页窗口熟悉的用户界面来创建XML配置文件。</p>            <section class="procedure-steps"><h3 id="42634563">使用Configuration2Xml创建或修改配置文件</h3><ol class="list _decimal"><li class="list__item" id="5a93e0ba"><p>运行位于dotTrace安装目录（默认为<span class="filepath">C：\ Users \ [用户名] \ AppData \ Local \ JetBrains \ Installations \ dotTrace [N]</span> ）中的<span class="filepath">Configuration2Xml32.exe</span>或<span class="filepath">Configuration2Xml64.exe</span>工具。</p></li><li class="list__item" id="c4869632"><p>要创建新的配置文件配置，请选择“ <span class="menupath" data-skip-index="skip">创建新配置”</span>菜单。<br>要修改现有的配置文件配置，请选择“ <span class="menupath" data-skip-index="skip">打开配置”</span> 。</p></li><li class="list__item" id="6a24efa5"><p>像<a href="Configuring_Profiling_Session.html">通常</a>在dotTrace主页窗口中<a href="Configuring_Profiling_Session.html">一样</a> ，指定分析选项。</p></li><li class="list__item" id="5c4be017"><p>单击“ <span class="control">保存”，</span>然后指定配置文件的文件名和路径。</p></li><li class="list__item" id="c9a76fe0"><p>点击<span class="control">保存</span> 。</p></li></ol></section>            <section class="procedure-steps"><h3 id="baa16d0e">运行通过XML文件配置的性能分析会话</h3><div id="7d37c5ef">                    <p id="7bcaf0e5">在命令行中运行以下命令：</p><div class="code-block" data-lang="bash">ConsoleProfiler.exe xml文件<path_to_config>--save-to =<path_to_snapshot></path_to_snapshot></path_to_config></div>哪里<br>                        <code class="code"><path_to_config></code> -XML配置文件的路径。<br>                        <code class="code"><path_to_snapshot></code> -生成的快照文件的路径。请注意，您可以指定完整路径（包括快照文件名），也可以指定目录的路径（不带文件名）。在后一种情况下，快照文件将获得一个随机名称。<p></p>                    <p id="888aad73">例如：</p>                    <p id="34659cb8">                        </p><div class="code-block" data-lang="bash">ConsoleProfiler.exe xml文件config.xml --save-to = c：\ Snapshots \ snapshot.dtp</div>                    <p></p>                </div></section>        </div>    </div>    <div class="chapter"><h2 id="reporter" data-toc="Performance_Profiling__Profiling_Using_the_Command_Line#reporter">使用Reporter.exe工具生成性能报告</h2>    <aside class="warning " rel="reporter" id="8cd69549" data-title="">        <p id="26d8587d"><span class="filepath">Reporter.exe</span>工具不适用于使用“ <a href="Concurrency_Profiling_Timeline_.html">时间轴”</a>分析类型拍摄的快照。</p>    </aside>    <p id="3ecb9853"><span class="filepath">Reporter.exe</span>工具可以在两种模式下工作：</p><ul class="list _ul"><li class="list__item" id="983cd73b"><p>                <a href="#perf_report">获取特定方法的性能数据</a> 。<br>生成的XML报告获取有关执行时间和特定方法的调用次数的数据。</p></li><li class="list__item" id="b4a3f6ac"><p>                <a href="#diff_report">比较快照</a> 。<br>生成的XML报告获取有关执行时间和特定方法的调用次数差异的数据。此模式对于将最新版本中获得的性能数据与某些参考快照进行比较特别有用。</p></li></ul>    <p></p>    <p id="a98a2355">无论选择哪种模式，都应指定应添加到报告中的方法名称。</p>    <div class="chapter"><h3 id="ad4d60b0">1。指定报告的方法</h3>    <p id="3f38ae28">必须添加到报告中的方法列表由XML模式文件定义。</p>    <section class="procedure-steps"><h3 id="da0e39de">创建特征码文件</h3><ol class="list _decimal"><li class="list__item" id="54d85e6e"><p>在您选择的编辑器中，创建一个空白XML文件。</p></li><li class="list__item" id="17e6d7b1">            <p id="d19754d7">编写必须添加到报告中的方法列表，如下例所示。</p><div class="code-block" data-lang="markup">
        <patterns>
           <pattern printcallstacks="MethodNameOnly">方法1</pattern> <pattern>方法2</pattern>
        </patterns>
                    </div>哪里<p></p>            <ul class="list _ul"><li class="list__item" id="1177da75"><p>                    <code class="code">Method1</code>和<code class="code">Method2</code> -与要为其获取性能数据的方法的名称（而不是名称的子字符串）匹配的正则表达式。请注意，如果方法名称包含特殊字符，则应使用反斜杠对其进行转义<code class="code">\</code>符号。例如， <code class="code">MyMethod\+MySubMethod</code> 。</p></li><li class="list__item" id="pcs">                    <p id="7d190c51">                        <code class="code">PrintCallstacks</code> -允许在报告中包含调用堆栈数据的可选属性（此报告的示例如下<a href="#pcs_example">所示</a> ）。有两个可用的值<code class="code">PrintCallstacks</code> ：</p>                    <ul class="list _ul"><li class="list__item" id="417f4571"><p>                            <code class="code">Full</code> -完全合格的方法名称将显示在调用堆栈中。</p></li><li class="list__item" id="d65aaa16"><p>                            <code class="code">MethodNameOnly</code> -在调用堆栈中仅显示方法名称（不包含名称空间和类名称）。</p></li></ul>                </li></ul>        </li><li class="list__item" id="b4ad94c2"><p>保存文件。</p></li></ol></section>    </div>    <div class="chapter"><h3 id="perf_report">2a。生成绩效报告</h3>    <section class="procedure-steps"><h3 id="12344526">生成绩效报告</h3><div id="2fa057ee"><p>在命令行中，运行以下命令：</p><div class="code-block" data-lang="bash">Reporter.exe报告<path_to_snapshot>--pattern = <path_to_pattern>--save-to = <path_to_report>
    </path_to_report></path_to_pattern></path_to_snapshot></div>哪里<br>            <code class="code"><path_to_snapshot></code> -源快照文件的路径。<br>            <code class="code"><path_to_pattern></code> -XML模式文件的路径，该文件包含添加到报告中的方法的名称。<br>            <code class="code"><path_to_report></code> -生成的报告文件的路径。<br>                                                                    <p></p></div></section>    <p id="de32af00">例如：</p>    <div class="code-block" data-lang="bash">Reporter.exe报告c：\ Snapshots \ snapshot.dtp --pattern = pattern.xml-保存到c：\ Reports \ report.xml</div>    <div class="chapter"><h4 id="f02f83ec">报告范例</h4>    <div class="code-block" data-lang="markup">
<report>
   <info>
      <snapshot indexfile="C:\snapshot1.dtp" executable="C:\Temp\ConsoleAppTest.exe" commandline="C:\Temp\ConsoleAppTest.exe"></snapshot>
   </info>

   <function fqn="Tests.Method1" totaltime="500" owntime="100" calls="1"></function>
   <function fqn="Tests.Method2" totaltime="400" owntime="200" calls="10"></function>
</report>
    </div>    <p id="a16e6fab">哪里<br>        <code class="code">FQN</code> -完整的方法名称。<br>        <code class="code">TotalTime</code> -方法的调用子树的执行时间。<br>        <code class="code">OwnTime</code> -方法本身的执行时间。<br>        <code class="code">Calls</code> -通话次数。</p>    <p id="896a7b99">如果一个<a href="#pcs"><code class="code">PrintCallstacks</code></a>属性是为特定的<code class="code">Pattern</code>在XML模式文件中，报告将包含其他调用堆栈数据。例如， <code class="code"><Pattern PrintCallstacks = "MethodNameOnly"></code>被指定用于某些<code class="code">GetFileNames</code>功能。在这种情况下， <code class="code">Function</code>结果报告中的节点将包含一个额外的<code class="code">Instance</code>带有调用堆栈的子节点：</p><div class="code-block" data-lang="markup">
<function id="0x0020000C" fqn="MyApplication.MainWindow.GetFileNames" totaltime="12520" owntime="0" calls="1740" instances="1">
   <instance callstack="Main/Run/Run/RunInternal/RunDispatcher/PushFrame/PushFrameImpl/OnClick/RaiseEvent/RaiseEventImpl/InvokeHandlersImpl/InvokeHandler/btnSelectFiles_Click/GetFileNames" totaltime="12520" owntime="0" calls="1740"></instance>
</function>
        </div>    <p></p>        <aside class="note " rel="896a7b99" id="dacfef09" data-title="">            <p id="ff34c1b0">如果您想区分报告中的重载方法，请运行<code class="code">Reporter.exe</code>与<code class="code">--save-signature</code>论点。</p>        </aside>    </div>    </div>    <div class="chapter"><h3 id="diff_report">2b。生成有关快照差异的报告</h3>    <section class="procedure-steps"><h3 id="32d64f7b">比较两个快照并生成差异报告</h3><div id="28870726"><p>在命令行中，运行以下命令：</p><div class="code-block" data-lang="bash">Reporter.exe比较<path_to_snapshot1><path_to_snapshot2>--pattern = <path_to_pattern>-保存至=<path_to_report></path_to_report></path_to_pattern></path_to_snapshot2></path_to_snapshot1></div>哪里<br>            <code class="code"><path_to_snapshot1></code> -参考快照文件的路径。<br>            <code class="code"><path_to_snapshot2></code> -第二个快照文件的路径。<br>            <code class="code"><path_to_pattern></code> -XML模式文件的路径，该文件包含添加到报告中的方法的名称。<br>            <code class="code"><path_to_report></code> -生成的报告文件的路径。<br>        <p></p></div></section>    <p id="53c9ec7c">例如：</p>    <div class="code-block" data-lang="bash">Reporter.exe比较c：\ Snapshots \ base_snapshot.dtp c：\ Snapshots \ snapshot.dtp --pattern = pattern.xml --save-to = c：\ Reports \ report.xml</div>    <p id="c2589bfb">生成的报告文件与您在“报告”模式下获得的文件相似，唯一的区别是：所有字段都不包含绝对时间或调用次数值，而是快照之间的增量。根据增量符号，值将以<code class="code">+</code>要么<code class="code">-</code>字首。</p>    </div>    </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年9月19日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Viewing_Collected_Snapshots.html">快照的基本操作</a> <a class="navigation-links__next" href="Configuring_Profiling_Session.html">配置概要分析会话</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>