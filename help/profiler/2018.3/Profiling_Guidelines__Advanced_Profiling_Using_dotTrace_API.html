<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Controlling Profiling Session Through API - Help | dotTrace</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API" data-disqus-id="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API_dt"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotTrace Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotTrace 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API" id="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.xml">Controlling Profiling Session Through API</h1>    <a name="API"></a>    <aside class="note " data-title="" rel="892b530a" id="549be20e">        <p id="a8955ca4">            * If your domain policy is to treat the files downloaded from the Internet as unsafe, unblock the zip            archive            using the Unblock button in file properties.        </p>    </aside>    <p id="c1812ea7">        dotTrace API is a part of        <a href="/profiler/download/#section=dottracesdk" data-external="true" target="_blank" rel="noopener noreferrer"><span>Profiling SDK</span></a>        <b id="8c21a806">*</b>.        The API provides a number of classes which allow you to        control the profiling process. For example, you can start and stop collecting profiling data, save collected        snapshots and so on right from your app.            </p>    <p id="4588ab21">        For examples on how to use API, refer to <a href="API_Usage_Examples.html"><span>API Usage Examples</span></a>.        For detailed information about API classes, refer to <a href="API_Reference.html"><span>API Reference</span></a>.    </p>    <p id="fd651086">        For more details on Profiling SDK implementation and usage scenarios, check this        <a href="Use_Profiling_API.html">tutorial</a>.    </p>    <div class="chapter"><h2 id="4b300489" data-toc="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API#4b300489">When to use the API</h2>        <p id="bd9dfa65">There are two main scenarios that require using the profiling API:</p>        <ul class="list _ul"><li class="list__item" id="19e4402c"><p>                <i id="c33b00c8">Profiling a specific part of the code</i>                <br>                API allows you to narrow the profiling scope and profile only methods you are interested in.            </p></li><li class="list__item" id="f12f9405"><p>                <i id="3cc39311">Self-profiled applications</i>                <br>                API allows you to collect statistics about how your app behaves on end-user desktops.            </p></li></ul>    </div>    <div class="chapter"><h2 id="637430f8" data-toc="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API#637430f8">How the API works</h2>        <p id="47561be4">            Timeline and performance profiling methods have slightly different API implementations.        </p>        <div class="chapter"><h3 id="b7ae75d5">Performance profiling</h3>            <p id="ad3befe8">The following list summarizes main concepts of using API for performance profiling:</p>            <ul class="list _ul"><li class="list__item" id="ad36b367"><p>The static                    <code class="code" data-lang="Java">PerformanceProfiler</code>                    class located in the <span class="filepath">JetBrains.Profiler.Windows.Api.dll</span> library                    provides methods for starting, stopping and cancelling profiling.                </p></li><li class="list__item" id="f2542179"><p>The                    <code class="code" data-lang="Java">PerformanceProfiler</code>                    API is organized as a simple state machine.                </p></li><li class="list__item" id="a7ce827b"><p>                    The <code class="code" data-lang="Java">IsActive</code> property                    is used to determine whether the API is enabled.                </p></li><li class="list__item" id="8b239d6c"><p>                    Profiling must be started from creating a blank snapshot using the                    <code class="code" data-lang="Java">Begin()</code>                    method.                </p></li><li class="list__item" id="f62ee94e"><p>                    Profiling is not started initially, therefore                    <code class="code" data-lang="Java">Start()</code>                    should be called to begin profiling measurements.                </p></li><li class="list__item" id="7e73ba69"><p>                    <code class="code" data-lang="Java">Stop()</code>                    stops taking measurements.                </p></li><li class="list__item" id="11be32c8"><p>                    <code class="code" data-lang="Java">EndSave()</code>                    stops taking measurements and opens the snapshot in the viewer.                </p></li><li class="list__item" id="9d32a59a"><p>To enable the API, you should select the                    <span class="control">Use profiler API</span>                    check box in the advanced <a href="Profiler_Options.html">Profiler Options</a>.                </p></li></ul>            <p id="0d4456d4">                The API state machine:                <figure><img alt="pp api state machine" title="pp api state machine" src="/help/img/dotnet/2018.3/pp_api_state_machine.png" id="3177d1c1" width="290" height="464"></figure>            </p>        </div>        <div class="chapter"><h3 id="timeline">Timeline profiling</h3>            <p id="09712539">The following list summarizes main concepts of using API for timeline profiling:</p>            <ul class="list _ul"><li class="list__item" id="6e1e9812"><p>The static                    <code class="code" data-lang="Java">TimelineProfiler</code>                    class located in the <span class="filepath">JetBrains.Profiler.Windows.Api.dll</span> library                    provides methods for starting, stopping and cancelling profiling.                </p></li><li class="list__item" id="235e53a3"><p>                    The <code class="code" data-lang="Java">IsActive</code> property                    is used to determine whether the API is enabled.                </p></li><li class="list__item" id="46f08e6a"><p>                    Profiling must be started from creating a blank snapshot using the                    <code class="code" data-lang="Java">Begin()</code>                    method. This also starts measurements.                </p></li><li class="list__item" id="02e75d6c"><p>                    <code class="code" data-lang="Java">EndSave()</code>                    stops taking measurements and opens the snapshot in the viewer.                </p></li><li class="list__item" id="b34bdefd"><p>To enable the API, you should select the                    <span class="control">Use profiler API</span>                    check box in the advanced <a href="Profiler_Options.html">Profiler Options</a>.                </p></li></ul>            <aside class="note " data-title="" rel="48361170" id="82372399">                <p id="66ff827b">Timeline profiling requires the ETW service to be run in the background. To                    start this service, administrator rights are required.                    For this reason, each time you initialize timeline profiling using the                    <code class="code" data-lang="Java">Begin</code>                    method, dotTrace prompts you for rights elevation. To avoid this, run the service                    manually using the                    <span class="filepath">&lt;dotTrace_installation_directory&gt;\x64\JetBrains.ETW.Collector.Host.exe</span>                    file. The other option is to install the service using the                    <span class="filepath">&lt;dotTrace_installation_directory&gt;\Msi.x64\EtwService.msi</span>                    installation file. In this case, the service will be run on Windows startup.                </p>            </aside>        </div>        <div class="chapter"><h3 id="ee1a520d">Self-profiling</h3>            <p id="7087f920">The following list summarizes "self-profiling" concepts:</p>            <ul class="list _ul"><li class="list__item" id="bd8ed9b6"><p>End-users do not have dotTrace installed; therefore, you must include dotTrace redistributables into                    your app's installation package.                </p></li><li class="list__item" id="c9cbe50f"><p>As end-users are not supposed to initiate profiling, the self-profiling session is initiated by the                    API.                    For this purpose, the API uses the static <code class="code" data-lang="Java">SelfAttach</code> class located in the                    <span class="filepath">JetBrains.Profiler.Windows.SelfApi.dll</span> library.                </p></li><li class="list__item" id="9134a12a"><p>The <code class="code" data-lang="Java">Attach()</code> method prepares profiling                    configuration and executes the profiler from the "redistributables" folder.                </p></li><li class="list__item" id="c42226ac">The profiling configuration is defined by one of two classes (instantiated from the                    <code class="code" data-lang="Java">BaseSnapshotProfilingConfig</code>                    <code class="code" data-lang="Java">BaseProfilingConfig</code>                    classes) passed to the <code class="code" data-lang="Java">Attach</code> method:                    <ul class="list _ul"><li class="list__item" id="4d4e351d"><p>                            <code class="code" data-lang="Java">SaveSnapshotProfilingConfig</code>                            -                            the resulting snapshot is saved in the designated folder.                        </p></li><li class="list__item" id="52164ba9"><p>                            <code class="code" data-lang="Java">ExecutableSnapshotProfilingConfig</code>                            - the resulting snapshot is saved in the designated or default folder,                            the path to the snapshot is passed to an external application as a command line parameter.                        </p></li></ul>                </li><li class="list__item" id="658f4a9a"><p>For performance profiling, there is a limitation on the profiling type -                    it can be only <span class="control">Sampling</span>.                </p></li></ul>        </div>    </div>    <div class="last-modified" data-skip-index="skip">Last modified: 15 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profiling_Guidelines__Launching_and_Controlling_the_Profiling_Process.html">Controlling Profiling Session</a><a class="navigation-links__next" href="API_Usage_Examples.html">API Usage Examples</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>Concepts:</h3><ul class="list"><li class="list__item"><a href="API_Usage_Examples.html">API Usage Examples</a></li></ul></div><div class="seealso__col" data-skip-index="skip"><h3>Reference:</h3><ul class="list"><li class="list__item"><a href="API_Reference.html">API Reference</a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>