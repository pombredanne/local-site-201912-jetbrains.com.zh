<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>API Usage Examples - Help | dotTrace</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="API_Usage_Examples" data-disqus-id="API_Usage_Examples_dt"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotTrace Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotTrace 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="API_Usage_Examples" id="API_Usage_Examples.xml">API Usage Examples</h1>  <aside class="warning " data-title="" rel="API_Usage_Examples.xml" id="7e96e45f">    <p id="536732a6">      Do NOT combine profiling types, e.g. do not call      <code class="code" data-lang="Java">PerformanceProfiler</code> class when      working with <code class="code" data-lang="Java">TimelineProfiler</code>.    </p>  </aside>  <section class="procedure-steps"><h2 id="55760c79">To use the API for performance profiling</h2><ol class="list _decimal"><li class="list__item" id="154769ca"><p>Download and unpack the      <a href="/profiler/download/#section=dottracesdk" data-external="true" target="_blank" rel="noopener noreferrer"><span>profiling SDK</span></a>. If your domain policy      is to treat the files downloaded from the Internet as unsafe, unblock the zip archive      using the Unblock button in file properties.    </p></li><li class="list__item" id="7760478b"><p>      Reference the <code class="code" data-lang="Java">JetBrains.Profiler.Windows.Api</code> assembly from the      <span class="filepath">JetBrains.Profiler.Windows.Api.dll</span> file located in the main directory of the dotTrace SDK.    </p></li><li class="list__item" id="6d0dd6f0"><p>      Insert calls to methods of the <code class="code" data-lang="Java">PerformanceProfiler</code> class      into your code as required by your use case. Consider the example below:      <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">SomeMethod</span><span class="o">()</span>
<span class="o">{</span>
  <span class="c1">// check IsActive only once</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">IsActive</span><span class="o">)</span>
  <span class="o">{</span>
    <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">Begin</span><span class="o">();</span>
    <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">Start</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="k">else</span>
    <span class="n">MessageBox</span><span class="o">.</span><span class="na">Show</span><span class="o">(</span><span class="s">&quot;Profiler is not active&quot;</span><span class="o">);</span>

  <span class="c1">// Here goes method code</span>

  <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">Stop</span><span class="o">();</span>
  <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">EndSave</span><span class="o">();</span>
<span class="o">}</span></code></div></p></li><li class="list__item" id="81d50ef4">      <aside class="note " data-title="" rel="81d50ef4" id="31554156">        <p id="33cf79e3">          * If you need to profile a unit test that contains API calls, you should only use          standalone dotTrace for profiling. Profiling of such a test from Visual Studio is not possible.          See the detailed          <a href="Profiling_Guidelines__Profiling_Unit_Tests.html#profile_unit_test">instructions</a>.        </p>      </aside>      Start profiling the application from within dotTrace or Visual Studio,      and select the <span class="control">Use profiler API</span> check box      in <a href="Profiler_Options.html">profiler options</a>. <b id="93579206">*</b>    </li></ol></section>  <section class="procedure-steps"><h2 id="8d263845">To use the API for timeline profiling</h2><ol class="list _decimal"><li class="list__item" id="6e2a5ae9"><p>Download and unpack the      <a href="/profiler/download/#section=dottracesdk" data-external="true" target="_blank" rel="noopener noreferrer"><span>profiling SDK</span></a>. If your domain policy      is to treat the files downloaded from the Internet as unsafe, unblock the zip archive      using the Unblock button in file properties.    </p></li><li class="list__item" id="a886071b"><p>      Reference the <code class="code" data-lang="Java">JetBrains.Profiler.Windows.Api</code> assembly from the      <span class="filepath">JetBrains.Profiler.Windows.Api.dll</span> file located in the main directory of the dotTrace SDK.    </p></li><li class="list__item" id="67cb6ce4"><p>      Insert calls to methods of the <code class="code" data-lang="Java">TimelineProfiler</code> class      into your code as required by your use case. Consider the example below:      <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">SomeMethod</span><span class="o">()</span>
<span class="o">{</span>
  <span class="c1">// check IsActive only once</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">TimelineProfiler</span><span class="o">.</span><span class="na">IsActive</span><span class="o">)</span>
    <span class="n">TimelineProfiler</span><span class="o">.</span><span class="na">Begin</span><span class="o">();</span>
  <span class="k">else</span>
    <span class="n">MessageBox</span><span class="o">.</span><span class="na">Show</span><span class="o">(</span><span class="s">&quot;Profiler is not active&quot;</span><span class="o">);</span>

  <span class="c1">// Here goes method code</span>
  <span class="n">TimelineProfiler</span><span class="o">.</span><span class="na">EndSave</span><span class="o">();</span>
<span class="o">}</span></code></div></p></li><li class="list__item" id="1a1b11d0">      <aside class="note " data-title="" rel="1a1b11d0" id="77ade181">        <p id="d596734c">          * If you need to profile a unit test that contains API calls, you should only use          standalone dotTrace for profiling. Profiling of such a test from Visual Studio is not possible.          See the detailed          <a href="Profiling_Guidelines__Profiling_Unit_Tests.html#profile_unit_test">instructions</a>.        </p>      </aside>      Start profiling the application from within dotTrace or Visual Studio,      and select the <span class="control">Use profiler API</span> check box      in <a href="Profiler_Options.html">profiler options</a>. <b id="f6377a76">*</b>    </li></ol></section>  <section class="procedure-steps"><h2 id="6fcf4842">To use the API in self-profiled applications</h2><ol class="list _decimal"><li class="list__item" id="629db2d3"><p>Download and unpack the      <a href="/profiler/download/#section=dottracesdk" data-external="true" target="_blank" rel="noopener noreferrer"><span>profiling SDK</span></a>. If your domain policy      is to treat the files downloaded from the Internet as unsafe, unblock the zip archive      using the Unblock button in file properties.    </p></li><li class="list__item" id="137813dd"><p>      Reference the <code class="code" data-lang="Java">JetBrains.Profiler.Windows.SelfApi</code> assembly from the      <span class="filepath">JetBrains.Profiler.Windows.SelfApi.dll</span> file located in the main directory of the dotTrace SDK.    </p></li><li class="list__item" id="e8f28769"><p>      Supply your app with the SDK redistributables.      </p></li><li class="list__item" id="3ed5ca52"><p>Initiate self-profiling somewhere in your app using the <code class="code" data-lang="Java">SelfAttach</code>      class. For example:      <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="n">SelfAttach</span><span class="p">.</span><span class="n">Attach</span><span class="p">(</span><span class="k">new</span> <span class="n">SaveSnapshotProfilingConfig</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ProfilingControlKind</span> <span class="p">=</span> <span class="n">ProfilingControlKind</span><span class="p">.</span><span class="n">Api</span><span class="p">,</span>
  <span class="n">SaveDir</span> <span class="p">=</span> <span class="s">&quot;C:\\Temp&quot;</span><span class="p">,</span>
  <span class="n">RedistDir</span> <span class="p">=</span> <span class="s">&quot;C:\\ProfilerSDK&quot;</span><span class="p">,</span>
  <span class="n">ProfilingType</span> <span class="p">=</span> <span class="n">ProfilingType</span><span class="p">.</span><span class="n">Performance</span><span class="p">,</span>
  <span class="n">ListFile</span> <span class="p">=</span> <span class="s">&quot;C:\\snapshot_list.xml&quot;</span>  <span class="c1">// the file is created automatically during profiling</span>
<span class="p">});</span></code></div></p></li><li class="list__item" id="1a159dff"><p>      Insert calls to methods of the <code class="code" data-lang="Java">PerformanceProfiler</code> or <code class="code" data-lang="Java">TimelineProfiler</code>  class      into your code as required by your use case. If you start profiling right after the self-profiling initialization, add a      short wait (the SelfAttach API requires some time to start):      <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="k">while</span> <span class="o">(</span><span class="n">SelfAttach</span><span class="o">.</span><span class="na">State</span> <span class="o">!=</span> <span class="n">SelfApiState</span><span class="o">.</span><span class="na">Active</span><span class="o">)</span>
  <span class="n">Thread</span><span class="o">.</span><span class="na">Sleep</span><span class="o">(</span><span class="mi">250</span><span class="o">);</span>  <span class="c1">// wait until API starts</span>

<span class="k">if</span> <span class="o">(</span><span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">IsActive</span><span class="o">)</span>
<span class="o">{</span>
  <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">Begin</span><span class="o">();</span>
  <span class="n">PerformanceProfiler</span><span class="o">.</span><span class="na">Start</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">else</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">();</span>

<span class="c1">// and so on ...</span></code></div>    </p></li></ol></section>  <div class="last-modified" data-skip-index="skip">Last modified: 15 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">Controlling Profiling Session Through API</a><a class="navigation-links__next" href="API_Reference.html">API Reference</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>Reference:</h3><ul class="list"><li class="list__item"><a href="API_Reference.html">API Reference</a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>