<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Garbage Collection - Help | dotTrace</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="CLR_Activity" data-disqus-id="CLR_Activity_dt"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotTrace Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotTrace 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="CLR_Activity" id="CLR_Activity.xml">Garbage Collection</h1>    <p id="e9aa28d8">        The <span class="control">Garbage Collection</span> filter is used to analyze garbage collections (GC) by filtering time        intervals where        GC was performed.    </p>    <p id="47cc38ad">        To understand how the        <span class="control">Garbage Collection</span>        filter works, you should be acquainted with basic GC concepts.    </p>    <div class="chapter"><h2 id="dc000ec3" data-toc="CLR_Activity#dc000ec3">Garbage collection concepts in brief</h2>        <ul class="list _ul"><li class="list__item" id="31dc54b0"><p>                For desktop applications, .NET Framework offers a so-called workstation GC mode.            </p></li><li class="list__item" id="bf67badc"><p>                There are two types of workstation garbage collection: foreground and background.            </p></li><li class="list__item" id="59431b6c"><p>                To perform a foreground GC, garbage collector suspends all managed threads except the one that triggered                the collection.                This suspends the main thread as well and leads to a UI freeze.                This is a "pure"                <b id="d77c7f93">blocking GC</b>.            </p></li><li class="list__item" id="ebaf2f59"><p>                <b id="4323e2cd">Background GC</b>                is performed by a separate GC thread and does not suspend managed threads during the                "heaviest"                Gen2 collections. Nevertheless, during Gen0 and Gen1 collections managed threads have to be suspended.                Thus,                background GC still involves short "blocking GC" intervals.                <i id="1ce42a72">By default, background GC is turned on.</i>            </p></li><li class="list__item" id="96f8fa7b"><p>                For server applications, there is a special server GC mode. The main difference comparing to workstation                GC                is                that in the server GC mode each logical processor has its own managed heap and a separate GC thread.                From the point of performance analysis in Timeline Viewer, there are no huge differences between                background                and server GC.            </p></li></ul>        <p id="e35ae4e2">Learn more about GC types in            <a href="http://msdn.microsoft.com/en-us/library/ee787088(v=vs.110).aspx" data-external="true" target="_blank" rel="noopener noreferrer"><span>MSDN</span></a>.        </p>        <p id="6ff02f01">            To help you distinguish when a GC of a particular type is performed, dotTrace offers you the            <span class="control">Garbage Collection: Type</span>            sub-filter.        </p>    </div>    <div class="chapter"><h2 id="a7361f3d" data-toc="CLR_Activity#a7361f3d">Garbage Collection: Type</h2>        <p id="582ba8f7">            The sub-filter shows the distribution of the total GC time between            collections of a particular type.        </p>        <p id="4eda581c">            Use this sub-filter to analyze garbage collections: reasons, threads and            methods that toggled collections.            For example, if you see a significant blocking GC time, it makes sense to switch the            <span class="control">Events</span>            filter to <span class="control">.NET Memory Allocations</span> and determine the threads with            the largest amount of allocated memory. Most likely, these are threads that triggered GCs.        </p>        <figure><img alt="gc type subfilter" title="gc type subfilter" src="/help/img/dotnet/2018.3/gc_type_subfilter.png" id="41b69fa8" width="386" height="195" align="middle"></figure>        <p id="eab9c14a">            <img alt="pos 1" title="pos 1" src="/help/img/dotnet/2018.3/pos_1.png" id="d2538bc8" width="32" height="32" class="inline-icon-32">            GC type:            <ul class="list _ul"><li class="list__item" id="68e54fe5"><p>                    <span class="control">Blocking</span>                    - blocking garbage collection. All threads except the one that                    toggled the GC are suspended. The main subject of your analysis.                </p></li><li class="list__item" id="2922e37d"><p>                    <span class="control">Background</span>                    - performed by a separate GC thread and does not suspend managed threads during the "heaviest"                    Gen2 collections. Excessive background GCs are also a subject for optimization.                </p></li><li class="list__item" id="e225baf2"><p>                    <span class="control">Blocking during background</span>                    - background GC does not suspend other threads during                    Gen2 collections. Nevertheless,Gen0 and Gen1 collections (which are an inevitable part of a full GC)                    still require managed threads to be suspended.                    Therefore, background GC always implies short blocking GC intervals. The                    <span class="control">Blocking during background</span>                    type will filter out these intervals.                </p></li></ul>        </p>        <p id="fff65bef">            <img alt="pos 2" title="pos 2" src="/help/img/dotnet/2018.3/pos_2.png" id="1c056b92" width="31" height="31" class="inline-icon-31">            Total time spent on GC of the corresponding type summed up for all selected threads.            <br>        </p>        <p id="cc353eba">            <img alt="pos 3" title="pos 3" src="/help/img/dotnet/2018.3/pos_3.png" id="d4f9d3bc" width="31" height="30" class="inline-icon-31">            The percentage of time spent on GCs of the corresponding type relative to the total selected time.        </p>        <section class="procedure-steps"><h2 id="c0da9fdd">To apply the Garbage Collection: Type filter</h2><ul class="list "><li class="list__item" id="1ee271c1"><p>Select the desired GC type in the filter.</p></li></ul></section>        <p id="3ca572d8">            After you select a GC type, other filters will show data only for            the time intervals where GCs of the selected type were performed.        </p>        <figure><img alt="gc type blocking" title="gc type blocking" src="/help/img/dotnet/2018.3/gc_type_blocking.png" id="4c6383bb" width="344" height="284" align="middle"></figure>        <aside class="note " data-title="" rel="4c6383bb" id="7e896b45">            <p id="f1467eca">                To simplify garbage collection analysis, the                <a href="Process_Overview.html"><span>Process Overview</span></a>                diagram shows blocking GC intervals with a separate bar.            </p>        </aside>        <p id="2759540c">            For better understanding of how dotTrace calculates garbage collection intervals, consider the example.        </p>        <div class="chapter"><h3 id="example">Example</h3>            <p id="b686545f">                For example, your application                has two threads:                User Thread#1 and User Thread#2. At some point, to free up some memory, User Thread#1 toggles blocking                Gen0,                Gen1 garbage collection                (the <b id="4eaa496d">A1</b> interval on the diagram below).                As memory is still not enough, a GC thread is created. It performs full GC which includes the Gen0, Gen1                blocking collections                (<b id="58c0a70f">C3</b>) and the Gen2 collection (<b id="764b24b5">B3</b> and <b id="b9141cd6">D3</b>) which does not block other threads.            </p>            <figure><img alt="clr activity 1a" title="clr activity 1a" src="/help/img/dotnet/2018.3/clr_activity_1a.png" id="8032a03b" width="492" height="221"></figure>            <p id="d1dc8e0c">                If you select all three threads on the <span class="control">Threads</span> diagram, the filters will calculate GC                time as                follows:            </p>            <p id="f519cf6b">                <b id="56e2f643">Garbage Collection = A1 + B3 + C3 + D3</b>                <br>                <b id="9482809e">Garbage Collection: Blocking = A1 + C3</b>                <br>                <b id="052bad75">Garbage Collection: Background = B3 + C3 + D3</b>                <br>                <b id="3277bf0c">Garbage Collection: Blocking during Background = C3</b>                <br>            </p>            <p id="ef73d7aa">                Note that in addition to the <span class="control">Garbage Collection</span> event, you can also use                the <span class="control">GC Wait</span> subsystem in <a href="Subsystems.html">Subsystems</a> to evaluate                the amount of garbage collection on the selected time interval. Do not be confused by different time                values                shown in <span class="control">Garbage Collection</span> and <span class="control">GC Wait</span>. The thing is                while <span class="control">Garbage Collection</span> is calculated only for the thread that actually performed                the GC,                the <span class="control">GC Wait</span> subsystem time includes all waits of all threads blocked by the GC.                Given the example above, <span class="control">GC Wait</span> would be calculated as follows:            </p>            <p id="ab82c9a3">                <b id="f9c0c046">GC Wait = A1 + A2 + B3 + C1 + C2 + C3 + D3</b>            </p>        </div>    </div>    <div class="chapter"><h2 id="1744452e" data-toc="CLR_Activity#1744452e">Garbage Collection: Depth</h2>        <p id="781d4ce5">            The <span class="control">Garbage Collection: Depth</span> sub-filter shows distribution of GC time between            Gen0, Gen1, and Gen2 heaps collections.        </p>        <p id="4a446f03">            Note that Gen1 collection always implies the collection of the Gen0 heap            segment as well. The Gen2 GC (also known as full GC) includes the Gen1 and Gen0 collections. Thus, the time            used            to perform a Gen0 collection within a Gen1 collection will be aggregated to the Gen1 GC time. The Gen2 GC            time            will include            the times of the Gen0 and Gen1 collections it triggers.        </p>        <figure><img alt="garbage collection depth 1" title="garbage collection depth 1" src="/help/img/dotnet/2018.3/garbage_collection_depth_1.png" id="714e0520" width="422" height="185" align="middle"></figure>        <p id="9ced3372">            <img alt="pos 1" title="pos 1" src="/help/img/dotnet/2018.3/pos_1.png" id="edfa7857" width="32" height="32" class="inline-icon-32">            Heap segment name.        </p>        <p id="73886bfe">            <img alt="pos 2" title="pos 2" src="/help/img/dotnet/2018.3/pos_2.png" id="b4fe3f23" width="31" height="31" class="inline-icon-31">            Total time spent on blocking GCs of the corresponding depth summed up for all selected threads.            <br>        </p>        <p id="49997114">            <img alt="pos 3" title="pos 3" src="/help/img/dotnet/2018.3/pos_3.png" id="9a1ef0c3" width="31" height="30" class="inline-icon-31">            The percentage of time spent on blocking GCs of the corresponding depth relative to the total selected time.        </p>        <section class="procedure-steps"><h2 id="ba51a5ba">To apply the  Garbage Collection: Depth filter</h2><ul class="list "><li class="list__item" id="9ebbe1e7"><p>Select the desired heap segment name in the filter.</p></li></ul></section>        <p id="e2323f79">            After you select a heap segment, other filters will show data only for            the time intervals where GCs of the selected depth took place.        </p>        <figure><img alt="garbage collection depth 2" title="garbage collection depth 2" src="/help/img/dotnet/2018.3/garbage_collection_depth_2.png" id="4398604e" width="333" height="382" align="middle"></figure>    </div><div class="last-modified" data-skip-index="skip">Last modified: 15 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Debug_Output.html">Debug Output</a><a class="navigation-links__next" href="Exceptions.html">Exceptions</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>