<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>安全连接-帮助|浮动许可证服务器</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="configuring_secure_connection"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索浮动许可证服务器帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>浮动许可证服务器帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="configuring_secure_connection.xml" data-toc="configuring_secure_connection">安全连接</h1>    <p id="228e96b5">由于浮动许可证服务器（FLS）不支持HTTPS连接，因此可以使用反向代理服务器来增加安全性。本节包含有关配置最受欢迎的说明。要在FLS配置文件中指定其可访问性，请参阅<a href="configuring_reverse_proxy.html">配置反向代理</a> 。</p>    <div class="chapter"><h2 id="apache-http-server-configuration" data-toc="configuring_secure_connection#apache-http-server-configuration">Apache HTTP服务器</h2>        <p id="502ae10d">要将Apache HTTP Server用作反向代理，您需要运行<code class="code">a2enmod</code>脚本并将指令添加到服务器上的<span class="filepath">.conf</span>文件。需要Apache httpd 2.4.17或更高版本。</p>        <section class="procedure-steps"><h3 id="0dfae2e5">要将Apache HTTP Server设置为反向代理，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="7fb81270"><p>使用以下a2enmod脚本启用<code class="code">headers</code> ， <code class="code">rewrite</code> ， <code class="code">proxy_http</code> ， <code class="code">ssl</code>和<code class="code">http2</code>模块：</p><div class="code-block" data-lang="none">$ a2enmod标头$ a2enmod重写$ a2enmod proxy_http $ a2enmod ssl $ a2enmod http2</div>            <p></p></li><li class="list__item" id="ff9affe8"><p>将以下指令添加到相关<span class="filepath">.conf</span>文件的VirtualHost部分中：</p><div class="code-block" data-lang="none">协议h2 http / 1.1 RequestHeader在ProxyRequests上的AllowEncodedSlashes上设置了X-Forwarded-Proto“ https” RewriteEngine在ProxyPass / http://127.0.0.1:1111/ ProxyPassReverse / http://127.0.0.1:1111/ SSLEngine上的SSLCertificateFile <path_to_certificate>SSLCertificateKeyFile <path_to_key>
    </path_to_key></path_to_certificate></div>            <p></p></li><li class="list__item" id="46b548d1">                <p id="ccc40d83">设置以下变量以匹配您的配置：</p>                <ul class="list _ul"><li class="list__item" id="2babf479"><p>更换<code class="code">1111</code>以及FLS侦听的实际端口号。</p></li><li class="list__item" id="c750e81e"><p>设置值<code class="code"><path_to_certificate></code>服务器的SSL / TLS证书的位置。</p></li><li class="list__item" id="79765a22"><p>设置值<code class="code"><path_to_key></code>服务器证书的PEM编码私钥文件的位置。</p></li></ul>            </li><li class="list__item" id="89a6ac98"><p>将其他HSTS标头添加到HTTPS VirtualHost指令。最大年龄以秒为单位。</p><div class="code-block" data-lang="none">＃保证1年的HTTPS（包括子域）标头始终设置为严格传输安全性“ max-age = 31536000; includeSubDomains”</div>请注意，此标头仅在HTTPS <span class="control">VirtualHost</span>上有效。<p></p></li></ol></section>        <p id="32dcf7ec">有关更多信息，请参阅<a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html" rel="noopener noreferrer" data-external="true" target="_blank">Apache Module mod_proxy</a>的文档。</p>    </div>    <div class="chapter"><h2 id="iis-server-configuration" data-toc="configuring_secure_connection#iis-server-configuration">IIS服务器</h2>        <p id="c616892c">要将IIS服务器用作反向代理，您需要使用应用程序请求路由（ARR）扩展。需要IIS 10.0版本1709或更高版本。</p>        <section class="procedure-steps"><h3 id="71a400a1">要将IIS服务器设置为反向代理，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="5a6ddfbd"><p>从<a href="https://www.iis.net/downloads/microsoft/application-request-routing" rel="noopener noreferrer" data-external="true" target="_blank">Microsoft网站</a>下载并安装应用程序请求路由（ARR）扩展。</p></li><li class="list__item" id="bf2b9da8"><p>在IIS管理器中，连接到IIS服务器-在这种情况下， <code class="code">localhost</code> 。</p></li><li class="list__item" id="8b48cef6"><p>在“ <span class="control">连接”</span>窗格中突出显示服务器。</p></li><li class="list__item" id="a5b90d95"><p>双击<span class="control">URL重写。</span>            </p></li><li class="list__item" id="22a4dbff"><p>单击右窗格中的<span class="control">查看服务器变量</span> 。</p></li><li class="list__item" id="74bd5962"><p>将以下服务器变量添加到列表中：</p><div class="code-block" data-lang="none">HTTP_X_FORWARDED_HOST HTTP_X_FORWARDED_SCHEME HTTP_X_FORWARDED_PROTO</div>            <p></p></li><li class="list__item" id="6f0d28dd">                <p id="08c1a8a6">设置响应缓冲区阈值。对于单个Web服务器：</p>                <ul class="list _ul"><li class="list__item" id="1a757743"><p>双击“ <span class="control">应用程序请求路由缓存”</span> 。</p></li><li class="list__item" id="e51177d8"><p>单击<span class="control">“</span> <span class="control">操作”</span>窗格中“代理”标题下的“ <span class="control">服务器代理设置”</span> 。</p></li><li class="list__item" id="891c2a0a"><p>选中<span class="control">启用代理</span>复选框，将<span class="control">响应缓冲区阈值</span>设置为0，然后点击<span class="control">应用</span> 。保留默认值。</p></li></ul>                <p id="50f25ccb">对于服务器场：</p>                <ul class="list _ul"><li class="list__item" id="d2832307"><p>在“ <span class="control">连接”</span>窗格中选择FLS服务器场。</p></li><li class="list__item" id="1aa11ae2"><p>双击<span class="control">代理</span>图标。</p></li><li class="list__item" id="7959a069"><p>在表单的“ <span class="control">缓冲区设置”</span>部分中，将“ <span class="control">响应缓冲区”阈值</span>设置为0，然后单击“ <span class="control">应用”</span> 。</p></li></ul>            </li><li class="list__item" id="812db54b"><p>取消选中“ <span class="control">在响应标头中反向重写主机”</span>复选框，然后单击“ <span class="control">应用”</span> 。</p></li><li class="list__item" id="3b33690a"><p>在“ <span class="control">连接”</span>窗格中的“ <span class="control">站点”</span>下，选择“ <span class="control">默认网站”</span> 。</p></li><li class="list__item" id="98d767a2"><p>双击“ <span class="control">URL重写”</span>功能，然后在“ <span class="control">操作”</span>窗格中单击“ <span class="control">添加规则”</span> 。</p></li><li class="list__item" id="7e5703e4"><p>添加具有服务器名称的反向代理规则： <code class="code">localhost:1111</code> （替换为FLS的实际位置和端口）。</p></li><li class="list__item" id="28545598">                <p id="ee75a271">打开规则，检查重写URL，然后添加以下服务器变量：</p>                <ul class="list _ul"><li class="list__item" id="561069d7"><p>设置<code class="code">HTTP_X_FORWARDED_HOST</code>可变为<code class="code">{HTTP_HOST}</code> 。</p></li><li class="list__item" id="27bb52fb"><p>设置<code class="code">HTTP_X_FORWARDED_SCHEME</code>可变为<code class="code">https</code> 。</p></li><li class="list__item" id="e107f9de"><p>设置<code class="code">HTTP_X_FORWARDED_PROTO</code>至<code class="code">https</code> 。</p></li></ul>            </li><li class="list__item" id="82984209"><p>取消选择选项包括来自客户端IP的TCP端口（如果尚未）。</p></li><li class="list__item" id="71b852d9">                <p id="941a4568">确保启用了匿名身份验证：</p>                <ul class="list _ul"><li class="list__item" id="8a101d85"><p>在“ <span class="control">连接”</span>窗格的“ <span class="control">站点”</span>部分中，选择“ <span class="control">默认网站”</span> 。</p></li><li class="list__item" id="f0f4f4c7"><p>双击<span class="control">Authentication</span> ，选择<span class="control">Anonymous</span> ，然后在右窗格中单击<span class="control">Enable</span> 。</p></li></ul>            </li><li class="list__item" id="ee14b734"><p>确保禁用<span class="control">动态内容压缩</span> 。此设置的位置因操作系统而异。</p></li><li class="list__item" id="bb237042"><p>在“ <span class="control">连接”</span>窗格中的“ <span class="control">站点”</span>下，选择“ <span class="control">默认网站”</span> 。</p></li><li class="list__item" id="9fc8b626"><p>双击“ <span class="control">请求筛选”</span>功能，然后在“ <span class="control">操作”</span>窗格中单击“ <span class="control">编辑</span> <span class="control">功能设置”</span> 。</p></li><li class="list__item" id="cdb5561b"><p>增加以下参数的值：</p><div class="code-block" data-lang="none">“最大URL长度” = 6144“最大查询字符串” = 4096</div>            <p></p></li><li class="list__item" id="da6c6b49">                <p id="b090da3c">将新的SSL绑定添加到“ <span class="control">默认网站”</span> 。</p>                <ul class="list _ul"><li class="list__item" id="2555389b"><p>SSL绑定侦听的地址（主机URL）应与基本URL相匹配。</p></li><li class="list__item" id="6e4c4691"><p>您选择的证书应与服务器DNS地址相对应。</p></li></ul>            </li></ol><p id="017b66d0">有关特定说明，请参阅<a href="https://docs.microsoft.com/en-us/iis" rel="noopener noreferrer" data-external="true" target="_blank">IIS配置</a> 。</p></section>    </div>    <div class="chapter"><h2 id="nginx-server-configuration" data-toc="configuring_secure_connection#nginx-server-configuration">NGINX服务器</h2>        <p id="4d5a512e">将NGINX服务器配置为反向代理的基本要求包括以下步骤（需要NGINX版本1.11.7或更高版本）：</p>        <ul class="list _ul"><li class="list__item" id="3b538a37"><p>更新<a href="http://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile" rel="noopener noreferrer" data-external="true" target="_blank">worker_rlimit_nofile</a>和<a href="http://nginx.org/en/docs/ngx_core_module.html#worker_connections" rel="noopener noreferrer" data-external="true" target="_blank">worker_connections</a>指令的值。</p></li><li class="list__item" id="832dd7a1"><p>设置<a href="http://nginx.org/en/docs/http/server_names.html" rel="noopener noreferrer" data-external="true" target="_blank">server_name</a>指令的变量。</p></li><li class="list__item" id="0ab2c436"><p>添加<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" rel="noopener noreferrer" data-external="true" target="_blank">proxy_set_header</a>和<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" rel="noopener noreferrer" data-external="true" target="_blank">proxy_pass</a>指令。</p></li></ul>        <section class="procedure-steps"><h3 id="3d32781b">配置NGINX反向代理头：</h3><ol class="list _decimal"><li class="list__item" id="5ab8c4b7">                <p id="05ffa975">打开您的NGINX服务器的配置文件。默认情况下，配置文件名为<span class="filepath">nginx.conf</span> 。缺省目录是<span class="filepath">/ usr / local / nginx / conf</span> ， <span class="filepath">/ etc / nginx</span>或<span class="filepath">/ usr / local / etc / nginx</span> 。</p>                <p id="f29dc24d">您可以通过输入以下内容找到配置文件的确切位置<code class="code">nginx -V</code>在命令行界面中。</p>            </li><li class="list__item" id="ed91935f"><p>增加价值<code class="code">worker_rlimit_nofile</code>指令的最小值为4096。</p></li><li class="list__item" id="1681f569"><p>在事件部分中，增加<code class="code">worker_connections</code>指令的最小值为2048。</p></li><li class="list__item" id="03145de9"><p>更新服务器指令并添加<code class="code">proxy_set_header</code>和<code class="code">proxy_pass</code>配置文件中的指令。使用以下示例作为指导：</p><div class="code-block" data-lang="none">服务器{监听443 ssl; ssl_certificate <path_to_certificate>; ssl_certificate_key <path_to_key>; server_name localhost; ssl_session_cache shared：SSL：1m; ssl_session_timeout 5m; ssl_ciphers高：！空：！MD5； ssl_prefer_server_ciphers;位置/ {proxy_set_header X-Forwarded-Host $ http_host; proxy_set_header X-Real-IP $ remote_addr; proxy_set_header主机$ host; proxy_set_header X-Forwarded-For $ remote_addr; proxy_set_header X-Forwarded-Proto https; proxy_pass http：// license-server-domain：1111; proxy_http_version 1.1; }}</path_to_key></path_to_certificate></div>            <p></p></li><li class="list__item" id="bc3d5856">                <p id="aaae7115">设置以下变量以匹配您的许可证服务器配置：</p>                <ul class="list _ul"><li class="list__item" id="6ced6d4f"><p>                        <code class="code">listen</code>是您在<code class="code">--base-url</code>参数。</p></li><li class="list__item" id="ef22f220"><p>                        <code class="code">proxy_pass</code>是您在FLS上使用您指定的端口的路径<code class="code">--listen-port</code>命令。</p></li></ul>            </li><li class="list__item" id="1d61d87f"><p>保存并关闭您的配置文件。您可以使用<code class="code">nginx -t</code>测试配置语法或使用以下命令重新加载配置：</p><div class="code-block" data-lang="bash">sudo nginx -s重新加载</div>            <p></p></li></ol></section>        <p id="27f43687">请参阅相应的Nginx文档页面，以获取有关以下内容的说明： <code class="code">server_name</code> ， <code class="code">proxy_set_header</code> ， <code class="code">proxy_pass</code> ： <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" rel="noopener noreferrer" data-external="true" target="_blank">模块ngx_http_proxy_module</a> 。</p>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月22日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="configuring_data_directory.html">配置数据目录</a> <a class="navigation-links__next" href="configuring_reverse_proxy.html">反向代理</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>