<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Secure connection - Help | Floating License Server</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="configuring_secure_connection"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search Floating License Server Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Floating License Server  Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="configuring_secure_connection" id="configuring_secure_connection.xml">Secure connection</h1>    <p id="228e96b5">        Since Floating License Server (FLS) doesn't support an HTTPS connection, you can use reverse proxy servers to add        security. This section contains instructions on configuring the most popular ones. To specify their reachability        in the FLS configuration file, see        <a href="configuring_reverse_proxy.html">Configuring reverse proxy</a>.    </p>    <div class="chapter"><h2 id="apache-http-server-configuration" data-toc="configuring_secure_connection#apache-http-server-configuration">Apache HTTP server</h2>        <p id="502ae10d">To use an Apache HTTP Server as a reverse proxy, you need to run an <code class="code">a2enmod</code> script and add            directives to a <span class="filepath">.conf</span> file on your server. Requires Apache httpd version 2.4.17 or later.        </p>        <section class="procedure-steps"><h3 id="0dfae2e5">To set up an Apache HTTP Server as a reverse proxy:</h3><ol class="list _decimal"><li class="list__item" id="7fb81270"><p>Use the following a2enmod script to enable the <code class="code">headers</code>, <code class="code">rewrite</code>, <code class="code">proxy_http</code>, <code class="code">ssl</code>, and <code class="code">http2</code> modules:                <div class="code-block" data-lang="none">
                    $ a2enmod headers
                    $ a2enmod rewrite
                    $ a2enmod proxy_http
                    $ a2enmod ssl
                    $ a2enmod http2
    </div>            </p></li><li class="list__item" id="ff9affe8"><p>Add the following directives to the VirtualHost section of a relevant <span class="filepath">.conf</span> file:                <div class="code-block" data-lang="none">
                    Protocols h2 http/1.1

                    RequestHeader set X-Forwarded-Proto "https"

                    RewriteEngine on
                    AllowEncodedSlashes on

                    ProxyRequests off

                    ProxyPass / http://127.0.0.1:1111/
                    ProxyPassReverse / http://127.0.0.1:1111/

                    SSLEngine On
                    SSLCertificateFile &lt;path_to_certificate&gt;
                    SSLCertificateKeyFile &lt;path_to_key&gt;
    </div>            </p></li><li class="list__item" id="46b548d1">                <p id="ccc40d83">Set the following variables to match your configuration:</p>                <ul class="list _ul"><li class="list__item" id="2babf479"><p>                        Replace <code class="code">1111</code> with the actual port number that your FLS listens to.                    </p></li><li class="list__item" id="c750e81e"><p>                        Set the value for the <code class="code">&lt;path_to_certificate&gt;</code> to the location of the                        SSL/TLS certificate for your server.                    </p></li><li class="list__item" id="79765a22"><p>                        Set the value for the <code class="code">&lt;path_to_key&gt;</code> to the location of the PEM-encoded                        private key file for the server certificate.                    </p></li></ul>            </li><li class="list__item" id="89a6ac98"><p>                Add the additional HSTS header to the HTTPS VirtualHost directive. Max-age is measured in seconds.                <div class="code-block" data-lang="none">
                    # Guarantee HTTPS for 1 Year including subdomains
                    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    </div>                Note that this header is only valid on a HTTPS <span class="control">VirtualHost</span>.            </p></li></ol></section>        <p id="32dcf7ec">For more information, refer to the documentation for            <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html" data-external="true" target="_blank" rel="noopener noreferrer">Apache Module mod_proxy</a>.        </p>    </div>    <div class="chapter"><h2 id="iis-server-configuration" data-toc="configuring_secure_connection#iis-server-configuration">IIS server</h2>        <p id="c616892c">To use an IIS server as a reverse proxy, you need to use the Application Request Routing (ARR) extension.            Requires IIS version 10.0 version 1709 or later.        </p>        <section class="procedure-steps"><h3 id="71a400a1">To set up an IIS server as a reverse proxy:</h3><ol class="list _decimal"><li class="list__item" id="5a6ddfbd"><p>                Download and install the Application Request Routing (ARR) extension from the                <a href="https://www.iis.net/downloads/microsoft/application-request-routing" data-external="true" target="_blank" rel="noopener noreferrer">Microsoft website</a>.            </p></li><li class="list__item" id="bf2b9da8"><p>                In IIS Manager, connect to the IIS server - in this case,                <code class="code">localhost</code>.            </p></li><li class="list__item" id="8b48cef6"><p>                Highlight the server in the <span class="control">Connection</span> pane.            </p></li><li class="list__item" id="a5b90d95"><p>                Double-click                <span class="control">URL Rewrite.</span>            </p></li><li class="list__item" id="22a4dbff"><p>                Click <span class="control">View server variables</span> in the right pane.            </p></li><li class="list__item" id="74bd5962"><p>                Add the following server variables to the list:                <div class="code-block" data-lang="none">
                    HTTP_X_FORWARDED_HOST
                    HTTP_X_FORWARDED_SCHEME
                    HTTP_X_FORWARDED_PROTO
    </div>            </p></li><li class="list__item" id="6f0d28dd">                <p id="08c1a8a6">Set the response buffer threshold. For single web servers:</p>                <ul class="list _ul"><li class="list__item" id="1a757743"><p>                        Double-click                        <span class="control">Application Request Routing Cache</span>.                    </p></li><li class="list__item" id="e51177d8"><p>                        Click <span class="control">Server Proxy Settings</span> under the Proxy heading in the <span class="control">                        Actions                    </span> pane.                    </p></li><li class="list__item" id="891c2a0a"><p>                        Select the <span class="control">Enable proxy</span> checkbox, set the <span class="control">Response buffer                        threshold                    </span> to 0, then click <span class="control">Apply</span>. Leave the default values in place.                    </p></li></ul>                <p id="50f25ccb">For server farms:</p>                <ul class="list _ul"><li class="list__item" id="d2832307"><p>                        Select the FLS server farm in the <span class="control">                        Connections                    </span> pane.                    </p></li><li class="list__item" id="1aa11ae2"><p>                        Double-click the <span class="control">Proxy</span> icon.                    </p></li><li class="list__item" id="7959a069"><p>                        In the <span class="control">Buffer Setting</span> section of the form, set the <span class="control">Response                        buffer threshold                    </span> to 0, then click <span class="control">Apply</span>.                    </p></li></ul>            </li><li class="list__item" id="812db54b"><p>                Deselect the <span class="control">Reverse rewrite host in response headers</span> checkbox and click                <span class="control">Apply</span>.            </p></li><li class="list__item" id="3b33690a"><p>                In the <span class="control">Connections</span> pane, under <span class="control">Sites</span>, select <span class="control">Default                Web Site</span>.            </p></li><li class="list__item" id="98d767a2"><p>                Double-click the <span class="control">URL Rewrite</span> feature, then click <span class="control">Add Rule(s)</span> in                the <span class="control">Actions</span> pane.            </p></li><li class="list__item" id="7e5703e4"><p>                Add a reverse proxy rule with the server name: <code class="code">localhost:1111</code> (replace with the real                location and port of your FLS).            </p></li><li class="list__item" id="28545598">                <p id="ee75a271">Open the rule, check the rewrite URL, and add the following server variables:</p>                <ul class="list _ul"><li class="list__item" id="561069d7"><p>                        Set the <code class="code">HTTP_X_FORWARDED_HOST</code> variable to <code class="code">{HTTP_HOST}</code>.                    </p></li><li class="list__item" id="27bb52fb"><p>                        Set the <code class="code">HTTP_X_FORWARDED_SCHEME</code> variable to <code class="code">https</code>.                    </p></li><li class="list__item" id="e107f9de"><p>                        Set the <code class="code">HTTP_X_FORWARDED_PROTO</code> to <code class="code">https</code>.                    </p></li></ul>            </li><li class="list__item" id="82984209"><p>                Deselect option Include TCP port from client IP (if not yet).            </p></li><li class="list__item" id="71b852d9">                <p id="941a4568">Make sure that anonymous authentication is enabled:</p>                <ul class="list _ul"><li class="list__item" id="8a101d85"><p>                        In the <span class="control">Sites</span> section of the <span class="control">Connections</span> pane,                        select <span class="control">Default Web Site</span>.                    </p></li><li class="list__item" id="f0f4f4c7"><p>                        Double-click <span class="control">Authentication</span>, select <span class="control">Anonymous</span>, then                        click <span class="control">Enable</span> in the right pane.                    </p></li></ul>            </li><li class="list__item" id="ee14b734"><p>                Make sure that <span class="control">Dynamic Content Compression</span> is disabled. The location of this                setting varies by operating system.            </p></li><li class="list__item" id="bb237042"><p>                In the <span class="control">Connections</span> pane, under <span class="control">Sites</span>, select <span class="control">Default                Web Site</span>.            </p></li><li class="list__item" id="9fc8b626"><p>                Double-click the <span class="control">Request Filtering</span> feature, then click                <span class="control">Edit</span>                <span class="control">Feature Settings</span>                in the <span class="control">Actions</span> pane.            </p></li><li class="list__item" id="cdb5561b"><p>                Increase the values for the following parameters:                <div class="code-block" data-lang="none">
                    "Maximum URL length" = 6144
                    "Maximum query string" = 4096
    </div>            </p></li><li class="list__item" id="da6c6b49">                <p id="b090da3c">Add a new SSL binding to the <span class="control">Default Web Site</span>.                </p>                <ul class="list _ul"><li class="list__item" id="2555389b"><p>                        The address that the SSL binding listens to (Host URL) should match the base URL.                    </p></li><li class="list__item" id="6e4c4691"><p>                        The certificate that you choose should correspond to the server DNS address.                    </p></li></ul>            </li></ol><p id="017b66d0">For specific instructions, refer to the                <a href="https://docs.microsoft.com/en-us/iis" data-external="true" target="_blank" rel="noopener noreferrer">IIS configuration</a>.            </p></section>    </div>    <div class="chapter"><h2 id="nginx-server-configuration" data-toc="configuring_secure_connection#nginx-server-configuration">NGINX server</h2>        <p id="4d5a512e">The basic requirements for configuring an NGINX server as a reverse proxy consists of the following steps            (requires NGINX version 1.11.7 or later):        </p>        <ul class="list _ul"><li class="list__item" id="3b538a37"><p>                Update the values for the <a href="http://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile" data-external="true" target="_blank" rel="noopener noreferrer">worker_rlimit_nofile</a> and <a href="http://nginx.org/en/docs/ngx_core_module.html#worker_connections" data-external="true" target="_blank" rel="noopener noreferrer">worker_connections</a> directives.            </p></li><li class="list__item" id="832dd7a1"><p>Set the variables for the <a href="http://nginx.org/en/docs/http/server_names.html" data-external="true" target="_blank" rel="noopener noreferrer">server_name</a> directive.            </p></li><li class="list__item" id="0ab2c436"><p>Add the <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" data-external="true" target="_blank" rel="noopener noreferrer">proxy_set_header</a> and <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" data-external="true" target="_blank" rel="noopener noreferrer">proxy_pass</a> directives.            </p></li></ul>        <section class="procedure-steps"><h3 id="3d32781b">To configure NGINX reverse proxy headers:</h3><ol class="list _decimal"><li class="list__item" id="5ab8c4b7">                <p id="05ffa975">Open the configuration file for your NGINX server. By default, the configuration file is                    named <span class="filepath">nginx.conf</span>. The default directory is either <span class="filepath">                        /usr/local/nginx/conf</span>, <span class="filepath">/etc/nginx</span>, or <span class="filepath">/usr/local/etc/nginx</span>.                </p>                <p id="f29dc24d">You can find the exact location of the configuration file by entering <code class="code">nginx -V</code> in a                    command line interface.                </p>            </li><li class="list__item" id="ed91935f"><p>Increase the value for the <code class="code">worker_rlimit_nofile</code> directive to a minimum value of 4096.            </p></li><li class="list__item" id="1681f569"><p>In the events section, increase the value for the <code class="code">worker_connections</code> directive to a                minimum value of 2048.            </p></li><li class="list__item" id="03145de9"><p>Update the server directive and add the <code class="code">proxy_set_header</code> and <code class="code">proxy_pass</code> directives                in your configuration file. Use the following sample as a guide:                <div class="code-block" data-lang="none">
                    server {
                        listen 443 ssl;
                        ssl_certificate &lt;path_to_certificate&gt;;
                        ssl_certificate_key &lt;path_to_key&gt;;
                        server_name localhost;
                        ssl_session_cache shared:SSL:1m;
                        ssl_session_timeout 5m;
                        ssl_ciphers HIGH:!aNULL:!MD5;
                        ssl_prefer_server_ciphers on;

                        location / {
                            proxy_set_header X-Forwarded-Host $http_host;
                            proxy_set_header X-Real-IP $remote_addr;
                            proxy_set_header Host $host;
                            proxy_set_header X-Forwarded-For $remote_addr;
                            proxy_set_header X-Forwarded-Proto https;
                            proxy_pass http://license-server-domain:1111;
                            proxy_http_version 1.1;
                        }
                    }
    </div>            </p></li><li class="list__item" id="bc3d5856">                <p id="aaae7115">Set the following variables to match your license server configuration:</p>                <ul class="list _ul"><li class="list__item" id="6ced6d4f"><p>                        <code class="code">listen</code>                        is the port number that you specified in the <code class="code">--base-url</code> parameter.                    </p></li><li class="list__item" id="ef22f220"><p>                        <code class="code">proxy_pass</code>                        is the path to your FLS with the port that                        you specified with the <code class="code">--listen-port</code> command.                    </p></li></ul>            </li><li class="list__item" id="1d61d87f"><p>Save and close your configuration file. You can use <code class="code">nginx -t</code> to test the config                syntax or reload the configuration with the following command:                <div class="code-block" data-lang="bash">sudo nginx -s reload</div>            </p></li></ol></section>        <p id="27f43687">            Refer to the corresponding Nginx documentation pages for a description of            <code class="code">server_name</code>, <code class="code">proxy_set_header</code>, <code class="code">proxy_pass</code>:            <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" data-external="true" target="_blank" rel="noopener noreferrer">Module ngx_http_proxy_module</a>.        </p>    </div><div class="last-modified" data-skip-index="skip">Last modified: 22 November 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="configuring_data_directory.html">Configuring data directory</a><a class="navigation-links__next" href="configuring_reverse_proxy.html">Reverse proxy</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>