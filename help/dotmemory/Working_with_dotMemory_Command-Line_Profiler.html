<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta content="&#xA;        ASP.NET remote memory profiling, C# profiling from the console, remote profiling from command line,&#xA;        remote server profile memory&#xA;    " name="description" data-skip-index="skip"><meta charset="UTF-8"><title>Using dotMemory Command-Line Profiler - Help | dotMemory</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Working_with_dotMemory_Command-Line_Profiler" data-disqus-id="Working_with_dotMemory_Command-Line_Profiler_dm"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotMemory Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotMemory 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Working_with_dotMemory_Command-Line_Profiler" id="Working_with_dotMemory_Command-Line_Profiler.xml">Using dotMemory Command-Line Profiler</h1>        <p id="24716976">        There are multiple scenarios of how you can use the        <a href="https://www.jetbrains.com/dotmemory/download/#section=command-line-profiler" data-external="true" target="_blank" rel="noopener noreferrer">dotMemory.exe command-line tool</a>:        <ul class="list _ul"><li class="list__item" id="68497090"><p>                Profiling an application on a remote server. <br>                For example, this may be the case when it is not possible to install the standalone dotMemory to a                server.            </p></li><li class="list__item" id="42367a99"><p>                Automating the process of gathering memory snapshots. <br>                For example, if you want                to make profiling a part of your continuous integration builds: this can be a build step that performs                profiling of your integration tests.            </p></li><li class="list__item" id="ce98be6c"><p>                Speeding up profiling routines.<br>                For example, when you                regularly profile the same application and do not want to start the dotMemory user interface each time.            </p></li></ul>    </p>    <p id="67edb4ca">        The <span class="filepath">dotMemory.exe</span> tool can be used to profile any .NET or .NET Core application        (including an already running one) and        take memory snapshots.    </p>    <p id="8d629a8e">        Note that the tool is distributed free of charge as a        <a href="https://www.jetbrains.com/dotmemory/download/#section=command-line-profiler" data-external="true" target="_blank" rel="noopener noreferrer">.zip archive</a> or        <a href="https://www.nuget.org/packages/JetBrains.dotMemory.Console/" data-external="true" target="_blank" rel="noopener noreferrer">NuGet package</a> and does not require        dotMemory to be installed.        You can freely upload it to any computer to take memory        snapshots of problematic        applications.    </p>    <p id="8fb42106">        There are four main <span class="filepath">dotMemory.exe</span> commands:        <ul class="list _ul"><li class="list__item" id="4eda8e5d"><p>                <code class="code">get-snapshot</code>                - instantly get snapshot of a running app.            </p></li><li class="list__item" id="3067ffed"><p>                <code class="code">attach</code>                - attach the profiler to a running app and get snapshots by condition, using the API, or by sending                commands to                stdin.            </p></li><li class="list__item" id="841adcfe"><p>                <code class="code">start</code>                - start an app and get snapshots by condition, using the API, or by sending commands to stdin.            </p></li><li class="list__item" id="e1068ddd"><p>                <code class="code">start-iis</code>                - start IIS and get snapshots by condition, using the API, or by sending commands to stdin.            </p></li><li class="list__item" id="e68e716f"><p>                <code class="code">start-iis-express</code> - start IIS Express-hosted web application under profiling.</p></li><li class="list__item" id="15ad35e9"><p>                <code class="code">start-windows-service</code> - (re)start managed Windows service under profiling and get memory snapshot by                condition or using the API.            </p></li><li class="list__item" id="67d6d92d"><p>                <code class="code">start-wcf-service</code> - (re)start WCF host with specified WCF Service Library under profiling and get memory                snapshot by condition or using the API.            </p></li><li class="list__item" id="cedde70b"><p>                <code class="code">start-winrt</code> - start WinRT application under profiling and get memory snapshot by condition or using the                API.            </p></li><li class="list__item" id="b47f2e7f"><p>                <code class="code">profile-new-processes</code> - profile any managed application that is launched after executing this command.            </p></li><li class="list__item" id="873be0e7"><p>                <code class="code">list-iis-express</code> - show the list of available IIS Express installations.</p></li><li class="list__item" id="b8ce2007"><p>                <code class="code">list-wcf-host</code> - show the list of available WCF hosts.            </p></li><li class="list__item" id="9a05fe38"><p>                <code class="code">list-winrt</code> - show the list of available WinRT applications.            </p></li></ul>        For detailed information on a particular <span class="filepath">dotMemory.exe</span> command, run:        <div class="code-block" data-lang="bash">dotMemory.exe help &lt;command&gt;</div>    </p>    <p id="97199a2c">        This section covers only most basic tool usage scenarios:        <ul class="list _ul"><li class="list__item" id="2df82c9f">                <a href="#instant">Instantly get a snapshot of an already running application</a>            </li><li class="list__item" id="05094341">                <a href="#condition">Run an application and get a snapshot by condition</a>            </li><li class="list__item" id="288e7c8a">                <a href="#external">Run an application and get a snapshot by passing a message to stdin</a>            </li><li class="list__item" id="42ab9407">                <a href="#api">Run an application and control profiling using the API</a>            </li><li class="list__item" id="c28c5bf8">                <a href="#attach">Attach to and profile an already running application</a>            </li><li class="list__item" id="5b5c0911">                <a href="#iis">Run and profile an ASP.NET application</a>            </li></ul>    </p>    <div class="chapter"><h2 id="instant" data-toc="Working_with_dotMemory_Command-Line_Profiler#instant">Getting snapshot of a running application</h2>        <p id="02b67277">            It is the most simple and demanded scenario. There are two ways of identifying the application            you want to take snapshot from: via its PID or via its name.        </p>        <section class="procedure-steps"><h3 id="f8f9b96b">To instantly get a snapshot of a running application by its PID (e.g., 6844):</h3><ul class="list "><li class="list__item" id="0c4077ab"><p>                Run the command:                <div class="code-block" data-lang="none">
dotMemory.exe get-snapshot 6844 --save-to-dir=C:\Snapshots
    </div>            </p></li></ul></section>        <p id="fd69f239">            Here:            <ul class="list _ul"><li class="list__item" id="548290e2"><p>                    <code class="code">--save-to-dir=C:\Snapshots</code>                    - (optional) path to directory for saving a snapshot (more correctly, a workspace <code class="code">.dmw</code> file). In                    this                    case, snapshot filename will be generated automatically. If you want to specify the filename by                    yourself,                    use the <code class="code">--save-to-file</code> option.                </p></li><li class="list__item" id="d1975d23"><p>                    <code class="code">6844</code>                    - process PID (you can find it in Window Task Manager).                </p></li></ul>        </p>        <section class="procedure-steps"><h3 id="817bdd5f">To instantly get a snapshot of a running application by its name</h3><ul class="list "><li class="list__item" id="969e45d1"><p>                Run the command:                <div class="code-block" data-lang="bash">
                    dotMemory.exe get-snapshot MyApp --with-max-mem
    </div>                or                <div class="code-block" data-lang="bash">
                    dotMemory.exe get-snapshot MyApp --all
    </div>            </p></li></ul></section>        <p id="1ae7c297">            Here:            <ul class="list _ul"><li class="list__item" id="216e95f4"><p>                    <code class="code">MyApp</code>                    - process name (you can find it in Windows Task Manager). If there are more than one process                    with such name, you can remove the ambiguity either with the <code class="code">--with-max-mem</code> or                    <code class="code">--all</code>                    option.                </p></li><li class="list__item" id="6eadc9d0"><p>                    <code class="code">--with-max-mem</code>                    - a process that consumes most of the memory will be profiled.                </p></li><li class="list__item" id="24c6db7c"><p>                    <code class="code">--all</code>                    - all processes with the specified name will be profiled. dotMemory                    will take snapshots of all process (snapshot per process).                </p></li></ul>        </p>    </div>    <div class="chapter"><h2 id="condition" data-toc="Working_with_dotMemory_Command-Line_Profiler#condition">Starting application and getting snapshots by condition</h2>    <p id="c9c2de0e">        Sometimes it may be necessary to track application memory consumption during a long time interval.        In this case, you can start your application under profiling and get snapshots only in case        a particular condition is satisfied: a periodic time interval ends or memory consumption increases by        a specified value.    </p>    <section class="procedure-steps"><h3 id="1252600d">To start MyApp.exe and take snapshots periodically</h3><ul class="list "><li class="list__item" id="45cfce40"><p>            Run the command:            <div class="code-block" data-lang="none">
dotMemory.exe start --trigger-timer=30s C:\MyApp\MyApp.exe MyAppArg1
    </div>        </p></li></ul></section>    <p id="309089b0">        Here:        <ul class="list _ul"><li class="list__item" id="568a3fcd"><p>                <code class="code">--trigger-timer=30s</code>                - time period for taking snapshots (30 s in our case).            </p></li><li class="list__item" id="fb86045f"><p>                <code class="code">C:\MyApp\MyApp.exe</code>                - path to the executable file of the profiled app.            </p></li><li class="list__item" id="b563e208"><p>                <code class="code">MyAppArg1</code>                - (optional) argument of MyApp.exe. Note that if application argument starts                with the dash (-) character, you can escape it using double dash (--). For example,                <br>                <div class="code-block" data-lang="none">
dotMemory.exe start --trigger-timer=30s C:\MyApp\MyApp.exe -- -MyAppArg1
    </div>            </p></li></ul>    </p>    <section class="procedure-steps"><h3 id="addf01fe">To start MyApp.exe and take snapshots when memory consumption     increases by the specified value</h3><ul class="list "><li class="list__item" id="ae0f1a48"><p>            Run the command:            <div class="code-block" data-lang="none">
dotMemory.exe start --trigger-mem-inc=50% --trigger-delay=5s C:\MyApp\MyApp.exe
    </div>        </p></li></ul></section>    <p id="1c9167eb">        Here:        <ul class="list _ul"><li class="list__item" id="294a8964"><p>                <code class="code">--trigger-mem-inc=50%</code>                - a snapshot will be taken only when memory consumption of MyApp increases by 50%.            </p></li><li class="list__item" id="201b97a1"><p>                <code class="code">--trigger-delay=5s</code>                - a trigger will be enabled with the 5 s pause to                skip the application startup phase.            </p></li></ul>    </p>        <p id="7010e99b">            Sometimes, you may want to get a snapshot immediately right after the start of the profiled application.            For example, you can use this snapshot as a base for comparison.        </p>        <section class="procedure-steps"><h3 id="982ac4ec">To start MyApp.exe and take a snapshot right after the profiler is initialized</h3><ul class="list "><li class="list__item" id="6e22948b"><p>                Run the command:                <div class="code-block" data-lang="none">
dotMemory.exe start --trigger-on-activation C:\MyApp\MyApp.exe
    </div>            </p></li></ul></section>        <p id="d4e4174d">            Here:            <ul class="list _ul"><li class="list__item" id="8edc945f"><p>                    <code class="code">--trigger-on-activation</code>                    - a snapshot will be taken immediately once the profiler is initialized. Note that if                    <code class="code">--trigger-delay</code> is set, <code class="code">--trigger-on-activation</code> will wait for                    this delay.                </p></li></ul>        </p>    </div>    <div class="chapter"><h2 id="external" data-toc="Working_with_dotMemory_Command-Line_Profiler#external">Starting application and getting snapshots using stdin messages</h2>        <p id="598357d6">            Sometimes it's necessary to have direct control over the profiling process, for example, get a snapshot at some            exact moment by a direct command. This can be done by sending special messages to stdin of dotMemory.exe.        </p>        <aside class="warning " data-title="" rel="598357d6" id="90f80e62"><p>            Messages sent to stdin must always start from a new line and end with a carriage return.            Both stdin and stdout messages have a format of a JSON array.        </p></aside>        <section class="procedure-steps"><h3 id="0f78e086">To start MyApp.exe and control profiling using stdin messages</h3><ol class="list _decimal"><li class="list__item" id="a0ec2962">                <p id="55fcfdc8">                    No additional arguments are required. You can start profiling as usual                    using <code class="code">attach</code>, or any of the <code class="code">start</code> commands. For example:                    <div class="code-block" data-lang="none">
dotMemory.exe start c:\MyApp\MyApp.exe
    </div>                </p>                <p id="b856bcee">                    dotMemory is able to inform you about how the profiling process is going by sending special                    service messages to stdout. This might be especially helpful in case you control profiling by                    some external script. To enable support for stdout messages, run dotMemory with the                    <code class="code">--service-output</code>                    option, for example:                    <div class="code-block" data-lang="none">
dotMemory.exe start --service-output c:\MyApp\MyApp.exe
    </div>                    dotMemory sends the following messages to stdout:                    <ul class="list _ul"><li class="list__item" id="b0256450"><p>                            Start of the profiling session                            <div class="code-block" data-lang="none">
##dotMemory["connected", {pid: 1234}]
    </div>                        </p></li><li class="list__item" id="7b0b6209"><p>                            Saving the snapshot                            <div class="code-block" data-lang="none">
##dotMemory["workspace-saved", {path: "..."}]
    </div>                        </p></li></ul>                </p>            </li><li class="list__item" id="00745d9a"><p>                Get a snapshot by sending the following command to stdin:                <div class="code-block" data-lang="none">
##dotMemory["get-snapshot", {pid:1234}]
    </div>                If <code class="code">pid</code> is specified, dotMemory will take a snapshot of the process with the specified PID.                Otherwise, dotMemory will take snapshots of all profiled processes.            </p></li><li class="list__item" id="8640a044"><p>                To stop profiling and kill the profiled application, send the following command to stdin:                <div class="code-block" data-lang="none">
##dotMemory["disconnect"]
    </div>                Works for all profiling sessions started with                <code class="code">attach</code> of any of the <code class="code">start</code> commands.            </p></li></ol></section>    </div>    <div class="chapter"><h2 id="api" data-toc="Working_with_dotMemory_Command-Line_Profiler#api">Starting application and getting snapshots using api</h2>        <p id="c8f4d8ea">            You also have the option to control profiling (get snapshots, detach from process, and so on)            using the            <a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">API</a>.        </p>        <section class="procedure-steps"><h3 id="aae121b3">To start MyApp.exe and control profiling with API</h3><ul class="list "><li class="list__item" id="51267166"><p>                Run the command:                <div class="code-block" data-lang="none">
dotMemory.exe start --use-api C:\MyApp\MyApp.exe
    </div>            </p></li></ul></section>    </div>    <div class="chapter"><h2 id="attach" data-toc="Working_with_dotMemory_Command-Line_Profiler#attach">Attaching to and profiling running applications</h2>        <p id="bcafdf2f">            If you want to profile an already running application and have full control over the            profiling process (unlike the <a href="#instant">get-snapshot</a> scenario), you should use the            <code class="code">attach</code>            command. It allows the profiler to attach to running processes (by PID or name as well as            <a href="#instant">get-snapshot</a>) and get snapshots using triggers, stdin commands, or the API.            For instance, here is the example of how to profile a running app MyApp.exe and get snapshots using a            trigger.        </p>        <section class="procedure-steps"><h3 id="ce6c9f6c">To attach to a running app and get snapshots periodically</h3><ul class="list "><li class="list__item" id="f25769f5"><p>                Run the command:                <div class="code-block" data-lang="none">
dotMemory attach MyApp.exe --trigger-timer=30s
    </div>            </p></li></ul></section>    </div>    <div class="chapter"><h2 id="iis" data-toc="Working_with_dotMemory_Command-Line_Profiler#iis">Running and profiling iis-hosted web applications</h2>        <p id="70407b9f">            If you want to profile an ASP.NET web application that runs on IIS server, you should use the            <code class="code">start-iis</code>            command. After you run the command, IIS will be started under profiling (for more            details on how IIS-hosted apps are profiled, refer to <a href="Profile_ASP_Web_Site.html">Profile Web Application on IIS Server</a>).            Note that <code class="code">start-iis</code> supports the same ways of controlling profiling as            the <code class="code">start</code> command: using triggers, stdin commands, and the API.            For instance, here is the example of how to profile a web app and get snapshots using a trigger.        </p>        <section class="procedure-steps"><h3 id="2852017c">To run IIS under profiling and get snapshots periodically</h3><ul class="list "><li class="list__item" id="037eb68d"><p>                Run the command:                <div class="code-block" data-lang="none">
dotMemory.exe start-iis --trigger-timer=30s --open-url=localhost/myapp --use-browser=Chrome
    </div>            </p></li></ul></section>        <p id="9646c3a2">            Here:            <ul class="list _ul"><li class="list__item" id="e5be6ad7"><p>                    <code class="code">--open-url=localhost/myapp</code>                    - URL of the profiled application that will be opened after you run profiling.                </p></li><li class="list__item" id="f549d6c7"><p>                    <code class="code">--use-browser=Chrome</code>                    - browser that should be used to open the URL. If not provided, the default system browser                    will be used.                </p></li></ul>        </p>    </div><div class="last-modified" data-skip-index="skip">Last modified: 8 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="API_Reference.html">API Reference</a><a class="navigation-links__next" href="Analyzing_Results.html">Analyzing Profiling Results</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>