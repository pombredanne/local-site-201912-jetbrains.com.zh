<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta name="description" content="
        ASP.NET remote memory profiling, C# profiling from the console, remote profiling from command line,
        remote server profile memory
    " data-skip-index="skip"><meta charset="UTF-8"><title>使用dotMemory命令行事件探查器-帮助|帮助点内存</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Working_with_dotMemory_Command-Line_Profiler" data-disqus-id="Working_with_dotMemory_Command-Line_Profiler_dm"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotMemory帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotMemory 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary" selected>视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Working_with_dotMemory_Command-Line_Profiler.xml" data-toc="Working_with_dotMemory_Command-Line_Profiler">使用dotMemory命令行事件探查器</h1>        <p id="24716976">关于如何使用<a href="/dotmemory/download/#section=command-line-profiler" rel="noopener noreferrer" data-external="true" target="_blank">dotMemory.exe命令行工具，</a>有多种方案：</p><ul class="list _ul"><li class="list__item" id="68497090"><p>在远程服务器上分析应用程序。<br>例如，当无法将独立dotMemory安装到服务器时，可能就是这种情况。</p></li><li class="list__item" id="42367a99"><p>自动化收集内存快照的过程。<br>例如，如果要对连续集成构建的一部分进行概要分析：这可以是对集成测试进行概要分析的构建步骤。</p></li><li class="list__item" id="ce98be6c"><p>加速性能分析例程。<br>例如，当您定期分析同一应用程序并且不想每次都启动dotMemory用户界面时。</p></li></ul>    <p></p>    <p id="67edb4ca"><span class="filepath">dotMemory.exe</span>工具可用于配置任何.NET或.NET Core应用程序（包括已经运行的应用程序）并拍摄内存快照。</p>    <p id="8d629a8e">请注意，该工具以<a href="/dotmemory/download/#section=command-line-profiler" rel="noopener noreferrer" data-external="true" target="_blank">.zip存档</a>或<a href="https://www.nuget.org/packages/JetBrains.dotMemory.Console/" rel="noopener noreferrer" data-external="true" target="_blank">NuGet软件包的形式</a>免费分发，并且不需要安装dotMemory。您可以将其自由上传到任何计算机，以获取有问题的应用程序的内存快照。</p>    <p id="8fb42106">有四个主要的<span class="filepath">dotMemory.exe</span>命令：</p><ul class="list _ul"><li class="list__item" id="4eda8e5d"><p>                <code class="code">get-snapshot</code> -立即获取正在运行的应用的快照。</p></li><li class="list__item" id="3067ffed"><p>                <code class="code">attach</code> -将事件探查器附加到正在运行的应用程序，并通过条件，使用API或向stdin发送命令来获取快照。</p></li><li class="list__item" id="841adcfe"><p>                <code class="code">start</code> -启动应用程序并使用API或通过向stdin发送命令按条件获取快照。</p></li><li class="list__item" id="e1068ddd"><p>                <code class="code">start-iis</code> -启动IIS，并使用API或通过向stdin发送命令来按条件获取快照。</p></li><li class="list__item" id="e68e716f"><p>                <code class="code">start-iis-express</code> -在配置文件下启动IIS Express托管的Web应用程序。</p></li><li class="list__item" id="15ad35e9"><p>                <code class="code">start-windows-service</code> -在配置文件下（重新）启动托管Windows服务，并按条件或使用API获取内存快照。</p></li><li class="list__item" id="67d6d92d"><p>                <code class="code">start-wcf-service</code> -在配置文件中使用指定的WCF服务库（重新）启动WCF主机，并按条件或使用API获取内存快照。</p></li><li class="list__item" id="cedde70b"><p>                <code class="code">start-winrt</code> -在配置文件下启动WinRT应用程序，并按条件或使用API获取内存快照。</p></li><li class="list__item" id="b47f2e7f"><p>                <code class="code">profile-new-processes</code> -分析执行此命令后启动的所有托管应用程序。</p></li><li class="list__item" id="873be0e7"><p>                <code class="code">list-iis-express</code> -显示可用的IIS Express安装列表。</p></li><li class="list__item" id="b8ce2007"><p>                <code class="code">list-wcf-host</code> -显示可用的WCF主机列表。</p></li><li class="list__item" id="9a05fe38"><p>                <code class="code">list-winrt</code> -显示可用的WinRT应用程序列表。</p></li></ul>有关特定<span class="filepath">dotMemory.exe</span>命令的详细信息，请运行：<div class="code-block" data-lang="bash">dotMemory.exe帮助<command></div>    <p></p>    <p id="97199a2c">本节仅介绍最基本的工具使用情况：</p><ul class="list _ul"><li class="list__item" id="2df82c9f">                <a href="#instant">即时获取已经运行的应用程序的快照</a>            </li><li class="list__item" id="05094341">                <a href="#condition">运行应用程序并按条件获取快照</a>            </li><li class="list__item" id="288e7c8a">                <a href="#external">运行应用程序并通过向stdin传递消息来获取快照</a>            </li><li class="list__item" id="42ab9407">                <a href="#api">使用API运行应用程序并控制性能分析</a>            </li><li class="list__item" id="c28c5bf8">                <a href="#attach">附加并配置已运行的应用程序</a>            </li><li class="list__item" id="5b5c0911">                <a href="#iis">运行并分析ASP.NET应用程序</a>            </li></ul>    <p></p>    <div class="chapter"><h2 id="instant" data-toc="Working_with_dotMemory_Command-Line_Profiler#instant">获取正在运行的应用程序的快照</h2>        <p id="02b67277">这是最简单且要求最高的方案。有两种方法可以识别要从中获取快照的应用程序：通过其PID或名称。</p>        <section class="procedure-steps"><h3 id="f8f9b96b">要通过其PID（例如6844）立即获取正在运行的应用程序的快照，请执行以下操作：</h3><ul class="list "><li class="list__item" id="0c4077ab"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe获取快照6844 --save-to-dir = C：\ Snapshots</div>            <p></p></li></ul></section>        <p id="fd69f239">这里：</p><ul class="list _ul"><li class="list__item" id="548290e2"><p>                    <code class="code">--save-to-dir=C:\Snapshots</code> -（可选）用于保存快照的目录路径（更正确地说是工作空间） <code class="code">.dmw</code>文件）。在这种情况下，快照文件名将自动生成。如果要自己指定文件名，请使用<code class="code">--save-to-file</code>选项。</p></li><li class="list__item" id="d1975d23"><p>                    <code class="code">6844</code> -处理PID（您可以在Window Task Manager中找到它）。</p></li></ul>        <p></p>        <section class="procedure-steps"><h3 id="817bdd5f">通过名称即时获取正在运行的应用程序的快照</h3><ul class="list "><li class="list__item" id="969e45d1"><p>运行命令：</p><div class="code-block" data-lang="bash">dotMemory.exe获取快照MyApp --with-max-mem</div>要么<div class="code-block" data-lang="bash">dotMemory.exe获取快照MyApp --all</div>            <p></p></li></ul></section>        <p id="1ae7c297">这里：</p><ul class="list _ul"><li class="list__item" id="216e95f4"><p>                    <code class="code">MyApp</code> -进程名称（您可以在Windows Task Manager中找到它）。如果使用该名称的进程不止一个，则可以使用<code class="code">--with-max-mem</code>要么<code class="code">--all</code>选项。</p></li><li class="list__item" id="6eadc9d0"><p>                    <code class="code">--with-max-mem</code> -将分析消耗大部分内存的进程。</p></li><li class="list__item" id="24c6db7c"><p>                    <code class="code">--all</code> -将对具有指定名称的所有进程进行概要分析。 dotMemory将为所有进程拍摄快照（每个进程快照）。</p></li></ul>        <p></p>    </div>    <div class="chapter"><h2 id="condition" data-toc="Working_with_dotMemory_Command-Line_Profiler#condition">启动应用程序并按条件获取快照</h2>    <p id="c9c2de0e">有时可能需要长时间跟踪应用程序的内存消耗。在这种情况下，只有在满足特定条件的情况下，才能在配置文件下启动应用程序并获取快照：定期时间间隔结束或内存消耗增加指定的值。</p>    <section class="procedure-steps"><h3 id="1252600d">启动MyApp.exe并定期拍摄快照</h3><ul class="list "><li class="list__item" id="45cfce40"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe开始--trigger-timer = 30s C：\ MyApp \ MyApp.exe MyAppArg1</div>        <p></p></li></ul></section>    <p id="309089b0">这里：</p><ul class="list _ul"><li class="list__item" id="568a3fcd"><p>                <code class="code">--trigger-timer=30s</code> -拍摄快照的时间段（在我们的情况下为30秒）。</p></li><li class="list__item" id="fb86045f"><p>                <code class="code">C:\MyApp\MyApp.exe</code> -所分析的应用程序的可执行文件的路径。</p></li><li class="list__item" id="b563e208"><p>                <code class="code">MyAppArg1</code> -（可选）MyApp.exe的参数。请注意，如果应用程序参数以破折号（-）开头，则可以使用双破折号（-）对其进行转义。例如，<br>                </p><div class="code-block" data-lang="none">dotMemory.exe开始--trigger-timer = 30s C：\ MyApp \ MyApp.exe--MyAppArg1</div>            <p></p></li></ul>    <p></p>    <section class="procedure-steps"><h3 id="addf01fe">启动MyApp.exe并在内存消耗增加指定值时拍摄快照</h3><ul class="list "><li class="list__item" id="ae0f1a48"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe开始--trigger-mem-inc = 50％--trigger-delay = 5s C：\ MyApp \ MyApp.exe</div>        <p></p></li></ul></section>    <p id="1c9167eb">这里：</p><ul class="list _ul"><li class="list__item" id="294a8964"><p>                <code class="code">--trigger-mem-inc=50%</code> -仅当MyApp的内存消耗增加50％时才拍摄快照。</p></li><li class="list__item" id="201b97a1"><p>                <code class="code">--trigger-delay=5s</code> -将在5秒的暂停时间内启用触发器，以跳过应用程序启动阶段。</p></li></ul>    <p></p>        <p id="7010e99b">有时，您可能希望在配置文件应用程序启动后立即获取快照。例如，您可以将此快照用作比较的基础。</p>        <section class="procedure-steps"><h3 id="982ac4ec">在初始化探查器后立即启动MyApp.exe并拍摄快照</h3><ul class="list "><li class="list__item" id="6e22948b"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe启动--trigger-on-activation C：\ MyApp \ MyApp.exe</div>            <p></p></li></ul></section>        <p id="d4e4174d">这里：</p><ul class="list _ul"><li class="list__item" id="8edc945f"><p>                    <code class="code">--trigger-on-activation</code> -初始化探查器后将立即拍摄快照。请注意，如果<code class="code">--trigger-delay</code>设置好了<code class="code">--trigger-on-activation</code>将等待此延迟。</p></li></ul>        <p></p>    </div>    <div class="chapter"><h2 id="external" data-toc="Working_with_dotMemory_Command-Line_Profiler#external">使用stdin消息启动应用程序并获取快照</h2>        <p id="598357d6">有时有必要直接控制分析过程，例如，通过直接命令在某个确切时刻获取快照。这可以通过将特殊消息发送到dotMemory.exe的stdin来完成。</p>        <aside class="warning " rel="598357d6" id="90f80e62" data-title=""><p>发送给stdin的消息必须始终从新行开始，并以回车结尾。stdin和stdout消息均具有JSON数组的格式。</p></aside>        <section class="procedure-steps"><h3 id="0f78e086">启动MyApp.exe并使用stdin消息控制配置文件</h3><ol class="list _decimal"><li class="list__item" id="a0ec2962">                <p id="55fcfdc8">不需要其他参数。您可以像往常一样开始使用<code class="code">attach</code> ，或任何<code class="code">start</code>命令。例如：</p><div class="code-block" data-lang="none">dotMemory.exe开始c：\ MyApp \ MyApp.exe</div>                <p></p>                <p id="b856bcee">dotMemory可以通过向stdout发送特殊服务消息来通知您有关配置过程的进展。如果您通过某些外部脚本控制性能分析，这可能会特别有用。要启用对标准输出消息的支持，请使用<code class="code">--service-output</code>选项，例如：</p><div class="code-block" data-lang="none">dotMemory.exe开始--service-output c：\ MyApp \ MyApp.exe</div>dotMemory将以下消息发送到stdout：<ul class="list _ul"><li class="list__item" id="b0256450"><p>分析会话开始</p><div class="code-block" data-lang="none">## dotMemory [“ connected”，{pid：1234}]</div>                        <p></p></li><li class="list__item" id="7b0b6209"><p>保存快照</p><div class="code-block" data-lang="none">## dotMemory [“ workspace-saved”，{路径：“ ...”}]</div>                        <p></p></li></ul>                <p></p>            </li><li class="list__item" id="00745d9a"><p>通过向stdin发送以下命令来获取快照：</p><div class="code-block" data-lang="none">## dotMemory [“ get-snapshot”，{pid：1234}]</div>如果<code class="code">pid</code>如果指定了dotMemory，它将使用指定的PID拍摄进程的快照。否则，dotMemory将为所有概要分析的进程拍摄快照。<p></p></li><li class="list__item" id="8640a044"><p>要停止分析并终止已分析的应用程序，请向stdin发送以下命令：</p><div class="code-block" data-lang="none">## dotMemory [“ disconnect”]</div>适用于所有配置文件会话的工作始于<code class="code">attach</code>任何<code class="code">start</code>命令。<p></p></li></ol></section>    </div>    <div class="chapter"><h2 id="api" data-toc="Working_with_dotMemory_Command-Line_Profiler#api">使用api启动应用程序并获取快照</h2>        <p id="c8f4d8ea">您还可以选择使用<a href="Profiling_Guidelines__Advanced_Profiling_Using_dotTrace_API.html">API</a>来控制性能分析（获取快照，与进程分离等）。</p>        <section class="procedure-steps"><h3 id="aae121b3">启动MyApp.exe并使用API控制性能分析</h3><ul class="list "><li class="list__item" id="51267166"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe开始--use-api C：\ MyApp \ MyApp.exe</div>            <p></p></li></ul></section>    </div>    <div class="chapter"><h2 id="attach" data-toc="Working_with_dotMemory_Command-Line_Profiler#attach">附加并分析正在运行的应用程序</h2>        <p id="bcafdf2f">如果要分析已经运行的应用程序并完全控制概要分析过程（与<a href="#instant">get-snapshot</a>方案不同），则应使用<code class="code">attach</code>命令。它允许探查器附加到正在运行的进程（通过PID或名称以及<a href="#instant">get-snapshot</a> ），并使用触发器，stdin命令或API获取快照。例如，这是如何配置正在运行的应用程序MyApp.exe并使用触发器获取快照的示例。</p>        <section class="procedure-steps"><h3 id="ce6c9f6c">附加到正在运行的应用程序并定期获取快照</h3><ul class="list "><li class="list__item" id="f25769f5"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory附加MyApp.exe --trigger-timer = 30秒</div>            <p></p></li></ul></section>    </div>    <div class="chapter"><h2 id="iis" data-toc="Working_with_dotMemory_Command-Line_Profiler#iis">运行和分析iis托管的Web应用程序</h2>        <p id="70407b9f">如果要分析在IIS服务器上运行的ASP.NET Web应用程序，则应使用<code class="code">start-iis</code>命令。运行命令后，将在配置文件下启动IIS（有关如何配置IIS托管的应用程序的更多详细信息，请参阅<a href="Profile_ASP_Web_Site.html">IIS Server上的Profile Web Application</a> ）。注意<code class="code">start-iis</code>支持与控制配置文件相同的方式<code class="code">start</code>命令：使用触发器，stdin命令和API。例如，这是如何配置Web应用程序并使用触发器获取快照的示例。</p>        <section class="procedure-steps"><h3 id="2852017c">在分析下运行IIS并定期获取快照</h3><ul class="list "><li class="list__item" id="037eb68d"><p>运行命令：</p><div class="code-block" data-lang="none">dotMemory.exe start-iis --trigger-timer = 30s --open-url = localhost / myapp --use-browser = Chrome</div>            <p></p></li></ul></section>        <p id="9646c3a2">这里：</p><ul class="list _ul"><li class="list__item" id="e5be6ad7"><p>                    <code class="code">--open-url=localhost/myapp</code> -运行概要分析后将打开的已概要分析的应用程序的URL。</p></li><li class="list__item" id="f549d6c7"><p>                    <code class="code">--use-browser=Chrome</code> -应该用于打开URL的浏览器。如果未提供，将使用默认的系统浏览器。</p></li></ul>        <p></p>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月8日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="API_Reference.html">API参考</a> <a class="navigation-links__next" href="Analyzing_Results.html">分析分析结果</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>