<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta content="&#xA;        ASP.NET memory profiling, profile ASP web site, memory profiling of web application,&#xA;        memory profile IIS site, IIS server memory profiling&#xA;    " name="description" data-skip-index="skip"><meta charset="UTF-8"><title>Profile Web Application on IIS Server - Help | dotMemory</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Profile_ASP_Web_Site" data-disqus-id="Profile_ASP_Web_Site_dm"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotMemory Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>dotMemory 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Profile_ASP_Web_Site" id="Profile_ASP_Web_Site.xml">Profile Web Application on IIS Server</h1>                <p id="42c26457">        Typically, determining performance issues in a web application is required when it is already        running on a server. The table summarizes all possible options of profiling the application:    </p>    <div class="table-wrapper"><table class=" wide                 " width="100%" id="379de992"><thead><tr id="fb2435bc" class="ijRowHead"><th id="a1d5c401"></th><th id="9a7dbe9f" width="30%"><p>Pros</p></th><th id="1a73b5bb" width="30%"><p>Not cons but features</p></th></tr></thead><tbody><tr id="9d5ecac6" class="ijRowOdd"><td id="262c17d0"><p>                <a href="#local-profiling">Local profiling</a>            </p></td><td id="65e29ed2">                <ul class="list _ul"><li class="list__item" id="81008397"><p>Easy to configure/use: you profile via the dotMemory GUI</p></li></ul>            </td><td id="4449c555">                <ul class="list _ul"><li class="list__item" id="3959176e"><p>                        dotMemory must be installed and run on the server, which may be impossible due to security                        restrictions, absence of GUI, etc                    </p></li></ul>            </td></tr><tr id="4b9b8790" class="ijRowEven"><td id="fd136e62"><p>                <a href="#remote-profiling">Remote profiling</a>            </p></td><td id="2f1cdcf3">                <ul class="list _ul"><li class="list__item" id="5abcbace"><p>                        Easy to configure/use: you profile via the dotMemory GUI                    </p></li><li class="list__item" id="546d13fc"><p>                        Snapshots are automatically uploaded to your local machine                    </p></li></ul>            </td><td id="3ee84899">                <ul class="list _ul"><li class="list__item" id="3e292a50"><p>                        dotMemory remote agent must be installed and run on the server                    </p></li><li class="list__item" id="72bd8460"><p>                        Communication via network is required                    </p></li></ul>            </td></tr><tr id="5f6a53d9" class="ijRowOdd"><td id="70d12398"><p>                <a href="#profiling-via-console-tools">Profiling via console tools</a>            </p></td><td id="100cb018">                <ul class="list _ul"><li class="list__item" id="edf7a3b8"><p>                        No network communication required                    </p></li><li class="list__item" id="4272fb8c"><p>                        Ability to create a number of predefined profiling configs and run them on demand                    </p></li></ul>            </td><td id="39bba4e4">                <ul class="list _ul"><li class="list__item" id="4e5ec0cd"><p>                        The console tools must be copied to and run on the server                    </p></li><li class="list__item" id="a92744b7"><p>                        Resulting snapshots must be manually copied from the server to the machine with                        dotMemory                    </p></li></ul>            </td></tr><tr id="89cf5c14" class="ijRowEven"><td id="30d6f5cc"><p>                <a href="#memory-dumps">Memory dumps</a>            </p></td><td id="02951d70">                <ul class="list _ul"><li class="list__item" id="6c2c0db7"><p>Nothing should be installed to the server</p></li><li class="list__item" id="39ca383c"><p>No profiling overhead</p></li></ul>            </td><td id="28c6c54b">                <ul class="list _ul"><li class="list__item" id="80712dc4"><p>                        Memory dumps contain less data than dotMemory snapshots                    </p></li></ul>            </td></tr></tbody></table></div>    <div class="chapter"><h2 id="local-profiling">Local profiling</h2>        <figure><img alt="how to app server local" title="how to app server local" src="/help/img/dotnet/2018.3/how_to_app_server_local.png" id="9610b9e3" width="291" height="355"></figure>        <p id="b17a2835">            Typically, local profiling is used when you need to profile the app that is hosted right on your            (developer's) machine or on some testing environment, which doesn't impose any security/performance            restrictions.        </p>        <section class="procedure-steps"><h2 id="dt_local">To locally profile a web app hosted on an IIS server</h2><ol class="list _decimal"><li class="list__item" id="497d8d4f"><p>                Install dotMemory on the server.            </p></li><li class="list__item" id="101bbf06"><p>                                <a href="Running_dotMemory.html">Run dotMemory as a standalone                    application</a>.                The dotMemory <span class="control">Home</span> window will open.            </p></li><li class="list__item" id="6be41de6"><p>                In the right panel, select                                <span class="control">Local</span>.            </p></li><li class="list__item" id="183f0996"><p>In the central panel, in <span class="control">Profile Application</span>, select                <span class="control">IIS</span>.            </p></li><li class="list__item" id="304dd63c"><p>In the right panel, in <span class="control">Application Options</span>, select                <span class="control">Open URL</span>                and specify the URL of the profiled application. If you do not do this, dotMemory will start profiling                of the first running application pool it'll be able to find.            </p></li><li class="list__item" id="acaa6f84"><p>                In the right panel, in <span class="control">Profiler Options</span>, specify profiling type.                <br>                For more details on                profiler options, refer to the                                <a href="dotMemory_Profiler_Options.html"><span>Profiler Options</span></a>                section.            </p></li><li class="list__item" id="85a5860f">                <aside class="note " data-title="" rel="85a5860f" id="c5df3620"><p>* This will allow you to see the methods that have allocated particular objects.</p></aside>                If you want dotMemory to start collecting the stack trace allocation data* right after the profiling                session starts, select the <span class="control">Start collecting allocation data immediately</span> option                in the right panel.            </li><li class="list__item" id="5d29a6b7"><p>                Optionally, if you are going to control profiling session (take snapshots, end session, and so on) using                the API (rather than the <span class="control">Controller</span> window), select                <span class="control">Control profiling via API</span>. For more details on how to control profiling using the                API,                refer to the                <a href="Controlling_Profiling_Process_Through_API.html"><span>Controlling Profiling Session Through API</span></a>                                chapter.            </p></li><li class="list__item" id="bd426ae9"><p>                Click <span class="control">Run</span>. Note that after you do this, the IIS service and, as a consequence, the                profiled application pool will be restarted.            </p></li><li class="list__item" id="66a3255a"><p>                    Take snapshots. For more details on how to control profiling session, refer to                                        <a href="Controlling_Profiling_Process.html"><span>Controlling Profiling Session</span></a>                    (if you control profiling manually) or to                                        <a href="Controlling_Profiling_Process_Through_API.html"><span>Controlling Profiling Session Through API</span></a>                    (if you control profiling using the API).                </p></li><li class="list__item" id="2edc7fd2"><p>                    After you collect the snapshot(s), click <span class="control">Detach</span> on the                    <span class="control">Controller</span>                    window to detach the profiler from the application pool.                </p></li><li class="list__item" id="24691ac2"><p>                    <a href="Analyzing_Results.html">Analyze the collected snapshots</a>.                </p></li></ol></section>    </div>    <div class="chapter"><h2 id="remote-profiling">Remote profiling</h2>        <figure><img alt="how to app server remote" title="how to app server remote" src="/help/img/dotnet/2018.3/how_to_app_server_remote.png" id="e9521681" width="617" height="351"></figure>        <p id="1a02dd3c">            Remote profiling is the best choice when it comes to a sudden performance drop / memory issue.        </p>        <p id="d45ae2e1">            How it works: dotMemory is running on your local machine, the remote agent is running on the            server, both communicating via TCP, as easy as that. The best thing about remote profiling is that you still            work with the easy to use dotMemory GUI and the collected snapshots are automatically copied to and            opened in dotMemory.        </p>        <section class="procedure-steps"><h2 id="3a9b720a">To remotely profile a web app hosted on an IIS server</h2><ol class="list _decimal"><li class="list__item" id="05d9c93c">On the web server, do the following:                <ul class="list _ul"><li class="list__item" id="011ae413"><p>Copy the <span class="filepath">RemoteAgent.zip</span> archive from the                        dotMemory installation directory on your local computer                        (by default, <span class="filepath">C:\Users\[username]\AppData\Local\JetBrains\Installations\dotMemory[N]</span>)                        to any directory on the server.                    </p></li><li class="list__item" id="3750851d"><p>Unpack the archive on the server.</p></li><li class="list__item" id="c459df6b"><p>Start <span class="filepath">RemoteAgent.exe</span> from the console on the server.                    </p></li><li class="list__item" id="6b78e99c"><p>Ensure that inbound connections to Remote Agent (by default, port 9100) are not blocked by the                        firewall.                    </p></li></ul>            </li><li class="list__item" id="c5b937d0"><p>On the local computer,                <span>run dotMemory as a standalone application</span>                <a href="Running_dotMemory.html">run dotMemory as a                    standalone                    application</a>.                The dotMemory window will open.            </p></li><li class="list__item" id="fb2e163c"><p>In the right panel, select                <span class="control">New Session | Remote</span>.            </p></li><li class="list__item" id="2381d80b"><p>In the central panel, specify the address of the remote agent service in                <span class="control">Remote Agent URL</span>.                <br>                By default, the URL is <span class="filepath">net.tcp://[remote_computer_IP_address]:9100/RemoteAgent</span>.            </p></li><li class="list__item" id="d0d8dfc4"><p>Click <span class="control">Connect</span> to establish connection with the remote host.            </p></li><li class="list__item" id="2598b402"><p>In the central panel, in <span class="control">Attach to Running Application</span> select the                <span class="filepath">w3wp.exe</span>                process that corresponds to the app pool running the profiled application.            </p></li><li class="list__item" id="df2f3e51"><p>                Optionally, if you are going to control profiling session (take snapshots, end session, and so on) using                the API (rather than the <span class="control">Controller</span> window), select                <span class="control">Control profiling via API</span>. For more details on how to control profiling using the                API,                refer to                                <a href="Controlling_Profiling_Process_Through_API.html"><span>Controlling Profiling Session Through API</span></a>.            </p></li><li class="list__item" id="f247bac3"><p>                In the right panel, click <span class="control">Run</span>.            </p></li><li class="list__item" id="bf146b90"><p>                    Take snapshots. For more details on how to control profiling session, refer to                                        <a href="Controlling_Profiling_Process.html"><span>Controlling Profiling Session</span></a>                    (if you control profiling manually) or to                                        <a href="Controlling_Profiling_Process_Through_API.html"><span>Controlling Profiling Session Through API</span></a>                    (if you control profiling using the API).                </p></li><li class="list__item" id="d7f2232f"><p>                    After you collect the snapshot(s), click <span class="control">Detach</span> on the                    <span class="control">Controller</span>                    window to detach the profiler from the application pool.                </p></li><li class="list__item" id="84ea0a4e"><p>                    <a href="Analyzing_Results.html">Analyze the collected snapshots</a>.                </p></li></ol></section>        <figure id="604eb83e" width="700" height="435"><img class="js-gif" src="/help/img/dotnet/2018.3/remote-profiling.png" data-gif-src="/help/img/dotnet/2018.3/remote-profiling.animated.gif" width="700" style="width:700px;"></figure>    </div>    <div class="chapter"><h2 id="profiling-via-console-tools">Profiling via console tools</h2>        <figure><img alt="how to app server console" title="how to app server console" src="/help/img/dotnet/2018.3/how_to_app_server_console.png" id="8bd633da" width="620" height="356"></figure>        <p id="3c60bcb5">            Console tools are the best if you need to automate profiling: e.g., you should profile your web app from            time to time. Another possible scenario is when you don’t have access to the server but some other person            does, so you can simply provide him/her with profiling tools and a batch file.        </p>        <p id="223def65">            How does it work? In short, you copy console tools to the server and either run the app under profiling (the            app pool will be restarted) or attach the tool to the running application pool (<span class="filepath">w3wp.exe</span>).                            Then you can get snapshots by simply sending special commands to stdin.                    </p>                <section class="procedure-steps"><h2 id="00bd2425">To profile a web app on an IIS server using console tools</h2><ol class="list _decimal"><li class="list__item" id="b4bc5af6"><p>                Download the                <a href="/dotmemory/download/#section=command-line-profiler" data-external="true" target="_blank" rel="noopener noreferrer"><span>zip archive</span></a>                with the <span class="filepath">ConsoleProfiler.exe</span> tool and copy/unpack it to the server.            </p></li><li class="list__item" id="8c6e9045">                Now, you have two options for getting a memory snapshot::                <ul class="list _roman-lower"><li class="list__item" id="8151d151"><p>                        Attach <span class="filepath">dotMemory.exe</span> to the running application pool and instantly get a snapshot:                        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">dotMemory.exe get-snapshot <span class="m">1234</span> --save-to-dir<span class="o">=</span>C:<span class="se">\S</span>napshots</code></div>                        where <code class="code" data-lang="Java">1234</code> is the process ID of the corresponding <span class="filepath">w3wp.exe</span> process                    </p></li><li class="list__item" id="0c1b1f2b">                        Run the application pool under profiling (if the pool is already running, it will be restarted):                        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">dotMemory.exe start-iis --trigger-timer<span class="o">=</span>30s --open-url<span class="o">=</span>localhost/myapp --use-browser<span class="o">=</span>Chrome</code></div>                        where <code class="code" data-lang="Java">--open-url=localhost/myapp</code> is the URL of your application.                        In case you've chosen to run the app pool, you cannot instantly get a snapshot. Instead, you                        should:                        <ul class="list _ul"><li class="list__item" id="120d14ee"><p>                                get a snapshot by condition: e.g. when                                <code class="code" data-lang="Java">--trigger-timer=30s</code>                                is specified, snapshots are taken each 30 s                            </p></li><li class="list__item" id="23150a7d"><p>                                get a snapshot by sending a command to stdin:                                <code class="code" data-lang="Java">##dotMemory["get-snapshot"]</code>                            </p></li><li class="list__item" id="677fac7f"><p>                                get a snapshot on process exit (e.g. <span class="control">Recycle</span> app pool in the IIS                                Manager)                            </p></li></ul>                    </li></ul>                For more details on how to work with the dotMemory console profiler, please refer to <a href="Working_with_dotMemory_Command-Line_Profiler.html"><span>Using dotMemory Command-Line Profiler</span></a>.            </li><li class="list__item" id="f9c1dccf"><p>                Copy the resulting snapshot to the computer with installed dotMemory and                <a href="Analyzing_Results.html">analyze the snapshot</a>.            </p></li></ol></section>    </div>    <div class="chapter"><h2 id="memory-dumps">Memory dumps</h2>        <figure><img alt="how to app server dumps" title="how to app server dumps" src="/help/img/dotnet/2018.3/how_to_app_server_dumps.png" id="6ae1f7a1" width="616" height="357"></figure>        <p id="2611d6de">            What if, for some reason, copying and running third-party tools on the server is not possible at all. Well,            then your last resort is memory dumps. It can be taken with a number of tools, with the two most popular            being Task Manager (comes with the operating system) and Process Explorer.        </p>        <section class="procedure-steps"><h2 id="e98eabed">To profile a web app on an IIS server using memory dumps</h2><ol class="list _decimal"><li class="list__item" id="6b67ba74"><p>                On the server, take a memory dump using the Task Manager or Process Explorer tool.                When creating a dump of a 32-bit application with Task Manager, make sure you use a 32-bit version of                the tool that can be found in <span class="filepath">C:\Windows\SysWOW64\taskmgr.exe</span>.                <figure><img alt="get memory dump" title="get memory dump" src="/help/img/dotnet/2018.3/get_memory_dump.png" id="9284300d" width="457" height="536"></figure>            </p></li><li class="list__item" id="5acfbc02"><p>                Copy the resulting snapshot to the computer with installed dotMemory and open                it using the <span class="control">Import Dump</span> command.            </p></li><li class="list__item" id="e5da4e4e"><p>                <a href="Analyzing_Results.html">Analyze the snapshot</a>.            </p></li></ol></section>        <figure id="938ead4e" width="600" height="411"><img class="js-gif" src="/help/img/dotnet/2018.3/dumps.png" data-gif-src="/help/img/dotnet/2018.3/dumps.animated.gif" width="600" style="width:600px;"></figure>    </div><div class="last-modified" data-skip-index="skip">Last modified: 15 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Profile_Web_Application_on_IIS_Express.html">Profile Web Application in IIS Express</a><a class="navigation-links__next" href="Profile_.NET_Core_Application.html">Profile .NET Core Application</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>