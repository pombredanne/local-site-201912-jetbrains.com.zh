<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta content="&#xA;        Adding code quality metrics to your TeamCity build and failing builds based on code issues.&#xA;    " name="description" data-skip-index="skip"><title>Detect code issues in a build using ReSharper and TeamCity - Help | ReSharper</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity" data-article-props="&#xA;                {&#xA;                &#xA;            &#34;seeAlso&#34;:[&#xA;            &#xA;                {&#34;title&#34;: &#34;Concepts&#34;,&#xA;                 &#34;links&#34;: [&#xA;                &#xA;        {&#34;url&#34;:&#34;Finding_Code_Issues.html&#34;,&#34;text&#34;:&#34;Find Code Issues with Code Inspection&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;InspectCode.html&#34;,&#34;text&#34;:&#34;InspectCode Command-Line Tool&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;dupFinder.html&#34;,&#34;text&#34;:&#34;dupFinder Command-Line Tool&#34;}&#xA;    &#xA;                    ]}&#xA;            ]&#xA;        &#xA;                }&#xA;            " data-disqus-id="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity_10"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>ReSharper 2019.2 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity" id="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity.xml">Detect code issues in a build using ReSharper and TeamCity</h1>            <p id="e05b2827">        Did you know that you can run ReSharper's        <a href="Code_Analysis__Code_Inspections.html">code inspections</a>        for your builds on a        <a href="http://www.jetbrains.com/teamcity" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity</a>        server?        In fact, we added support for this functionality in TeamCity a long time ago but it seems that the feature        is not widely known, especially by ReSharper users.        The setup itself is extremely simple, and we’re going to walk through it,        and additionally add some more goodies in the mix.    </p>    <p id="602e6d8a">        To get started with TeamCity, learn        <a href="https://confluence.jetbrains.com/display/TCDL/Getting+Started+with+TeamCity" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity documentation</a>.    </p>    <aside data-type="tip" class="prompt" data-title="" rel="602e6d8a" id="31da480e">        <p id="b99d576d">            Under the hood, TeamCity uses            <a href="InspectCode.html">InspectCode</a>            for code inspection and            <a href="dupFinder.html">dupFinder</a>            for duplicate analysis.            If necessary, you can use these free command-line tools on any CI or build server.        </p>    </aside>    <div class="chapter"><h2 id="activating-net-inspections-in-teamcity" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#activating-net-inspections-in-teamcity">Activating .NET Inspections in TeamCity</h2>        <p id="590684e4">            Adding ReSharper inspections to the build process is merely adding the build step named            <span class="control">Inspections (.NET)</span>.            The only parameter required is the Visual Studio Solution file        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity.png" id="c39626a3" width="669" height="702"></figure>        <p id="d601f769">            If we do not specify a            <span class="control">Custom settings profile path</span>,            TeamCity takes the default settings for code inspections.            However, we can configure these to match our own/teams' criteria. This is done on the            <span data-skip-index="skip" class="menupath">Code Inspection | Inspection Severity</span>            page of ReSharper options.            We can change the            <a href="Code_Analysis__Code_Inspections.html#severity">severity</a>            of any inspection,            for instance, that of using            <code class="code">String.IsNullOrEmpty</code>:        </p>        <figure><img alt="Changing inspection severity" title="Changing inspection severity" src="/help/img/dotnet/2019.2/cookbook_teamcity1.png" id="328f164a" width="780" height="600"></figure>        <p id="61e732f6">            ...and save the settings to the            <a href="Sharing_Configuration_Options.html#layers">Solution Team-shared layer</a>.            This then saves the settings in a file named            <span class="filepath">{Solution}.sln.DotSettings</span>,            which is normally checked in to source control so that it automatically applies to            other team members when the solution is opened in Visual Studio.            We can use this same settings file to indicate custom inspection settings for TeamCity:        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity2.png" id="cdd432e9" width="629" height="104"></figure>    </div>    <div class="chapter"><h2 id="analyzing-results" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#analyzing-results">Analyzing Results</h2>        <p id="e7be486e">            When the build step runs, TeamCity generates a navigable report for us to analyze inspection results        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity3.png" id="77abe30c" width="695" height="633"></figure>        <aside data-type="note" class="prompt" data-title="" rel="77abe30c" id="dd7a33e4">            <p id="42d6fe1a">                The checkbox                <span class="control">Inspections with new problems only</span>                is used to highlight only new issues since the last build run.                The numbers in bracket                <span class="control">(+1 -1)</span>                are the variance since the last run.            </p>        </aside>        <p id="edff2750">            We can navigate through the inspections for the entire project or a specific namespace.            Inspections are grouped by            <a href="Code_Analysis__Code_Inspections.html#categories">Category</a>,            Issue Type and the corresponding files on the right pane.            We can even navigate to the actual file by clicking on the line number.            For this though, we need to have Visual Studio running with the            <a href="http://www.jetbrains.com/resharperplatform/help?Keyword=TeamCity_Getting_Started" data-external="true" target="_blank" rel="noopener noreferrer">TeamCity Add-in for Visual Studio</a>            installed            (if you do not, clicking on the link will prompt you with a dialog to download and install the add-in).        </p>    </div>    <div class="chapter"><h2 id="taking-action-based-on-inspection-severity" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#taking-action-based-on-inspection-severity">Taking Action Based on Inspection Severity</h2>        <p id="580c94f2">            One of the main benefits of adding inspections on the server-side is to put some level of code quality in            place, whereby we can have the build process take action based on a series of conditions.            For instance, we might like to have a build fail if too many warnings or errors are detected.        </p>        <p id="3b47d313">            Under            <span class="control">Build Failure Conditions</span>            in the            <span class="control">Project Configuration</span>            window, we can add a new            <span class="control">Build Failure</span>            condition:        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity4.png" id="c8779ae3" width="444" height="293"></figure>        <p id="489f73e7">            We select            <span class="control">Fail build on metric change</span>            and then indicate whether we want a build to fail            based on warnings or errors.            In our case, we’re going to select errors and have it fail if there is more than one.        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity5.png" id="fb187330" width="612" height="260"></figure>        <p id="70bf01bc">            It should be apparent that if we want inspections to have an impact on the status of our build, that is,            have a build fail, we can only do so based on Warnings or Errors.            Therefore, Hints and Suggestions cannot be used.            As such, when configuring inspections severity in ReSharper, we should take this into account.        </p>        <p id="5e86889e">            If we now run our build again, it should fail as the number of errors are greater than one.            Below is the output of the same input and inspections,            but one run with the Build failure condition and the other without it.        </p>        <figure><img alt="ReSharper code analysis on TeamCity" title="ReSharper code analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity6.png" id="d1e13971" width="649" height="54"></figure>    </div>    <div class="chapter"><h2 id="checking-for-copy-paste-code" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#checking-for-copy-paste-code">Checking for Copy/Paste Code</h2>        <p id="d41267d5">            Although strictly speaking, this isn’t related to ReSharper features,            but since we’re talking about code quality in the build process,            it makes sense to also mention that TeamCity can check for code duplication.        </p>        <p id="692ee37d">            Much like before, activating code duplication is a matter of adding a new build step, namely            <span class="control">Duplicates finder (.NET)</span>.            We can indicate the folders to ignore, whether we want to take into account namespaces, type names,            as well as a few other options.        </p>        <figure><img alt="Duplicate analysis on TeamCity" title="Duplicate analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity7.png" id="95c60280" width="716" height="702"></figure>        <p id="edd9c47b">            The output is a nicely formatted navigable screen,            which allows us to go through the different files and see a side-by-side comparison            of what TeamCity has detected as duplication (resized below for space limitations):        </p>        <figure><img alt="Duplicate analysis on TeamCity" title="Duplicate analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity8.png" id="cc99d94e" width="968" height="524"></figure>        <p id="baf37424">            And as expected, we can also fail the build if we have too many code duplicates        </p>        <figure><img alt="Duplicate analysis on TeamCity" title="Duplicate analysis on TeamCity" src="/help/img/dotnet/2019.2/cookbook_teamcity9.png" id="1e30435f" width="613" height="261"></figure>    </div>    <div class="chapter"><h2 id="summary" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#summary">Summary</h2>        <p id="41772a05">            With JetBrains tools, it is refreshingly simple to add code quality detection features to the build process            and have a build fail if something that should not be in production code slips through.        </p>    </div>    <div class="last-modified" data-skip-index="skip">Last modified: 18 November 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Deal_with_a_lot_of_entries_in_resource_files.html">Deal with a lot of entries in resource files</a><a class="navigation-links__next" href="Detect_possible_NullReferenceExceptions.html">Detect possible NullReferenceExceptions</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>