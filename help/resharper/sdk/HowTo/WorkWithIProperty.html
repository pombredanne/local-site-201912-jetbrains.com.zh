<html lang="en-US" ><head>
    <meta charset="UTF-8">
    <title>使用IProperty / ReSharper DevGuide</title>
    <link rel="stylesheet" href="/help/resharper/sdk/app/app.css">
    <link rel="shortcut icon" href="/help/resharper/sdk/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-57x57.png" sizes="57x57">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-60x60.png" sizes="60x60">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-72x72.png" sizes="72x72">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-114x114.png" sizes="114x114">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-120x120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-152x152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="mask-icon" href="/help/resharper/sdk/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/help/resharper/sdk/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/help/resharper/sdk/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/help/resharper/sdk/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/help/resharper/sdk/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/help/resharper/sdk/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.jetbrains.com/help/resharper/sdk//HowTo/WorkWithIProperty.html">
    <meta property="og:site_name" content="JetBrains ReSharper">
    <meta property="og:title" content="Work with IProperty">
    <meta property="og:description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta property="article:modified_time" content="2017-07-12T17:14:56+00:00">
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@JBPlatform">
    <meta name="twitter:title" content="Work with IProperty">
    <meta name="twitter:description" content="Documentation for writing extensions for ReSharper">
    <meta name="twitter:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta class="swiftype" name="product" data-type="string" content="/help/resharper/sdk/">
<link rel="stylesheet" href="/help/resharper/sdk/app/styles.css"></head>
<body  data-id="HowTo/WorkWithIProperty">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label class="search-box__label" for="search-box__input">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="搜索ReSharper DevGuide">
                    </label>
                    <div class="search-box__clear" title="明确"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="//youtrack.jetbrains.com/issues/IJSDK" data-bypass="true">发送反馈</a></p>
                <p>©2000–2018 <a href="//www.jetbrains.com">JetBrains</a> sro<br>版权所有。</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper开发指南</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/HowTo/WorkWithSignals.html">使用信号</a> <a class="navigation-links__next" href="/HowTo/NavigateCode/NavigateCode.html">导航代码</a>
                    </div>
                    <a href="https://github.com/JetBrains/resharper-devguide/edit/master/HowTo/WorkWithIProperty.md" class="page-link-to-github" rel="noopener noreferrer" title="在GitHub上编辑此页面" data-bypass="true" target="_blank">
                        <i class="github-icon"></i> <span class="text">编辑页面</span>
                    </a>

                    <h1>与IProperty合作</h1>
                    <p><strong>您应该事先知道：</strong></p>
<ul>
  <li><a href="/help/resharper/sdk/HowTo/WorkWithLifetime.html"><span>一生</span></a></li>
  <li><a href="/help/resharper/sdk/HowTo/WorkWithSignals.html"><span>讯号</span></a></li>
</ul>

<p><code class="code highlight language-text">IProperty</code>是另一个概念，在整个ReSharper API中都经常使用。简单地说， <code class="code highlight language-text">IProperty</code>对象能够跟踪更改，验证分配的新值并通知更改。 <code class="code highlight language-text">IProperty</code>与<a href="WorkWithSignals.html"><span>信号</span></a>有许多共同点。</p>

<a name="basic-usage" class="elem-anchor"></a>
<h2>基本用法<a href="#basic-usage" class="anchor-link"><span></span></a></h2>
<p><strong>范例（ <a href="HowTo.html#sample-solution"><span>？</span></a> ）：</strong></p>
<ul>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/IProperty/PropertyProvider.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>PropertyProvider.cs</span></a></li>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/IProperty/PropertyTester.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>PropertyTester.cs</span></a></li>
</ul>

<p>例如， <code class="code highlight language-text">SomeIntProperty</code>的参数<code class="code highlight language-text">PropertyProvider</code>上课对工作很重要<code class="code highlight language-text">PropertyTester</code> 。参数更新后， <code class="code highlight language-text">PropertyTester</code>收到有关新值的通知：</p>

<div class="code-block" data-lang="text"><code class="code-block__wrapper">public class PropertyProvider { public IProperty<int> SomeIntProperty; public PropertyProvider(Lifetime lifetime) { SomeIntProperty = new Property<int>(lifetime, "PropertyProvider.SomeIntProperty"); } } public class PropertyTester { private readonly PropertyProvider _propertyProvider; public PropertyTester(Lifetime lifetime, PropertyProvider propertyProvider) { _propertyProvider = propertyProvider; _propertyProvider.SomeIntProperty.BeforeChange.Advise(lifetime, args => { if (args.New < 0) args.Cancel = true; }); _propertyProvider.SomeIntProperty.Change.Advise(lifetime, val => MessageBox.ShowInfo($"New property value is {val}")); } public void ChangePropertyValue(int value) { _propertyProvider.SomeIntProperty.Value = value; } }</code></div>

<a name="notes" class="elem-anchor"></a>
<h3>笔记<a href="#notes" class="anchor-link"><span></span></a></h3>
<ul>
  <li>与几乎所有其他ReSharper API组件一样， <code class="code highlight language-text">IProperty</code>实例具有生命周期，这意味着ReSharper负责对象的处置。</li>
  <li>当生存期终止时，将强制分离属性事件的所有处理程序，以防止内存泄漏。</li>
  <li><code class="code highlight language-text">BeforeChange</code>是在值更改之前触发的信号。您可以通过以下方式取消更改<code class="code highlight language-text">Cancel = true</code>在信号参数中。这些参数还存储新旧属性值。</li>
  <li><code class="code highlight language-text">Change</code>是在价值变化时触发的<a href="WorkWithSignals.html"><span>信号</span></a> 。使用它来跟踪更改。此外，还有多种其他方法可以跟踪更改，例如，<ul>
      <li><code class="code highlight language-text">ForEachNewValue</code> -每次分配新值时都会调用处理程序</li>
      <li><code class="code highlight language-text">When</code> -当值等于期望值时将调用处理程序</li>
    </ul>
  </li>
  <li>要更改值，请使用<code class="code highlight language-text">Value</code>属性。</li>
</ul>

<a name="global-options" class="elem-anchor"></a>
<h2>全局选项<a href="#global-options" class="anchor-link"><span></span></a></h2>
<p><strong>范例（ <a href="HowTo.html#sample-solution"><span>？</span></a> ）：</strong></p>
<ul>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/Options/Ui/OptionsPageViewModel.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>OptionsPageViewModel.cs</span></a></li>
</ul>

<p>一个更明显的例子<code class="code highlight language-text">IProperty</code>可以使用的是全局选项：用户在“ <strong>选项”</strong>页面上更改<strong>选项后</strong> ，插件会立即收到有关更改的通知。</p>

<div class="code-block" data-lang="text"><code class="code-block__wrapper">Text = new Property<string>(lifetime, "OptionsExampleViewModel.Text"); var checkMeOption = settingsStore.BindToContextLive(lifetime, ContextRange.ApplicationWide) .GetValueProperty(lifetime, (MySettingsKey key) => key.CheckMe); checkMeOption.Change.Advise_HasNew(lifetime, v => { Text.Value = v.New ? "checked" : "not checked"; });</code></div>

<a name="notes-1" class="elem-anchor"></a>
<h3>笔记<a href="#notes-1" class="anchor-link"><span></span></a></h3>
<ul>
  <li><code class="code highlight language-text">checkMeOption</code>是财产（ <code class="code highlight language-text">IProperty</code> ）代表<code class="code highlight language-text">CheckMe</code> <strong>选项</strong>页面上的设置。</li>
  <li>取决于<code class="code highlight language-text">CheckMe</code>设定状态<code class="code highlight language-text">Text</code>属性是“选中”还是“未选中”。</li>
  <li>的<code class="code highlight language-text">Text</code>属性通过更新<code class="code highlight language-text">Advise_HasNew</code>用来显示<code class="code highlight language-text">CheckMe</code>在WPF控件上设置状态（请参阅下一节）。</li>
</ul>

<a name="wpf-data-binding" class="elem-anchor"></a>
<h2>WPF数据绑定<a href="#wpf-data-binding" class="anchor-link"><span></span></a></h2>
<p><strong>范例（ <a href="HowTo.html#sample-solution"><span>？</span></a> ）：</strong></p>
<ul>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/Options/Ui/OptionsPageViewModel.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>OptionsPageViewModel.cs</span></a></li>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/Options/Ui/OptionsPageView.xaml" rel="noopener noreferrer" data-external="true" target="_blank"><span>OptionsPageView.xaml</span></a></li>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/Options/Ui/OptionsPageView.xaml.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>OptionsPageView.xaml.cs</span></a></li>
</ul>

<p><code class="code highlight language-text">IProperty</code>贯彻<code class="code highlight language-text">INotifyPropertyChanged</code>开箱即用，因此，它能够参与WPF数据绑定。例如，我们可以显示<code class="code highlight language-text">IProperty</code>在WPF控件上。让我们根据上一节中的示例了解如何执行此操作。假设我们要显示<code class="code highlight language-text">CheckMe</code>设置（位于<strong>ReSharper |选项...中</strong> ）。视图模型如下所示：</p>

<div class="code-block" data-lang="text"><code class="code-block__wrapper">public class OptionsPageViewModel: AAutomation { public IProperty<string> Text { get; set; } public OptionsPageViewModel(Lifetime lifetime, ISettingsStore settingsStore) { Text = new Property<string>(lifetime, "OptionsExampleViewModel.Text"); var checkMeOption = settingsStore.BindToContextLive(lifetime, ContextRange.ApplicationWide) .GetValueProperty(lifetime, (MySettingsKey key) => key.CheckMe); checkMeOption.Change.Advise_HasNew(lifetime, v => { Text.Value = v.New ? "checked" : "not checked"; }); } }</code></div>
<p>视图后面的代码如下所示：</p>
<div class="code-block" data-lang="text"><code class="code-block__wrapper">[View] public partial class OptionsPageView : IView<OptionsPageViewModel> { public new string Name => "Options"; public OptionsPageView() { InitializeComponent(); } }</code></div>
<p>该视图的XAML：</p>
<div class="code-block" data-lang="text"><code class="code-block__wrapper"><UserControl x:Class="SampleReSharperPlugin.OptionsPageView" ... xmlns:viewModels="clr-namespace:SampleReSharperPlugin" d:DataContext="{d:DesignInstance Type={x:Type viewModels:OptionsPageViewModel}, IsDesignTimeCreatable=False}"> <Grid> <StackPanel> <TextBlock HorizontalAlignment="Left" TextWrapping="Wrap" VerticalAlignment="Top" Margin="10,10,5,0"> The option in <Bold>ReShaper > Options... > Tools > Sample R# Plugin > Sample bool option</Bold> is: <InlineUIContainer> <TextBlock TextWrapping="Wrap" Text="{Binding Text.Value}" FontWeight="Bold" /> </InlineUIContainer> </TextBlock> </StackPanel> </Grid> </UserControl></code></div>

<p>创建视图和视图模型时，不要忘记指定数据上下文：</p>
<div class="code-block" data-lang="text"><code class="code-block__wrapper">var propViewModel = new PropertyViewModel(lifetime); var propView = new PropertyView { DataContext = propViewModel };</code></div>

<a name="notes-2" class="elem-anchor"></a>
<h3>笔记<a href="#notes-2" class="anchor-link"><span></span></a></h3>
<ul>
  <li>ReSharper提供了自己的一组类，这些类用于简化WPF MVVM模式的实现：<ul>
      <li><code class="code highlight language-text">AAutomation</code>提供基本的实现<code class="code highlight language-text">INotifyPropertyChanged</code>界面，可用于创建视图模型。</li>
      <li>视图类应标记为<code class="code highlight language-text">View</code>属性并实施<code class="code highlight language-text">IView</code>接口。</li>
    </ul>
  </li>
</ul>

<a name="data-flow-between-properties" class="elem-anchor"></a>
<h2>属性之间的数据流<a href="#data-flow-between-properties" class="anchor-link"><span></span></a></h2>
<p><strong>范例（ <a href="HowTo.html#sample-solution"><span>？</span></a> ）：</strong></p>
<ul>
  <li><a href="https://github.com/JetBrains/sample-resharper-plugin/blob/master/SampleReSharperPlugin/src/IProperty/PropertyFlow.cs" rel="noopener noreferrer" data-external="true" target="_blank"><span>PropertyFlow.cs</span></a></li>
</ul>

<p>您可以组织两个属性之间的数据流。这些属性可以是相同类型或不同类型。在后一种情况下，您应该编写一个类型转换器。例如，我们有两个字符串属性：第一个提供一些字符串；第二个采用此字符串并将其应用于标题大写：</p>
<div class="code-block" data-lang="text"><code class="code-block__wrapper">public class PropertyFlow { public IProperty<string> SourceProperty { get; set; } public IProperty<string> TargetProperty { get; set; } public PropertyFlow(Lifetime lifetime) { SourceProperty = new Property<string>(lifetime, "sourceProperty"); TargetProperty = new Property<string>(lifetime, "targetProperty"); SourceProperty.FlowChangesInto(lifetime, TargetProperty, s => { if (string.IsNullOrEmpty(s)) return ""; var textInfo = new CultureInfo("en-US", false).TextInfo; s = textInfo.ToTitleCase(s); return s; }); } }</code></div>

<a name="color-themes" class="elem-anchor"></a>
<h2>颜色主题<a href="#color-themes" class="anchor-link"><span></span></a></h2>
<p>负责处理颜色主题的类广泛使用<code class="code highlight language-text">IProperty</code> 。有关更多详细信息，请参阅<a href="/help/resharper/sdk/HowTo/WorkWithColorThemes.html"><span>使用颜色主题</span></a> 。</p>


                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/HowTo/WorkWithSignals.html">使用信号</a> <a class="navigation-links__next" href="/HowTo/NavigateCode/NavigateCode.html">导航代码</a>
                    </div>
                    <div class="last-modified">上次修改时间：2017年7月12日</div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/help/resharper/sdk/app/app.js" data-baseurl="/help/resharper/sdk/"></script>




</body></html>