<html lang="en-US" ><head>
    <meta charset="UTF-8">
    <title>选项页/ ReSharper DevGuide</title>
    <link rel="stylesheet" href="/help/resharper/sdk/app/app.css">
    <link rel="shortcut icon" href="/help/resharper/sdk/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-57x57.png" sizes="57x57">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-60x60.png" sizes="60x60">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-72x72.png" sizes="72x72">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-114x114.png" sizes="114x114">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-120x120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-152x152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="mask-icon" href="/help/resharper/sdk/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/help/resharper/sdk/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/help/resharper/sdk/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/help/resharper/sdk/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/help/resharper/sdk/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/help/resharper/sdk/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.jetbrains.com/help/resharper/sdk//Features/OptionsPages.html">
    <meta property="og:site_name" content="JetBrains ReSharper">
    <meta property="og:title" content="Options Pages">
    <meta property="og:description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta property="article:modified_time" content="2017-07-10T19:28:42+00:00">
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@JBPlatform">
    <meta name="twitter:title" content="Options Pages">
    <meta name="twitter:description" content="Documentation for writing extensions for ReSharper">
    <meta name="twitter:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta class="swiftype" name="product" data-type="string" content="/help/resharper/sdk/">
<link rel="stylesheet" href="/help/resharper/sdk/app/styles.css"></head>
<body  data-id="Features/OptionsPages">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label class="search-box__label" for="search-box__input">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="搜索ReSharper DevGuide">
                    </label>
                    <div class="search-box__clear" title="明确"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="//youtrack.jetbrains.com/issues/IJSDK" data-bypass="true">发送反馈</a></p>
                <p>©2000–2018 <a href="//www.jetbrains.com">JetBrains</a> sro<br>版权所有。</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper开发指南</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Features/Navigation.html">导航</a> <a class="navigation-links__next" href="/Features/LiveTemplates.html">实时模板</a>
                    </div>
                    <a href="https://github.com/JetBrains/resharper-devguide/edit/master/Features/OptionsPages.md" class="page-link-to-github" rel="noopener noreferrer" title="在GitHub上编辑此页面" data-bypass="true" target="_blank">
                        <i class="github-icon"></i> <span class="text">编辑页面</span>
                    </a>

                    <h1>选项页</h1>
                    <aside class="warning">
  <p>本主题与ReSharper 8有关，尚未更新为ReSharper 9或ReSharper Platform。</p>
</aside>

<p>选项页面允许插件开发人员将控件添加到“ ReSharper选项”对话框。这通常用于让用户指定各种插件设置。插件编写器可以向对话框添加无限数量的选项页面，并且对话框可以嵌套在任何选项组中。</p>

<p>现在让我们讨论选项页的定义方式。</p>

<a name="making-an-options-page" class="elem-anchor"></a>
<h2>制作选项页<a href="#making-an-options-page" class="anchor-link"><span></span></a></h2>

<p>制作选项页面非常容易。首先定义一个将容纳选项页面的类。这个类应该被实现<code class="code highlight language-text">IOptionsPage</code> ，并应使用<code class="code highlight language-text">OptionsPage</code>属性。</p>

<p>的<code class="code highlight language-text">OptionsPage</code>属性要求插件作者提供以下参数：</p>

<ul>
  <li>页面ID。可以将该ID指定为类内的常量字段。页面ID是一个字符串，用于唯一标识此特定选项页面。</li>
  <li>页面的名称。这是文本，将显示在“选项”页面的左侧树以及标题和导航元素中。</li>
  <li>图片。这是指出现在树中项目旁边的字形，并指定为一种类型（例如， <code class="code highlight language-text">typeof(OptionsPageThemedIcons.SamplePage)</code> ）。有关更多信息，请参见<a href="/help/resharper/sdk/Platform/Shell/Icons.html"><span>图标</span></a> 。</li>
</ul>

<p>此外，您可以指定以下可选参数：</p>

<ul>
  <li><code class="code highlight language-text">ParentId</code>可让您定义用作此页面父级的部分或元素的ID。如果您希望父母成为已知的ReSharper物品之一，请查看<code class="code highlight language-text">JetBrains.UI.Options.OptionsPages</code>对应页面的名称空间，然后使用它们的<code class="code highlight language-text">Pid</code>作为此参数。例如，要使选项页显示在“环境”部分中，请指定<code class="code highlight language-text">ParentId</code>的<code class="code highlight language-text">EnvironmentPage.Pid</code> 。</li>
  <li><code class="code highlight language-text">Sequence</code>可让您定义要插入的项目相对于其他项目的位置。项目按顺序放置，因此此值越高，此页面在项目列表中的位置就越远。当然，要准确定位商品，您需要了解<code class="code highlight language-text">Sequence</code>其兄弟姐妹的价值。幸运的是，该信息在元数据中可用。</li>
</ul>

<p>指定属性后，您的类将显示如下：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="na">[OptionsPage(PID, "Sample Page", typeof(OptionsPageThemedIcons.SamplePage), ParentId = ToolsPage.PID)]</span> <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">SampleOptionPage</span> <span class="p">:</span> <span class="n">IOptionsPage</span> <span class="p">{</span> <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PID</span> <span class="p">=</span> <span class="s">"SamplePageId"</span><span class="p">;</span> <span class="p">}</span></code></div>

<a name="injecting-dependencies" class="elem-anchor"></a>
<h2>注入依赖<a href="#injecting-dependencies" class="anchor-link"><span></span></a></h2>

<p>选项页面由组件模型创建，这意味着您可以通过构造函数参数注入依赖项。您的构造函数至少应采用以下两个参数：</p>

<ul>
  <li><code class="code highlight language-text">Lifetime</code> ，它控制此页面的生命周期。</li>
  <li><code class="code highlight language-text">OptionsSettingsSmartContext</code> ，您可以用来绑定UI元素的设置上下文。</li>
</ul>

<p>这两个值都需要注入，因为它们是将特定设置绑定到UI元素所必需的。如果您继承自<code class="code highlight language-text">AOptionsPage</code> ，您还需要注入<code class="code highlight language-text">IUIApplication</code>传递给基类构造函数。</p>

<p>除了这些值之外，您还可以将任何其他可用组件注入服务。请注意，如果您实施<code class="code highlight language-text">IOptionsPage</code>在用户控件上，应确保将生成的默认构造函数替换为希望组件模型为其注入依赖关系的构造函数。</p>

<a name="defining-the-ui" class="elem-anchor"></a>
<h2>定义UI<a href="#defining-the-ui" class="anchor-link"><span></span></a></h2>

<p>您可以使用Windows窗体或WPF为选项页面定义UI。无论您选择哪个选项，实际上要呈现UI所要做的就是对其进行初始化并将其分配给选项页的<code class="code highlight language-text">Control</code>变量。</p>

<aside class="note">
  <p>无论选择哪种UI框架，您的应用程序都<em>必须</em>引用WPF程序集。如果您开始使用<code class="code highlight language-text">EitherControl</code>类型而不添加适当的引用。</p>
</aside>

<p>要使用Windows窗体创建选项页，只需创建一个<code class="code highlight language-text">UserControl</code>并将其分配给<code class="code highlight language-text">Control</code>属性。请注意，由于多重继承是不可能的，因此保留选项页类和<code class="code highlight language-text">UserControl</code>一类和以下相同：</p>

<ul>
  <li>继承自<code class="code highlight language-text">UserControl</code>并实施<code class="code highlight language-text">IOptionsPage</code>接口。</li>
  <li>用<code class="code highlight language-text">OptionsPage</code>如上所述的属性。</li>
  <li>实现只读属性<code class="code highlight language-text">Control</code> ，返回的值<code class="code highlight language-text">this</code> 。</li>
</ul>

<p>要使用WPF创建选项页面，只需按照WPF元素定义用户界面，然后分配<code class="code highlight language-text">Control</code>属性。您可以指定任何WPF控件，例如<code class="code highlight language-text">Grid</code> ，作为页面控件。</p>

<p>不用说，完全有可能使用<code class="code highlight language-text">WindowsFormsHost</code>类以在WPF选项页上托管Windows窗体控件。将控件绑定到设置的机制适用于WPF和Windows窗体。（当然，如果您实施<code class="code highlight language-text">IOptionsPage</code>手动，您可以简单地手动分配属性，而根本不使用绑定。）</p>

<a name="working-with-settings" class="elem-anchor"></a>
<h2>使用设置<a href="#working-with-settings" class="anchor-link"><span></span></a></h2>

<p>的<code class="code highlight language-text">OptionsSettingsSmartContext</code>我们注入的类有几个<code class="code highlight language-text">SetBinding()</code>让我们将设置和控件联系在一起的方法。这些绑定方法具有两个通用参数-设置类的名称和要保存的属性的类型。对于WPF，您应指定：</p>

<ul>
  <li>退出时分配的属性。定义为lambda表达式（例如， <code class="code highlight language-text">x => x.Name</code> ）。</li>
  <li>从中读取属性的控件的名称。</li>
  <li>正在读取的依赖项属性。</li>
</ul>

<p>例如，这是将用户名的WPF文本框绑定到相应设置的方式：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="n">settings</span><span class="p">.</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">lifetime</span><span class="p">,</span> <span class="p">(</span><span class="n">GitHubSettings</span> <span class="n">s</span><span class="p">)</span> <span class="p">=></span> <span class="n">s</span><span class="p">.</span><span class="n">Username</span><span class="p">,</span> <span class="n">usernameBox</span><span class="p">,</span> <span class="n">TextBox</span><span class="p">.</span><span class="n">TextProperty</span><span class="p">);</span></code></div>

<p>WinForms的情况更加棘手-没有要使用的依赖项属性，因此我们使用<code class="code highlight language-text">WinFormsProperty</code>助手类。该帮助器类只有一个方法， <code class="code highlight language-text">Create()</code> ，创建一个类型的对象<code class="code highlight language-text">IProperty<T></code> （哪里<code class="code highlight language-text">T</code>是属性类型）。要创建属性，它需要以下参数：</p>

<ul>
  <li>的<code class="code highlight language-text">Lifetime</code>调用组件。这应该是显而易见的，因为“代理属性”应仅在需要时才存在。当然，这确实意味着您<em>必须</em>注入<code class="code highlight language-text">Lifetime</code>进入构造函数。</li>
  <li>从中获取数据的类。事实上，尽管在的WinForms，你可能会提供相应的控制的情况下，这并不一定是<em>本身</em>控制-它可以是几乎任何对象。毕竟， <code class="code highlight language-text">WinFormsProperty</code>类不使用任何特定于WinForms的代码。</li>
  <li>一个lambda表达式，指示要使用上述类的哪个属性。</li>
</ul>

<p>因此，将基于WinForms的密码框绑定到设置的调用如下所示：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="kt">var</span> <span class="n">property</span> <span class="p">=</span> <span class="n">WinFormsProperty</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="n">lifetime</span><span class="p">,</span> <span class="n">passwordBox</span><span class="p">,</span> <span class="n">box</span> <span class="p">=></span> <span class="n">box</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span> <span class="n">settings</span><span class="p">.</span><span class="nf">SetBinding</span><span class="p">(</span><span class="n">lifetime</span><span class="p">,</span> <span class="p">(</span><span class="n">GitHubSettings</span> <span class="n">s</span><span class="p">)</span> <span class="p">=></span> <span class="n">s</span><span class="p">.</span><span class="n">Password</span><span class="p">,</span> <span class="n">property</span><span class="p">);</span></code></div>


                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Features/Navigation.html">导航</a> <a class="navigation-links__next" href="/Features/LiveTemplates.html">实时模板</a>
                    </div>
                    <div class="last-modified">上次修改时间：2017年7月10日</div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/help/resharper/sdk/app/app.js" data-baseurl="/help/resharper/sdk/"></script>




</body></html>