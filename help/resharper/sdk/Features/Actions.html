<html lang="en-US" ><head>
    <meta charset="UTF-8">
    <title>操作和菜单项/ ReSharper DevGuide</title>
    <link rel="stylesheet" href="/help/resharper/sdk/app/app.css">
    <link rel="shortcut icon" href="/help/resharper/sdk/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-57x57.png" sizes="57x57">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-60x60.png" sizes="60x60">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-72x72.png" sizes="72x72">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-114x114.png" sizes="114x114">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-120x120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-152x152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="mask-icon" href="/help/resharper/sdk/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/help/resharper/sdk/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/help/resharper/sdk/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/help/resharper/sdk/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/help/resharper/sdk/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/help/resharper/sdk/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.jetbrains.com/help/resharper/sdk//Features/Actions.html">
    <meta property="og:site_name" content="JetBrains ReSharper">
    <meta property="og:title" content="Actions and Menu Items">
    <meta property="og:description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta property="article:modified_time" content="2017-07-10T19:28:42+00:00">
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@JBPlatform">
    <meta name="twitter:title" content="Actions and Menu Items">
    <meta name="twitter:description" content="Documentation for writing extensions for ReSharper">
    <meta name="twitter:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta class="swiftype" name="product" data-type="string" content="/help/resharper/sdk/">
<link rel="stylesheet" href="/help/resharper/sdk/app/styles.css"></head>
<body  data-id="Features/Actions">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label class="search-box__label" for="search-box__input">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="搜索ReSharper DevGuide">
                    </label>
                    <div class="search-box__clear" title="明确"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="//youtrack.jetbrains.com/issues/IJSDK" data-bypass="true">发送反馈</a></p>
                <p>©2000–2018 <a href="//www.jetbrains.com">JetBrains</a> sro<br>版权所有。</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper开发指南</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Features/Analysis.html">分析</a> <a class="navigation-links__next" href="/Features/Completion.html">代码完成</a>
                    </div>
                    <a href="https://github.com/JetBrains/resharper-devguide/edit/master/Features/Actions.md" class="page-link-to-github" rel="noopener noreferrer" title="在GitHub上编辑此页面" data-bypass="true" target="_blank">
                        <i class="github-icon"></i> <span class="text">编辑页面</span>
                    </a>

                    <h1>操作和菜单项</h1>
                    <aside class="warning">
  <p>本主题与ReSharper 8有关，尚未更新为ReSharper 9或ReSharper Platform。</p>
</aside>

<p>虽然ReSharper的大部分内容都与呈现自己的UI类型（弹出窗口，对话框窗口等）有关，但是某些功能可以使用传统的菜单项来实现，而这些菜单项将是Visual Studio插件开发人员所熟悉的。菜单项随后触发一个<em>动作</em> ，即与此菜单项关联的工作单元。</p>

<a name="when-to-create-actions" class="elem-anchor"></a>
<h2>何时创建动作<a href="#when-to-create-actions" class="anchor-link"><span></span></a></h2>

<p>创建Action基本上有两个用例。</p>

<p>第一个用例是当您希望将特定的ReSharper功能（例如Context Action）公开为可以绑定到快捷方式的Visual Studio命令时。相关性取决于功能。</p>

<p>第二个用例是您希望您的操作执行与ReSharper基础结构无关的事情。此类操作的示例包括显示“关于”对话框，打开插件的帮助文件或启动其他过程的操作。</p>

<p>这两个用例都由Action子系统提供。</p>

<a name="making-actions" class="elem-anchor"></a>
<h2>采取行动<a href="#making-actions" class="anchor-link"><span></span></a></h2>

<p>为了将自己的菜单项添加到基础结构中，您需要执行以下操作：</p>

<ul>
  <li>创建一个<code class="code highlight language-text">Actions.xml</code>文件，其中将包含动作定义以及插入动作的位置。</li>
  <li>确保<code class="code highlight language-text">Actions.xml</code>文件作为资源嵌入到程序集中</li>
  <li>确保程序集具有指向上述文件的ActionsXml属性。</li>
  <li>为动作定义动作处理程序。</li>
</ul>

<p>让我们依次看一下这些步骤。</p>

<a name="actionsxml" class="elem-anchor"></a>
<h2>Actions.xml<a href="#actionsxml" class="anchor-link"><span></span></a></h2>

<p><code class="code highlight language-text">Actions.xml</code>是您可以保留在项目中的嵌入式资源。ReSharper能够找到资源，因为<code class="code highlight language-text">ActionsXml</code>装饰部件的属性。例如：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="na">[assembly: ActionsXml("JetBrains.ReSharper.PowerToys.MenuItem.Actions.xml")]</span></code></div>

<aside class="note">
  <p>：ReSharper 8中不再需要此属性。ReSharper将改为在程序集中查找所有嵌入式资源，以查看其名称是否匹配<code class="code highlight language-text">Actions.xml</code></p>
</aside>

<p>XML文件本身非常简单。在根级别，它使用<code class="code highlight language-text">actions</code>元件。其中有几种不同类型的内容。</p>

<p>一种强制性的内容类型是动作元素，它指示相关动作的ID，显示的文本和（可选）图像。该图像可以是例如作为嵌入式资源存储的16x16像素GIF。</p>

<div class="code-block" data-lang="xml"><code class="code-block__wrapper"><span class="nt"><action</span> <span class="na">id=</span><span class="s">"AddMenuItem.ShowCurrentSolution"</span> <span class="na">text=</span><span class="s">"Show Current Solution"</span> <span class="na">image=</span><span class="s">"JetBrains.ReSharper.PowerToys.MenuItem.testImage.gif"</span> <span class="nt">/></span></code></div>

<p>这是定义动作的方式，但是如何将它们插入现有菜单中？这就是insert元素的作用。在此元素中，您可以指定插入项目的组ID，以及插入项目的位置（例如“最后”）。</p>

<p>指定组ID时，可以指定</p>

<ul>
  <li>ReSharper菜单（例如，“ ReSharper。导航”）</li>
  <li>Visual Studio菜单（例如，“ VS＃Solution”）</li>
</ul>

<p>对于Visual Studio，VS＃之后的部分是VS本身的命令栏结构中的路径。您也可以使用菜单CommandID，形式为“ VS＃（GUID：ID）”。</p>

<p>因此，要将分隔符和ShowCurrentLineNumber操作插入VS代码窗口，您将添加以下内容：</p>

<div class="code-block" data-lang="xml"><code class="code-block__wrapper"><span class="nt"><insert</span> <span class="na">group-id=</span><span class="s">"VS#Code Window"</span> <span class="na">position=</span><span class="s">"last"</span><span class="nt">></span> <span class="nt"><separator</span> <span class="nt">/></span> <span class="nt"><action-ref</span> <span class="na">id=</span><span class="s">"AddMenuItem.ShowCurrentLineNumber"</span> <span class="nt">/></span> <span class="nt"></insert></span></code></div>

<a name="action-handlers" class="elem-anchor"></a>
<h2>动作处理器<a href="#action-handlers" class="anchor-link"><span></span></a></h2>

<p>动作处理程序是处理动作的一段代码。这只是一个由<code class="code highlight language-text">IActionHandler</code>接口并实现<code class="code highlight language-text">IActionHandler</code>接口。</p>

<p>现在，您可能想知道-动作处理程序如何绑定到动作？好吧，有两种方法可以做到这一点。一种是命名类文件以匹配该动作，这样<code class="code highlight language-text">AddMenuItem.ShowCurrentSolution</code>匹配的类名<code class="code highlight language-text">AddMenuItem_ShowCurrentSolutionAction</code> 。您可能已经猜到了，下划线会变成点，后缀如<code class="code highlight language-text">Action</code>要么<code class="code highlight language-text">ActionHandler</code>被删除。</p>

<p>关于<code class="code highlight language-text">IActionHandler</code>接口，它要求您实现两种方法。</p>

<p>首先 - <code class="code highlight language-text">Update()</code> -返回一个布尔值，指示菜单项是启用还是禁用。例如，如果您的操作需要解决方案，则可以指定以下Update（）方法：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">Update</span><span class="p">(</span><span class="n">IDataContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">ActionPresentation</span> <span class="n">presentation</span><span class="p">,</span> <span class="n">DelegateUpdate</span> <span class="n">nextUpdate</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// fetch active solution from context</span> <span class="n">ISolution</span> <span class="n">solution</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">GetData</span><span class="p">(</span><span class="n">JetBrains</span><span class="p">.</span><span class="n">ProjectModel</span><span class="p">.</span><span class="n">DataContext</span><span class="p">.</span><span class="n">DataConstants</span><span class="p">.</span><span class="n">SOLUTION</span><span class="p">);</span> <span class="c1">// enable this action if there is an active solution, disable otherwise</span> <span class="k">return</span> <span class="n">solution</span> <span class="p">!=</span> <span class="k">null</span><span class="p">;</span> <span class="p">}</span></code></div>

<p>第二种方法叫做<code class="code highlight language-text">Execute()</code> 。这是实际执行操作的方法。</p>

<a name="redefining-action-handlers" class="elem-anchor"></a>
<h2>重新定义动作处理程序<a href="#redefining-action-handlers" class="anchor-link"><span></span></a></h2>

<p>如果您希望覆盖现有操作，则可以创建一个自定义外壳程序组件，以查找现有操作并为其添加其他处理程序。例如，这是自定义操作处理程序对<code class="code highlight language-text">TypeHierarchy.ClassHierarchy</code>行动：</p>

<div class="code-block" data-lang="csharp"><code class="code-block__wrapper"><span class="na">[ShellComponent]</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">CustomActionHandlerManager</span> <span class="p">{</span> <span class="k">public</span> <span class="nf">CustomActionHandlerManager</span><span class="p">(</span><span class="n">Lifetime</span> <span class="n">lifetime</span><span class="p">,</span> <span class="n">IActionManager</span> <span class="n">actionManager</span><span class="p">)</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">classHierarchy</span> <span class="p">=</span> <span class="n">actionManager</span><span class="p">.</span><span class="nf">GetUpdatableAction</span><span class="p">(</span><span class="s">"TypeHierarchy.ClassHierarchy"</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">classHierarchy</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">classHierarchy</span><span class="p">.</span><span class="nf">AddHandler</span><span class="p">(</span><span class="n">lifetime</span><span class="p">,</span> <span class="k">new</span> <span class="nf">WholeMembersHierarchyActions</span><span class="p">());</span> <span class="p">}</span> <span class="p">}</span></code></div>



                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Features/Analysis.html">分析</a> <a class="navigation-links__next" href="/Features/Completion.html">代码完成</a>
                    </div>
                    <div class="last-modified">上次修改时间：2017年7月10日</div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/help/resharper/sdk/app/app.js" data-baseurl="/help/resharper/sdk/"></script>




</body></html>