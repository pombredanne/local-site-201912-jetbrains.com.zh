<html lang="en-US" ><head>
    <meta charset="UTF-8">
    <title>包装和分销/ ReSharper DevGuide</title>
    <link rel="stylesheet" href="/help/resharper/sdk/app/app.css">
    <link rel="shortcut icon" href="/help/resharper/sdk/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-57x57.png" sizes="57x57">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-60x60.png" sizes="60x60">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-72x72.png" sizes="72x72">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-114x114.png" sizes="114x114">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-120x120.png" sizes="120x120">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-144x144.png" sizes="144x144">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-152x152.png" sizes="152x152">
    <link rel="apple-touch-icon" href="/help/resharper/sdk/apple-touch-icon-180x180.png" sizes="180x180">
    <link rel="mask-icon" href="/help/resharper/sdk/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/help/resharper/sdk/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/help/resharper/sdk/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/help/resharper/sdk/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/help/resharper/sdk/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/help/resharper/sdk/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.jetbrains.com/help/resharper/sdk//Extensions/Packaging8.html">
    <meta property="og:site_name" content="JetBrains ReSharper">
    <meta property="og:title" content="Packaging and Distribution">
    <meta property="og:description" content="Documentation for writing extensions for ReSharper">
    <meta property="og:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta property="article:modified_time" content="2017-07-10T19:28:42+00:00">
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@JBPlatform">
    <meta name="twitter:title" content="Packaging and Distribution">
    <meta name="twitter:description" content="Documentation for writing extensions for ReSharper">
    <meta name="twitter:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png">
    <meta class="swiftype" name="product" data-type="string" content="/help/resharper/sdk/">
<link rel="stylesheet" href="/help/resharper/sdk/app/styles.css"></head>
<body  data-id="Extensions/Packaging8">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label class="search-box__label" for="search-box__input">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="搜索ReSharper DevGuide">
                    </label>
                    <div class="search-box__clear" title="明确"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a href="//youtrack.jetbrains.com/issues/IJSDK" data-bypass="true">发送反馈</a></p>
                <p>©2000–2018 <a href="//www.jetbrains.com">JetBrains</a> sro<br>版权所有。</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper开发指南</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Extensions/Deployment/LocalInstallation.html">本地安装</a>
                        
                    </div>
                    <a href="https://github.com/JetBrains/resharper-devguide/edit/master/Extensions/Packaging8.md" class="page-link-to-github" rel="noopener noreferrer" title="在GitHub上编辑此页面" data-bypass="true" target="_blank">
                        <i class="github-icon"></i> <span class="text">编辑页面</span>
                    </a>

                    <h1>包装与配送</h1>
                    <aside class="warning">
  <p>本主题与ReSharper 8有关，尚未更新为ReSharper 9或ReSharper Platform。</p>
</aside>

<p>编写完插件后，您可能希望将其部署到最终用户。从ReSharper 8开始，我们为使用新的Extension Manager的插件的干净，轻松部署提供支持。为此，您的插件必须准备为<a href="http://docs.nuget.org/" rel="noopener noreferrer" data-external="true" target="_blank"><span>NuGet软件包</span></a> 。此外，还有一个中心位置，即ReSharper Gallery，可用于托管您的插件-可以在<a href="http://resharper-plugins.jetbrains.com" rel="noopener noreferrer" data-external="true" target="_blank"><span>http://resharper-plugins.jetbrains.com</span></a>上找到。但是，您也可以使用自己的服务器来部署插件（例如，在公司内部）。存储库也可以存储在网络上的物理文件夹或共享位置中。</p>

<p>创建程序包的方式与为NuGet创建程序包的方式相同，并且要求您使用<code class="code highlight language-text">nuget.exe</code>命令行实用程序，可以从<a href="http://nuget.codeplex.com/releases" rel="noopener noreferrer" data-external="true" target="_blank"><span>http://nuget.codeplex.com/releases</span></a>下载。您创建一个<code class="code highlight language-text">.nuspec</code>档案和通话<code class="code highlight language-text">nuget pack</code>并使用以下命令推送到存储库：</p>

<p><code class="code highlight language-text">nuget push myextension.1.0.0.nupkg -ApiKey XXX -Source https://resharper-plugins.jetbrains.com</code></p>

<aside class="note">
  <p>呼唤<code class="code highlight language-text">nuget pack</code>没有指定<code class="code highlight language-text">.nuspec</code>文件导致Nuget搜索任何项目文件（例如， <code class="code highlight language-text">.csproj</code> ） 要么<code class="code highlight language-text">.nuspec</code>文件在当前目录中，并从找到的第一个文件中构建软件包文件。当然，您也可以使用<code class="code highlight language-text">nuget pack myplugin.nuspec</code> 。</p>

  <p>您可以放心地忽略有关程序集在lib文件夹之外的警告。或者，使用<code class="code highlight language-text">nuget pack -NoPackageAnalysis</code> 。</p>
</aside>

<a name="package-structure" class="elem-anchor"></a>
<h2>包装结构<a href="#package-structure" class="anchor-link"><span></span></a></h2>

<p>为了找到插件，ReSharper在程序包中搜索了许多预定义的位置。这些位置是<em>递归</em>搜索的，因此您可以创建嵌套文件夹来保留插件。可以在一个软件包中部署用于不同版本的ReSharper的多个插件。</p>

<p>在版本控制方面，可以将部署限制为ReSharper的特定版本（推荐选项），也可以限制为ReSharper和Visual Studio的特定版本（例如，如果需要利用特定的Visual Studio界面）：</p>

<p>一般包装结构应为</p>

<div class="code-block" data-lang="text"><code class="code-block__wrapper">{Product}\{Version}\[VsVersion]\["plugins"|"settings"|"annotations"]</code></div>

<p>哪里：</p>
<ul>
  <li><strong><code class="code highlight language-text">{Product}</code></strong>是产品的名称，例如“ReSharper”，“ dotTrace”，“ dotCover”或“ dotPeek”</li>
  <li><strong><code class="code highlight language-text">{Version}</code></strong>是目标产品的版本，形式为“ v8.0”，“ v8.1.1”，“ v8.2.3”或“ vAny”。这使程序包可以包含特定于产品不同版本的多个文件。例如，一个软件包可以包含ReSharper 8.0和8.1的插件文件。特殊值“ vAny”表示文件适用于产品的所有版本。</li>
  <li><strong><code class="code highlight language-text">[VsVersion]</code></strong>是一个可选文件夹，用于将扩展名限制为特定版本的Visual Studio。格式为“ vsX.X”，例如“ vs10.0”，“ vs11.0”等。如果您的插件仅适用于特定版本的Visual Studio（例如，它使ReSharper能够使用Visual Studio 2012的预览标签），则应将其打包在适当的Visual Studio特定文件夹中（例如，Visual Studio S2012为“ vs11.0”）</li>
  <li><strong><code class="code highlight language-text">["plugins"]</code></strong>是一个可选的子文件夹，扩展管理器将在该文件夹中加载所有插件dll。如果没有插件，则不需要此文件夹。插件<strong>必须</strong>位于特定版本的文件夹中，例如<code class="code highlight language-text">v8.1</code></li>
  <li><strong><code class="code highlight language-text">["settings"]</code></strong>是用于以标准ReSharper形式部署的设置的可选子文件夹。DotSettings格式。这些设置不应是插件设置的默认值-使用<code class="code highlight language-text">IHaveDefaultSettingsStream</code>为了这。这些设置可以包含“实时模板”或“结构搜索和替换”样式，或覆盖其他现有设置。该软件包只能包含设置，并且不需要插件。建议将设置文件放置在<code class="code highlight language-text">vAny</code>夹。</li>
  <li><strong><code class="code highlight language-text">["annotations"]</code></strong>是您可能希望部署的外部注释的可选子文件夹。再一次，不需要这些注释与插件相关，并且程序包只能包含外部注释，而没有任何二进制文件。请注意，批注文件必须具有“ .xml”文件扩展名，并且必须以它们所使用的程序集命名，或位于具有该程序集名称的目录中。例如<code class="code highlight language-text">annotations\myAssembly.xml</code>和<code class="code highlight language-text">annotations\myAssembly\annotations.xml</code>都有效。 <code class="code highlight language-text">annotations\myAssembly.ExternalAnnotations.xml</code>不是。注释应放在<code class="code highlight language-text">vAny</code>夹。</li>
</ul>

<a name="dependency-on-resharper-package" class="elem-anchor"></a>
<h2>对“ ReSharper”软件包的依赖<a href="#dependency-on-resharper-package" class="anchor-link"><span></span></a></h2>

<p>的<code class="code highlight language-text">.nuspec</code>文件必须声明对名为“ ReSharper”的程序包的依赖关系。这允许扩展声明主机的版本要求。因此，如果扩展需要ReSharper 8.0，则它可以使用最低版本8.0创建对ReSharper的依赖。如果它还支持8.1，则可以具有8.0 <= ReSharper <8.1，或<code class="code highlight language-text">[8.0, 8.1)</code>以nuspec格式。</p>

<p>您可以下载和安装“ ReSharper”软件包，但该软件包不存在，而是由扩展管理器创建和管理的。它拒绝安装不具有此依赖性的任何软件包，因此我们不会尝试安装不是扩展的NuGet软件包。它还将拒绝安装任何不满足版本要求的软件包。Extension Manager使用的版本是ReSharper的文件版本，而不是发行的产品版本。因此，8.0版本实际上是8.0.14.856，而8.0.1版本是8.0.1000.2286。这些产品和文件版本均显示在帮助->关于对话框中。当您指定扩展名至少需要“ 8.0”时，实际上被视为至少需要“ 8.0.0.0”。您可以更具体地满足您的要求，例如“8.0.1000”定位到8.0.1。</p>

<a name="pre-release-packages" class="elem-anchor"></a>
<h2>预发行包<a href="#pre-release-packages" class="anchor-link"><span></span></a></h2>

<p>扩展管理器支持NuGet的预发行包概念。NuGet软件包版本（主要）遵循<a href="http://semver.org" rel="noopener noreferrer" data-external="true" target="_blank"><span>semver</span></a>标准，即Major。次要。补丁程序，例如2.0.12。如果补丁包含标签，例如2.0.12-beta1，则该软件包被视为预发行软件包，默认情况下未显示。Extension Manager和Extension Gallery都具有显示预发行版本的开关，并且在Extension Manager UI中突出显示了预发行版本。</p>

<p>此机制允许插件的预发行版本，但也允许支持产品的预发行版本。当针对EAP中产品的版本时，将您的软件包标记为预发布是一种良好的做法。由于ReSharper的API在发展，并且会在开发过程中引入重大变化，因此最好将您的软件包预先发布，以表明它们在当前版本中可能不稳定。</p>

<p>由于一个软件包可以包含针对该产品的多个版本的插件文件（例如ReSharper 8.0和8.1），因此可以通过使其预先发行版来支持同一软件包的8.1 EAP。那些想要在最新的EAP版本（例如8.1）上测试和使用您的插件的用户可以选择加入预发行版本，而8.0的用户可以继续使用该软件包的稳定版本，而无需通知更新。产品发布后，您可以更新软件包以删除预发行版本标签，并且将提示8.0和8.1用户进行更新。当8.0用户将产品升级到8.1时，他们将已经安装了8.1版本的插件，与8.0版本并排安装。</p>

<p>同样，如果用户在更新插件之前升级到产品的新版本，则该软件包将保持安装状态，但不会加载（因为文件位于8.0文件夹而不是8.1文件夹中）。由于仍然安装了该软件包，因此当图库中有可用的新版本时，将提示用户进行更新。</p>

<a name="sample-package-definition" class="elem-anchor"></a>
<h2>样品包装定义<a href="#sample-package-definition" class="anchor-link"><span></span></a></h2>

<p>以下是用于部署插件的示例软件包nuspec定义。</p>

<p>该示例说明它与任何ReSharper 8.1版本，任何8.2版本兼容，但与ReSharper 8.3不兼容（请记住，这是<strong>文件</strong>版本，而不是产品版本，因此它将与8.2.1000.4556相匹配）。</p>

<p>它部署了4个不同版本的插件，这些版本针对ReSharper 8.1和8.2的组合，并且特定于Visual Studio 2012和Visual Studio 2013。</p>

<p>它还部署适用于<em>所有</em> ReSharper版本的外部注释。</p>

<div class="code-block" data-lang="xml"><code class="code-block__wrapper"><span class="cp"><?xml version="1.0"?></span> <span class="nt"><package</span> <span class="nt">></span> <span class="nt"><metadata></span> <span class="nt"><id></span>MyPlugin<span class="nt"></id></span> <span class="nt"><version></span>1.0.0.0<span class="nt"></version></span> <span class="nt"><title></span>MuPlugin Title<span class="nt"></title></span> <span class="nt"><authors></span>JetBrains<span class="nt"></authors></span> <span class="nt"><description></span>MyPlugin description.<span class="nt"></description></span> <span class="nt"><copyright></span>Copyright <span class="ni">&#x00A9;</span> 2013 JetBrains<span class="nt"></copyright></span> <span class="nt"><tags></span>Cool Plugin<span class="nt"></tags></span> <span class="nt"><dependencies></span> <span class="nt"><dependency</span> <span class="na">id=</span><span class="s">"ReSharper"</span> <span class="na">version=</span><span class="s">"[8.1, 8.3)"</span> <span class="nt">/></span> <span class="nt"></dependencies></span> <span class="nt"></metadata></span> <span class="nt"><files></span> <span class="nt"><file</span> <span class="na">src=</span><span class="s">"bin\MyPlugin\VS2012\rs81\foo.vs11.dll"</span> <span class="na">target=</span><span class="s">"ReSharper\v8.1\vs11.0\plugins"</span> <span class="nt">/></span> <span class="nt"><file</span> <span class="na">src=</span><span class="s">"bin\MyPlugin\VS2012\rs81\foo.vs12.dll"</span> <span class="na">target=</span><span class="s">"ReSharper\v8.1\vs12.0\plugins"</span> <span class="nt">/></span> <span class="nt"><file</span> <span class="na">src=</span><span class="s">"bin\MyPlugin\VS2012\rs82\foo.vs11.dll"</span> <span class="na">target=</span><span class="s">"ReSharper\v8.2\vs11.0\plugins"</span> <span class="nt">/></span> <span class="nt"><file</span> <span class="na">src=</span><span class="s">"bin\MyPlugin\VS2012\rs82\foo.vs12.dll"</span> <span class="na">target=</span><span class="s">"ReSharper\v8.2\vs12.0\plugins"</span> <span class="nt">/></span> <span class="nt"><file</span> <span class="na">src=</span><span class="s">"bin\annotations\**\*.*"</span> <span class="na">target=</span><span class="s">"ReSharper\vAny\annotations\"</span> <span class="nt">/></span> <span class="nt"></files></span> <span class="nt"></package></span></code></div>

<p>有关NuSpec格式的更多信息，请参见[http://docs.nuget.org/docs/reference/nuspec-reference]。</p>

<a name="manual-install" class="elem-anchor"></a>
<h2>手动安装<a href="#manual-install" class="anchor-link"><span></span></a></h2>

<p>基于NuGet的扩展管理器仅适用于Visual Studio 2010和更高版本，因为<code class="code highlight language-text">NuGet.Core</code>程序集和用户界面仅在Visual Studio 2010及更高版本中受支持。为了支持较旧的Visual Studio版本，您需要提供一个下载文件，该文件会将插件dll复制到适当的位置以进行手动安装。这也是ReSharper 8之前支持插件的方式。请注意，手动安装不支持设置文件和外部注释。</p>

<aside class="warning">
  <p>不推荐使用这种安装方法，因为新的扩展基础结构提供了更多好处，例如按用户安装，自动更新检查和更容易发现新插件。</p>
</aside>

<p>ReSharper检查几个位置的插件。您可以通过转到ReSharper->选项->插件并单击“显示开发人员信息”来查看这些内容。会在位置上递归搜索插件，因此您可以创建一个包含插件文件的文件夹。</p>

<aside class="note">
  <p>在以下列表中， <code class="code highlight language-text">vX.X</code>指的是ReSharper的版本，例如<code class="code highlight language-text">v8.1</code>和<code class="code highlight language-text">vsY.Y</code>是Visual Studio版本号，例如<code class="code highlight language-text">vs12.0</code> 。</p>

  <p><code class="code highlight language-text">%LOCALAPPDATA%</code>和<code class="code highlight language-text">%APPDATA%</code>在Windows XP上未定义。它们分别相当于本地和漫游用户配置文件目录。对于Windows XP，值为<code class="code highlight language-text">%USERPROFILE%\Local Settings\Application Data</code>和<code class="code highlight language-text">%USERPROFILE%\Application Data</code>分别。</p>

  <p>也， <code class="code highlight language-text">%ProgramFiles%</code>将会<code class="code highlight language-text">%ProgramFiles(x86)%</code>在64位计算机上。</p>
</aside>

<ol>
  <li><code class="code highlight language-text">%ProgramFiles%\JetBrains\ReSharper\vX.X\bin\plugins</code> -（ <code class="code highlight language-text">%ProgramFiles(x86)%</code>在64位计算机上）。该文件夹默认情况下不存在，并且需要管理权限才能写入，但是此处安装的插件可供</li>
  <li><code class="code highlight language-text">%LOCALAPPDATA%\JetBrains\ReSharper\vX.X\vsY.Y\plugins</code> -Visual Studio特定的插件安装</li>
  <li><code class="code highlight language-text">%LOCALAPPDATA%\JetBrains\ReSharper\vX.X\plugins</code> - <strong>推荐的安装位置</strong> 。每位使用者，未漫游</li>
  <li><code class="code highlight language-text">%LOCALAPPDATA%\JetBrains\ReSharper\vAny\plugins</code> - <strong>不推荐</strong> 。插件需要按版本重新编译，因此无法跨版本工作</li>
  <li><code class="code highlight language-text">%LOCALAPPDATA%\JetBrains\DotNet\v1.0\plugins</code> - <strong>不推荐</strong> （见下文）</li>
  <li><code class="code highlight language-text">%LOCALAPPDATA%\JetBrains\DotNet\vAny\plugins</code> - <strong>不推荐</strong> （见下文）</li>
  <li><code class="code highlight language-text">%APPDATA%\JetBrains\ReSharper\vX.X\vsY.Y\plugins</code> -漫游（见下文）</li>
  <li><code class="code highlight language-text">%APPDATA%\JetBrains\ReSharper\vX.X\plugins</code> -漫游（见下文）</li>
  <li><code class="code highlight language-text">%APPDATA%\JetBrains\ReSharper\vAny\plugins</code> - <strong>不推荐</strong> 。插件需要按版本重新编译，因此无法跨版本工作</li>
  <li><code class="code highlight language-text">%APPDATA%\JetBrains\DotNet\v1.0\plugins</code> - <strong>不推荐</strong> （见下文）</li>
  <li><code class="code highlight language-text">%APPDATA%\JetBrains\DotNet\vAny\plugins</code> - <strong>不推荐</strong> （见下文）</li>
</ol>

<aside class="note">
  <p>插件安装到<code class="code highlight language-text">%APPDATA%</code>将使用加入域的PC的Windows配置文件漫游。因此，文件大小起着重要的作用-文件越大，配置文件漫游（和登录）所需的时间就越长。不建议在这里安装插件。</p>

  <p>的<code class="code highlight language-text">DotNet</code>文件夹旨在支持所有JetBrains .net工具通用的插件。但是，.net工具当前不共享公共二进制平台（尽管它们确实共享公共源平台）。因此，插件在.net工具之间不兼容。另外，版本号没有增加以反映平台中的更改。因此，这些位置不是安装插件的好地方。</p>
</aside>

<a name="command-line" class="elem-anchor"></a>
<h2>命令行<a href="#command-line" class="anchor-link"><span></span></a></h2>

<p>也可以加载在命令行上指定的插件，例如</p>

<div class="code-block" data-lang="text"><code class="code-block__wrapper">devenv.exe /ReSharper.Plugin foo.dll</code></div>



                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        <a class="navigation-links__prev" href="/Extensions/Deployment/LocalInstallation.html">本地安装</a>
                        
                    </div>
                    <div class="last-modified">上次修改时间：2017年7月10日</div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/help/resharper/sdk/app/app.js" data-baseurl="/help/resharper/sdk/"></script>




</body></html>