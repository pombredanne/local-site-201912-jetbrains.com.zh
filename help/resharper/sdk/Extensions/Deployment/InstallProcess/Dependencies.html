


<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title> / ReSharper  DevGuide</title>
    <link rel="stylesheet" href="/help/resharper/sdk/app/app.css">
    <link rel="shortcut icon" href="/help/resharper/sdk/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="57x57" href="/help/resharper/sdk/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/help/resharper/sdk/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/help/resharper/sdk/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/help/resharper/sdk/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/help/resharper/sdk/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/help/resharper/sdk/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/help/resharper/sdk/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/help/resharper/sdk/apple-touch-icon-180x180.png">
    <link rel="mask-icon" href="/help/resharper/sdk/apple-mask-icon.svg" color="black">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-square70x70logo" content="/help/resharper/sdk/mstile-70x70.png">
    <meta name="msapplication-TileImage" content="/help/resharper/sdk/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/help/resharper/sdk/mstile-150x150.png">
    <meta name="msapplication-wide310x150logo" content="/help/resharper/sdk/mstile-310x150.png">
    <meta name="msapplication-square310x310logo" content="/help/resharper/sdk/mstile-310x310.png">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Documentation for writing extensions for ReSharper" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.jetbrains.com/help/resharper/sdk//Extensions/Deployment/InstallProcess/Dependencies.html" />
    <meta property="og:site_name" content="JetBrains ReSharper" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="Documentation for writing extensions for ReSharper" />
    <meta property="og:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png" />
    <meta property="article:modified_time" content="2017-06-09T15:07:33+00:00" />
    <!-- <meta property="article:section" content="" /> 
    <meta property="article:tag" content="" /> -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JBPlatform" />
    <meta name="twitter:title" content="" />
    <meta name="twitter:description" content="Documentation for writing extensions for ReSharper" />
    <meta name="twitter:image" content="https://www.jetbrains.com/help/resharper/sdk/jetbrains.png" />
    <meta class="swiftype" name="product" data-type="string" content="/help/resharper/sdk/"></meta>
<link  rel="stylesheet" href="/help/resharper/sdk/app/styles.css"></head>
<body data-id="Extensions/Deployment/InstallProcess/Dependencies">
<div class="wrapper">
    <section class="panel _nav">
        <header class="panel__header">
            <div class="container">
                <form class="search-box">
                    <label for="search-box__input" class="search-box__label">
                        <input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper  DevGuide">
                    </label>
                    <div class="search-box__clear" title="Clear"></div>
                </form>
            </div>
        </header>
        <nav class="panel__content">
            <div class="container _nav">
                <menu class="nav-tree"></menu>
            </div>
            <div class="container _footer panel__footer">
                <p><a data-bypass="true" href="//youtrack.jetbrains.com/issues/IJSDK">Send feedback</a></p>
                <p>&copy; 2000&ndash;2018 <a href="//www.jetbrains.com">JetBrains</a> s.r.o.<br>
                    All rights reserved.</p>
            </div>
        </nav>
    </section>

    <main class="panel _main" role="main">
        <header class="panel__header">
            <div class="container">
                <h3>ReSharper DevGuide</h3>
                
                <div class="panel-trigger"></div>
            </div>
        </header>
        <section class="panel__content">
            <div class="container">
                <article class="article" data-shortcut-switcher="false">
                    <div class="navigation-links _top" data-swiftype-index="false">
                        
                        
                    </div>
                    <a data-bypass="true" href="https://github.com/JetBrains/resharper-devguide/edit/master/Extensions/Deployment/InstallProcess/Dependencies.md" class="page-link-to-github" target="_blank" rel="noopener noreferrer" title="Edit this page on GitHub">
                        <i class="github-icon"></i>
                        <span class="text">Edit page</span>
                    </a>

                    
                    <a name="dependencies" class="elem-anchor"></a>
<h1>Dependencies<a href="#dependencies" class="anchor-link"><span></span></a></h1>

<p>When installing the ReSharper Platform, all of the binaries are shipped in NuGet packages. First party binaries created by JetBrains are shipped in packages that reflect the logical grouping of functionality, e.g. <code class="code highlight language-text">JetBrains.Platform.Core.Text</code> provides the assemblies that work with text, providing the interfaces to work with documents and text spans.</p>

<p>These NuGet packages are not traditional NuGet packages - like extension packages, they are not intended to be added to a project, to provide references for compilation. Instead, they are intended to ship code that is to be used at runtime. This means the layout of files in the packages does not follow the traditional <code class="code highlight language-text">lib</code> folder structure. All files that are being deployed live under a <code class="code highlight language-text">DotFiles</code> folder, in a flat structure - these are the files that will be copied to the installation target folder. In order to load dependent assemblies, the files are in a flat folder structure - all assemblies live directly in <code class="code highlight language-text">DotFiles</code>, and not in any sub folders (the packages do include sub folders, though, usually for data files. Extensions make use of this for settings and external annotations).</p>

<p>The ReSharper Platform also makes use of various third party assemblies, such as <a href="http://www.newtonsoft.com/json" data-external="true" target="_blank" rel="noopener noreferrer"><span>Json.NET</span></a>, for parsing JSON. Ideally, the installer could simply use these assemblies directly from the <a href="https://www.nuget.org/packages/Newtonsoft.Json/" data-external="true" target="_blank" rel="noopener noreferrer"><span>NuGet packages available on nuget.org</span></a>.</p>

<p>However, the nuget.org packages are designed to be consumed at compile time, and can contain multiple instances of the assembly, targeting different .Net Framework versions or platforms. ReSharper does not need multiple copies of the assembly - the version it was compiled and tested against is the one that must be shipped. Rather than have the installer duplicate the functionality of NuGet in choosing the correct copy to use, ReSharper creates new packages that contain the dependencies that are required. Also, the new packages have the assembly in the <code class="code highlight language-text">DotFiles</code> folder, in the same format as the first party assembly packages.</p>

<p>Furthermore, ReSharper uses some third party assemblies that don’t have NuGet packages. These are also repackaged to fit the deployment model, and make the assemblies available. They are not intended to be consumed as NuGet package references in code projects.</p>

<a name="making-use-of-third-party-dependencies" class="elem-anchor"></a>
<h2>Making use of third party dependencies<a href="#making-use-of-third-party-dependencies" class="anchor-link"><span></span></a></h2>

<p>When creating an extension, care should be taken when adding a dependency on a third party assembly. If possible, it is best (and simpler) to avoid such dependencies - only take on a dependency when the functionality cannot be easily added to your extension’s source code.</p>

<p>An extension should not ship a third party assembly as part of their own package.</p>

<p>All files in a package, first party or extension, are copied from the <code class="code highlight language-text">DotFiles</code> folder in the package to the same installation folder. If more than one package tries to distribute the same third party assembly, the installer would attempt to copy all versions to the same location. The result is undefined, but could result in the wrong version (older or newer) being installed, and one or more of the extensions (or the product itself) could become unusable.</p>

<p>If an extension wishes to use a third party assembly, it should create a new package that contains just that assembly, living in the <code class="code highlight language-text">DotFiles</code> folder, and push it to the <a href="https://resharper-plugins.jetbrains.com" data-external="true" target="_blank" rel="noopener noreferrer"><span>ReSharper Plugin Gallery</span></a>. The name of the package should be the same as the name of the assembly, and the version of the package should reflect the version of the assembly (or the version of the assembly’s nuget.org package). By using a predictable name and version, other extensions can also use the same packages.</p>

<p>The extension itself should add a dependency to the new third party assembly package in the extension’s <code class="code highlight language-text">.nuspec</code> file. E.g.</p>

<div class="code-block" data-lang="xml"><code class="code-block__wrapper"><span class="nt">&lt;package&gt;</span>
  <span class="nt">&lt;metadata&gt;</span>
    ...
    <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency</span> <span class="na">id=</span><span class="s">"Wave"</span> <span class="na">version=</span><span class="s">"[2.0]"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;dependency</span> <span class="na">id=</span><span class="s">"Foo.Bar.ThirdParty"</span> <span class="na">version=</span><span class="s">"[1.3, 1.4)"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;/metadata&gt;</span>
  <span class="nt">&lt;files&gt;</span>...<span class="nt">&lt;/files&gt;</span>
<span class="nt">&lt;/package&gt;</span>
</code></div>

<p>If more than one extension requires the same assembly package, the installer can use NuGet’s version resolution to find a common version that can be used by both extensions. It is considered best practice to add a dependency in the <code class="code highlight language-text">.nuspec</code> file that includes a version range, to allow maximum flexibility.</p>

<a name="transitive-dependencies" class="elem-anchor"></a>
<h2>Transitive dependencies<a href="#transitive-dependencies" class="anchor-link"><span></span></a></h2>

<p>Extensions needs to specify all of their transitive dependencies in their own <code class="code highlight language-text">.nuspec</code> file. That is, if an extension required package <code class="code highlight language-text">A</code>, and package <code class="code highlight language-text">A</code> in turn requires package <code class="code highlight language-text">B</code>, then the extension should list both package <code class="code highlight language-text">A</code> and <code class="code highlight language-text">B</code> as dependencies in its <code class="code highlight language-text">.nuspec</code> file.</p>

<p>This is due to a technical limitation in the NuGet gallery software used to distribute ReSharper extensions. All extension package are uploaded to the same gallery, regardless of which version of ReSharper they target. When ReSharper requests the list of known extensions from the gallery, it does so on a “curated feed”. This curated feed is an automatically maintained subset of all of the packages on the gallery. When uploading an extension, the curator will examine the package’s dependencies, and place the package in the appropriate feed. E.g. If a dependency is <code class="code highlight language-text">Wave=[2.0]</code>, the curator will put the package into the <code class="code highlight language-text">Wave_v2.0</code> feed.</p>

<p>The curator will also try to add dependencies into the feed. However, to keep things simple, the curator only adds direct dependencies to the feed, and the package must exist on the gallery first. If a dependency isn’t available, the extension installation will fail.</p>

<aside class="note">
  <p> Since a package dependency can be satisfied by a range of versions of a package, the curator has to add all compatible versions of the dependency to the feed. If transitive dependencies were handled, the curator would also have to add all versions of all packages that satisfied the dependencies of all versions of the packages that were required by the original extension, and so on. Rather than process this potentially huge number of packages (and deal with invalid dependency cycles and conflicting version numbers), for simplicity, the curator only processes direct dependencies.</p>
</aside>

<p>The recommendation is:</p>

<ul>
  <li>An extension should specify all transitive dependencies in its own <code class="code highlight language-text">.nuspec</code> folder.</li>
  <li>All dependencies should be pushed to the gallery before the extension package.</li>
  <li>If there are any problems, either <a href="https://youtrack.jetbrains.com/newIssue?project=RSRP&amp;clearDraft=true&amp;c=" data-external="true" target="_blank" rel="noopener noreferrer"><span>raise an issue</span></a> or post to the <a href="https://groups.google.com/forum/#!forum/resharper-plugins" data-external="true" target="_blank" rel="noopener noreferrer"><span>Google group</span></a>.</li>
</ul>


                    <div class="navigation-links _bottom" data-swiftype-index="false">
                        
                        
                    </div>
                    <div class="last-modified">
                        Last modified: 9 June 2017
                    </div>
                </article>

                <section class="disqus">
                    <div id="disqus_thread"></div>
                </section>
            </div>
        </section>
    </main>
</div>

<script src="/help/resharper/sdk/app/app.js" data-baseurl="/help/resharper/sdk/"></script>

</body>
</html>

