<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><meta content="noindex" name="robots"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Code Inspection: Possible multiple enumeration of IEnumerable - Help | ReSharper</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="PossibleMultipleEnumeration" data-breadcrumbs="PossibleMultipleEnumeration.xml|Code Inspection: Possible multiple enumeration of IEnumerable" data-main-title="Code Inspection: Possible multiple enumeration of IEnumerable" data-article-props="&#xA;                {&#xA;                &#xA;            &#34;seeAlso&#34;:[&#xA;            &#xA;                {&#34;title&#34;: &#34;Concepts&#34;,&#xA;                 &#34;links&#34;: [&#xA;                &#xA;        {&#34;url&#34;:&#34;Finding_Code_Issues.html&#34;,&#34;text&#34;:&#34;Find Code Issues with Code Inspection&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;Code_Analysis__Code_Inspections.html&#34;,&#34;text&#34;:&#34;Code Inspections&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;Design_time_Inspection.html&#34;,&#34;text&#34;:&#34;Detect Code Issues in Design Time&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;Code_Analysis__Code_Annotations.html&#34;,&#34;text&#34;:&#34;Use Annotations to Refine Code Inspection&#34;}&#xA;    &#xA;                    ]},&#xA;                {&#34;title&#34;: &#34;Reference&#34;,&#xA;                 &#34;links&#34;: [&#xA;                &#xA;        {&#34;url&#34;:&#34;Reference__Code_Annotation_Attributes.html&#34;,&#34;text&#34;:&#34;Code Annotation Attributes&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;PossibleInvalidCastExceptionInForeachLoop.html&#34;,&#34;text&#34;:&#34;Code Inspection: Possible 'System.InvalidCastException' in foreach loop&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;MoreSpecificForeachVariableTypeAvailable.html&#34;,&#34;text&#34;:&#34;Code Inspection: Iteration variable can be declared with a more specific type&#34;}&#xA;    &#xA;                    ]}&#xA;            ]&#xA;        &#xA;                }&#xA;            " data-disqus-id="PossibleMultipleEnumeration_10"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>ReSharper 2019.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PossibleMultipleEnumeration" id="PossibleMultipleEnumeration.xml">Code Inspection: Possible multiple enumeration of IEnumerable</h1>    <a name="tip_disable"></a>        <aside data-type="tip" class="prompt" data-title="" rel="PossibleMultipleEnumeration.xml" id="8e318d51">            <p id="51e3841b">                You can                <a href="Code_Analysis__Configuring_Warnings.html#suppress">                    suppress this inspection to ignore specific issues</a>,                <a href="Code_Analysis__Configuring_Warnings.html#change_severity">                    change its severity level to make the issues less or more noticeable</a>, or                <a href="Code_Analysis__Configuring_Warnings.html#disable">disable it altogether</a>.            </p>        </aside>        <p id="f2d561dd">Consider the following code snippet:</p>    <div class="code-block" data-lang="csharp">
IEnumerable&lt;string&gt; names = GetNames();
foreach (var name in names)
    Console.WriteLine("Found " + name);
var allNames = new StringBuilder();
foreach (var name in names)
    allNames.Append(name + " ");
</div>    <p id="e1c971a7">        Assuming that        <code class="code">GetNames()</code>        returns an        <code class="code">IEnumerable&lt;string&gt;</code>, we are, effectively, doing extra work by        enumerating this collection twice in the two        <code class="code">foreach</code>        statements.</p>    <p id="5839a95d">        It could get even worse if        <code class="code">GetNames()</code>        results in a database query, in which case you could end up getting different values in both        <code class="code">foreach</code> loops if some other process changes the database between the two calls.    </p>    <p id="180d2258">        This kind of problem can be easily fixed â€”        force the enumeration at the point of variable initialization        by converting the sequence to an array or a list, for example:    </p>    <div class="code-block" data-lang="csharp">
List&lt;string&gt; names = GetNames().ToList();
    </div>    <p id="0a6b7f59">        The rest of your code can stay the same, because both array and list types implement the        <code class="code">IEnumerable</code>        interface.    </p>    <div class="chapter"><h2 id="false-positives">False positives</h2>        <p id="81955062">            Sometimes, this inspection may render false positives if the IEnumerable object is passed to some method            before being enumerated. For example:        </p>        <div class="code-block" data-lang="csharp">
        
public void Foo(IEnumerable&lt;string&gt; values)
{
    ThrowIfNull(values, nameof(values));
    var x = values.ToList(); // Possible multiple enumeration of IEnumerable
}

public static void ThrowIfNull&lt;T&gt;(T value, string name) where T : class
{
    // custom check for null but no enumeration
}
        
        </div>        <p id="434801f1">            In this case, ReSharper presumes that the method will do additional enumeration,            which is true in most cases.            If the method doesn't actually enumerate the IEnumerable object, you can mark the corresponding parameter            with the            <a href="Reference__Code_Annotation_Attributes.html#NoEnumerationAttribute">                [NoEnumerationAttribute]            </a>            to prevent the false positive:        </p>        <div class="code-block" data-lang="csharp">
        
public void Foo(IEnumerable&lt;string&gt; values)
{
    ThrowIfNull(values, nameof(values));
    var x = values.ToList(); // No warnings about multiple enumeration
}

public static void ThrowIfNull&lt;T&gt;([NoEnumeration] T value, string name) where T : class
{
    // custom check for null but no enumeration
}
        
        </div>    </div>    <div class="last-modified" data-skip-index="skip">Last modified: 28 November 2019 </div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>