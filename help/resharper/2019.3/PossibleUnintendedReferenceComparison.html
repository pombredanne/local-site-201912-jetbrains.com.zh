<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><meta content="noindex" name="robots"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Code Inspection: Possible unintended reference comparison - Help | ReSharper</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="PossibleUnintendedReferenceComparison" data-breadcrumbs="PossibleUnintendedReferenceComparison.xml|Code Inspection: Possible unintended reference comparison" data-main-title="Code Inspection: Possible unintended reference comparison" data-article-props="&#xA;                {&#xA;                &#xA;            &#34;seeAlso&#34;:[&#xA;            &#xA;                {&#34;title&#34;: &#34;Concepts&#34;,&#xA;                 &#34;links&#34;: [&#xA;                &#xA;        {&#34;url&#34;:&#34;Finding_Code_Issues.html&#34;,&#34;text&#34;:&#34;Find Code Issues with Code Inspection&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;Code_Analysis__Code_Inspections.html&#34;,&#34;text&#34;:&#34;Code Inspections&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;Design_time_Inspection.html&#34;,&#34;text&#34;:&#34;Detect Code Issues in Design Time&#34;}&#xA;    &#xA;                    ]},&#xA;                {&#34;title&#34;: &#34;External Links&#34;,&#xA;                 &#34;links&#34;: [&#xA;                &#xA;        {&#34;url&#34;:&#34;https://msdn.microsoft.com/en-us/library/ms173147.aspx&#34;,&#34;text&#34;:&#34;MSDN: Guidelines for Overriding Equals() and Operator == (C# Programming Guide)&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;http://stackoverflow.com/questions/12263715/possible-unintended-reference-comparison&#34;,&#34;text&#34;:&#34;StackOverflow: Possible unintended reference comparison&#34;}&#xA;    ,&#xA;        {&#34;url&#34;:&#34;https://stackoverflow.com/questions/41495792/c-sharp-equality-operator-with-list-of-interface-type-not-working-as-expected&#34;,&#34;text&#34;:&#34;StackOverflow: C# - equality operator with list of interface type not working as expected&#34;}&#xA;    &#xA;                    ]}&#xA;            ]&#xA;        &#xA;                }&#xA;            " data-disqus-id="PossibleUnintendedReferenceComparison_10"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search ReSharper Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>ReSharper 2019.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs">Visual Studio</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="PossibleUnintendedReferenceComparison" id="PossibleUnintendedReferenceComparison.xml">Code Inspection: Possible unintended reference comparison</h1>    <a name="tip_disable"></a>        <aside data-type="tip" class="prompt" data-title="" rel="PossibleUnintendedReferenceComparison.xml" id="7954a171">            <p id="6dd59d8d">                You can                <a href="Code_Analysis__Configuring_Warnings.html#suppress">                    suppress this inspection to ignore specific issues</a>,                <a href="Code_Analysis__Configuring_Warnings.html#change_severity">                    change its severity level to make the issues less or more noticeable</a>, or                <a href="Code_Analysis__Configuring_Warnings.html#disable">disable it altogether</a>.            </p>        </aside>        <p id="ef628b3d">        C# compiler issues the 'Possible unintended reference comparison' warnings        (<a href="https://msdn.microsoft.com/en-us/library/f6dtw2ah.aspx" data-external="true" target="_blank" rel="noopener noreferrer">CS0252</a>/        <a href="https://msdn.microsoft.com/en-us/library/etywy2s3.aspx" data-external="true" target="_blank" rel="noopener noreferrer">CS0253</a>)        in cases where you use equality operators (<code class="code">==</code> or        <code class="code">!=</code>) on objects of types that inherit from one another and only one of the types overrides        these operators.    </p>    <p id="77549fe8">        The fact that the equality operators are overridden in one of the types means that        <i id="4f0de45d">value equality</i> is expected when objects of this type are compared.        Comparing these objects with objects of types where the equality operators are not overridden will lead        to using the overload from        <code class="code">System.Object</code>, which checks        <i id="628719d5">reference equality</i>.        So a warning is issued because comparing object references is most likely erroneous in this situation.    </p>    <p id="9324600a">        Although ReSharper knows about these warnings and provides        <a href="Design_time_Inspection.html">design-time notifications</a> for them, it goes one step further        and detects another case of possible unintended reference comparison —        when only one of the compared types overrides        <code class="code">Equals()</code>.        <a href="https://msdn.microsoft.com/en-us/library/ms173147.aspx" data-external="true" target="_blank" rel="noopener noreferrer">MSDN documentation</a> says:        <i id="892b7926">Any class that represents a value, essentially any value type,            or a set of values as a group, such as a complex number class, should override Equals.</i>        So if        <code class="code">Equals()</code> is not overridden for the second object's type, then the comparison falls back to        the implementation of        <code class="code">Equals()</code> in        <code class="code">System.Object</code>, which performs a reference identity check,        which is most probably not desired for a value type.    </p>    <p id="a4adc872">        Here is a code listing that illustrates both situations:    </p>    <div class="code-block" data-lang="csharp">
class MyType
{
}

class TypeWithEquals : MyType
{
    public override bool Equals(object obj)
    {
      throw new NotImplementedException();
    }
}

class TypeWithEqOperators : MyType
{
    public static bool operator ==(TypeWithEqOperators left, TypeWithEqOperators right)
    {
      throw new NotImplementedException();
    }

    public static bool operator !=(TypeWithEqOperators left, TypeWithEqOperators right)
    {
      throw new NotImplementedException();
    }
}

class Test
{
    public Test(TypeWithEquals withEquals, TypeWithEqOperators withEqOperators, MyType parentObject)
    {
      bool a = withEqOperators == parentObject; // CS0253
      bool b = withEquals == parentObject;  // No compiler warnings, but ReSharper issues its own warning here
    }
}
    </div>    <p id="3eb3a40f">        Another case for this inspection is comparing interface types using equality operators (<code class="code">==</code> or        <code class="code">!=</code>).        As these operators are static, the compiler will default to        <code class="code">System.Object.ReferenceEquals()</code> — that is to the reference comparison —        even if the equality operators are overridden to value comparison in the interface implementations.        <br>        ReSharper looks for interface implementations that override equality operators and/or        <code class="code">Equals()</code>, and if it detects such an implementation it issues a warning:    </p>    <div class="code-block" data-lang="csharp">

interface ISomeInterface{ }

class SomeImplementation : ISomeInterface
{
    public override bool Equals(object obj) =&gt; throw new NotImplementedException();

    public override int GetHashCode() =&gt;  throw new NotImplementedException();
}

void ATest(ISomeInterface x, ISomeInterface y)
{
    bool a = x == y; //Possible unintended reference comparison
}

    </div>    <p id="c1408511">        Note that this inspection will look for interface implementations in the whole solution        (including referenced libraries), whose locations are not always obvious.        In the example below, ReSharper will detect implementations of        <code class="code">ICollection&lt;object&gt;</code> that override        <code class="code">Equals()</code> in the mscorlib and issue a warning even if none of your own implementations of        <code class="code">ICollection&lt;object&gt;</code> override        <code class="code">Equals()</code> or equality operators.    </p>    <div class="code-block" data-lang="csharp">
        
void SomeTest(ICollection&lt;object&gt; x, ICollection&lt;object&gt; y)
{
    bool a = x == y; //Possible unintended reference comparison
}
        
    </div>    <p id="d7a05916">        Although this case may seem a bit defensive, your code might be more straightforward and probably safer        if you use non-static methods for comparing interfaces.        That is, you can use        <code class="code">ReferenceEquals()</code> if you mean to check reference equality, or        <code class="code">Equals()</code> if you expect it to be overridden in the implementations,        or any specific method, for example        <code class="code">Enumerable.SequenceEqual()</code>,        which checks whether collections contain equal objects in the same order.    </p>    <div class="last-modified" data-skip-index="skip">Last modified: 28 November 2019 </div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>