<html lang="en-US" ><head><meta charset="UTF-8"><meta name="robots" content="noindex"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta name="description" content="
        Adding code quality metrics to your TeamCity build and failing builds based on code issues.
    " data-skip-index="skip"><title>使用ReSharper和TeamCity检测构建中的代码问题-帮助|帮助锐化器</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity" data-breadcrumbs="Getting_Started.xml|Getting Started and Tutorials/Cookbook.xml|ReSharper Cookbook/Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity.xml|Detect code issues in a build using ReSharper and TeamCity" data-main-title="Detect code issues in a build using ReSharper and TeamCity" data-article-props="
                {
                
            " seeals=":[=" titl=":=" concept=",=" link=":=" ur=":" finding_code_issues.htm="," tex=":" find="" issues="" with="" inspectio="}=" inspectcode.htm="," inspectcode="" command-line="" too="}=" dupfinder.htm="," dupfinder="" ]}="" ]="" }="" detect_code_issues_in_a_build_using_resharper_and_teamcity_1=""><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索ReSharper帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>ReSharper 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary">视觉工作室</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity.xml" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity">使用ReSharper和TeamCity检测构建中的代码问题</h1>            <p id="ce17ad23">您是否知道可以在<a href="http://www.jetbrains.com/teamcity" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity</a>服务器上为您的构建运行ReSharper的<a href="Code_Analysis__Code_Inspections.html">代码检查</a> ？实际上，很久以前我们就在TeamCity中添加了对此功能的支持，但似乎该功能并未广为人知，尤其是ReSharper用户。设置本身非常简单，我们将逐步进行设置，并在组合中添加一些其他功能。</p>    <p id="03af2038">要开始使用TeamCity，请学习<a href="https://confluence.jetbrains.com/display/TCDL/Getting+Started+with+TeamCity" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity文档</a> 。</p>    <aside class="prompt" rel="03af2038" id="16825fb1" data-type="tip" data-title="">        <p id="861cb173">在<a href="InspectCode.html">后台</a> ，TeamCity使用<a href="InspectCode.html">InspectCode</a>进行代码检查，并使用<a href="dupFinder.html">dupFinder</a>进行重复分析。如有必要，您可以在任何CI或构建服务器上使用这些免费的命令行工具。</p>    </aside>    <div class="chapter"><h2 id="activating-net-inspections-in-teamcity" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#activating-net-inspections-in-teamcity">在TeamCity中激活.NET检查</h2>        <p id="94f96fe1">在构建过程中添加ReSharper检查仅是添加名为<span class="control">Inspections（.NET）</span>的构建步骤。唯一需要的参数是Visual Studio解决方案文件</p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity.png" id="7c243bca" width="669" height="702"></figure>        <p id="af832736">如果我们未指定“ <span class="control">自定义设置”配置文件路径</span> ，则TeamCity将采用默认设置进行代码检查。但是，我们可以配置它们以符合我们自己/团队的标准。这是在<span class="menupath" data-skip-index="skip">代码检查中</span>完成的。 ReSharper选项的“ <span class="menupath" data-skip-index="skip">检查严重性”</span>页面。我们可以更改任何检查的<a href="Code_Analysis__Code_Inspections.html#severity">严重性</a> ，例如使用<code class="code">String.IsNullOrEmpty</code> ：</p>        <figure><img alt="更改检查严重性" title="更改检查严重性" src="/help/img/dotnet/2019.3/cookbook_teamcity1.png" id="cd493ba9" width="780" height="600"></figure>        <p id="06f1735d">...并将设置保存到<a href="Sharing_Configuration_Options.html#layers">解决方案团队共享层</a> 。然后，将设置保存在名为<span class="filepath">{Solution} .sln的文件中<span class="filepath">。DotSettings</span> ，通常在源代码管理中签入，以便在Visual Studio中打开解决方案时自动将其应用于其他团队成员。我们可以使用相同的设置文件来指示TeamCity的自定义检查设置：</span></p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity2.png" id="e177aa03" width="629" height="104"></figure>    </div>    <div class="chapter"><h2 id="analyzing-results" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#analyzing-results">分析结果</h2>        <p id="cf40f92a">当构建步骤运行时，TeamCity会生成一个可导航的报告供我们分析检查结果</p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity3.png" id="bf29d505" width="695" height="633"></figure>        <aside class="prompt" rel="bf29d505" id="966c52d2" data-type="note" data-title="">            <p id="7befeff7"><span class="control">仅具有新问题的检查</span>复选框用于仅突出显示自上次构建运行以来的新问题。括号<span class="control">（+1 -1）</span>中的数字是自上次运行以来的差异。</p>        </aside>        <p id="88634217">我们可以浏览整个项目或特定名称空间的检查。检查按<a href="Code_Analysis__Code_Inspections.html#categories">类别</a> ，问题类型和右窗格上的相应文件进行分组。我们甚至可以通过单击行号导航到实际文件。但是，为此，我们需要<a href="http://www.jetbrains.com/resharperplatform/help?Keyword=TeamCity_Getting_Started" rel="noopener noreferrer" data-external="true" target="_blank">在Visual Studio上</a>安装<a href="http://www.jetbrains.com/resharperplatform/help?Keyword=TeamCity_Getting_Started" rel="noopener noreferrer" data-external="true" target="_blank">TeamCity Add-in for Visual Studio来</a>运行（如果没有安装，请单击链接将提示您一个对话框，以下载和安装该插件）。</p>    </div>    <div class="chapter"><h2 id="taking-action-based-on-inspection-severity" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#taking-action-based-on-inspection-severity">根据检查的严重程度采取措施</h2>        <p id="ae1dd426">在服务器端添加检查的主要好处之一是使代码质量达到一定水平，从而使构建过程可以根据一系列条件采取措施。例如，如果检测到太多警告或错误，我们可能希望构建失败。</p>        <p id="d03afa7e">在“ <span class="control">项目配置”</span>窗口中的“ <span class="control">构建失败条件”</span>下，我们可以添加一个新的“ <span class="control">构建失败”</span>条件：</p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity4.png" id="c836a49b" width="444" height="293"></figure>        <p id="2fdc9a9e">我们选择<span class="control">基于度量标准更改</span>的构建失败，然后根据警告或错误指示我们是否要使构建失败。在我们的案例中，我们将选择错误，如果错误不止一个，那么它会失败。</p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity5.png" id="f79eae6f" width="612" height="260"></figure>        <p id="44e406c6">显然，如果我们希望检查对构建状态有影响，即构建失败，则只能基于警告或错误来进行检查。因此，不能使用提示和建议。因此，在ReSharper中配置检查严重性时，我们应该考虑到这一点。</p>        <p id="1401f6f8">如果现在再次运行我们的构建，则它将失败，因为错误数量大于一个。下面是相同输入和检查的输出，但其中一个运行具有构建失败条件，而另一种则没有运行。</p>        <figure><img alt="TeamCity上的ReSharper代码分析" title="TeamCity上的ReSharper代码分析" src="/help/img/dotnet/2019.3/cookbook_teamcity6.png" id="58f0cd85" width="649" height="54"></figure>    </div>    <div class="chapter"><h2 id="checking-for-copy-paste-code" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#checking-for-copy-paste-code">检查复制/粘贴代码</h2>        <p id="a2e4e7e3">尽管严格来说，这与ReSharper功能无关，但是由于我们在构建过程中谈论的是代码质量，因此还应提及TeamCity可以检查代码重复。</p>        <p id="d4ae1d27">就像以前一样，激活代码复制只是添加一个新的构建步骤，即<span class="control">复制副本查找器（.NET）</span> 。我们可以指示要忽略的文件夹，是否要考虑名称空间，类型名称以及其他一些选项。</p>        <figure><img alt="对TeamCity进行重复分析" title="对TeamCity进行重复分析" src="/help/img/dotnet/2019.3/cookbook_teamcity7.png" id="e5d5f5a0" width="716" height="702"></figure>        <p id="2369c8e7">输出是一个格式良好的可导航屏幕，它使我们可以浏览不同的文件，并查看TeamCity检测到的重复项的并排比较（以下为空间限制而调整了大小）：</p>        <figure><img alt="对TeamCity进行重复分析" title="对TeamCity进行重复分析" src="/help/img/dotnet/2019.3/cookbook_teamcity8.png" id="a9bd08e3" width="968" height="524"></figure>        <p id="8e704a05">而且正如预期的那样，如果我们有太多的代码重复，我们也可能会导致构建失败</p>        <figure><img alt="对TeamCity进行重复分析" title="对TeamCity进行重复分析" src="/help/img/dotnet/2019.3/cookbook_teamcity9.png" id="6f03405e" width="613" height="261"></figure>    </div>    <div class="chapter"><h2 id="summary" data-toc="Detect_code_issues_in_a_build_using_ReSharper_and_TeamCity#summary">摘要</h2>        <p id="8a37df26">使用JetBrains工具，可以很轻松地将代码质量检测功能添加到构建过程中，并且如果生产代码中不应包含的某些内容漏掉，则构建失败。</p>    </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月28日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Deal_with_a_lot_of_entries_in_resource_files.html">处理资源文件中的大量条目</a> <a class="navigation-links__next" href="Detect_possible_NullReferenceExceptions.html">检测可能的NullReferenceExceptions</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>