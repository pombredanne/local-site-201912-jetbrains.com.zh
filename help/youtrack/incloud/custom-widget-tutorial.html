<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');</script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>自定义小部件教程-帮助| YouTrack InCloud</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="custom-widget-tutorial" data-breadcrumbs="Resources-for-Developers.xml|Resources for Developers/building-custom-widgets.xml|Widget Development Guide/custom-widget-tutorial.xml|Custom Widget Tutorial" data-main-title="Custom Widget Tutorial"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack InCloud帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack InCloud 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="custom-widget-tutorial.xml" data-toc="custom-widget-tutorial">自定义小部件教程</h1>    <p id="0812d79b">该页面将引导您完成构建自定义窗口小部件的步骤。我们决定涵盖一个非常简单的案例：一个示例小部件，该小部件显示GitHub中用户的配置文件信息。这个小部件不执行任何复杂的操作，例如第三方服务中的身份验证和授权，也不具有复杂的样式元素。尽管如此，我们希望本教程可以帮助您掌握自定义小部件背后的基本概念。</p>    <p id="ecba6cff">本教程描述了以下步骤：</p>    <ul class="list _ul"><li class="list__item" id="08759453"><a href="#create-widget-manifest">构建小部件清单</a></li><li class="list__item" id="827869ff"><a href="#create-index.html-file">为小部件创建入口点</a></li><li class="list__item" id="aed05bae"><a href="#create-the-script">为小部件编写脚本</a></li><li class="list__item" id="9a4f646f"><a href="#test-the-widget">测试小部件</a></li><li class="list__item" id="b7f10349"><a href="#upload-the-widget">将小部件上传到YouTrack</a></li><li class="list__item" id="6d17452b"><a href="#upload-plugins-repository">将小部件上载到JetBrains插件存储库</a></li></ul>        <div class="chapter"><h2 id="create-widget-manifest" data-toc="custom-widget-tutorial#create-widget-manifest">创建小部件清单</h2>            <p id="f2538b2d">第一步，我们创建<code class="code">manifest.json</code>文件。该文件定义了定制窗口小部件的属性。</p>            <p id="2c0e7c46">为了让YouTrack InCloud读取并显示小部件清单中的属性：</p>            <ul class="list _ul"><li class="list__item" id="cc710d4a"><p>该文件必须命名<code class="code">manifest.json</code> 。</p></li><li class="list__item" id="c55be146"><p>该文件必须存储在ZIP存档的最顶层。</p></li></ul>            <p id="5b1c41fa">这是示例小部件的清单文件：</p>            <div class="code-block" data-lang="json">{“ key”：“ github-user-widget”，“ version”：“ 0.0.1”，“ name”：“ GitHub用户信息”，“ description”：“小部件显示有关GitHub用户的信息。”，“ author” ：“ anonymous”，“ products”：{“ Hub”：“> = 2018.1”，“ YouTrack”：“> = 2018.1”}}</div>            <p id="4d8f80ab">我们的窗口小部件清单仅包含一些属性的定义。有关清单文件中需要定义的属性的完整列表，请参见<a href="building-custom-widgets.html#widget-manifest">Widget Manifest</a> 。</p>        </div>        <div class="chapter"><h2 id="create-index.html-file" data-toc="custom-widget-tutorial#create-index.html-file">创建一个index.html文件</h2>            <p id="532d9a51">第二步是为小部件创建一个入口点： <code class="code">index.html</code>文件。这是标准的HTML5文件。在这里，我们引用了<code class="code">hub-dashboard-addons</code>图书馆。该库允许小部件与其在YouTrack中插入的页面之间进行通信。该文件还包含CSS样式，用于处理从GitHub配置文件检索的数据的表示形式。的<code class="code">body</code>元素包括小部件脚本本身（ <code class="code">index.js</code> ）。</p>            <div class="code-block" data-lang="markup">
                
            
            
                
                    <meta charset="utf-8">
                    <!-- Default styles of dashboard widgets -->
                    <link rel="stylesheet" type="text/css" href="https://unpkg.com/hub-dashboard-addons@latest/dashboard.css">

                    <!-- Include dashboard connector from CDN -->
                    <script src="https://unpkg.com/hub-dashboard-addons@latest"></script>

                    <style>.user-avatar {
  width: 64px;
  height: 64px;
}
</style>
                
                
                    <div id="user-details">载入中...</div>

                    <script src="index.js"></script>
                
            
            
            </div>        </div>        <div class="chapter"><h2 id="create-the-script" data-toc="custom-widget-tutorial#create-the-script">创建脚本</h2>            <p id="f3d39676">第三步是创建脚本本身。在我们的例子中，脚本检索并显示指定GitHub用户的用户个人资料。</p>            <div class="code-block" data-lang="javascript">/ *声明一个常量，该常量包含目标github用户的登录名* / const USER_NAME ='jetbrains'; / *以下renderUserDetails（user）函数创建用户配置文件数据并将其插入DOM * /函数renderUserDetails（user）{const container = document.getElementById（'user-details'）; container.innerHTML =` <img src="${user.avatar_url}" class="user-avatar">
            <h4>$ {user.name}或<a href="${user.html_url}">$ {user.login}</a></h4>
            <div>
            <div>追踪者：$ {user.followers}</div>
            <div>回购：$ {user.public_repos}</div>`; } / *以下函数实际上是使用GitHub API从GitHub检索数据的。它使用Fetch API（https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API）* /函数loadAndRenderUser（userLogin）{return fetch（`https://api.github.com/ users / $ {userLogin}`）.then（response => {返回response.ok吗？response.json（）：新的错误（响应）; }）.then（user => {renderUserDetails（user）; return user;}）.catch（err => console.warn（err））; } / *最后一步是将小部件注册到仪表板中，并开始加载用户数据。另外，此块定义显示的窗口小部件标题并添加刷新按钮。当您单击刷新按钮时，脚本将重新加载并重新呈现用户配置文件数据。我们使用仪表板API来实现此功能。* / //注册小部件：Dashboard.registerWidget（function（dashboardAPI，registerWidgetAPI）{//加载GitHub配置文件数据loadAndRenderUser（USER_NAME）//设置小部件标题.then（user => dashboardAPI.setTitle（`GitHub User $ {user .login}`）））; //添加刷新按钮。registerWidgetAPI（{onRefresh：（）=> loadAndRenderUser（USER_NAME）}）; }）;</div>        </div>        <div class="chapter"><h2 id="test-the-widget" data-toc="custom-widget-tutorial#test-the-widget">测试小部件</h2>                        <p id="f5b0e679">要测试小部件，我们需要将其加载到<span class="control">Widgets Playground中</span> 。首先，我们使用自定义窗口小部件文件在本地目录上运行静态服务器。在本例中，我们使用需要Node.js的<a href="https://www.npmjs.com/package/http-server" rel="noopener noreferrer" data-external="true" target="_blank">npm http-server</a> 。然后，由于YouTrack InCloud仅可通过HTTPS访问，因此我们需要使自定义窗口小部件可通过HTTPS访问。在本教程中，我们使用<a href="https://ngrok.com" rel="noopener noreferrer" data-external="true" target="_blank">ngrok</a> 。</p>                            <section class="procedure-steps"><h3 id="03f27ab7">要通过HTTPS提供小部件：</h3><ol class="list _decimal"><li class="list__item" id="e85c26db"><p>安装HTTP服务器：</p><div class="code-block" data-lang="bash">npm我http-server -g</div>                <p></p></li><li class="list__item" id="b04d1224"><p>在定制窗口小部件目录中，使用以下命令运行http-server：</p><div class="code-block" data-lang="bash">http服务器。 --cors -c-1 -p 9033</div>HTTP服务器启动并在当前目录中提供内容。在响应中，您可以访问HTTP服务器的IP地址（内部和外部）。例如：<figure><a class="lightbox" href="/help/img/youtrack/2019.2/http-server-started.zoomed.png"><img alt="http服务器启动" title="http服务器启动" src="/help/img/youtrack/2019.2/http-server-started.png" id="5310661e" width="600" height="130"></a></figure>                <p></p></li><li class="list__item" id="55134ec0"><p>为了使自定义窗口小部件可以通过HTTPS访问，我们需要在用于HTTP服务器的端口上运行ngrok服务：</p><div class="code-block" data-lang="bash">./ngrok http 9033</div>ngrok启动，在命令行输出中，您将看到类似以下内容：<figure><a class="lightbox" href="/help/img/youtrack/2019.2/custom-widget-ngrok-https-forwarding.zoomed.png"><img alt="自定义小部件ngrok https转发" title="自定义小部件ngrok https转发" src="/help/img/youtrack/2019.2/custom-widget-ngrok-https-forwarding.png" id="9a5fa5df" width="600" height="200"></a></figure>                <p></p></li><li class="list__item" id="1469545d"><p>将https转发的URL从ngrok输出复制到Widget Playground输入字段。</p></li><li class="list__item" id="bf2d3c45">单击<span class="control">加载小部件</span>按钮。<ul class="list _ul"><li class="list__item" id="3c5b5405"><p>小部件已加载并显示在小部件游乐场中。</p><figure><a class="lightbox" href="/help/img/youtrack/2019.2/yti-custom-widget-playground-https.zoomed.png"><img alt="小部件游乐场" title="小部件游乐场" src="/help/img/youtrack/2019.2/yti-custom-widget-playground-https.png" id="97aac98a" width="600" height="296"></a></figure>                        <p></p></li></ul>                </li></ol></section>        <p id="8b64b286">从ngrok输出中复制https转发的URL，然后继续下一个过程。</p>                    <section class="procedure-steps"><h3 id="0714bddf">要将小部件加载到小部件游乐场中：</h3><ol class="list _decimal"><li class="list__item" id="87153325">在YouTrack中打开“ <span class="control">小部件游乐场”</span>页面。<ul class="list _ul"><li class="list__item" id="577de795"><p>在<span class="control">“</span> <span class="control">管理”</span>菜单的“ <span class="control">服务器设置”</span>部分中，选择“ <span class="control">自定义窗口小部件”</span> 。</p></li><li class="list__item" id="1dc06e58"><p>单击标题中的“ <span class="control">小部件游乐场”</span>链接。</p></li></ul></li><li class="list__item" id="596f93ba"><p>将ngrok输出中的HTTPS转发的URL粘贴到输入字段中。</p></li><li class="list__item" id="b5b732f3">单击<span class="control">加载小部件</span>按钮。<ul class="list _ul"><li class="list__item" id="e0c05305"><p>小部件已加载并显示在小部件游乐场中。</p><figure><a class="lightbox" href="/help/img/youtrack/2019.2/yti-custom-widget-playground-https.zoomed.png"><img alt="小部件游乐场" title="小部件游乐场" src="/help/img/youtrack/2019.2/yti-custom-widget-playground-https.png" id="1f554500" width="600" height="296"></a></figure>                        <p></p></li></ul>                </li></ol></section>            <p id="69f4e188">如果修改代码并将这些更改上传到Web服务器，请使用“ <span class="control">重新加载小部件”</span>按钮刷新小部件内容并测试更新。</p>            <p id="53550b53">要了解有关测试自定义小部件的更多信息，请参阅<a href="test-custom-widgets.html">测试自定义小部件</a> 。</p>        </div>        <div class="chapter"><h2 id="upload-the-widget" data-toc="custom-widget-tutorial#upload-the-widget">将小部件上传到YouTrack</h2>            <p id="cb148b7e">现在，我们已经在操场上成功测试了小部件，现在可以将其上传到生产环境。</p>            <p id="014fa049">首先，我们使用小部件文件创建一个ZIP存档。您可以根据需要使用任何存档应用程序。请记住<code class="code">manifest.json</code>和<code class="code">index.html</code>文件必须位于zip文件的最顶层。</p>            <p id="eaca92bb">例如，我们在macOS中使用了命令行提示符来创建档案。我们的示例窗口小部件仅包含三个文件，所有文件都位于同一目录中，没有任何子目录。因此，创建档案的命令非常简单（在定制小部件目录中运行）：</p>            <div class="code-block" data-lang="bash">zip custom-widget.zip *</div>            <p id="bd9488a0">我们创建了<code class="code">custom-widget.zip</code>文件。现在我们只需要将其上传到生产环境：</p>            <section class="procedure-steps"><h3 id="upload-sample-widget-to-production">要上传您的小部件：</h3><ol class="list _decimal"><li class="list__item" id="6b3e869a"><p>在YouTrack中打开“ <span class="control">自定义小部件”</span>页面。</p></li><li class="list__item" id="a43c2523">单击<span class="control">新建窗口小部件...</span>按钮。<ul class="list _ul"><li class="list__item" id="a7139c1e"><p>在侧栏中打开“ <span class="control">新建小部件”</span>对话框。</p></li></ul>                </li><li class="list__item" id="6b47c923">选择要上传的ZIP存档。<figure><a class="lightbox" href="/help/img/youtrack/2019.2/new-widget-dialog-with-info.zoomed.png"><img alt="带有信息的新窗口小部件对话框" title="带有信息的新窗口小部件对话框" src="/help/img/youtrack/2019.2/new-widget-dialog-with-info.png" id="2db8b6ce" width="600" height="284"></a></figure>                    <ul class="list _ul"><li class="list__item" id="c124ec66"><p>来自的信息<code class="code">manifest.json</code>文件显示在对话框中。</p></li></ul>                </li><li class="list__item" id="0cf280ef">单击上<span class="control">载小部件</span>按钮。<ul class="list _ul"><li class="list__item" id="8469b281"><p>该小部件将上传到服务器，并显示在可用的自定义小部件列表中。</p><figure><a class="lightbox" href="/help/img/youtrack/2019.2/custom-widget-uploaded-to-production.zoomed.png"><img alt="自定义窗口小部件已上传到生产环境" title="自定义窗口小部件已上传到生产环境" src="/help/img/youtrack/2019.2/custom-widget-uploaded-to-production.png" id="3ca74b02" width="600" height="302"></a></figure>它还显示在仪表板上的“ <span class="control">添加小部件”</span>下拉菜单中：<figure><a class="lightbox" href="/help/img/youtrack/2019.2/dashboard-custom-widget-menu.zoomed.png"><img alt="仪表板自定义小部件菜单" title="仪表板自定义小部件菜单" src="/help/img/youtrack/2019.2/dashboard-custom-widget-menu.png" id="5472e4ba" width="600" height="349"></a></figure>                        <p></p></li></ul>                </li></ol></section>            <p id="28e602c8">而已！用户可以将新的自定义窗口小部件添加到他们在YouTrack中的仪表板上。</p>        </div>    <div class="chapter"><h2 id="upload-plugins-repository" data-toc="custom-widget-tutorial#upload-plugins-repository">将小部件上载到JetBrains插件存储库</h2>        <p id="9acce241">最后的可选步骤是通过将您的窗口小部件上传到<a href="https://plugins.jetbrains.com/" rel="noopener noreferrer" data-external="true" target="_blank">JetBrains插件存储库，</a>与与YouTrack合作的其他公司共享您的窗口小部件。</p>        <section class="procedure-steps"><h3 id="0c65960a">要将小部件上载到存储库：</h3><ol class="list _decimal"><li class="list__item" id="ab14f42a"><p>在您的Web浏览器中，访问<a href="https://plugins.jetbrains.com/" rel="noopener noreferrer" data-external="true" target="_blank">JetBrains插件存储库</a> 。</p></li><li class="list__item" id="13c0392c">单击标题中的“ <span class="control">登录”</span>按钮。<ul class="list _ul"><li class="list__item" id="244cc04d"><p>如果您已经有一个JetBrains帐户，请输入您的电子邮件地址和密码。</p></li><li class="list__item" id="cee15f10"><p>如果您没有JetBrains帐户，请使用您的电子邮件地址注册并创建一个帐户。</p></li></ul></li><li class="list__item" id="2b3094db">在标题中，选择<span class="menupath" data-skip-index="skip">团队工具> YouTrack</span> 。<ul class="list _ul"><li class="list__item" id="5a8ddd0f"><p>将打开“ <span class="control">YouTrack窗口小部件”</span>页面。</p></li></ul></li><li class="list__item" id="6457d141">单击标题中的<span class="control">Upload Widget</span>按钮。<ul class="list _ul"><li class="list__item" id="1fe0e1a2"><p><span class="control">将</span>打开“ <span class="control">添加新窗口小部件”</span>页面。</p></li></ul></li><li class="list__item" id="7302be82"><p>从下拉列表中选择一个<span class="control">类别</span> 。</p></li><li class="list__item" id="5ceb3814"><p>单击<span class="control">选择文件</span>按钮，然后选择包含您的自定义窗口小部件的ZIP存档。</p></li><li class="list__item" id="515374ef">点击<span class="control">上传新插件</span>按钮。<ul class="list _ul"><li class="list__item" id="43da1568"><p>您的自定义窗口小部件已上传到JetBrains插件存储库。</p></li><li class="list__item" id="d409107c"><p>主持人审阅小部件并批准发布后，该小部件将添加到目录中。</p></li></ul></li></ol></section>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="building-custom-widgets.html">小部件开发指南</a> <a class="navigation-links__next" href="test-custom-widgets.html">测试自定义小部件</a></div></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>