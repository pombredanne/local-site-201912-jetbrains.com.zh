<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>状态机规则-帮助| YouTrack InCloud</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="state-machine-per-issue-type" data-breadcrumbs="Administration.xml|Administration/Workflow-Guide.xml|Workflows/Workflow-Rules.xml|Workflow Rule Types/state-machine-per-issue-type.xml|State-machine Rules" data-main-title="State-machine Rules"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack InCloud帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack InCloud 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="state-machine-per-issue-type.xml" data-toc="state-machine-per-issue-type">状态机规则</h1>    <p id="84e8663b"><span class="control">状态机</span>规则调节自定义字段从一个值到另一个值的过渡。YouTrack提供了两种类型的状态机规则的模板。</p>    <ul class="list _ul"><li class="list__item" id="f0ae9993"><p id="0791fc27">基本<span class="control">状态机</span>规则，用于调节自定义字段从一个值到另一个值的过渡。要了解有关这种状态机的更多信息，请参见<a href="#sample-state-machine-rule">基本状态机</a> 。</p></li><li class="list__item" id="5ce3acad"><p>一种<span class="control">状态机</span>规则，它基于指定字段中的当前值强加不同的状态转换集。要了解如何为这种状态机编写脚本，请参阅《 <a href="#state-machine-per-issue-type">状态机规则每种问题类型的状态机》</a> 。</p></li></ul>  <p id="0f034244">这两种状态机类型都是使用相似的参数集合构建的。</p>  <p id="0d451a16">您可以将状态机规则应用于任何自定义字段。但是，状态机规则最常见的用例是调节<span class="control">State</span>字段或存储了以下内容的自定义字段的值之间的转换： <code class="code">state</code>类型。</p>  <p id="106aae0e">将状态机规则应用于项目时，该字段的下拉列表中显示的选项仅限于状态机规则中为当前状态定义的转换。由状态机规则控制的自定义字段用<span class="control">工作流驱动的字段</span>图标标记。为状态机规则中的每个值定义的操作将显示在下拉列表中。实际值显示在右侧。下图说明了<span class="control">State</span>字段的允许转换列表如何基于当前值而变化。</p>  <aside class="prompt" rel="106aae0e" id="62c72492" data-type="warning" data-title="">    <p id="d1727a07">即使定义了可能阻止选择值的防护措施，也会显示每个值的允许转换。如果不满足保护条件，则忽略选择。</p>    <p id="59866d60">如果您在过渡中添加防护，请确保使用<code class="code">workflow.message</code>解释工作流所应用的限制的方法。</p>  </aside>  <figure><a class="lightbox" href="/help/img/youtrack/2019.2/statemachine-field-values.zoomed.png"><img alt="状态机字段值" title="状态机字段值" src="/help/img/youtrack/2019.2/statemachine-field-values.png" id="70c893d0" width="600" height="219"></a></figure>        <div class="chapter"><h2 id="sample-state-machine-rule" data-toc="state-machine-per-issue-type#sample-state-machine-rule">基本状态机</h2>          <p id="c936a772">基本状态机针对使用工作流的任何项目中的所有问题，为自定义字段调节从一个值到另一个值的过渡。对于每个过渡，您可以添加一个或多个操作。每个过渡的其他属性确定如何应用这些操作。</p>          <ul class="list _ul"><li class="list__item" id="42a33a5f"><p>使用的过渡<code class="code">onEnter</code>和<code class="code">onExit</code>设置字段的值时，属性将执行操作。这些操作由更改字段值的用户执行。</p></li><li class="list__item" id="ea476d8b"><p>使用<code class="code">after</code>属性在指定的时间范围后执行操作。这些操作由工作流用户帐户执行。</p></li></ul>            <p id="52660008">以下示例显示了简化的状态机规则。此规则定义“ <span class="control">状态”</span>字段允许的转换。</p>            <p id="7d5ac647">此规则定义了以下转换：</p>            <ul class="list _ul"><li class="list__item" id="88dd3d5e"><p>从初始<span class="control">打开</span>状态，该值可以更改为<span class="control">进行中</span> 。名称的其他转换<code class="code">reminder</code>包括<code class="code">after</code>该属性可提醒项目所有者，如果问题仍处于“ <span class="control">打开”</span>状态超过两天。</p></li><li class="list__item" id="4efdf132"><p>当问题从“ <span class="control">公开”</span>过渡到<span class="control">“进行中”时</span> ， <code class="code">onEnter</code>的财产<code class="code">In progress</code> state会自动将问题分配给更改<span class="control">State</span>字段值的用户。</p></li><li class="list__item" id="dc704303"><p>从<span class="control">“进行中”</span> ，该值可以更改为“ <span class="control">固定”</span>或“ <span class="control">打开”</span> 。当从<span class="control">正在进行</span>回到<span class="control">打开</span>这个过渡的自动化问题转变要求用户取消分配问题，否则过渡受阻。</p></li><li class="list__item" id="01dd5d10"><p>最终状态为<span class="control">Fixed</span> 。没有为此值定义其他过渡。设置此值后，将无法更改。</p></li></ul>          <p id="5f7472fc">下图显示了此规则的抽象表示。</p>          <figure><img alt="该图说明了State字段的值之间支持的过渡。" title="该图说明了State字段的值之间支持的过渡。" src="/help/img/youtrack/2019.2/basic-state-machine.png" id="9e4bab63" width="1009" height="214"></figure>          <p id="64d00b68">支持此状态机的工作流程规则编写如下：</p>                        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）;出口。TWO_DAYS = 2 * 24 * 60 * 60 * 1000; Exports.rule =实体。Issue.stateMachine（{标题：“基本状态机”，fieldName：“状态”，状态：{打开：{初始：true，转换：{开始：{targetState：“进行中”}，提醒：{targetState：'打开”，之后：出口。两天，行动：function（ctx）{var issue = ctx.issue; issue.project.leader.notify（'Reminder'，'签出问题'+ issue.id）; }}}}，“进行中”：{onEnter：function（ctx）{ctx.issue.fields。受让人= ctx.currentUser; }，onExit：function（ctx）{}，过渡：{fix：{targetState：'Fixed'}，重新打开：{guard：function（ctx）{if（ctx.issue.fields。受让人）{workflow.message（'除非先取消分配，否则您无法重新打开问题'）;返回false； }返回true; }，targetState：'Open'}}}，固定：{过渡：{}}}，要求：{受让人：{类型：实体。User.fieldType}}}）;</div>            <p id="296f1042">定义此状态机规则的组件如下：</p>            <ul class="list _ul"><li class="list__item" id="479a631f"><p>的<code class="code">require</code>陈述参考<code class="code">entities</code>模块和<code class="code">workflow</code>工作流程API中的模块。</p></li><li class="list__item" id="0aca2659"><p>的<code class="code">exports.TWO_DAYS</code>属性设置一个局部变量，该变量用于发送具有“ <span class="control">打开”</span>状态的问题的提醒。为该变量分配的值等于2天（以毫秒为单位）。</p></li><li class="list__item" id="4bcad3f2"><p>的<code class="code">exports.rule</code>属性使用<code class="code">Issue.stateMachine</code>导出声明后的脚本作为状态机规则的方法。</p></li><li class="list__item" id="b30317db"><p id="66f6e85a">规则主体本身包含以下属性的定义：</p>                    <div class="table-wrapper"><table width="100%" id="65090cea"><thead><tr id="8a72a5a3" class="ijRowHead"><th id="a1c75860" width="20%"><p>属性</p></th><th id="5640044d"><p>描述</p></th></tr></thead><tbody><tr id="34915008" class="ijRowOdd"><td id="151d6f61"><p>标题</p></td><td id="e7c20ebd"><p>可选的人类可读标题。</p></td></tr><tr id="a051c806" class="ijRowEven"><td id="106b560b"><p>fieldName</p></td><td id="5323f94c"><p>由状态机管理的自定义字段的名称。</p></td></tr><tr id="c90a9a47" class="ijRowOdd"><td id="7e53fc05"><p>状态</p></td><td id="6def2183"><p>字段值和它们之间的转换的定义的列表。包含空格和特殊字符的值设置在单引号中。</p></td></tr><tr id="118b0796" class="ijRowEven"><td id="9df70fac"><p>要求</p></td><td id="408c630a"><p id="8e434616">规则无误执行所需的实体列表。此属性确保可以将规则安全地附加到项目。</p>                                <p id="deb3d505">在此示例中，我们仅要求有一个“ <span class="control">受让人”</span>字段来存储<code class="code">user</code>键入规则附加到的项目。如果不存在此字段，则在“ <span class="control">工作流”</span>列表中显示错误。在附加必填字段之前，无法启用该规则。</p>                                <p id="05c4e8c7">对于状态机规则，无需将状态机管理的字段添加到需求中。该字段及其值源自<code class="code">states</code>属性。</p></td></tr></tbody></table></div></li><li class="list__item" id="aa754611"><p id="b06542ab">在中定义的每个值<code class="code">states</code>属性包含以下附加属性的定义：</p>                    <div class="table-wrapper"><table width="100%" id="aba2728c"><thead><tr id="5eec5be1" class="ijRowHead"><th id="a7b7b856" width="20%"><p>属性</p></th><th id="a1a4d23b"><p>描述</p></th></tr></thead><tbody><tr id="a692f717" class="ijRowOdd"><td id="143ffb28"><p>初始</p></td><td id="03461979"><p>一个布尔属性，用于确定在创建问题时设置列表中的哪个值。恰好一个值必须将此属性设置为<code class="code">true</code> 。对于其他未设置为初始值的值，此属性是可选的，可以省略。</p></td></tr><tr id="5d7ff446" class="ijRowEven"><td id="48d1b596"><p>onEnter</p></td><td id="6eb89ae3"><p>当将相应的值分配给问题时调用的可选函数声明。这些功能的行为类似于其他类型规则中的动作。</p></td></tr><tr id="7224972e" class="ijRowOdd"><td id="68a6487b"><p>退出</p></td><td id="a516c806"><p>当字段值从当前值更改为另一个值时调用的可选函数声明。这些功能的行为类似于其他类型规则中的动作。</p></td></tr><tr id="377b8fbd" class="ijRowEven"><td id="3faa94ef"><p>过渡</p></td><td id="3ba82653"><p id="3945e725">可以为列表中的每个值设置的可能目标值的列表。</p>                                <p id="5b319c67">在此示例中，我们仅要求有一个“ <span class="control">受让人”</span>字段来存储<code class="code">user</code>键入规则附加到的项目。如果不存在此字段，则在“ <span class="control">工作流”</span>列表中显示错误。在附加必填字段之前，无法启用该规则。</p>                                <p id="2824ca8b">对于状态机规则，您无需列出需求中由状态机管理的字段所使用的值。该字段及其值源自<code class="code">states</code>属性。</p></td></tr></tbody></table></div>                </li><li class="list__item" id="0dd77bf4"><p id="56beb879">在中定义的每个值<code class="code">transitions</code>属性包含一个<code class="code">name</code>属性。该名称用于在命令中设置此值，并且还显示在自定义字段的值列表中。每个过渡名称都包含以下附加属性的定义：</p>                    <div class="table-wrapper"><table width="100%" id="da95ddb3"><thead><tr id="ba64c14c" class="ijRowHead"><th id="af5dc310" width="20%"><p>属性</p></th><th id="ac13265f"><p>描述</p></th></tr></thead><tbody><tr id="231d8d6b" class="ijRowOdd"><td id="2611c1f3"><p>targetState</p></td><td id="0bad6d61"><p>在命令中指定命令时设置的值的实际名称<code class="code">name</code>属性被应用。</p></td></tr><tr id="edcb5444" class="ijRowEven"><td id="9305b86c"><p>后</p></td><td id="98c085c1"><p>可选属性，用于设置执行操作的间隔。该动作本身在<code class="code">action</code>属性。</p></td></tr><tr id="8dfb614f" class="ijRowOdd"><td id="0594ae96"><p>行动</p></td><td id="7fd949dd"><p>行为类似于其他类型规则中的操作的任何过渡的可选属性。</p></td></tr><tr id="aad25fb0" class="ijRowEven"><td id="e9d2c94f"><p>守护</p></td><td id="e4df725a"><p id="3c82c9b0">确定何时允许过渡的可选条件。如果不满足保护条件，则定制字段的值无法更改为此过渡定义的值。</p>                                <p id="0070a69c">在这个例子中，从<span class="control">在</span>过渡的问题<span class="control">取得进展</span>恢复<span class="control">开放</span>状态，这个问题必须尚未分配。警卫队包含使用<code class="code">message</code>的方法<code class="code">workflow</code>模块，以向尝试重新打开问题而不首先取消分配问题的用户提供反馈。</p></td></tr></tbody></table></div>                </li></ul>        </div>  <div class="chapter"><h2 id="state-machine-per-issue-type" data-toc="state-machine-per-issue-type#state-machine-per-issue-type">每个问题类型的状态机</h2>    <p id="a121f850">每个问题类型的状态机为基本状态机增加了一个额外的维度。该规则没有为自定义字段中的值调节单一的过渡集，而是为单独字段中的每个可能值提供了单独的状态机。</p>    <p id="79e31275">就像您可以将状态机规则应用于任何自定义字段（而不仅仅是默认的<span class="control">State</span>字段）一样，可以根据任何枚举字段中的值进行类型特定的转换，而不仅仅是默认的<span class="control">Type</span>字段。最常见的用例是根据问题<span class="control">Type</span>的当前值来调节<span class="control">State</span>字段的值之间的转换。</p>    <p id="cc2d7629">每个问题类型的状态机与基本状态机的编写方式相似，但有以下更改：</p>    <ul class="list _ul"><li class="list__item" id="57a4da50"><p>的<code class="code">fieldName</code>属性被替换为别名， <code class="code">stateFieldName</code>在新状态机规则的模板中。此属性的值确定状态机规则管理哪个字段。</p></li><li class="list__item" id="8de8fe0f"><p>的单独属性<code class="code">typeFieldName</code>使您可以指定指示哪个状态机应用于状态字段的字段。此属性的存在是基本状态机（不使用它）和每个问题类型的状态机之间的主要区别。</p></li><li class="list__item" id="1f71f1a8"><p>的<code class="code">states</code>属性被替换为别名， <code class="code">defaultMachine</code> 。此属性描述托管字段中值的默认过渡集。此状态机适用于未分配值的问题，而为其指定了备用状态机。</p></li><li class="list__item" id="b22ce8af"><p>的<code class="code">alternativeMachines</code>属性将状态机转换的集合存储在为该字段设置的自定义字段中的指定值<code class="code">typeFieldName</code>属性。</p></li></ul>    <p id="09701a6d">当您为<code class="code">typeFieldName</code> ，配置<code class="code">defaultMachine</code> ，并为其中的值定义至少一个状态机<code class="code">alternativeMachines</code>在规则的这一部分中，您最终会针对每种问题类型使用状态机。您指定的字段<code class="code">typeFieldName</code>属性用作默认状态机和备用状态机集合之间的切换。</p>    <p id="b4dac1c4">以下示例显示了如何为每个问题类型构建状态机。下面的每个选项卡都描述了与“ <span class="control">类型”</span>字段的可能值之一相对应的状态机。</p>    <div class="tabs" id="7c2d42bb"><div class="tabs__content" id="23d0ae45" data-title="Task">        <figure><img alt="该图显示每种问题类型在状态机中“状态”字段的默认转换。" title="该图显示每种问题类型在状态机中“状态”字段的默认转换。" src="/help/img/youtrack/2019.2/basic-state-machine.png" id="aff62b5f" width="1009" height="214"></figure>        <p id="896fe932">首先，我们采用上述基本状态机规则中适用的逻辑，并将其作为默认值应用于项目中的任何类型的问题。结果，分配给<span class="control">任务</span>类型的问题中“ <span class="control">状态”</span>字段的值将根据上面显示的模型进行调节。此状态机还适用于分配了任何类型但未分配其他状态机的问题。</p>      </div><div class="tabs__content" id="e7ead598" data-title="Bug">        <figure><img alt="该图显示了分配了错误类型的问题中“状态”字段的转换。" title="该图显示了分配了错误类型的问题中“状态”字段的转换。" src="/help/img/youtrack/2019.2/state-machine-for-bug-type.png" id="249cf54f" width="1139" height="319"></figure>        <p id="0067596d">接下来，我们将仅为分配了<span class="control">Bug</span>类型的问题添加备用状态机。</p>        <ul class="list _ul"><li class="list__item" id="8dec6ae0"><p>对于此问题类型，我们可以将值<span class="control">“无法复制”</span>分配给“ <span class="control">状态”</span>字段。</p></li><li class="list__item" id="f8cb7340"><p>我们将使其比默认状态机更具灵活性，从而允许从<span class="control">Fixed</span>切换回<span class="control">Open</span> 。这意味着我们可以在发生回归时重新打开问题，而不必多次报告同一问题。</p></li><li class="list__item" id="cdfdad84"><p>我们还将使从<span class="control">“无法再现”</span>过渡到“ <span class="control">打开”</span>成为可能。</p></li></ul>        <p id="7003b812">我们为特定的状态和转换添加了一些自动化。</p>        <ul class="list _ul"><li class="list__item" id="e7c53bc7"><p>当从<span class="control">打开</span>到<span class="control">正在进行中</span>的问题移动，这个问题被分配给谁改变了问题状态的用户。这是相同的定义<code class="code">onEnter</code>用于的属性<code class="code">In progress</code>基本状态机中的状态。</p></li><li class="list__item" id="33202740"><p>对于从<span class="control">进行中</span>到<span class="control">无法复制</span>的过渡，我们添加了<code class="code">action</code> 。这将显示一个警报，要求用户描述他们尝试了哪些步骤来重现该错误。</p></li><li class="list__item" id="108fe22a"><p>从已<span class="control">修复</span>问题只能转换回<span class="control">打开</span>状态。因此，我们可以为<code class="code">onExit</code>属性的定义<code class="code">Fixed</code>领域。该自动化将通知发送给受让人，以通知他们该问题已重新打开。</p></li></ul>      </div><div class="tabs__content" id="f872e742" data-title="Feature">        <figure><img alt="该图显示了被分类为功能请求的问题中“状态”字段的转换" title="该图显示了被分类为功能请求的问题中“状态”字段的转换" src="/help/img/youtrack/2019.2/state-machine-for-features.png" id="54525070" width="1094" height="346"></figure>        <p id="5541d69a">我们将添加一个替代状态机，并将其应用于分配了<span class="control">功能</span>类型的问题。</p>        <ul class="list _ul"><li class="list__item" id="8d39cb29"><p>对于这些类型的问题，我们添加了将问题直接从“ <span class="control">打开”</span>状态移动到“已<span class="control">拒绝”</span>的可能性。如果有人建议某个团队认为不符合其产品愿景的功能，则可以将其淘汰。</p></li><li class="list__item" id="a97c42d8"><p>只是为了改变方向，我们允许问题从“ <span class="control">拒绝”</span>过渡到“ <span class="control">开放”</span> 。</p></li><li class="list__item" id="5606cca3"><p>所有其他过渡都类似于错误的状态机。</p></li></ul>        <p id="c53c43a3">为简单起见，我们没有为此状态机添加任何自动化功能。这并不意味着没有任何机会可以自动化或增强此问题类型的流程。可能的增强包括：</p>        <ul class="list _ul"><li class="list__item" id="4c80ea69"><p>使用<code class="code">after</code>事件到“ <span class="control">打开”</span>状态的过渡集，以标记在此状态下保留六个月以上的问题。然后，您可以在下一个积压整理会话中查看所有标记的问题。</p></li><li class="list__item" id="61029826"><p>添加一个<code class="code">onEnter</code>事件更改为“ <span class="control">进行中”</span>状态，提示用户将功能分配给路线图中的特定里程碑或管道。</p></li><li class="list__item" id="5b13821d"><p>添加一个<code class="code">action</code>事件到从<span class="control">Rejected</span>到<span class="control">Open</span>的过渡，提示用户说明为什么要重新打开功能请求以供将来考虑。</p></li></ul>      </div></div>    <aside class="prompt" rel="7c2d42bb" id="7101ae81" data-type="note" data-title="Transitions Between State-machines">    <p id="950e2f41">对于每个问题类型的状态机，在<code class="code">typeFieldName</code>属性用作开关。更改此字段的值将确定将哪个状态机应用于当前问题。</p>      <p id="71c4a057">当前为状态问题在状态机中不支持的问题中为目标问题类型分配了问题的值时，托管字段的值将重置为为新状态机配置的初始值。</p>      <p id="436f2088">按照此处的示例，我们假设您有一个问题，当前被归类为功能请求，但被开发团队拒绝了。稍后您会了解到该问题实际上是一个错误，应予以解决。通过将“ <span class="control">类型”</span>字段的值从“ <span class="control">功能”</span>更改为“ <span class="control">错误”</span> ，“ <span class="control">状态”</span>字段的值会自动从“ <span class="control">拒绝”</span>更改为“ <span class="control">打开”</span> 。这是因为与<span class="control">Bug</span>类型关联的状态机不支持转换为<span class="control">Rejected</span>状态。</p>    </aside>    <p id="70f56ba0">我们可以将基本状态机规则的示例代码转换为每种问题类型的状态机，只需进行一些更改即可快速将其转换为状态机。</p>    <ul class="list _ul"><li class="list__item" id="915b393b"><p>虽然不是必需的，但我们已替换了名称<code class="code">fieldName</code>属性及其别名， <code class="code">stateFieldName</code> 。与基本状态机的样本一样，我们正在管理称为<code class="code">State</code> 。我们不更改此属性的值。</p></li><li class="list__item" id="9c94035d"><p>我们已经添加了该属性<code class="code">typeFieldName</code>并指定<code class="code">'Type'</code>作为其价值。这意味着现在可以将“ <span class="control">类型”</span>字段用作一个开关，以确定是应用默认状态机还是应用分配给该字段可能值之一的替代状态机。</p></li><li class="list__item" id="573c0e0a"><p>我们仅出于装饰目的应用了另一项更改，取代了<code class="code">states</code>属性及其别名， <code class="code">defaultMachine</code> 。我们不更改此属性的值。相反，我们重用了基本的状态机规则，该规则将适用于未分配给以下问题之一的任何问题： <code class="code">alternativeMachines</code>规则部分。</p></li><li class="list__item" id="e80857ce"><p>我们为添加了一个新部分<code class="code">alternativeMachines</code> 。在这里，我们为在“ <span class="control">类型”</span>自定义字段中分配了<span class="control">错误</span>和<span class="control">功能</span>值的问题指定状态机。</p></li></ul>    <p id="52417d3e">这是修改后的状态机规则：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）;出口。TWO_DAYS = 2 * 24 * 60 * 60 * 1000;出口。ONE_WEEK_IN_MS = 7 * 24 * 60 * 60 * 1000; Exports.rule =实体。Issue.stateMachine（{标题：“每个问题类型的状态机”，stateFieldName：“状态”，typeFieldName：“ Type”，defaultMachine：{打开：{初始值：true，过渡：{开始：{targetState：“进行中” }，提醒：{targetState：“打开”，之后：导出。两天，行动：function（ctx）{var issue = ctx.issue; issue.project.leader.notify（'Reminder'，'签出问题'+ issue.id）; }}}}，“进行中”：{onEnter：function（ctx）{ctx.issue.fields。受让人= ctx.currentUser; }，onExit：function（ctx）{}，过渡：{fix：{targetState：'Fixed'}，重新打开：{guard：function（ctx）{if（ctx.issue.fields。受让人）{workflow.message（'除非先取消分配，否则您无法重新打开问题'）;返回false； }返回true; }，targetState：“打开”}}}，已修复：{过渡：{}}}，alternateMachines：{错误：{打开：{初始值：true，过渡：{'进行中”：{targetState：“进行中”，动作：function（ctx）{if（！ctx.issue.fields。受让人）{ctx.issue.fields。受让人= ctx.currentUser; }}}，“无法复制”：{targetState：“无法复制”}}}，“进行中”：{过渡：{“重新打开”：{targetState：“打开”}，“修复” ：{targetState：“已修复”}，“无法复制”：{targetState：“ Ca n't Reproduce”}，“提醒”：{之后：导出。ONE_WEEK_IN_MS，targetState：“进行中”，操作：function（ctx）{if（ctx.issue.fields。受让人）{var subj ='[YouTrack]正在进行中'; var body ='问题'+ ctx.issue.id +'进行了一周。'; ctx.issue.fields。Assignee.notify（subj，body）; }}}}}，固定：{过渡：{'重新打开'：{targetState：'打开'}}，onExit：function（ctx）{if（ctx.issue.fields。受让人）{var subj ='[YouTrack]问题重新开放'; var body ='问题'+ ctx.issue.id +'需要引起您的注意。'; ctx.issue.fields。Assignee.notify（subj，body）; }}}，“无法复制”：{onEnter：function（/ * ctx * /）{workflow.message（'请留下评论，说明您尝试执行的操作。'）; }，转换：{'reopen'：{targetState：'Open'}}}}，功能：{打开：{初始值：true，转换：{'进行中：： {targetState：'进行中'，}，拒绝： {targetState：'Rejected'}}}，'In Progress'：{过渡：{重新打开：{targetState：'Open'}，修复：{targetState：'Fixed'}}}，固定：{过渡：{重新打开：{ targetState：'Open'}}}，已拒绝：{转换：{重新打开：{targetState：'Open'}}}}}}，要求：{受让人：{类型：实体。User.fieldType}}}）;</div>    <p id="a9ec2b43">定义此状态机规则的组件如下：</p>    <ul class="list _ul"><li class="list__item" id="c92bb0fe"><p>的<code class="code">require</code>陈述参考<code class="code">entities</code>和<code class="code">workflow</code>工作流程API中的模块。</p></li><li class="list__item" id="8baa356e"><p>的<code class="code">exports.TWO_DAYS</code>属性设置一个局部变量，该变量用于发送具有“ <span class="control">打开”</span>状态的问题的提醒。为该变量分配的值等于2天（以毫秒为单位）。</p></li><li class="list__item" id="d53e8d56"><p>的<code class="code">exports.ONE_WEEK_IN_MS</code>属性设置用来发送对于一直<span class="control">在进步</span>的一个多星期的错误提醒的局部变量。该变量的值等于一个星期（以毫秒为单位）。</p></li><li class="list__item" id="3dd4f500"><p>的<code class="code">exports.rule</code>属性使用<code class="code">Issue.stateMachine</code>导出声明后的脚本作为状态机规则的方法。</p></li><li class="list__item" id="17f1fdf0"><p id="1c912544">规则主体本身包含以下属性的定义：</p>        <div class="table-wrapper"><table width="100%" id="0d2c9806"><thead><tr id="ed641cbc" class="ijRowHead"><th id="86e0b875" width="20%"><p>属性</p></th><th id="1449fbdb"><p>描述</p></th></tr></thead><tbody><tr id="1891c52b" class="ijRowOdd"><td id="8d86d24b"><p>标题</p></td><td id="fd5a3f16"><p>可选的人类可读标题。</p></td></tr><tr id="01b4045e" class="ijRowEven"><td id="605c2058"><p>stateFieldName</p></td><td id="9d9ffc9f"><p>由状态机管理的自定义字段的名称。</p></td></tr><tr id="5b437e06" class="ijRowOdd"><td id="a4fde0bf"><p>typeFieldName</p></td><td id="c05f2310"><p>定制字段的名称，用于定义将哪个状态机应用于托管字段。</p></td></tr><tr id="9da4cbbe" class="ijRowEven"><td id="8eee16cb"><p>defaultMachine</p></td><td id="0fb8b9a8"><p id="e25dad72">默认状态机的字段值和它们之间的过渡的定义的列表。默认状态机适用于任何未分配给以下问题之一的问题： <code class="code">alternativeMachines</code>规则部分。</p>              <p id="328c9be9">包含空格和特殊字符的值设置在单引号中。</p></td></tr><tr id="618e830d" class="ijRowOdd"><td id="dce06db1"><p>AlternativeMachines</p></td><td id="3353ec4a"><p>将为指定值存储的状态机转换的集合存储在为<code class="code">typeFieldName</code>属性。</p></td></tr><tr id="8b3cf7a1" class="ijRowEven"><td id="0ad55edd"><p>要求</p></td><td id="e991093e"><p id="7df7b9d1">规则无误执行所需的实体列表。此属性确保可以将规则安全地附加到项目。</p>              <p id="f7c2a2f1">在此示例中，我们仅要求有一个“ <span class="control">受让人”</span>字段来存储<code class="code">user</code>键入规则附加到的项目。如果不存在此字段，则在“ <span class="control">工作流”</span>列表中显示错误。在附加必填字段之前，无法启用该规则。</p>              <p id="cdef1c02">对于按问题类型划分的状态机，您不需要将状态机管理的任何字段添加到需求中。该字段及其值源自<code class="code">defaultMachine</code>属性以及为中的每个值定义的字段的集合<code class="code">alternativeMachines</code>规则部分。为该字段设置的<code class="code">typeFieldName</code>属性也隐式添加到工作流程规则的要求中。</p></td></tr></tbody></table></div></li><li class="list__item" id="bb90ff6c"><p id="2220b67f">在中定义的每个值<code class="code">defaultMachine</code>属性以及为中的每个值定义的每个字段<code class="code">alternativeMachines</code>规则的“部分”包含以下附加属性的定义：</p>        <div class="table-wrapper"><table width="100%" id="7d5360a0"><thead><tr id="cf79ae82" class="ijRowHead"><th id="5ad1a664" width="20%"><p>属性</p></th><th id="04e82336"><p>描述</p></th></tr></thead><tbody><tr id="af99cac6" class="ijRowOdd"><td id="7911138c"><p>初始</p></td><td id="a98fab9c"><p>一个布尔属性，用于确定在创建问题时设置列表中的哪个值。恰好一个值必须将此属性设置为<code class="code">true</code> 。对于其他未设置为初始值的值，此属性是可选的，可以省略。</p></td></tr><tr id="fc4a5e44" class="ijRowEven"><td id="c20a6441"><p>onEnter</p></td><td id="d904aa97"><p>当将相应的值分配给问题时调用的可选函数声明。这些功能的行为类似于其他类型规则中的动作。</p></td></tr><tr id="5bbba2c7" class="ijRowOdd"><td id="357c4fc7"><p>退出</p></td><td id="72d1f487"><p>当字段值从当前值更改为另一个值时调用的可选函数声明。这些功能的行为类似于其他类型规则中的动作。</p></td></tr><tr id="f2f5c161" class="ijRowEven"><td id="abb84513"><p>过渡</p></td><td id="e64b9274"><p id="560bec90">可以为列表中的每个值设置的可能目标值的列表。</p>              <p id="feac7349">在此示例中，我们仅要求有一个“ <span class="control">受让人”</span>字段来存储<code class="code">user</code>键入规则附加到的项目。如果不存在此字段，则在“ <span class="control">工作流”</span>列表中显示错误。在附加必填字段之前，无法启用该规则。</p>              <p id="058bc553">对于状态机规则，您无需列出需求中由状态机管理的字段所使用的值。该字段及其值源自<code class="code">states</code>属性。</p></td></tr></tbody></table></div>      </li><li class="list__item" id="89fc2a64"><p id="ec596602">在中定义的每个值<code class="code">transitions</code>属性包含一个<code class="code">name</code>属性。该名称用于在命令中设置此值，并且还显示在自定义字段的值列表中。每个过渡名称都包含以下附加属性的定义：</p>        <div class="table-wrapper"><table width="100%" id="83dfcfb9"><thead><tr id="1be18d91" class="ijRowHead"><th id="44fc92d8" width="20%"><p>属性</p></th><th id="046aeaea"><p>描述</p></th></tr></thead><tbody><tr id="84467e7d" class="ijRowOdd"><td id="988843c0"><p>targetState</p></td><td id="04123461"><p>在命令中指定命令时设置的值的实际名称<code class="code">name</code>属性被应用。</p></td></tr><tr id="e6037988" class="ijRowEven"><td id="24627307"><p>后</p></td><td id="1fb3cd51"><p>可选属性，用于设置执行操作的间隔。该动作本身在<code class="code">action</code>属性。</p></td></tr><tr id="89a8d32f" class="ijRowOdd"><td id="b0adb22a"><p>行动</p></td><td id="36ba0719"><p>行为类似于其他类型规则中的操作的任何过渡的可选属性。</p></td></tr><tr id="3d6d1c70" class="ijRowEven"><td id="ba01d819"><p>守护</p></td><td id="c9d05ada"><p id="9b112800">确定何时允许过渡的可选条件。如果不满足保护条件，则定制字段的值无法更改为此过渡定义的值。</p>              <p id="57a8a7bd">在这个例子中，从<span class="control">在</span>过渡的问题<span class="control">取得进展</span>恢复<span class="control">开放</span>状态，这个问题必须尚未分配。警卫队包含使用<code class="code">message</code>的方法<code class="code">workflow</code>模块，以向尝试重新打开问题而不首先取消分配问题的用户提供反馈。</p></td></tr></tbody></table></div>      </li><li class="list__item" id="93c7383a"><p>的<code class="code">alternativeMachines</code>属性存储一组来自以下字段的值： <code class="code">typeFieldName</code>属性。分配有专用状态机的每个值都可以通过名称简单地引用。</p></li></ul>  </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="on-schedule-rules.html">时间表规则</a> <a class="navigation-links__next" href="action-rules.html">行动规则</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>