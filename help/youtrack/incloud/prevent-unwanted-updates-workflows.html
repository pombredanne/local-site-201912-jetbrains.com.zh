<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>防止有害的更新-帮助|帮助YouTrack InCloud</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="prevent-unwanted-updates-workflows" data-breadcrumbs="Administration.xml|Administration/Workflow-Guide.xml|Workflows/Workflow-Use-Cases.xml|Use Cases for Workflows/prevent-unwanted-updates-workflows.xml|Prevent Unwanted Updates" data-main-title="Prevent Unwanted Updates"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack InCloud帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack InCloud 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="prevent-unwanted-updates-workflows.xml" data-toc="prevent-unwanted-updates-workflows">防止不必要的更新</h1>    <p id="5eb95854">要阻止特定用户查看或更改自定义字段中的值，您可以选择<a href="Private-and-Public-Issue-Fields.html#make-field-private">将该字段设置为私有</a> 。但是，此解决方案有一些限制。用户可以读取和/或更新项目中的所有私有自定义字段，也可以不读取任何一个。</p>    <p id="c5327c7b">使用工作流，可以防止对公共字段中的更改进行不必要的更新。您可以支持各种更新限制。例如：</p>    <ul class="list _ul"><li class="list__item" id="dc77db09"><p>禁止质量检查小组成员以外的任何人将报告的错误的状态从“ <span class="control">固定”</span>更改为“ <span class="control">已验证”</span> 。</p></li><li class="list__item" id="fa6f8c60"><p>仅当“ <span class="control">花费的时间”</span>字段不为空时，才将问题标记为“已<span class="control">修复”</span> 。</p></li><li class="list__item" id="5af23025"><p>解决问题后，阻止用户更改“ <span class="control">受让人”</span>字段的值。</p></li></ul>    <div class="chapter"><h2 id="restrict-updates-to-specific-group" data-toc="prevent-unwanted-updates-workflows#restrict-updates-to-specific-group">将更新限制为特定的用户组</h2>        <p id="1248308d">假设您有一群处理付款请求的会计师。您的公司不希望会计团队在未经经理批准的情况下接受付款请求。</p>        <p id="942b7cdf">为了支持此限制，您需要两个自定义字段：</p>        <div class="table-wrapper"><table width="100%" id="412305c6"><thead><tr id="c88ebc70" class="ijRowHead"><th id="392f6ac6"><p>领域</p></th><th id="ec00a2f9"><p>描述</p></th></tr></thead><tbody><tr id="dddd0c57" class="ijRowOdd"><td id="2b7eaeae"><p>授权状态</p></td><td id="00351490"><p>存储两个枚举值： <span class="control">必需</span> （默认值）和<span class="control">授权</span> 。</p></td></tr><tr id="4943938c" class="ijRowEven"><td id="722ff653"><p>授权人</p></td><td id="303dc7a0"><p>存储用户类型。它包含可以批准付款请求的经理列表。</p></td></tr></tbody></table></div>        <p id="65e84eab">您想对“ <span class="control">授权状态”</span>字段应用限制，以便只能由被选为“ <span class="control">授权</span>者”的用户将其更改为“已<span class="control">授权”</span> 。这意味着：</p>        <ul class="list _ul"><li class="list__item" id="ffe50fa8"><p><span class="control">授权者</span>必须具有阅读该问题的权限。</p></li><li class="list__item" id="6b5475d9"><p><span class="control">授权者</span>必须具有更新<span class="control">授权状态</span>字段的权限。</p></li><li class="list__item" id="b4941b16"><p>任何其他用户都不能更新“ <span class="control">授权状态”</span>字段的值。</p></li></ul>        <p id="0232b841">要支持第一点和第二点，请在项目中使用权限方案，或使用将<span class="control">Authorizer</span>添加到可见性列表的工作流。有关详细信息，请参阅<a href="restrict-issue-visibility-workflow.html">使用工作流限制问题可见性</a> 。您还应该执行以下设置：</p>        <ul class="list _ul"><li class="list__item" id="9452cd84"><p>创建一个单独的<span class="control">Authorizers</span>组，并将所有经理添加为成员。</p></li><li class="list__item" id="a93deee6"><p>授予有权在项目中创建问题的用户相同级别的访问权限。</p></li><li class="list__item" id="c11aa7a5"><p>将此组设置为“ <span class="control">授权者”</span>字段中值的来源。</p></li></ul>        <p id="0a19c36c">现在，您可以限制谁可以设置<span class="control">授权状态</span>字段的值。当有人试图<span class="control">授权状态</span>设置为<span class="control">授权</span>这条规则被触发。它验证当前用户是与<span class="control">授权</span>者相同的人。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{标题：“只有授权者才能更新授权状态字段的值”，警卫：function（ctx）{return ctx.issue.fields.becomes（ctx。AuthStatus，ctx。AuthStatus。授权）； }，操作：function（ctx）{var authBy = ctx.issue.fields。AuthBy; work.check（authBy && authBy.login === ctx.currentUser.login，“只有授权者才能更新此字段！'）; }，要求：{AuthBy：{类型：实体。User.fieldType，名称：“ Authorizer”}，AuthStatus：{类型：实体。EnumField.fieldType，名称：“授权状态”，授权：{}}}}）；</div>        <p id="7d9020e3">此限制非常严格。但是，您可以不同地编写规则以使策略更宽松。下面的规则让会计团队成员选择的<span class="control">认证器</span>领域的又一价值，即使在<span class="control">授权</span>领域的<span class="control">地位</span>已被设置为<span class="control">授权</span> 。选择新的授权者时，“ <span class="control">授权状态”</span>字段的值将切换回<span class="control">Required</span> 。这样，您可以处理授权者离开公司或不再是提交付款请求者的经理的情况。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{标题：“只有执行者才能在授权请求中更改授权者”，警卫：function（ctx）{var fs = ctx.issue.fields;返回fs.isChanged（ctx。AuthBy）&& fs。AuthStatus.name === ctx。AuthStatus。授权名称； }，操作：function（ctx）{workflow.check（ctx.currentUser.isInGroup（ctx.executors.name），'只有执行者才能在请求被授权后更改授权者'+'！'）; ctx.issue.fields。AuthStatus = ctx。AuthStatus。需要; }，要求：{AuthBy：{类型：实体。User.fieldType，名称：“ Authorizer”}，AuthStatus：{类型：实体。EnumField.fieldType，名称：“授权状态”，授权：{}，必填：{}}，执行者：{类型：实体。UserGroup}}}）;</div>    </div>    <div class="chapter"><h2 id="add-restrictions-based-on-field-combinations" data-toc="prevent-unwanted-updates-workflows#add-restrictions-based-on-field-combinations">根据字段组合添加限制</h2>        <p id="94828463">上一节中描述的限制决定了哪些用户可以更新不同的字段。您还可以添加基于字段和值组合的限制。例如，这是一条规则，除非<span class="control">授权状态</span>为<span class="control">Authorized，</span>否则任何人都不得将<span class="control">State</span>字段的值更改为<span class="control">Paid</span> 。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{标题：“请求必须被授权标记为已付款”，警卫：function（ctx）{返回ctx.issue.fields.becomes（ctx。状态，ctx。州。付费）; }，动作：function（ctx）{var fs = ctx.issue.fields;工作流程检查（fs。AuthStatus && fs。AuthStatus.name === ctx。AuthStatus。Authorized.name，“只有授权的请求才能标记为已付款！'）; }，要求：{AuthStatus：{类型：实体。EnumField.fieldType，名称：“授权状态”，授权：{}，}，状态：{类型：实体。State.fieldType，付费：{}}}}）；</div>        <p id="8bc22bb1">这是另一个变体。将<span class="control">状态</span>设置为已<span class="control">付费时</span> ，无法修改存储在<span class="control">金额</span>字段中的值。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{title：'阻止更改已付费请求的金额'，警卫：function（ctx）{返回ctx.issue.fields.isChanged（ctx。量）; }，动作：function（ctx）{var fs = ctx.issue.fields;工作流程检查（fs。状态&& fs。State.name！== ctx。州。Paid.name，“您不能更改已付费请求的金额！'）; }，要求：{金额：{类型：实体。Field.floatType}，状态：{类型：实体。State.fieldType，付费：{}}}}）；</div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="restrict-issue-visibility-workflow.html">通过工作流</a> <a class="navigation-links__next" href="streamline-issue-reporting-workflows.html">简化问题</a> <a class="navigation-links__prev" href="restrict-issue-visibility-workflow.html">可见性，</a> <a class="navigation-links__next" href="streamline-issue-reporting-workflows.html">简化问题报告</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>