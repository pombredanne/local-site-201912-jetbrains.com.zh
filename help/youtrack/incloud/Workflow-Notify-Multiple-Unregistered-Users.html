<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>通知多个未注册用户-帮助|帮助YouTrack InCloud</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Workflow-Notify-Multiple-Unregistered-Users" data-breadcrumbs="Administration.xml|Administration/Workflow-Guide.xml|Workflows/Default-Workflows.xml|Default Workflows/Workflow-Notify-Multiple-Unregistered-Users.xml|Notify Multiple Unregistered Users" data-main-title="Notify Multiple Unregistered Users"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack InCloud帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack InCloud 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Workflow-Notify-Multiple-Unregistered-Users.xml" data-toc="Workflow-Notify-Multiple-Unregistered-Users">通知多个未注册用户</h1>    <p id="26e0886e">此工作流被用作邮箱集成的一部分，该集成使您可以将YouTrack用作帮助台。有关此集成的详细说明，请参阅<a href="Use-YouTrack-as-a-Help-Desk.html">将YouTrack用作帮助台</a></p>    <p id="d944f5d1">您可以使用此工作流程将电子邮件发送到任何电子邮件地址，包括未注册的用户。如果使用过度，向未注册用户发送电子邮件会减慢您的YouTrack InCloud实例的性能，该实例不适用于批量电子邮件服务。由于这些原因，我们对可以自动发送给未注册用户的通知数量设置了每日限制。</p>        <p id="f63dbb46">此工作流程管理存储在“ <span class="control">上一封邮件相关的电子邮件”</span>和“ <span class="control">所有相关电子邮件”</span>字段中的电子邮件地址。它还包括一个规则，当对通过向特定邮箱发送电子邮件报告的问题添加评论时，该规则将向未注册用户发送电子邮件。</p>    <div class="table-wrapper"><table class="left_header" width="100%" id="825eaf80"><tbody><tr id="5d6e47d2" class="ijRowOdd"><th id="5d452ca5" width="20%"><p>名称</p></th><td id="d63dbc68"><p>@ jetbrains / youtrack-workflow-notify-多个未注册用户</p></td></tr><tr id="6a99dc0e" class="ijRowEven"><th id="efbf8825"><p>自动连接</p></th><td id="a7f1cc31"><p>没有</p></td></tr><tr id="6ab8eee8" class="ijRowOdd"><th id="11100041"><p>模组</p></th><td id="815991cd"><p><a href="#collect-email-addresses">收集有关问题创建的电子邮件</a> （变更规则）<br>                <a href="#send-notifications">向所有未注册的用户发送通知</a> （更改规则）</p></td></tr></tbody></table></div>    <section class="procedure-steps"><h3 id="aabfdec1">要启用此工作流程：</h3><ol class="list _decimal"><li class="list__item" id="e0230ac4"><p>向您的项目添加一个名称为“ <span class="control">Last message related emails”</span>的字符串型字段。</p></li><li class="list__item" id="39075762"><p>将一个名为<span class="control">所有相关电子邮件</span>的字符串类型字段添加到您的项目。</p></li><li class="list__item" id="7907acfd"><p>将“ <span class="control">通知多个未注册用户”</span>工作流附加到您的项目。</p></li></ol></section>    <p id="8250add2">为了使此工作流程正常运行，您需要在YouTrack实例中配置一些其他设置：</p>    <ul class="list _ul"><li class="list__item" id="eee070f4"><p>配置您的项目以使用您的反馈或支持帐户的电子邮件地址发送通知。</p></li><li class="list__item" id="ab624751"><p>配置并启用<span class="control">邮箱集成</span>功能。</p></li></ul>    <p id="5ebb1299">有关此设置的完整说明，请参阅“ <a href="Use-YouTrack-as-a-Help-Desk.html">将YouTrack用作帮助台”</a> 。</p>    <div class="chapter"><h2 id="ea06c6ba">用例</h2>        <p id="95a99d7a">此工作流程支持将YouTrack用作帮助台。通过电子邮件报告问题时，“ <span class="control">发件人”</span>和“ <span class="control">抄送”</span>字段中的电子邮件地址将添加到该问题中。然后，当问题更新时，这些电子邮件地址会收到电子邮件通知。</p>    </div>    <div class="chapter"><h2 id="3e91c751">模组</h2>        <p id="b114ca60">该工作流程包括两个模块。第一个模块包含管理电子邮件地址列表的规则。第二个模块包含一个规则，该规则在问题更新时将通知发送到这些电子邮件地址。</p>        <div class="chapter"><h3 id="collect-email-addresses">收集有关问题创建的相关电子邮件</h3>        <p id="868cab73">该规则将收集“ <span class="control">与邮件相关</span>的<span class="control">最新邮件”</span>字段中存储的电子邮件地址，并将其复制到“ <span class="control">所有相关电子邮件”</span>字段中。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{标题：workflow.i18n（'收集与问题创建相关的电子邮件'），警卫：function（ctx）{return ctx.issue.becomesReported;}，操作：function（ctx）{var issue = ctx.issue ; var lastMessageRelatedEmailsStr = issue.fields.lastEmails; var isBlank = function（str）{return！str || str.trim（）。length === 0; }; var lastMessageRelatedEmails = isBlank（lastMessageRelatedEmailsStr）吗？[]：lastMessageRelatedEmailsStr.split（''）;如果（lastMessageRelatedEmails.length）{var fromServiceEmail = issue.project.notificationEmail; var isEmailAllowed = function（email）{返回电子邮件&& email.length && email.toUpperCase（）！== fromServiceEmail.toUpperCase（）; }; var allRelatedEmailsStr = issue.fields.allEmails; var allRelatedEmails = isBlank（allRelatedEmailsStr）吗？[]：allRelatedEmailsStr.split（''）; var newUsersEmails = lastMessageRelatedEmails.filter（function（email）{return isEmailAllowed（email）&& allRelatedEmails.indexOf（email）=== -1;}）;如果（newUsersEmails.length）{issue.fields.allEmails = allRelatedEmails.concat（newUsersEmails）.join（''）; } issue.fields.lastEmails = null; }}，要求：{lastEmails：{名称：“与最新消息相关的电子邮件”，键入：实体。Field.stringType}，allEmails：{名称：“所有相关电子邮件”，类型：实体。Field.stringType}}}）;</div>            </div>        <div class="chapter"><h3 id="send-notifications">向所有未注册用户发送通知</h3>        <p id="5d953ffb">下一条规则向未注册用户发送通知，这些用户的电子邮件地址存储在“ <span class="control">所有相关电子邮件”</span>字段中。这用于通过将电子邮件发送到特定收件箱来将通知发送到报告问题的人的电子邮件地址。还会通知在“ <span class="control">收件人”</span>和“ <span class="control">抄送”</span>字段中设置的其他电子邮件地址。</p>        <p id="b85912a5">电子邮件的格式设置为对原始电子邮件的回复。</p>        <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; var notifications = require（'@ jetbrains / youtrack-scripting-api / notifications'）; Exports.rule =实体。Issue.onChange（{标题：workflow.i18n（'向所有未注册用户发送通知'），后卫：function（ctx）{return ctx.issue.comments.added.isNotEmpty（）;}，操作：function（ctx）{ var issue = ctx.issue; var comment = issue.comments.added.first（）; if（comment && comment.permittedGroups.isEmpty（）&& comment.permittedUsers.isEmpty（））{var isBlank = function（str）{返回！str || str.trim（）。length === 0; }; var allRelatedEmailsStr = issue.fields.allEmails;如果（isBlank（allRelatedEmailsStr））{返回； } var allRelatedEmails = allRelatedEmailsStr.split（''）; var lastMessageRelatedEmailsStr = issue.fields.lastEmails; var lastMessageRelatedEmails = isBlank（lastMessageRelatedEmailsStr）吗？[]：lastMessageRelatedEmailsStr.split（''）; var fromServiceEmail = issue.project.notificationEmail; var isEmailAllowed = function（email）{返回电子邮件&& email.length && email.toUpperCase（）！== fromServiceEmail.toUpperCase（）; }; var emailsToNotify; if（lastMessageRelatedEmails.length）{//案例1：未注册用户的注释var newUsersEmails = lastMessageRelatedEmails.filter（function（email）{return isEmailAllowed（email）&& allRelatedEmails.indexOf（email）=== -1;}）;如果（newUsersEmails.length）{issue.fields.allEmails = allRelatedEmailsStr +''+ newUsersEmails.join（''）; } issue.fields.lastEmails = null; emailsToNotify = allRelatedEmails.filter（function（email）{return isEmailAllowed（email）&& lastMessageRelatedEmails.indexOf（email）=== -1;}）; } else {//案例2：来自代理商emailsToNotify = allRelatedEmails.filter（function（email）{return isEmailAllowed（email）;}）的评论； } if（emailsToNotify.length）{var message = {fromName：lastMessageRelatedEmails.length？lastMessageRelatedEmails [0]：comment.author.fullName，toEmail：emailsToNotify，主题：createSubject（问题），正文：lastMessageRelatedEmails.length？createGeneralMessage（issue）：createInReplyToMessage（issue）}; notifications.sendEmail（消息，问题）; }}}，要求：{lastEmails：{名称：“与最新消息相关的电子邮件”，类型：实体。Field.stringType}，allEmails：{名称：“所有相关电子邮件”，类型：实体。Field.stringType}}}）;函数createGeneralMessage（issue）{var text = issue.comments.added.first（）。text; issue.attachments.added.forEach（function（attachment）{text = text +'\ n [file：'+ Attachment.name +']';}）;返回issue.wikify（text）.trim（）; }函数createInReplyToMessage（issue）{var messageText = createGeneralMessage（issue）; var addComments = issue.comments.added; var lastVisibleComment; issue.comments.forEach（function（comment）{if（！addComments.has（comment）&& comment.permittedGroups.isEmpty（）&& comment.permittedUsers.isEmpty（））{lastVisibleComment = comment; }}; var quotedText = lastVisibleComment吗？issue.wikify（lastVisibleComment.text）.trim（）：issue.wikify（issue.description）.trim（）;返回['<div style="font-family:sans-serif">'，'<div style="padding:10px 10px;font-size:13px;border-bottom:1px solid #d4d5d6">'，''+ messageText，'</div>'，'<blockquote type="cite">'，'<div style="font-size:13px;color:#888">'，''+工作流程.i18n（'回复：'）+'<br><br>'+ quotedText，'</div>'，'</blockquote>'，'<div style="margin:20px 0 20px 44px;padding:4px 0 8px 0;color:#888;font-size:11px;border-top:1px solid #d4d5d6">'，''+ workflow.i18n（'您已收到此消息，因为您是问题{0}中的对话的参与者。诚挚的，YouTrack”，issue.id），“</div>'，'</div>'] .join（'\ n'）; }函数createSubject（issue）{var reStr = working.i18n（'Re：'）; var summary = issue.summary;返回summary.startsWith（reStr）吗？摘要：reStr +''+摘要; }</div>    </div></div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Workflow-Kanban.html">看板</a> <a class="navigation-links__next" href="Workflow-Notify-Reporter-to-Approve-Fix.html">通知记者批准修复</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>