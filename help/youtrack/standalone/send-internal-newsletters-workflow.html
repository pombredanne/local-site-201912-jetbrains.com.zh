<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>发送内部通讯-帮助| YouTrack单机版</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="send-internal-newsletters-workflow" data-breadcrumbs="Administration.xml|Administration/Workflow-Guide.xml|Workflows/Workflow-Use-Cases.xml|Use Cases for Workflows/send-internal-newsletters-workflow.xml|Send Internal Newsletters" data-main-title="Send Internal Newsletters"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack独立帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="send-internal-newsletters-workflow.xml" data-toc="send-internal-newsletters-workflow">发送内部通讯</h1>  <p id="4a37e587">使用工作流发送新闻稿是一个不寻常的用例，但这是基于我们在JetBrains的实际工作流程。YouTrack团队的一位软件开发人员分析了运营团队的流程，并编写了支持其业务逻辑的工作流。这些团队包括我们的会计师，法律顾问和旅行协调员等。这些团队使用YouTrack来组织工作并与组织中的其他员工进行沟通。有时，要求开发人员以改变其日常工作的方式来修改这些工作流。在更新项目之前，她会向他们发送一个公告，以说明更改如何影响其流程。</p>  <p id="e6bf6417">使用YouTrack传递此信息的动机基于以下因素：</p>  <ul class="list _ul"><li class="list__item" id="228690d4"><p>受到更改影响的所有用户都是在YouTrack中分配给项目团队的成员组。</p></li><li class="list__item" id="7252d8f1"><p>每个用户的用户配置文件中都存储有一个注册的电子邮件地址。</p></li><li class="list__item" id="a822bbdf"><p>借助工作流程，YouTrack能够发送电子邮件。</p></li></ul>  <p id="f29cb584">这并不意味着您应该使用YouTrack将新闻通讯发送给外部用户，以代替您的电子邮件营销平台，但是它可以用作管理内部通讯的工具。定期对应用程序进行更改的YouTrack管理员和其他用户可以使用此技术向其他受其更改影响其工作的用户广播更新。</p>  <div class="chapter"><h2 id="create-send-newsletter" data-toc="send-internal-newsletters-workflow#create-send-newsletter">创建和发送新闻稿</h2>    <p id="7ed87d22">首先，从一个包含最少字段数的专用项目开始。在此示例中，我们使用<span class="control">State</span>和<span class="control">Recipients</span> 。<span class="control">收件人</span>是<code class="code">group</code>类型字段，用于存储多个值。当<span class="control">状态</span>变为“已<span class="control">发送”时</span> ，包含问题摘要和描述的电子邮件将发送到这些组的每个成员。</p>    <p id="4042748f">天真的方法是使用<code class="code">UserGroup.notify(subject, body)</code>方法。但是，这种解决方案不是最佳的。列表中属于多个组的人会收到几条相同的消息。这个例子使用<code class="code">notifications.sendMail(message, issue)</code>并明确计算列表中各组的并集（即，至少属于这些组之一的用户列表）。使用这种方法，每个收件人仅收到一条消息。时事通讯的作者是主要收件人，所有其他人都将收到一份复本。</p>    <p id="7fab4a6f">此方案中的第一个脚本从这些组中收集所有用户，以构建单个邮件列表。该脚本称为<code class="code">filter</code> ：</p>    <div class="code-block" data-lang="javascript">exports.getUniqueEmails =函数（组，firstEmail）{var userEmails = [firstEmail]; groups.forEach（function（group）{group.users.forEach（function（user）{var email = user.email; if（email && userEmails.indexOf（email）<0）{{userEmails.push（email）;}}） ）}）;返回userEmails; };</div>    <p id="3388ca87">第二个实用程序脚本包含准备要发送的消息的功能。它的名字是<code class="code">composer</code> ：</p>    <div class="code-block" data-lang="javascript">Exports.composeMessage =函数（问题，电子邮件）{var subject = issue.summary; var body = issue.wikify（issue.description）; var link =' <a href="' + issue.url + '">'+ issue.id +'</a> '; var footer ='<div style="color:#777777">'+'此新闻通讯由YouTrack传递。您可以随时在“ +链接+”中找到本新闻的内容“ +”。'+'</div>';返回{fromName：issue.reporter.fullName，toEmails：电子邮件，主题：主题，正文：正文+页脚}; };</div>    <p id="f8c0a6f2">现在，有了这两个小实用程序，编写一个规则，当<span class="control">State</span>更改为<span class="control">Sent</span>时发送一条电子邮件：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var notifications = require（'@ jetbrains / youtrack-scripting-api / notifications'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; var composer = require（'./ composer'）; var filter = require（'./ filter'）; Exports.rule =实体。Issue.onChange（{title：'发送电子邮件给收件人'，guard：function（ctx）{var issue = ctx.issue;返回issue.isReported && issue.fields.becomes（ctx。状态，ctx。州。已发送）； }，动作：function（ctx）{var issue = ctx.issue;工作流程。检查（issue.reporter.login === ctx.currentUser.login，'仅'+ issue.reporter.fullName +'可以发送此新闻通讯！'）; var emails = filter.getUniqueEmails（issue.fields。收件人，issue.reporter.email）； var message = composer.composeMessage（issue，emails）; notifications.sendEmail（消息，问题）;问题域。Recipients.forEach（function（group）{issue.permittedGroups.add（group）;}）; var newComment = issue.addComment（'通讯已发送至'+ emails.length +'收件人。'）; newComment.permittedUsers.add（issue.reporter）; }，要求：{州：{类型：实体。State.fieldType，已发送：{}}，收件人：{类型：实体。UserGroup.fieldType，多：true}}}）;</div>  </div>  <div class="chapter"><h2 id="set-up-a-safety-net" data-toc="send-internal-newsletters-workflow#set-up-a-safety-net">设置安全网</h2>    <p id="e375f698">最好小心并以安全的方式编写工作流程。以下是一些操作规则，可让您在发送时事通讯之前检查工作。第一个操作规则可帮助您确保将电子邮件发送给合适的人：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var filter = require（'./ filter'）; Exports.rule =实体。Issue.action（{标题：“将所有电子邮件转储为私人评论”，命令：“ newsletter-dump-emails”，警卫队：function（ctx）{return ctx.issue.isReported && ctx.issue.reporter.login == = ctx.currentUser.login;}，操作：function（ctx）{var issue = ctx.issue; var emails = filter.getUniqueEmails（issue.fields。收件人，issue.reporter.email）； var text ='通讯将被发送到'+ emails.length +'收件人：\ n \ n'+'```\ n'; emails.forEach（function（email）{text + = email +'\ n';}）;文字+ ='```\ n'; var newComment = issue.addComment（text）; newComment.permittedUsers.add（issue.reporter）; }，要求：{收件人：{类型：实体。UserGroup.fieldType，多：true}}}）;</div>    <p id="148e16d9">第二个操作规则将消息的副本发送到问题报告者，以便您可以预览内容：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var notifications = require（'@ jetbrains / youtrack-scripting-api / notifications'）; var composer = require（'./ composer'）; Exports.rule =实体。Issue.action（{标题：“发送测试电子邮件（仅向记者发送）”，命令：“ newsletter-test-email”，警卫：function（ctx）{return ctx.issue.isReported && ctx.issue.reporter.login === ctx.currentUser.login;}，操作：function（ctx）{var issue = ctx.issue; var emails = [issue.reporter.email]; var message = composer.composeMessage（issue，emails）;通知。 sendEmail（message，issue）;}}）;</div>    <p id="a2e5e428">也可以私下撰写新闻通讯，并确保其他用户在您的作品发布到电子邮件中之前不会看到您的作品。以下规则将问题的可见性限制为其报告者：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; Exports.rule =实体。Issue.onChange（{标题：“在提交时将“可见”用户设置为用户“，警卫：function（ctx）{return ctx.issue.becomesReported;}，操作：function（ctx）{ctx.issue.permittedUsers.add（ctx .issue.reporter）;}}）;</div>    <p id="74dc5be5">以下是您可能会考虑的一些增强功能：</p>    <ul class="list _ul"><li class="list__item" id="117dafc8"><p>使新问题对可以在新闻通讯上进行协作的一组用户可见。</p></li><li class="list__item" id="2cba214f"><p>基于存储日期和时间的字段中存储的值安排交货。</p></li><li class="list__item" id="1a147b65"><p>如果您每月或每季度发送一次内部新闻通讯，则按固定的时间表生成问题，包括内容模板和预定义的发送日期。</p></li></ul>  </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="enhance-helpdesk-support-workflows.html">增强Helpdesk支持</a> <a class="navigation-links__next" href="Web-based-Workflow-Editor.html">基于Web的工作流程编辑器</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>