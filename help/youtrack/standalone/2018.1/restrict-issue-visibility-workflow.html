<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><meta name="robots" content="noindex"><title>Restrict Issue Visibility with Workflows - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="restrict-issue-visibility-workflow"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="restrict-issue-visibility-workflow" id="restrict-issue-visibility-workflow.xml">Restrict Issue Visibility with Workflows</h1>    <p id="09c9e8ee">You can use the permission scheme in YouTrack to restrict read access to issues in YouTrack.        Users who have <span class="control">Create Issue</span> permission but not <span class="control">Read Issue</span> permission in a project can only see the issues they create themselves.        However, this setup is very binary.        Users can either read and update only the issues that they reported themselves, or access all of the issues in the project. In real life, the situation is usually much more complex.        What happens when you want some people to read and update some issues — not just the issues they created, but also those which are shared with them somehow?</p>    <p id="bed9d950">To support this use case, you can grant reporters the <span class="control">Read Issue</span> permission and use a workflow to automatically restrict issue visibility to a group that excludes other reporters.        The following workflow rule restricts issue visibility as soon as an issue is reported.</p>    <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Set &quot;Visible to&quot; group on submit&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">becomesReported</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">permittedGroups</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">viewers</span><span class="p">);</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">&#39;Users from group &quot;&#39;</span> <span class="o">+</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">viewers</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span>
                     <span class="s1">&#39;&quot; can see this request.&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">viewers</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">UserGroup</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>  <p id="67e21c0a">Each issue is visible to its reporter and any member of the <code class="code" data-lang="Java">Viewers</code> group.    However, the reporter or any member of the <code class="code" data-lang="Java">Viewers</code> group can “share” the issue with any other users who have the <span class="control">Read Issue</span> permission in the project.      To share the issue, the user selects another user from the <span class="control">Visible to</span> list.</p>        <p id="b55c80dc">There are a number of other ways you can use workflows to manage visibility.          You might consider adding one or more of the following rules to increase the flexibility of the entire scheme.</p>      <div class="chapter"><h2 id="add-mentioned-users" data-toc="restrict-issue-visibility-workflow#add-mentioned-users">Add Mentioned Users</h2>        <p id="718a0f55">This rule automatically adds users to the <span class="control">Visible to</span> list when they are @mentionedin a comment.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">loginRegex</span> <span class="o">=</span> <span class="sr">/@(([A-Z0-9._@$+\-=|])*)/gi</span><span class="p">;</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Automatically add users to the &quot;visible to&quot; list&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">added</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
      <span class="p">(</span><span class="nx">issue</span><span class="p">.</span><span class="nx">permittedGroups</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">()</span> <span class="o">||</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">permittedUsers</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">());</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">issue</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">added</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">comment</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">text</span> <span class="o">+=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">text</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">loginRegex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">matches</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">login</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">login</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">findByLogin</span><span class="p">(</span><span class="nx">login</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">issue</span><span class="p">.</span><span class="nx">permittedUsers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
            <span class="nx">message</span> <span class="o">+=</span> <span class="s1">&#39;User &quot;&#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">fullName</span> <span class="o">+</span>
                       <span class="s1">&#39;&quot; is added to issue readers. &#39;</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">message</span> <span class="o">+=</span> <span class="s1">&#39;User with login &quot;&#39;</span> <span class="o">+</span> <span class="nx">login</span> <span class="o">+</span> <span class="s1">&#39;&quot; not found. &#39;</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">workflow</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span></code></div>      </div>      <div class="chapter"><h2 id="block-visibility-updates-reported-issues" data-toc="restrict-issue-visibility-workflow#block-visibility-updates-reported-issues">Block Updates to Visibility Settings</h2>        <p id="c88b65ac">This rule blocks changes to the <span class="control">Visible to</span> setting for issues that have been reported.        This prevents unwanted changes to visibility settings for issues that contain sensitive data.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="c1">// This rule assumes that issue visibility is set to a specific group</span>
<span class="c1">// at the moment when an issue becomes reported.</span>
<span class="c1">// Each project has its own visibility group.</span>

<span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Block changes to visibility group for reported issues&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">isReported</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">issue</span><span class="p">.</span><span class="nx">becomesReported</span> <span class="o">&amp;&amp;</span>
      <span class="nx">issue</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="s1">&#39;permittedGroups&#39;</span><span class="p">);</span>
    <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span>
      <span class="s1">&#39;You cannot change group visibility restrictions for reported issues. &#39;</span> <span class="o">+</span>
      <span class="s1">&#39;Instead, you can add single users to the &quot;visible to&quot; list.&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span></code></div>      </div><div class="chapter"><h2 id="block-removing-other-users" data-toc="restrict-issue-visibility-workflow#block-removing-other-users">Block Users from Removing Other Users</h2>      <p id="a79e569d">This rule prevents users from removing other users from the <span class="control">Visible to</span> list.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Do not remove users from &quot;visible to&quot; list&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">permittedUsers</span><span class="p">.</span><span class="nx">removed</span><span class="p">.</span><span class="nx">isNotEmpty</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span>
      <span class="s1">&#39;You cannot remove other users from the &quot;visible to&quot; list.&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">});</span></code></div></div>      <div class="chapter"><h2 id="field-based-visibility" data-toc="restrict-issue-visibility-workflow#field-based-visibility">Update Visibility on Assignment</h2>      <p id="91df7b5b">This rule automatically add users to the <span class="control">Visible to</span> list when they are selected in a custom field that stores a user type (for example, Authorizer or Verifier).</p>      <p id="435cd6ed">You can also use a modified version of this rule to hide sensitive issues from other members of the project team.      For example, your company does not want accountants to see payment requests that are processed by other accountants.        Here, you could add users to the <span class="control">Visible to</span> list when they are set as the assignee.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Add Authorizer to the &quot;visible to&quot; list&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="nx">issue</span><span class="p">.</span><span class="nx">permittedUsers</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">);</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">&#39;The issue is now visible to &#39;</span> <span class="o">+</span>
                      <span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">.</span><span class="nx">fullName</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AuthBy</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorizer&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>      </div><div class="last-modified" data-skip-index="skip">Last modified: 7 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Workflow-Use-Cases.html">Use Cases for Workflows</a><a class="navigation-links__next" href="prevent-unwanted-updates-workflows.html">Prevent Unwanted Updates</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>