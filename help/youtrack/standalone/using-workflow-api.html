<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>使用工作流程API-帮助|帮助YouTrack单机版</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="using-workflow-api" data-breadcrumbs="Administration.xml|Administration/Workflow-Guide.xml|Workflows/Workflows-in-JavaScript.xml|JavaScript Workflow Reference/using-workflow-api.xml|Using the Workflow API" data-main-title="Using the Workflow API"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索YouTrack独立帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="using-workflow-api.xml" data-toc="using-workflow-api">使用工作流程API</h1>  <p id="3550ff36">使用此页面上的信息来学习如何使用工作流API中未在工作流参考的其他部分中描述的特定实体。</p>  <div class="chapter"><h2 id="access-properties-custom-fields-issue-links" data-toc="using-workflow-api#access-properties-custom-fields-issue-links">访问属性，自定义字段和问题链接</h2>    <p id="155894e1">请遵循以下准则来访问问题属性，自定义字段中的值以及问题链接。</p>    <p id="78bafc5c">预定义的问题字段，例如<code class="code">summary</code> ， <code class="code">description</code>和<code class="code">reporter</code>是所有的属性<code class="code">issue</code>实体。</p>    <div class="code-block" data-lang="javascript">var summary = issue.summary; issue.summary =“只是一个错误”;</div>    <p id="6edac103">自定义字段中对值的引用会根据该字段存储单个值还是多个值而有所不同。</p>    <ul class="list _ul"><li class="list__item" id="62f70ef8"><p>对于存储单个值的字段，您可以直接引用该值：</p><div class="code-block" data-lang="javascript">var state = issue.fields。州;问题域。状态= ctx。州。打开;如果（issue.fields。State.name === ctx。州。Fixed.name）{//做事}</div>      <p></p></li><li class="list__item" id="6deb0d2a"><p>对于存储多个值的字段，这些值将作为一组存储。下一部分将详细介绍可用于集合的操作。</p><div class="code-block" data-lang="javascript">var版本= issue.fields [“修复版本”];版本.forEach（功能（v）{subtask.fields [“修复版本”] .add（v）;}）;</div>      <p></p></li></ul>    <p id="4f9de07b">如果您设置<code class="code">alias</code>的自定义字段的属性<code class="code">requirements</code>语句，您也可以使用该别名访问该字段的值。例如，如果“ <span class="control">修订版本”</span>字段的别名设置为<code class="code">FV</code> ：</p>    <div class="code-block" data-lang="javascript">问题域。FV.forEach（function（v）{//做事}）;</div><p id="db4369ba">通过其向内或向外名称访问问题链接类型。例如， <code class="code">relates to</code>要么<code class="code">parent for</code> 。问题链接始终被视为一组。</p>    <div class="code-block" data-lang="javascript">var parent = issue.links [“ subtask of”]。first（）; parent.links [“ parent for”]。add（issue）;</div>    <p id="74005982">请注意，必须在引号和括号中设置包含空格或其他非字母字符的自定义字段和问题链接类型。</p>  </div>  <div class="chapter"><h2 id="work-with-set-objects" data-toc="using-workflow-api#work-with-set-objects">使用集合对象</h2>    <p id="8afc5ef4">您可以对多个值（返回为Set <value type="">）</value>执行几组操作<value type="">：</value></p>    <ul class="list _ul"><li class="list__item" id="eed2bbd4"><p>直接访问它们（ <code class="code">first()</code> ， <code class="code">last()</code> ， <code class="code">get(index)</code> ）或通过迭代器（ <code class="code">entries()</code> ， <code class="code">values()</code> ）。</p></li><li class="list__item" id="4fec22e6"><p>遍历Set with中的所有值<code class="code">forEach(visitor)</code> 。</p></li><li class="list__item" id="1e7dd9e9"><p>寻找价值<code class="code">find(predicate)</code>并检查一个值是否在Set with中<code class="code">has(value)</code> 。</p></li><li class="list__item" id="ca927fde"><p>检查尺寸<code class="code">isEmpty()</code> ， <code class="code">isNotEmpty()</code>和<code class="code">size</code>属性。</p></li><li class="list__item" id="5270e3d2"><p>修改内容<code class="code">add(element)</code> ， <code class="code">remove(element)</code>和<code class="code">clear()</code> 。</p></li><li class="list__item" id="ca829fb7"><p>使用来获取<span class="control">Set</span>对象的当前更改。 <code class="code">added</code> ， <code class="code">removed</code>和<code class="code">isChanged</code>属性。</p></li></ul>    <p id="6692b9b9">有关此对象的详细说明，请参见<a href="v1-Set.html">Set</a> 。</p>  </div>  <div class="chapter"><h2 id="calling-methods" data-toc="using-workflow-api#calling-methods">呼叫方式</h2>    <div class="code-block" data-lang="javascript">//调用实体方法：var stateCF = issue.project.findFieldByName（'State'）; //调用静态方法：var p =实体。Project.findByKey（'INT'）; //调用问题构造函数：var newIssue =新实体。Issue（ctx.currentUser，issue.project，“子任务”）;</div>  </div>  <div class="chapter"><h2 id="find-specific-entities" data-toc="using-workflow-api#find-specific-entities">查找特定实体</h2>    <p id="d6617b74">有两种找到特定实体（例如问题或用户）并在工作流脚本中使用的方法：</p>    <ol class="list _decimal"><li class="list__item" id="5634409c"><p>在<a href="requirements.html">需求中</a>添加它，并在<a href="context.html">上下文中</a>引用它。尽可能频繁地使用此方法，因为它是最可靠的。如果在数据库中找不到指定的实体，则不会执行该脚本。</p></li><li class="list__item" id="304cc86a"><p>如果第一个选项由于某种原因不适用，请使用<code class="code">findBy*</code>和<code class="code">find*By*</code>工作流程API中的方法：</p></li></ol>    <p id="f07b468a">使用<code class="code">findBy*</code>查找特定实体的单个出现的方法：</p>    <div class="code-block" data-lang="javascript">var issue =实体。Issue.findById（'MP-23'）; //一个实体。发出或为null var projectByName =实体。Project.findByName（'音乐制作'）; //一个实体。Project或null var projectByKey =实体。Project.findByKey（'MP'）; //一个实体。项目或null var user =实体。User.findByLogin（'jane.smith'）; //一个实体。User或null var userGroup =实体。UserGroup.findByName（'MP team'）; //一个实体。UserGroup或null var agiles =实体。Agile.findByName（'MP Scrum'）; //一组实体。敏捷var标签=实体。IssueTag.findByName（'production'）; // Set od实体。IssueTag var查询=实体。SavedQuery.findByName（'MP Backlog'）; //一组实体。保存查询</div>    <p id="22ab2fc3">使用<code class="code">find*By*</code>查找子实体的方法：</p>    <div class="code-block" data-lang="javascript">var sprint = agiles.first（）。findSprintByName（'Sprint 23'）; //一个实体。Sprint或null var priorityField = projectByKey.findFieldByName（'Priority'）; //一个实体。ProjectCustomField或null var major = field.findValueByName（'Major'）; //一个实体。字段或null var关键= field.findValueByOrdinal（1）; //一个实体。字段或null var AssigneeField = projectByKey.findFieldByName（'Assignee'）; var jane = AssigneeField.findValueByLogin（'jane.smith'）; //一个实体。用户或null var groupField = projectByKey.findFieldByName（'Requestors'）; var newBand = groupField.findValueByName（'New Band'）; //一个实体。UserGroup或null</div>  </div>  <div class="chapter"><h2 id="find-multiple-issues" data-toc="using-workflow-api#find-multiple-issues">寻找多个问题</h2>    <p id="283bfc1d">有时，您可能希望查找一组符合特定条件的问题，并在单个规则的范围内对其进行处理。例如，您可以编译问题列表并将其作为电子邮件发送。在这些情况下， <a href="v1-search.html">搜索</a> API可以提供帮助。这是一个简单的例子：</p>    <div class="code-block" data-lang="javascript">var实体= require（'@ jetbrains / youtrack-scripting-api / entities'）; var search = require（'@ jetbrains / youtrack-scripting-api / search'）; var工作流程= require（'@ jetbrains / youtrack-scripting-api / workflow'）; Exports.rule =实体。Issue.onChange（{标题：“不允许开发人员在每个项目中进行的问题超过1个。”，操作：function（ctx）{var issue = ctx.issue; if（issue.isReported &&（issue.fields.becomes （ctx。状态，ctx。状态['进行中']）|| issue.fields.isChanged（ctx。受让人））&&（issue.fields。受让人|| {}）。login === ctx.currentUser.login）{//首先，我们建立一个搜索查询，检查该问题所属的项目，并返回分配给当前用户的所有问题//除外问题。var query ='for：me状态：{In Progress} issue id：-'+ issue.id; var inProgress = search.search（issue.project，query，ctx.currentUser）; //如果发现任何问题，我们将得到第一个问题并警告用户。如果（inProgress.isNotEmpty（））{var otherIssue = inProgress.first（）; var message ='Dear'+ ctx.currentUser.login +'，请先关闭<a href="' +          otherIssue.url + '">'+ otherIssue.id +'</a> ！';工作流程。检查（假，消息）; }}}，要求：{州：{类型：实体。State.fieldType，“进行中”：{}}，受让人：{类型：实体。User.fieldType}}}）;</div>  </div>  <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__next" href="Slack-Integration-HTML.html">使用Slack构建</a> <a class="navigation-links__prev" href="requirements.html">需求</a> <a class="navigation-links__next" href="Slack-Integration-HTML.html">集成</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>