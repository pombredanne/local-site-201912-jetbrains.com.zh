<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><meta name="robots" content="noindex"><title>JavaScript Workflow Quick Start Guide - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Quick-Start-Guide-Workflows-JS"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Quick-Start-Guide-Workflows-JS" id="Quick-Start-Guide-Workflows-JS.xml">JavaScript Workflow Quick Start Guide</h1>    <p id="0b76010a">This Quick Start Guide explains the basic concepts you need to start working with workflows in JavaScript.</p>    <ul class="list _ul"><li class="list__item" id="ea4d23f3"><p>If you want to skip the warm-up, you can <a href="YouTrack-Api-Documentation.html">dive right into the API</a>.</p></li><li class="list__item" id="4783462a"><p>If you have never worked with workflows in YouTrack, start with <a href="Workflow-Guide.html"><span>Workflows</span></a> for more background information.</p></li></ul>    <div class="chapter"><h2 id="workflow-permissions" data-toc="Quick-Start-Guide-Workflows-JS#workflow-permissions">Permissions</h2>      <p id="c2dc8fc1">Before you start, make sure you have permission to create and edit workflows.</p>      <ul class="list _ul"><li class="list__item" id="d7ced4e9"><p>Users with <span class="control">Read Project</span> and <span class="control">Update Project</span> permissions can create their own workflows and attach them to their projects.</p></li><li class="list__item" id="7c06dc0e"><p>Users with the <span class="control">Low-level Administration</span> permission can create workflows and attach them to any project.</p></li></ul>      <p id="c5512ea5">The controls for creating workflows are only available on the <span class="control">Workflows</span> page, which is accessible in the <span class="control">Project-related</span> settings section of the <span class="control">Administration</span> menu.</p>    </div>  <div class="chapter"><h2 id="create-workflow-quick-start" data-toc="Quick-Start-Guide-Workflows-JS#create-workflow-quick-start">Create a Workflow</h2>    <p id="a0b49b65">The workflow itself is just a container. You can use a workflow to collect a set of rules that you want to apply in your project.</p>    <p id="4a1b150d">You build workflows to enforce specific business logic, so it's a good idea to sit down and map out your use case before you start.</p>    <p id="4697d8c3">For this guide, put yourself in the shoes of a project manager.      You've just added a field to your project that you want to use to group issues so you can report your progress to your boss.    You created a field with the name <span class="control">Phase</span> and added the values <span class="control">Development</span>, <span class="control">Testing</span>, and <span class="control">Ready</span>.      Basically, your boss just needs to see how many issues you still have in development or testing to measure your progress against the roadmap.</p>    <p id="9678dedd">Now you need to create a workflow that sets the values for this field based on other changes that are applied to the issues in the project.    You want to set the values for this field automatically, so your project team doesn't have to worry about setting the value themselves.</p>    <section class="procedure-steps"><h2 id="3ce5b885">To create a workflow:</h2><ol class="list _decimal"><li class="list__item" id="48e727d5"><p>From the <span class="control">Core Features</span> section of the <span class="control">Administration</span> menu, select <span class="control">Workflows</span>.</p></li><li class="list__item" id="c45f19b1">Click the <span class="control">Create workflow</span> button.        <ul class="list _ul"><li class="list__item" id="f5bf113f"><p>The <span class="control">New Workflow</span> dialog opens.</p></li></ul>        <figure><a class="lightbox" href="/help/img/youtrack/2018.3/new-workflow-dialog-js.zoomed.png"><img alt="New workflow dialog js" title="New workflow dialog js" src="/help/img/youtrack/2018.3/new-workflow-dialog-js.png" id="75b320ca" width="600" height="258"></a></figure></li><li class="list__item" id="8ea38577">In the <span class="control">New Workflow</span> dialog, enter a name and an optional title.        The workflow name follows the standard naming conventions for npm packages. For more information, see <a href="https://docs.npmjs.com/files/package.json#name" data-external="true" target="_blank" rel="noopener noreferrer"><span>https://docs.npmjs.com/files/package.json#name</span></a>.        <p id="67326534">For this guide, use <span class="control">phase-management</span> as the name and <span class="control">Phase Management</span> as the title.</p></li><li class="list__item" id="ffef9557">Click the <span class="control">Save</span> button.        <ul class="list _ul"><li class="list__item" id="36deba69"><p>Your new workflow is added to the list.</p></li></ul></li></ol></section>  </div>  <div class="chapter"><h2 id="add-module-quick-start" data-toc="Quick-Start-Guide-Workflows-JS#add-module-quick-start">Add a Module to Your Workflow</h2>    <p id="18117b53">So that was simple enough, but you're just getting started.    You now have a container where you can store your scripts.    You add scripts to your workflow in modules that can contain different types of rules or custom scripts.</p>    <p id="26b523ea">The first action that you want to automate in this project is to clear the value of the <span class="control">Phase</span> field when the team decides to postpone a task and move it to the product backlog.      When the team postpones a task, they change the value of the <span class="control">Fix version</span> field to <span class="control">Backlog</span>.</p>    <p id="bb39ed4f">This action takes place when a change is applied to an issue, so you want to add a module to the workflow that contains an on-change rule.</p>    <section class="procedure-steps"><h2 id="5771a64f">To add a module to the workflow:</h2><ol class="list _decimal"><li class="list__item" id="ca71afbb"><p>Locate the new workflow in the list.</p></li><li class="list__item" id="9b51af4d">Click the workflow name to access the workflow editor.        <ul class="list _ul"><li class="list__item" id="854c9461"><p>The workflow opens in the workflow editor.</p></li><li class="list__item" id="a44bd202"><p>The <span class="control">New Module</span> panel opens in the editor window.</p></li><li class="list__item" id="e70b5e62"><p>Now, you can add a rule to the workflow using a template.</p></li></ul>        <figure><a class="lightbox" href="/help/img/youtrack/2018.3/workflow-open-rule.zoomed.png"><img alt="Workflow open rule" title="Workflow open rule" src="/help/img/youtrack/2018.3/workflow-open-rule.png" id="7db2abcf" width="600" height="267"></a></figure>      </li><li class="list__item" id="92f9b801">In the <span class="control">New Module</span> panel, click the <span class="control">On-change</span> button.        <ul class="list _ul"><li class="list__item" id="63a5f324"><p>The <span class="control">New Module</span> dialog opens.</p></li></ul>      </li><li class="list__item" id="152aaf07">Enter a name for the module, like <code class="code" data-lang="Java">clear-phase-when-postponed</code>, then click the <span class="control">Save</span> button.        <ul class="list _ul"><li class="list__item" id="fb37d113"><p>The new module is added to the workflow.</p></li><li class="list__item" id="e9ba712d"><p>The module name is displayed as a link.</p></li><li class="list__item" id="04be7957"><p>The template for an on-change rule loads in the editor.</p></li></ul>        <figure><a class="lightbox" href="/help/img/youtrack/2018.3/new-module-on-change.zoomed.png"><img alt="New module on change" title="New module on change" src="/help/img/youtrack/2018.3/new-module-on-change.png" id="a179a531" width="600" height="272"></a></figure>      </li></ol></section>  </div>  <div class="chapter"><h2 id="write-first-rule-quick-start" data-toc="Quick-Start-Guide-Workflows-JS#write-first-rule-quick-start">Write Your First Rule</h2>    <p id="ada441d2">Now you're ready to write your first simple rule.      The best way to proceed is to move from one <code class="code" data-lang="Java">TODO</code> comment in the template to the next, updating the code line by line and removing any unnecessary comments as you go.</p>    <section class="procedure-steps"><h2 id="960b1b29">To write your first rule:</h2><ol class="list _decimal"><li class="list__item" id="d7d5a012">Start with the first comment block in the template:        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="cm">/**</span>
<span class="cm">* This is a template for an on-change rule. This rule defines what</span>
<span class="cm">* happens when a change is applied to an issue.</span>
<span class="cm">*</span>
<span class="cm">* For details, read the Quick Start Guide:</span>
<span class="cm">* https://www.jetbrains.com/help/youtrack/standalone/2017.4/Quick-Start-Guide-Workflows-JS.html</span>
<span class="cm">*/</span></code></div>        <p id="4ba532bb">Aside from showing you how to add comment blocks to your modules, this comment tells you what type of rule is defined in this template and points you to this quick start guide.          Since you're already here and you know what this type of rule does, go ahead and delete the whole block.</p>      </li><li class="list__item" id="bd1ea72a">Check out the first line of code:        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span></code></div>        <p id="5bd64c70">This variable declaration references the <code class="code" data-lang="Java">entities</code> module in the workflow API.          This means that all of the properties and methods that are contained in the <code class="code" data-lang="Java">entities</code> module can be accessed in this rule.</p>        <p id="a7f0c3e8">If there are properties and methods that belong to other modules, for example, the <code class="code" data-lang="Java">workflow</code> module, just add a <code class="code" data-lang="Java">require</code> statement and point to the module you want to reference, like this:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span></code></div>        <p id="f7fc695e">The most important point here is that you need to be familiar with the workflow API and know which modules contain the properties and methods that you need for your workflows.          For this rule, you only want to update the value in a custom field. Issues and their custom fields are all accessible from the <code class="code" data-lang="Java">entities</code> module, so you can keep the <code class="code" data-lang="Java">require</code> statement that is built into the template.</p>      </li><li class="list__item" id="262afa28">Set the <code class="code" data-lang="Java">exports.rule</code> property.        <p id="997173f5">A script can export exactly one rule to this property.          In the template, this property is set with the <code class="code" data-lang="Java">entities.Issue.onChange</code> method.          This method declares a rule that is triggered when a change is applied to an issue, so you're all set.          You already determined that this script will be handled as an on-change rule when you loaded the template.</p></li><li class="list__item" id="c6d8ca45">Set a value for the <code class="code" data-lang="Java">title</code> property.        <p id="36e45597">For an on-change rule, this property is optional.          You can already see that the value you used for the module name has been copied to the title.          You want the title to be user friendly and help other users recognize what this rule does.          For this example, change the title to <code class="code" data-lang="Java">Clear Phase when Fix version is set to Backlog</code>.</p>        <p id="de001f6d">After you set the title, remove the <code class="code" data-lang="Java">TODO</code> on the line that precedes it.</p></li><li class="list__item" id="00abdc1a">Write a <code class="code" data-lang="Java">guard</code> condition        <p id="e16e2477">This is where you actually start to code.          With the <code class="code" data-lang="Java">guard</code> property, you define the conditions that must be met for the rule to be applied.</p>        <p id="36ac5ec0">The template has already declared the guard as a function that accepts a context as an argument:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span></code></div>        <p id="73ac9320">This simply means that the all of the code that is defined for the <code class="code" data-lang="Java">guard</code> property is treated as a function.        For the action that follows to be executed, this function must return a value that evaluates to <code class="code" data-lang="Java">true</code>.</p>        <p id="ea4f7797">You want this rule to apply an action only when a user changes the value of the <span class="control">Fix version</span> field to <span class="control">Backlog</span>.        The following guard returns <code class="code" data-lang="Java">true</code> when this change is applied to an issue:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">FixVersion</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">FixVersion</span><span class="p">.</span><span class="nx">Backlog</span><span class="p">);</span></code></div>        <p id="8e799634">You can paste this guard over the <code class="code" data-lang="Java">TODO</code> inside the guard property.</p>      </li><li class="list__item" id="fb8d5448">Set an <code class="code" data-lang="Java">action</code>.        <p id="0d0b97d1">With the <code class="code" data-lang="Java">action</code> property, you define the changes that are applied when the guard condition is met.</p>        <p id="3a7ed07d">You can see that the template has already declared the action as a function that accepts a context as an argument:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span></code></div>        <p id="192c65bf">It then declares a local variable <code class="code" data-lang="Java">issue</code> and sets the value to reference an issue in context:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span></code></div>         <p id="28610d33">You'll want to use a variable declaration for complex rules that update multiple issue properties, but for a rule this simple, you don't need it.        All you need to do is specify the action that you want to apply when the guard condition is met, which is to clear the value in the <span class="control">Phase</span> field:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></code></div>        <p id="055d9e3e">You can copy this block of code and paste it on top of the unnecessary variable declaration and remove the next <code class="code" data-lang="Java">TODO</code>.</p>        <p id="25c81029">You'll notice that the template closes the body of the function with a right brace and separates this block from the next property with a comma(<code class="code" data-lang="Java">},</code>).</p>      </li><li class="list__item" id="1756feb1">Add <code class="code" data-lang="Java">requirements</code>.        <p id="8ac3a650">The <code class="code" data-lang="Java">requirements</code> property lists all of the components that this rule needs to run properly.          This includes definitions for custom fields, issue link types, projects, saved searches, and so on.        To learn more about requirements, see <a href="requirements.html"><span>Requirements</span></a>.</p>        <p id="4c37a268">For your rule, you need to define the requirements for two custom fields: <span class="control">Fix version</span> and <span class="control">Phase</span>.</p>        <p id="bfa3c2c4">First, define that the <span class="control">Fix version</span> field stores data as a <code class="code" data-lang="Java">ProjectVersion</code> type, then specify that the field must include <code class="code" data-lang="Java">Backlog</code> in the set of values.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">FixVersion</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">ProjectVersion</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Fix version&quot;</span><span class="p">,</span>
  <span class="nx">Backlog</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">},</span></code></div>        <p id="bd4af644">First, you'll notice that <code class="code" data-lang="Java">FixVersion</code> is not the actual name of the custom field.        This is an alias.        Use an alias for custom names that contain spaces and other non-alpha characters, as it saves you from having to set these values in quotes and brackets.        The actual name of the custom field is specified in the <code class="code" data-lang="Java">name</code> property.        The final property for the <code class="code" data-lang="Java">FixVersion</code> specifies that the custom field must contain the value <code class="code" data-lang="Java">Backlog</code>.</p>        <p id="de57f4d3">Then, set the requirements for the <span class="control">Phase</span> field.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">Phase</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
<span class="p">}</span></code></div>        <p id="d61249f0">Here, all you need to do is require that the field exists and stores an <code class="code" data-lang="Java">EnumField</code>.        You don't need to require any values for this field, as the rule sets the value to <code class="code" data-lang="Java">null</code>.</p>        <p id="725c96cf">Copy these blocks of code and paste them on top of the last <code class="code" data-lang="Java">TODO</code> comment.</p>      </li><li class="list__item" id="429d9802"><p>Click the <span class="control">Save</span> button to store your changes.</p></li><li class="list__item" id="f468dfae"><p>Open the <span class="control">More actions</span> menu in the workflow editor and select <span class="control">Reformat code</span>.      Your finished workflow should look like this:      <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Clear Phase when Fix version is set to Backlog&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">FixVersion</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">FixVersion</span><span class="p">.</span><span class="nx">Backlog</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">FixVersion</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">ProjectVersion</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Fix version&quot;</span><span class="p">,</span>
      <span class="nx">Backlog</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nx">Phase</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>      </p></li></ol></section>  </div>  <div class="chapter"><h2 id="write-another-rule-quick-start" data-toc="Quick-Start-Guide-Workflows-JS#write-another-rule-quick-start">Then Write Another!</h2>    <p id="4b9e166b">That was easy enough. Have another go at it.    Just remember what you learned from your first rule and add a second module to your workflow.</p>    <p id="78ef6fa8">The next action that you want to automate is to set the value of the <span class="control">Phase</span> field when a change is applied to the <span class="control">State</span> field.      This action also takes place when a change is applied to an issue, so you want to add another on-change rule.</p>    <section class="procedure-steps"><h2 id="fa60fd90">To add another module and define a second rule:</h2><ol class="list _decimal"><li class="list__item" id="17369393"><p>In the sidebar for your <code class="code" data-lang="Java">phase-management</code> workflow, click the <span class="control">Add module</span> icon and select <span class="control">On-change</span>.</p></li><li class="list__item" id="8468f2aa">In the <span class="control">New Module</span> dialog, enter <code class="code" data-lang="Java">sync-phase-with-state</code>, then click the <span class="control">Save</span> button.        <ul class="list _ul"><li class="list__item" id="a73874cc"><p>The template for a new on-change rule loads in the editor.</p></li></ul>      </li><li class="list__item" id="c0d9a379"><p>Delete the comment block.</p></li><li class="list__item" id="e94bee82"><p>Leave the <code class="code" data-lang="Java">require</code> declaration for the <code class="code" data-lang="Java">entities</code> variable as is.</p></li><li class="list__item" id="02b0f642"><p>Leave definition for the <code class="code" data-lang="Java">exports.rule</code> property alone as well.</p></li><li class="list__item" id="6b498e73"><p>Set the value for the <code class="code" data-lang="Java">title</code> property to <code class="code" data-lang="Java">Set value for Phase when State changes</code> and remove the <code class="code" data-lang="Java">TODO</code> that precedes it.</p></li><li class="list__item" id="d2de662a"><p>Replace the next <code class="code" data-lang="Java">TODO</code> with a definition for the <code class="code" data-lang="Java">guard</code> property.      The following guard returns <code class="code" data-lang="Java">true</code> when a user changes the value of the <span class="control">State</span> field:      <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">);</span>
<span class="p">},</span></code></div>      </p></li><li class="list__item" id="01dc2833">Set the <code class="code" data-lang="Java">action</code> property.        <p id="cd220d84">This time around, you'll keep the variable declaration.          This helps you reference all of the properties and methods for the <code class="code" data-lang="Java">issue</code> object in the <code class="code" data-lang="Java">entities</code> module in context without having to use the explicit reference <code class="code" data-lang="Java">entities.issue</code>.          To learn more about context, see <a href="context.html"><span>Context</span></a>.</p>        <p id="58f9fb8f">However, because this rule only needs to update a custom field, you can change the context variable declaration to reference the <code class="code" data-lang="Java">fields</code> object:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">issueFields</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span></code></div>        <p id="3b8d7e56">Next, you'll do a little trick. For this rule, you want to change the value in the <span class="control">Phase</span> field when a user updates the <span class="control">State</span> field.        You're going to have to set the phase separately for each update, but you can declare the function once.        Just insert this function into the body of the <code class="code" data-lang="Java">action</code> function:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">function</span> <span class="nx">setPhase</span><span class="p">(</span><span class="nx">phase</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">||</span> <span class="p">{}).</span><span class="nx">name</span> <span class="o">!==</span> <span class="nx">phase</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">=</span> <span class="nx">phase</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></div>        <p id="6001ac4f">You can copy this block of code and paste it on top of the next <code class="code" data-lang="Java">TODO</code>.</p>        <p id="6905bec4">You now have a function named <code class="code" data-lang="Java">setPhase</code> that you can use to assign a value to the <span class="control">Phase</span> field.</p>        <p id="c718ed3b">Now write the conditions for changing the value of the <span class="control">Phase</span> field. Frame the conditions and actions as a series of 'if's:</p>        <ul class="list _ul"><li class="list__item" id="baafd6c2"><p>If the <span class="control">State</span> changes to <span class="control">Fixed</span>, set the <span class="control">Phase</span> to <span class="control">Testing</span>.</p></li><li class="list__item" id="42b3e01a"><p>If the <span class="control">State</span> changes to <span class="control">In Progress</span> or <span class="control">Reopened</span>, set the <span class="control">Phase</span> to <span class="control">Development</span>.</p></li><li class="list__item" id="b0623acd"><p>If the <span class="control">State</span> changes to <span class="control">Verified</span>, set the <span class="control">Phase</span> to <span class="control">Ready</span>.</p></li></ul>        <p id="64345f02">Enter the conditions and actions in a series of control flow statements.        Compare the conditions that are listed above to see how they are translated into JavaScript:</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Fixed</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Testing</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">InProgress</span><span class="p">)</span> <span class="o">||</span>
  <span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Reopened</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Development</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Verified</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Ready</span><span class="p">);</span>
<span class="p">}</span></code></div>              </li><li class="list__item" id="f59a9818">Add the <code class="code" data-lang="Java">requirements</code> for this rule.      <p id="c486818e">For this rule, you need do define the requirements for two custom fields: <span class="control">State</span> and <span class="control">Phase</span>.</p>        <p id="673f1ab9">First, define that the <span class="control">State</span> field stores data as a <code class="code" data-lang="Java">state</code> type, then specify which values must be included in the set of values for this field.</p>      <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">State</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
  <span class="nx">InProgress</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;In Progress&quot;</span>
  <span class="p">},</span>
  <span class="nx">Fixed</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">Verified</span><span class="o">:</span> <span class="p">{},</span>
  <span class="nx">Reopened</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">},</span></code></div>        <p id="bab2f96a">Then do the same for the <span class="control">Phase</span> field, except that this field stores data as an <code class="code" data-lang="Java">enum</code> type.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="nx">Phase</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
    <span class="nx">Development</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">Testing</span><span class="o">:</span> <span class="p">{},</span>
    <span class="nx">Ready</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">}</span></code></div>        <p id="ccea875a">Paste these blocks of code over the last <code class="code" data-lang="Java">TODO</code> comment.</p>      </li><li class="list__item" id="c501e422"><p>Click the <span class="control">Save</span> button.</p></li><li class="list__item" id="8342427c"><p>Open the <span class="control">More actions</span> menu in the workflow editor and select <span class="control">Reformat code</span>.        Your finished workflow should look like this:        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Set value for Phase when State changes&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issueFields</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">setPhase</span><span class="p">(</span><span class="nx">phase</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">||</span> <span class="p">{}).</span><span class="nx">name</span> <span class="o">!==</span> <span class="nx">phase</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Phase</span> <span class="o">=</span> <span class="nx">phase</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Fixed</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Testing</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">InProgress</span><span class="p">)</span> <span class="o">||</span>
      <span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Reopened</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Development</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">issueFields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Verified</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">setPhase</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Phase</span><span class="p">.</span><span class="nx">Ready</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">State</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">InProgress</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;In Progress&quot;</span>
      <span class="p">},</span>
      <span class="nx">Fixed</span><span class="o">:</span> <span class="p">{},</span>
      <span class="nx">Verified</span><span class="o">:</span> <span class="p">{},</span>
      <span class="nx">Reopened</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nx">Phase</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">Development</span><span class="o">:</span> <span class="p">{},</span>
      <span class="nx">Testing</span><span class="o">:</span> <span class="p">{},</span>
      <span class="nx">Ready</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>      </p></li></ol></section>  </div>  <div class="chapter"><h2 id="next-steps-quick-start-guide" data-toc="Quick-Start-Guide-Workflows-JS#next-steps-quick-start-guide">So What's Next?</h2>    <p id="166edfce">Now that you have a valid workflow stored in YouTrack, you have a few options.    There's still a lot to learn and do.</p>    <p id="485fb240">Use this list to find your next hill to climb or mountain to conquer.</p>    <div class="table-wrapper"><table class="left_header                 " width="100%" id="539c715d"><tbody><tr id="3f920b0d" class="ijRowOdd"><th id="4de7f924" width="15%"><p>Put your workflow to work!</p></th><td id="24024280"><p>To apply your business logic, you need to attach your workflow to one or more projects. For more information, see <a href="Attach-Workflow-to-Projects.html"><span>Manage Workflows for Multiple Projects</span></a>.</p></td></tr><tr id="74697eaa" class="ijRowEven"><th id="5f16348c"><p>Know the rules</p></th><td id="8046e9bf"><p>This guide introduced you to one rule type, but there are others to learn and master.          Update issues on a set schedule or on demand with a command and manage transitions between values in a custom field.          For more information, see <a href="Workflow-Rules.html"><span>Workflow Rules</span></a>.</p></td></tr><tr id="2b893d6c" class="ijRowOdd"><th id="ceb87a79"><p>Keep learning</p></th><td id="2bf2b7cf"><p>How would you like to see an on-schedule rule in action? Learn a thing or two about working with dates and times?          Now that you're up and running, increase your knowledge by reading the <a href="Workflow-Tutorial.html"><span>Workflow Tutorial</span></a>.</p></td></tr><tr id="09d8be9f" class="ijRowEven"><th id="db4014f5"><p>Explore the possibilities</p></th><td id="3f609023"><p>You won't be able to unlock the full power of workflows if you don't know what they are capable of.          We've collected a set of common use cases to spark your imagination.          For more information, see <a href="Workflow-Use-Cases.html"><span>Use Cases for Workflows</span></a>.</p></td></tr><tr id="5d72a56e" class="ijRowOdd"><th id="8a2fcc3c"><p>Shop around</p></th><td id="154593ad"><p>There are tons of default workflows that are already available in YouTrack and waiting to be put to good use.          While many default workflow are attached to projects automatically, most are optional.          Check out the list of default workflows to see if there are automations that you want to use in your project, or adapt to match your business logic.          For more information, see <a href="Default-Workflows.html"><span>Default Workflows</span></a>.</p></td></tr><tr id="3e232e9c" class="ijRowEven"><th id="f553ec9f"><p>Dig deeper</p></th><td id="203eeebb"><p>You've only scratched the surface.          The more you know about the workflow API and how to reference its properties and methods in JavaScript, the better you can customize your projects.          For more information, see <a href="Workflows-in-JavaScript.html"><span>JavaScript Workflow Reference</span></a>.</p></td></tr><tr id="0cf9ce83" class="ijRowOdd"><th id="56699a8f"><p>Integrate</p></th><td id="32e10675"><p>The REST client implementation in the workflow API lets you script push-style integrations with your favorite tools.          For more information, see <a href="JS-Workflow-REST-API.html"><span>Using REST API Methods in JavaScript Workflows</span></a>.</p></td></tr><tr id="3b6925b0" class="ijRowEven"><th id="db5a6aa5"><p>Go pro</p></th><td id="8e385a24"><p>You can export this rule for editing in an IDE that supports JavaScript, like <a href="/webstorm/" data-external="true" target="_blank" rel="noopener noreferrer"><span>WebStorm</span></a>.          The export option also helps you write and test workflows in a test environment before you import them to your production server.          You can also import scripts that were created in an external editor.          For more information, see <a href="Import-Export-Workflows.html"><span>Import and Export Workflows</span></a>.</p></td></tr></tbody></table></div>  </div><div class="last-modified" data-skip-index="skip">Last modified: 7 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="converting-old-workflows.html">Converting Old Workflows to JavaScript</a><a class="navigation-links__next" href="Workflow-Rules.html">Workflow Rules</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>