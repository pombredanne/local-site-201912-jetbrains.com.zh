<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Reverse Proxy Configuration - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Reverse-Proxy-Configuration"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.4 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Reverse-Proxy-Configuration" id="Reverse-Proxy-Configuration.xml">Reverse Proxy Configuration</h1>    <p id="d9889792">You can set up YouTrack to work behind a reverse proxy server.</p>    <p id="b6eccf99">The process that you use to enable this setup consists of the following steps:</p>    <ol class="list _decimal"><li class="list__item" id="7cc298d7"><p>            <a href="#change-base-url">Configure YouTrack to point to the base URL of the proxy server.</a>        </p></li><li class="list__item" id="0e7f28d3"><p><a href="#Configure_Headers">Configure the headers of your proxy server</a>.            This page includes guidelines for <a href="#Apache_Config">Apache</a>, <a href="#IIS_Config">IIS</a>, and            <a href="#Nginx_Config">NGINX</a> servers.        </p></li></ol>    <div class="chapter"><h2 id="prerequisites" data-toc="Reverse-Proxy-Configuration#prerequisites">Prerequisites</h2>        <p id="25af6163">To get the best performance from your YouTrack installation, your proxy server should support HTTP/2.            For most servers, the HTTP/2 protocol only works with HTTPS connections, which means that you need to secure your connections with a SSL/TLS certificate.</p>        <p id="15d4f044">You also need to ensure that the OpenSSL library that is used by the reverse proxy server is version 1.0.2 or later.            With earlier versions of OpenSSL, users connect using the legacy HTTP/1.1 specification, which lacks the performance benefits of an HTTP/2 connection.</p>        <p id="e6277c17">The instructions on this page assume that these requirements are met.            Use the following list to determine which server version is required to complete this setup:</p>        <div class="table-wrapper"><table class="                 " width="100%" id="7d7e8172"><thead><tr id="108ed82c" class="ijRowHead"><th id="1a9fc094"><p>Server</p></th><th id="efe6650f"><p>Minimum Version</p></th></tr></thead><tbody><tr id="f6ef8e3f" class="ijRowOdd"><td id="971ff0c2"><p>Apache</p></td><td id="f79cfda7"><p>2.4.17</p></td></tr><tr id="f4f4fc11" class="ijRowEven"><td id="5ca6a258"><p>IIS</p></td><td id="5b3ec2da"><p>10.0 version 1709</p></td></tr><tr id="cfcd677c" class="ijRowOdd"><td id="e4fce436"><p>NGINX</p></td><td id="7ce78f48"><p>1.11.7</p></td></tr></tbody></table></div>        <div class="chapter"><h3 id="http-strict-transport-security">HTTP Strict Transport Security</h3>        <p id="9d9ad47c">We also strongly recommend that you set up your reverse proxy server to use HTTP Strict Transport Security (HSTS).            This protects your installation against possible man-in-the-middle attacks, where the redirect from the HTTP to the HTTPS version of the site can be exploited to direct a user to a malicious site instead of the secure version of the original page.</p>        <p id="796967d5">The instructions for proxy server header configurations that are provided on this page include the directives that support HSTS.</p>        </div>        <div class="chapter"><h3 id="worker-connections">Performance Optimization for Worker Connections</h3>            <p id="971bffdf">You will also need to optimize the performance settings for your server to allow a sufficient number of connections to YouTrack.            These connections are required by pages that support live updates.        If you have an insufficient number of connections, or are serving pages over plain HTTP, issues and agile boards that are opened in new tabs are either blank, loading, or partially loaded.</p>        <p id="5c226c04">The exact values for connection-related directives varies based on server load.        Use the diagnostic tools for your reverse proxy to determine whether you provide sufficient connections and adjust these values accordingly.</p>        </div>    </div>    <div class="chapter"><h2 id="change-base-url" data-toc="Reverse-Proxy-Configuration#change-base-url">Change the Base URL of your YouTrack Server</h2>        <p id="1e4358cf">You can use the following procedure to change the base URL for both ZIP and MSI distributions.            To execute these commands in an MSI distribution, open the <span class="control">Command Prompt</span> window as an            administrator.            Always execute the <code class="code" data-lang="Java">configure</code> command on behalf of the OS user that runs the YouTrack service.            This command creates configuration files and folders. The YouTrack service user should have sufficient            permissions to access these files and folders.        </p>        <section class="procedure-steps"><h2 id="3b796579">To change the base URL for a ZIP or MSI distribution:</h2><ol class="list _decimal"><li class="list__item" id="bcaf0a41"><p id="3843e995">Stop the YouTrack service. For specific instructions, see <a href="Stop-and-Start-YouTrack.html"><span>Stop and Start YouTrack</span></a>.</p>                <aside class="note " data-title="" rel="3843e995" id="ce69bd26">                    <p id="b97989d0">All of the commands for this procedure are written for Linux and macOS.</p>                    <p id="06c3ca52">For a Windows installation, replace <code class="code" data-lang="Java">.sh</code> with <code class="code" data-lang="Java">.bat</code> and use the backslash.</p>                </aside>            </li><li class="list__item" id="efdaf1b7"><p id="6bc56d14">In a command-line interface, change the directory to <code class="code" data-lang="Java">&lt;youtrack_home&gt;/bin/</code>.</p>                <ul class="list _ul"><li class="list__item" id="fd40edb4"><p>For a ZIP installation, the <code class="code" data-lang="Console">&lt;youtrack_home&gt;</code> directory is the location where                        the ZIP distribution was unpacked during installation.                    </p></li><li class="list__item" id="f4da0ed5"><p>For an MSI installation, the <code class="code" data-lang="Console">&lt;youtrack_home&gt;</code> directory is                        <code class="code" data-lang="Console">%programdata%\JetBrains\YouTrack</code>.                    </p></li></ul>            </li><li class="list__item" id="5dac3d25"><p id="ea0a2bec">Enter the following command:</p>                <div class="code-block" data-lang="Console"><code class="code-block__wrapper">youtrack.sh configure --listen-port <span class="m">1111</span> --base-url https://youtrack.mydomain.com:XXXX</code></div>                <ul class="list _bullet"><li class="list__item" id="62e64cf0"><p>                        <code class="code" data-lang="Console">1111</code> is the port number that your YouTrack server listens to.                    </p></li><li class="list__item" id="90b34f9b"><p>                        <code class="code" data-lang="Console">https://youtrack.mydomain.com</code> is the address of your proxy server.                    </p></li><li class="list__item" id="536617b3"><p>                        <code class="code" data-lang="Console">XXXX</code> is the port number your proxy server listens to.                    </p></li></ul>            </li><li class="list__item" id="b726d86a"><p>Configure the headers in your proxy server.                Follow the guidelines that are appropriate for your <a href="#Apache_Config">Apache</a>,                <a href="#IIS_Config">IIS</a>, or <a href="#Nginx_Config">NGINX</a> server.            </p></li><li class="list__item" id="fc58c383"><p>                Start the YouTrack service. For specific instructions, see <a href="Stop-and-Start-YouTrack.html"><span>Stop and Start YouTrack</span></a>.            </p></li></ol></section>        <section class="procedure-steps"><h2 id="change-base-url-jar">To change the base URL for a JAR distribution:</h2><ol class="list _decimal"><li class="list__item" id="9a84c65a"><p>                <a href="start-stop-jar.html">Stop the YouTrack service</a>.            </p></li><li class="list__item" id="89351c77"><p id="f333d181">Run the <code class="code" data-lang="Java">configure</code> command for the YouTrack service:</p>                <div class="code-block" data-lang="Console"><code class="code-block__wrapper">java -jar youtrack-&lt;version&gt;.jar configure  --listen-port <span class="m">1111</span> --base-url https://youtrack.mydomain.com:XXXX</code></div>                <ul class="list _bullet"><li class="list__item" id="58c29d25"><p>                        <code class="code" data-lang="Console">1111</code>                        is the port number that your YouTrack server listens to.                    </p></li><li class="list__item" id="58109580"><p>                        <code class="code" data-lang="Console">https://youtrack.mydomain.com</code>                        is the address of your proxy server.                    </p></li><li class="list__item" id="50b40eeb"><p>                        <code class="code" data-lang="Console">XXXX</code>                        is the port number your proxy server listens to.                    </p></li></ul>            </li><li class="list__item" id="b3ad69c7"><p>Configure the headers in your proxy server.                Follow the guidelines that are appropriate for your <a href="#Apache_Config">Apache</a>, <a href="#IIS_Config">IIS</a>, or <a href="#Nginx_Config">NGINX</a> server.            </p></li><li class="list__item" id="6fd2f01b"><p>Start the YouTrack service.</p></li></ol></section>        <section class="procedure-steps"><h2 id="acbfde92">To change the Base URL of the YouTrack service in a Docker container:</h2><ol class="list _decimal"><li class="list__item" id="b21f1130"><p>                Stop YouTrack:                <code class="code" data-lang="Console">docker exec &lt;containerId&gt; stop</code>            </p></li><li class="list__item" id="c1d68abd">                <p id="c9e03296">Execute the following command:</p>                <div class="code-block" data-lang="Console"><code class="code-block__wrapper">docker run --rm -it <span class="se">\</span>
-v &lt;path to conf directory&gt;:/opt/youtrack/conf <span class="se">\</span>
jetbrains/youtrack:&lt;version&gt; <span class="se">\</span>
configure --base-url<span class="o">=</span>https://youtrack.mydomain.com:XXXX</code></div>                <ul class="list _bullet"><li class="list__item" id="a93a958d"><p>                        <code class="code" data-lang="Console">https://youtrack.mydomain.com</code>                        is the address of your proxy server.</p></li><li class="list__item" id="93296e00"><p>                        <code class="code" data-lang="Console">XXXX</code>                        is the port number that your proxy server listens to.                    </p></li></ul>            </li><li class="list__item" id="b8657b28">                <p id="16492ce7">Start YouTrack:                    <code class="code" data-lang="Console">docker start &lt;containerId&gt;</code>                </p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="Configure_Headers" data-toc="Reverse-Proxy-Configuration#Configure_Headers">Configure Proxy Server Headers</h2>        <p id="7ea0cd82">To configure the headers in your proxy server, follow the guidelines that are specific to your server.            Configuration guidelines for Apache HTTP Server, IIS, NGINX, and Pound are provided below.        </p>        <div class="chapter"><h3 id="Apache_Config">Apache HTTP Server Configuration</h3>            <p id="8caab22d">To use an Apache HTTP Server as a reverse proxy, you need to run an <code class="code" data-lang="Java">a2enmod</code> script and add                directives to a <code class="code" data-lang="Java">.conf</code> file on your server.            </p>            <p id="dee855d0">Requires Apache httpd version 2.4.17 or later.</p>            <section class="procedure-steps"><h2 id="49de0d7f">To set up an Apache HTTP Server as a reverse proxy:</h2><ol class="list _decimal"><li class="list__item" id="85f8ba22"><p>Use the following <code class="code" data-lang="Java">a2enmod</code> script to enable the <code class="code" data-lang="Java">headers</code>,                    <code class="code" data-lang="Java">rewrite</code>, <code class="code" data-lang="Java">proxy_http</code>, <code class="code" data-lang="Java">ssl</code>, and <code class="code" data-lang="Java">http2</code> modules:                    <div class="code-block" data-lang="Apache"><code class="code-block__wrapper"><span class="err">$</span> <span class="nb">a2enmod</span> headers
<span class="err">$</span> <span class="nb">a2enmod</span> rewrite
<span class="err">$</span> <span class="nb">a2enmod</span> proxy_http
<span class="err">$</span> <span class="nb">a2enmod</span> ssl
<span class="err">$</span> <span class="nb">a2enmod</span> http2</code></div>                </p></li><li class="list__item" id="f74fadfb"><p>Add the following directives to the <code class="code" data-lang="Java">VirtualHost</code> section of a relevant <code class="code" data-lang="Java">.conf</code> file:                    <div class="code-block" data-lang="Apache"><code class="code-block__wrapper"><span class="nb">Protocols</span> h2 http/1.1

<span class="nb">RequestHeader</span> set X-Forwarded-Proto <span class="s2">&quot;https&quot;</span>

<span class="nb">RewriteEngine</span> <span class="k">on</span>
<span class="nb">AllowEncodedSlashes</span> <span class="k">on</span>

<span class="nb">ProxyRequests</span> <span class="k">off</span>

<span class="nb">ProxyPass</span> / http://127.0.0.1:1111/
<span class="nb">ProxyPassReverse</span> / http://127.0.0.1:1111/

<span class="nb">SSLEngine</span> <span class="k">On</span>
<span class="nb">SSLCertificateFile</span> &lt;path_to_certificate&gt;
<span class="nb">SSLCertificateKeyFile</span> &lt;path_to_key&gt;</code></div>                </p></li><li class="list__item" id="9accb66a"><p id="509bd5dd">Set the following variables to match your Hub configuration:</p>                    <ul class="list _bullet"><li class="list__item" id="74f84de7"><p>Replace <code class="code" data-lang="Java">1111</code> with the actual port number that your Hub server listens                            to.</p></li><li class="list__item" id="d8cc28e0"><p>Set the value for the <code class="code" data-lang="Java">&lt;path_to_certificate&gt;</code> to the location of the SSL/TLS certificate for your server.</p></li><li class="list__item" id="dbddbd94"><p>Set the value for the <code class="code" data-lang="Java">&lt;path_to_key&gt;</code> to the location of the PEM-encoded private key file for the server certificate.</p></li></ul>                </li><li class="list__item" id="843c473e"><p id="97f9cd2c">Add the additional HSTS header to the HTTPS VirtualHost directive. Max-age is measured in seconds.</p>                    <div class="code-block" data-lang="Apache"><code class="code-block__wrapper"><span class="c"># Guarantee HTTPS for 1 Year including subdomains</span>
<span class="nb">Header</span> always set Strict-Transport-Security <span class="s2">&quot;max-age=31536000; includeSubDomains&quot;</span></code></div>                    <p id="760437d7">Note that this header is only valid on a HTTPS VirtualHost.</p></li><li class="list__item" id="4bebcf21"><p id="c42f7637">Add a server-side redirect to upgrade non-HTTPS connections the first time the site is accessed. Add this to the non-HTTP VirtualHost.</p>                    <div class="code-block" data-lang="Apache"><code class="code-block__wrapper"><span class="err">[</span>...<span class="err">]</span>
<span class="nb">ServerName</span> myYouTrackService.com
<span class="nb">Redirect</span> permanent / https://myYouTrackService.com/</code></div>                    <p id="05c6f938">Replace <code class="code" data-lang="Java">myYouTrackService.com</code> with the actual domain name of your YouTrack server.</p></li></ol></section>            <p id="ead36571">For more information, refer to&nbsp;the documentation for the <a href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>Apache Module mod_proxy</span></a>.            </p>        </div>        <div class="chapter"><h3 id="IIS_Config">IIS Server Configuration</h3>            <p id="2d21947a">To use an IIS server as a reverse proxy, you need to use the Application Request Routing (ARR)                extension.            </p>            <p id="13955815">Requires IIS version 10.0 version 1709 or later.</p>            <section class="procedure-steps"><h2 id="4e4c8204">To set up an IIS server as a reverse proxy:</h2><ol class="list _decimal"><li class="list__item" id="82cfd8d1"><p>Download and install the Application Request Routing (ARR) extension from the                    <a href="https://www.iis.net/downloads/microsoft/application-request-routing" data-external="true" target="_blank" rel="noopener noreferrer"><span>Microsoft website</span></a>.                </p></li><li class="list__item" id="19e44166"><p>In <span class="control">IIS Manager</span>, connect to the IIS server - in this case, <code class="code" data-lang="Java">localhost</code>.                </p></li><li class="list__item" id="ecea01c9"><p>Highlight the server in the <b id="0b182da1">Connections</b> pane.                </p></li><li class="list__item" id="994f8eaf"><p>Double-click <span class="control">URL Rewrite</span>.                </p></li><li class="list__item" id="c1319738"><p>Click <span class="control">View server variables</span> in the right pane.                </p></li><li class="list__item" id="80b16c9b"><p>Add the following server variables to the list:                    <div class="code-block" data-lang="Shell"><code class="code-block__wrapper">HTTP_X_FORWARDED_HOST
HTTP_X_FORWARDED_SCHEME
HTTP_X_FORWARDED_PROTO</code></div>                </p></li><li class="list__item" id="10a14693"><p id="86bf8525">Set the response buffer threshold.                    For single web servers:</p>                    <ul class="list _ul"><li class="list__item" id="a8ae7864"><p>Select the server in the <span class="control">Connections</span> pane.                        </p></li><li class="list__item" id="c20fdc91"><p>Double-click <span class="control">Application Request Routing Cache</span>.                        </p></li><li class="list__item" id="be57fe1b"><p>Click <span class="control">Server Proxy Settings</span> under the <span class="control">Proxy</span> heading in                            the <span class="control">Actions</span> pane.                        </p></li><li class="list__item" id="dacb6d5f"><p>Select the <span class="control">Enable proxy</span> checkbox, set the <span class="control">Response buffer                            threshold                        </span> to <code class="code" data-lang="Java">0</code>, then click <span class="control">Apply</span>. Leave the default values in                            place.                        </p></li></ul>                    <p id="e875ef3a">For server farms:</p>                    <ul class="list _ul"><li class="list__item" id="120a37ca"><p>Select the YouTrack server farm in the <span class="control">Connections</span> pane.                        </p></li><li class="list__item" id="753daa65"><p>Double-click the <span class="control">Proxy</span> icon.                        </p></li><li class="list__item" id="572d1eb2"><p>In the <span class="control">Buffer Setting</span> section of the form, set the <span class="control">Response                            buffer threshold</span> to <code class="code" data-lang="Java">0</code>, then click <span class="control">Apply</span>.                        </p></li></ul>                </li><li class="list__item" id="14da30bd"><p>Deselect the <span class="control">Reverse rewrite host in response headers</span> checkbox and                    click <span class="control">Apply</span>.                </p></li><li class="list__item" id="d1e183de"><p>In the <span class="control">Connections</span> pane, under <span class="control">Sites</span>, select <span class="control">                    Default Web Site</span>.                </p></li><li class="list__item" id="0d06628b"><p>Double-click the <span class="control">URL Rewrite</span> feature, then click <span class="control">Add Rule(s)</span> in                    the <span class="control">Actions</span> pane.                </p></li><li class="list__item" id="732fa543"><p>Add a reverse proxy rule with the server name: <code class="code" data-lang="Apache">localhost:1111</code> (replace with the                    real location and port of your YouTrack service).                </p></li><li class="list__item" id="d040c70c"><p id="447f0ee6">Open the rule, check the rewrite URL, and add the following server variables:</p>                    <ul class="list _bullet"><li class="list__item" id="929d326d"><p>Set the <code class="code" data-lang="Java">HTTP_X_FORWARDED_HOST</code> variable to <code class="code" data-lang="Java">{HTTP_HOST}</code>.                        </p></li><li class="list__item" id="a2dfbbb7"><p>Set the <code class="code" data-lang="Java">HTTP_X_FORWARDED_SCHEME</code> variable to                            <code class="code" data-lang="Java">https</code>.                        </p></li><li class="list__item" id="60abb20c"><p>Set the <code class="code" data-lang="Java">HTTP_X_FORWARDED_PROTO</code> to                            <code class="code" data-lang="Java">https</code>.                        </p></li></ul>                </li><li class="list__item" id="40df30de"><p id="c1b178f9">Make sure that anonymous authentication is enabled:</p>                    <ul class="list _ul"><li class="list__item" id="b3139287"><p>In the <span class="control">Sites</span> section of the <span class="control">Connections</span> pane,                            select <span class="control">Default Web Site</span>.                        </p></li><li class="list__item" id="80e938b8"><p>Double-click <span class="control">Authentication</span>, select <span class="control">Anonymous</span>, then                            click <span class="control">Enable</span> in the right pane.                        </p></li></ul>                </li><li class="list__item" id="978c493d"><p>Make sure that <span class="control">Dynamic Content Compression</span> is disabled.                    The location of this setting varies by operating system.                </p></li><li class="list__item" id="4dab068a"><p>In the <span class="control">Connections</span> pane, under <span class="control">Sites</span>, select <span class="control">                    Default Web Site</span>.                </p></li><li class="list__item" id="49c04988"><p>Double-click the <span class="control">Request Filtering</span> feature, then click <span class="control">Edit Feature                    Settings                </span> in the <span class="control">Actions</span> pane.                </p></li><li class="list__item" id="a7a9355c"><p id="9a134ca7">Increase the values for the following parameters:</p>                    <div class="table-wrapper"><table class="                 " width="100%" id="3fff33e3"><thead><tr id="10f6a03d" class="ijRowHead"><th id="c22dc353" width="20%"><p>Parameter</p></th><th id="6afbc0e7"><p>Value</p></th></tr></thead><tbody><tr id="3aa8837f" class="ijRowOdd"><td id="85334c24"><p>Maximum URL length</p></td><td id="e081643d"><p>6144</p></td></tr><tr id="c3b9a3e0" class="ijRowEven"><td id="8b359aef"><p>Maximum query string</p></td><td id="9e67c8c6"><p>4096</p></td></tr></tbody></table></div>                </li><li class="list__item" id="5b3276a8"><p id="47565d41">Add a new SSL binding to the <span class="control">Default Web                    Site</span>.</p>                    <ul class="list _ul"><li class="list__item" id="6b39aaeb"><p>The address that the SSL binding listens to (Host URL) should match the YouTrack base URL.                        </p></li><li class="list__item" id="6461e699"><p>The certificate that you choose should correspond to the server DNS address.</p></li></ul>                </li><li class="list__item" id="111983e7"><p id="306a60fc">Configure the HTTP Strict Transport Security (HSTS) settings for the <span class="control">Default Web                    Site</span></p>                    <ul class="list _ul"><li class="list__item" id="d569dbd6"><p>Set the <code class="code" data-lang="Java">enabled</code> attribute for the <code class="code" data-lang="Java">&lt;hsts&gt;</code> to <code class="code" data-lang="Java">true</code>.</p></li><li class="list__item" id="795c2a45"><p>Specify a value for the <code class="code" data-lang="Java">max-age</code> attribute. For example, <code class="code" data-lang="Java">31536000</code> (one year, in seconds).</p></li><li class="list__item" id="4b035eeb"><p>Set the values for the <code class="code" data-lang="Java">includeSubDomains</code> and <code class="code" data-lang="Java">redirectHttpToHttps</code> to <code class="code" data-lang="Java">true</code> as well.</p></li></ul>                    <p id="00cfa54e">For specific instructions, please refer to the <a href="https://docs.microsoft.com/en-us/iis/configuration/system.applicationhost/sites/site/hsts" data-external="true" target="_blank" rel="noopener noreferrer"><span>ISS configuration reference</span></a>.</p></li></ol></section>        </div>        <div class="chapter"><h3 id="Nginx_Config">NGINX Server Configuration</h3>            <p id="b8bc35aa">The basic requirements for configuring an NGINX server as a reverse proxy consists of the following                steps:            </p>            <ul class="list _ul"><li class="list__item" id="956eabc2"><p>Update the values for the <a href="http://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile" data-external="true" target="_blank" rel="noopener noreferrer"><span>worker_rlimit_nofile</span></a>                    and <a href="http://nginx.org/en/docs/ngx_core_module.html#worker_connections" data-external="true" target="_blank" rel="noopener noreferrer"><span>worker_connections</span></a> directives.                This ensures that YouTrack is afforded a reasonable number of connections to support live updates in multiple issue views.</p></li><li class="list__item" id="fe0376e6"><p>Set the variables for the <a href="http://nginx.org/en/docs/http/server_names.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>server_name</span></a> directive.                </p></li><li class="list__item" id="98912cb9"><p>Add the <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" data-external="true" target="_blank" rel="noopener noreferrer"><span>proxy_set_header</span></a> and <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" data-external="true" target="_blank" rel="noopener noreferrer"><span>proxy_pass</span></a> directives.                </p></li></ul>            <p id="2df1a27a">Requires NGINX version 1.11.7 or later.</p>            <section class="procedure-steps"><h2 id="d165c1c3">To configure NGINX reverse proxy headers:</h2><ol class="list _decimal"><li class="list__item" id="5137d617"><p id="0477903d">Open the configuration file for your NGINX server.                    By default, the configuration file is named <code class="code" data-lang="Console">nginx.conf</code>.                    The default directory is either <code class="code" data-lang="Console">/usr/local/nginx/conf</code>, <code class="code" data-lang="Console">/etc/nginx</code>,                    or <code class="code" data-lang="Console">/usr/local/etc/nginx</code>.</p>                    <p id="a99ce8db">You can find the exact location of the configuration file by entering <code class="code" data-lang="Console">nginx -V</code> in a                        command line interface.                    </p>                </li><li class="list__item" id="67b75495"><p>Increase the value for the <code class="code" data-lang="Java">worker_rlimit_nofile</code> directive to a minimum value of <code class="code" data-lang="Java">4096</code>.</p></li><li class="list__item" id="22d35b25"><p>In the <code class="code" data-lang="Java">events</code> section, increase the value for the <code class="code" data-lang="Java">worker_connections</code> directive to a minimum value of <code class="code" data-lang="Java">2048</code>.</p></li><li class="list__item" id="a8a2c358"><p id="b6d984bb">Update the <code class="code" data-lang="Java">server</code> directive and add the <code class="code" data-lang="Java">proxy_set_header</code> and                    <code class="code" data-lang="Java">proxy_pass</code> directives in your configuration file.                    Use the following sample as a guide:</p>                    <aside class="warning " data-title="" rel="b6d984bb" id="bc7c4f81">                        <p id="899e7826">Many sample NGINX configurations use an <code class="code" data-lang="Java">include</code> directive that references a <code class="code" data-lang="Java">snippets/ssl-params.conf</code> file.                            This file contains a set of common configuration parameters for SSL termination.                            If you choose to include this file rather than following the setup described below, you must                            change the value for the <code class="code" data-lang="Java">X-Frame-Options</code> parameter in the referenced file from <code class="code" data-lang="Java">DENY</code> to <code class="code" data-lang="Java">SAMEORIGIN</code>.                            Otherwise, the reverse proxy interferes with the process that keeps users logged in to                            YouTrack.                        </p>                        <p id="116e269e">For more information, see <a href="#users-logged-out">Users are periodically logged out of                            YouTrack</a>.                        </p>                    </aside>                    <div class="code-block" data-lang="NGINX"><code class="code-block__wrapper"><span class="k">server</span> <span class="p">{</span><span class="kn"> </span>
    <span class="s">listen</span> <span class="mi">443</span> <span class="s">ssl</span> <span class="s">http2</span><span class="p">;</span><span class="kn"> </span>

    <span class="s">ssl_certificate</span> <span class="s">&lt;path_to_certificate&gt;</span><span class="p">;</span>
    <span class="kn">ssl_certificate_key</span> <span class="s">&lt;path_to_key&gt;</span><span class="p">;</span>
<span class="kn"> </span>
    <span class="s">server_name</span> <span class="s">localhost</span><span class="p">;</span><span class="kn"> </span>

    <span class="s">add_header</span> <span class="s">Strict-Transport-Security</span> <span class="s">max-age=31536000</span><span class="p">;</span>
<span class="kn"> </span>
    <span class="s">location</span> <span class="s">/</span> <span class="p">{</span><span class="kn"> </span>
        <span class="s">proxy_set_header</span> <span class="s">X-Forwarded-Host</span> <span class="nv">$http_host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="kn"> </span>
        <span class="s">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span><span class="kn"> </span>

        <span class="s">client_max_body_size</span> <span class="mi">10m</span><span class="p">;</span>

        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span><span class="kn"> </span>
        <span class="s">proxy_pass</span> <span class="s">http://youtrackmachine.domain.local:1111</span><span class="p">;</span><span class="kn"> </span>
    <span class="err">}</span>
    <span class="s">location</span> <span class="s">/api/eventSourceBus</span> <span class="p">{</span>
        <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
        <span class="kn">proxy_read_timeout</span> <span class="s">86400s</span><span class="p">;</span>
        <span class="kn">proxy_send_timeout</span> <span class="s">86400s</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
        <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
        
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Host</span> <span class="nv">$http_host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span><span class="kn"> </span>
        <span class="s">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span><span class="kn"> </span>
        <span class="s">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span><span class="kn">  </span>
        <span class="s">proxy_pass</span> <span class="s">http://youtrackmachine.domain.local:1111</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></div>                </li><li class="list__item" id="b27a74b7"><p id="8c0ecba7">Set the following variables to match your YouTrack configuration:</p>                    <ul class="list _bullet"><li class="list__item" id="ea870b25"><p>                            <code class="code" data-lang="NGINX">listen 443</code>                            is the port number that you specified in the <code class="code" data-lang="Console">--base-url</code> parameter.                        </p></li><li class="list__item" id="2cf6ed0c"><p>                            <code class="code" data-lang="NGINX">proxy_pass http://youtrackmachine.domain.local:1111</code>                            is the path to your YouTrack server with the port that you specified with the                            <code class="code" data-lang="Console">-–listen-port</code> command.                        </p></li></ul>                </li><li class="list__item" id="d7a9bb11"><p>Save and close your configuration file.</p></li><li class="list__item" id="16c6b1f2"><p id="f9d9311e">Check for errors in your NGINX configuration by stopping and starting the server with the                    following commands:</p>                    <div class="code-block" data-lang="Shell"><code class="code-block__wrapper">sudo nginx -s stop
sudo nginx</code></div>                    <p id="bb63030c">Alternatively, you can reload the configuration with the following command:</p>                    <div class="code-block" data-lang="Console"><code class="code-block__wrapper">sudo nginx -s reload</code></div>                </li></ol></section>            <p id="8367951f">The <code class="code" data-lang="Console">client_max_body_size</code> directive defines the maximum amount of data that NGINX accepts in                an HTTP request.                If you don't specify a value, the default set by NGINX is 1 megabyte.                We recommend that you increase the maximum to 10 megabytes to correspond to the default value in                YouTrack.            </p>            <p id="3ccc7e09">The second <code class="code" data-lang="Console">location</code> block disables buffering for connections from the agile board to support                live updates.                If you customize any of the common connection settings in the first <code class="code" data-lang="Console">location</code> block, you                should set the same custom parameters for the <code class="code" data-lang="Console">/api/eventSourceBus</code> location.                You can also put all of your common settings in a separate file and reference the file with an                <code class="code" data-lang="Console">include</code> directive.                For more information, read the <a href="http://nginx.org/en/docs/ngx_core_module.html#include" data-external="true" target="_blank" rel="noopener noreferrer"><span>NGINX documentation</span></a>.            </p>            <a name="Converting_Java_key_store_to_format_required_by_Nginx"></a>            <p id="b2aaf68b">If you use a Java keystore, you need to convert it to the PKCS12 format to use a NGINX server as an                SSL-terminating proxy.                The following procedure shows you how to convert the keystore using <span class="control">keytool                </span> and <span class="control">openssl</span>.            </p>            <section class="procedure-steps"><h2 id="8bed55d1">To convert a Java keystore to PKCS12 format:</h2><ol class="list _decimal"><li class="list__item" id="ad07639b"><p id="f0b4a2dd">Use <span class="control">keytool</span> to convert your current <code class="code" data-lang="Java">.jks</code> file to the PKCS12 key                    store format <code class="code" data-lang="Java">.p12</code>:</p>                    <div class="code-block" data-lang="Console"><code class="code-block__wrapper">keytool -importkeystore -srckeystore oldkeystore.jks -destkeystore newkeystore.p12 -deststoretype PKCS12
Enter destination keystore password: <span class="o">[</span>enter private key password from oldkeystore.jks, it will be password <span class="k">for</span> newkeystore.p12<span class="o">]</span>
Re-enter new password: <span class="o">[</span>same as above<span class="o">]</span>
Enter <span class="nb">source </span>keystore password: <span class="o">[</span>enter password <span class="k">for</span> oldkeystore.jks<span class="o">]</span>
...
Enter key password <span class="k">for</span> &lt;key <span class="nb">alias </span>name&gt; <span class="o">[</span>enter private key password from oldkeystore.jks<span class="o">]</span>
...</code></div>                    <p id="8a8c9a6c">You will be required to enter a "destination keystore password". If your <code class="code" data-lang="Console">.jks</code>                        keystore contains a private key with a password, then the                        "destination keystore password" should equal the password of the private key.                    </p>                </li><li class="list__item" id="b73146a8"><p>List the contents of the new key store file:                    <div class="code-block" data-lang="Shell"><code class="code-block__wrapper">keytool -deststoretype PKCS12 -keystore newkeystore.p12 -list
Enter keystore password: <span class="o">[</span>enter password <span class="k">for</span> newkeystore.p12 provided on step 1<span class="o">]</span>
...</code></div>                </p></li><li class="list__item" id="f4c1012a"><p>Extract the .pem file (certificate) from the <code class="code" data-lang="Java">.p12</code> key store:                    <div class="code-block" data-lang="Shell"><code class="code-block__wrapper">openssl pkcs12 -nokeys -in newkeystore.p12 -out certfile.pem
Enter Import Password: <span class="o">[</span>enter password <span class="k">for</span> newkeystore.p12 provided on step 1<span class="o">]</span>
...</code></div>                </p></li><li class="list__item" id="73281a0a"><p>Extract the unencrypted key file from the <code class="code" data-lang="Java">.p12</code> key store:                    <div class="code-block" data-lang="Shell"><code class="code-block__wrapper">openssl pkcs12 -nocerts -nodes -in newkeystore.p12 -out keyfile.key
Enter Import Password: <span class="o">[</span>enter password <span class="k">for</span> newkeystore.p12 provided on step 1<span class="o">]</span>
...</code></div>                </p></li></ol></section>        </div>            </div>    <div class="chapter"><h2 id="CORS" data-toc="Reverse-Proxy-Configuration#CORS">CORS Support</h2>        <p id="c47f3708">If you use an external Hub service, YouTrack may require CORS support to make calls to Hub.            The aforementioned configurations work fine and don't require any further tuning.            Additional custom proxy rules, however, may interfere with CORS, making login to YouTrack impossible.        </p>        <p id="c86817aa">Consider the following guidelines when using an external Hub service behind the reverse proxy:</p>        <ol class="list _decimal"><li class="list__item" id="c3d60c01"><p id="767de96b">Proxy rules should not block CORS-related HTTP headers:</p>                <ul class="list _ul"><li class="list__item" id="eb75090c"><p>Access-Control-Request-Method</p></li><li class="list__item" id="1c6bec5e"><p>Access-Control-Request-Headers</p></li><li class="list__item" id="0e97f5e8"><p>Access-Control-Allow-Origin</p></li><li class="list__item" id="92c65cd1"><p>Access-Control-Allow-Credentials</p></li><li class="list__item" id="92e37f39"><p>Access-Control-Expose-Headers</p></li><li class="list__item" id="3f9e9f88"><p>Access-Control-Max-Age</p></li><li class="list__item" id="2a7ea4d6"><p>Access-Control-Allow-Methods</p></li><li class="list__item" id="4b94da41"><p>Access-Control-Allow-Headers</p></li></ul>            </li><li class="list__item" id="5e8422cb"><p>The proxy server should allow HTTP OPTIONS requests.</p></li><li class="list__item" id="acc4f6b6"><p>HTTP OPTIONS requests should not be a subject of proxy-enforced authentication, if any.                For example, you may want to set up certificate-based authentication to comply with enterprise security                policy.                In this case, an authentication check should be skipped if incoming request is an OPTIONS type.                OPTIONS requests cannot return any customer-related data by themselves, so it's safe to let them in.            </p></li></ol>    </div>    <div class="chapter"><h2 id="troubleshooting" data-toc="Reverse-Proxy-Configuration#troubleshooting">Troubleshooting</h2>        <p id="a27bde7c">If users report problems working with YouTrack behind a reverse proxy server, check the following errors.</p>        <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="ac204728"><thead><tr id="cbfda33f" class="ijRowHead"><th id="210641ee" width="20%"><p>Condition</p></th><th id="ab8a45e7"><p>YouTrack displays the error message: "The live update connection is taking longer than expected."                </p></th></tr></thead><tbody><tr id="fbf0a3a1" class="ijRowOdd"><td id="369702b0"><p>Cause</p></td><td id="054bee8f"><p>Your reverse proxy server is buffering connections that support live updates.</p></td></tr><tr id="6ac08eed" class="ijRowEven"><td id="9ae71efb"><p>Solution</p></td><td id="f756bac9"><p id="8a6cd48b">Verify the current settings for your reverse proxy server and confirm that your connections are not                    subject to buffering.</p>                    <ul class="list _bullet"><li class="list__item" id="1ae3cb0f"><p>For Apache installations, check the <code class="code" data-lang="Console">ProxyIOBufferSize</code> directive.                        </p></li><li class="list__item" id="9d8206e7"><p id="9d0cfe23">For IIS:</p>                            <ul class="list _ul"><li class="list__item" id="8cf98f28"><p>Check that the <code class="code" data-lang="Java">Response buffer threshold</code> is set to <code class="code" data-lang="Java">0</code>.                                </p></li><li class="list__item" id="219de16b"><p>Check that the values for the <code class="code" data-lang="Console">Maximum URL length</code> and                                    <code class="code" data-lang="Console">Maximum query string</code> parameters in the                                    <span class="control">Request Filtering</span> feature are configured as described in this setup guide.                                </p></li><li class="list__item" id="1c9958ee"><p>Make sure that <span class="control">Dynamic Content Compression</span> is disabled.                                </p></li></ul>                        </li><li class="list__item" id="858f5900"><p>For NGINX, verify that the <code class="code" data-lang="Console">/api/eventSourceBus</code> location is configured as                            described in this setup guide.                        </p></li></ul>                </td></tr></tbody></table></div>        <div class="table-wrapper"><table class="                 " width="100%" id="6ba0b3b4"><thead><tr id="9ffc75ee" class="ijRowHead"><th id="500705f5" width="20%"><p>Condition</p></th><th id="8d54f1a3"><p>Your reverse proxy is configured as described in this guide or you are not using a reverse proxy.                    You continue to see the error message: "The live update connection is taking longer than expected."                </p></th></tr></thead><tbody><tr id="1259d126" class="ijRowOdd"><td id="ff5be1a1"><p>Cause</p></td><td id="d7a27d08"><p>You are using anti-virus or endpoint security software that blocks server-sent events.</p></td></tr><tr id="56d14f39" class="ijRowEven"><td id="b3890e35"><p>Solution</p></td><td id="aec1dcf3"><p>Disable your software settings to allow automatic updates from the server.</p></td></tr></tbody></table></div>        <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="bc750c76"><thead><tr id="8477f2b7" class="ijRowHead"><th id="e8ede4d2" width="20%"><p>Condition</p></th><th id="226faf62"><p>Error 413 Request Entity Too Large.</p></th></tr></thead><tbody><tr id="88356084" class="ijRowOdd"><td id="9d6d6bb6"><p>Cause</p></td><td id="640320f4"><p>A user attempts to upload an attachment that exceeds the maximum body size accepted by the reverse                    proxy server.                </p></td></tr><tr id="38fe44e8" class="ijRowEven"><td id="4c95f9c6"><p>Solution</p></td><td id="94a8baad"><p id="bdecf307">Verify the current settings for your reverse proxy server and increase the maximum allowed size, if                    required.                    The recommended value for this setting is 10 megabytes.</p>                    <ul class="list _bullet"><li class="list__item" id="4d5879b2"><p>For Apache installations, check the <code class="code" data-lang="Apache">LimitRequestBody</code> directive.                        </p></li><li class="list__item" id="79b87ac2"><p>For IIS, check the <code class="code" data-lang="Console">uploadreadaheadsize</code> config setting.                        </p></li><li class="list__item" id="4c753985"><p>For NGINX, check the <code class="code" data-lang="NGINX">client_max_body_size</code> directive.                        </p></li></ul>                </td></tr></tbody></table></div>        <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="users-logged-out"><thead><tr id="8dd7158a" class="ijRowHead"><th id="b73617c3" width="20%"><p>Condition</p></th><th id="e3a4b5e9"><p>Users are periodically logged out of YouTrack.</p></th></tr></thead><tbody><tr id="960090e2" class="ijRowOdd"><td id="cd824aea"><p>Cause</p></td><td id="20337a51"><p>The built-in Hub service uses a hidden inline frame to refresh authentication tokens.                    If you have set the value for the <code class="code" data-lang="Java">X-Frame-Options</code> header to <code class="code" data-lang="Java">DENY</code> for your                    reverse proxy server, users are logged out when their tokens expire.                </p></td></tr><tr id="c410909f" class="ijRowEven"><td id="f2c81aed"><p>Solution</p></td><td id="2b155160"><p>All responses that contain static content from the Hub service set the value for the                    <code class="code" data-lang="Java">X-Frame-Options</code> header to <code class="code" data-lang="Java">SAMEORIGIN</code>.                    To preserve this value, configure your reverse proxy server to use the <code class="code" data-lang="Java">X-Frame-Options: SAMEORIGIN</code>                    directive for all static content from your YouTrack installation.                    If your YouTrack installation is connected to an external Hub service, set this directive for static                    content from Hub.                    For more information, see <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options" data-external="true" target="_blank" rel="noopener noreferrer"><span>X-Frame-Options</span></a>.                </p></td></tr></tbody></table></div>        <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="worker-connections-too-low"><thead><tr id="313b3a74" class="ijRowHead"><th id="18b2810f" width="20%"><p>Condition</p></th><th id="5de0cb90"><p>Issues and agile boards that are opened in new tabs are either blank, loading, or partially loaded.</p></th></tr></thead><tbody><tr id="1eaa6ecb" class="ijRowOdd"><td id="dec33c7f"><p>Cause</p></td><td id="b1f1ff98"><p>Your proxy server doesn't support the number of connections that are required by pages that support live updates.                   The average upper limit is 30 connections per user.                    Users who open several issue views on different browser tabs can use up all of the available connections.<br><br>                    For NGINX, you can confirm this condition by looking for <code class="code" data-lang="Java">worker_connections are not enough</code> errors in the logs.</p></td></tr><tr id="7f0ccb04" class="ijRowEven"><td id="19b8146d"><p>Solution</p></td><td id="bb3b47c5"><p id="5e3fd65a">Tune the performance settings of your reverse proxy server to allow more connections to YouTrack.</p>                <ul class="list _ul"><li class="list__item" id="3d451745"><p>For Apache installations, check the values for the <code class="code" data-lang="Java">MaxRequestWorkers</code> and <code class="code" data-lang="Java">ThreadsPerChild</code> directives.                    Increasing the values for these and other connection-related directives can improve performance.</p></li><li class="list__item" id="7b846e50"><p>For NGINX, check the values for the <code class="code" data-lang="Java">worker_rlimit_nofile</code> and <code class="code" data-lang="Java">worker_connections</code> directives.                        We recommend that you set the values for these directives to a minimum value of <code class="code" data-lang="Java">4096</code> and <code class="code" data-lang="Java">2048</code> respectively.</p></li></ul>                </td></tr></tbody></table></div>    </div><div class="last-modified" data-skip-index="skip">Last modified: 8 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Proxy-Configuration.html">Proxy Configuration</a><a class="navigation-links__next" href="Configure-JVM-Options.html">Configure JVM Options</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>