<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Prevent Unwanted Updates - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="prevent-unwanted-updates-workflows"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.4 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="prevent-unwanted-updates-workflows" id="prevent-unwanted-updates-workflows.xml">Prevent Unwanted Updates</h1>    <p id="665ecc09">To block specific users from viewing or changing the values in a custom field, you have the option to <a href="Private-and-Public-Issue-Fields.html#make-field-private">make the field private</a>.        However, there are a few limitations to this solution.        Users can either read and/or update all private custom fields in a project or none of them.</p>    <p id="2a145352">With workflows, you can prevent unwanted updates to changes in public fields.        You can support a wide variety of update restrictions. For example:</p>    <ul class="list _ul"><li class="list__item" id="c6760734"><p>Prohibit anyone but members of the QA team from changing the state for reported bugs from <span class="control">Fixed</span> to <span class="control">Verified</span>.</p></li><li class="list__item" id="4f179c6b"><p>Mark an issue as <span class="control">Fixed</span> only when the <span class="control">Spent time</span> field is not empty.</p></li><li class="list__item" id="831c395f"><p>Block users from changing the value for the <span class="control">Assignee</span> field once an issue is resolved.</p></li></ul>    <div class="chapter"><h2 id="restrict-updates-to-specific-group" data-toc="prevent-unwanted-updates-workflows#restrict-updates-to-specific-group">Restrict Updates to a Specific Group of Users</h2>        <p id="cd733b3f">Let's assume that you have a group of accountants who process payment requests.        Your company doesn't want the accounting team to accept payment requests without the approval from a manager.</p>        <p id="2d640046">To support this restriction, you need two custom fields:</p>        <div class="table-wrapper"><table class="                 " width="100%" id="540cb305"><thead><tr id="208d0e1a" class="ijRowHead"><th id="3042ab9e"><p>Field</p></th><th id="a0b16695"><p>Description</p></th></tr></thead><tbody><tr id="091d7511" class="ijRowOdd"><td id="474f455e"><p>Authorization status</p></td><td id="5186c850"><p>Stores two enumerated values: <span class="control">Required</span> (the default value) and <span class="control">Authorized</span>.</p></td></tr><tr id="f6d88efd" class="ijRowEven"><td id="7f18641e"><p>Authorizer</p></td><td id="c91d4894"><p>Stores a user type. It contains a list of managers who can approve payment requests.</p></td></tr></tbody></table></div>        <p id="11ce2635">You want to apply a restriction to the <span class="control">Authorization status</span> field so that it can only be changed to <span class="control">Authorized</span> by the user who is selected as the <span class="control">Authorizer</span>.          This means that:</p>        <ul class="list _ul"><li class="list__item" id="965cf485"><p>The <span class="control">Authorizer</span> must have permission to read the issue.</p></li><li class="list__item" id="ae8537a4"><p>The <span class="control">Authorizer</span> must have permission to update the <span class="control">Authorization status</span> field.</p></li><li class="list__item" id="fdd2beb0"><p>No other user should be able to update the value for the <span class="control">Authorization status</span> field.</p></li></ul>        <p id="34d694d4">To support the first and the second points, either use the permission scheme in the project or use a workflow that adds the <span class="control">Authorizer</span> to the visibility list.            For details, see <a href="restrict-issue-visibility-workflow.html"><span>Restrict Issue Visibility with Workflows</span></a>.            You should also perform the following setup:</p>        <ul class="list _ul"><li class="list__item" id="74402ee6"><p>Create a separate <span class="control">Authorizers</span> group and add all of the managers as members.</p></li><li class="list__item" id="87adc6eb"><p>Grant the same level of access that is available to users who have permission to create issues in the project.</p></li><li class="list__item" id="6f3fa504"><p>Set this group as the source for values in the <span class="control">Authorizer</span> field.</p></li></ul>        <p id="022a5ba3">Now you can restrict who can set the value for the <span class="control">Authorization status</span> field.          This rule is triggered when someone tries to set the <span class="control">Authorization status</span> to <span class="control">Authorized</span>.          It verifies that the current user is the same person who is set as the <span class="control">Authorizer</span>.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Only Authorizers can update value for Authorization status field&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">,</span>
                                    <span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">Authorized</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">authBy</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">;</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">authBy</span> <span class="o">&amp;&amp;</span> <span class="nx">authBy</span><span class="p">.</span><span class="nx">login</span> <span class="o">===</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span>
                  <span class="s1">&#39;Only Authorizers can update this field!&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AuthBy</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorizer&#39;</span>
    <span class="p">},</span>
    <span class="nx">AuthStatus</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorization status&#39;</span><span class="p">,</span>
      <span class="nx">Authorized</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>        <p id="0e8f0d03">This limitation is very strict.          However, you can write the rule differently to make the policy more lenient.          The rule that follows lets members of the accounting team choose another value for the <span class="control">Authorizer</span> field, even after the <span class="control">Authorization status</span> field has been set to <span class="control">Authorized</span>.          When a new authorizer is selected, the value of the <span class="control">Authorization status</span> field switches back to <span class="control">Required</span>.          This lets you handle cases where, for example, an authorizer leaves the company or is no longer the manager for the person who submitted the payment request.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Only Executors can change Authorizer in authorized requests&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthBy</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
           <span class="nx">fs</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">Authorized</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">isInGroup</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">executors</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span>
                  <span class="s1">&#39;Only Executors can change the Authorizer &#39;</span> <span class="o">+</span>
                  <span class="s1">&#39;after the request has been authorized!&#39;</span><span class="p">);</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">AuthStatus</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">Required</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AuthBy</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorizer&#39;</span>
    <span class="p">},</span>
    <span class="nx">AuthStatus</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorization status&#39;</span><span class="p">,</span>
      <span class="nx">Authorized</span><span class="o">:</span> <span class="p">{},</span>
      <span class="nx">Required</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nx">executors</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">UserGroup</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>    </div>    <div class="chapter"><h2 id="add-restrictions-based-on-field-combinations" data-toc="prevent-unwanted-updates-workflows#add-restrictions-based-on-field-combinations">Add Restrictions Based on Field Combinations</h2>        <p id="1e432252">The restrictions described in the previous section determine which users can update different fields.          You can also add restrictions that are based on field and value combinations.          For example, here’s a rule that won’t let anyone change the value for the <span class="control">State</span> field to <span class="control">Paid</span> unless the <span class="control">Authorization status</span> is <span class="control">Authorized</span>.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Request must be authorized to be marked as paid&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">becomes</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Paid</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">AuthStatus</span> <span class="o">&amp;&amp;</span>
                   <span class="nx">fs</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">AuthStatus</span><span class="p">.</span><span class="nx">Authorized</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                   <span class="s1">&#39;Only authorized requests can be marked as paid!&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">AuthStatus</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">EnumField</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Authorization status&#39;</span><span class="p">,</span>
      <span class="nx">Authorized</span><span class="o">:</span> <span class="p">{},</span>
    <span class="p">},</span>
    <span class="nx">State</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">Paid</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>        <p id="a1e6cd09">Here’s another variant. When the <span class="control">State</span> has been set to <span class="control">Paid</span>, the value that is stored in the <span class="control">Amount</span> field cannot be modified.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Block changes to Amount for paid requests&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Amount</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">;</span>
    <span class="nx">workflow</span><span class="p">.</span><span class="nx">check</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">State</span> <span class="o">&amp;&amp;</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">name</span> <span class="o">!==</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">Paid</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                  <span class="s1">&#39;You cannot change the Amount for paid requests!&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Amount</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Field</span><span class="p">.</span><span class="nx">floatType</span>
    <span class="p">},</span>
    <span class="nx">State</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">State</span><span class="p">.</span><span class="nx">fieldType</span><span class="p">,</span>
      <span class="nx">Paid</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>    </div><div class="last-modified" data-skip-index="skip">Last modified: 8 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="restrict-issue-visibility-workflow.html">Restrict Issue Visibility with Workflows</a><a class="navigation-links__next" href="streamline-issue-reporting-workflows.html">Streamline Issue Reporting</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>