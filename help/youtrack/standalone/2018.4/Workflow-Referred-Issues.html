<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Referred Issues - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Workflow-Referred-Issues"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.4 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Workflow-Referred-Issues" id="Workflow-Referred-Issues.xml">Referred Issues</h1>  <p id="2caca264">This workflow automatically adds a <span class="control">refers to</span> link when another issue is mentioned by its Id in a    comment or description.  </p>  <div class="table-wrapper"><table class="left_header                 " width="100%" id="672566cd"><tbody><tr id="bbfbb285" class="ijRowOdd"><th id="fee03de9" width="20%"><p>Name</p></th><td id="fe1ad3b9"><p>@jetbrains/youtrack-workflow-referred-issues</p></td></tr><tr id="363264d7" class="ijRowEven"><th id="a0758b64"><p>Auto-attached</p></th><td id="0d30de83"><p>no</p></td></tr><tr id="29184a51" class="ijRowOdd"><th id="8abd6192"><p>Modules</p></th><td id="efe05e17"><p>        <a href="#add-refers-to-link">Add "refers to" link to an issue when the issue ID is added to a description or comment</a>        (on-change rule)      </p></td></tr></tbody></table></div>  <div class="chapter"><h2 id="76abbabf">Use Case</h2>    <p id="7c5192bd">This workflow helps you automate the creation of links between related issues.</p>    <p id="012635d0">This workflow references an issue link type with the name <span class="control">refers to</span>.      This is a custom issue link type that is not available in YouTrack by default.      To use this workflow, you need to add this issue link type to your system.      When you create this issue link type, enter the following values:    </p>    <div class="table-wrapper"><table class="                 " width="100%" id="4966a281"><thead><tr id="b23a0321" class="ijRowHead"><th id="275687af" width="20%"><p>Field</p></th><th id="853a92f1"><p>Description</p></th></tr></thead><tbody><tr id="5954f0b8" class="ijRowOdd"><td id="b6f36907"><p>Name</p></td><td id="cbbb1430"><p>Reference (or any other name, this does not affect the workflow)</p></td></tr><tr id="b29c636e" class="ijRowEven"><td id="6cd6524d"><p>Outward Name</p></td><td id="74ffdc5f"><p>refers to</p></td></tr><tr id="a1758e88" class="ijRowOdd"><td id="5ab949e6"><p>Link Direction</p></td><td id="7d1ffbe7"><p>Undirected</p></td></tr></tbody></table></div>    <p id="9b9703e9">For general instructions, see <a href="Link-Types.html#Creating_Link_Type">Create an Issue Link Type</a>.    </p>  </div>  <div class="chapter"><h2 id="04383171">Modules</h2>    <p id="8c87b573">This on-change rule in this module checks the description and comment for an issue for references to other issues.      When one or more references are found, the issues are added as <span class="control">refers to</span> links.    </p>    <div class="chapter"><h3 id="add-refers-to-link">Add "refers to" link to an issue when the issue ID is added to a description or comment</h3>      <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="nx">workflow</span><span class="p">.</span><span class="nx">i18n</span><span class="p">(</span><span class="s1">&#39;Add &quot;refers to&quot; link to an issue when the issue ID is added to a description or comment&#39;</span><span class="p">),</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">added</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">startGroup</span> <span class="o">=</span> <span class="sr">/(^|[&#39;,;.:&quot;\\()?!&lt;&gt;#+|/\[\]\t\n\r ])/</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">endGroup</span> <span class="o">=</span> <span class="sr">/([&#39;,;.:&quot;\\()?!&lt;&gt;#+|/\[\]\t\n\r ]|$)/</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">issueIdGroup</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">project</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;-\\d+)&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">startGroup</span><span class="p">.</span><span class="nx">source</span> <span class="o">+</span> <span class="nx">issueIdGroup</span> <span class="o">+</span> <span class="nx">endGroup</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">added</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">()</span> <span class="o">?</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">description</span> <span class="o">:</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">added</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">text</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">allMentionedIssues</span> <span class="o">=</span> <span class="p">{};</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">matchedIssueId</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">trim</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">referringIssue</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">matchedIssueId</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">referringIssue</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">issue</span><span class="p">.</span><span class="nx">links</span><span class="p">[</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">RefersTo</span><span class="p">.</span><span class="nx">outward</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">referringIssue</span><span class="p">);</span>
          <span class="nx">allMentionedIssues</span><span class="p">[</span><span class="nx">matchedIssueId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">allAddedIssues</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">allMentionedIssues</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">allAddedIssues</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">workflow</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="nx">workflow</span><span class="p">.</span><span class="nx">i18n</span><span class="p">(</span><span class="s1">&#39;Automatically added \&#39;refers to\&#39; {0} links.&#39;</span><span class="p">,</span> <span class="nx">allAddedIssues</span><span class="p">.</span><span class="nx">join</span><span class="p">()));</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">RefersTo</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">IssueLinkPrototype</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Refers&#39;</span><span class="p">,</span>
      <span class="nx">outward</span><span class="o">:</span> <span class="s1">&#39;refers to&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>    </div>  </div><div class="last-modified" data-skip-index="skip">Last modified: 8 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Workflow-Spam-Blacklist.html">Profanity Blacklist</a><a class="navigation-links__next" href="Workflow-Replace-Links.html">Replace Links</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>