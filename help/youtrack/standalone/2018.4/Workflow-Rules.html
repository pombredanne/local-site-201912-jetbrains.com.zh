<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Workflow Rules - Help | YouTrack Standalone</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Workflow-Rules"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search YouTrack Standalone Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>YouTrack Standalone 2018.4 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><h1 data-toc="Workflow-Rules" id="Workflow-Rules.xml">Workflow Rules</h1>    <p id="ff48858d">YouTrack supports four different types of workflow rules. The rule type defines the general conditions that cause the rule to be executed.</p>    <p id="09faa102">When you write workflows in the workflow editor, you add modules to a workflow that define each rule.        The editor has different templates for each rule type.        You can also write custom scripts that let you organize and structure your code.        Use custom scripts to define your own functions and objects and use them in other rules and workflows.</p>    <div class="chapter"><h2 id="on-change-rules" data-toc="Workflow-Rules#on-change-rules">On-change Rules</h2>      <p id="6960cae6">A <span class="control">on-change</span> rule defines the action that is performed when a change is applied to an issue.            These rules replace the <span class="control">stateless</span> rules that were used in older workflows.</p>        <div class="chapter"><h3 id="sample-on-change-rule">Sample On-change Rule</h3>            <p id="d9eec6e3">This rule performs the following actions when a change is applied to an issue:</p>            <ul class="list _bullet"><li class="list__item" id="282cbd52"><p>YouTrack checks for a change to the value in the <span class="control">Subsystem</span> field.</p></li><li class="list__item" id="d8080fed"><p>If the value in the <span class="control">Subsystem</span> changes, the issue is automatically assigned to the owner of the subsystem.</p></li></ul>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onChange</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="nx">workflow</span><span class="p">.</span><span class="nx">i18n</span><span class="p">(</span><span class="s1">&#39;Set subsystem owner as assignee for unassigned issues&#39;</span><span class="p">),</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span> <span class="o">&amp;&amp;</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Subsystem</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">issue</span><span class="p">.</span><span class="nx">isReported</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Subsystem</span><span class="p">)</span> <span class="o">||</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">isChanged</span><span class="p">(</span><span class="s1">&#39;project&#39;</span><span class="p">)))</span> <span class="o">||</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">becomesReported</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span> <span class="o">=</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Subsystem</span><span class="p">.</span><span class="nx">owner</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Subsystem</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">OwnedField</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">},</span>
    <span class="nx">Assignee</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>        <p id="1ad6e819">The components that define this on-change rule are as follows:</p>        <ul class="list _ul"><li class="list__item" id="f2571425"><p>All scripts start with a list of <code class="code" data-lang="Java">require</code> statements.            In this rule, we declare a local variable <code class="code" data-lang="Java">entities</code> and reference the entities module in the workflow API.            This means that everything that is contained in this module can be accessed in this script with the <code class="code" data-lang="Java">entities</code> variable.</p></li><li class="list__item" id="98589c9b"><p>Each script exports one rule to the <code class="code" data-lang="Java">exports.rule</code> property.            The rule is declared with the <code class="code" data-lang="Java">Issue.onChange</code> method, which exports the script that follows the declaration as an on-change rule.</p></li><li class="list__item" id="26ce5ad1">The body of the rule itself contains three properties, as follows:            <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="67e220d6"><thead><tr id="1a6b01a7" class="ijRowHead"><th id="4cb4b392" width="20%"><p>Property</p></th><th id="74727f6c"><p>Description</p></th></tr></thead><tbody><tr id="84ddc90d" class="ijRowOdd"><td id="624e3045"><p>title</p></td><td id="fd6be6e9"><p>An optional human-readable title. The title is only visible in the administrative interface.</p></td></tr><tr id="a88abd19" class="ijRowEven"><td id="6e324f1b"><p>guard</p></td><td id="b363d7f9"><p>A function that determines the conditions for executing the rule.                  If the guard condition is not met, the action specified in the rule is not applied to an issue.</p></td></tr><tr id="b3a84ad1" class="ijRowOdd"><td id="b5aa6c2b"><p>action</p></td><td id="fd86e0c5"><p>The actions that should be applied to each issue.                        The action is declared as a function that accepts a context as an argument.<br><br>                    In this example, we check to see if the <span class="control">Subsystem</span> field was set to a non-null value that has a non-null owner.                    If so, the rule sets the value of the <span class="control">Assignee</span> field.</p></td></tr><tr id="49dee6db" class="ijRowEven"><td id="6fd38556"><p>runOn</p></td><td id="24ecab31">Determines which issue events trigger the on-change rule.                  When not specified, rules are triggered on issue update.                  This property is extended with the following parameters:                  <ul class="list _ul"><li class="list__item" id="c2dd077c"><p><code class="code" data-lang="Java">change</code> — when <code class="code" data-lang="Java">true</code>, the rule is triggered on issue change.</p></li><li class="list__item" id="75da0b5f"><p><code class="code" data-lang="Java">removal</code> — when <code class="code" data-lang="Java">true</code>, the rule is triggered when an issue is deleted.</p></li></ul>                  As the rule in this example is triggered when updates are applied, we don't need to specify values for this property.                </td></tr><tr id="8850fe36" class="ijRowOdd"><td id="dbd156e9"><p>requirements</p></td><td id="8b19dfd5"><p>The list of entities that are required for the rule to execute without errors.                    This property ensures that rules can be attached to projects safely.<br><br>                    In this example, the requirements ensure that both the <span class="control">Subsystem</span> and <span class="control">Assignee</span> fields store the correct types and are available in the project to which the rule is attached.                    If either field is absent, an error is shown in the <span class="control">Workflows</span> list.                    The rule cannot be enabled until the required fields are attached.</p></td></tr></tbody></table></div></li></ul>        </div>    </div>    <div class="chapter"><h2 id="on-schedule-rules" data-toc="Workflow-Rules#on-schedule-rules">On-schedule Rules</h2>      <p id="f08b6b17">An <span class="control">on-schedule</span> rule defines a set of changes that are applied according to a set schedule.            For example, you can periodically check for issues with specific attribute values and notify a user or a group.        These rules replace the <span class="control">scheduled</span> rules that were used in older workflows.</p>        <p id="ba7d2fa9">On-schedule rules are executed by a special workflow user.            This is a system user account that is granted a full set of permissions.            The permissions for this account cannot be modified.            The workflow user account is not included in the license restrictions and is not displayed in the users list.</p>          <div class="chapter"><h3 id="sample-on-schedule-rule">Sample On-schedule Rule</h3>            <p id="ffcba891">This rule executes every day at 10:00.              The rule checks for unresolved issues that are assigned and contain a value in the <span class="control">Due Date</span> field.              If the due date is in the past, a notification is sent to the assignee.</p>            <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">onSchedule</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Notify an Assignee when Due Date is expired&#39;</span><span class="p">,</span>
  <span class="nx">search</span><span class="o">:</span> <span class="s1">&#39;#Unresolved has: Assignee has: {Due Date}&#39;</span><span class="p">,</span>
  <span class="nx">cron</span><span class="o">:</span> <span class="s1">&#39;0 0 10 * * ?&#39;</span><span class="p">,</span>
  <span class="nx">muteUpdateNotifications</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">DueDate</span> <span class="o">&lt;</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
    <span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;[YouTrack] Overdue&#39;</span><span class="p">,</span> <span class="s1">&#39;Issue &#39;</span> <span class="o">+</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; is overdue.&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Assignee</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">},</span>
    <span class="nx">DueDate</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Field</span><span class="p">.</span><span class="nx">dateType</span><span class="p">,</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Due Date&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>        <p id="0f58ecae">The components that define this on-schedule rule are as follows:</p>        <ul class="list _ul"><li class="list__item" id="2d82b895"><p>Again, the script starts with a <code class="code" data-lang="Java">require</code> statement that references the entities module in the workflow API.                This means that everything that is contained in this module can be accessed in this script with the <code class="code" data-lang="Java">entities</code> variable.</p></li><li class="list__item" id="a68651fc"><p>For this rule, the <code class="code" data-lang="Java">exports.rule</code> property uses the <code class="code" data-lang="Java">Issue.onSchedule</code> method.                This exports the script that follows the declaration as an on-schedule rule.</p></li><li class="list__item" id="25c09275">The body of the rule itself contains definitions for the following properties:                <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="2bf1d7bf"><thead><tr id="6015bac8" class="ijRowHead"><th id="ab373a44" width="20%"><p>Property</p></th><th id="23db1401"><p>Description</p></th></tr></thead><tbody><tr id="b0fa839e" class="ijRowOdd"><td id="d3a0b7e4"><p>title</p></td><td id="bcd48a77"><p>An optional human-readable title. The title is only visible in the administrative interface.</p></td></tr><tr id="2c3afaef" class="ijRowEven"><td id="f638d24f"><p>search</p></td><td id="23433ea5"><p>A search query that determines which issues are processed by this rule.                        It can be a string that uses the syntax for a standard YouTrack search query (see <a href="Search-and-Command-Attributes.html"><span>Search Query Reference</span></a>) or a function that recalculates a search string every time the rule is triggered.<br><br>                        When you use a function, reference it by name. For example, <code class="code" data-lang="Java">search: getSearchExpression</code>.<br><br>                        We strongly recommend that you make the search expression as concrete as possible, instead of adding conditions inside the action.</p></td></tr><tr id="7d04a5d0" class="ijRowOdd"><td id="ff5968cd"><p>cron</p></td><td id="46bb7c0b"><p>The schedule for applying the rule, specified as a <a href="http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>Java cron expression</span></a>.<br><br>                        In this example, the expression triggers this rule every day at 10:00 in the time zone that is set for your YouTrack server.                                                      </p></td></tr><tr id="2c15c390" class="ijRowEven"><td id="d849ec53"><p>muteUpdateNotifications</p></td><td id="b88fe24d"><p>A flag that determines whether update notifications are sent for changes that are applied by this rule.                    If you want to apply updates without sending notifications, set to <code class="code" data-lang="Java">true</code>.<br><br>                      When <code class="code" data-lang="Java">true</code> this property also suppresses notifications for cascading changes that are applied in the same transaction.                      For example, when updates that are applied by the on-schedule rule trigger updates from one or more on-change rules, the entire set of changes is applied silently.<br><br>                      The value for this property does not affect notifications that are explicitly sent, as with the <span class="control">.notify</span> method that is used in this example.<br><br>                    This property is not relevant to this example, as the rule does not apply any issue changes.                    Even if it were set to <code class="code" data-lang="Java">true</code>, the email notification that is sent using the <code class="code" data-lang="Java">.notify</code> method is still delivered.</p></td></tr><tr id="de3c4831" class="ijRowOdd"><td id="e0cd4e05"><p>guard</p></td><td id="e2cb97bb"><p>A function that determines the conditions for executing the rule.                      If the guard condition is not met, the action specified in the rule is not applied to an issue.</p></td></tr><tr id="86aeac99" class="ijRowEven"><td id="f08a1731"><p>action</p></td><td id="e86890bc"><p>The actions that should be applied to each issue that matches the search condition.                            This action is triggered separately for each issue.                            The action itself is performed by the workflow user account.<br><br>                            In this example, we use the <code class="code" data-lang="Java">Assignee.notify</code> method to warn the current assignee that the issue is overdue.</p></td></tr><tr id="ffe4147d" class="ijRowOdd"><td id="19f7d357"><p>requirements</p></td><td id="85e13863"><p>The list of entities that are required for the rule to execute without errors.                            This property ensures that rules can be attached to projects safely.<br><br>                            In this example, the requirements ensure that both the <span class="control">Assignee</span> and <span class="control">Due Date</span> fields store the correct types and are available in the project to which the rule is attached.                                If either field is absent, an error is shown in the <span class="control">Workflows</span> list.                                The rule cannot be enabled until the required fields are attached.</p></td></tr></tbody></table></div></li></ul>      </div>    </div>    <div class="chapter"><h2 id="action-rules" data-toc="Workflow-Rules#action-rules">Action Rules</h2>        <p id="b4221a8f">An <span class="control">action</span> rule lets you extend YouTrack with actions that can be applied as commands or accessed directly from the issue toolbar.</p>  <div class="chapter"><h3 id="sample-action-rule">Sample Action Rule</h3>        <p id="66f13a4e">This rule enables a command that automatically assigns issues to the current user.            This command can be applied to one or more issues at once.</p>        <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">action</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Take this issue!&#39;</span><span class="p">,</span>
  <span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;take&#39;</span><span class="p">,</span>
  <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">isReported</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Assignee</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>        <p id="69f319e2">The components that define this action rule are as follows:</p>        <ul class="list _ul"><li class="list__item" id="671a5b10"><p>As usual, the script starts with a <code class="code" data-lang="Java">require</code> statement that references the entities module in the workflow API.</p></li><li class="list__item" id="f35213da"><p>The <code class="code" data-lang="Java">exports.rule</code> property uses the <code class="code" data-lang="Java">Issue.action</code> method to export the script that follows the declaration as an action rule.</p></li><li class="list__item" id="3064bdad">The body of the rule itself contains definitions for the following properties:                <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="0cc4cb18"><thead><tr id="dd301a70" class="ijRowHead"><th id="f84952aa" width="20%"><p>Property</p></th><th id="2c94da2e"><p>Description</p></th></tr></thead><tbody><tr id="3e03b1b0" class="ijRowOdd"><td id="02bb9924"><p>title</p></td><td id="555cb044"><p>A human-readable title.                            The title is used as the label for the command in the <span class="control">Apply Command</span> dialog and the item in the <span class="control">Command Dialog</span> list in the issue toolbar.                        If this property is not set, the command is not added to the menu.</p></td></tr><tr id="65943937" class="ijRowEven"><td id="b2ce26f6"><p>command</p></td><td id="1d5962a9"><p>The text that is used for the custom command.                        When this command is applied to one or more issues, the actions that are defined in this rule are executed.                        Commands are defined server-wide, which means that you cannot have two action rules with the same command even when these rules are attached to different projects.</p></td></tr><tr id="5177ede6" class="ijRowOdd"><td id="d5b76e39"><p>guard</p></td><td id="2f268bc2"><p>The condition that determines when the action rule is enabled.<br><br>                            If the guard condition is not met, the custom command cannot be applied to an issue.                                The command is not suggested in the <span class="control">Apply Command</span> dialog and its title is not visible in the issue toolbar.</p></td></tr><tr id="cdb33525" class="ijRowEven"><td id="241a7c8c"><p>action</p></td><td id="8ae6ffcf"><p>The changes that should be applied to each of the issues that are selected when the command is applied.                            This action is executed separately for each issue.                            The changes are made on behalf of the user who applies the command.<br><br>                            In this example, we simply assign all of the selected issues to the current user.</p></td></tr><tr id="d72afeee" class="ijRowOdd"><td id="6406b54e"><p>requirements</p></td><td id="67bbadab"><p>The list of entities that are required for the rule to execute without errors.                            This property ensures that rules can be attached to projects safely.<br><br>                            In this example, we only require that there is an <span class="control">Assignee</span> field that stores a <code class="code" data-lang="Java">user</code> type in the projects to which the rule is attached.                                If this field is absent, an error is shown in the <span class="control">Workflows</span> list.                                The rule cannot be enabled until the required field is attached.</p></td></tr></tbody></table></div></li></ul>  </div>    </div>    <div class="chapter"><h2 id="state-machine-rules" data-toc="Workflow-Rules#state-machine-rules">State-machine Rules</h2>      <p id="13a1ae2b">A <span class="control">state-machine</span> rule regulates the transitions from one value to another for a custom field.            You can apply a state-machine rule to any custom field.            However, the most common use case for a state-machine rule is to regulate transitions between values for the <span class="control">State</span> field or another custom field that stores a <code class="code" data-lang="Java">state</code> type.</p>        <p id="7d4aad96">When a state-machine rule is applied to a project, the options that are shown in the drop-down list for the field are restricted to the transitions that are defined in the state-machine rule for the current state.        Custom fields that are regulated by a state-machine rule are marked with a <span class="control">Workflow-driven field</span> icon.        The action that is defined for each value in the state-machine rule is displayed in the drop-down list. The actual values are shown to the right.        The following image illustrates how the list of allowed transitions for the <span class="control">State</span> field changes based on the current value.</p>        <aside class="warning " data-title="" rel="7d4aad96" id="5d4986f6">            <p id="51f6a6a3">The allowed transitions for each value are displayed even when you have defined a guard that potentially blocks the selection of the value.                If the guard condition is not met, the selection is ignored.</p>            <p id="43672cb2">If you add guards to your transitions, be sure to use the <code class="code" data-lang="Java">workflow.message</code> method to explain the restriction that is applied by the workflow.</p>        </aside>        <figure><a class="lightbox" href="/help/img/youtrack/2018.4/statemachine-field-values.zoomed.png"><img alt="Statemachine field values" title="Statemachine field values" src="/help/img/youtrack/2018.4/statemachine-field-values.png" id="96691b4b" width="600" height="219"></a></figure>        <p id="28205a63">For each transition, you can add one or more actions.            Additional properties for each transition determine how these actions are applied.</p>        <ul class="list _ul"><li class="list__item" id="77991c01"><p>Transitions that use <code class="code" data-lang="Java">onEnter</code> and <code class="code" data-lang="Java">onExit</code> properties perform an action when the value for the field is set.            These actions are executed by the user who changes the value of the field.</p></li><li class="list__item" id="453c4e8d"><p>Transitions that use the <code class="code" data-lang="Java">after</code> property perform an action after the specified time frame.            These actions are executed by the workflow user account.</p></li></ul>  <div class="chapter"><h3 id="sample-state-machine-rule">Sample State-machine Rule</h3>            <p id="ca4d9168">This example shows a simplified state-machine rule.              This rule defines the transitions that are allowed for the <span class="control">Status</span> field.</p>            <p id="85482548">The following transitions are defined in this rule:</p>            <ul class="list _ul"><li class="list__item" id="1d4e7f02"><p>From the initial <span class="control">Open</span> state, the value can change to <span class="control">In progress</span>.                An additional transition with the name <code class="code" data-lang="Java">reminder</code> includes an <code class="code" data-lang="Java">after</code> property that reminds the project owner if an issue remains in the <span class="control">Open</span> state for more than two days.</p></li><li class="list__item" id="7fdc5580"><p>From <span class="control">In progress</span>, the value can change to <span class="control">Fixed</span> or <span class="control">Open</span>.              The definition for this transition includes an <code class="code" data-lang="Java">onEnter</code> property.              The function defined in this property assigns the issue to the user who sets the value of the field to <span class="control">In progress</span>.</p></li><li class="list__item" id="fc5a7c95"><p>The final state is <span class="control">Fixed</span>. There are no additional transitions that are defined for this value.                Once this value is set, it cannot be changed.</p></li></ul>                  <div class="code-block" data-lang="Javascript"><code class="code-block__wrapper"><span class="kd">var</span> <span class="nx">entities</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/entities&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">workflow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@jetbrains/youtrack-scripting-api/workflow&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">TWO_DAYS</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">rule</span> <span class="o">=</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">Issue</span><span class="p">.</span><span class="nx">stateMachine</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Status state-machine&#39;</span><span class="p">,</span>
  <span class="nx">fieldName</span><span class="o">:</span> <span class="s1">&#39;Status&#39;</span><span class="p">,</span>
  <span class="nx">states</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Open</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">initial</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">transitions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">start</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">targetState</span><span class="o">:</span> <span class="s1">&#39;In progress&#39;</span>
        <span class="p">},</span>

        <span class="nx">reminder</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">targetState</span><span class="o">:</span> <span class="s1">&#39;Open&#39;</span><span class="p">,</span>
          <span class="nx">after</span><span class="o">:</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">TWO_DAYS</span><span class="p">,</span>
          <span class="nx">action</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">issue</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">;</span>
            <span class="nx">issue</span><span class="p">.</span><span class="nx">project</span><span class="p">.</span><span class="nx">leader</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;Reminder&#39;</span><span class="p">,</span> <span class="s1">&#39;Check out an issue &#39;</span> <span class="o">+</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;In progress&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">onEnter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">onExit</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">},</span>
      <span class="nx">transitions</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">fix</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">targetState</span><span class="o">:</span> <span class="s1">&#39;Fixed&#39;</span>
        <span class="p">},</span>
        <span class="nx">reopen</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">guard</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">Assignee</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">workflow</span><span class="p">.</span><span class="nx">message</span><span class="p">(</span><span class="s1">&#39;You cannot reopen an issue unless you unassign it first&#39;</span><span class="p">);</span>
              <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">},</span>
          <span class="nx">targetState</span><span class="o">:</span> <span class="s1">&#39;Open&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">Fixed</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">transitions</span><span class="o">:</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">requirements</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">Assignee</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="nx">entities</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">fieldType</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></code></div>      <p id="3119f6d1">The components that define this state-machine rule are as follows:</p>      <ul class="list _ul"><li class="list__item" id="626d2595"><p>The <code class="code" data-lang="Java">require</code> statements reference the <code class="code" data-lang="Java">entities</code> module and the <code class="code" data-lang="Java">workflow</code> module in the workflow API.</p></li><li class="list__item" id="bdd2fcd5"><p>The <code class="code" data-lang="Java">exports.TWO_DAYS</code> property sets a local variable that is used to send the reminder for issues that have the <span class="control">Open</span> status.        This variable is assigned a value that equals 2 days in milliseconds.</p></li><li class="list__item" id="226f2893"><p>The <code class="code" data-lang="Java">exports.rule</code> property uses the <code class="code" data-lang="Java">Issue.stateMachine</code> method to export the script that follows the declaration as a state-machine rule.</p></li><li class="list__item" id="73fe381d">The body of the rule itself contains definitions for the following properties:          <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="7fc1fd6f"><thead><tr id="40d47201" class="ijRowHead"><th id="4b50edbe" width="20%"><p>Property</p></th><th id="3464bd10"><p>Description</p></th></tr></thead><tbody><tr id="3bf37a2c" class="ijRowOdd"><td id="537dfe74"><p>title</p></td><td id="a763c684"><p>An optional human-readable title.</p></td></tr><tr id="d185f4aa" class="ijRowEven"><td id="d51239d7"><p>fieldName</p></td><td id="8348a037"><p>The name of the custom field that is managed by the state-machine.</p></td></tr><tr id="2af6c4da" class="ijRowOdd"><td id="2bc522dd"><p>states</p></td><td id="a8951743"><p>The list of field values and definitions for the transitions between them.              Values that contain spaces and special characters are set in single quotes.</p></td></tr><tr id="c4dbbe7f" class="ijRowEven"><td id="53b29b39"><p>requirements</p></td><td id="8b1087eb"><p>The list of entities that are required for the rule to execute without errors.                This property ensures that rules can be attached to projects safely.<br><br>                In this example, we only require that there is an <span class="control">Assignee</span> field that stores a <code class="code" data-lang="Java">user</code> type in the projects to which the rule is attached.                  If this field is absent, an error is shown in the <span class="control">Workflows</span> list.                  The rule cannot be enabled until the required field is attached.<br><br>              For a state-machine rule, you do not need to add the field that is managed by the state-machine to the requirements.              This field and its values are derived from the <code class="code" data-lang="Java">states</code> property.</p></td></tr></tbody></table></div></li><li class="list__item" id="c256b837">Each of the values that are defined in the <code class="code" data-lang="Java">states</code> property contain definitions for the following additional properties:          <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="dc0dbcee"><thead><tr id="92f57790" class="ijRowHead"><th id="c66f2a98" width="20%"><p>Property</p></th><th id="06899ef1"><p>Description</p></th></tr></thead><tbody><tr id="c15e2beb" class="ijRowOdd"><td id="a85e9f39"><p>initial</p></td><td id="13985283"><p>A Boolean property that determines which of the values in the list is set when an issue is created.                Exactly one value must set this property to <code class="code" data-lang="Java">true</code>.                For other values that are not set as the initial value, this property is optional and can be omitted.</p></td></tr><tr id="814c712c" class="ijRowEven"><td id="8a3d2e8b"><p>onEnter</p></td><td id="3d94e97b"><p>An optional function declaration that is called when the corresponding value is assigned to an issue.                These functions behave similar to actions in other types of rules.</p></td></tr><tr id="e4c17deb" class="ijRowOdd"><td id="0fd166fa"><p>onExit</p></td><td id="51de15e3"><p>An optional function declaration that is called when the field value is changed from the current value to another value.                These functions behave similar to actions in other types of rules.</p></td></tr><tr id="41a9d5c6" class="ijRowEven"><td id="9a13e732"><p>transitions</p></td><td id="48a480a9"><p>The list of possible target values that can be set for each value in the list.<br><br>                In this example, we only require that there is an <span class="control">Assignee</span> field that stores a <code class="code" data-lang="Java">user</code> type in the projects to which the rule is attached.                  If this field is absent, an error is shown in the <span class="control">Workflows</span> list.                  The rule cannot be enabled until the required field is attached.<br><br>                For a state-machine rule, you do not need to list the values that are used by fields that are managed by the state-machine in the requirements.                  This field and its values are derived from the <code class="code" data-lang="Java">states</code> property.</p></td></tr></tbody></table></div>        </li><li class="list__item" id="0a516bdc">Each of the values that are defined in the <code class="code" data-lang="Java">transitions</code> property contain a <code class="code" data-lang="Java">name</code> property.          The name is used to set this value in a command and is also shown in the list of values for a custom field.          Each transition name contains definitions for the following additional properties:          <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="860bf6dd"><thead><tr id="e93e3766" class="ijRowHead"><th id="4bdf3c84" width="20%"><p>Property</p></th><th id="aa64a856"><p>Description</p></th></tr></thead><tbody><tr id="866bc46e" class="ijRowOdd"><td id="d62564ed"><p>targetState</p></td><td id="4c9e9de5"><p>The actual name of the value that is set when the command specified in the <code class="code" data-lang="Java">name</code> property is applied.</p></td></tr><tr id="be53b8d8" class="ijRowEven"><td id="e0f8721d"><p>after</p></td><td id="e1be7f9f"><p>An optional property that sets an interval for performing an action.              The action itself is specified in the <code class="code" data-lang="Java">action</code> property.</p></td></tr><tr id="89eb4ce0" class="ijRowOdd"><td id="d25ef979"><p>action</p></td><td id="60650675"><p>An optional property for any transition that behaves similar to actions in other types of rules..</p></td></tr><tr id="49085937" class="ijRowEven"><td id="1ff88deb"><p>guard</p></td><td id="1f3dfabd"><p>An optional condition that determines when the transition is allowed.                If the guard condition is not met, the value for the custom field cannot change to the value that is defined for this transition.<br><br>              In this example, for an issue to transition from <span class="control">In progress</span> back to an <span class="control">Open</span> state, the issue must be unassigned.              The guard contains a function that uses the <code class="code" data-lang="Java">message</code> method from the <code class="code" data-lang="Java">workflow</code> module to provide feedback to the user who attempts to reopen an issue without unassigning it first.</p></td></tr></tbody></table></div>        </li></ul>  </div>    </div><div class="last-modified" data-skip-index="skip">Last modified: 8 March 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Quick-Start-Guide-Workflows-JS.html">JavaScript Workflow Quick Start Guide</a><a class="navigation-links__next" href="custom-scripts.html">Custom Scripts</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>