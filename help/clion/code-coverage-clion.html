<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>代码覆盖率-帮助|帮助里昂</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Code_Coverage_CLion" data-breadcrumbs="Profiling_Tools.xml|Dynamic Code Analysis/Code_Coverage_CLion.xml|Code Coverage" data-main-title="Code Coverage"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索CLion帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>CLion 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_default_for_macos" data-group="primary">macOS的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_macos" data-group="primary">Eclipse（macOS）</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_sublime_text_macos" data-group="primary">崇高文字（macOS）</option><option value="primary_xcode" data-group="primary">Xcode</option><option value="primary_resharper" data-group="primary">锐化器</option><option value="primary_resharper_macos" data-group="primary">ReSharper（macOS）</option><option value="secondary_default_for_windows" data-group="secondary">Windows的默认设置</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option><option value="secondary_xcode" data-group="secondary">Xcode</option><option value="secondary_resharper" data-group="secondary">锐化器</option><option value="secondary_resharper_macos" data-group="secondary">ReSharper（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Code_Coverage_CLion.xml" data-toc="Code_Coverage_CLion">代码覆盖率</h1>   <p id="e4cc789c">在CLion中，您可以运行CMake应用程序并使用代码覆盖率度量进行测试。代码覆盖率结果提供了运行期间执行的代码行的百分比以及命中特定行的次数。</p>    <div class="chapter"><h2 id="compiler-plags" data-toc="Code_Coverage_CLion#compiler-plags">编译器标志，覆盖代码</h2>        <p id="4c0a3c2a">CLion依靠<a href="https://llvm.org/docs/CommandGuide/llvm-cov.html" rel="noopener noreferrer" data-external="true" target="_blank">llvm-cov</a> / <a href="https://gcc.gnu.org/onlinedocs/gcc/Gcov.html#Gcov" rel="noopener noreferrer" data-external="true" target="_blank">gcov</a>集成来收集和显示代码的代码覆盖率数据。这些工具要求您在<span class="filepath">CMakeLists.txt</span>脚本中提供特殊的coverage编译器标志。为此，您可以使用<code class="code">set(CMAKE_CXX_FLAGS "")</code>或其他替代方法，例如<a href="https://cmake.org/cmake/help/latest/command/add_compile_options.html" rel="noopener noreferrer" data-external="true" target="_blank">add_compile_options</a>命令。</p>        <p id="031d17b4">根据您的编译器和您喜欢的coverage工具，请参见下面的标志选项。</p>               <ul class="list _bullets"><li class="list__item" id="14215872">            <p id="094856b4"><span class="control">海湾合作委员会</span></p>            <p id="50703897"><code class="code">-fprofile-arcs -ftest-coverage</code>要么<code class="code">--coverage</code>            </p>            <p id="dc880562">在这种情况下，将使用<span class="emphasis">gcov</span>工具。</p>        </li><li class="list__item" id="2c963c68">            <p id="29245133"><span class="control">铛</span></p>            <p id="d6eb1caa">您在这里有两个选择：</p>            <ul class="list _bullets"><li class="list__item" id="e2ee76a1"><p>使用与GCC相同的标志来获取<a href="https://llvm.org/docs/CommandGuide/llvm-cov.html#llvm-cov-gcov" rel="noopener noreferrer" data-external="true" target="_blank">llvm-cov gcov</a>收集的gcov样式覆盖率。</p></li><li class="list__item" id="36f70e1e"><p>使用<code class="code">-fprofile-instr-generate -fcoverage-mapping</code>调用<a href="https://llvm.org/docs/CommandGuide/llvm-profdata.html" rel="noopener noreferrer" data-external="true" target="_blank">Clang基于工具的配置文件</a> ，该<a href="https://llvm.org/docs/CommandGuide/llvm-profdata.html" rel="noopener noreferrer" data-external="true" target="_blank">配置</a>文件使用一对<code class="code">llvm-profdata merge</code>和<code class="code">llvm-cov export</code>命令。</p></li></ul>        </li></ul>        <aside class="prompt" rel="b729d137" id="210394e1" data-type="note" data-title=""><p>如果在使用<span class="emphasis">gcov</span>编译器标志构建项目时遇到链接器错误，请尝试将相同的标志通过传递给链接器<code class="code">add_link_options</code>要么<code class="code">set(CMAKE_EXE_LINKER_FLAGS "")</code> 。</p></aside>    </div>    <div class="chapter"><h2 id="run-coverage" data-toc="Code_Coverage_CLion#run-coverage">覆盖运行CMake应用程序或测试</h2>        <p id="93c9d2a1">在使用添加的标志重新加载项目后，可以对<a href="run-debug-configuration-application.html">CMake应用程序</a>和测试配置使用<span class="control">“覆盖运行”</span>操作（ <a href="run-debug-configuration-boost-test.html">Boost。Test</a> ， <a href="run-debug-configuration-google-test.html">Google Test</a>或<a href="run-debug-configuration-catch.html">Catch</a> ）。</p>        <p id="97ae1fa7">可从配置切换器旁边的工具栏和装订线菜单中获得<span class="control">“运行Coverage”</span> ：</p>        <p id="a5e8915b"></p><figure><img alt="覆盖范围内运行" title="覆盖范围内运行" src="/help/img/idea/2019.3/cl_coverage_configaction.png" id="05f4815a" width="519" height="158"></figure><p></p>        <p id="3aaabeb8"></p><figure><img alt="覆盖范围内运行" title="覆盖范围内运行" src="/help/img/idea/2019.3/cl_coverage_gutteraction.png" id="c3a7c562" width="519" height="324"></figure><p></p>    </div>    <div class="chapter"><h2 id="read-results" data-toc="Code_Coverage_CLion#read-results">阅读覆盖范围结果</h2>        <ul class="list _bullets"><li class="list__item" id="9fb7dc37"><p>险种数据准备就绪后，险种工具窗口会自动打开。它显示了启动过程中每个文件夹包含的文件百分比和每个文件包含的行数：</p><figure><img alt="覆盖工具窗口" title="覆盖工具窗口" src="/help/img/idea/2019.3/cl_coverage_resultstoolwindow.png" id="cbfe005d" width="377" height="718"></figure>        <p></p></li><li class="list__item" id="fc743db3">            <p id="20c29948">在任何文件中，您都可以检查装订线指示器，然后在特定行旁边单击它以了解它被击打了多少次：</p><figure><img alt="覆盖线点击" title="覆盖线点击" src="/help/img/idea/2019.3/cl_coverage_linehits.png" id="55e695a5" width="474" height="926"></figure><p></p>            <p id="769a6525">完全执行的行标记为绿色。黄色标记表示它仅部分执行。</p>            <p id="7aab35e7">要修改覆盖范围突出显示的颜色，请单击<img class="inline-icon-16" src="/help/img/idea/2019.3/icons.general.settings@2x.png" width="16" alt="图标常规设置">或转到<span class="menupath" data-skip-index="skip">设置/首选项|编辑器配色方案|常规</span>并展开“ <span class="control">线路覆盖”</span>节点。</p>        </li><li class="list__item" id="58918796"><p>CLion还在“项目”视图中显示覆盖率统计信息：</p><figure><img alt="项目视图中的代码覆盖率结果" title="项目视图中的代码覆盖率结果" src="/help/img/idea/2019.3/cl_coverage_projectview.png" id="f15c8ba4" width="403" height="260"></figure>        <p></p></li></ul>    </div>    <div class="chapter"><h2 id="merge-results" data-toc="Code_Coverage_CLion#merge-results">合并多次运行的结果</h2>        <p id="ea505564">重新运行覆盖率分析时，CLion会提示您选择显示新结果的方式：</p>        <figure><img alt="合并多个覆盖套件" title="合并多个覆盖套件" src="/help/img/idea/2019.3/cl_coverage_severalsuites.png" id="235e1f61" width="657" height="299"></figure>        <p id="f3622a20">            <span class="control">添加到活动套件</span> –新结果将添加到以前收集的统计信息中。</p>        <p id="b36b094b">            <span class="control">替换活动套件</span> –已经收集的数据将被覆盖。</p>        <p id="e572c6dc"><span class="control">不要应用收集的覆盖率数据</span> -新结果将被忽略。</p>    </div>    <div class="chapter"><h2 id="settings" data-toc="Code_Coverage_CLion#settings">配置覆盖率设置</h2>        <p id="bdc2a944">代码覆盖率设置收集在“ <span class="menupath" data-skip-index="skip">设置/首选项” |</span> “ <span class="menupath" data-skip-index="skip">设置”中。构建，执行，部署|承保范围</span> ：</p><figure><img alt="代码覆盖率设置" title="代码覆盖率设置" src="/help/img/idea/2019.3/cl_coverage_settings.png" id="fff4d9ed" width="664" height="750"></figure>        <p></p>        <p id="cbd3ef2e">在“ <span class="control">工具”</span>部分，您可以提供<span class="emphasis">gcov</span> / <span class="emphasis">llvm-cov</span> / <span class="emphasis">llvm-profdata的</span>自定义路径。默认情况下，CLion从<code class="code">PATH</code>环境易变。</p>        <p id="52628cad"><span class="control">记录分支覆盖率数据</span> -启用此选项后，收集覆盖率数据时将考虑编译器生成的代码分支。这意味着，如果编译器将代码行扩展为几个分支的块，而其中一些分支尚未执行（例如，在处理异常的情况下），则该行将被标记为部分覆盖。</p>    </div>    <div class="chapter"><h2 id="troubleshoot-and-limits" data-toc="Code_Coverage_CLion#troubleshoot-and-limits">故障排除和当前限制</h2>        <ul class="list _bullets"><li class="list__item" id="7f711561"><p>如果您得到空的覆盖率报告，请检查您的<span class="control">编译器版本</span>是否<span class="control">与</span>您正在使用<span class="control">的gcov / llvm-cov</span>工具<span class="control">的版本</span> （默认或自定义） <span class="control">匹配</span> 。在<a href="how-to-switch-compilers-in-clion.html">更改编译器</a>或从一个<a href="quick-tutorial-on-configuring-clion-on-windows.html">Windows工具链</a>切换到另一个<a href="quick-tutorial-on-configuring-clion-on-windows.html">Windows工具链</a>时，请记住这一点。</p></li><li class="list__item" id="0e8a2ab8"><p><a href="remote-projects-support.html">远程工具链</a> （ <a href="https://youtrack.jetbrains.com/issue/CPP-17709" rel="noopener noreferrer" data-external="true" target="_blank">CPP-17709</a> ）尚不支持代码覆盖率。</p></li></ul>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年12月1日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="cpu-profiler.html">探查器</a> <a class="navigation-links__next" href="deploying-applications.html">部署</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>