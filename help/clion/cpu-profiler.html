<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Profiler - Help | CLion</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="procedures.profiler" data-breadcrumbs="Profiling_Tools.xml|Dynamic Code Analysis/CPU_Profiler.xml|Profiler" data-main-title="Profiler"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search CLion Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>CLion 2019.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default_for_windows" selected>Default for Windows</option><option data-group="primary" value="primary_default_for_macos">Default for macOS</option><option data-group="primary" value="primary_intellij_idea_classic_macos">IntelliJ IDEA Classic (macOS)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_macos">Eclipse (macOS)</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_sublime_text">Sublime Text</option><option data-group="primary" value="primary_sublime_text_macos">Sublime Text (macOS)</option><option data-group="primary" value="primary_xcode">Xcode</option><option data-group="primary" value="primary_resharper">ReSharper</option><option data-group="primary" value="primary_resharper_macos">ReSharper (macOS)</option><option data-group="secondary" value="secondary_default_for_windows">Default for Windows</option><option data-group="secondary" value="secondary_default_for_macos">Default for macOS</option><option data-group="secondary" value="secondary_intellij_idea_classic">IntelliJ IDEA Classic</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_macos">Eclipse (macOS)</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_sublime_text">Sublime Text</option><option data-group="secondary" value="secondary_sublime_text_macos">Sublime Text (macOS)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_macos">ReSharper (macOS)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="procedures.profiler" id="CPU_Profiler.xml">Profiler</h1>                             <p id="Intro">         With CLion's CPU profiler integration, you can analyze the metrics of performance collected for your application (both kernel and user's code).             The profiler is available on <span class="control">Linux and macOS</span>,             and the implementation is based on the <a href="https://perf.wiki.kernel.org/index.php/Main_Page" data-external="true" target="_blank" rel="noopener noreferrer">Perf</a>             and <a href="http://dtrace.org/blogs/about/" data-external="true" target="_blank" rel="noopener noreferrer">DTrace</a> tools respectfully.             In the current state, you can run the profiler for <span class="control">CMake and Gradle projects</span>.             Note that it is <span class="emphasis">not supported</span> for WSL toolchain and remote development mode.         </p>    <p id="f226d0e1">        <span class="control">Perf</span> and <span class="control">DTrace</span> use <span class="control">sampling at a fixed rate</span> to interrupt the application        and collect program counter and stack traces, which are then translated into profiling reports. Such reports can be long and        difficult to analyze, so CLion provides <span class="control">visualization</span> for the profiler's output data.    </p>            <div class="chapter"><h2 id="Prerequisites" data-toc="procedures.profiler#Prerequisites">Prerequisites</h2>                <div class="tabs" id="90ca3ef6"><div class="tabs__content" data-title="Linux" id="74a153cc">                <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="9433e225">                        <p id="a37a4088">                        Install the <span class="control">Perf</span> tool for your <span class="control">particular kernel release</span>.                        </p>                        <p id="499c87c4">Use <code class="code">uname -r</code>                        to find out the exact version,                        and then install the corresponding <span class="filepath">linux-tools</span> package. For example:                    <div class="code-block" data-lang="bash">
                        $ uname -r
                        4.15.0-36-generic
                        $ sudo apt-get install linux-tools-4.15.0-36-generic
    </div>                        </p>                    </li><li class="list__item" id="6df53976">                        <p id="3682fb3f"><span class="control">Adjust kernel options</span></p>                                                                    <ul class="list _bullet"><li class="list__item" id="43c6bcec"><p id="7fd7cc88">                                <i id="14ffa615">perf_event_paranoid</i> - controls the use of the performance events data by non-root users.                             </p>                                <p id="986a2f92">                                Set the value to be less than 2 to let the profiler collect performance information without root privileges:                            <div class="code-block" data-lang="bash">
                                sudo sh -c 'echo 1 &gt;/proc/sys/kernel/perf_event_paranoid'
    </div>                                </p>                            </li><li class="list__item" id="ed916031"><p id="99b2d37a">                                <i id="3cafc6f3">kptr_restrict</i> - sets restrictions on exposing kernel addresses.                            </p>                                <p id="a6471dc2">                                To have kernel symbols properly resolved, disable the protection offered by <i id="4daf1519">kptr_restrict</i> by setting its value to 0:                                <div class="code-block" data-lang="bash">
                                    sudo sh -c 'echo 0 &gt;/proc/sys/kernel/kptr_restrict'
    </div>                                </p>                            </li></ul>                        <p id="0a42192e">By default, these changes affect your current OS session only. To keep the settings across system reboots, run:</p>                        <div class="code-block" data-lang="bash">
                            sudo sh -c 'echo kernel.perf_event_paranoid=1 &gt;&gt; /etc/sysctl.d/99-perf.conf'
                            sudo sh -c 'echo kernel.kptr_restrict=0 &gt;&gt; /etc/sysctl.d/99-perf.conf'
                            sudo sh -c 'sysctl --system'
    </div>                       <p id="a87f4b34"> Upon the first launch of the profiler, CLion checks whether kernel variables are already set up and suggests the necessary changes:</p>                        <figure><img alt="adjust linux kernel variables for the profiler" title="adjust linux kernel variables for the profiler" src="/help/img/idea/2019.3/cl_profiler_kernelvars.png" id="99934cc7" width="500" height="303"></figure>                                       </li><li class="list__item" id="32209c36">                        <p id="4c24ef73">For human-readable names in the output and jump-to-source navigation, the profiler requires                            <span class="control">addr2line</span>.</p>                <p id="dc2dcee0">This tool is a part of the <a href="https://www.gnu.org/software/binutils/" data-external="true" target="_blank" rel="noopener noreferrer">binutils</a> package, so you likely have it on your system by default.                        If not, install the package separately:                    <div class="code-block" data-lang="bash">apt-get install binutils</div>                </p>                    </li></ol></section>            </div><div class="tabs__content" data-title="macOS" id="5d92e3f5">                    <section class="procedure-steps"><ul class="list "><li class="list__item" id="9a2a68cc"><p>                    The only required tool is <span class="control">DTrace</span>, which is most likely installed by default on your macOS.                            Check it by calling the <code class="code">dtrace</code> command in the terminal.                        </p></li></ul></section>            </div></div>    <p id="aa94bace">CLion automatically detects the <span class="control">Perf</span> or <span class="control">DTrace</span> executable in case its location is included in the <span class="filepath">PATH</span> environment variable.        You can also set the path manually in        <span data-skip-index="skip" class="menupath">Settings / Preferences | Build, Execution, Deployment | Dynamic Analysis Tools | Profiler</span>.    </p></div> <div class="chapter"><h2 id="UsingTheProfiler" data-toc="procedures.profiler#UsingTheProfiler">Run profiling</h2>     <section class="procedure-steps"><h3 id="UsingTheProfiler_Prepare">Prepare the build</h3><ol class="list _decimal"><li class="list__item" id="0e7cf282"><p>             The profiler relies on debug information to provide meaningful output data and navigation, so <span class="control">Debug</span> configurations are preferable to be used for profiling.         </p></li><li class="list__item" id="3255598e">             <p id="2034c4d1">                 Compiler <span class="control">optimizations</span>, such as inlining, can influence profiling results. To make sure none of the frames                 are missing due to inlining, set the optimization level to <code class="code">-O0</code> in your <span class="filepath">CMakeLists.txt</span>:                 <div class="code-block" data-lang="makefile">
                     set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O0")
                     set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0")
                 </div>             </p>             <p id="eac48507">             Also, compilers can use the frame pointer register as a general-purpose register for optimization purposes,             which may lead to broken stack traces. On Linux, the profiler implementation does not depend on this, but on macOS, we recommend setting the <code class="code">-fno-omit-frame-pointer</code> compilation flag for <span class="control">gcc</span>             and both <code class="code">-fno-omit-frame-pointer</code> and <code class="code">-mno-omit-leaf-frame-pointer</code>             for <span class="control">clang</span>.             </p>         </li></ol></section>     <section class="procedure-steps"><h3 id="UsingTheProfiler_Sampling">Configure sampling frequency</h3><ul class="list "><li class="list__item" id="1ae9f77e">             <p id="3a11b4f9">The default sampling rate value is rather high, which might require a lot of disk space for long-running programs.</p>             <p id="1dab494f">If required, you can change the profiler's sampling frequency in             <span data-skip-index="skip" class="menupath">Settings / Preferences | Build, Execution, Deployment | Dynamic Analysis Tools | Profiler</span>.             <figure><img alt="profiler settings" title="profiler settings" src="/help/img/idea/2019.3/cl_profiler_settings.png" id="ba5a66ce" width="544" height="332"></figure>             </p>             <p id="3f33c988">             When choosing a sampling rate, <span class="control">mind other timer-driven activities</span> that may be scheduled in your system.             As an example, the default value is set to 99 Hertz instead of 100 Hertz to avoid lockstep sampling with other possible activity with a sampling frequency of 100Hz.             </p>         </li></ul></section>     <section class="procedure-steps"><h3 id="UsingTheProfiler_RunProfiler">Run the profiler</h3><ol class="list _decimal"><li class="list__item" id="7a3250e3">            <p id="2cbb7958">To run the profiler, use the <img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.profile@2x.png" width="16" alt="icons actions profile"> button on the main toolbar or call <span data-skip-index="skip" class="menupath">Run | Profile</span>.            Another option is to choose <img class="inline-icon-16" src="/help/img/idea/2019.3/icons.actions.profile@2x.png" width="16" alt="icons actions profile"><span class="control">Profile</span> from the left gutter menu:            <figure><img alt="run gutter menu with the profiler option" title="run gutter menu with the profiler option" src="/help/img/idea/2019.3/cl_profiler_rungutter.png" id="3dbc86f6" width="364" height="240"></figure>            </p>            <p id="ba430f9d">Note that on <span class="control">macOS</span>, you can also attach the profiler to a running process (call <span data-skip-index="skip" class="menupath">Run | Attach Profiler to Process</span>):                <figure><img alt="attach profiler to a process" title="attach profiler to a process" src="/help/img/idea/2019.3/cl_attachwithprofiler.png" id="155155d3" width="449" height="401"></figure>            </p>        </li><li class="list__item" id="88ffb3c1">             <p id="f39a59d0">When you launch profiling, CLion notifies you if the profiler is attached successfully.</p>             <p id="f67cd952">After the application stops, and the profiling data is ready,             CLion shows a balloon with a link to the <span class="control">CPU Profiler tool window</span> (also accessible from the main menu <span data-skip-index="skip" class="menupath">View | Tool Windows | CPU Profiler</span>):                 <figure><img alt="profiling finished balloon" title="profiling finished balloon" src="/help/img/idea/2019.3/cl_profiler_balloon.png" id="57ac2c9f" width="208" height="117"></figure></p>            <p id="3b44d1db">                To stop the profiler prior to stopping the application, use the <img class="inline-icon-16" src="/help/img/idea/2019.3/Docker-core.icons.StopContainer_1.png" width="16" alt="Docker core icons StopContainer 1"> button in the Profiler tool window.</p>         </li></ol></section>         </div>        <div class="chapter"><h2 id="InterpretingTheResults" data-toc="procedures.profiler#InterpretingTheResults">Interpret the results</h2>        <p id="7122a4e5">        In the CPU Profiler tool window, you can see the collected data presented in three tabs: <span class="control">Flame Graph</span>, <span class="control">Call Tree</span>, and <span class="control">Method List</span>.                        The left-hand part lists the application threads and <span class="control">All threads merged</span>. On Linux, CLion shows meaningful thread names if they were set in the program, and on macOS thread names are shown as id-s.     </p>    <p id="f8e2e7e4">        To search in the profiling results, you can <span class="control">start typing</span> right in the tool window area, and the results will be highlighted in the currently opened tab:        <figure><img alt="type in the profiler tool window to start the search" title="type in the profiler tool window to start the search" src="/help/img/idea/2019.3/cl_profiler_typesearch_mac.png" id="bc01ad78" width="750" height="688"></figure>    </p>    <p id="cd8863ef">        <span class="control">Context menu</span> is available in all three tabs of the Profiler tool window.        It allows you to locate the selected function in another tab (for example, <span class="control">Focus on method in Methods List</span> for a Flame Graph block),        navigate to the source code (<span class="control">Jump to Source</span>), and copy frame information to clipboard: only the frame name (<span class="control">Copy Frame</span>) or the sequence of        frame names from the stack bottom up to the selected frame (<span class="control">Copy Stack up to Frame</span>).        <figure><img alt="context menu for tab elements" title="context menu for tab elements" src="/help/img/idea/2019.3/cl_profiler_context_menu.png" id="fafb8b18" width="510" height="445"></figure>    </p>    <div class="chapter"><h3 id="InterpretingTheResults_FlameChart">Flame Graph</h3>        <p id="77ea0632">            Raw profiling data collected by <span class="control">Perf</span> or <span class="control">DTrace</span> is a call tree summary.  <a href="http://www.brendangregg.com/flamegraphs.html" data-external="true" target="_blank" rel="noopener noreferrer">Flame Graphs</a> visualize it as a collection of stack traces:  the rectangles stand for frames of the call stack, ordered by width.        </p>        <p id="197d1085">Each block represents a function in the stack (a stack frame). The width of each block corresponds to the method’s CPU time used (or the allocation size, in case of allocation profiling). On the Y-axis, there is a stack depth going from bottom up. The X-axis shows the stack profile sorted from the most resource-consuming functions to the least consuming ones.</p>        <p id="806bceaa">            When reading the flame graph, focus on the <span class="control">widest blocks</span>. These blocks are the functions most presented in the profile. You can start from the bottom and move up, following the code flow from parent to child methods, or use the opposite direction to explore the top blocks that show the functions running directly on the CPU.      </p>        <p id="9264a4c5">Hover the mouse over any block to view the details:            <figure><img alt="block details in the flame graph" title="block details in the flame graph" src="/help/img/idea/2019.3/cl_profiler_flamechart_hover.png" id="fe5ee4b0" width="388" height="339"></figure>        </p>    </div>    <div class="chapter"><h3 id="InterpretingTheResults_CallTree">Call Tree</h3>        <p id="4b305475">            The <span class="control">Call Tree</span> tab shows the program call tree with the percentage of each function in the total profiling time. The optional number right after the percentage presents a filtered sequence of calls. Click it to expand this sequence.</p>        <figure><img alt="call tree tab in the profiler results" title="call tree tab in the profiler results" src="/help/img/idea/2019.3/cl_profiler_calltree_mac.png" id="eca08de5" width="750" height="685"></figure>         <p id="f15aa5f2">             To configure and filter the Call Tree view, use the Presentation Settings button (<img class="inline-icon-16" src="/help/img/idea/2019.3/artwork.studio.icons.logcat.toolbar.settings@2x.png" width="16" alt="settings">).        </p>    </div>     <div class="chapter"><h3 id="InterpretingTheResults_MethodList">Method List</h3>         <p id="c15e09f7">             The Methods List collects all methods in the profiled data and sorts them by cumulative sample time. For each             function from the list, you can view <span class="control">Back Traces</span> and <span class="control">Merged Callees</span>.         </p>   <figure><img alt="method list tab in the profiler results" title="method list tab in the profiler results" src="/help/img/idea/2019.3/cl_profiler_methodlist_mac.png" id="5c19b81a" width="631" height="619"></figure>     </div>                 </div>    <div class="last-modified" data-skip-index="skip">Last modified: 1 December 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="memory-profiling-with-valgrind.html">Valgrind Memcheck</a><a class="navigation-links__next" href="code-coverage-clion.html">Code Coverage</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>