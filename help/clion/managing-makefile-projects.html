<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>管理Makefile项目-帮助|帮助里昂</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Managing_Makefile_projects" data-breadcrumbs="Configure Projects/Project_Models.xml|Project Formats/Managing_Makefile_projects.xml|Managing Makefile Projects" data-main-title="Managing Makefile Projects"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索CLion帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>CLion 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_default_for_macos" data-group="primary">macOS的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_macos" data-group="primary">Eclipse（macOS）</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_sublime_text_macos" data-group="primary">崇高文字（macOS）</option><option value="primary_xcode" data-group="primary">Xcode</option><option value="primary_resharper" data-group="primary">锐化器</option><option value="primary_resharper_macos" data-group="primary">ReSharper（macOS）</option><option value="secondary_default_for_windows" data-group="secondary">Windows的默认设置</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option><option value="secondary_xcode" data-group="secondary">Xcode</option><option value="secondary_resharper" data-group="secondary">锐化器</option><option value="secondary_resharper_macos" data-group="secondary">ReSharper（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Managing_Makefile_projects.xml" data-toc="Managing_Makefile_projects">管理Makefile项目</h1>    <p id="ExampleIntro">尽管当前在CLion中不支持Makefile作为项目格式，但是您可以使用以下变通办法在<a href="using-file-watchers.html">File Watchers</a>和<a href="compilation-database.html">编译数据库</a>的帮助下管理Makefile项目。</p>    <p id="b2264ae6">下面的示例显示了如何构建一个元构建系统，该系统监视Makefile中的更改，然后相应地重新生成并重新加载编译数据库。这样，它使您可以从CLion内部全面管理Makefile项目。此外，您可以借助<a href="custom-build-targets.html">自定义构建目标</a>和<a href="custom-build-targets.html#custom-rundebug">自定义运行/调试配置</a>来构建和运行/调试此类项目。</p>    <p>假设我们有一个简单的Makefile项目，该项目包含三个模块， <span class="filepath">general</span> ， <span class="filepath">io_lib</span>和<span class="filepath">math_lib</span> ，每个模块存储在包含Makefile的单独目录中，而在根目录中则存储用于构建所有目标的主Makefile：</p><div class="code-block" data-lang="makefile">TARGETS = Math Io General全部：$（TARGETS）Math：@ $（MAKE）-C math_lib -f Makefile Io：@ $（MAKE）-C io_lib -f Makefile General：@ $（MAKE）-C general -f Makefile clean：@ $（MAKE）-C io_lib -f Makefile clean @ $（MAKE）-C math_lib -f Makefile clean @ $（MAKE）-C general -f Makefile clean</div>        <p></p><p id="e79544be">现在让我们执行以下步骤：</p>    <section class="procedure-steps"><h3 id="create-compdb" data-toc="Managing_Makefile_projects#create-compdb">1。创建一个编译数据库</h3><ul class="list "><li class="list__item" id="98d52a91"><p>首先，我们需要为我们的测试项目创建一个JSON编译数据库。我们将用于此目的的工具是<a href="https://github.com/nickdiego/compiledb-generator" rel="noopener noreferrer" data-external="true" target="_blank">configureb-generator</a> 。安装该工具后，我们可以运行<code class="code">compiledb make</code>从项目根目录并获取<span class="filepath">compile_commands.json</span>文件：</p><figure><img alt="cl filewatcher编译的b输出" title="cl filewatcher编译的b输出" src="/help/img/idea/2019.3/cl_filewatcher_compiledb_output.png" id="19c869c8" width="508" height="88"></figure>        <p></p></li></ul></section>    <section class="procedure-steps"><h3 id="makefile-plugin" data-toc="Managing_Makefile_projects#makefile-plugin">2。安装Makefile支持插件</h3><ul class="list "><li class="list__item" id="3a19ecf5">            <p id="a307082c">这是一个可选步骤，但对我们的任务很有帮助： <a href="managing-plugins.html#repos">安装</a>了<a href="https://plugins.jetbrains.com/plugin/9333-makefile-support" rel="noopener noreferrer" data-external="true" target="_blank">Makefile Support</a>插件后，CLion中可以识别<span class="control">GNU Makefile</span>文件类型，并且可以获取Makefile的语法高亮和编辑功能。</p>        </li></ul></section>    <section class="procedure-steps"><h3 id="compdb" data-toc="Managing_Makefile_projects#compdb">3。在CLion中打开并配置编译数据库</h3><ul class="list "><li class="list__item" id="11fc2e91">            <p id="99233eca">下一步是<a href="compilation-database.html#compdb_load">打开</a>在步骤1中作为CLion中的项目创建<a href="compilation-database.html#compdb_load">的编译数据库</a> 。导入成功完成后，我们可以开始使用项目文件。</p><figure><img alt="cl filewatcher compdb" title="cl filewatcher compdb" src="/help/img/idea/2019.3/cl_filewatcher_compdb.png" id="bdecf88f" width="706" height="1230"></figure>            <p></p>            <p id="d0c8a40d">为了使<span class="filepath">compile_command.json中的</span>每次更改都自动重新加载项目，我们需要在<span class="menupath" data-skip-index="skip">Settings / Preferences | Settings | Preferences</span>中<span class="menupath" data-skip-index="skip">设置</span> <span class="control">Use auto-import</span>复选框。 <span class="menupath" data-skip-index="skip">构建，执行，部署|编译数据库</span> ：</p><figure><img alt="cl filewatcher compdb自动导入" title="cl filewatcher compdb自动导入" src="/help/img/idea/2019.3/cl_filewatcher_compdb_autoimport.png" id="4c4cb1cf" width="634" height="673"></figure>            <p></p>        </li></ul></section>    <section class="procedure-steps"><h3 id="filewatcher-plugin" data-toc="Managing_Makefile_projects#filewatcher-plugin">4。安装File Watchers插件</h3><p id="9eeb3561">转到<span class="menupath" data-skip-index="skip">设置/首选项|插件</span> ，切换到<span class="control">Marketplace</span> ，搜索<span class="emphasis">File Watchers</span> ，然后安装插件。</p></section>    <section class="procedure-steps"><h3 id="filewatcher" data-toc="Managing_Makefile_projects#filewatcher">5，为Makefile创建文件监视程序</h3><ul class="list "><li class="list__item" id="860f0b69">            <p id="6b102cac">现在，我们可以创建一个文件监视程序来跟踪Makefile中的更改。让我们导航到<span class="menupath" data-skip-index="skip">“设置/首选项” |工具| File Watchers</span> ，创建一个新的File Watcher并将其分配给位于项目根目录和子目录中的所有<span class="control">GNU Makefile</span>类型的文件（请注意<code class="code">$ProjectFileDir$</code>宏）：</p><figure><img alt="cl filewatcher makefile" title="cl filewatcher makefile" src="/help/img/idea/2019.3/cl_filewatcher_makefile.png" id="7a1d2476" width="687" height="1260"></figure><p></p>        </li></ul></section>    <section class="procedure-steps"><h3 id="change-makefiles" data-toc="Managing_Makefile_projects#change-makefiles">6。修改Makefile</h3><ul class="list "><li class="list__item" id="dc450e69">            <p id="d3162d6d">现在，让我们在Makefile中进行更改。我们可以在IDE外部执行此操作（因为已设置“ <span class="control">在外部更改时触发监视程序”</span>复选框），或者直接在CLion编辑器中执行。</p>            <p id="3e2b9f8f">例如，我们可以将新的源文件添加到<span class="filepath">math_lib</span>模块并将其放入相应Makefile中的源列表中：</p><figure><img alt="cl filewatchers makefilechange example1" title="cl filewatchers makefilechange example1" src="/help/img/idea/2019.3/cl_filewatchers_makefilechange_example1.png" id="32b8b86b" width="698" height="514"></figure>            <p></p>            <p id="0113f090">更改之后，立即触发<span class="control">Makefile_watcher</span>运行<code class="code">compiledb -n make</code> 。此命令将在不执行实际构建的情况下重新生成编译数据库，CLion会自动重新加载它，以便项目与修改后的Makefile同步。</p>            <p id="b9430765">现在<span class="filepath">compile_commands.json中</span>有四个条目：</p><figure><img alt="cl filewatchers makefilechange示例1结果" title="cl filewatchers makefilechange示例1结果" src="/help/img/idea/2019.3/cl_filewatchers_makefilechange_example1result.png" id="5ee0235d" width="582" height="310"></figure>            <p></p>            <p id="05d261a2">同样，如果我们随后决定不将<span class="filepath">io_funcs</span>库包含在构建中，则可以删除<code class="code">Io</code>主Makefile中的目标：</p><div class="code-block" data-lang="makefile">目标=数学一般</div>为响应此更改， <span class="control">Makefile_watcher</span>再次触发，并且相应地重新加载了编译数据库：<figure><img alt="cl filewatchers makefilechange example2result" title="cl filewatchers makefilechange example2result" src="/help/img/idea/2019.3/cl_filewatchers_makefilechange_example2result.png" id="d414f407" width="525" height="867"></figure>            <p></p>        </li></ul></section>    <section class="procedure-steps"><h3 id="global-filewatcher" data-toc="Managing_Makefile_projects#global-filewatcher">7。使File Watcher成为全局</h3><ul class="list "><li class="list__item" id="c0140e5b"><p>我们可能要做的最后一件事是使<span class="control">Makefile_watcher</span>全局化。启用此设置后，观察程序将在所有项目中可用，因此我们可以轻松地将其重用于我们在CLion中管理的其他Makefile应用程序：</p><figure><img alt="cl filewatcher全球" title="cl filewatcher全球" src="/help/img/idea/2019.3/cl_filewatcher_global.png" id="e40450c7" width="614" height="747"></figure>        <p></p></li></ul></section>    <p id="ending">这样，文件监视程序和编译数据库的组合就创建了一种用于处理基于Make的项目的机制，而无需离开CLion来编辑Makefile或手动重新创建编译数据库。此外，您可以将此方法应用于具有补充工具来生成编译数据库的<span class="control">任何构建系统</span> 。</p>    <p id="f32e2da2">        <span class="control"><span class="emphasis">请注意</span></span> ，当前，在此方案中，CLion针对触发文件监视程序的Makefile中的每个更改重新加载整个编译数据库。因此，在将此工作流应用于大型代码库时，您可能会遇到性能问题。</p><div class="last-modified" data-skip-index="skip">上次修改时间：2019年12月1日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="gradle-support.html">Gradle</a> <a class="navigation-links__next" href="opening-reopening-and-closing-projects.html">打开和重新打开项目</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>