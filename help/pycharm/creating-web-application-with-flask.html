<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta name="description" content="How to create a web application using Flask, SQlite database, SQLAlchemy, and Jinja templates." data-skip-index="skip"><title>使用Flask创建Web应用程序-帮助|帮助PyCharm</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Creating_Web_Application_with_Flask" data-article-props="
                {
                
            " seeals=":[=" titl=":=" concept=",=" link=":=" ur=":" project.htm="," tex=":" projec="}=" web="" resource=",=" http:="" ="" devnet.jetbrains.com="" community="" python?view="documents" developer="" communit="}="><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索PyCharm帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PyCharm 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_default_for_xwin_windows" data-group="primary">XWin的默认设置（Windows）</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_default_for_xwin_macos" data-group="secondary">XWin的默认设置（macOS）</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Creating_Web_Application_with_Flask.xml" data-toc="Creating_Web_Application_with_Flask">使用Flask创建Web应用程序</h1>                    <a name="edition"></a>     <aside class="warning " rel="Creating_Web_Application_with_Flask.xml" id="feb33128" data-title=""><p>仅<b id="3d94b173" origin="intellij-platform">专业</b>版支持此功能。该版本是商业版本，它提供了一组出色的功能：有关更多详细信息，请参见<a href="https://www.jetbrains.com/pycharm/features/editions_comparison_matrix.html" rel="noopener noreferrer" data-external="true" target="_blank">比较矩阵</a> 。</p></aside>    <p id="2c0a37d5">本教程说明了如何使用Flask Web框架开发基于Web的应用程序。我们的MeteoMaster应用程序处理存储在数据库中的气象数据，并以下列图表的形式显示：</p>    <ul class="list _ul"><li class="list__item" id="48cb0997"><p id="4c01a5d8">散点图–布拉格，圣彼得堡，旧金山，巴黎和新加坡的年平均温度和湿度的累积报告。</p>        </li><li class="list__item" id="0ba3c94f">            <p id="7e026a9a">折线图–每个城市的平均每月温度和湿度。</p>        </li></ul>    <figure id="f50d553f" width="600" data-theme="light"><img class="js-gif" src="/help/img/idea/2019.2/py_flask_demo.png" width="600" data-gif-src="/help/img/idea/2019.2/py_flask_demo.animated.gif" style="width:600px"></figure>    <div class="chapter"><h2 id="overview" data-toc="Creating_Web_Application_with_Flask#overview">超越天气：应用程序概述</h2>        <p id="5b6defc2">您将使用各种Web技术来实现以下应用程序功能：</p>        <div class="table-wrapper"><table width="100%" id="42ffaaa5"><thead><tr id="130ac1fa" class="ijRowHead"><th id="17693bc4"><p>功能</p></th><th id="4e28a23a"><p>技术</p></th></tr></thead><tbody><tr id="027c03ec" class="ijRowOdd"><td id="ad42949c"><p>Meteo数据操作</p></td><td id="aace94aa"><p><a href="https://www.sqlite.org/index.html" rel="noopener noreferrer" data-external="true" target="_blank">使用SQLite</a>数据库存储数据，使用<a href="https://www.sqlalchemy.org/" rel="noopener noreferrer" data-external="true" target="_blank">SQLAlchemy</a>包以Python代码对数据库执行操作。</p></td></tr><tr id="b9f20563" class="ijRowEven"><td id="f04143ae"><p>图示</p></td><td id="0b22cb60"><p><a href="https://matplotlib.org/" rel="noopener noreferrer" data-external="true" target="_blank">matplotlib</a>软件包以绘制图形。</p></td></tr><tr id="f84ae4cf" class="ijRowOdd"><td id="18543294"><p>查看和编辑内容</p></td><td id="9ab662ac"><p><a href="https://www.w3schools.com/html/" rel="noopener noreferrer" data-external="true" target="_blank">HTML</a>创建页面视图， <a href="http://jinja.pocoo.org/" rel="noopener noreferrer" data-external="true" target="_blank">Jinja</a>创建智能模板。</p></td></tr><tr id="0c8e2ca8" class="ijRowEven"><td id="aceda262"><p>管理内容</p></td><td id="80ca8a4f"><p><a href="http://flask.pocoo.org/" rel="noopener noreferrer" data-external="true" target="_blank">整理</a>应用程序的内容。</p></td></tr></tbody></table></div>        <p id="c876e05c">MeteoMaster是包含以下组件的Web应用程序：</p>        <figure><img alt="Flask Web应用程序的关键模块" title="Flask Web应用程序的关键模块" src="/help/img/idea/2019.2/py_flask_app_structure.png" id="deb7ceb2" width="600" height="440"></figure>        <dl><dt id="3d43755e">主页</dt><dd>                <p id="9e30729f">应用程序入口点，可提供散点图并提供指向特定城市气候的详细摘要的链接。</p>            </dd><dt id="5a313d60">市</dt><dd>                <p id="3e51b237">一系列页面，其中包含有关每个城市的气候的详细信息。</p>            </dd><dt id="a4f40a71">登录</dt><dd>                <p id="48c44c8a">认证页面。需要输入有效的凭据才能编辑气象数据。</p>            </dd><dt id="714a371a">编辑</dt><dd>                <p id="a417aa54">用于编辑城市特定数据的一系列页面。</p>            </dd></dl>        <p id="448feeb5">每个HTML页面都有一个用Python代码实现的相应Flask视图。</p>    </div>    <div class="chapter"><h2 id="7c11c750" data-toc="Creating_Web_Application_with_Flask#7c11c750">在PyCharm中创建Flask应用程序</h2>        <p id="ca2d50a2">作为所述创建基本瓶项目<a href="creating-flask-project.html">创建瓶项目</a>启动原型应用程序。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="49ea5f56">                <p id="b389110f">在“ <span class="control">新建项目”</span>对话框中选择“ <span class="control">烧瓶</span> ”。</p><figure><img alt="创建一个新的Flask项目" title="创建一个新的Flask项目" src="/help/img/idea/2019.2/py_flask_create_meteo_project.png" id="71cf2aa4" width="600" height="869"></figure>                <p></p>            </li><li class="list__item" id="30f49b13"><p id="471b4aa0">在“ <span class="control">位置”</span>字段中，提供项目位置的路径，然后键入<span class="keyword">MeteoMaster</span>作为项目名称。将其余设置保留为默认设置并保存更改。</p>            </li><li class="list__item" id="bc847fe5">                <p id="477e8e2e">请点击<kbd data-primary_default_for_windows="Shift+F10" data-primary_intellij_idea_classic_macos="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_sublime_text="Shift+F10" data-primary_eclipse="Shift+Alt+X" data-primary_emacs="Shift+F10" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌃R" data-secondary_default_for_gnome="⇧F10" data-secondary_default_for_kde="⇧F10" data-secondary_eclipse="⌥⇧X" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="N/A">Shift+F10</kbd>运行默认应用程序。在“ <span class="control">运行</span>工具”窗口中，单击超链接并预览目标页面。</p><figure><img alt="预览Hello World应用" title="预览Hello World应用" src="/help/img/idea/2019.2/py_flask_meteo_run_default.png" id="3aa74c6e" width="700" height="366"></figure>                <p></p>            </li><li class="list__item" id="34b83b22">                <p id="e1ba85ff">现在，安装MeteoMaster应用程序所需的所有软件包。最简单的方法是使用项目依赖项（请参阅<a href="managing-dependencies.html">使用requirements.txt管理依赖项</a> ）。右键单击项目根目录，然后选择“ <span class="menupath" data-skip-index="skip">新建” |“新建”。文件</span> ，然后指定<span class="keyword">requirements.txt</span>作为文件名和依赖下面的列表添加到它。</p><div class="code-block" data-lang="none">点击== 7.0循环器== 0.10.0烧瓶== 1.0.2 Jinja2 == 2.10 kiwisolver == 1.0.1 MarkupSafe == 1.1.0 matplotlib == 3.0.2 numpy == 1.15.4 pyparsing == 2.3.0 python-dateutil == 2.7.5六个== 1.11.0 SQLAlchemy == 1.2.14 Werkzeug == 0.14.1</div>                <p></p>                <p id="ddd4ab01">单击<span class="control">安装要求</span>链接以继续安装软件包。</p><figure><img alt="安装应用程序所需的软件包" title="安装应用程序所需的软件包" src="/help/img/idea/2019.2/py_flask_meteo_requirements.png" id="a7e35135" width="700" height="189"></figure><p></p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="database" data-toc="Creating_Web_Application_with_Flask#database">设置数据库</h2>        <p id="924a9d22">现在，为您的应用程序设置数据源。使用PyCharm，这非常简单。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="64b92e80">                <p id="e3602cf0">从以下位置下载包含五个城市的气象数据的预定义数据库：</p>                <p id="2d72101f"><a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database" rel="noopener noreferrer" data-external="true" target="_blank">https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database</a></p>                 <p id="82e9d334">将<span class="filepath">user_database</span>文件保存在项目根目录中。</p></li><li class="list__item" id="49345a1f"><p id="1f6110bc">双击添加的文件，然后打开“ <a href="database-tool-window.html">数据库工具窗口”</a> 。</p><figure><img alt="Meteo数据库" title="Meteo数据库" src="/help/img/idea/2019.2/py_flask_meteo_database.png" id="b5d789b9" width="700" height="724"></figure><p></p>                    <p id="eacde782">您应该在<code class="code">user_database</code>数据库： <code class="code">city</code>和<code class="code">meteo</code> 。双击每个表以预览数据。的<code class="code">city</code>该表具有三列： <code class="code">city_id</code> ， <code class="code">city_name</code>和<code class="code">city_climate</code> （简要描述城市气候）。的<code class="code">meteo</code>该表有四列： <code class="code">city_id</code> ， <code class="code">month</code> ， <code class="code">average_humidity</code>和<code class="code">average_temperature</code> 。为<span class="emphasis">外键</span>定义了<code class="code">city_id</code>的专栏<code class="code">table</code>设置两个表之间的关系。</p>                </li><li class="list__item" id="1eaf7e5a">                   <p id="cfdb7655">（可选）在“ <span class="control">数据库”</span>工具窗口中右键单击<span class="control">user_database</span> ，然后选择“ <span class="menupath" data-skip-index="skip">属性”</span> 。在“ <span class="control">数据源和驱动程序”</span>对话框中，单击“ <span class="control">测试连接”</span>以确保已正确配置数据源。</p>                <figure><img alt="添加数据源" title="添加数据源" src="/help/img/idea/2019.2/py_flask_meteo_datasource.png" id="a45e851d" width="600" height="756"></figure></li><li class="list__item" id="de3f8df3">                <p id="26f642f3"><a href="creating-and-running-your-first-python-project.html#create-file">创建一个Python文件</a> <span class="filepath">user_database.py</span> ，以使用新创建的数据库。使用<a href="https://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/basic_use.html" rel="noopener noreferrer" data-external="true" target="_blank">SQLAlchemy声明性基本</a>语法描述数据库。</p><div class="code-block" data-lang="python">元数据= MetaData（）引擎= create_engine（'sqlite：/// user_database'，connect_args = {'check_same_thread'：False}，echo = False）＃echo = False基础= declarative_base（）db_session = sessionmaker（bind = engine）（ ）＃表城市类City（Base）：__tablename__ ='city'city_id =列（整数，primary_key = True）city_name =列（字符串）city_climate =列（字符串）city_meteo_data =关系（“ Meteo”，backref =“ city” ）＃表气象类别Meteo（Base）：__tablename__ ='meteo'id = Column（Integer，primary_key = True）city_id = Column（ForeignKey（'city.city_id'））month = Column（String）平均湿度= Column（Integer） average_temperature =列（浮点数）</div>                <p></p>                <p id="de556e08">无需手动为代码片段添加导入语句，而是应用建议的<a href="intention-actions.html">快速修复方法</a> ：只需单击灯泡图标（或按<kbd data-primary_default_for_windows="Alt+Enter" data-primary_intellij_idea_classic_macos="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_sublime_text="Alt+Enter" data-primary_eclipse="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌥⏎" data-secondary_default_for_gnome="⌥⏎" data-secondary_default_for_kde="⌥⏎" data-secondary_eclipse="⌥⏎" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌥⏎">Alt+Enter</kbd> ）。</p><figure><img alt="对缺少的导入语句应用快速修复" title="对缺少的导入语句应用快速修复" src="/help/img/idea/2019.2/py_flask_meteo_import.png" id="2d11503f" width="587" height="292"></figure><p></p>            </li><li class="list__item" id="3665a9e7">                <p id="205da9f1">现在，您已经定义了表及其关系，添加以下函数以从数据库检索数据：</p>                <div class="code-block" data-lang="python">＃从数据库中检索数据def get_cities（）：return db_session.query（City）＃生成特定城市的平均温度值集合def get_city_temperature（city）：返回[city.city_meteo_data中月份的month.average_temperature]＃生成特定城市的平均湿度值集def get_city_humidity（city）：返回[city.city_meteo_data中月份的month.average_湿度] data = get_cities（）MONTHS = [data.0中记录的record.month..city_meteo_data] CITIES = [数据中城市的city.city_name]</div>            </li></ol><aside class="note " rel="3665a9e7" id="48cef03d" data-title=""><p id="af83b0c2">请参阅项目存储库中的<a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/user_database.py" rel="noopener noreferrer" data-external="true" target="_blank">user_database.py</a>文件的完整代码。</p></aside></section>    </div>    <div class="chapter"><h2 id="scatter_chart" data-toc="Creating_Web_Application_with_Flask#scatter_chart">绘制散点图</h2>        <p id="60316801">您已经准备好检索数据并构建第一个图表-散点图，其中包含每个城市的年平均温度和湿度。使用<a href="https://matplotlib.org/" rel="noopener noreferrer" data-external="true" target="_blank">matplotlib</a>库设置图形并分配值。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="6af1da67">            <p id="740d48cc"><a href="creating-and-running-your-first-python-project.html#create-file">创建另一个Python文件</a> <span class="filepath">chart.py</span> ，并粘贴以下代码片段：</p>            <div class="code-block" data-lang="python">从user_database导入matplotlib.pyplot作为plt从数据中获取城市，数据的get_city_temperature，get_city_humidity，CITIES Annual_temp = [] Annual_hum = []：Annual_temp.append（sum（get（get_city_temperature（city）/ 12） （city）/ 12）plt.clf（）plt.scatter（yearly_hum，Annual_temp，alpha = 0.5）plt.title（'年平均温度/湿度'）plt.xlim（70，95）plt.ylabel（'Yearly平均温度'）plt.xlabel（'年平均相对湿度'），枚举（CITIES）中的txt：plt.annotate（txt，（yearly_hum [i]，Annual_temp [i]））plt.show（）</div>            </li><li class="list__item" id="b91adf8b"><p>预览图形的最快方法是使用<kbd data-primary_default_for_windows="Shift+F10" data-primary_intellij_idea_classic_macos="Shift+F10" data-primary_default_for_gnome="Shift+F10" data-primary_default_for_kde="Shift+F10" data-primary_sublime_text="Shift+F10" data-primary_eclipse="Shift+Alt+X" data-primary_emacs="Shift+F10" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌃R" data-secondary_default_for_gnome="⇧F10" data-secondary_default_for_kde="⇧F10" data-secondary_eclipse="⌥⇧X" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="N/A">Shift+F10</kbd>捷径。PyCharm在<span class="control">SciView</span>工具窗口中显示散点图。您可以使用<span class="control">“</span>图形<span class="control">”</span>选项卡预览生成的图形。</p><figure><img alt="预览散点图" title="预览散点图" src="/help/img/idea/2019.2/py_flask_meteo_scatter_chart.png" id="f6cd986a" width="800" height="877"></figure>            <p></p></li><li class="list__item" id="f4fee780">                <p id="8e4d34c3">现在，将图形保存到图像中，以便可以将其添加到应用程序的主页。更换<code class="code">plt.show()</code>与利用<code class="code">savefig(img)</code>功能：</p>                <div class="code-block" data-lang="python">从io import BytesIO从user_database导入数据，MONTHS，get_city_temperature，get_city_humidity，CITIES def get_main_image（）：“”“显示散点图”“” year_temp = [] Annual_hum = []代表数据中的城市，从io import BytesIO导入matplotlib.pyplot： Annual_temp.append（sum（get_city_temperature（city））/ 12）Annual_hum.append（sum（get_city_humidity（city））/ 12）plt.clf（）plt.scatter（yearly_hum，Annual_temp，alpha = 0.5）plt.title（'每年的平均温度/湿度'）plt.xlim（70，95）plt.ylabel（'年度平均温度'）plt.xlabel（'年度平均相对湿度'）枚举（CITIES）中的txt：plt.annotate（ txt，（yearly_hum [i]，Annual_temp [i]））img = BytesIO（）plt.savefig（img）img.seek（0）返回img</div>            </li></ol></section>    </div>    <div class="chapter"><h2 id="main" data-toc="Creating_Web_Application_with_Flask#main">创建主页</h2>        <p id="0643406f">设置应用程序的主页，并为散点图创建视图。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="d432c7f9">        <p id="d7817b7a">更换<code class="code">app.route()</code> <span class="filepath">app.py</span>文件中的代码片段，包含以下代码：</p>        <div class="code-block" data-lang="python">@ app.route（'/'）def main（）：“”“入口；主页的视图”“”城市= [（在数据中记录的（record.city_id，record.city_name）]返回render_template（' main.html'，city = cities）@ app.route（'/ main.png'）def main_plot（）：“”“呈现散点图的视图”“” img = get_main_image（）返回send_file（img，mimetype ='image / png'，cache_timeout = 0）</div>        </li><li class="list__item" id="4f857940"><p id="d0a2ec81">应用建议的快速修复程序以添加缺少的导入语句。</p>        </li><li class="list__item" id="4fd7af90">            <p id="efa12c5a">请注意，PyCharm突出显示<span class="filepath">main.html，</span>因为您尚未创建此文件。</p><figure><img alt="代码检查" title="代码检查" src="/help/img/idea/2019.2/py_flask_meteo_code_inspection.png" id="77caa509" width="489" height="245"></figure><p></p>            <p id="d02ef812">使用PyCharm意向操作，您可以快速创建丢失的模板文件。按<kbd data-primary_default_for_windows="Alt+Enter" data-primary_intellij_idea_classic_macos="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_sublime_text="Alt+Enter" data-primary_eclipse="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌥⏎" data-secondary_default_for_gnome="⌥⏎" data-secondary_default_for_kde="⌥⏎" data-secondary_eclipse="⌥⏎" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌥⏎">Alt+Enter</kbd>然后从上下文菜单中选择“ <span class="control">创建模板main.html</span> ”。确认模板文件的名称和位置，然后单击“ <span class="control">确定”</span> 。结果， <span class="filepath">main.html</span>将被添加到<span class="filepath">模板</span>目录。打开新添加的文件，并将以下代码粘贴到其中：</p>            <div class="code-block" data-lang="markup">
                
                
                
                <meta charset="UTF-8">
                <link href="../static/style.css" rel="stylesheet" type="text/css">
                <title>典型气候</title>
                
                
                    <div id="element1">
                        <img src="{{ url_for('main_plot') }}" alt="图片">
                    </div>
                    <div id="element2">
                        <p>哪个城市的气候最佳？</p>
                        <p>在计划旅行或度假时，您经常检查天气数据中的湿度和温度。</p>
                        <p>以下是以下城市的年平均值集合：</p>
                        <ul>{city_id，城市名称在城市中所占百分比％}<li><a href="">{{ 城市名称 }}</a></li>{％endfor％}</ul>
                    </div>
                
                
            </div>            <p id="0822aa18">注意<code class="code">{{ city_name }}</code>这个片段中是一个<a href="http://jinja.pocoo.org/" rel="noopener noreferrer" data-external="true" target="_blank">Jinja2</a>模板变量，用于传递<code class="code">city_name</code> HTML模板的Python变量。</p>        </li><li class="list__item" id="7f743037">            <p id="ef16c321">还创建样式表以设置应用程序中所有HTML页面的字体和布局设置。右键单击<span class="control">静态</span>目录，然后选择“ <span class="menupath" data-skip-index="skip">新建| Stylesheet</span> ，然后指定<span class="filepath">css</span>文件的名称<span class="filepath">style.css</span> ，并粘贴以下样式定义：</p>            <div class="code-block" data-lang="css">body {font-family：“ Helvetica Neue”，Helvetica，Arial，sans-serif; }＃element1 {display：inline-block; }＃element2 {display：inline-block;垂直对齐：顶部；页边距：90px;对齐方式：左；宽度：25％; }</div>            <aside class="note " rel="121dc705" id="ff2138cb" data-title=""><p id="543ef39c">PyCharm将自动完成标识符，例如<code class="code">#element1</code>从项目HTML文件中使用的那些。</p></aside>        </li><li class="list__item" id="c318d8e9">            <p id="74cff127">首次运行应用程序时，PyCharm会自动生成“运行/调试”配置。您可以随时使用它来运行修改后的应用程序，以评估结果。</p><figure><img alt="运行/调试配置" title="运行/调试配置" src="/help/img/idea/2019.2/py_flask_meteo_run_debug_configuration.png" id="e744c607" width="282" height="53"></figure>            <p></p>            <p id="336ffef5">点击<img class="inline-icon-16" src="/help/img/idea/2019.2/artwork.studio.icons.avd.run@2x.png" width="16" alt="运行按钮">并点击“ <span class="control">运行</span>工具”窗口中的<span class="filepath">http://127.0.0.1:5000/</span>链接。您应该期望看到以下页面：</p><figure><img alt="MeteoMaster应用程序的主页" title="MeteoMaster应用程序的主页" src="/help/img/idea/2019.2/py_flask_meteo_main_page.png" id="f8410938" width="700" height="569"></figure>            <p></p>            <aside class="note " rel="336ffef5" id="41b3782e" data-title=""><p id="6c94aec2">您可以在任何代码更改后连续地重新运行您的应用程序。单击可用配置列表，然后选择“ <span class="control">编辑配置”</span> 。在“ <a href="run-debug-configuration-flask-server.html">烧瓶运行/调试”配置</a>对话框中，选中“ <span class="control">FLASK_DEBUG”</span>复选框。启用此模式后，每次保存代码更改时，PyCharm都会重新启动正在运行的应用程序<kbd data-primary_default_for_windows="Ctrl+S" data-primary_intellij_idea_classic_macos="⌘+S" data-primary_default_for_gnome="Ctrl+S" data-primary_default_for_kde="Ctrl+S" data-primary_sublime_text="Ctrl+S" data-primary_eclipse="Ctrl+S" data-primary_emacs="Ctrl+X, Ctrl+S" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌘S" data-secondary_default_for_gnome="⌃S" data-secondary_default_for_kde="⌃S" data-secondary_eclipse="⌃S" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌘S">Ctrl+S</kbd> 。</p>            </aside>        </li></ol></section>    </div>    <div class="chapter"><h2 id="line_charts" data-toc="Creating_Web_Application_with_Flask#line_charts">绘制折线图</h2>        <p id="a2a7ae6b">为了向应用程序用户提供有关特定城市气候的详细信息，请绘制折线图以及相关信息。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="4873ebd1"><p id="30be5c27">通过添加以下内容来修改Charts.py文件： <code class="code">get_city_image</code>功能：</p>            <div class="code-block" data-lang="python">def get_city_image（city_id）：“”“使用城市特定数据绘制折线图”“” city = data.get（city_id）city_temp = get_city_temperature（city）city_hum = get_city_humidity（city）plt.clf（）plt.plot（MONTHS， city_temp，color ='blue'，linewidth = 2.5，linestyle ='-'）plt.ylabel（'平均每日温度'，color ='blue'）plt.yticks（color ='blue'）plt.twinx（）plt .plot（MONTHS，city_hum，color ='red'，linewidth = 2.5，linestyle ='-'）plt.ylabel（'平均相对湿度'，color ='red'）plt.yticks（color ='red'）plt .title（city.city_name）img = BytesIO（）plt.savefig（img）img.seek（0）返回img</div>                <p id="9b1b5d0b">此功能绘制两个线性图：每个城市的每月<span class="keyword">平均每日温度</span>和<span class="keyword">平均相对湿度</span> 。类似于<code class="code">get_main_image</code>功能，它将图表保存在图像中。</p>            </li><li class="list__item" id="f3ada874">                <p id="99f7b2e4">再创建一个<span class="filepath">.html</span>文件以显示折线图。</p>                <p id="d09ea8f1">右键单击项目根目录中的<span class="control">模板</span>目录，然后选择“ <span class="menupath" data-skip-index="skip">新建” |“新建”。 HTML File</span> ，然后输入<span class="filepath">city.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>            </li><li class="list__item" id="71ae5931">                    <div class="code-block" data-lang="markup">
                        
                        
                        
                            <meta charset="UTF-8">
                            <link href="../static/style.css" rel="stylesheet" type="text/css">
                            <title>{{ 城市名称 }}</title>
                        
                        
                            <div id="element1">
                                <img src="{{ url_for('city_plot', city_id=city_id) }}" alt="图片">
                            </div>
                            <div id="element2">
                                <p>该图显示了{{city_name}}中的平均每日温度和平均相对湿度。</p>
                                <p>{{city_climate}}</p>
                                <hr>
                                <p><a href="/">回到主页面</a></p>
                            </div>
                        
                        
                    </div>                </li><li class="list__item" id="a88bcb34">                 <p id="1c72a537">剩下的步骤是使用<code class="code">Flask.route</code>功能。将以下代码片段添加到<span class="filepath">app.py</span>文件中：</p>                 <div class="code-block" data-lang="python">@ app.route（'/ city / <int:city_id>'）def city（city_id）：“”“查看城市详细信息”“” city_record = data.get（city_id）返回render_template（'city.html'，city_name = city_record.city_name ，city_id = city_id，city_climate = city_record.city_climate）@ app.route（'/ city <int:city_id>.png'）def city_plot（city_id）：“”“呈现城市特定图表的视图”“” img = get_city_image（city_id）返回send_file（ img，mimetype ='image / png'，cache_timeout = 0，）</int:city_id></int:city_id></div>                 <p id="c743f85b">不要忘记使用快速修复<kbd data-primary_default_for_windows="Alt+Enter" data-primary_intellij_idea_classic_macos="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_sublime_text="Alt+Enter" data-primary_eclipse="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌥⏎" data-secondary_default_for_gnome="⌥⏎" data-secondary_default_for_kde="⌥⏎" data-secondary_eclipse="⌥⏎" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌥⏎">Alt+Enter</kbd>添加缺少的导入语句。</p>             </li><li class="list__item" id="813f6bfd">                 <p id="78122cfe">现在，修改<span class="filepath">main.html</span>文件，以使用指向相应<span class="emphasis">city / *</span>页面的链接填充城市列表。更换<code class="code"><li><a href="">{{ city_name }}</a></li></code>与<code class="code"><li><a href="{{ url_for('city', city_id=city_id) }}">{{ city_name }}</a></li></code> 。</p>             </li></ol><p id="29c03830">重新运行运行/调试配置以重新启动应用程序，然后单击指向Paris的链接。您应该期望能够导航到<span class="filepath">city / 2</span>页面。</p><figure><img alt="巴黎的详细天气信息" title="巴黎的详细天气信息" src="/help/img/idea/2019.2/py_flask_meteo_line_chart.png" id="a70027e6" width="800" height="829"></figure></section>    </div>    <div class="chapter"><h2 id="login" data-toc="Creating_Web_Application_with_Flask#login">创建登录表单</h2>        <p id="65761501">到此时，您已经创建了一个功能齐全的应用程序，该应用程序从数据库中检索气象数据并将其显示为图表。但是，在现实生活中，您通常需要编辑数据。合理地，只应允许授权用户进行编辑，因此，让我们创建一个登录表单。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="8d12bb54"><p id="5553821d">右键单击项目根目录中的<span class="control">模板</span>目录，然后选择“ <span class="menupath" data-skip-index="skip">新建” |“新建”。 HTML File</span> ，然后输入<span class="filepath">login.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>                <div class="code-block" data-lang="python">
                    
                    
                        
                            <meta charset="UTF-8">
                            <link rel="stylesheet" type="text/css" href="../static/style.css">
                            <title>登录表格</title>
                        
                        
                            <p>登录以编辑meteo数据库：</p>
                            <div class="container">
                                <form class="form-inline" action="" method="post">
                                    <input type="text" class="form-control" placeholder="用户名" name="username" value="{{request.form.username}}">
                                    <input type="password" class="form-control" placeholder="密码" name="password" value="{{ request.form.password }}">
                                    <input class="btn btn-default" type="submit" value="登录">
                                </form>
                                <p>{{错误}}</p>
                            </div>
                        
                    
                </div>                <p id="cc2caa68">此代码使用“ <span class="control">用户名”</span>和“ <span class="control">密码”</span>字段实现典型的登录表单。</p>            </li><li class="list__item" id="58a02ecc">                <p id="2c2447d0">将以下代码添加到<span class="filepath">app.py</span>文件中，以为登录表单创建Flask视图并控制登录会话。</p>                <div class="code-block" data-lang="python">@ app.route（'/ login / <int:city_id>'，methods = [“ GET”，“ POST”]）def login（city_id）：“”“登录页面的视图”“” city_record = data.get（city_id）try ：error =''if request.method ==“ POST”：tryped_username = request.form ['username'] tryped_password = request.form ['password']如果tryped_username =='admin'和tryped_password == os.environ [ 'USER_PASSWORD']：session ['logged_in'] =真实session ['username'] = request.form ['username']返回重定向（url_for（'edit_database'，city_id = city_id））否则：print（'无效的凭据' ）error ='无效的凭据。请再试一遍。'return render_template（'login.html'，error = error，city_name = city_record.city_name，city_id = city_id）例外，例如e：return render_template（'login.html'，error = str（e），city_name = city_record.city_name ，city_id = city_id）def login_required（f）：@wraps（f）def wrap（* args，** kwargs）：如果会话中的“ logged_in”，则为““ login session”“”“：返回f（* args，** kwargs）否则：通过return return redirect（url_for（'login'））return wrap app.secret_key = os.environ ['FLASK_WEB_APP_KEY']</int:city_id></div>                <p id="b26a3a12">使用<kbd data-primary_default_for_windows="Alt+Enter" data-primary_intellij_idea_classic_macos="Alt+Enter" data-primary_default_for_gnome="Alt+Enter" data-primary_default_for_kde="Alt+Enter" data-primary_sublime_text="Alt+Enter" data-primary_eclipse="Alt+Enter" data-primary_emacs="Alt+Enter" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌥⏎" data-secondary_default_for_gnome="⌥⏎" data-secondary_default_for_kde="⌥⏎" data-secondary_eclipse="⌥⏎" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌥⏎">Alt+Enter</kbd>添加缺少的导入语句的快捷方式。请注意，此代码段引入了两个环境变量： <code class="code">USER_PASSWORD</code>和<code class="code">FLASK_WEB_APP_KEY</code> 。</p>            </li><li class="list__item" id="7c26346e">                <p id="86e29fd5">您可以在<span class="control">MeteoMaster</span>运行/调试配置中记录新创建的环境变量的值，因为与在<span class="filepath">app.py</span>文件中进行硬编码相比，这是一种存储安全敏感信息的安全方法。</p>                <p id="e40bd45b">转到编辑器右上方的“运行/调试配置”列表，然后选择“ <span class="filepath">编辑配置”</span> 。点击<img class="inline-icon-16" src="/help/img/idea/2019.2/icons.actions.menu-open_dark.svg@2x.png" width="16" alt="编辑环境变量">在<span class="control">环境变量</span>场图标，并添加两个变量。</p>                <figure><img alt="添加环境变量" title="添加环境变量" src="/help/img/idea/2019.2/py_flask_meteo_env_variables.png" id="477d2dd1" width="700" height="877"></figure>            </li><li class="list__item" id="e468464e">                <p id="a42041ae">修改<code class="code"><div id="element2"></code> <span class="filepath">city.html</span>文件中的元素，以容纳登录功能：</p>                <div class="code-block" data-lang="python">
                    <p>该图显示了{{city_name}}中的平均每日温度和平均相对湿度。</p>
                    <p>{{city_climate}}</p>{％，如果会话['logged_in']％}<p>是否要添加更多数据？</p>
                    <p>转到并<a href="{{ url_for('edit_database', city_id=city_id) }}">编辑</a> meteo数据库。</p>{％else％}<p>想要编辑气象数据吗？</p>
                    <p>请先<a href="{{ url_for('login', city_id=city_id) }}">登录</a> 。</p>{％ 万一 ％}<hr>
                    <p><a href="/">回到主页面</a></p>
                </div>            </li><li class="list__item" id="3eaa46f1"><p id="cab647fd">重新启动该应用程序，然后单击任何城市链接，然后单击“请先登录”句子中的<span class="control">登录</span>链接。您应该期望看到登录表单。</p>            <figure><img alt="登录表格" title="登录表格" src="/help/img/idea/2019.2/py_flask_meteo_login_form.png" id="3934327c" width="438" height="277"></figure>            <p id="ceb16553">目前，此表单无法启用编辑功能，因为您尚未实现相应的页面。同时，您可以尝试输入任何不正确的密码，以检查是否使用以下消息来处理该密码：“无效的凭据。请再试一遍。”</p></li></ol></section>    </div>    <div class="chapter"><h2 id="edit" data-toc="Creating_Web_Application_with_Flask#edit">编辑数据</h2>        <p id="b4dbbdd5">剩下的最后一步是启用对流星数据的编辑。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="2305d380"><p id="d1f52afc">右键单击项目根目录中的<span class="control">模板</span>目录，然后选择“ <span class="menupath" data-skip-index="skip">新建” |“新建”。 HTML File</span> ，然后输入<span class="filepath">edit.html</span>作为文件名，并将以下代码粘贴到新创建的文件中：</p>                <div class="code-block" data-lang="markup">
                    
                    
                        
                            <meta charset="UTF-8">
                            <link rel="stylesheet" type="text/css" href="../static/style.css">
                            <title>编辑{{city_name}}的气象数据</title>
                        
                        
                            <p>适当编辑{{city_name}}的数据：</p>
                            <div class="container">
                                <form name="meteoInput" class="form-inline" action="" method="post">
                                    <table>
                                        <tbody><tr>
                                            <td>月</td>
                                            <td colspan="2" align="center">平均温度</td>
                                            <td colspan="2" align="center">平均湿度</td>
                                        </tr><tr><td>{％，以月份为单位，％％}</td></tr><tr>
                                            </tr><tr><td>{{月}}</td>
                                            <td>
                                                <input placeholder="20" class="form-control" name="temperature{{ loop.index0 }}" value="{{ meteo[0][loop.index0]}}" type="range" min="-50.0" max="50.0" step="0.01" oninput="temp_output{{ loop.index0 }}.value=this.value">
                                            </td>
                                            <td>
                                                <output name="temp_output{{ loop.index0 }}"> {{'％0.2f'％meteo [0] [loop.index0] | float}} </output> <label>C</label>
                                            </td>
                                            <td>
                                                <input placeholder="20" class="form-control" name="humidity{{ loop.index0 }}" value="{{ meteo[1][loop.index0]}}" type="range" min="0" max="100" oninput="hum_output{{ loop.index0 }}.value=this.value">
                                            </td>
                                            <td>
                                                <output name="hum_output{{ loop.index0 }}"> {{meteo [1] [loop.index0]}} </output> <label>％</label>
                                            </td>
                                        <td>{％endfor％}</td></tr></tbody></table>
                                    <input class="btn btn-default" type="submit" value="保存">
                                </form>
                                <p>{{错误}}</p>
                            </div>
                        
                    
                </div>            <p id="762e1d11">该片段还利用Jinjia2模板来处理输入数据，并将其传递给对数据库执行提交的Python代码。</p>            </li><li class="list__item" id="2fa37b20">                <p id="f305e45a">向<span class="filepath">app.py</span>文件中再添加一个代码片段，该文件为编辑页面创建Flask视图，处理输入数据并更新数据库：</p>                <div class="code-block" data-lang="python">@ app.route（'/ edit / <int:city_id>'，methods = [“ GET”，“ POST”]）@login_required def edit_database（city_id）：“”“用于编辑城市特定数据的视图”“” month_temperature = [] month_humidity = [ ] city_record = data.get（city_id）meteo = [get_city_temperature（city_record），get_city_humidity（city_record）]尝试：if request.method ==“ POST”：＃从范围（12）中的i的表格中获取数据：一个生产应用程序，我们应该验证输入数据month_temperature.append（float（request.form [f'temperature {i}']））month_humidity.append（int（request.form [f'humidity {i}']））） ＃枚举的i，月份的数据库更新（city_record.city_meteo_data）：month.average_temperature = month_temperature [i] month.average_humidity = month_humidity [i] db_session.commit（）return redirect（url_for（'main'，city_id = city_id））其他：返回render_template（'edit.html'，city_name = city_record.city_name，city_id = city_id，months = MONTHS，meteo = meteo），但异常除外：返回render_template（'edit.html'，city_name = city_record.city_na我，city_id = city_id，月=月，气象=气象，错误=错误）</int:city_id></div>                <p id="5be59a16">不要忘记添加丢失的导入语句。请参阅项目存储库中<a href="https://github.com/allaredko/flask-tutorial-demo/blob/master/app.py" rel="noopener noreferrer" data-external="true" target="_blank">app.py</a>文件的完整代码。</p>            </li></ol><p id="5503373f">通过此步骤，您已经完成了创建与数据库交互的基于Flask的应用程序的任务。现在，您已经完全可以胜任天气了。前往并修改任何城市的气象数据，以便在图表上突出显示更改。然后预览更改。</p></section>    </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月6日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="creating-flask-project.html">创建一个烧瓶项目</a> <a class="navigation-links__next" href="pyramid.html">金字塔</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>