<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta name="robots" content="noindex"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta charset="UTF-8"><title>Tutorial: Remote Development on Raspberry Pi - Help | PyCharm</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Remote_Development_on_Raspberry_Pi"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search PyCharm Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PyCharm 2018.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default" selected>Windows/Linux Default</option><option data-group="primary" value="primary_default_for_gnome">GNOME</option><option data-group="primary" value="primary_default_for_kde">KDE</option><option data-group="primary" value="primary_default_for_xwin">XWin</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="secondary_mac_os_x">Mac OS X</option><option data-group="secondary" value="secondary_eclipse_mac_os_x">Eclipse (Mac OS X)</option><option data-group="secondary" value="secondary_intellij_idea_classic_os_x">IntelliJ IDEA Classic (Mac OS X)</option><option data-group="secondary" value="secondary_xcode">Xcode</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_resharper">ReSharper</option><option data-group="secondary" value="secondary_resharper_osx">ReSharper (Mac OS X)</option><option data-group="secondary" value="secondary_emacs">Emacs (Mac OS X)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="true"><h1 data-toc="Remote_Development_on_Raspberry_Pi" id="Remote_Development_on_Raspberry_Pi.xml">Tutorial: Remote Development on Raspberry Pi</h1><div class="chapter"><h2 id="intro" data-toc="Remote_Development_on_Raspberry_Pi#intro">Introduction</h2>    <p id="133c281a">We all know that ISPs have a habit of overselling their connections, and this sometimes leads our connections to        not be as good as we’d like them to be. Also, many of us have Raspberry Pi’s laying around waiting for cool        projects. So let’s put that Pi to use to check on our internet connection!</p>    <p id="cc693385">One of the key metrics of an internet connection is its ping time to other hosts on the internet. So let’s write         a program that regularly pings another host and records the results. </p>    <p id="36fb96dc">For those of you wanting to execute code remotely on other remote computers, like an AWS instance or a        DigitalOcean droplet, the process is exactly the same.</p>    <p id="ad3cd746">This tutorial has been created on Windows, and the code was executed on the RPi, which is a Linux computer. On        the other supported operating systems, some of the paths and workflows might be slightly different.</p></div><div class="chapter"><h2 id="prereq" data-toc="Remote_Development_on_Raspberry_Pi#prereq">Before you start</h2>    <p id="f0a3085f">For performing this tutorial, make sure that you meet the following prerequisites:</p>    <ul class="list _ul"><li class="list__item" id="996f4bfe"><p>You have the Professional Edition of PyCharm.</p></li><li class="list__item" id="fbcaade6"><p>The code will run on any Linux machine. You can also use a local VM as well.</p></li></ul>    <p id="install-additional-software">You'll also need some additional software:</p>    <ul class="list _ul"><li class="list__item" id="1606e147"><p><code class="code" data-lang="Java">PostgreSQL</code>, because it will be used to create a database.</p></li><li class="list__item" id="0647c2fb"><p><code class="code" data-lang="Java">Libpq-dev</code>, needed for <code class="code" data-lang="Java">Psycopg2</code>.</p></li><li class="list__item" id="7ab73a9f"><p><code class="code" data-lang="Java">Python-dev</code>, needed to compile <code class="code" data-lang="Java">Psycopg2</code>.</p></li></ul>    <p id="b2b6183c">To install all of these at once, run the following command:</p>    <div class="code-block" data-lang="Console"><code class="code-block__wrapper">sudo apt-get update <span class="o">&amp;&amp;</span> sudo apt-get install -y postgresql libpq-dev python-dev</code></div></div><div class="chapter"><h2 id="raspberry-ping" data-toc="Remote_Development_on_Raspberry_Pi#raspberry-ping">Raspberry Ping</h2>        <p id="9a394288">The application we will build consists of two parts:</p>            <ul class="list _ul"><li class="list__item" id="9060f77a"><p><span class="control">First</span>, we actually do the measurements. To measure the results, we can just call                    the ping command-line tool that every Linux machine (including the Raspberry Pi) ships with. We will                    then store the results in a PostgreSQL database.</p></li><li class="list__item" id="27ec79ea"><p><span class="control">Second</span>, we'll visualize the results using a Flask app, which uses Matplotlib to                    draw a graph of recent results.</p></li></ul>    </div><div class="chapter"><h2 id="prepare" data-toc="Remote_Development_on_Raspberry_Pi#prepare">Preparing your Raspberry Pi</h2>    <p id="14d75755">As we will want to be able to view the webpage with the results later, it’s important to give our Pi a fixed IP        within our network. To do so, edit <code class="code" data-lang="Java">/etc/network/interfaces</code>. See        <a href="https://thepihut.com/blogs/raspberry-pi-tutorials/16683276-how-to-setup-a-static-ip-address-on-your-raspberry-pi" data-external="true" target="_blank" rel="noopener noreferrer"><span>this tutorial</span></a>        for additional details. </p>    <p id="9a5a794b">After you’ve set the Pi to use a static IP, use <code class="code" data-lang="Java">raspi-config</code> on the command line. Go to        <span class="control">Advanced Options</span>, choose <span class="control">SSH</span>, and choose <span class="control">Yes</span>.        When you’ve done this, you’re ready to get started with PyCharm.</p></div><div class="chapter"><h2 id="creating-project" data-toc="Remote_Development_on_Raspberry_Pi#creating-project">Creating a project</h2>        <p id="311e111d">Create a pure Python project: to do that, choose <span data-skip-index="skip" class="menupath">File | New Project</span>. Name the project "raspberry.pi"            See <a href="creating-empty-project.html"><span>Creating Pure Python Project</span></a>. </p>                <p id="aaaf9f19">Then add an SSH remote interpreter as described in <a href="configuring-remote-interpreters-via-ssh.html"><span>Configuring Remote Interpreters via SSH</span></a>. When            configuring an SSH server, specify the IP-address of your Pi (<span class="control">Host</span>), for example, 172.27.120.177.            Also, specify credentials for logging into the device.</p>        <p id="bd3076e5">Next, in PyCharm, press <kbd data-primary_default="Ctrl+Shift+A" data-primary_default_for_gnome="Ctrl+Shift+A" data-primary_default_for_kde="Ctrl+Shift+A" data-primary_default_for_xwin="Ctrl+Shift+A" data-primary_emacs="Escape, X" data-primary_visual_studio="Ctrl+Shift+A" data-primary_netbeans="Ctrl+I" data-primary_eclipse="Ctrl+Shift+A" data-secondary_mac_os_x_10.5_="⇧⌘A" data-secondary_mac_os_x="⇧⌘A" data-secondary_eclipse_mac_os_x="⌘3" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃⇧A" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⎋, X">Ctrl+Shift+A</kbd>, begin typing ‘Start SSH session’:</p>        <figure><img alt="py start ssh session" title="py start ssh session" src="/help/img/idea/2018.3/py_start_ssh_session.png" id="3da55733" width="408" height="101"></figure>        <p id="04199c69">Then pick your Raspberry Pi from the list of hosts, and you should be connected.</p>        <p id="465307e3">Next, <a href="#install-additional-software">install additional software</a>.</p>    </div><div class="chapter"><h2 id="setup-permission" data-toc="Remote_Development_on_Raspberry_Pi#setup-permission">Setting up permissions and creating a database in PostgreSQL</h2>        <p id="5124b7c7">We now need to set up the permissions in PostgreSQL. The easiest way to do this is to go back to our SSH            terminal, and run the following command to get an SQL prompt as the Postgres user: </p>            <div class="code-block" data-lang="Console"><code class="code-block__wrapper">sudo -u postgres psql</code></div>            <p id="59881c42">Now let's create a user (a ‘role’ in Postgres terminology) with the same name as the user that we run the                process with:</p>        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">CREATE ROLE pi WITH LOGIN PASSWORD ‘hunter2’<span class="p">;</span></code></div>        <p id="3139d051">Important  note! Make sure that the role in PostgreSQL has the same name as your Linux username. You might            also want to substitute a better password. It is important to end your SQL statements with a semicolon (;)            in psql, because it will assume you’re writing a multi-line statement until you terminate with a semicolon.            We’re granting the pi user login rights, which just means that the user can log in. Roles without login            rights are used to create groups.</p>        <p id="database">Next, create a database:</p>        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">CREATE DATABASE pi WITH OWNER pi<span class="p">;</span></code></div>        <p id="56976069">Next, exit <code class="code" data-lang="Java">psql</code> with <code class="code" data-lang="Java">\q</code>.</p>    </div><div class="chapter"><h2 id="run" data-toc="Remote_Development_on_Raspberry_Pi#run">Capturing pings</h2>    <p id="6c58b5f8">To get information on the quality of the internet connection, let’s ping a server using the system’s        <code class="code" data-lang="Java">ping</code> utility, and then read the result with a regex. So let’s take a look at the output of        <code class="code" data-lang="Java">ping</code>:</p>    <div class="code-block" data-lang="Console"><code class="code-block__wrapper">PING jetbrains.com <span class="o">(</span>54.217.236.18<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.

<span class="m">64</span> bytes from ec2-54-217-236-18.eu-west-1.compute.amazonaws.com <span class="o">(</span>54.217.236.18<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">47</span> <span class="nb">time</span><span class="o">=</span>32.9 ms
<span class="m">64</span> bytes from ec2-54-217-236-18.eu-west-1.compute.amazonaws.com <span class="o">(</span>54.217.236.18<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">47</span> <span class="nb">time</span><span class="o">=</span>32.9 ms
<span class="m">64</span> bytes from ec2-54-217-236-18.eu-west-1.compute.amazonaws.com <span class="o">(</span>54.217.236.18<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">47</span> <span class="nb">time</span><span class="o">=</span>32.9 ms
<span class="m">64</span> bytes from ec2-54-217-236-18.eu-west-1.compute.amazonaws.com <span class="o">(</span>54.217.236.18<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">4</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">47</span> <span class="nb">time</span><span class="o">=</span>32.9 ms

--- jetbrains.com ping statistics ---
<span class="m">4</span> packets transmitted, <span class="m">4</span> received, 0% packet loss, <span class="nb">time </span>3003ms
rtt min/avg/max/mdev <span class="o">=</span> 32.909/32.951/32.992/0.131 ms</code></div>    <p id="d40c0c03">All the lines with individual round trip times begin with <code class="code" data-lang="Java">64 bytes from</code>. So let’s create a file        <code class="code" data-lang="Java">ping.py</code> (<span data-skip-index="skip" class="menupath">File | New - Python File</span>), and start coding.</p>    <p id="8ad5c47f">We can first get the output of ping, and then iterate over the lines, picking the ones that start with a number        followed by the words ‘bytes from’:</p>    <div class="code-block" data-lang="Python"><code class="code-block__wrapper"><span class="n">host</span> <span class="o">=</span> <span class="s">&#39;jetbrains.com&#39;</span>
<span class="n">ping_output</span> <span class="o">=</span> <span class="n">subprocess32</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&quot;ping&quot;</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="s">&quot;-c 5&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ping_output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;\d+ bytes from&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code></div>    <p id="256e6a12">At this point if you run the code (<kbd data-primary_default="Ctrl+Shift+F10" data-primary_default_for_gnome="Ctrl+Shift+F10" data-primary_default_for_kde="Ctrl+Shift+F10" data-primary_default_for_xwin="Ctrl+Shift+F10" data-primary_emacs="Ctrl+Shift+F10" data-primary_visual_studio="Ctrl+F9" data-primary_netbeans="Shift+Alt+F6" data-primary_eclipse="Ctrl+Shift+F10" data-secondary_mac_os_x_10.5_="⌃⇧R" data-secondary_mac_os_x="⌃⇧F10" data-secondary_eclipse_mac_os_x="⌃⇧R" data-secondary_intellij_idea_classic_os_x="N/A" data-secondary_xcode="N/A" data-secondary_visual_studio="⌃F9" data-secondary_resharper="N/A" data-secondary_resharper_osx="N/A" data-secondary_emacs="⌃⇧F10">Ctrl+Shift+F10</kbd>), you should see this code running remotely on the        Raspberry Pi:</p>    <figure><img alt="py raspberry pi run" title="py raspberry pi run" src="/help/img/idea/2018.3/py_raspberry_pi_run.png" id="7bcbf9aa" width="807" height="230"></figure>    <p id="e5b4f9ad">To check if the deployment settings are set up correctly, point to the <span data-skip-index="skip" class="menupath">Tools | Deployment</span>        on the main menu. The check command <span class="control">Automatic Upload</span> should be checked.</p></div><div class="chapter"><h2 id="store" data-toc="Remote_Development_on_Raspberry_Pi#store">Storing the pings</h2>        <p id="de925c5b">We wanted to store our pings in <code class="code" data-lang="Java">PostgreSQL</code>, so let’s create a table for them. First, we need to            create a PostgreSQL database:</p>        <figure><img alt="py database postgresql" title="py database postgresql" src="/help/img/idea/2018.3/py_database_postgresql.png" id="afac078a" width="392" height="403"></figure>        <p id="7b6f430b">When PostgreSQL is selected, the datasource page opens:</p>        <figure><img alt="py create postrgesql database general settings" title="py create postrgesql database general settings" src="/help/img/idea/2018.3/py_create_postrgesql_database_general_settings.png" id="fcf962a2" width="563" height="313"></figure>        <p id="66fec6fc">On this page, download the required drivers, enter the required credentials, and then click the            <span class="control">Test Connection</span> button to make sure you are connected.</p>        <p id="ac2e0c2f">As our database is only exposed to localhost, we will need to use an SSH tunnel:</p>        <figure><img alt="py create postrgesql database ssh tunnel" title="py create postrgesql database ssh tunnel" src="/help/img/idea/2018.3/py_create_postrgesql_database_ssh_tunnel.png" id="f167cc28" width="568" height="241"></figure>        <p id="40c3b1f4">Next, after you’ve connected, create the table by executing the            <a href="https://github.com/ErnstHaagsman/raspberryping/blob/master/setup_db.sql" data-external="true" target="_blank" rel="noopener noreferrer"><span>setup_db.sql</span></a> script.            To do this, copy-paste the script from GitHub into the SQL console that opened up right after connecting,            and then use the green play button to execute.</p>        <p id="1cead5f8">Now that we’ve got this working, let’s expand our script to record the pings into the database. To connect to            the database from Python we’ll need to install <code class="code" data-lang="Java">psycopg2</code>. To do it, point to            <span data-skip-index="skip" class="menupath">File | Settings</span>(for Windows and Linux) or <span data-skip-index="skip" class="menupath">PyCharm/Preferences</span>            (for macOS users), then click the page <a href="project-interpreter.html"><span>Project Interpreter</span></a>, and then use <img class="inline-icon-16" src="/help/img/idea/2018.3/icons.general.add@2x.png" width="16" alt="icons general add">            to install the package. If you’d like to see the full script, you can            <a href="https://github.com/ErnstHaagsman/raspberryping/blob/master/ping.py" data-external="true" target="_blank" rel="noopener noreferrer"><span>have a look on GitHub</span></a>.</p>    </div><div class="chapter"><h2 id="cron" data-toc="Remote_Development_on_Raspberry_Pi#cron">Cron</h2>        <p id="28e37438">To make sure that we actually regularly record the pings, we need to schedule this script to be run. For this,            we will use <code class="code" data-lang="Java">cron</code>. As we’re using peer authentication to the database, we need to make sure that            the script is run as the <code class="code" data-lang="Java">pi</code> user. So let’s open an SSH session (making sure we’re logged in as            <code class="code" data-lang="Java">pi</code>), and then run <code class="code" data-lang="Java">crontab -e</code> to edit our user crontab. Then at the bottom of the            file add the following line:</p>        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">*/5 * * * * /home/pi/raspberryping/ping.py jetbrains.com &gt;&gt; /var/log/raspberryping.log 2&gt;<span class="p">&amp;</span>1</code></div>        <p id="ff29e0b0"><span class="emphasis">Make sure you have a newline at the end of the file!</span></p>        <p id="56df951e">The first <code class="code" data-lang="Java">*/5</code> means that the script will be run every 5 minutes. If you’d like a different            frequency, you can <a href="https://en.wikipedia.org/wiki/Cron" data-external="true" target="_blank" rel="noopener noreferrer"><span>learn more about crontabs</span></a>. Now we also            need to create the log file and make sure that the script can write to it:</p>        <div class="code-block" data-lang="Console"><code class="code-block__wrapper">sudo touch /var/log/raspberryping.log
sudo chown pi:pi /var/log/raspberryping.log</code></div>        <p id="d61e4f63">At this point take your time, and when you come back later, some ping times should have been logged.            To verify, let’s check with PyCharm’s database tools. Open the            <a href="database-tool-window.html">Database tool window</a> (on the right of the screen) and double click            the table. You should see that it contains values:</p>        <figure><img alt="py databse filled" title="py databse filled" src="/help/img/idea/2018.3/py_databse_filled.png" id="de24d6cd" width="806" height="257"></figure>    </div><div class="chapter"><h2 id="flask" data-toc="Remote_Development_on_Raspberry_Pi#flask">Creating a Flask application</h2>            <p id="8762cc30">It’s no good to just record pings, if we can’t see some statistics about them. So let’s write a small                Flask application (to install Flask, use <code class="code" data-lang="Java">pip install</code> in the Terminal), and use                <a href="matplotlib-support.html">matplotlib</a> to draw a graph of recent ping times. </p>            <p id="5a6905c9">In our Flask application, we’ll create two routes:</p>            <ul class="list _ul"><li class="list__item" id="7a6a4b35"><p>On <code class="code" data-lang="Java">/</code>, we’ll list the destinations that we’ve pinged in the last hour with basic stats                    (min, average, max time in the last hour).</p></li><li class="list__item" id="5474f19e"><p>On <code class="code" data-lang="Java">/graphs/&lt;destination&gt;</code> we’ll draw a graph of the pings in the last 3 hours.</p></li></ul>            <p id="adc8cbb8">The <code class="code" data-lang="Java">/</code> route is simple: we just execute a query to get the data we’re interested in and pass                that to the template.            <a href="https://github.com/ErnstHaagsman/raspberryping/blob/master/analyze.py" data-external="true" target="_blank" rel="noopener noreferrer"><span>See the full code on GitHub</span></a>.            </p>            <p id="d98a2ac2">To make sure that everything works right, let's put a breakpoint on the call to                <code class="code" data-lang="Java">render_template</code>:</p>            <figure><img alt="py render template breakpoint" title="py render template breakpoint" src="/help/img/idea/2018.3/py_render_template_breakpoint.png" id="dd7640a4" width="549" height="120"></figure>            <p id="f4d33502">Then start the debugging session (<img class="inline-icon-16" src="/help/img/idea/2018.3/icons.actions.startDebugger.svg@2x.png" width="16" alt="icons actions startDebugger svg">) and see the result in your browser. </p>            <p id="a2ec8c17">The <code class="code" data-lang="Java">/graphs/&lt;destination&gt;</code> route is a lot more complex. First, we have to get the ping                averages for the past three hours in reasonably sized bins (let’s say, 10 minutes). Second, we have to                draw the graph.</p>                   </div><div class="chapter"><h2 id="querying-data" data-toc="Remote_Development_on_Raspberry_Pi#querying-data">Querying the data</h2>            <p id="1a6a56ad">So the data we’re looking for is:</p>            <ul class="list _ul"><li class="list__item" id="e1c5b0f0"><p>For each 10 minute period in the last 3 hours</p></li><li class="list__item" id="412eff79"><p>Get the minimum, average, and maximum ping time to a specified destination</p></li></ul>                <p id="e77f78b0">The first part makes this a fairly complex query. Even though PostgreSQL has support for intervals,                    date ranges, and a way to generate a series of dates, there is no way to generate a series of ranges.                    One solution to this problem is a common table expression (CTE), this is a way to execute a subquery                    which you can later refer to as if it were a real table.</p>                <p id="f7f8b127">To get a series of timestamps for the last three hours at 10 minute intervals is easy:</p>            <div class="code-block" data-lang="SQL"><code class="code-block__wrapper"><span class="k">select</span> <span class="n">begin_time</span> <span class="k">from</span> <span class="n">generate_series</span><span class="p">(</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="nb">interval</span> <span class="s1">&#39;3 hours&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">(),</span> <span class="nb">interval</span> <span class="s1">&#39;10 minutes&#39;</span><span class="p">)</span> <span class="n">begin_time</span><span class="p">;</span></code></div>            <p id="0a0c7425">The <a href="https://www.postgresql.org/docs/9.5/static/functions-srf.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>generate_series</span></a> function                takes three arguments: <code class="code" data-lang="Java">begin</code>, <code class="code" data-lang="Java">end</code>, and <code class="code" data-lang="Java">step</code>. The function works                with numbers and with timestamps, so that makes it easy. If we wanted pings at exactly these times, we’d                be done now. However, we need times between the two timestamps. So we can use another bit of SQL magic:                <a href="https://www.postgresql.org/docs/9.6/static/functions-window.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>window functions</span></a> which                allow us to do things with rows before or after the row that we’re currently on. So let’s add                <code class="code" data-lang="Java">end_time</code> to our query:</p>            <div class="code-block" data-lang="SQL"><code class="code-block__wrapper"><span class="k">select</span>
    <span class="n">begin_time</span><span class="p">,</span>
    <span class="n">LEAD</span><span class="p">(</span><span class="n">begin_time</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">begin_time</span> <span class="k">ASC</span><span class="p">)</span> <span class="k">as</span> <span class="n">end_time</span>
<span class="k">from</span> <span class="n">generate_series</span><span class="p">(</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="nb">interval</span> <span class="s1">&#39;3 hours&#39;</span><span class="p">,</span> <span class="n">now</span><span class="p">(),</span> <span class="nb">interval</span> <span class="s1">&#39;10 minutes&#39;</span><span class="p">)</span> <span class="n">begin_time</span><span class="p">;</span></code></div>            <p id="210dda31"><code class="code" data-lang="Java">LEAD</code> takes the value of the next row in the results, as ordered in the way specified in the                <code class="code" data-lang="Java">OVER</code> clause. You can use <code class="code" data-lang="Java">LAG</code> to get the previous row in a similar way. So now                we can wrap this query with <code class="code" data-lang="Java">WITH intervals as ( … query goes here … )</code> to make it a CTE.                Then we can join our pings table and get the results we’re looking for:</p>            <div class="code-block" data-lang="SQL"><code class="code-block__wrapper"><span class="k">WITH</span> <span class="n">intervals</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>
        <span class="n">begin_time</span><span class="p">,</span>
        <span class="n">LEAD</span><span class="p">(</span><span class="n">begin_time</span><span class="p">)</span>
        <span class="n">OVER</span> <span class="p">(</span>
            <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">begin_time</span> <span class="p">)</span> <span class="k">AS</span> <span class="n">end_time</span>
    <span class="k">FROM</span>
        <span class="n">generate_series</span><span class="p">(</span>
            <span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="nb">INTERVAL</span> <span class="s1">&#39;3 hours&#39;</span><span class="p">,</span>
            <span class="n">now</span><span class="p">(),</span>
            <span class="nb">INTERVAL</span> <span class="s1">&#39;10 minutes&#39;</span>
        <span class="p">)</span> <span class="n">begin_time</span>
<span class="p">)</span>
<span class="k">SELECT</span>
    <span class="n">i</span><span class="p">.</span><span class="n">begin_time</span> <span class="k">AT</span> <span class="n">TIME</span> <span class="k">ZONE</span> <span class="s1">&#39;Europe/Berlin&#39;</span> <span class="k">AS</span> <span class="n">begin_time</span><span class="p">,</span>
    <span class="n">i</span><span class="p">.</span><span class="n">end_time</span> <span class="k">AT</span> <span class="n">TIME</span> <span class="k">ZONE</span> <span class="s1">&#39;Europe/Berlin&#39;</span> <span class="k">AS</span> <span class="n">end_time</span><span class="p">,</span>
    <span class="n">p</span><span class="p">.</span><span class="n">destination</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pingtime</span><span class="p">),</span>
    <span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pingtime</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="k">avg</span><span class="p">,</span>
    <span class="k">max</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pingtime</span><span class="p">),</span>
    <span class="k">min</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">pingtime</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">intervals</span> <span class="n">i</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">pings</span> <span class="n">p</span>
<span class="k">ON</span> <span class="n">p</span><span class="p">.</span><span class="n">recorded_at</span> <span class="o">&gt;=</span> <span class="n">i</span><span class="p">.</span><span class="n">begin_time</span> <span class="k">AND</span>
    <span class="n">p</span><span class="p">.</span><span class="n">recorded_at</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">.</span><span class="n">end_time</span>
<span class="k">WHERE</span>
    <span class="n">i</span><span class="p">.</span><span class="n">end_time</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">AND</span> <span class="n">destination</span> <span class="o">=</span> <span class="o">%</span><span class="n">s</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">i</span><span class="p">.</span><span class="n">begin_time</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">end_time</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">destination</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">i</span><span class="p">.</span><span class="n">begin_time</span> <span class="k">ASC</span><span class="p">;</span></code></div>            <p id="c72b214f">Next, let's execute this query. To do that, right-click the editor background and choose                <span class="control">Execute</span> on the context menu:</p>            <figure><img alt="py execute sql from pycharm" title="py execute sql from pycharm" src="/help/img/idea/2018.3/py_execute_sql_from_pycharm.png" id="e1542449" width="1011" height="862"></figure>            <p id="16b78695">(if you don't see <span class="control">Execute</span>, choose                <span class="control">Attach Console</span> to let PyCharm know on which database you’d like to execute your                query). </p>    <p id="76df00f2">By the way, you can make the query work 30 times faster. To achieve this significant speedup, add this index to        your query:</p>    <div class="code-block" data-lang="SQL"><code class="code-block__wrapper"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">pings_recorded_at</span> <span class="k">ON</span> <span class="n">pings</span><span class="p">(</span><span class="n">recorded_at</span><span class="p">);</span></code></div>        </div><div class="chapter"><h2 id="graph" data-toc="Remote_Development_on_Raspberry_Pi#graph">Graphing the data</h2>            <p id="0e04bd58">After getting the data, <a href="http://matplotlib.org/" data-external="true" target="_blank" rel="noopener noreferrer"><span>matplotlib</span></a> is used to generate a line graph                with lines for the minimum, average, and maximum ping time per bin. Matplotlib makes it easy to plot                time-based data using the <a href="http://matplotlib.org/devdocs/api/_as_gen/matplotlib.axes.Axes.plot_date.html" data-external="true" target="_blank" rel="noopener noreferrer"><span>plot_date function</span></a>.</p>            <p id="43134242">When the plot is ready, it’s ‘saved’ as a <code class="code" data-lang="Java">.png</code> file to a StringIO object, which is then used                to create an HTTP response. By setting the <code class="code" data-lang="Java">content_type</code> header to <code class="code" data-lang="Java">image/png</code>,            everything is arranged.</p>            <p id="f145e38b">So the final result is:</p>            <figure><img alt="py raspberry pi ping time graph" title="py raspberry pi ping time graph" src="/help/img/idea/2018.3/py_raspberry_pi_ping_time_graph.png" id="ec3a006b" width="738" height="695"></figure>            <p id="cd90d102">If you want to see the full code, check out                <a href="https://github.com/ErnstHaagsman/raspberryping/blob/master/analyze.py" data-external="true" target="_blank" rel="noopener noreferrer"><span>analyze.py on GitHub</span></a>.            </p>    </div>        <div class="chapter"><h2 id="summary" data-toc="Remote_Development_on_Raspberry_Pi#summary">Summary</h2>            <p id="ff930fdf">Congrats for passing this tutorial! Let's repeat what has been done with the help of PyCharm:</p>            <ul class="list _ul"><li class="list__item" id="3efe55da"><a href="#creating-project">Created a project</a></li><li class="list__item" id="33f817c3"><p>In the Terminal, <a href="#setup-permission">set permissions up and created a user</a>.</p></li><li class="list__item" id="0299ed88"><p><a href="#database">Created a database</a>.</p></li><li class="list__item" id="fe53b47b"><p><a href="#run">Captured pings</a>. </p></li><li class="list__item" id="74b6b899"><p><a href="#store">Stored pings in a special database</a>. </p></li><li class="list__item" id="fc9fdba6"><p><a href="#flask">Created a Flask application</a> </p></li><li class="list__item" id="064c9e11"><p><a href="#querying-data">Queried the data</a> </p></li><li class="list__item" id="c741d631"><p><a href="#graph">Plotted the data</a> </p></li></ul>    </div><div class="last-modified" data-skip-index="skip">Last modified: 27 February 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="deployment-in-pycharm.html">Tutorial: Deployment in PyCharm</a><a class="navigation-links__next" href="python.html">Python</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>