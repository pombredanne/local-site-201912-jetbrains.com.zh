<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Pytest-帮助| PyCharm</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Pytest" data-article-props="
                {
                
            " seeals=":[=" titl=":=" external="" link=":=" ur=":" https:="" ="" docs.pytest.or="}=" tex=":" ="text"="developer=" }="" fixture.html#fixtur="," pytest="" fixture="}=" ]},="" ,="" ="url"="http:=" document="" ]}="" ]=""><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索PyCharm帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PyCharm 2019.2帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_default_for_xwin_windows" data-group="primary">XWin的默认设置（Windows）</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_default_for_xwin_macos" data-group="secondary">XWin的默认设置（macOS）</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Pytest.xml" data-toc="Pytest">pytest</h1>    <p id="734b7572">PyCharm支持<a href="https://docs.pytest.org" rel="noopener noreferrer" data-external="true" target="_blank">pytest</a> （一个功能齐全的测试框架）。</p>    <p id="9dd0ec71">提供以下功能：</p>    <ul class="list _ul"><li class="list__item" id="54696d44"><p>专用的测试运行程序。</p></li><li class="list__item" id="154fc916"><p>测试对象和pytest固定装置的代码完成。</p></li><li class="list__item" id="011699ec"><p>代码导航（ <a href="navigating-between-test-and-test-subject.html">在测试和测试主题之间</a>导航除外）。</p></li><li class="list__item" id="77586889"><p>详细的失败断言报告。</p></li><li class="list__item" id="cf4746a0"><p>支持Python 2.7和Python 3.5及更高版本。</p></li><li class="list__item" id="7fce7d10"><p><a href="performing-tests.html#test-mutliprocessing">多处理</a>测试执行。</p></li></ul><p id="9b20024e">默认情况下，建议的默认测试运行器为<a href="https://docs.python.org/2/library/unittest.html" rel="noopener noreferrer" data-external="true" target="_blank">unittest</a> 。因此，要使用pytest，您首先需要使其成为默认的测试运行器。</p><section class="procedure-steps"><h3 id="enable-pytest" data-toc="Pytest#enable-pytest">为您的项目启用Pytest</h3><ol class="list _decimal"><li class="list__item" id="6b776140"><p>打开<span class="menupath" data-skip-index="skip">设置/首选项|工具|</span>如<a href="choosing-your-testing-framework.html">选择测试框架中</a>所述的<span class="menupath" data-skip-index="skip">Python集成工具</span>设置对话框。</p></li><li class="list__item" id="75a26192"><p>在<span class="control">默认测试运行器</span>字段中，选择<span class="control">pytest</span> 。</p></li><li class="list__item" id="9b4bfca2"><p>单击<span class="control">确定</span>以保存设置。</p></li></ol></section>    <p id="9423377c">现在，将该pytest设置为默认的测试框架，您可以为<a href="creating-and-running-your-first-python-project.html#edit-file">Car</a>示例创建一个小型测试。让我们创建一个pytest测试来检查<code class="code">brake</code>功能。</p><section class="procedure-steps"><h3 id="create-pytest-test" data-toc="Pytest#create-pytest-test">创建一个测试</h3><ol class="list _decimal"><li class="list__item" id="d0ab0d8d"><p>创建一个<a href="creating-and-running-your-first-python-project.html#creating-simple-project">Python项目</a> 。</p></li><li class="list__item" id="5226699c"><p>在主菜单中，单击<span class="control">文件|。新建</span> ，选择<span class="control">Python文件</span> ，键入<span class="filepath">Car.py</span> ，然后单击<span class="control">确定</span> 。</p></li><li class="list__item" id="02ead67b"><p>将<a href="creating-and-running-your-first-python-project.html#edit-file">Car</a>样本复制并粘贴到<span class="filepath">Car.py</span>文件中。</p></li><li class="list__item" id="2070a523"><p>再创建一个Python文件，并将其命名为<span class="filepath">test_car_pytest</span> 。</p></li><li class="list__item" id="c1d5ebbd"><p>将以下代码添加到新创建的文件中。此代码设置的初始速度值<code class="code">Car</code>到50，然后检查速度是否正确设置为45 <code class="code">brake()</code>功能执行。</p></li></ol><div class="code-block" data-lang="python">从汽车进口汽车定义test_car_brake（）：汽车=汽车（50）car.brake（）断言car.speed == 45</div><p id="b3cfb0f9">请注意，PyCharm可以识别测试对象并为<code class="code">Car</code>类的实例。</p><figure><img alt="自动完成测试对象" title="自动完成测试对象" src="/help/img/idea/2019.2/py_pytest_autocomplete.png" id="c529ced0" width="300" height="374"></figure><p id="2a603b20">PyCharm使用<code class="code">assert</code>语句并将“ <span class="control">运行测试”</span>图标添加到装订线。</p><p id="20f050e9">尽管pytest不支持上下文菜单的<span class="control">Go To Test Subject</span>和<span class="control">Go To Test</span>命令，但是您可以使用<span class="control">Go To声明</span>导航到<span class="filepath">Car.py中</span>经过测试的代码。 <kbd data-primary_default_for_windows="Ctrl+B" data-primary_intellij_idea_classic_macos="⌘+B" data-primary_default_for_gnome="Ctrl+B" data-primary_default_for_kde="Ctrl+B" data-primary_sublime_text="F12" data-primary_eclipse="F3" data-primary_emacs="Ctrl+Alt+G" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌘B" data-secondary_default_for_gnome="⌃B" data-secondary_default_for_kde="⌃B" data-secondary_eclipse="F3" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="F12">Ctrl+B</kbd>命令。</p></section><section class="procedure-steps"><h3 id="run-pytest-test" data-toc="Pytest#run-pytest-test">运行测试</h3><ol class="list _decimal"><li class="list__item" id="00a2e091"><p id="215ea484">请点击<img class="inline-icon-16" src="/help/img/idea/2019.2/icons.toolwindows.toolWindowRun.svg@2x.png" width="16" alt="运行测试">运行测试：</p><figure><img alt="运行测试" title="运行测试" src="/help/img/idea/2019.2/py_pytest_run_test.png" id="e58953c0" width="250" height="99"></figure><p></p>    <p id="71182705">请注意，PyCharm自动创建pytest <a href="run-debug-configuration-py-test.html">运行/调试</a>配置：</p><figure><img alt="推荐的pytest运行/调试配置" title="推荐的pytest运行/调试配置" src="/help/img/idea/2019.2/py_pytest_run_debug_configuration.png" id="17e7f2b3" width="324" height="243"></figure> <p></p>        <p id="9a9e6dda">选择<span class="control">运行pytest作为test_car_pytest</span>以执行测试。</p>    </li><li class="list__item" id="f936c636"><p id="fb5b81f0">检查测试结果：</p><figure><img alt="Pytest运行" title="Pytest运行" src="/help/img/idea/2019.2/py_pytest_results.png" id="0d2dd693" width="800" height="610"></figure>    <p></p></li><li class="list__item" id="5fe334a1"><p id="f190a246">改变<code class="code">assert</code>声明如下： <code class="code">assert my_car.speed == 4599</code> 。</p></li><li class="list__item" id="a19c6074"><p id="36576611">重新运行测试以评估断言失败的报告：</p><figure><img alt="断言失败的报告" title="断言失败的报告" src="/help/img/idea/2019.2/py_pytest_fail_report.png" id="8ceddf41" width="800" height="608"></figure>请注意，pytest提供了有关失败的明确报告。<p></p></li></ol></section>    <p id="c436246e">使用pytest <i id="f0cdfd88">固定装置，</i>您可以创建可以在整个测试模块中重复使用的小型测试单元。您需要做的是用标记可重复使用的单元<code class="code">@pytest.fixture</code> 。</p><section class="procedure-steps"><h3 id="pytest-fixtures" data-toc="Pytest#pytest-fixtures">使用灯具</h3><ol class="list _decimal"><li class="list__item" id="d3c72780">        <p id="ae1c2960">修改您的<code class="code">Car</code> pytest测试如下：</p><div class="code-block" data-lang="python">从Car导入pytest导入Car @ pytest.fixture def my_car（）：返回Car（50）def test_car_accelerate（my_car）：my_car.accelerate（）声明my_car.speed == 55 def test_car_brake（my_car）：my_car.brake（）声明my_car.speed == 45</div>        <p></p>        <p id="a61e619f"><code class="code">my_car()</code>是一个夹具函数，可创建一个<code class="code">Car</code>速度值等于50的实例。它用于<code class="code">test_car_accelerate</code>和<code class="code">test_car_brake</code>验证是否正确执行了相应功能<code class="code">Car</code>类。</p>      <p id="ada158de">请注意<code class="code">my_car</code>夹具与其他标准pytest夹具一起添加到代码完成列表中，例如<code class="code">tempdir</code> 。</p><figure><img alt="pytest夹具的自动补全" title="pytest夹具的自动补全" src="/help/img/idea/2019.2/py_pytest_fixture_autocomplete.png" id="8bde6e7c" width="700" height="529"></figure>      <p></p>    </li><li class="list__item" id="44fdd8e1"><p>单击任一<img class="inline-icon-16" src="/help/img/idea/2019.2/icons.toolwindows.toolWindowRun.svg@2x.png" width="16" alt="运行测试">图标，或运行整个测试模块。</p></li></ol><p id="6df1befe">您可以使用启用跨测试共享夹具实例<code class="code">scope</code>夹具功能的参数。有关pytest固定装置的更多信息，请参阅<a href="https://docs.pytest.org/en/latest/fixture.html#fixture" rel="noopener noreferrer" data-external="true" target="_blank">pytest固定装置文档</a> 。</p></section>    <p id="22290c36">您可能想对预定义的数据集运行测试。PyCharm支持通过以下方式在pytest中实现的测试参数化<code class="code">@pytest.mark.parametrize</code> 。</p>    <section class="procedure-steps"><h3 id="pytest-parametrize" data-toc="Pytest#pytest-parametrize">应用参数化</h3><ol class="list _decimal"><li class="list__item" id="3fb7236c"><p>让我们创建一组速度值进行测试<code class="code">car.accelerate</code>和<code class="code">car.brake</code>功能：<code class="code">speed_data = {45, 50, 55, 100}</code></p></li><li class="list__item" id="903c5a82">            <p id="a9a02f7c">将测试代码修改为以下内容：</p><div class="code-block" data-lang="python">从Car导入pytest import Car speed_data = {45，50，55，100} @ pytest.mark.parametrize（“ speed_brake”，speed_data）def test_car_brake（speed_brake）：car = Car（50）car.brake（）声明car。速度== speed_brake @ pytest.mark.parametrize（“ speed_accelerate”，speed_data）def test_car_accelerate（speed_accelerate）：car = Car（50）car.accelerate（）assert car.speed == speed_accelerate</div>            <p></p>            <p id="276b68ce">请注意，PyCharm会检测到新创建的参数，并将它们添加到完成列表中。</p>            <p id="f99377f6">                </p><figure><img alt="pytest.mark.parametrize的代码完成" title="pytest.mark.parametrize的代码完成" src="/help/img/idea/2019.2/py_pytest_parametrize_completion.png" id="0d5ea5c3" width="500" height="241"></figure>            <p></p>        </li><li class="list__item" id="f297c277"><p>运行测试<code class="code">car.brake()</code>功能。您应该期待以下测试报告：</p><figure><img alt="car.brake功能的三项测试失败且一项测试通过" title="car.brake功能的三项测试失败且一项测试通过" src="/help/img/idea/2019.2/py_pytest_parametrize_test_run.png" id="aae88842" width="800" height="529"></figure>        <p></p></li></ol><p id="e2e669db">您也可以针对<code class="code">car.accelerate()</code>的功能以确保除55以外的所有速度值均失败。请参阅<a href="https://docs.pytest.org/en/latest/parametrize.html" rel="noopener noreferrer" data-external="true" target="_blank">pytest文档</a>以获取有关参数化测试的更多信息。</p></section>    <p id="5305e731">除了提到的功能，pytest支持行为驱动开发（BDD）通过<span class="emphasis">pytest_bdd。</span>当您需要使用Gherkin语言快速记录测试并利用pytest的有益功能（例如， <code class="code">fixture</code> 。</p>    <section class="procedure-steps"><h3 id="pytest-bdd" data-toc="Pytest#pytest-bdd">实施测试方案</h3><ol class="list _decimal"><li class="list__item" id="a3ef4049"><p id="b6607f4a">让我们修改<code class="code">Car</code>样本以验证汽车的速度。将以下函数添加到<span class="filepath">Car.py</span>文件中：</p>            <div class="code-block" data-lang="python">def speed_validate（self）：返回self.speed <= 160</div>        </li><li class="list__item" id="4fc004ab">            <p id="c9843cd9">接下来，在您的项目中启用<span class="emphasis">pytest-bdd</span> 。 <a name="open_settings"></a>                在“ <span class="control">设置/首选项”</span>对话框中（ <kbd data-primary_default_for_windows="Ctrl+Alt+S" data-primary_intellij_idea_classic_macos="⌘+Comma" data-primary_default_for_gnome="Ctrl+Alt+S" data-primary_default_for_kde="Ctrl+Alt+S" data-primary_sublime_text="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-primary_emacs="Ctrl+Alt+S" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⌘," data-secondary_default_for_gnome="⌃⌥S" data-secondary_default_for_kde="⌃⌥S" data-secondary_eclipse="⌃⌥S" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⌘,">Ctrl+Alt+S</kbd> ），导航到“ <span class="menupath" data-skip-index="skip">语言和框架| BDD</span> ，然后从<span class="control">Preferred BDD framework</span>列表中选择<span class="control">pytest-bdd</span> 。</p>        </li><li class="list__item" id="6b3b758c"><p id="8959a866">创建一个<span class="filepath">.feature</span>文件，以使用Gherkin语言记录BDD方案。右键单击项目根目录，然后选择“ <span class="menupath" data-skip-index="skip">新建” |“新建”。小黄瓜功能文件</span> 。在打开的对话框中，将<span class="filepath">car.feature</span>指定为文件名，然后单击<span class="control">OK</span> 。</p></li><li class="list__item" id="f0bafa19">            <p id="7dd5617d">将以下方案添加到<span class="filepath">car.feature</span>文件：</p>            <div class="code-block" data-lang="actionscript">功能：速度方案：加速时有效速度给定速度小于160时速度有效情况：加速时无效速度给定速度大于给定速度160则速度无效</div>          <p id="2acf2b09">两种情况都可以验证汽车的速度。该速度在不超过160的值时应该是有效的。请注意，方案步骤已突出显示，因为此时尚未定义它们。</p>            <figure><img alt="bdd场景" title="bdd场景" src="/help/img/idea/2019.2/py_pytest_bdd_feature.png" id="38da9e48" width="400" height="306"></figure>        </li><li class="list__item" id="b0e66e38">            <p id="3755e233">PyCharm支持快速生成整个功能文件的步骤定义。将光标置于任何突出显示的步骤上，单击<kbd data-primary_default_for_windows="Ctrl+Shift+A" data-primary_intellij_idea_classic_macos="Shift+⌘+A" data-primary_default_for_gnome="Ctrl+Shift+A" data-primary_default_for_kde="Ctrl+Shift+A" data-primary_sublime_text="Ctrl+Shift+P" data-primary_eclipse="Ctrl+Shift+A" data-primary_emacs="Escape, X" data-primary_default_for_xwin_windows="N/A" data-secondary_default_for_macos="⇧⌘A" data-secondary_default_for_gnome="⌃⇧A" data-secondary_default_for_kde="⌃⇧A" data-secondary_eclipse="⌃⇧A" data-secondary_default_for_xwin_macos="N/A" data-secondary_sublime_text_macos="⇧⌘P">Ctrl+Shift+A</kbd> ，然后选择<span class="control">创建所有步骤定义</span> 。在打开的对话框中，指定测试文件的名称（应以<span class="control">test</span> <span class="control">开头），</span>从“ <span class="control">文件类型”</span>列表中选择<span class="control">Python（pytest-bdd）</span> ，并在需要时修改默认文件位置。</p>            <figure><img alt="步骤定义生成" title="步骤定义生成" src="/help/img/idea/2019.2/py_pytest_bdd_step_definitions.png" id="e416f235" width="550" height="231"></figure>            <p id="08660d55">检查<span class="filepath">test_car_pytest_bdd_fixture.py</span>文件。它包含所有必需的<code class="code">import</code>每个方案步骤的声明和定义。</p>         </li><li class="list__item" id="39066223">            <p id="2f7a5251">让我们修改测试文件以将pytest夹具用于<code class="code">Car</code>对象并添加更多测试逻辑：</p>            <div class="code-block" data-lang="python">从pytest_bdd导入方案（给定时间）开始，然后从Car导入pytest。情境（'car.feature'，'无效速度'）def test_speed_invalid（）：通过@given（“速度小于160”）def set_valid_speed（my_car）：my_car.speed = 50 @given（“速度大于160 “）def set_invalid_speed（my_car）：my_car.speed = 100 @when（”加速“）def car_accelerate（my_car）：my_car.accelerate（）@then（”速度有效“）def成功（my_car）：断言my_car.speed_validate （）@then（“速度无效”）def失败（my_car）：断言不是my_car.speed_validate（）</div>         </li><li class="list__item" id="402f42cd">             <p id="4c354dab">通过创建相应的<a href="run-debug-configuration-py-test.html">“运行/调试”</a>配置来运行测试。您还可以使用“ <span class="control">运行”</span>图标运行任何一种方案<img class="inline-icon-16" src="/help/img/idea/2019.2/icons.toolwindows.toolWindowRun.svg@2x.png" width="16" alt="运行图标">在排水沟中。</p>         </li><li class="list__item" id="99227223">            <p id="5662eb06">检查测试运行结果。</p>            <figure><img alt="pytest-bdd结果" title="pytest-bdd结果" src="/help/img/idea/2019.2/py_pytest_bdd_results.png" id="4d708755" width="900" height="306"></figure>            <p id="309d5dd6">在我们的示例中，我们有<code class="code">test_speed_valid</code>测试通过， <code class="code">test_speed_invalid</code>测试失败。</p>        </li></ol></section>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月6日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="testing-frameworks.html">测试框架</a> <a class="navigation-links__next" href="tox-support.html">Tox支持</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>