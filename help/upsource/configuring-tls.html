<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta charset="UTF-8"><title>配置TLS-帮助|帮助上游</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Configuring_TLS"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索上游帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>上载2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="default" data-group="primary" selected>默认（Windows / Linux）</option><option value="mac_os_x_10.5_" data-group="secondary">默认（Mac OS X 10.5+）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Configuring_TLS.xml" data-toc="Configuring_TLS">配置TLS</h1>    <aside class="note " rel="Configuring_TLS.xml" id="5f4a9f44" data-title="">        <p id="00d6cdd4">此处列出的所有命令都是Windows命令。如果您使用的是Linux或macOS，只需更换<code class="code">.bat</code>与<code class="code">.sh</code> 。对于macOS或Linux，请确保以非root用户身份启动Upsource。</p>    </aside>    <p id="33bfe46c">有几种方法可以在Upsource服务器及其客户端之间使用TLS（SSL）设置加密的HTTPS连接。</p>    <ul class="list _ul"><li class="list__item" id="9f707ea2">            <p id="c64ffae4">使用Upsource的内置TLS。您可以将Upsource配置为以HTTPS模式运行：</p><ul class="list _ul"><li class="list__item" id="09ddb3d1">                        <p id="697de7ac">在初始Upsource <a href="install-config.html">安装</a>或<a href="upgrade.html">升级</a>过程中，通过<a href="configuration-wizard.html">Configuration Wizard</a>从<a href="configuration-wizard.html">Configuration Wizard</a>                        </p>                    </li><li class="list__item" id="cef71429">                        <p id="355d0a9f">从命令行中，为现有的Upsource安装启用（也禁用）HTTPS</p>                    </li></ul>            <p></p>        </li><li class="list__item" id="8587ccf3">            <p id="b25205ff">使用第三方TLS终止代理服务器。当您由于加密以外的其他原因而必须在代理服务器后运行Upsource时，则首选此选项。有关详细信息，请参见<a href="proxy-configuration.html">代理配置</a> 。</p>        </li></ul>    <p id="fd1f58ac">无论当前设置如何，您都可以<a href="#Third-party-proxy-Built-in-TLS">随时</a>从第三方TLS终止代理切换到Upsource内置TLS，反之亦然。</p>    <div class="chapter"><h2 id="built-in-TLS-in-current-installation" data-toc="Configuring_TLS#built-in-TLS-in-current-installation">在当前的Upsource安装中配置内置TLS</h2>        <p id="674e9b3b">使用命令行，可以在<b id="08fce5e4">HTTP</b>和<b id="ef05e4fd">HTTPS</b>模式之间切换。</p>        <ul class="list _ul"><li class="list__item" id="fa277c1d"><p>                <a href="#HTTP">HTTP</a> —默认HTTP模式。内置TLS被<b id="da92c9ed">禁用</b> 。</p></li></ul>        <p id="c0e8402b">要启用安全HTTPS模式，您需要具有<a href="tls-server-certificates-and-keystores.html">私钥和证书</a> ， <a href="tls-server-certificates-and-keystores.html">并</a>使用相应的配置选项以密钥库或单独文件的形式提供给Upsource：</p>        <ul class="list _ul"><li class="list__item" id="0a3ab20b"><p>                <a href="#HTTPS-keystore">HTTPS（使用密钥库）</a> —安全的HTTPS模式。内置TLS已<b id="3315a0a0">启用</b> 。如果您在密钥库文件中以<a href="https://docs.oracle.com/javase/7/docs/technotes/tools/windows/keytool.html" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式提供<a href="tls-server-certificates-and-keystores.html">私钥/证书</a>数据，请使用此配置。</p></li><li class="list__item" id="8d4dc68f"><p>                <a href="#HTTPS-privateKeyAndCert">HTTPS（使用私钥和证书）</a> —安全的HTTPS模式。内置TLS已<b id="10b9e33d">启用</b> 。如果您以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式在单独的文件中提供<a href="tls-server-certificates-and-keystores.html">私钥，证书</a>和证书链（可选）数据，请使用此配置。</p></li></ul>        <p id="54bbf6c1">要切换到所需的模式，您需要停止Upsource并运行<code class="code">configure</code>命令定义您选择的配置所需的所有属性。请参见下面的详细说明和每种配置的完整属性列表。</p>        <aside class="note " rel="54bbf6c1" id="e4ca2316" data-title="">            <p id="5eeadc83">如果您已经配置了HTTPS，并且只想将新的<a href="tls-server-certificates-and-keystores.html">私钥/证书</a>应用于服务器，则也可以使用这些过程。</p>            <p id="3dcb0511">                <b id="3c9dc902"><font style="color:#ff0000">重要！</font></b>                请注意<code class="code">configure</code>命令应该包括所有特定于您的配置的参数，即使它们已经设置并且您只想更改其中之一。唯一的例外是可以单独运行的<a href="#redirect">重定向</a>参数。</p>        </aside>    </div>    <div class="chapter"><h2 id="HTTP" data-toc="Configuring_TLS#HTTP">切换到HTTP模式-禁用内置TLS</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="ebad0b90">                <p id="62d6bb32">停止上载： <code class="code"><upsource_home>/bin/upsource.bat stop</code>                </p>            </li><li class="list__item" id="8bffcd12">                <p id="bbec05f7">输入以下命令：</p><div class="code-block" data-lang="bash">
                        <upsource_home>/bin/upsource.bat配置--listen-port = 8080 --base-url = <new base="" url="">--secure-mode =禁用</new></upsource_home></div>                <p></p>            </li><li class="list__item" id="b8563efe">                <p id="ab643b28">                    </p><p id="a4a167bd">启动上游： <code class="code"><upsource_home>/bin/upsource.bat start</code>                    </p>                <p></p>            </li></ol></section>        <aside class="note " rel="e154273e" id="f56ad611" data-title="">            <p id="01790429">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters">配置参数”</a> 。</p>        </aside>    </div>    <div class="chapter"><h2 id="HTTPS-keystore" data-toc="Configuring_TLS#HTTPS-keystore">使用密钥库切换到HTTPS模式</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="162aa01b">                <p id="1ce48dec">准备包含服务器的私钥和证书的密钥库文件。它包含的证书数据可以采用<a href="https://docs.oracle.com/javase/7/docs/technotes/tools/windows/keytool.html" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式，但文件名应为<span class="filepath">keystore.jks</span> ，以便Upsource接受它。如果不是，则将文件重命名为<span class="filepath">keystore.jks</span> 。</p>            </li><li class="list__item" id="60ae7c1c">                <p id="42fc5c01">创建一个临时文件夹，并将包含服务器的私钥和证书的文件<span class="filepath">keystore.jks</span>放入该文件夹。</p>            </li><li class="list__item" id="64c3da32">                <p id="e2dba1b0">停止上载： <code class="code"><upsource_home>/bin/upsource.bat stop</code>                </p>            </li><li class="list__item" id="e6b51b57">                <p id="dba99db1">运行以下命令：</p><div class="code-block" data-lang="bash">
                        <upsource_home>/bin/upsource.bat配置\ --listen-port = 443 \ --base-url = <new base="" url="">\ --secure-mode = tls \ --tls-server-cert-keystore-file = <path-to-keystore>\ --tls-server- cert-keystore-password = <keystore password="">\ --tls-服务器-cert-keystore-key-alias = <private key="" entry="" alias="">\ --tls-server-cert-keystore-key-password = <private key="" entry="" password="">\ --tls-redirect-from-http = <[true | false]> [--tls-redirect-from-http-listen-port = 8080]</private></private></keystore></path-to-keystore></new></upsource_home></div>                <p></p>                <p id="3c308952">如果密钥库文件的格式为<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a> ：</p>                    <ul class="list _ul"><li class="list__item" id="44700ac9">                            <p id="3863bdde">参数值<code class="code">--tls-server-cert-keystore-key-alias</code>应为friendlyName或带有服务器证书的包装袋的序列号。（包编号从1开始，因此如果密钥库中只有一个包，则其序列号为1。）</p>                        </li><li class="list__item" id="02bf0027">                            <p id="4e541113">跳过参数<code class="code">--tls-server-cert-keystore-key-password=<private key entry password></code>如果私钥条目未使用密码保护。</p>                        </li></ul>            </li><li class="list__item" id="0c7d5c2d">                <p id="0636fcb6">                    </p><p id="515f1734">启动上游： <code class="code"><upsource_home>/bin/upsource.bat start</code>                    </p>                <p></p>            </li></ol></section>        <aside class="note " rel="5270f825" id="e0cf0544" data-title="">            <p id="61803a4a">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters">配置参数”</a> 。</p>        </aside>    </div>    <div class="chapter"><h2 id="HTTPS-privateKeyAndCert" data-toc="Configuring_TLS#HTTPS-privateKeyAndCert">使用单独的私钥和证书切换到HTTPS模式</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="46bf98ee">                <p id="bdbcf029">停止上载： <code class="code"><upsource_home>/bin/upsource.bat stop</code>                </p>            </li><li class="list__item" id="4af754a3">                <p id="5d8f1f2d">运行以下命令：</p><div class="code-block" data-lang="bash">
                        <upsource_home>/bin/upsource.bat配置\ --listen-port = 443 \ --base-url = <new base="" url="">\ --secure-mode = tls \ --tls-server-cert-key-file = <path-to-private-key-file>\ --tls-server- cert-file = <path-to-certificate-file>\ [--tls-server-cert-chain-file = <path-to-certificate-chain-file>] \ --tls-redirect-from-http = <[true | false]> \ [--tls-redirect-from-http-listen -port = 8080] \</path-to-certificate-chain-file></path-to-certificate-file></path-to-private-key-file></new></upsource_home></div>                <p></p>                <ul class="list _ul"><li class="list__item" id="3fa14610">                        <p id="12739a44">如果私钥已加密，请将此属性添加到命令中： <code class="code">--tls-server-cert-private-key-passphrase=<your passphrase></code>                        </p>                    </li><li class="list__item" id="496884d4">                        <p id="f5c98cca">如果要定义证书文件的相对路径，请使用<code class="code">tls-server-cert-key-file</code> ， <code class="code">tls-server-cert-file</code>和<code class="code">tls-server-cert-chain-file</code> 。设置附加值<code class="code">tls-server-cert-folder</code>属性以及目录的绝对路径。相对路径针对指定的绝对路径进行解析。</p>                    </li><li class="list__item" id="1fc27904">                        <p id="61a0732d">如果由于切换到HTTPS模式而导致服务器基本URL更改，请使用<code class="code">--base-url=<new base URL></code>参数以设置此值。</p>                    </li><li class="list__item" id="3acd090e">                                            </li></ul>            </li><li class="list__item" id="2f6c01da">                <p id="4743e5fa">                    </p><p id="7bead344">启动上游： <code class="code"><upsource_home>/bin/upsource.bat start</code>                    </p>                <p></p>            </li></ol></section>        <aside class="note " rel="53579a35" id="23cf0b66" data-title="">            <p id="fe0383ce">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters">配置参数”</a> 。</p>        </aside>    </div>    <div class="chapter"><h2 id="redirect" data-toc="Configuring_TLS#redirect">重定向HTTP流量</h2>        <p id="5928b479">如果要使用安全HTTPS模式，则可以选择设置<span class="control">重定向侦听端口</span> -一种非安全端口，它将接收所有HTTP请求并将其重定向到安全侦听端口。为此，请设置参数<code class="code">tls-redirect-from-http=true</code>并添加<code class="code">tls-redirect-from-http-listen-port=<your redirect port number></code>到<code class="code">configure</code>命令。</p>        <p id="8f87bfad">如果您已经在HTTPS模式下运行服务器，则可以通过运行以下命令随时启用或禁用<span class="control">重定向监听端口</span> 。 <code class="code">configure</code>具有上述属性的命令-无需在命令中包含其他属性。</p>        <p id="079d7624">确保先停止Upsource，然后再运行<code class="code">configure</code>命令。</p>    </div>    <div class="chapter"><h2 id="Third-party-proxy-Built-in-TLS" data-toc="Configuring_TLS#Third-party-proxy-Built-in-TLS">在第三方TLS终止代理和Upsource的内置TLS之间切换</h2>        <p id="9f995113">从第三方TLS终止代理切换到Upsource的内置TLS或反之亦然，不需要任何特定过程，可以通过以下步骤完成：</p>        <section class="procedure-steps"><h3 id="1e7712ce">要将第三方TLS终止代理切换到Upsource的内置TLS，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="b69f3061"><p>禁用第三方TLS终止代理。</p></li><li class="list__item" id="1552d5ea"><p>如上所述，启用Upsource的内置TLS，选择两个可用的证书存储选项之一： <a href="#HTTPS-keystore">HTTPS（密钥库）</a>或<a href="#HTTPS-privateKeyAndCert">HTTPS（privateKeyAndCert）。</a>            </p></li></ol></section>        <section class="procedure-steps"><h3 id="8e5939ae">要将Upsource的内置TLS切换为第三方TLS终止代理，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="adeb9a9a"><p>作为切换Upsource到HTTP模式<a href="#HTTP">如上所述</a> 。</p></li><li class="list__item" id="cf067c26">                <a href="proxy-configuration.html">配置并启用第三方代理。</a>            </li></ol></section>    </div>    <div class="chapter"><h2 id="configuration-parameters" data-toc="Configuring_TLS#configuration-parameters">配置参数</h2>        <p id="e410886d">下表提供了可用于配置内置TLS的参数列表。</p>        <div class="table-wrapper"><table class=" wide" width="100%" id="5692c12c"><thead><tr id="62eb2b80" class="ijRowHead"><th id="9112dcb9" width="20%"><p>属性</p></th><th id="5f144455" width="20%"><p>值</p></th><th id="1dcff834"><p>描述</p></th></tr></thead><tbody><tr id="4d346a26" class="ijRowOdd"><td id="1616a80a"><p>安全模式</p></td><td id="a3189abf"><p><code class="code">disable</code> |<code class="code">tls</code></p></td><td id="c4d6b3cb"><p id="ce29c82a">应用于上游服务器的连接模式。此属性支持以下值：</p>                    <ul class="list _ul"><li class="list__item" id="46968729"><p><code class="code">disable</code> — TLS被禁用。这是此属性的默认值。</p></li><li class="list__item" id="744de2ca"><p><code class="code">tls</code> —启用了TLS。</p></li></ul>                </td></tr><tr id="c001d926" class="ijRowEven"><td id="8226ed57"><p>监听端口</p></td><td id="4ec349d8"></td><td id="56648019"><p>Upsource侦听HTTP流量的端口。</p></td></tr><tr id="60f0ba03" class="ijRowOdd"><td id="c51c4a9c"><p>基本网址</p></td><td id="bc4c1978"></td><td id="e94d6c14"><p id="fcc88647">最终用户请求访问您的Upsource安装的URL。例如， <code class="code">https://Upsource.mydomain.com</code> 。</p>                    <ul class="list _ul"><li class="list__item" id="0d2d1196"><p>当值为<code class="code">secure-mode</code>财产是<code class="code">tls</code>或您的Upsource安装在SSL终止的反向代理服务器后得到保护，则URL应以<code class="code">https</code> 。</p></li><li class="list__item" id="a5e1b90e"><p>否则（使用纯HTTP运行Upsource时），URL开头<code class="code">http</code> 。</p></li></ul>                </td></tr><tr id="5e482b69" class="ijRowEven"><td id="4089b818"><p>tls-redirect-from-http</p></td><td id="e0710618"><p><code class="code">true</code> |<code class="code">false</code></p></td><td id="d548f64c"><p id="88646e73">设置为true，以启用其他端口（由属性定义） <code class="code">tls-redirect-from-http-listen-port</code> ）接受未加密的HTTP流量并将其重定向到该属性定义的安全端口<code class="code">listen-port</code> 。</p>                    <p id="0fba546c">默认值为<code class="code">false</code> 。</p></td></tr><tr id="fdb524c2" class="ijRowOdd"><td id="cf229f40"><p>tls-redirect-from-http-listen-port</p></td><td id="00a3eeee"></td><td id="9133f35b"><p>指定其他端口以接受未加密的HTTP流量，并将其重定向到该属性定义的安全端口<code class="code">listen-port</code> （要启用此端口，请设置属性<code class="code">tls-redirect-from-http</code>至<code class="code">true</code> ）。</p></td></tr><tr id="01c68f8c" class="ijRowEven"><td id="8389e3f2"><p>tls-server-cert-folder</p></td><td id="5f56f4ff"></td><td id="14682796"><p id="9460eba2">一个（可选）绝对路径，用于解析其他命令行参数定义的相对路径（如果存在）。根据该目录解析在其他属性中指定的服务器证书文件的相对路径。可以引用相对路径的属性是：</p>                    <ul class="list _ul"><li class="list__item" id="66f04193"><code class="code">tls-server-cert-key-file</code></li><li class="list__item" id="d99fe1fe"><code class="code">tls-server-cert-file</code></li><li class="list__item" id="faacefa4"><code class="code">tls-server-cert-chain-file</code></li><li class="list__item" id="ba3e754e"><code class="code">tls-server-cert-keystore-file</code></li></ul>                </td></tr><tr id="daa9bb58" class="ijRowOdd"><td id="896a31e1"><p>tls-server-cert-keystore-file</p></td><td id="f8ae985a"></td><td id="8a214238"><p><a href="https://en.wikipedia.org/wiki/Keystore" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式的密钥库文件的位置。</p></td></tr><tr id="5a847e29" class="ijRowEven"><td id="98003f91"><p>tls-server-cert-keystore-password</p></td><td id="d66fae15"></td><td id="ca1b1b91"><p>密钥库完整性密码</p></td></tr><tr id="548a2e4e" class="ijRowOdd"><td id="c1b22d6a"><p>tls-服务器-证书-密钥库-密钥别名</p></td><td id="9d1297a6"></td><td id="05e3ab6b"><p id="1cb999e6">密钥库中包含服务器证书和私钥的条目的别名。如果您的密钥库使用<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式，请遵循以下准则：</p>                    <ul class="list _ul"><li class="list__item" id="03ca6832"><p>使用存储为<code class="code">friendlyName</code>在密钥库中。</p></li><li class="list__item" id="2ef68396"><p>如果私钥和证书对未标记为<code class="code">friendlyName</code>在生成期间，请使用此参数在密钥库中提供此对的序号。对于仅包含一个证书和私钥对的密钥库，请将值设置为<code class="code">1</code> 。</p></li></ul>                </td></tr><tr id="a8d25e7c" class="ijRowEven"><td id="48ec2f5f"><p>tls-server-cert-keystore-key-password</p></td><td id="b9971850"></td><td id="402760c2"><p>用于保护服务器在密钥库中的私钥条目的密码。</p></td></tr><tr id="a6fe3944" class="ijRowOdd"><td id="3de32d41"><p>tls服务器证书密钥文件</p></td><td id="2f660e0c"></td><td id="a71ec1a2"><p>以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储的私钥（ <a href="https://en.wikipedia.org/wiki/PKCS_1" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃1</a>或<a href="https://en.wikipedia.org/wiki/PKCS_8" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃8</a> ）文件的位置。</p></td></tr><tr id="86cee1d6" class="ijRowEven"><td id="6ee99561"><p>tls-server-cert-file</p></td><td id="8337991d"></td><td id="843a7d06"><p>证书文件的位置，以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储。</p></td></tr><tr id="ac7a0bc9" class="ijRowOdd"><td id="a195af40"><p>tls服务器证书链文件</p></td><td id="5a8b0266"></td><td id="dc4f6945"><p>包含证书链的文件的（可选）位置，以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储。</p></td></tr><tr id="dc37ce9a" class="ijRowEven"><td id="0f1134b9"><p>tls-server-cert-private-key-passphrase</p></td><td id="a5dd1036"><p>串</p></td><td id="991049b0"><p>如果您使用加密的私钥，则使用此属性提供用于加密的密码短语。同时支持<a href="https://en.wikipedia.org/wiki/PKCS_1" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃1</a>和<a href="https://en.wikipedia.org/wiki/PKCS_8" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃8</a>格式。</p></td></tr></tbody></table></div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="upsource-cassandra-properties.html">上游Cassandra属性</a> <a class="navigation-links__next" href="tls-server-certificates-and-keystores.html">TLS服务器证书</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>