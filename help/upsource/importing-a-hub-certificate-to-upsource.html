<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta charset="UTF-8"><title>将集线器证书导入到上游-帮助|帮助上游</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Importing_a_Hub_certificate_to_Upsource"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索上游帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>上载2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="default" data-group="primary" selected>默认（Windows / Linux）</option><option value="mac_os_x_10.5_" data-group="secondary">默认（Mac OS X 10.5+）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Importing_a_Hub_certificate_to_Upsource.xml" data-toc="Importing_a_Hub_certificate_to_Upsource">将集线器证书导入到上游</h1>    <p id="e5e3f35c">如果您的Hub实例通过自签名证书或专用CA签名的证书通过HTTPS可用，则您将无法连接到Hub，因为此类证书不受信任。</p>    <p id="12028e71">请按照以下说明将集线器证书导入Upsource，并配置集群中运行的Upsource服务以接受它。</p>    <div class="chapter"><h2 id="cf356e87">准备包含中心证书的keystore.jks</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="2ff54522">                <p id="2937e392">从浏览器下载主机的证书（该说明适用于Google Chrome）：</p>                <ul class="list _alpha-lower"><li class="list__item" id="4d16cd35"><p>打开集线器主页（例如https://myhub.com）</p></li><li class="list__item" id="acde1bb9"><p>单击地址栏中的锁定图标以显示有关主机的信息。</p></li><li class="list__item" id="b44308b4"><p>转到“ <span class="control">连接”</span>选项卡，然后单击“ <span class="control">证书信息”</span> 。将显示一个对话框，其中包含有关主机证书的信息。</p></li><li class="list__item" id="8315955f"><p>转到“ <span class="control">详细信息”</span>选项卡，然后单击底部的“ <span class="control">导出...”</span>按钮。</p></li><li class="list__item" id="00384092"><p>将证书保存为“ Base64编码的ASCII，单个证书”格式（我们将其<i id="dd92039a">命名为myhub.com.cer</i></p></li></ul>            </li><li class="list__item" id="a20a24e8">                <p id="9c4fd07b">创建一个新的密钥库，并将证书导入其中。为它提供一个新密码（必须至少包含6个字符），并确认您信任证书。</p>                <div class="code-block" data-lang="bash">keytool-导入-trustcacerts-文件myhub.com.cer -alias myhub.com -keystore keystore.jks输入密钥库密码： <keystore password="">重新输入新密码： <keystore password="">...
                    <certificate info="" shown="" here="">...信任此证书吗？[否]：是证书已添加到密钥库</certificate></keystore></keystore></div>            </li></ol></section>    </div>    <div class="chapter"><h2 id="9a9e2dc6">对每个群集节点执行以下步骤</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="da831651">                <p id="223afd4f">将文件<i id="2dc7df2d">keystore.jks</i>复制到每个群集节点（假设文件存储在目标节点上的<i id="881e1546">/opt/hub/cert/keystore.jks</i> ）</p>            </li><li class="list__item" id="b09344d9">                <p id="fc82e7f4">运行以下命令：<code class="code">chown -R 13001:13001 /opt/hub/cert</code></p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="05c819d0">设置所有服务的容量（haproxy除外）：</h2>        <p id="36522951">在<i id="30928ca8">docker-compose.yml</i>文件中预定义了以下卷。您只需要取消注释它们，以便生成的文本如下所示：</p>        <div class="code-block" data-lang="bash">分析器：卷：-/ opt / hub / cert：/ opt / upsource-analyzer / conf / cert ...前端：卷：-/ opt / hub / cert：/ opt / upsource-frontend / conf / cert ...psi-broker：卷：-/ opt / hub / cert：/ opt / upsource-psi-broker / conf / cert ...opscenter：卷：-/ opt / hub / cert：/ opt / upsource-opscenter / conf / cert ...文件群集：卷：-/ opt / hub / cert：/ opt / upsource-file-clustering / conf / cert</div>        <p id="31e0db03">在<i id="fcdebc37">docker-compose-cluster-init.yml</i>文件中预定义了以下卷：</p>        <div class="code-block" data-lang="bash">cluster-init：卷：-/ opt / hub / cert：/ opt / upsource-cluster-init / conf / cert ...
    </div>        <p id="df382aaf">未注释的卷定义了将实际<i id="083a2b10">keystore.jks</i>文件存储在的群集节点上的目录。如果要将其存储在默认目录（/ opt / hub / cert）以外的群集节点目录中，则必须用实际目录替换未注释的卷定义中的默认值<i id="d86fecf2">/ opt / hub / cert</i> 。包含<i id="cc48a553">keystore.jks</i> 。</p>    </div>    <div class="chapter"><h2 id="d0821647">设定参数</h2>        <p id="89b11f71">在<i id="9f396971">upsource.env中</i>设置参数HUB_KEYSTORE_PATH和<i id="9f396971">HUB_KEYSTORE_PASSWORD</i> ：</p>        <p id="07a9fa6b"><code class="code">HUB_KEYSTORE_PATH=cert/keystore.jks</code></p>        <p id="0289e534"><code class="code">HUB_KEYSTORE_PASSWORD=<master password from provided keystore should be set here></code></p>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="setting-up-upsource-cluster.html">设置上游集群</a> <a class="navigation-links__next" href="scaling-upsource-services-in-the-cluster.html">扩展</a> <a class="navigation-links__prev" href="setting-up-upsource-cluster.html">集群中的</a> <a class="navigation-links__next" href="scaling-upsource-services-in-the-cluster.html">上游服务</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>