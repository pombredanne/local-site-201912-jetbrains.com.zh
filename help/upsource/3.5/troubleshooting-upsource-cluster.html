<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><meta charset="UTF-8"><meta name="robots" content="noindex"><title>Upsource 3.5 Help :: Troubleshooting Upsource cluster</title><link rel="stylesheet" href="/help/app/app.css"></head><body data-id="Troubleshooting_Upsource_cluster"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search Upsource Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header"><div class="container"><h3>Upsource 3.5 Help</h3><div class="shortcuts-switcher"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="default" selected>Default (Windows/Linux)</option><option data-group="primary" value="default_for_gnome">GNOME</option><option data-group="primary" value="default_for_kde">KDE</option><option data-group="primary" value="default_for_xwin">XWindow</option><option data-group="primary" value="emacs">Emacs</option><option data-group="primary" value="visual_studio">Visual Studio</option><option data-group="primary" value="netbeans_6.5">NetBeans 6.5</option><option data-group="primary" value="eclipse">Eclipse</option><option data-group="secondary" value="mac_os_x_10.5_">Default (Mac OS X 10.5+)</option><option data-group="secondary" value="mac_os_x">OS X</option><option data-group="secondary" value="eclipse_mac_os_x">OS X Eclipse</option><option data-group="secondary" value="intellij_idea_classic_os_x">IntelliJ IDEA Classic (OS X)</option><option data-group="secondary" value="xcode">Xcode</option><option data-group="secondary" value="visual_studio">Visual Studio</option><option data-group="secondary" value="resharper">ReSharper</option><option data-group="secondary" value="resharper_osx">ReSharper OSX</option><option data-group="secondary" value="emacs">Emacs</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="false"><div class="navigation-links _top"><a class="navigation-links__prev" href="upsource-cluster-hardware-requirements.html">Upsource cluster hardware requirements</a></div><h1>Troubleshooting Upsource cluster</h1><a name="d2557e3"></a><h2>Upsource Cluster doesn't start/restart with the following error:</h2>
        <a name="d2557e5"></a><div class="code-block" data-lang="Console"><code class="code-block__wrapper">ERROR: <span class="k">for</span> opscenter  Cannot create container <span class="k">for</span> service haproxy: Unable to find a node that satisfies the following conditions
<span class="o">[</span>port <span class="m">8080</span> <span class="o">(</span>Bridge mode<span class="o">)]</span>
<span class="o">[</span>available container slots<span class="o">]</span>
<span class="o">[</span><span class="nv">container</span><span class="o">==</span>7f96d284c7d4a2477262a3a020e8c16c2e60a2d9d1a0fc2a42bb0b3d35ff3e56 <span class="o">(</span><span class="nv">soft</span><span class="o">=</span><span class="nb">false</span><span class="o">)]</span></code></div>
        <a name="d2557e8"></a><p>This is a known integration issue between swarm and docker-compose. The error occurs when the swarm manager tries to recreate a service container that defines port mapping to the host machine port. See <a name="d2557e10"></a><a href="https://docs.docker.com/compose/swarm/#host-ports-and-recreating-containers" data-external="true"><span>this article</span></a> for details.</p>
        <a name="d2557e14"></a><p><a name="d2557e15"></a><b id="d2557e15">Solution:</b></p>
        <a name="d2557e18"></a><p>Remove haproxy container before starting the cluster:</p>
        <code class="code" data-lang="Java">./cluster.sh -H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; rm haproxy</code>
    <a name="d2557e25"></a><h2>Swarm cluster issues</h2>
        <a name="d2557e27"></a><p>All nodes marked as Unknown in the docker output <code class="code" data-lang="Java">-H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; info</code> </p>
        <a name="d2557e33"></a><p><a name="d2557e34"></a><b id="d2557e34">Solution:</b></p>
        <a name="d2557e37"></a><p>The problem may be caused by closed ports on some of the machines. Ensure that all ports used by the swarm cluster are opened. For instance:</p>
        <ul class="list _ul"><li class="list__item"><a name="d2557e42"></a>Docker engine of the swarm cluster listens to some tcp ports (2375, 2376 by default) </li><li class="list__item"><a name="d2557e45"></a>Swarm master listens to some port (4000 by default)</li><li class="list__item"><a name="d2557e48"></a>Key-value storage listens to some port (8500 is the default for consul)</li></ul>
        <a name="d2557e52"></a><p>To check if the ports are open, run:</p>
        <code class="code" data-lang="Java">docker -H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; info</code>
    <a name="d2557e60"></a><h2>Upsource services don't see each other</h2>
        <a name="d2557e62"></a><p><a name="d2557e63"></a><b id="d2557e63">Solution:</b></p>

        <a name="d2557e66"></a><p>To check whether services see each other or not, you can issue a GET request to http://&lt;address.of.node.where.opscenter.is.running&gt;:10080/monitoring/frontends. It should return a non-empty list if the cluster is running.</p>

        <a name="d2557e69"></a><p>If the link is not available it could mean that the haproxy/opscenter services are not finished starting yet.</p>
        <a name="d2557e72"></a><p>If the link returns an empty list, then most likely a connection between services has not been established (note that the list might be empty for a short period of time on startup while the frontend service is not yet initialized).</p>
        To restore the connection, try disabling the firewall on the swarm worker nodes in the cluster. For more details including what ports should be opened on the swarm cluster nodes in the firewall/access control lists, refer to <a name="d2557e75"></a><a href="https://docs.docker.com/swarm/plan-for-production/#network-access-control" data-external="true"><span>this description</span></a>.

    <div class="last-modified">Last modified: 21 February 2017 </div></article><div id="disqus_thread"></div></div></section></main></div><script></script><script src="/help/app/app.js"></script></body></html>