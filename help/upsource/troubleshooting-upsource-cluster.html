<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta charset="UTF-8"><title>Troubleshooting Upsource cluster - Help | Upsource</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Troubleshooting_Upsource_cluster"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search Upsource Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Upsource 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="default" selected>Default (Windows/Linux)</option><option data-group="secondary" value="mac_os_x_10.5_">Default (Mac OS X 10.5+)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Troubleshooting_Upsource_cluster" id="Troubleshooting_Upsource_cluster.xml">Troubleshooting Upsource cluster</h1>    <div class="chapter"><h2 id="upsource-cluster-doesn-t-start-restart-with-the-following-error" data-toc="Troubleshooting_Upsource_cluster#upsource-cluster-doesn-t-start-restart-with-the-following-error">Upsource Cluster doesn't start/restart with the following error:</h2>        <div class="code-block" data-lang="bash">
            ERROR: for opscenter Cannot create container for service haproxy: Unable to find a node that satisfies the
            following conditions
            [port 8080 (Bridge mode)]
            [available container slots]
            [container==7f96d284c7d4a2477262a3a020e8c16c2e60a2d9d1a0fc2a42bb0b3d35ff3e56 (soft=false)]
    </div>        <p id="0c943bd0">This is a known integration issue between swarm and docker-compose. The error occurs when the swarm manager            tries to recreate a service container that defines port mapping to the host machine port. See <a href="https://docs.docker.com/compose/swarm/#host-ports-and-recreating-containers" data-external="true" target="_blank" rel="noopener noreferrer">this article</a> for details.        </p>        <p id="2e8db8f9">            <b id="02cbb99b">Solution:</b>        </p>        <p id="9d2f17a4">Remove haproxy container before starting the cluster:</p>        <div class="code-block" data-lang="bash">./cluster.sh -H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; rm
            haproxy
    </div>    </div>    <div class="chapter"><h2 id="swarm-cluster-issues" data-toc="Troubleshooting_Upsource_cluster#swarm-cluster-issues">Swarm cluster issues</h2>        <p id="034ebdbc">All nodes marked as Unknown in the docker output <code class="code">-H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; info</code>        </p>        <p id="e4625aba">            <b id="606f41c3">Solution:</b>        </p>        <p id="a94e6cbf">The problem may be caused by closed ports on some of the machines. Ensure that all ports used by the swarm            cluster are opened. For instance:        </p>        <ul class="list _ul"><li class="list__item" id="6804723c"><p>Docker engine of the swarm cluster listens to some tcp ports (2375, 2376 by default)</p></li><li class="list__item" id="8d96092e"><p>Swarm master listens to some port (4000 by default)</p></li><li class="list__item" id="786386bb"><p>Key-value storage listens to some port (8500 is the default for consul)</p></li></ul>        <p id="3dea28a6">To check if the ports are open, run:</p>        <div class="code-block" data-lang="bash">docker -H tcp://&lt;swarm.master.host&gt;:&lt;swarm.master.port&gt; info
    </div>    </div>    <div class="chapter"><h2 id="upsource-services-don-t-see-each-other" data-toc="Troubleshooting_Upsource_cluster#upsource-services-don-t-see-each-other">Upsource services don't see each other</h2>        <p id="920fae5f">            <b id="283f5d13">Solution:</b>        </p>        <p id="72a845ac">To check whether services see each other or not, you can issue a GET request to            <span class="filepath">http://&lt;address.of.node.where.opscenter.is.running&gt;:10080/monitoring/frontends</span>.            It should return a non-empty list if the cluster is running.        </p>        <p id="97db047c">If the link is not available it could mean that the haproxy/opscenter services are not finished starting            yet.        </p>        <p id="62b96f75">If the link returns an empty list, then most likely a connection between services has not been established            (note that the list might be empty for a short period of time on startup while the frontend service is not            yet initialized).        </p>        To restore the connection, try disabling the firewall on the swarm worker nodes in the cluster. For more details        including what ports should be opened on the swarm cluster nodes in the firewall/access control lists, refer to <a href="https://docs.docker.com/swarm/plan-for-production/#network-access-control" data-external="true" target="_blank" rel="noopener noreferrer">this description</a>.    </div><div class="last-modified" data-skip-index="skip">Last modified: 9 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="migrating-to-a-cluster-from-a-zip-or-docker-installation-and-back.html">Migrating to a cluster from a ZIP or Docker installation and back</a><a class="navigation-links__next" href="advanced-upsource-tuning.html">Advanced Upsource tuning</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>