<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta charset="UTF-8"><title>从ZIP升级到Docker-帮助|帮助上游</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Upgrade_from_ZIP_to_Docker"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索上游帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>上载2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="default" data-group="primary" selected>默认（Windows / Linux）</option><option value="mac_os_x_10.5_" data-group="secondary">默认（Mac OS X 10.5+）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Upgrade_from_ZIP_to_Docker.xml" data-toc="Upgrade_from_ZIP_to_Docker">从ZIP升级到Docker</h1>    <p id="4e530154">请按照以下说明使用Docker发行版升级现有的ZIP安装。</p>    <p id="d914a3e0">在继续安装之前：</p>    <ul class="list _ul"><li class="list__item" id="e7b40d19"><p>确保您的主机上安装了最新版本的<a href="https://www.docker.com/" rel="noopener noreferrer" data-external="true" target="_blank">Docker</a> 。</p></li><li class="list__item" id="a0a363e9"><p>如果您当前的Upsource安装设置为与独立（外部） <a href="hub.html">集线器一起使用</a> ，请确保已安装最新版本的Hub，并在必要时进行<a href="/help/hub/upgrading-hub-installation.html" rel="noopener noreferrer" data-external="true" target="_blank">升级</a> 。</p></li></ul>    <div class="chapter"><h2 id="backup">1。备份资料</h2>        <p id="8e2eb885">            在现有的Upsource安装正在运行时<a href="backup.html">创建备份</a> 。</p>    </div>    <div class="chapter"><h2 id="stop">2。停止上传</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="465a4ce6"><p>停止上载： <code class="code"><upsource_home>\bin\upsource.sh stop</code>            </p></li><li class="list__item" id="4bb81830">                <p id="6cb3c8eb">使用操作系统的工具来确保Upsource启动的所有Java进程都不再运行。（在Windows上，您可以使用<a href="http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx" rel="noopener noreferrer" data-external="true" target="_blank">Process Explorer</a> 。）</p>                <ul class="list _ul"><li class="list__item" id="25825adb"><p>如果没有待处理的与上游资源相关的Java进程，请继续执行下一步。</p></li><li class="list__item" id="90d2f0a9">                        <p id="a3df1ffa">如果仍有与上游相关的Java进程正在运行：</p>                        <ul class="list _alpha-lower"><li class="list__item" id="31612c1a"><p>（可选，仅Windows）请考虑使用<a href="http://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html" rel="noopener noreferrer" data-external="true" target="_blank">jstack</a>工具从这些进程中获取线程转储（在Windows上，该文件位于<i id="d61d305a"><upsource_home>/ internal / java / windows-amd64 / bin下</upsource_home></i> ）， <a href="mailto:upsource-support@jetbrains.com.xml" data-external="true">并将线程转储提供给JetBrains</a>进行调查。</p></li><li class="list__item" id="ef6ea1fe"><p>杀死出色的过程树。</p></li></ul>                    </li></ul>            </li></ol></section>    </div>    <div class="chapter"><h2 id="pull-image">3。拉上图片</h2>        <p id="4e2efd30">从Docker Hub存储库中获取最新的Upsource版本的图像：</p>        <code class="code">docker pull jetbrains/upsource:<version></code>哪里<version>是Upsource版本的完整版本号。</version></div>    <div class="chapter"><h2 id="prepare-folders">4。准备文件夹</h2>        <ul class="list _alpha-lower"><li class="list__item" id="a5b4022e">                <p id="d71d4f66">在主机上创建空目录以存储上游数据，配置，日志和备份文件：</p>                <div class="code-block" data-lang="bash">mkdir -p -m 750 <path data="" to="" directory=""><path to="" logs="" directory=""><path to="" conf="" directory=""><path to="" backups="" directory="">
    </path></path></path></path></div>                <p id="a5f9ffa1">这些目录将作为卷传递到Upsource容器。</p>                <p id="d29b40ae">建议您相应地命名文件夹：</p>                <ul class="list _ul"><li class="list__item" id="482415ec">                        <i id="b5d7ca85">数据</i>                    </li><li class="list__item" id="7af37919">                        <i id="00f417ff">配置</i>                    </li><li class="list__item" id="c46e2fa7">                        <i id="89fa6819">日志</i>                    </li><li class="list__item" id="318fa921">                        <i id="2c9c2851">备份</i>                    </li></ul>            </li><li class="list__item" id="b118a731">                <p id="cde801cf">（仅适用于Linux或macOS）Upsource服务在Docker容器内以非root用户帐户13001：13001（group：id）运行。授予该帐户读/写权限，以访问您创建的目录：</p>                <div class="code-block" data-lang="bash">chown -R 13001：13001 <path data="" to="" directory=""><path to="" logs="" directory=""><path to="" conf="" directory=""><path to="" backups="" directory="">
    </path></path></path></path></div>            </li><li class="list__item" id="015552b3"><p>找到您在第1步中创建的最后一个备份（这是<i id="f3cd5fab">backups</i>文件夹中特定于日期的目录），然后将其从旧安装复制到刚刚为新安装创建的空<i id="871998a4">备份</i>文件夹中。</p></li></ul>    </div>    <div class="chapter"><h2 id="run">5，运行新的上游安装</h2>        <p id="398a1d53">使用以下命令来运行带有Upsource服务器的容器，并映射Upsource数据卷和端口：</p>        <div class="code-block" data-lang="bash"><upsource-server-instance><path data="" to="" directory="">docker run -it</path></upsource-server-instance> --name <upsource-server-instance>\ -v <path data="" to="" directory="">：/ opt / upsource / data \ -v <path to="" conf="" directory="">：/ opt / upsource / conf \ -v <path to="" logs="" directory="">：/ opt / upsource / logs \ -v <path to="" backups="" directory="">：/ opt / upsource / backups \ -p <port on="" host="">：8080 \ jetbrains /上游： <version>
    </version></port></path></path></path></path></upsource-server-instance></div>        <p id="28834fa6">哪里：</p>        <p id="2868a767">            <code class="code"><upsource-server-instance></code>是您为容器指定的名称。</p>        <p id="519f9afa">            <code class="code">-v <path to data directory>:/opt/upsource/data</code>映射在容器中你已经在主机上创建的<i id="e90407c5">数据</i>目录中的<i id="87495b5b">数据</i>目录。为其他目录设置了相同的映射： <i id="d4ea007d">conf，logs，backups</i> 。</p>        <p id="e5193575">            <code class="code">-p <port on host>:8080</code>此端口映射指示您的主机侦听<port on="" host="">并将所有流量传播到Docker容器内的端口8080。</port></p>        <p id="12fadd8d"><b id="23dd0713">仅Windows</b> ：添加<code class="code">-u root</code>后<code class="code">-p <port on host>:8080 \</code> 。</p>        <p id="24f1fc4b">            <code class="code">jetbrains/upsource:<version></code>使用Upsource构建指向正确的映像。</p>        <p id="02183e50">上游服务从Docker容器内的{0.0.0.0:8080}启动，并且端口8080映射到<port on="" host="">您指定的端口<port on="" host="">。这样，可以从<port on="" host="">对您的主机具有网络访问权限的任何计算机上访问服务<port on="" host="">。例如，如果主机的FQDN是host.mydomain.com，而主机名<port on="" host="">是7777，则该服务将在http://host.mydomain.com:7777上可用。</port></port></port></port></port></p>    </div>    <div class="chapter"><h2 id="wizard">6。跟随向导</h2>        <p id="025aaf37">首次运行时，Upsource服务将从上述地址处的配置向导启动。</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="5bd845e4">                <p id="0fe7e16c">在“配置向导”的第一页上，单击“ <span class="control">升级”</span> ：</p>                <figure><img alt="upgrade_wizard1" title="upgrade_wizard1" src="/help/img/upsource/2019.1/upgrade_wizard1.png" id="0c97f19b" width="400" height="374"></figure>            </li><li class="list__item" id="f7fc4ea3">                <p id="9e756c4a">选择旧安装的最后一个备份的位置（ <i id="10a8e3cc">backups</i>文件夹中特定于日期的目录）：</p>                <figure><img alt="upgrade_wizard2" title="upgrade_wizard2" src="/help/img/upsource/2019.1/upgrade_wizard2.png" id="1a84fa1c" width="400" height="1084"></figure>                <p id="12df8926">单击<span class="control">下一步</span> 。</p>            </li><li class="list__item" id="f3c40ef5">                <p id="8cb58f9a">现在，您可以验证系统设置和系统目录的位置。您也可以从HTTP切换到<a href="configuration-wizard.html#http-https">HTTPS模式</a> ，反之亦然，无论之前的设置如何：</p>                <figure><img alt="upgrade_wizard4" title="upgrade_wizard4" src="/help/img/upsource/2019.1/upgrade_wizard4.png" id="94052c2f" width="400" height="1380"></figure>                <aside class="note " rel="94052c2f" id="b9fbba76" data-title="">                    <p id="c780448b">升级后，您可以使用命令行<a href="configuring-tls.html">从HTTP切换到HTTPS</a> ，然后随时返回。</p>                </aside>            </li><li class="list__item" id="77ab9268">                <p id="9567d104">完成后，单击“ <span class="control">升级”</span> 。</p>                <p id="fc2b83b3">等待一点，让Upsource启动其组件：</p>                <figure><img alt="upsource_starting" title="upsource_starting" src="/help/img/upsource/2019.1/upsource_starting.png" id="b5a15b37" width="400" height="590"></figure>                <p id="ad9f58a8">完成后，它将打开其欢迎页面。</p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="manage">7。管理您的上游实例</h2>        <div class="chapter"><h3 id="commands">常规命令</h3>            <ul class="list _ul"><li class="list__item" id="388f69d1">                    <p id="3ce84836"><b id="b4c74128">启动上游</b> ： <code class="code">docker start <containerId></code>                    </p>                </li><li class="list__item" id="8d798444">                    <p id="97860b77"><b id="5149f9a6">停止上传</b> ： <code class="code">docker exec <containerId> stop</code>                    </p>                    <p id="ae32dd56">要么： <code class="code">docker stop -t 1800 <containerId></code>                    </p>                    <p id="1bc5379e">为确保正常关闭上游并避免潜在的数据丢失，请在没有必需的超时值的情况下运行此命令。</p>                </li><li class="list__item" id="9bb650b3">                    <p id="c329d9b2"><b id="a7ff5264">列出可用的命令</b> ： <code class="code">docker run -it jetbrains/upsource:<version> help</code>                    </p>                </li></ul>        </div>        <div class="chapter"><h3 id="baseURL">更改基本URL</h3>            <p id="84c8f911">如果您需要<b id="4d3ed562">更改</b>正在运行的Upsource实例<b id="4d3ed562">的基本URL</b> ，请执行以下操作：</p>            <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="4d0149a2">                    <p id="242ae7e3">停止上载： <code class="code">docker exec <containerId> stop</code>                    </p>                </li><li class="list__item" id="99c1db9b">                    <p id="79155332">运行以下命令：</p>                    <div class="code-block" data-lang="bash"><path data="" to="" directory="">docker</path>运行<path data="" to="" directory="">-it</path> -v <path data="" to="" directory="">：/ opt / upsource / data \ -v <path to="" conf="" directory="">：/ opt / upsource / conf \ -v <path to="" logs="" directory="">：/ opt / upsource / logs \ -v <path to="" backups="" directory="">：/ opt / upsource / backups \ -p <port on="" host="">：8080 \ jetbrains / upsource： <version>\ configure --base-url = http：//upsource.mydomain.com：XXXX</version></port></path></path></path></path></div>                    <p id="75abcba9"><b id="9aad97a2">仅Windows</b> ：添加<code class="code">-u root</code>后<code class="code">-p <port on host>:8080 \</code> 。</p>                </li><li class="list__item" id="6154cbff">                    <p id="3a1da0e8">启动上游： <code class="code">docker start <containerId></code>                    </p>                </li></ol></section>            <p id="d3529cf8">运行配置您的安装的容器是一次性的，之后可以安全地将其卸下。 <code class="code">docker rm</code>命令。</p>            <p id="ef3c6662">要查看所有停止的容器，请运行<code class="code">docker ps -a</code>            </p>        </div>        <div class="chapter"><h3 id="recover">恢复已删除的容器</h3>            <p id="f78380bb">如果您已经删除了安装了Upsource的容器，则只需运行与首次启动相同的命令即可：</p>            <div class="code-block" data-lang="bash"><upsource-server-instance><path data="" to="" directory="">docker run -it</path></upsource-server-instance> --name <upsource-server-instance>\ -v <path data="" to="" directory="">：/ opt / upsource / data \ -v <path to="" conf="" directory="">：/ opt / upsource / conf \ -v <path to="" logs="" directory="">：/ opt / upsource / logs \ -v <path to="" backups="" directory="">：/ opt / upsource / backups \ -p <port on="" host="">：8080 \ jetbrains /上游： <version>
    </version></port></path></path></path></path></upsource-server-instance></div>        </div>    </div>    <div class="last-modified" data-skip-index="skip">上次修改时间：2019年8月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="upgrade-with-a-docker-distribution.html">通过Docker发行版</a> <a class="navigation-links__next" href="upgrade-from-docker-to-docker.html">升级从Docker升级到Docker</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>也可以看看</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>操作方法：</h3><ul class="list"><li class="list__item"><a href="tuning-up-a-docker-installation.html">调整Docker安装</a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>