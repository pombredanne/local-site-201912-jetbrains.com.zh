<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><meta charset="UTF-8"><title>Upgrade from ZIP to Docker - Help | Upsource</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="Upgrade_from_ZIP_to_Docker"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search Upsource Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Upsource 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="default" selected>Default (Windows/Linux)</option><option data-group="secondary" value="mac_os_x_10.5_">Default (Mac OS X 10.5+)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Upgrade_from_ZIP_to_Docker" id="Upgrade_from_ZIP_to_Docker.xml">Upgrade from ZIP to Docker</h1>    <p id="4e530154">Follow this instruction to upgrade your existing ZIP installation with a Docker distribution.</p>    <p id="d914a3e0">Before proceeding with the installation:</p>    <ul class="list _ul"><li class="list__item" id="e7b40d19"><p>            Make sure you have the latest version of <a href="https://www.docker.com/" data-external="true" target="_blank" rel="noopener noreferrer">Docker</a> installed on your host            machine.        </p></li><li class="list__item" id="a0a363e9"><p>            If your current Upsource installation is set up to work with a stand-alone (external) <a href="hub.html">            Hub</a>, make sure you have the latest version of Hub installed and <a href="https://www.jetbrains.com/help/hub/upgrading-hub-installation.html" data-external="true" target="_blank" rel="noopener noreferrer">upgrade</a> if necessary.        </p></li></ul>    <div class="chapter"><h2 id="backup">1. Back up your data</h2>        <p id="8e2eb885">            <a href="backup.html">Create a backup</a>            while your existing Upsource installation is running.        </p>    </div>    <div class="chapter"><h2 id="stop">2. Stop Upsource</h2>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="465a4ce6"><p>                Stop Upsource:                <code class="code">&lt;upsource_home&gt;\bin\upsource.sh stop</code>            </p></li><li class="list__item" id="4bb81830">                <p id="6cb3c8eb">                    Use your operating system's tools to make sure that all Java processes launched by Upsource are no                    longer running. (On Windows, you can use <a href="http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx" data-external="true" target="_blank" rel="noopener noreferrer">Process Explorer</a>.)                </p>                <ul class="list _ul"><li class="list__item" id="25825adb"><p>If there are no Upsource-related Java processes outstanding, proceed to the next step.</p></li><li class="list__item" id="90d2f0a9">                        <p id="a3df1ffa">If there are Upsource-related Java processes still running:                        </p>                        <ul class="list _alpha-lower"><li class="list__item" id="31612c1a"><p>                                (Optional, Windows only) Please consider taking thread dumps from those processes using                                the <a href="http://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html" data-external="true" target="_blank" rel="noopener noreferrer">jstack</a> tool (on Windows, it's available under <i id="d61d305a">&lt;upsource_home&gt;/internal/java/windows-amd64/bin</i>)                                and <a href="mailto:upsource-support@jetbrains.com.xml" data-external="true">provide the thread dumps to
                                JetBrains
                            </a> for investigation.                            </p></li><li class="list__item" id="ef6ea1fe"><p>                                Kill the outstanding process trees.                            </p></li></ul>                    </li></ul>            </li></ol></section>    </div>    <div class="chapter"><h2 id="pull-image">3. Pull Upsource image</h2>        <p id="4e2efd30">Pull an image of the latest Upsource version from the Docker Hub Repository:</p>        <code class="code">docker pull jetbrains/upsource:&lt;version&gt;</code>        Where &lt;version&gt; is a full version number of an Upsource build.    </div>    <div class="chapter"><h2 id="prepare-folders">4. Prepare folders</h2>        <ul class="list _alpha-lower"><li class="list__item" id="a5b4022e">                <p id="d71d4f66">Create empty directories on the host machine to store Upsource data, configuration, log, and backup                    files:                </p>                <div class="code-block" data-lang="bash">
                    mkdir -p -m 750 &lt;path to data directory&gt; &lt;path to logs directory&gt; &lt;path to conf
                    directory&gt; &lt;path to backups directory&gt;
    </div>                <p id="a5f9ffa1">These directories will be passed to the Upsource container as volumes.</p>                <p id="d29b40ae">It's recommended that you name the folders correspondingly:</p>                <ul class="list _ul"><li class="list__item" id="482415ec">                        <i id="b5d7ca85">data</i>                    </li><li class="list__item" id="7af37919">                        <i id="00f417ff">config</i>                    </li><li class="list__item" id="c46e2fa7">                        <i id="89fa6819">logs</i>                    </li><li class="list__item" id="318fa921">                        <i id="2c9c2851">backups</i>                    </li></ul>            </li><li class="list__item" id="b118a731">                <p id="cde801cf">(Linux or macOS only) The Upsource service runs inside the Docker container under a non-root account                    13001:13001 (group:id). Give that account read/write permissions to access the directories you've                    created:                </p>                <div class="code-block" data-lang="bash">
                    chown -R 13001:13001 &lt;path to data directory&gt; &lt;path to logs directory&gt; &lt;path to conf
                    directory&gt; &lt;path to backups directory&gt;
    </div>            </li><li class="list__item" id="015552b3"><p>                Locate the last backup you created in Step 1 (it'a date-specific directory inside the <i id="f3cd5fab">backups</i> folder)                and copy it from the old installation to the empty <i id="871998a4">backups</i> folder you've just created for your                new installation.            </p></li></ul>    </div>    <div class="chapter"><h2 id="run">5. Run new Upsource installation</h2>        <p id="398a1d53">Use the following command to run a container with Upsource server and map Upsource data volumes and port:</p>        <div class="code-block" data-lang="bash">
            docker run -it --name &lt;upsource-server-instance&gt; \
            -v &lt;path to data directory&gt;:/opt/upsource/data \
            -v &lt;path to conf directory&gt;:/opt/upsource/conf \
            -v &lt;path to logs directory&gt;:/opt/upsource/logs \
            -v &lt;path to backups directory&gt;:/opt/upsource/backups \
            -p &lt;port on host&gt;:8080 \
            jetbrains/upsource:&lt;version&gt;
    </div>        <p id="28834fa6">Where:</p>        <p id="2868a767">            <code class="code">&lt;upsource-server-instance&gt;</code>            is a name you give to the container.        </p>        <p id="519f9afa">            <code class="code">-v &lt;path to data directory&gt;:/opt/upsource/data</code>            maps the <i id="87495b5b">data</i> directory in the container to the <i id="e90407c5">data</i> directory you've created on the host            machine. The same mapping is set for the other directories: <i id="d4ea007d">conf, logs, backups</i>.        </p>        <p id="e5193575">            <code class="code">-p &lt;port on host&gt;:8080</code>            this port mapping instructs your host machine to listen on &lt;port on host&gt; and propagate all traffic to            port 8080 inside the Docker container.        </p>        <p id="12fadd8d"><b id="23dd0713">Windows only</b>: add <code class="code">-u root</code> after <code class="code">-p &lt;port on host&gt;:8080 \</code>.        </p>        <p id="24f1fc4b">            <code class="code">jetbrains/upsource:&lt;version&gt;</code>            points to the correct image with the Upsource build.        </p>        <p id="02183e50">Upsource service is started on {0.0.0.0:8080} inside the Docker container, and port 8080 is mapped to &lt;port            on host&gt; you've specified. This way the service may be accessed from any machine that has network access            to &lt;port on host&gt; of your host machine. For instance, if FQDN of the host machine is host.mydomain.com            and the &lt;port on host&gt; is 7777, then the service will be available at http://host.mydomain.com:7777        </p>    </div>    <div class="chapter"><h2 id="wizard">6. Follow the wizard</h2>        <p id="025aaf37">On the first run, Upsource service will start with Configuration Wizard at the address mentioned above.</p>        <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="5bd845e4">                <p id="0fe7e16c">On the first page of Configuration Wizard click <span class="control">Upgrade</span>:                </p>                <figure><img alt="upgrade_wizard1" title="upgrade_wizard1" src="/help/img/upsource/2019.1/upgrade_wizard1.png" id="0c97f19b" width="400" height="374"></figure>            </li><li class="list__item" id="f7fc4ea3">                <p id="9e756c4a">Select the location of the last backup of your old installation (a date-specific directory inside the <i id="10a8e3cc">                    backups                </i> folder):                </p>                <figure><img alt="upgrade_wizard2" title="upgrade_wizard2" src="/help/img/upsource/2019.1/upgrade_wizard2.png" id="1a84fa1c" width="400" height="1084"></figure>                <p id="12df8926">Click <span class="control">Next</span>.                </p>            </li><li class="list__item" id="f3c40ef5">                <p id="8cb58f9a">Now you can verify your system settings and location of system directories.                    You can also switch from the HTTP to                    <a href="configuration-wizard.html#http-https">HTTPS mode</a>                    and vice-versa regardless of your previous set-up:                </p>                <figure><img alt="upgrade_wizard4" title="upgrade_wizard4" src="/help/img/upsource/2019.1/upgrade_wizard4.png" id="94052c2f" width="400" height="1380"></figure>                <aside class="note " data-title="" rel="94052c2f" id="b9fbba76">                    <p id="c780448b">You'll be able to <a href="configuring-tls.html">switch from HTTP to HTTPS</a> and back at any                        time after the upgrade using the command line.                    </p>                </aside>            </li><li class="list__item" id="77ab9268">                <p id="9567d104">Click <span class="control">Upgrade</span> when you're done.                </p>                <p id="fc2b83b3">Wait a little for Upsource to launch its components:</p>                <figure><img alt="upsource_starting" title="upsource_starting" src="/help/img/upsource/2019.1/upsource_starting.png" id="b5a15b37" width="400" height="590"></figure>                <p id="ad9f58a8">As soon as it's done, it will open its welcome page.</p>            </li></ol></section>    </div>    <div class="chapter"><h2 id="manage">7. Manage your Upsource instance</h2>        <div class="chapter"><h3 id="commands">Regular commands</h3>            <ul class="list _ul"><li class="list__item" id="388f69d1">                    <p id="3ce84836"><b id="b4c74128">Start Upsource</b>:                        <code class="code">docker start &lt;containerId&gt;</code>                    </p>                </li><li class="list__item" id="8d798444">                    <p id="97860b77"><b id="5149f9a6">Stop Upsource</b>:                        <code class="code">docker exec &lt;containerId&gt; stop</code>                    </p>                    <p id="ae32dd56">or:                        <code class="code">docker stop -t 1800 &lt;containerId&gt;</code>                    </p>                    <p id="1bc5379e">To ensure graceful Upsource shutdown and avoid potential data loss, do not run this command                        without the required timeout value.                    </p>                </li><li class="list__item" id="9bb650b3">                    <p id="c329d9b2"><b id="a7ff5264">List available commands</b>:                        <code class="code">docker run -it jetbrains/upsource:&lt;version&gt; help</code>                    </p>                </li></ul>        </div>        <div class="chapter"><h3 id="baseURL">Changing base URL</h3>            <p id="84c8f911">If you ever need to <b id="4d3ed562">change the base URL</b> for your running Upsource instance, proceed as follows:            </p>            <section class="procedure-steps"><ol class="list _decimal"><li class="list__item" id="4d0149a2">                    <p id="242ae7e3">Stop Upsource:                        <code class="code">docker exec &lt;containerId&gt; stop</code>                    </p>                </li><li class="list__item" id="99c1db9b">                    <p id="79155332">Run the following command:</p>                    <div class="code-block" data-lang="bash">
                        docker run -it
                        -v &lt;path to data directory&gt;:/opt/upsource/data \
                        -v &lt;path to conf directory&gt;:/opt/upsource/conf \
                        -v &lt;path to logs directory&gt;:/opt/upsource/logs \
                        -v &lt;path to backups directory&gt;:/opt/upsource/backups \
                        -p &lt;port on host&gt;:8080 \
                        jetbrains/upsource:&lt;version&gt; \
                        configure --base-url=http://upsource.mydomain.com:XXXX
    </div>                    <p id="75abcba9"><b id="9aad97a2">Windows only</b>: add <code class="code">-u root</code> after <code class="code">-p &lt;port on host&gt;:8080 \</code>.                    </p>                </li><li class="list__item" id="6154cbff">                    <p id="3a1da0e8">Start Upsource:                        <code class="code">docker start &lt;containerId&gt;</code>                    </p>                </li></ol></section>            <p id="d3529cf8">Containers that are run to configure your installation are disposable and can be safely removed                afterwards with the <code class="code">docker rm</code> command.            </p>            <p id="ef3c6662">To see all stopped containers, run                <code class="code">docker ps -a</code>            </p>        </div>        <div class="chapter"><h3 id="recover">Recovering a deleted container</h3>            <p id="f78380bb">If you've deleted a container with Upsource installation, just run the same command you used for the                first start:            </p>            <div class="code-block" data-lang="bash">
                docker run -it --name &lt;upsource-server-instance&gt; \
                -v &lt;path to data directory&gt;:/opt/upsource/data \
                -v &lt;path to conf directory&gt;:/opt/upsource/conf \
                -v &lt;path to logs directory&gt;:/opt/upsource/logs \
                -v &lt;path to backups directory&gt;:/opt/upsource/backups \
                -p &lt;port on host&gt;:8080 \
                jetbrains/upsource:&lt;version&gt;
    </div>        </div>    </div>    <div class="last-modified" data-skip-index="skip">Last modified: 9 August 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="upgrade-with-a-docker-distribution.html">Upgrade with a Docker distribution</a><a class="navigation-links__next" href="upgrade-from-docker-to-docker.html">Upgrade from Docker to Docker</a></div><section class="seealso" data-skip-index="skip"><div class="seealso__header"><h2>See Also</h2></div><div class="seealso__content"><div class="seealso__col" data-skip-index="skip"><h3>How tos:</h3><ul class="list"><li class="list__item"><a href="tuning-up-a-docker-installation.html">Tuning up a Docker installation</a></li></ul></div></div></section></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>