<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta class="swiftype" name="product" data-type="string" content="/dotmemory-unit"><meta charset="UTF-8"><title>复杂场景。交通等级-帮助|点存储单元</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body  data-id="Traffic_Class" data-disqus-id="Traffic_Class_dmu"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper" data-swiftype-index="false"><section class="panel _nav" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><form class="search-box" data-swiftype-index="false"><label class="search-box__label" for="search-box__input" data-swiftype-index="false"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotMemory单元帮助"></label><div class="search-box__clear" title="明确" data-swiftype-index="false"></div></form></div></header><nav class="panel__content" data-swiftype-index="false"><div class="container _nav" data-swiftype-index="false"><menu class="nav-tree" data-swiftype-index="false"></menu></div><div class="container _footer panel__footer" data-swiftype-index="false"><p data-swiftype-index="false"><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><h3>dotMemory Unit 3.0帮助</h3><div class="shortcuts-switcher" data-swiftype-index="false"><label for="switch-shortcuts" data-swiftype-index="false">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1" data-swiftype-index="false"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary" selected>视觉工作室</option></select></div><div class="panel-trigger" data-swiftype-index="false"></div></div></header><section class="panel__content" data-swiftype-index="false"><div class="container"><article class="article" data-shortcut-switcher="false" data-swiftype-index="true"><h1 data-toc="Traffic_Class">复杂场景。交通等级</h1><p id="d2588e2">在dotMemory Unit中，内存流量用<code class="code" data-lang="Java">Traffic</code>类型。的对象<code class="code" data-lang="Java">Traffic</code>类型作为<a href="Working_with_Memory.html#Memory">Memory的结果返回</a><a href="Working_with_Memory.html#Memory">。GetTrafficFrom</a> *方法。</p><aside class="note sideblock" data-title="">        <p id="d2588e16">*如果您使用<a href="Alternative_Way_of_Working_with_Memory.html">其他方法</a>拍摄内存快照，则应使用<code class="code" data-lang="Java">dotMemoryApi.GetTrafficBetween</code>处理内存流量的方法。</p>    </aside><p id="d2588e26">要对流量数据进行切片和切块，您应该使用传递给<code class="code" data-lang="Java">Where</code>的方法<code class="code" data-lang="Java">Traffic</code>类型。的<code class="code" data-lang="Java">Where</code>方法还返回的实例<code class="code" data-lang="Java">Traffic</code>类型允许您建立<code class="code" data-lang="Java">Where</code>方法。</p><p id="d2588e44">的<code class="code" data-lang="Java">Traffic</code> type允许您使用两个属性获取有关已分配和已收集内存的数据： <code class="code" data-lang="Java">AllocatedMemory</code>和<code class="code" data-lang="Java">CollectedMemory</code> 。这些属性又具有<code class="code" data-lang="Java">ObjectsCount</code>和<code class="code" data-lang="Java">SizeInBytes</code>您可以在测试断言中使用的属性。</p><div class="chapter"><h2 id="d2588e62" data-toc="Traffic_Class#d2588e62">例</h2>    <p id="d2588e64">例如，要断言<code class="code" data-lang="Java">bar.Foo()</code>方法分配的对象不超过1000 <code class="code" data-lang="Java">string</code>键入以下内容：</p>    <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="na">[DotMemoryUnit(CollectAllocations=True)]</span> <span class="c1">// collect traffic data</span> <span class="na">[Test]</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">TestMethod1</span><span class="p">()</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">checkPoint1</span> <span class="p">=</span> <span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">();</span> <span class="n">bar</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span> <span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">(</span><span class="n">memory</span> <span class="p">=></span> <span class="p">{</span> <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">checkPoint1</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">traffic</span> <span class="p">=></span> <span class="n">traffic</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="n">Is</span><span class="p"><</span><span class="kt">string</span><span class="p">>())</span> <span class="p">.</span><span class="n">AllocatedMemory</span><span class="p">.</span><span class="n">ObjectsCount</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">LessThan</span><span class="p">(</span><span class="m">1000</span><span class="p">));</span> <span class="p">});</span> <span class="p">}</span></code></div>    <p id="d2588e76">dotMemory Unit还为流量查询提供了其他语法。您可以使用<code class="code" data-lang="Java">==</code> ， <code class="code" data-lang="Java">&</code>和<code class="code" data-lang="Java">|</code>逻辑运算符组合多个查询。例如：</p>    <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">memoryCheckPoint2</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">obj</span> <span class="p">=></span> <span class="n">obj</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="p">|</span> <span class="n">obj</span><span class="p">.</span><span class="n">Interface</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">))</span> <span class="p">.</span><span class="n">AllocatedMemory</span><span class="p">.</span><span class="n">ObjectsCount</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">LessThan</span><span class="p">(</span><span class="m">10</span><span class="p">));</span></code></div>        <p id="d2588e91">使用的另一个好处<code class="code" data-lang="Java">Traffic</code>类是按对象类型对流量进行分组的功能：</p><div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">(</span><span class="n">memory</span> <span class="p">=></span> <span class="p">{</span> <span class="kt">var</span> <span class="n">traffic</span> <span class="p">=</span> <span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">checkPoint1</span><span class="p">);</span> <span class="kt">var</span> <span class="k">group</span> <span class="p">=</span> <span class="n">traffic</span><span class="p">.</span><span class="n">GroupByType</span><span class="p">();</span> <span class="kt">var</span> <span class="n">heavyTrafficTypes</span> <span class="p">=</span> <span class="k">group</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">typeMemoryInfo</span> <span class="p">=></span> <span class="n">typeMemoryInfo</span><span class="p">.</span><span class="n">AllocatedMemoryInfo</span><span class="p">.</span><span class="n">SizeInBytes</span> <span class="p">></span> <span class="m">1000000</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span> <span class="c1">// do sth. with heavyTrafficTypes</span> <span class="p">});</span></code></div>        <p></p>    </div><div class="chapter"><h2 id="d2588e102" data-toc="Traffic_Class#d2588e102">交通等级</h2>    <div class="chapter"><h3 id="d2588e104">交通方式</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d2588e106"><thead><tr id="d2588e107" class="ijRowHead"><th width="40%" id="d2588e108">名称</th><th width="60%" id="d2588e110">描述</th></tr></thead><tbody><tr id="d2588e112" class="ijRowOdd"><td id="d2588e113">                <code class="code" data-lang="Java">Where(Func<TrafficProperty, Query> query): Traffic</code>            </td><td id="d2588e118">通过特定条件获取内存流量数据。条件由<code class="code" data-lang="Java">Query</code>应该由lambda表达式返回。传递给lambda的<a href="#TrafficProperty">TrafficProperty</a>实例允许创建查询，以按对象类型，接口和其他参数过滤流量数据。<br>返回的实例<code class="code" data-lang="Java">Traffic</code>类型。</td></tr><tr id="d2588e131" class="ijRowEven"><td id="d2588e132">                <code class="code" data-lang="Java">Where(TrafficQuery predicate): Traffic</code>            </td><td id="d2588e137">通过特定条件获取内存流量数据。该条件由可重用的查询定义<a href="Creating_Reusable_Queries.html">-TrafficPredicateQuery</a>类型的实例。有关详细信息，请参见<a href="Creating_Reusable_Queries.html">QueryBuilder</a> 。<br>返回的实例<code class="code" data-lang="Java">Traffic</code>类型。</td></tr><tr id="d2588e150" class="ijRowOdd"><td id="d2588e151">                <code class="code" data-lang="Java">GroupByType: IReadOnlyCollection<TypeTrafficInfo></code>            </td><td id="d2588e156">返回<a href="#TypeTrafficInfo">TypeTrafficInfo</a>类型的对象的集合。每个对象代表特定类型的对象的流量，并携带有关该类型已分配和收集的对象的信息。</td></tr></tbody></table></div>    </div>        <div class="chapter"><h3 id="d2588e163">交通属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d2588e165"><thead><tr id="d2588e166" class="ijRowHead"><th width="25%" id="d2588e167">名称</th><th width="15%" id="d2588e169">类型</th><th width="60%" id="d2588e171">描述</th></tr></thead><tbody><tr id="d2588e173" class="ijRowOdd"><td id="d2588e174">                <code class="code" data-lang="Java">AllocatedMemory</code>            </td><td id="d2588e179">                <code class="code" data-lang="Java">MemoryInfo</code>            </td><td id="d2588e184">有关已分配对象的数据：对象计数和总大小。</td></tr><tr id="d2588e186" class="ijRowEven"><td id="d2588e187">                <code class="code" data-lang="Java">CollectedMemory</code>            </td><td id="d2588e192">                <code class="code" data-lang="Java">MemoryInfo</code>            </td><td id="d2588e197">有关收集的对象的数据：对象计数和总大小。</td></tr></tbody></table></div>    </div>    </div><div class="chapter"><h2 id="d2588e202" data-toc="Traffic_Class#d2588e202">MemoryInfo结构</h2>    <p id="d2588e204">的<code class="code" data-lang="Java">MemoryInfo</code> struct用于获取有关对象数量及其大小的数据。</p>    <div class="chapter"><h3 id="MemoryInfo">MemoryInfo属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d2588e212"><thead><tr id="d2588e213" class="ijRowHead"><th width="25%" id="d2588e214">名称</th><th width="15%" id="d2588e216">类型</th><th width="60%" id="d2588e218">描述</th></tr></thead><tbody><tr id="d2588e220" class="ijRowOdd"><td id="d2588e221">                <code class="code" data-lang="Java">ObjectsCount</code>            </td><td id="d2588e226">                <code class="code" data-lang="Java">int</code>            </td><td id="d2588e231">集合中对象的总数。</td></tr><tr id="d2588e233" class="ijRowEven"><td id="d2588e234">                <code class="code" data-lang="Java">SizeInBytes</code>            </td><td id="d2588e239">                <code class="code" data-lang="Java">long</code>            </td><td id="d2588e244">集合中对象的总大小。</td></tr></tbody></table></div>    </div>    </div><div class="chapter"><h2 id="TrafficProperty" data-toc="Traffic_Class#TrafficProperty">TrafficProperty类</h2>    <p id="d2588e251">按特定条件过滤流量：类型，接口和其他。</p>    <div class="chapter"><h3 id="d2588e254">TrafficProperty属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d2588e256"><thead><tr id="d2588e257" class="ijRowHead"><th width="25%" id="d2588e258">名称</th><th width="15%" id="d2588e260">类型</th><th width="60%" id="d2588e262">描述</th></tr></thead><tbody><tr id="d2588e264" class="ijRowOdd"><td id="d2588e265">                <code class="code" data-lang="Java">Type</code>            </td><td id="d2588e270">                    <a href="Working_with_Object_Sets.html#TypeProperty">类型属性</a>            </td><td id="d2588e275">允许按对象类型过滤流量。</td></tr><tr id="d2588e277" class="ijRowEven"><td id="d2588e278">                <code class="code" data-lang="Java">Interface</code>            </td><td id="d2588e283">                    <a href="Working_with_Object_Sets.html#InterfaceProperty">接口属性</a>            </td><td id="d2588e288">允许按接口过滤流量。</td></tr><tr id="d2588e290" class="ijRowOdd"><td id="d2588e291">                <code class="code" data-lang="Java">Namespace</code>            </td><td id="d2588e296">                    <a href="Working_with_Object_Sets.html#NamespaceProperty">命名空间属性</a>            </td><td id="d2588e301">允许按名称空间过滤流量。</td></tr><tr id="d2588e303" class="ijRowEven"><td id="d2588e304">                <code class="code" data-lang="Java">Assembly</code>            </td><td id="d2588e309">                <a href="Working_with_Object_Sets.html#AssemblyProperty">组装属性</a>            </td><td id="d2588e314">允许按程序集过滤流量。</td></tr></tbody></table></div></div>    </div><div class="chapter"><h2 id="TypeTrafficInfo" data-toc="Traffic_Class#TypeTrafficInfo">TypeTrafficInfo类</h2>        <p id="d2588e321">            <code class="code" data-lang="Java">TypeTrafficInfo</code>携带有关相同类型对象的流量的信息：已分配和收集的对象。的实例<code class="code" data-lang="Java">TypeTrafficInfo</code>类别是通过对流量进行分组的结果<code class="code" data-lang="Java">GroupByType()</code>方法。</p>        <div class="chapter"><h3 id="d2588e333">TypeTrafficInfo属性</h3>            <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d2588e335"><thead><tr id="d2588e336" class="ijRowHead"><th width="25%" id="d2588e337">名称</th><th width="15%" id="d2588e339">类型</th><th width="60%" id="d2588e341">描述</th></tr></thead><tbody><tr id="d2588e343" class="ijRowOdd"><td id="d2588e344">                        <code class="code" data-lang="Java">AllocatedMemoryInfo</code>                    </td><td id="d2588e349">                        <code class="code" data-lang="Java">MemoryInfo</code>                    </td><td id="d2588e354">关于分配对象的数据<code class="code" data-lang="Java">Type</code> 。</td></tr><tr id="d2588e359" class="ijRowEven"><td id="d2588e360">                        <code class="code" data-lang="Java">CollectedMemoryInfo</code>                    </td><td id="d2588e365">                        <code class="code" data-lang="Java">MemoryInfo</code>                    </td><td id="d2588e370">关于收集的对象的数据<code class="code" data-lang="Java">Type</code> 。</td></tr><tr id="d2588e375" class="ijRowOdd"><td id="d2588e376">                        <code class="code" data-lang="Java">TypeFullyQualifiedName</code>                    </td><td id="d2588e381">                        <code class="code" data-lang="Java">string</code>                    </td><td id="d2588e386">的全限定名称<code class="code" data-lang="Java">Type</code> 。</td></tr><tr id="d2588e391" class="ijRowEven"><td id="d2588e392">                        <code class="code" data-lang="Java">Type</code>                    </td><td id="d2588e397">                        <code class="code" data-lang="Java">Type</code>                    </td><td id="d2588e402">此实例实例表示的对象类型<code class="code" data-lang="Java">TypeTrafficInfo</code>类。<br>可<code class="code" data-lang="Java">null</code>如果该类型已经由CLR卸载，或者该类型在另一个AppDomain中。</td></tr></tbody></table></div>        </div>    </div><div class="last-modified" data-swiftype-index="false">上次修改时间：2018年1月16日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-swiftype-index="false"><a class="navigation-links__prev" href="AssertTraffic_Attribute.html" data-swiftype-index="false">简单方案。AssertTraffic属性</a> <a class="navigation-links__next" href="Reference_Comparing_Snapshots.html" data-swiftype-index="false">比较快照</a></div></article><div id="disqus_thread" data-swiftype-index="false"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>