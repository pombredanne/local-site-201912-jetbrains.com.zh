<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta class="swiftype" name="product" data-type="string" content="/dotmemory-unit"><meta charset="UTF-8"><title>Checking Memory Traffic - Help | dotMemory Unit</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Checking_Memory_Traffic" data-disqus-id="Checking_Memory_Traffic_dmu"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper" data-swiftype-index="false"><section class="panel _nav" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><form class="search-box" data-swiftype-index="false"><label for="search-box__input" class="search-box__label" data-swiftype-index="false"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotMemory Unit Help"></label><div class="search-box__clear" title="Clear" data-swiftype-index="false"></div></form></div></header><nav class="panel__content" data-swiftype-index="false"><div class="container _nav" data-swiftype-index="false"><menu class="nav-tree" data-swiftype-index="false"></menu></div><div class="container _footer panel__footer" data-swiftype-index="false"><p data-swiftype-index="false"><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><h3>dotMemory Unit 3.0 Help</h3><div class="shortcuts-switcher" data-swiftype-index="false"><label for="switch-shortcuts" data-swiftype-index="false">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1" data-swiftype-index="false"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger" data-swiftype-index="false"></div></div></header><section class="panel__content" data-swiftype-index="false"><div class="container"><article class="article" data-shortcut-switcher="false" data-swiftype-index="true"><h1 data-toc="Checking_Memory_Traffic">Checking Memory Traffic</h1><div class="chapter"><h2 id="d686e2" data-toc="Checking_Memory_Traffic#d686e2">Checking memory traffic</h2>    <aside class="warning sideblock" data-title="">        <p id="d686e6">            To be able to analyze memory traffic, you must turn on the collecting of memory allocation data. The AssertTraffic            attribute does this automatically. In case you use want to analyze traffic between snapshots, you should            add the [DotMemoryUnit(CollectAllocations=true)] attribute before the test.            Learn more in <a href="Turning_On_Off_Collecting_of_Allocation_Data.html"><span>Turning On Collecting of Allocation Data</span></a>        </p>    </aside>    <p id="d686e12">When you need just to evaluate the amount of memory allocated in a test,        you can use the <a href="AssertTraffic_Attribute.html">AssertTraffic</a> attribute.    </p>    <p id="d686e18">        The attribute is quite flexible and allows you to filter traffic data by objects' type, interface,        or namespace.    </p>    <p id="d686e21">        Note that you can add any number of <code class="code" data-lang="Java">AssertTraffic</code> attributes        in case you want to filter memory traffic by a number of conditions.    </p>    <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="na">[AssertTraffic(AllocatedSizeInBytes = 1000, Types = new[]</span> <span class="p">{</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="p">})]</span> <span class="c1">// starts collecting traffic data automatically</span>
<span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestMethod1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span> <span class="c1">// Some user code</span>
<span class="p">}</span></code></div>    </div><div class="chapter"><h2 id="d686e31" data-toc="Checking_Memory_Traffic#d686e31">Filtering memory traffic by complex conditions</h2>    <p id="d686e33">        In more complex scenarios (e.g. when you need to check traffic on a specific time interval), you should        use the <a href="Traffic_Class.html">Traffic</a> type.    </p>    <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="na">[DotMemoryUnit(CollectAllocations=true)]</span> <span class="c1">// collect traffic data</span>
<span class="na">[Test]</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">TestMethod1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">memoryCheckPoint1</span> <span class="p">=</span> <span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">();</span>  <span class="c1">// 1</span>

    <span class="n">foo</span><span class="p">.</span><span class="n">Bar</span><span class="p">();</span>

    <span class="kt">var</span> <span class="n">memoryCheckPoint2</span> <span class="p">=</span> <span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">(</span><span class="n">memory</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// 2</span>
        <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">memoryCheckPoint1</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">obj</span> <span class="p">=&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">Interface</span><span class="p">.</span><span class="n">Is</span><span class="p">&lt;</span><span class="n">IFoo</span><span class="p">&gt;()).</span><span class="n">AllocatedMemory</span><span class="p">.</span><span class="n">SizeInBytes</span><span class="p">,</span>
            <span class="n">Is</span><span class="p">.</span><span class="n">LessThan</span><span class="p">(</span><span class="m">1000</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="n">bar</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span>

    <span class="n">dotMemory</span><span class="p">.</span><span class="n">Check</span><span class="p">(</span><span class="n">memory</span> <span class="p">=&gt;</span>
    <span class="p">{</span>
        <span class="c1">// 3</span>
        <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">memoryCheckPoint2</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">obj</span> <span class="p">=&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">Type</span><span class="p">.</span><span class="n">Is</span><span class="p">&lt;</span><span class="n">Bar</span><span class="p">&gt;()).</span><span class="n">AllocatedMemory</span><span class="p">.</span><span class="n">ObjectsCount</span><span class="p">,</span>
            <span class="n">Is</span><span class="p">.</span><span class="n">LessThan</span><span class="p">(</span><span class="m">10</span><span class="p">));</span>
    <span class="p">});</span>
<span class="p">}</span></code></div>    <ol class="list _decimal"><li class="list__item">            To mark time intervals where memory traffic can be analyzed, you should use checkpoints created by            <a href="Working_with_Memory.html#dotMemory">dotMemory.Check</a> (as you probably guessed, this method simply takes memory snapshot).        </li><li class="list__item">            The checkpoint that defines the starting point of the interval is passed to the            <code class="code" data-lang="Java">GetTrafficFrom</code> method. <br>            For example, this line asserts that the total size of objects implementing the            <code class="code" data-lang="Java">IFoo</code> interface created on the            interval between <code class="code" data-lang="Java">memoryCheckPoint1</code> and            <code class="code" data-lang="Java">memoryCheckPoint2</code> is less than 1000 bytes.        </li><li class="list__item">            You can use any checkpoint created earlier as a base for analysis. Thus, this line gets traffic data between the current            <code class="code" data-lang="Java">dotMemory.Check</code> call and <code class="code" data-lang="Java">memoryCheckPoint2</code>.        </li></ol>    <p id="d686e73">        dotMemory Unit also provides alternative syntax for traffic queries. You can use the <code class="code" data-lang="Java">==</code>, <code class="code" data-lang="Java">&amp;</code>, and <code class="code" data-lang="Java">|</code> logic operators to combine a number of queries. For example:    </p>    <div class="code-block" data-lang="C#"><code class="code-block__wrapper"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">memory</span><span class="p">.</span><span class="n">GetTrafficFrom</span><span class="p">(</span><span class="n">memoryCheckPoint2</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">obj</span> <span class="p">=&gt;</span> <span class="n">obj</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="p">|</span> <span class="n">obj</span><span class="p">.</span><span class="n">Interface</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">))</span>
    <span class="p">.</span><span class="n">AllocatedMemory</span><span class="p">.</span><span class="n">ObjectsCount</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">LessThan</span><span class="p">(</span><span class="m">10</span><span class="p">));</span></code></div></div><div class="last-modified" data-swiftype-index="false">Last modified: 16 January 2018 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-swiftype-index="false"><a class="navigation-links__prev" href="Checking_for_Objects.html" data-swiftype-index="false">Checking for Objects</a><a class="navigation-links__next" href="Turning_On_Off_Collecting_of_Allocation_Data.html" data-swiftype-index="false">Turning On Collecting of Allocation Data</a></div></article><div id="disqus_thread" data-swiftype-index="false"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>