<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta class="swiftype" name="product" data-type="string" content="/dotmemory-unit"><meta charset="UTF-8"><title>使用内存的另一种方法-帮助|帮助点存储单元</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body  data-id="Alternative_Way_of_Working_with_Memory" data-disqus-id="Alternative_Way_of_Working_with_Memory_dmu"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper" data-swiftype-index="false"><section class="panel _nav" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><form class="search-box" data-swiftype-index="false"><label class="search-box__label" for="search-box__input" data-swiftype-index="false"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotMemory单元帮助"></label><div class="search-box__clear" title="明确" data-swiftype-index="false"></div></form></div></header><nav class="panel__content" data-swiftype-index="false"><div class="container _nav" data-swiftype-index="false"><menu class="nav-tree" data-swiftype-index="false"></menu></div><div class="container _footer panel__footer" data-swiftype-index="false"><p data-swiftype-index="false"><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><h3>dotMemory Unit 3.0帮助</h3><div class="shortcuts-switcher" data-swiftype-index="false"><label for="switch-shortcuts" data-swiftype-index="false">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1" data-swiftype-index="false"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary" selected>视觉工作室</option></select></div><div class="panel-trigger" data-swiftype-index="false"></div></div></header><section class="panel__content" data-swiftype-index="false"><div class="container"><article class="article" data-shortcut-switcher="false" data-swiftype-index="true"><h1 data-toc="Alternative_Way_of_Working_with_Memory">使用内存的另一种方法</h1><p id="d16e2">如果由于某种原因不想使用“使用内存”中所述的方法来<a href="Working_with_Memory.html"><span>使用内存</span></a> ，则可以选择另一种方法。我们不会隐藏基于以下内容的框架的“内核”级别<code class="code" data-lang="Java">dotMemoryApi</code>静态类。此类允许您直接使用内存快照，而无需使用lambda。实际上是<a href="Working_with_Memory.html">dotMemory。检查</a>方法是包装<code class="code" data-lang="Java">dotMemoryApi</code>电话。</p><p id="d16e16">您可以使用<code class="code" data-lang="Java">dotMemoryApi</code>类来编写您自己的包装器或直接使用内存快照。</p><p id="d16e22">在后一种情况下，您应牢记以下特点：</p><ul class="list _ul"><li class="list__item">拍摄快照可能是一项耗时的操作。</li><li class="list__item">快照包含在您获取快照的那一刻，而不是在您访问快照的那一刻。</li><li class="list__item">万一测试代码有错误，测试运行程序将无法区分测试是否由于dotMemory Unit调用或其他测试代码而失败。</li><li class="list__item">在所有dotMemory Unit调用之前，应检查是否启用了对dotMemory Unit的支持。</li></ul><p id="d16e35">例如，以下断言</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">(</span><span class="n">memory</span> <span class="o">=></span> <span class="o">{</span> <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">GetObjects</span><span class="o">(</span><span class="n">where</span> <span class="o">=></span> <span class="n">where</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">Is</span><span class="o"><</span><span class="n">Foo</span><span class="o">>()).</span><span class="na">ObjectsCount</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">EqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span> <span class="o">});</span></code></div><p id="d16e42">可以改写成</p><div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="k">if</span> <span class="o">(</span><span class="n">dotMemoryApi</span><span class="o">.</span><span class="na">IsEnabled</span><span class="o">)</span> <span class="o">{</span> <span class="n">var</span> <span class="n">snapshot1</span> <span class="o">=</span> <span class="n">dotMemoryApi</span><span class="o">.</span><span class="na">GetSnapshot</span><span class="o">();</span> <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">snapshot1</span><span class="o">.</span><span class="na">GetObjects</span><span class="o">(</span><span class="n">where</span> <span class="o">=></span> <span class="n">where</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">Is</span><span class="o"><</span><span class="n">Foo</span><span class="o">>()).</span><span class="na">ObjectsCount</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">EqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span> <span class="o">}</span></code></div><div class="chapter"><h2 id="dotMemoryApi" data-toc="Alternative_Way_of_Working_with_Memory#dotMemoryApi">dotMemoryApi静态类</h2>    <div class="chapter"><h3 id="d16e50">dotMemoryApi方法</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d16e52"><thead><tr id="d16e53" class="ijRowHead"><th width="40%" id="d16e54">名称</th><th width="60%" id="d16e56">描述</th></tr></thead><tbody><tr id="d16e58" class="ijRowOdd"><td id="d16e59">                <code class="code" data-lang="Java">GetSnapshot(): Snapshot</code>            </td><td id="d16e64">返回一个<a href="#Snapshot">Snapshot</a>实例，该实例是对当前执行点中的内存数据的引用。使用此引用获取有关内存中对象的数据，将其与另一个快照中的数据进行比较，或获取有关两个快照之间的内存流量的数据。</td></tr><tr id="d16e69" class="ijRowEven"><td id="d16e70">                <code class="code" data-lang="C#">GetDifference(Snapshot snapshot1, Snapshot snapshot2): SnapshotDifference</code>            </td><td id="d16e75">得到之间的区别<code class="code" data-lang="Java">snapshot1</code>和<code class="code" data-lang="Java">snapshot2</code> 。<br>返回<a href="Reference_Comparing_Snapshots.html#SnapshotDifference">SnapshotDifference</a>类型的实例，该实例包含有关在获取快照之间的时间间隔中分配和收集的对象的数据。</td></tr><tr id="d16e88" class="ijRowOdd"><td id="d16e89">                <code class="code" data-lang="C#">GetTrafficBetween(Snapshot snapshot1, Snapshot snapshot2): Traffic</code>            </td><td id="d16e94">在两次获取之间的时间间隔中获取有关内存流量的数据<code class="code" data-lang="Java">snapshot1</code>和<code class="code" data-lang="Java">snapshot2</code> 。<br>返回<a href="Traffic_Class.html">Traffic</a>类型的实例，该实例使您可以获取有关在指定时间间隔内分配和收集的对象的数据。</td></tr><tr id="d16e107" class="ijRowEven"><td id="d16e108">                <code class="code" data-lang="Java">SaveCollectedData(string directoryPath)</code>            </td><td id="d16e113">使用以下命令指定的目录路径保存包含在单元测试运行期间收集的所有内存快照的工作空间<code class="code" data-lang="Java">directoryPath</code> 。这可以是完整路径，也可以是相对于轮廓装配的路径。</td></tr></tbody></table></div>    </div>        <div class="chapter"><h3 id="d16e120">dotMemoryApi属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d16e122"><thead><tr id="d16e123" class="ijRowHead"><th width="25%" id="d16e124">名称</th><th width="15%" id="d16e126">类型</th><th width="60%" id="d16e128">描述</th></tr></thead><tbody><tr id="d16e130" class="ijRowOdd"><td id="d16e131">                <code class="code" data-lang="Java">IsEnabled</code>            </td><td id="d16e136">                <code class="code" data-lang="Java">bool</code>            </td><td id="d16e141">退货<code class="code" data-lang="Java">true</code>如果在dotMemory Unit下运行测试。在调用Assert语句之前，请检查此属性。</td></tr><tr id="d16e146" class="ijRowEven"><td id="d16e147">                <code class="code" data-lang="Java">CollectAllocations</code>            </td><td id="d16e152">                <code class="code" data-lang="Java">bool</code>            </td><td id="d16e157">定义是否必须收集内存分配数据（内存流量和创建堆栈跟踪数据）。调成<code class="code" data-lang="Java">true</code>如果您需要断言的分配数据。请注意，这将大大增加分析开销。</td></tr></tbody></table></div>    </div>    </div><div class="chapter"><h2 id="Snapshot" data-toc="Alternative_Way_of_Working_with_Memory#Snapshot">快照类</h2>    <p id="d16e167">代表某个执行点的内存数据。</p>    <div class="chapter"><h3 id="d16e170">快照方法</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d16e172"><thead><tr id="d16e173" class="ijRowHead"><th width="40%" id="d16e174">名称</th><th width="60%" id="d16e176">描述</th></tr></thead><tbody><tr id="d16e178" class="ijRowOdd"><td id="d16e179">                <code class="code" data-lang="Java">GetObjects(Func<ObjectProperty, Query> query): ObjectSet</code>            </td><td id="d16e184">（继承自<a href="Working_with_Object_Sets.html">ObjectSet</a> ）<br>通过特定条件获取对象的子集。条件定义为<code class="code" data-lang="Java">query</code>以lambda表达式的形式。传递给lambda的<a href="Working_with_Object_Sets.html#ObjectProperty">ObjectProperty</a>对象允许按类型，接口和其他参数选择对象。<br>返回<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a>类型的实例。</td></tr><tr id="d16e203" class="ijRowEven"><td id="d16e204">                <code class="code" data-lang="Java">GroupByType: IReadOnlyCollection<TypeMemoryInfo></code>            </td><td id="d16e209">（继承自<a href="Working_with_Object_Sets.html">ObjectSet</a> ）<br>返回<a href="Working_with_Object_Sets.html#TypeMemoryInfo">TypeMemoryInfo</a>类型的对象的集合。每个对象代表源对象集中的特定类型，并携带有关该类型的对象数量及其总大小的信息。</td></tr></tbody></table></div>    </div>        <div class="chapter"><h3 id="d16e221">快照属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d16e223"><thead><tr id="d16e224" class="ijRowHead"><th width="25%" id="d16e225">名称</th><th width="15%" id="d16e227">类型</th><th width="60%" id="d16e229">描述</th></tr></thead><tbody><tr id="d16e231" class="ijRowOdd"><td id="d16e232">                <code class="code" data-lang="Java">ObjectsCount</code>            </td><td id="d16e237">                <code class="code" data-lang="Java">int</code>            </td><td id="d16e242">（继承自<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a> ）<br>内存中的对象总数。</td></tr><tr id="d16e249" class="ijRowEven"><td id="d16e250">                <code class="code" data-lang="Java">SizeInBytes</code>            </td><td id="d16e255">                <code class="code" data-lang="Java">long</code>            </td><td id="d16e260">（继承自<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a> ）<br>内存中对象的总大小。</td></tr></tbody></table></div></div>    </div><div class="last-modified" data-swiftype-index="false">上次修改时间：2018年1月16日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-swiftype-index="false"><a class="navigation-links__prev" href="Working_with_Memory.html" data-swiftype-index="false">使用内存</a> <a class="navigation-links__next" href="Configuring_dotMemory_Unit.html" data-swiftype-index="false">配置dotMemory单元</a></div></article><div id="disqus_thread" data-swiftype-index="false"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>