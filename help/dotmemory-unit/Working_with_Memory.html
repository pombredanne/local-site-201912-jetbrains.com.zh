<html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta class="swiftype" name="product" data-type="string" content="/dotmemory-unit"><meta charset="UTF-8"><title>处理内存-帮助|帮助点存储单元</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body  data-id="Working_with_Memory" data-disqus-id="Working_with_Memory_dmu"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper" data-swiftype-index="false"><section class="panel _nav" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><form class="search-box" data-swiftype-index="false"><label class="search-box__label" for="search-box__input" data-swiftype-index="false"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索dotMemory单元帮助"></label><div class="search-box__clear" title="明确" data-swiftype-index="false"></div></form></div></header><nav class="panel__content" data-swiftype-index="false"><div class="container _nav" data-swiftype-index="false"><menu class="nav-tree" data-swiftype-index="false"></menu></div><div class="container _footer panel__footer" data-swiftype-index="false"><p data-swiftype-index="false"><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><h3>dotMemory Unit 3.0帮助</h3><div class="shortcuts-switcher" data-swiftype-index="false"><label for="switch-shortcuts" data-swiftype-index="false">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1" data-swiftype-index="false"><option value="rs" data-group="secondary">ReSharper 2.x / IntelliJ IDEA</option><option value="vs" data-group="primary" selected>视觉工作室</option></select></div><div class="panel-trigger" data-swiftype-index="false"></div></div></header><section class="panel__content" data-swiftype-index="false"><div class="container"><article class="article" data-shortcut-switcher="false" data-swiftype-index="true"><h1 data-toc="Working_with_Memory">处理内存</h1><aside class="tip sideblock" data-title="">        <p id="d3367e4">在测试运行期间，垃圾回收器可以收集程序不再需要的对象。要有意阻止对象收集，请使用<code class="code" data-lang="Java">GC.KeepAlive</code>方法。</p>    </aside><p id="d3367e11">要分析内存，首先需要进行内存转储（以dotMemory Unit的形式称为<i id="d3367e13">内存检查点</i>或<i id="d3367e16">快照</i> ）。要获取内存检查点，应使用<code class="code" data-lang="Java">Check</code>静态<a href="#dotMemory">dotMemory</a>类型的方法。因此， <code class="code" data-lang="Java">dotMemory.Check</code>是几乎所有内存测试的重要起点。</p><p id="d3367e29">一种<code class="code" data-lang="Java">MemoryCheckPoint</code>实例返回<code class="code" data-lang="Java">dotMemory.Check</code>可用作与其他检查点进行比较或检查检查点之间的内存通信的基准。请参阅<a href="Reference_Comparing_Snapshots.html"><span>比较快照</span></a>和相应地<a href="Working_with_Traffic.html"><span>使用流量</span></a> 。</p><p id="d3367e42">一个lambda传递给<code class="code" data-lang="Java">dotMemory.Check</code>该方法允许按特定条件对内存进行切片和切块。传递给该lambda的<a href="#Memory">Memory</a>类型的实例包含当前执行点的所有内存数据。用它来获取有关特定对象的数据并过滤交通数据。请参阅<a href="Working_with_Object_Sets.html"><span>使用对象集</span></a>和相应地<a href="Working_with_Traffic.html"><span>使用流量</span></a> 。</p><div class="chapter"><h2 id="d3367e55" data-toc="Working_with_Memory#d3367e55">例</h2>    <p id="d3367e57">例如，在下面的示例中， <code class="code" data-lang="Java">memory</code>的对象<code class="code" data-lang="Java">Memory</code>类型传递给<code class="code" data-lang="Java">dotMemory.Check</code>方法包含当前执行点中的所有内存数据。一个lambda传递给<code class="code" data-lang="Java">memory.GetObjects</code>方法按一定条件返回一组对象（ <code class="code" data-lang="Java">Foo</code>类型）。</p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">(</span><span class="n">memory</span> <span class="o">=></span> <span class="o">{</span> <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">GetObjects</span><span class="o">(</span><span class="n">where</span> <span class="o">=></span> <span class="n">where</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">Is</span><span class="o"><</span><span class="n">Foo</span><span class="o">>()).</span><span class="na">ObjectsCount</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">EqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span> <span class="o">});</span></code></div>    <p id="d3367e78">在下一个示例中，我们在运行用户方法之前创建一个内存检查点<code class="code" data-lang="Java">Foo.Bar()</code> ，然后（在用户方法完成工作之后），我们创建下一个检查点并断言检查点之间的流量未超过1000个字节。</p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="n">var</span> <span class="n">checkPoint1</span> <span class="o">=</span> <span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">();</span> <span class="c1">// create memory checkpoint #1</span> <span class="n">foo</span><span class="o">.</span><span class="na">Bar</span><span class="o">();</span> <span class="c1">// run user method</span> <span class="c1">// Assert that foo.Bar() allocates no more than 1000 bytes</span> <span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">(</span><span class="n">memory</span> <span class="o">=></span> <span class="o">{</span> <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">GetTrafficFrom</span><span class="o">(</span><span class="n">memoryCheckPoint1</span><span class="o">).</span><span class="na">AllocatedMemory</span><span class="o">.</span><span class="na">SizeInBytes</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">LessThanOrEqualTo</span><span class="o">(</span><span class="mi">1000</span><span class="o">));</span> <span class="o">});</span></code></div>    </div><div class="chapter"><h2 id="MemoryCheckPoint" data-toc="Working_with_Memory#MemoryCheckPoint">MemoryCheckPoint结构</h2>    <p id="d3367e91">表示对某个执行点中的内存数据的引用。使用此引用可以比较在不同执行点获取的数据，或获取有关两点之间的内存流量的数据。的实例<code class="code" data-lang="Java">MemoryCheckPoint</code>类型由返回<code class="code" data-lang="Java">dotMemory.Check</code>方法。</p>    </div><div class="chapter"><h2 id="dotMemory" data-toc="Working_with_Memory#dotMemory">dotMemory静态类</h2>    <div class="chapter"><h3 id="d3367e103">dotMemory方法</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d3367e105"><thead><tr id="d3367e106" class="ijRowHead"><th width="40%" id="d3367e107">名称</th><th width="60%" id="d3367e109">描述</th></tr></thead><tbody><tr id="d3367e111" class="ijRowOdd"><td id="d3367e112">                <code class="code" data-lang="Java">Check(): MemoryCheckPoint</code>            </td><td id="d3367e117">返回<a href="#MemoryCheckPoint">MemoryCheckPoint</a>类型的实例，该实例是对当前执行点中的内存数据的引用。使用此参考作为与其他方面获得的内存数据进行比较的基础。</td></tr><tr id="d3367e122" class="ijRowEven"><td id="d3367e123">                <code class="code" data-lang="Java">Check(Action<Memory> check): MemoryCheckPoint</code>            </td><td id="d3367e128">返回对当前执行点中的内存数据的引用，并允许使用Assert语句检查这些数据。的<code class="code" data-lang="Java">check</code>动作是应包含断言的lambda表达式。的<code class="code" data-lang="Java">Memory</code>传递给lambda的实例提供了用于访问内存数据的接口。默认情况下，如果断言失败，则dotMemory Unit将自动保存所有收集的快照的工作空间。使用此工作空间来分析测试失败的原因。<a href="Configuring_dotMemory_Unit.html">了解</a>如何更改默认的自动保存行为。</td></tr></tbody></table></div>    </div>    </div><div class="chapter"><h2 id="Memory" data-toc="Working_with_Memory#Memory">记忆类</h2>    <p id="d3367e144">代表某个执行点的内存数据。对象<code class="code" data-lang="Java">Memory</code>类用于在Assert语句的帮助下访问内存数据。语句以lambda表达式传递到<a href="#dotMemory">dotMemory。检查</a>方法。</p>    <div class="chapter"><h3 id="d3367e153">记忆方式</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d3367e155"><thead><tr id="d3367e156" class="ijRowHead"><th width="40%" id="d3367e157">名称</th><th width="60%" id="d3367e159">描述</th></tr></thead><tbody><tr id="d3367e161" class="ijRowOdd"><td id="d3367e162">                <code class="code" data-lang="Java">GetObjects(Func<ObjectProperty, Query> query): ObjectSet</code>            </td><td id="d3367e167">（继承自<a href="Working_with_Object_Sets.html">ObjectSet</a> ）<br>通过特定条件获取对象的子集。条件定义为<code class="code" data-lang="Java">query</code>以lambda表达式的形式。传递给lambda的<a href="Working_with_Object_Sets.html#ObjectProperty">ObjectProperty</a>对象允许按类型，接口和其他参数选择对象。<br>返回<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a>类型的实例。</td></tr><tr id="d3367e186" class="ijRowEven"><td id="d3367e187">                <code class="code" data-lang="Java">GroupByType: IReadOnlyCollection<TypeMemoryInfo></code>            </td><td id="d3367e192">（继承自<a href="Working_with_Object_Sets.html">ObjectSet</a> ）<br>返回<a href="Working_with_Object_Sets.html#TypeMemoryInfo">TypeMemoryInfo</a>类型的对象的集合。每个对象代表源对象集中的特定类型，并携带有关该类型的对象数量及其总大小的信息。</td></tr><tr id="d3367e202" class="ijRowOdd"><td id="d3367e203">                <code class="code" data-lang="Java">GetDifference(MemoryCheckPoint memoryCheckPoint): SnapshotDifference</code>            </td><td id="d3367e208">获取当前内存检查点与传入的检查点之间的差<code class="code" data-lang="Java">memoryCheckPoint</code>参数。<br>返回<a href="Reference_Comparing_Snapshots.html#SnapshotDifference">SnapshotDifference</a>类型的实例，该实例使您可以获取有关新的，失效的和幸存的对象的数据。</td></tr><tr id="d3367e218" class="ijRowEven"><td id="d3367e219">                <code class="code" data-lang="Java">GetTrafficFrom(MemoryCheckPoint memoryCheckPoint): Traffic</code>            </td><td id="d3367e224">在当前内存快照和传入的快照之间的时间间隔内获取有关内存流量的数据。 <code class="code" data-lang="Java">memoryCheckPoint</code>参数。<br>返回<a href="Traffic_Class.html">Traffic</a>类型的实例，该实例使您可以获取有关在指定时间间隔内分配和收集的对象的数据。</td></tr></tbody></table></div>    </div>        <div class="chapter"><h3 id="d3367e236">记忆体属性</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d3367e238"><thead><tr id="d3367e239" class="ijRowHead"><th width="25%" id="d3367e240">名称</th><th width="15%" id="d3367e242">类型</th><th width="60%" id="d3367e244">描述</th></tr></thead><tbody><tr id="d3367e246" class="ijRowOdd"><td id="d3367e247">                <code class="code" data-lang="Java">ObjectsCount</code>            </td><td id="d3367e252">                <code class="code" data-lang="Java">int</code>            </td><td id="d3367e257">（继承自<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a> ）<br>内存中的对象总数。</td></tr><tr id="d3367e264" class="ijRowEven"><td id="d3367e265">                <code class="code" data-lang="Java">SizeInBytes</code>            </td><td id="d3367e270">                <code class="code" data-lang="Java">long</code>            </td><td id="d3367e275">（继承自<a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a> ）<br>内存中对象的总大小。</td></tr></tbody></table></div></div>    </div><div class="last-modified" data-swiftype-index="false">上次修改时间：2018年1月16日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-swiftype-index="false"><a class="navigation-links__next" href="Alternative_Way_of_Working_with_Memory.html" data-swiftype-index="false">使用内存的</a> <a class="navigation-links__prev" href="Reference.html" data-swiftype-index="false">参考</a> <a class="navigation-links__next" href="Alternative_Way_of_Working_with_Memory.html" data-swiftype-index="false">替代方法</a></div></article><div id="disqus_thread" data-swiftype-index="false"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>