<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/help/app/v2/analytics.js"></script><meta class="swiftype" name="product" data-type="string" content="/dotmemory-unit"><meta charset="UTF-8"><title>Working with Memory - Help | dotMemory Unit</title><link rel="stylesheet" href="/help/app/v2/app.css"></head><body data-id="Working_with_Memory" data-disqus-id="Working_with_Memory_dmu"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper" data-swiftype-index="false"><section class="panel _nav" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><form class="search-box" data-swiftype-index="false"><label for="search-box__input" class="search-box__label" data-swiftype-index="false"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search dotMemory Unit Help"></label><div class="search-box__clear" title="Clear" data-swiftype-index="false"></div></form></div></header><nav class="panel__content" data-swiftype-index="false"><div class="container _nav" data-swiftype-index="false"><menu class="nav-tree" data-swiftype-index="false"></menu></div><div class="container _footer panel__footer" data-swiftype-index="false"><p data-swiftype-index="false"><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main" data-swiftype-index="false"><header class="panel__header" data-swiftype-index="false"><div class="container" data-swiftype-index="false"><h3>dotMemory Unit 3.0 Help</h3><div class="shortcuts-switcher" data-swiftype-index="false"><label for="switch-shortcuts" data-swiftype-index="false">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1" data-swiftype-index="false"><option data-group="secondary" value="rs">ReSharper 2.x/IntelliJ IDEA</option><option data-group="primary" value="vs" selected>Visual Studio</option></select></div><div class="panel-trigger" data-swiftype-index="false"></div></div></header><section class="panel__content" data-swiftype-index="false"><div class="container"><article class="article" data-shortcut-switcher="false" data-swiftype-index="true"><h1 data-toc="Working_with_Memory">Working with Memory</h1><aside class="tip sideblock" data-title="">        <p id="d3367e4">The objects that are no longer needed by a program may be collected by garbage collector during a test run.            To intentionally prevent an object from collection, use the <code class="code" data-lang="Java">GC.KeepAlive</code> method.        </p>    </aside><p id="d3367e11">        To analyze memory, first you need to take a memory dump (in terms of dotMemory Unit, called        <i id="d3367e13">memory checkpoint</i> or <i id="d3367e16">snapshot</i>).        To take memory checkpoints, you should use the        <code class="code" data-lang="Java">Check</code> method of the static        <a href="#dotMemory">dotMemory</a> type. Therefore,        the <code class="code" data-lang="Java">dotMemory.Check</code> is an essential starting point for almost any memory test.    </p><p id="d3367e29">        A <code class="code" data-lang="Java">MemoryCheckPoint</code> instance returned by        <code class="code" data-lang="Java">dotMemory.Check</code> can be used as a baseline for comparison with other        checkpoints, or for checking memory traffic between checkpoints. See <a href="Reference_Comparing_Snapshots.html"><span>Comparing Snapshots</span></a>        and <a href="Working_with_Traffic.html"><span>Working with Traffic</span></a> correspondingly.    </p><p id="d3367e42">        A lambda passed to the <code class="code" data-lang="Java">dotMemory.Check</code> method allows slicing and dicing memory by specific conditions. An instance        of the <a href="#Memory">Memory</a> type passed to that lambda contains all memory data at the current execution point. Use it to get        data about specific objects and filter traffic data. See <a href="Working_with_Object_Sets.html"><span>Working with Object Sets</span></a> and        <a href="Working_with_Traffic.html"><span>Working with Traffic</span></a> correspondingly.    </p><div class="chapter"><h2 id="d3367e55" data-toc="Working_with_Memory#d3367e55">Example</h2>    <p id="d3367e57">        For instance, in the example below, the <code class="code" data-lang="Java">memory</code> object of the        <code class="code" data-lang="Java">Memory</code> type passed to the <code class="code" data-lang="Java">dotMemory.Check</code> method        contains all memory data in the current execution point. A lambda passed to the        <code class="code" data-lang="Java">memory.GetObjects</code> method returns a set of objects by a certain condition (all objects of the        <code class="code" data-lang="Java">Foo</code> type).    </p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">(</span><span class="n">memory</span> <span class="o">=&gt;</span>
<span class="o">{</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">GetObjects</span><span class="o">(</span><span class="n">where</span> <span class="o">=&gt;</span> <span class="n">where</span><span class="o">.</span><span class="na">Type</span><span class="o">.</span><span class="na">Is</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;()).</span><span class="na">ObjectsCount</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">EqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="o">});</span></code></div>    <p id="d3367e78">        In the next example, we create a memory checkpoint before running the user method        <code class="code" data-lang="Java">Foo.Bar()</code>, then (after the user method finishes working) we create the next        checkpoint and assert that traffic between checkpoints haven't exceeded 1000 bytes.    </p>    <div class="code-block" data-lang="Java"><code class="code-block__wrapper"><span class="n">var</span> <span class="n">checkPoint1</span> <span class="o">=</span> <span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">();</span> <span class="c1">// create memory checkpoint #1</span>

<span class="n">foo</span><span class="o">.</span><span class="na">Bar</span><span class="o">();</span>  <span class="c1">// run user method</span>

<span class="c1">// Assert that foo.Bar() allocates no more than 1000 bytes</span>
<span class="n">dotMemory</span><span class="o">.</span><span class="na">Check</span><span class="o">(</span><span class="n">memory</span> <span class="o">=&gt;</span>
<span class="o">{</span>
      <span class="n">Assert</span><span class="o">.</span><span class="na">That</span><span class="o">(</span><span class="n">memory</span><span class="o">.</span><span class="na">GetTrafficFrom</span><span class="o">(</span><span class="n">memoryCheckPoint1</span><span class="o">).</span><span class="na">AllocatedMemory</span><span class="o">.</span><span class="na">SizeInBytes</span><span class="o">,</span> <span class="n">Is</span><span class="o">.</span><span class="na">LessThanOrEqualTo</span><span class="o">(</span><span class="mi">1000</span><span class="o">));</span>
<span class="o">});</span></code></div>    </div><div class="chapter"><h2 id="MemoryCheckPoint" data-toc="Working_with_Memory#MemoryCheckPoint">MemoryCheckPoint struct</h2>    <p id="d3367e91">        Represents a reference to memory data in some execution point.        Use this reference to compare data taken in different execution points or        get data about memory traffic between two points. An instance of the <code class="code" data-lang="Java">MemoryCheckPoint</code> type is returned        by the <code class="code" data-lang="Java">dotMemory.Check</code> method.    </p>    </div><div class="chapter"><h2 id="dotMemory" data-toc="Working_with_Memory#dotMemory">dotMemory static class</h2>    <div class="chapter"><h3 id="d3367e103">dotMemory Methods</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d3367e105"><thead><tr id="d3367e106" class="ijRowHead"><th width="40%" id="d3367e107">Name</th><th width="60%" id="d3367e109">Description</th></tr></thead><tbody><tr id="d3367e111" class="ijRowOdd"><td id="d3367e112">                <code class="code" data-lang="Java">Check(): MemoryCheckPoint</code>            </td><td id="d3367e117">                Returns an instance of the <a href="#MemoryCheckPoint">MemoryCheckPoint</a>                type which is a reference to memory data in the current execution point.                Use this reference as a base for comparison with memory data taken in other points.            </td></tr><tr id="d3367e122" class="ijRowEven"><td id="d3367e123">                <code class="code" data-lang="Java">Check(Action&lt;Memory&gt; check): MemoryCheckPoint</code>            </td><td id="d3367e128">                Returns a reference to memory data in the current execution point and allows checking these data using Assert statements.                The <code class="code" data-lang="Java">check</code> Action is a lambda expression that should contain the assertions.                The <code class="code" data-lang="Java">Memory</code> instance passed to the lambda provides an interface for accessing the memory data.                By default, if an assertion fails, dotMemory Unit will auto-save                the workspace with all collected snapshots. Use this workspace to analyze why the test fails.                <a href="Configuring_dotMemory_Unit.html">Learn</a> how to change the default auto-save behavior.            </td></tr></tbody></table></div>    </div>    </div><div class="chapter"><h2 id="Memory" data-toc="Working_with_Memory#Memory">Memory class</h2>    <p id="d3367e144">        Represents memory data in some execution point. Object of the        <code class="code" data-lang="Java">Memory</code> class is used to access memory data with the help of Assert statements. The statements are passed        in a lambda expression to the <a href="#dotMemory">dotMemory.Check</a> method.    </p>    <div class="chapter"><h3 id="d3367e153">Memory methods</h3>    <div class="table-wrapper"><table class="                  _layout-fixed" width="100%" id="d3367e155"><thead><tr id="d3367e156" class="ijRowHead"><th width="40%" id="d3367e157">Name</th><th width="60%" id="d3367e159">Description</th></tr></thead><tbody><tr id="d3367e161" class="ijRowOdd"><td id="d3367e162">                <code class="code" data-lang="Java">GetObjects(Func&lt;ObjectProperty, Query&gt; query): ObjectSet</code>            </td><td id="d3367e167">                (Inherited from <a href="Working_with_Object_Sets.html">ObjectSet</a>) <br>                Gets a subset of objects by a specific condition. The condition is defined by                <code class="code" data-lang="Java">query</code> in the form of a lambda expression. The                <a href="Working_with_Object_Sets.html#ObjectProperty">ObjectProperty</a> object                passed to the lambda allows selecting objects by type, interface, and other parameters. <br>                Returns an instance of the <a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a> type.        </td></tr><tr id="d3367e186" class="ijRowEven"><td id="d3367e187">                <code class="code" data-lang="Java">GroupByType: IReadOnlyCollection&lt;TypeMemoryInfo&gt;</code>            </td><td id="d3367e192">                (Inherited from <a href="Working_with_Object_Sets.html">ObjectSet</a>) <br>                Returns a collection of objects of the                <a href="Working_with_Object_Sets.html#TypeMemoryInfo">TypeMemoryInfo</a> type.                Each object represents a particular type from the                source object set and carries info about the number of objects of that type and their total size.            </td></tr><tr id="d3367e202" class="ijRowOdd"><td id="d3367e203">                <code class="code" data-lang="Java">GetDifference(MemoryCheckPoint memoryCheckPoint): SnapshotDifference</code>            </td><td id="d3367e208">                Gets difference between the current memory checkpoint and the checkpoint passed in the <code class="code" data-lang="Java">memoryCheckPoint</code>                parameter. <br>                Returns an instance of the <a href="Reference_Comparing_Snapshots.html#SnapshotDifference">SnapshotDifference</a>                type that allows you to get data about new, dead, and survived objects.        </td></tr><tr id="d3367e218" class="ijRowEven"><td id="d3367e219">                <code class="code" data-lang="Java">GetTrafficFrom(MemoryCheckPoint memoryCheckPoint): Traffic</code>            </td><td id="d3367e224">                Gets data about memory traffic in the time interval between the current memory snapshot and the snapshot                passed in the <code class="code" data-lang="Java">memoryCheckPoint</code> parameter. <br>                Returns an instance of the <a href="Traffic_Class.html">Traffic</a>                type that allows you to get data about objects that were allocated                and collected during the specified time interval.        </td></tr></tbody></table></div>    </div>        <div class="chapter"><h3 id="d3367e236">Memory properties</h3>    <div class="table-wrapper"><table class=" wide                  _layout-fixed" width="100%" id="d3367e238"><thead><tr id="d3367e239" class="ijRowHead"><th width="25%" id="d3367e240">Name</th><th width="15%" id="d3367e242">Type</th><th width="60%" id="d3367e244">Description</th></tr></thead><tbody><tr id="d3367e246" class="ijRowOdd"><td id="d3367e247">                <code class="code" data-lang="Java">ObjectsCount</code>            </td><td id="d3367e252">                <code class="code" data-lang="Java">int</code>            </td><td id="d3367e257">                (Inherited from <a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a>) <br>                Total number of objects in memory.            </td></tr><tr id="d3367e264" class="ijRowEven"><td id="d3367e265">                <code class="code" data-lang="Java">SizeInBytes</code>            </td><td id="d3367e270">                <code class="code" data-lang="Java">long</code>            </td><td id="d3367e275">                (Inherited from <a href="Working_with_Object_Sets.html#ObjectSet">ObjectSet</a>) <br>                Total size of objects in memory.            </td></tr></tbody></table></div></div>    </div><div class="last-modified" data-swiftype-index="false">Last modified: 16 January 2018 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-swiftype-index="false"><a class="navigation-links__prev" href="Reference.html" data-swiftype-index="false">Reference</a><a class="navigation-links__next" href="Alternative_Way_of_Working_with_Memory.html" data-swiftype-index="false">Alternative Way of Working with Memory</a></div></article><div id="disqus_thread" data-swiftype-index="false"></div></div></section></main></div><script src="/help/app/v2/app.js"></script></body></html>