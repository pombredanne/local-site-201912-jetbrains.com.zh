<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>通过SSH隧道进行远程调试-帮助|帮助暴风雨</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Remote_debugging_via_SSH_tunnel" data-breadcrumbs="Debugging_with_PhpStorm_Ultimate_Guide.xml|Debugging with PhpStorm: Ultimate Guide/PHP_Debugging_Session.xml|PHP Debugging Session/Remote_debugging_via_SSH_tunnel.xml|Remote debugging via SSH tunnel" data-main-title="Remote debugging via SSH tunnel"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索PhpStorm帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PhpStorm 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_default_for_macos" data-group="primary">macOS的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_macos" data-group="primary">Eclipse（macOS）</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_sublime_text_macos" data-group="primary">崇高文字（macOS）</option><option value="secondary_default_for_windows" data-group="secondary">Windows的默认设置</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="Remote_debugging_via_SSH_tunnel.xml" data-toc="Remote_debugging_via_SSH_tunnel">通过SSH隧道进行远程调试</h1>    <p id="f29bdaa0">在本教程中，我们将看到如何使用SSH隧道在开发机器和远程服务器之间建立安全连接。当它们之间有防火墙，或者NAT路由器阻止直接连接，或者ISP或网络基础结构不允许传入的TCP连接到开发人员计算机时，这对于调试远程计算机上的代码很有用。</p>    <div class="chapter"><h2 id="fea97116" data-toc="Remote_debugging_via_SSH_tunnel#fea97116">准备调试引擎</h2>        <a name="configure_debugging_engine_prerequisites"></a>        <p id="0eb07737">在开始调试之前，请确保已正确安装和配置了调试引擎。PhpStorm支持使用两种最受欢迎的工具进行<a href="http://www.zend.com/en/products/studio/downloads" rel="noopener noreferrer" data-external="true" target="_blank">调试</a> ： <a href="http://xdebug.org/download.php" rel="noopener noreferrer" data-external="true" target="_blank">Xdebug</a>和<a href="http://www.zend.com/en/products/studio/downloads" rel="noopener noreferrer" data-external="true" target="_blank">Zend Debugger</a> 。这些工具相互阻塞，因此无法同时使用。为避免此问题，您需要按照<a href="configuring-xdebug.html">配置Xdebug</a>和<a href="configuring-zend-debugger.html">配置Zend Debugger中的</a>描述更新<span class="filepath">php.ini</span>文件中的相应部分。</p>        <p id="890eafaa">要在编辑器中打开活动的<span class="filepath">php.ini</span>文件：</p>            <a name="ps_openActivePhpIni"></a>        <ol class="list _decimal"><li class="list__item" id="32d93e6e">                <p id="43954741"><a name="open_settings"></a>在里面<a name="settings_dialog"></a> <span class="control">设置/首选项</span>对话框<kbd data-primary_default_for_windows="Ctrl+Alt+S" data-primary_default_for_macos="⌘+Comma" data-primary_intellij_idea_classic_macos="⌘+Comma" data-primary_emacs="Ctrl+Alt+S" data-primary_visual_studio="Alt+F7" data-primary_default_for_xwin="Ctrl+Alt+S" data-primary_default_for_gnome="Ctrl+Alt+S" data-primary_default_for_kde="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-primary_eclipse_macos="⌘+Comma" data-primary_netbeans="Ctrl+Alt+S" data-primary_sublime_text="Ctrl+Alt+S" data-primary_sublime_text_macos="⌘+Comma" data-secondary_default_for_windows="⌃⌥S" data-secondary_default_for_macos="⌘," data-secondary_intellij_idea_classic="⌘," data-secondary_emacs="⌃⌥S" data-secondary_visual_studio="⌥F7" data-secondary_default_for_xwin="⌃⌥S" data-secondary_default_for_gnome="⌃⌥S" data-secondary_default_for_kde="⌃⌥S" data-secondary_eclipse="⌃⌥S" data-secondary_eclipse_macos="⌘," data-secondary_netbeans="⌃⌥S" data-secondary_sublime_text="⌃⌥S" data-secondary_sublime_text_macos="⌘,">Ctrl+Alt+S</kbd> ，在“ <span class="control">语言和框架”</span>下单击“ <span class="control">PHP</span> <span class="control">”</span> 。</p>            </li><li class="list__item" id="3b242cf9"><p>在打开的<a href="php.html">PHP</a>页面上，单击<img class="inline-icon-9" src="/help/img/idea/2019.3/icons.general.ellipsis@2x.png" width="9" alt="浏览按钮"> <span class="control">CLI解释器</span>字段旁边。</p></li><li class="list__item" id="5e2d1979"><p>在打开的“ <span class="control">CLI解释器”</span>对话框中，“ <span class="control">配置文件”</span>只读字段显示活动<span class="filepath">php.ini</span>文件的路径。单击“ <span class="control">在编辑器中打开”</span> 。</p></li></ol>                    <p id="065f511b">使用Xdebug时，请确保至少指定以下设置：</p>        <div class="code-block" data-lang="none">[xdebug] zend_extension = xdebug_module_goes_here xdebug.remote_enable = 1 xdebug.remote_host = 127.0.0.1 xdebug.remote_port = 9000</div>        <div class="chapter"><h3 id="b48de803">侦听传入的调试器连接</h3>            <p id="1d56b77f">                <a name="enable_listening_debug_connections"></a>在PhpStorm中，通过单击以下任一方法来侦听传入的调试连接<img class="inline-icon-16" src="/help/img/idea/2019.3/php.icons.debug_listen_off@2x.png" width="16" alt="“开始侦听PHP调试连接”按钮">在工具栏上，或选择<span class="menupath" data-skip-index="skip">运行|</span>在主菜单中<span class="menupath" data-skip-index="skip">开始侦听PHP调试连接</span> 。这将确保PhpStorm在启动调试会话时做出反应，并自动打开“ <a href="debug-tool-window.html">调试工具”窗口</a> 。启动脚本之前，请确保在<span class="control">“设置/首选项”</span>对话框的<span class="control">“</span> <a href="debug.html">调试”</a>页面上<span class="control">设置</span>了<a href="using-breakpoints.html">断点</a>或启用了“ <span class="control">PHP脚本中的第一行中断</span> <span class="control">”选项。</span> <kbd data-primary_default_for_windows="Ctrl+Alt+S" data-primary_default_for_macos="⌘+Comma" data-primary_intellij_idea_classic_macos="⌘+Comma" data-primary_emacs="Ctrl+Alt+S" data-primary_visual_studio="Alt+F7" data-primary_default_for_xwin="Ctrl+Alt+S" data-primary_default_for_gnome="Ctrl+Alt+S" data-primary_default_for_kde="Ctrl+Alt+S" data-primary_eclipse="Ctrl+Alt+S" data-primary_eclipse_macos="⌘+Comma" data-primary_netbeans="Ctrl+Alt+S" data-primary_sublime_text="Ctrl+Alt+S" data-primary_sublime_text_macos="⌘+Comma" data-secondary_default_for_windows="⌃⌥S" data-secondary_default_for_macos="⌘," data-secondary_intellij_idea_classic="⌘," data-secondary_emacs="⌃⌥S" data-secondary_visual_studio="⌥F7" data-secondary_default_for_xwin="⌃⌥S" data-secondary_default_for_gnome="⌃⌥S" data-secondary_default_for_kde="⌃⌥S" data-secondary_eclipse="⌃⌥S" data-secondary_eclipse_macos="⌘," data-secondary_netbeans="⌃⌥S" data-secondary_sublime_text="⌃⌥S" data-secondary_sublime_text_macos="⌘,">Ctrl+Alt+S</kbd> 。</p>        </div>    </div>    <div class="chapter"><h2 id="b0c621a8" data-toc="Remote_debugging_via_SSH_tunnel#b0c621a8">设置到远程计算机的SSH隧道</h2>        <p id="66af79a8">我们要做的是通过SSH连接到远程计算机，并为端口<span class="filepath">9000</span> （对于Xdebug）或端口<span class="filepath">10137</span> （Zend Debugger）设置端口转发。这个想法是在远程服务器上创建一个“虚拟” TCP端口，将其流量发送到我们自己计算机上的TCP端口，从而通过SSH传输流量。</p>        <figure><img alt="SSH隧道解释" title="SSH隧道解释" src="/help/img/idea/2019.3/ssh-tunnel-explained.png" id="46dc2fbc" width="355" height="148"></figure>        <p id="899a0c04">SSH隧道用于通过防火墙进行连接，并在远程服务器和开发人员计算机之间建立安全连接。当远程服务器可以直接连接到开发人员计算机时（例如，使用<a href="vagrant-support.html">Vagrant</a>计算机），则可能不需要SSH隧道。</p>        <p id="c7cf7062">在这种情况下，我们需要通过设置将调试器连接回开发人员计算机<code class="code">xdebug.remote_host=ip_address_goes_here</code> （对于Xdebug）或确保调试主机是开发人员计算机的IP地址（对于Zend Debugger）。可以使用<a href="/phpstorm/marklets/" rel="noopener noreferrer" data-external="true" target="_blank">PhpStorm书签</a> ， <a href="browser-debugging-extensions.html">浏览器调试扩展</a>或<a href="debugging-a-php-cli-script.html">使用PhpStorm调试PHP CLI脚本中</a>概述的技术来完成此操作。</p>        <p id="e8f50a30">设置过程取决于所使用的操作系统和调试器。</p>        <section class="procedure-steps"><div class="collapse"><div class="collapse__title"><h3 id="a426153e">在macOS或Linux上设置SSH隧道</h3></div><div class="collapse__content"><ul class="list "><li class="list__item" id="9f80e2df">                <p id="14c1a159">在命令行中运行以下命令：</p>                <div class="tabs" id="877e45f3"><div class="tabs__content" id="9f19a7df" data-title="Xdebug">                        <div class="code-block" data-lang="bash">ssh -R 9000：localhost：9000 username_goes_here @ hostname_goes_here</div>                                </div><div class="tabs__content" id="9a351ea0" data-title="Zend Debugger">                        <div class="code-block" data-lang="bash">ssh -R 10137：localhost：10137 username_goes_here @ hostname_goes_here</div>                    </div></div>            </li></ul></div></div></section>        <section class="procedure-steps"><div class="collapse"><div class="collapse__title"><h3 id="012ecf55">在Windows上设置SSH隧道</h3></div><div class="collapse__content"><ol class="list _decimal"><li class="list__item" id="64f9ee1c"><p>下载并安装<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" rel="noopener noreferrer" data-external="true" target="_blank">Putty</a> 。</p></li><li class="list__item" id="321a54c6">                <p id="2f25bd19">通过提供<span class="emphasis">主机名</span>和<span class="emphasis">端口</span>来配置与远程计算机的<span class="emphasis">连接</span> 。</p>                <figure><img alt="PS腻子1" title="PS腻子1" src="/help/img/idea/2019.3/ps_putty-1.png" id="6f820002" width="500" height="686"></figure>            </li><li class="list__item" id="6e234192">                <p id="bdb52b23">展开<span class="menupath" data-skip-index="skip">连接| SSH |</span>在左侧的“ <span class="menupath" data-skip-index="skip">隧道”</span>节点上添加一个新的转发端口。</p>                <ul class="list _ul"><li class="list__item" id="f4427081"><p>源端口将是<span class="filepath">9000</span> （对于Xdebug）或<span class="filepath">10137</span> （对于Zend Debugger）。</p></li><li class="list__item" id="c927b477"><p>对于目的地，输入<span class="control">localhost：9000</span> （对于Xdebug）或<span class="control">localhost：10137</span> （对于Zend Debugger）。</p></li></ul>                <p id="21d123cd">确保选择“远程”选项，然后单击“ <span class="control">添加”</span> 。</p>                <figure><img alt="PS腻子2" title="PS腻子2" src="/help/img/idea/2019.3/ps_putty-2.png" id="9f17a9b8" width="500" height="686"></figure>                <p id="95f48b46">单击“ <span class="control">打开”</span>以连接到远程服务器并设置SSH隧道。</p>            </li></ol><p id="61a79a37">确保您正在运行命令以创建从开发人员的计算机到服务器的SSH隧道（反之亦然）。</p><p id="778dbf09">重新启动计算机或断开连接后，必须重新建立SSH隧道。</p></div></div></section>    </div>    <div class="chapter"><h2 id="fd00654a" data-toc="Remote_debugging_via_SSH_tunnel#fd00654a">调试</h2>        <p id="f84ea8d6">一旦建立了SSH隧道，我们就可以使用Xdebug或Zend Debugger的<a href="zero-configuration-debugging.html">零配置调试</a>开始调试。启动调试器时，PhpStorm将提示接受传入的连接。</p>        <figure><img alt="ps传入调试器连接" title="ps传入调试器连接" src="/help/img/idea/2019.3/ps_incoming_debugger_connection.png" id="06c8574e" width="580" height="706"></figure>        <p id="9af01fce">接受之后，我们将能够使用<a href="debugging-code.html">Debugging中</a>概述的技术进行<a href="debugging-code.html">调试</a> 。</p>    </div>    <div class="chapter"><h2 id="4ee618ab" data-toc="Remote_debugging_via_SSH_tunnel#4ee618ab">使用远程PHP解释器或通过SSH隧道调试PHP CLI脚本</h2>        <p id="a4d50d67">正确配置<a href="configuring-remote-interpreters.html">远程PHP解释器后</a> ，可以利用远程PHP解释器进行调试来创建运行/调试配置。</p>        <p id="24c45810">SSH隧道启动并运行后，我们还可以<a href="debugging-a-php-cli-script.html">调试PHP CLI脚本</a> 。由于调试器在远程计算机上运行，因此可以使用PHP命令行开关或环境变量（在远程计算机上）启动CLI调试会话。虽然在某些情况下需要从远程服务器端建立调试会话时，此工作流不是正式建议的调试方式，但它在某些情况下可能很有用。</p>    </div>    <div class="chapter"><h2 id="e70d1781" data-toc="Remote_debugging_via_SSH_tunnel#e70d1781">故障排除</h2>        <div class="chapter"><h3 id="32f176bf">调试器从不连接或拒绝连接</h3>        <p id="9396a56a">当调试器从不连接或拒绝连接时，请检查以下内容：</p>        <ul class="list _ul"><li class="list__item" id="6bbfb109"><p>确保将Xdebug配置为连接到127.0.0.1和端口9000。参见＃1。已为示例配置安装和配置了Xdebug或Zend Debugger。</p></li><li class="list__item" id="5ebe2d29"><p>使用Zend Debugger时，请确保已将PhpStorm书签或浏览器调试扩展配置为连接到<span class="filepath">127.0.0.1</span> 。</p></li><li class="list__item" id="13392445"><p>在设置SSH隧道之前，请确保PhpStorm正在侦听传入的调试器连接。</p></li><li class="list__item" id="e27ed0c1"><p>重新启动计算机或断开连接后，必须重新建立SSH隧道。</p></li></ul></div>        <div class="chapter"><h3 id="4883f075">远程文件路径未映射到项目中的任何文件路径</h3>            <p id="7a873c02">在某些情况下，调试器可以连接，但是我们收到错误消息，指示未定义远程文件与项目文件之间的映射。这意味着PhpStorm无法确定哪个本地文件对应于正在调试的文件。</p>            <figure><img alt="ps调试无映射" title="ps调试无映射" src="/help/img/idea/2019.3/ps_debug_no_mapping.png" id="fd74120c" width="776" height="484"></figure>            <p id="2e2e4efe">我们可以通过单击<span class="control">Click来设置路径映射</span>并提供必要的路径映射来解决此问题。</p>            <p id="5bc58c05">另外，我们可以使用<a href="configuring-synchronization-with-a-remote-host.html">配置与Web服务器的同步中</a>概述的技术来配置这些映射。</p>        </div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="debugging-with-php-exception-breakpoints.html">使用PHP异常断点进行</a> <a class="navigation-links__next" href="simultaneous-debugging-sessions.html">调试同时进行调试会话</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>