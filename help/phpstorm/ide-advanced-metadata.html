<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>PhpStorm高级元数据-帮助|帮助暴风雨</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="IDE_advanced_metadata" data-breadcrumbs="Reference/Tuning_the_IDE.xml|Advanced configuration/IDE_advanced_metadata.xml|PhpStorm advanced metadata" data-main-title="PhpStorm advanced metadata"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索PhpStorm帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PhpStorm 2019.3帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option value="primary_default_for_windows" data-group="primary" selected>Windows的默认设置</option><option value="primary_default_for_macos" data-group="primary">macOS的默认设置</option><option value="primary_intellij_idea_classic_macos" data-group="primary">IntelliJ IDEA经典版（macOS）</option><option value="primary_emacs" data-group="primary">埃马克斯</option><option value="primary_visual_studio" data-group="primary">视觉工作室</option><option value="primary_default_for_xwin" data-group="primary">XWin的默认设置</option><option value="primary_default_for_gnome" data-group="primary">GNOME的默认设置</option><option value="primary_default_for_kde" data-group="primary">KDE的默认值</option><option value="primary_eclipse" data-group="primary">日食</option><option value="primary_eclipse_macos" data-group="primary">Eclipse（macOS）</option><option value="primary_netbeans" data-group="primary">NetBeans</option><option value="primary_sublime_text" data-group="primary">崇高文字</option><option value="primary_sublime_text_macos" data-group="primary">崇高文字（macOS）</option><option value="secondary_default_for_windows" data-group="secondary">Windows的默认设置</option><option value="secondary_default_for_macos" data-group="secondary">macOS的默认设置</option><option value="secondary_intellij_idea_classic" data-group="secondary">IntelliJ IDEA经典版</option><option value="secondary_emacs" data-group="secondary">埃马克斯</option><option value="secondary_visual_studio" data-group="secondary">视觉工作室</option><option value="secondary_default_for_xwin" data-group="secondary">XWin的默认设置</option><option value="secondary_default_for_gnome" data-group="secondary">GNOME的默认设置</option><option value="secondary_default_for_kde" data-group="secondary">KDE的默认值</option><option value="secondary_eclipse" data-group="secondary">日食</option><option value="secondary_eclipse_macos" data-group="secondary">Eclipse（macOS）</option><option value="secondary_netbeans" data-group="secondary">NetBeans</option><option value="secondary_sublime_text" data-group="secondary">崇高文字</option><option value="secondary_sublime_text_macos" data-group="secondary">崇高文字（macOS）</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 id="IDE_advanced_metadata.xml" data-toc="IDE_advanced_metadata">PhpStorm高级元数据</h1>    <p id="09640d17">除了内置的“代码感知”功能外，PhpStorm还依赖于外部代码知识，这些知识以<a href="https://blog.jetbrains.com/phpstorm/2018/03/how-to-provide-stubs-for-phpstorm/" rel="noopener noreferrer" data-external="true" target="_blank">PHP存根</a>和特殊的高级元数据文件<span class="filepath">.phpstorm.meta.php的形式出现</span> 。</p>    <p id="68a4406b">存根包含标准PHP库组件和通用扩展，而<span class="filepath">.phpstorm.meta.php</span>可以根据您自己的需求或项目要求来扩展PhpStorm功能。元数据文件作为存根程序包的一部分捆绑在一起，位于<span class="filepath">meta</span>文件夹内。您可以将文件放置在项目中的任何位置，甚至可以创建多个元数据– PhpStorm将从这些数据中收集并合并所有信息。</p>    <div class="chapter"><h2 id="expected-arguments" data-toc="IDE_advanced_metadata#expected-arguments">预期参数</h2>        <p id="0f5a6742">的<code class="code">expectedArguments</code>指令指示PhpStorm某个函数接受某些参数集。通过提供您正在使用的函数，参数的从零开始的索引以及实际的期望值集来指定指令。</p>        <div class="code-block" data-lang="shell">ExpectedArguments（ <functionname>，argumentsIndex，... argumentsList）;</functionname></div>        <p id="d49d4987">添加自己的条目时，请记住以下几点：</p>        <ul class="list _ul"><li class="list__item" id="e3c7b723"><p>您需要提供函数或方法的标准名称，以便PhpStorm正确解析它。</p></li><li class="list__item" id="1b6763b7"><p>您可以通过逗号枚举期望的参数<code class="code">,</code>或管道<code class="code">|</code> <a href="http://php.net/manual/en/language.operators.bitwise.php" rel="noopener noreferrer" data-external="true" target="_blank">按位运算符</a> 。前者用于期望值集中的单个值的函数，而后者用于期望常量的位掩码的函数，例如<a href="http://php.net/manual/en/function.json-encode.php" rel="noopener noreferrer" data-external="true" target="_blank">json_encode</a> 。</p></li></ul>        <div class="chapter"><h3 id="expected-arguments-example">例</h3>            <p id="984d9f20">假设您要基于<a href="https://github.com/symfony/console" rel="noopener noreferrer" data-external="true" target="_blank">symfony / console</a>组件实现控制台命令。有时会有一些您想要传递给命令的参数。在此示例中， <code class="code">Symfony\Component\Console\Command::configure()</code>方法正在实施：</p>            <figure><img alt="设置预期参数之前的代码完成" title="设置预期参数之前的代码完成" src="/help/img/idea/2019.3/ps_symfony-console-before-expected.png" id="b9583a87" width="706" height="470"></figure>            <p id="1d7e6a46">用<code class="code">expectedArguments</code>您可以建议PhpStorm期望<code class="code">InputArgument::*</code>这里的常量。为此， <span class="filepath">将以下行</span>添加到<span class="filepath">.phpstorm.meta.php</span> ：</p>            <div class="code-block" data-lang="php">ExpectedArguments（\ Symfony \ Component \ Console \ Command \ Command :: addArgument（），1，\ Symfony \ Component \ Console \ Input \ InputArgument :: OPTIONAL，\ Symfony \ Component \ Console \ Input \ InputArgument :: REQUIRED，\ Symfony \ Component \ Console \ Input \ InputArgument :: IS_ARRAY）;</div>            <p id="9a14ab48">现在，当您调用代码完成时<kbd data-primary_default_for_windows="Ctrl+Space" data-primary_default_for_macos="Ctrl+Space" data-primary_intellij_idea_classic_macos="Ctrl+Space" data-primary_emacs="Alt+/" data-primary_visual_studio="Ctrl+Space" data-primary_default_for_xwin="Ctrl+Space" data-primary_default_for_gnome="Ctrl+Space" data-primary_default_for_kde="Ctrl+Space" data-primary_eclipse="Ctrl+Space" data-primary_eclipse_macos="Ctrl+Space" data-primary_netbeans="Ctrl+Space" data-primary_sublime_text="Ctrl+Space" data-primary_sublime_text_macos="Ctrl+Space" data-secondary_default_for_windows="⌃Space" data-secondary_default_for_macos="⌃Space" data-secondary_intellij_idea_classic="⌃Space" data-secondary_emacs="⌥/" data-secondary_visual_studio="⌃Space" data-secondary_default_for_xwin="⌃Space" data-secondary_default_for_gnome="⌃Space" data-secondary_default_for_kde="⌃Space" data-secondary_eclipse="⌃Space" data-secondary_eclipse_macos="⌃Space" data-secondary_netbeans="⌃Space" data-secondary_sublime_text="⌃Space" data-secondary_sublime_text_macos="⌃Space">Ctrl+Space</kbd> ，添加的常量将显示在建议列表中：</p>            <figure><img alt="设置预期参数之前的代码完成" title="设置预期参数之前的代码完成" src="/help/img/idea/2019.3/ps_symfony-console-after-expected.png" id="2eaa8bdd" width="706" height="550"></figure>        </div>    </div>    <div class="chapter"><h2 id="arguments-set" data-toc="IDE_advanced_metadata#arguments-set">参数集</h2>        <p id="2f05e116">对于某些函数，可能的参数值列表可能会很大。而且，不同的函数可以接受相同的值集。如果提供此类功能的<a href="#expected-arguments">预期参数</a>列表，则<span class="filepath">.phpstorm.meta.php</span>文件都将变得过大。它还将包含重复数据，并且维护该数据所需的工作量也将增加一倍。</p>        <p id="59585c2b">为了解决这个问题，您可以在<span class="filepath">.phpstorm.meta.php</span>文件中使用两个指令， <code class="code">registerArgumentsSet</code>和<code class="code">argumentsSet</code> 。我们将使用<code class="code">ini_get</code>和<code class="code">ini_set</code>以<a href="http://php.net/manual/en/ini.list.php" rel="noopener noreferrer" data-external="true" target="_blank">php.ini指令</a>为例的函数。</p>        <ul class="list _ul"><li class="list__item" id="217d931d">                <p id="08faa65e">                    <code class="code">registerArgumentsSet</code>接受两个参数：参数集的任意名称以及该参数集中包含的实际值列表。值的指定方式与<a href="#expected-arguments">期望参数</a>列表的指定方式相同：根据所使用的函数或方法，可以通过逗号枚举它们<code class="code">,</code>或管道<code class="code">|</code> <a href="http://php.net/manual/en/language.operators.bitwise.php" rel="noopener noreferrer" data-external="true" target="_blank">按位运算符</a> 。</p>                <p id="0649d3b3">要为上述情况注册一组参数，请指定如下指令：</p>            <div class="code-block" data-lang="php">registerArgumentsSet（'ini_values'，... argumentsList）;</div>            </li><li class="list__item" id="90841f56">                <p id="d349c22d">注册了单个参数集后，您可以从内部引用它<code class="code">expectedArguments</code>通过使用<code class="code">argumentsSet</code>指示：</p>            <div class="code-block" data-lang="php">ExpectedArguments（\ ini_get（），0，argumentsSet（“ ini_values”）））; ExpectedArguments（\ ini_set（），0，argumentsSet（“ ini_values”）））;</div>            </li></ul>    </div>        <div class="chapter"><h2 id="factory-methods" data-toc="IDE_advanced_metadata#factory-methods">工厂方法</h2>        <p id="50839502"><a href="http://en.wikipedia.org/wiki/Factory_method_pattern" rel="noopener noreferrer" data-external="true" target="_blank">工厂设计模式</a>通常用于PHP框架（如Magento，Doctrine，Kohana，ZF2等）。PhpStorm通过<span class="emphasis">高级元数据文件</span>为工厂模式提供通用支持。</p>        <p id="1133614b">假设您具有类似以下“服务”或“帮助程序”提供程序接口/对象的内容。</p>        <div class="code-block" data-lang="php">接口ServiceLocatorInterface {function get（$ name）; //根据参数函数getByPattern（$ name）;调用它来获取帮助器}类ServiceManager实现ServiceLocatorInterface {函数get（$ name）{返回新的$ name; //最简单的测试示例实现}函数getByPattern（$ name）{return new $ name; }} $ serviceManager =（new ServiceManager（））;函数globalFactoryFunction（$ param）{返回新的$ param; }</div>        <p id="cde35179">您可以通过使用其他元数据文件来使以下情况起作用。</p>        <div class="code-block" data-lang="php">//（1）静态工厂调用$ getStatic = ServiceManager :: get（“ special”）; //（2）非静态工厂$ getDynamic = $ serviceManager-> get（“ special”）; //（3）ArrayAccess样式工厂$ getFromArray = $ serviceManager [“ special”]; //类名常量$ getByClassNameConst = $ serviceManager-> get（Exception :: class）; $ getByClassNameConstFromArray = $ serviceManager [“ Exception”]; //“后备”直接指向类名$ getWithFallback = $ serviceManager-> get（“ Exception”）; $ getWithFallbackArray = $ serviceManager [“ Exception”]; //按表达式查找$ byPattern = $ serviceManager-> getByPattern（“ Seekable” / * Iterator * /）; //（4）$ getFromStaticFunction = globalFactoryFunction（“ Exception”）; //这一切都解决了，变成绿色！$ getByClassNameConst-> getCode（）; $ getWithFallback-> getCode（）; $ getByClassNameConstFromArray-> getCode（）; $ getFromArray-> getCode（）; $ getDynamic-> getCode（）; $ byPattern-> seek（1）;类Foo {/ ** * @var ServiceManager ** / protected $ serviceManager;函数test（）{$ worksThroughProperties = $ this-> serviceManager-> get（Exception :: class）; $ worksThroughProperties-> getCode（）; //相同的类}}</div>        <p id="34861c1c">建议将其存储在项目根目录下的<span class="filepath">.meta.php</span>文件中。在PhpStorm 2016.2和更高版本中，您可以将多个单独的文件存储在名为<span class="filepath">.phpstorm.meta.php</span>的文件夹中。</p>        <p id="1f02cc9d">.phpstorm.meta.php \ sample.meta.php</p>        <div class="code-block" data-lang="php">名称空间PHPSTORM_META {//我们想避免污染//这是PhpStorm 2016.2和更高版本的更合理的自记录格式，//尝试使用这些“魔术”函数的QuickDoc，甚至转到定义！overlay（\ ServiceLocatorInterface :: get（0），//方法签名//参数编号现在始终为0。map（[//参数值的映射->返回类型“ special” => \ Exception :: class，//通过:: class常量引用引用的类\ ExampleFactory :: EXAMPLE_B => ExampleB :: class，// FYI，我们现在可以支持类常量参数值\ EXAMPLE_B => \ ExampleB :: class，//以及全局常量//非映射值，例如上面的$ getByClassNameConst情况将自动返回]））; //模式示例。 @替换为参数文字值。重写（\ ServiceLocatorInterface :: getByPattern（0），map（[''=>'@Iterator | \ Iterator'，]））; //基本上与get相同，只是对array [“ arg”]查找进行重写（新\ ServiceLocatorInterface，map（[“ special” => \ Exception :: class，]））; }</div>        <p id="49f14b28">PHP代码用作配置，因此我们可以使用现有的API对其进行分析。选择特定格式还有助于现有的编辑器功能尽可能地提供帮助：代码完成工作，解析引用，用法搜索和重构工作。</p>    </div>    <div class="chapter"><h2 id="more-dynamic-return-type-possibilities" data-toc="IDE_advanced_metadata#more-dynamic-return-type-possibilities">更多动态返回类型的可能性</h2>        <div class="code-block" data-lang="php">//下面是将更多的元表达式捆绑到PhpStorm中以更好地支持标准库的示例。覆盖（\ array_reduce（0），elementType（0））;</div>    </div>    <div class="chapter"><h2 id="packaging-metadata-stub-files-into-plugin" data-toc="IDE_advanced_metadata#packaging-metadata-stub-files-into-plugin">将元数据/存根文件打包到插件中</h2>        <p id="9bc46a5f">现在，您可以通过添加XML描述符并将<span class="filepath">ZIP</span>文件上载到插件存储库中，将它们打包到公共插件中，请参阅<a href="https://github.com/JetBrains/phpstorm-library-plugin" rel="noopener noreferrer" data-external="true" target="_blank">https://github.com/JetBrains/phpstorm-library-plugin上的</a>示例。</p>    </div>    <div class="chapter"><div class="collapse"><div class="collapse__title"><h2 id="legacy-metadata-format-deprecated" data-toc="IDE_advanced_metadata#legacy-metadata-format-deprecated">旧版元数据格式（不建议使用）</h2></div><div class="collapse__content">        <p id="b776116e">PhpStorm版本2016.1和更早版本使用其他元数据格式（现已弃用）。</p>        <div class="code-block" data-lang="php">名称空间PHPSTORM_META {//我们要避免污染// //这是2016.1和EARLIER的旧格式//这个文件不是CODE，没有任何意义，也不会运行或验证//它的AST将IDE作为数据源做出高级类型推断决策。$ STATIC_METHOD_TYPES = [//我们为范围创建了部分\ ServiceLocatorInterface :: get（''）=> [//进行静态（1）和动态（2）调用的STATIC调用键可以正常工作\ Exception，// “ KEY”类的instanceof将KEY映射到类]，new \ ServiceLocatorInterface => [//新实例将使ArrayAccess（3）样式的工厂工作“ special” instanceof \ Exception，]，\ ServiceLocatorInterface :: getByPattern（''）= > [“” ==“ @Iterator”，//“忽略” ==“ PatternWith @”用arg值替换@]，\ globalFactoryFunction（''）=> [//（4）也可用于函数]，/ /如果找不到密钥，则在所有情况下都将其用作类型名称]; }</div>    </div></div></div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年11月29日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="tuning-the-ide.html">高级配置</a> <a class="navigation-links__next" href="ps-code-inspection-index.html">代码检查索引</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>