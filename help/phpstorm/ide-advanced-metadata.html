<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>PhpStorm advanced metadata - Help | PhpStorm</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="IDE_advanced_metadata" data-breadcrumbs="Reference/Tuning_the_IDE.xml|Advanced configuration/IDE_advanced_metadata.xml|PhpStorm advanced metadata" data-main-title="PhpStorm advanced metadata"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search PhpStorm Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>PhpStorm 2019.3 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"><option data-group="primary" value="primary_default_for_windows" selected>Default for Windows</option><option data-group="primary" value="primary_default_for_macos">Default for macOS</option><option data-group="primary" value="primary_intellij_idea_classic_macos">IntelliJ IDEA Classic (macOS)</option><option data-group="primary" value="primary_emacs">Emacs</option><option data-group="primary" value="primary_visual_studio">Visual Studio</option><option data-group="primary" value="primary_default_for_xwin">Default for XWin</option><option data-group="primary" value="primary_default_for_gnome">Default for GNOME</option><option data-group="primary" value="primary_default_for_kde">Default for KDE</option><option data-group="primary" value="primary_eclipse">Eclipse</option><option data-group="primary" value="primary_eclipse_macos">Eclipse (macOS)</option><option data-group="primary" value="primary_netbeans">NetBeans</option><option data-group="primary" value="primary_sublime_text">Sublime Text</option><option data-group="primary" value="primary_sublime_text_macos">Sublime Text (macOS)</option><option data-group="secondary" value="secondary_default_for_windows">Default for Windows</option><option data-group="secondary" value="secondary_default_for_macos">Default for macOS</option><option data-group="secondary" value="secondary_intellij_idea_classic">IntelliJ IDEA Classic</option><option data-group="secondary" value="secondary_emacs">Emacs</option><option data-group="secondary" value="secondary_visual_studio">Visual Studio</option><option data-group="secondary" value="secondary_default_for_xwin">Default for XWin</option><option data-group="secondary" value="secondary_default_for_gnome">Default for GNOME</option><option data-group="secondary" value="secondary_default_for_kde">Default for KDE</option><option data-group="secondary" value="secondary_eclipse">Eclipse</option><option data-group="secondary" value="secondary_eclipse_macos">Eclipse (macOS)</option><option data-group="secondary" value="secondary_netbeans">NetBeans</option><option data-group="secondary" value="secondary_sublime_text">Sublime Text</option><option data-group="secondary" value="secondary_sublime_text_macos">Sublime Text (macOS)</option></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="active"><h1 data-toc="IDE_advanced_metadata" id="IDE_advanced_metadata.xml">PhpStorm advanced metadata</h1>    <p id="09640d17">        Besides built-in “code awareness” capabilities, PhpStorm relies on external knowledge of code, which comes in the form of <a href="https://blog.jetbrains.com/phpstorm/2018/03/how-to-provide-stubs-for-phpstorm/" data-external="true" target="_blank" rel="noopener noreferrer">PHP stubs</a> and the special advanced metadata files <span class="filepath">.phpstorm.meta.php</span>.    </p>    <p id="68a4406b">    While stubs cover the Standard PHP Library components and common extensions, <span class="filepath">.phpstorm.meta.php</span> can be used for extending the PhpStorm functionality, based on your own needs or project requirements. The metadata file is bundled as part of the stubs package and located inside the <span class="filepath">meta</span> folder. You can place the file anywhere within your project, or even create multiple metas – PhpStorm will collect and merge all the information from them.    </p>    <div class="chapter"><h2 id="expected-arguments" data-toc="IDE_advanced_metadata#expected-arguments">Expected arguments</h2>        <p id="0f5a6742">            The <code class="code">expectedArguments</code> directive instructs PhpStorm that a certain function accepts a certain set of arguments. The directive is specified by providing the function you are working with, the zero-based index of the argument, and the actual set of expected values.        </p>        <div class="code-block" data-lang="shell">
            expectedArguments(&lt;functionName&gt;, argumentIndex, ...argumentsList);
    </div>        <p id="d49d4987">When adding your own entries, keep the following in mind:</p>        <ul class="list _ul"><li class="list__item" id="e3c7b723"><p>You need to provide the fully qualified name of the function or method so that PhpStorm resolves it correctly.</p></li><li class="list__item" id="1b6763b7"><p>You can enumerate expected arguments via the comma <code class="code">,</code> or the pipe <code class="code">|</code> <a href="http://php.net/manual/en/language.operators.bitwise.php" data-external="true" target="_blank" rel="noopener noreferrer">bitwise operator</a>. The former is used for functions expecting a single value out of the set of values, while the latter is used for functions expecting a bit mask of constants, such as <a href="http://php.net/manual/en/function.json-encode.php" data-external="true" target="_blank" rel="noopener noreferrer">json_encode</a>.            </p></li></ul>        <div class="chapter"><h3 id="expected-arguments-example">Example</h3>            <p id="984d9f20">                Let’s say you are implementing a Console command based on the <a href="https://github.com/symfony/console" data-external="true" target="_blank" rel="noopener noreferrer">symfony/console</a> component. Sometimes there will be arguments that you want to pass to the command. In this example, a <code class="code">Symfony\Component\Console\Command::configure()</code> method is being implemented:            </p>            <figure><img alt="Code completion before Expected Arguments is set" title="Code completion before Expected Arguments is set" src="/help/img/idea/2019.3/ps_symfony-console-before-expected.png" id="b9583a87" width="706" height="470"></figure>            <p id="1d7e6a46">                With <code class="code">expectedArguments</code> in place, you can advise PhpStorm to expect the <code class="code">InputArgument::*</code> constants here. To do this, add the following line to <span class="filepath">.phpstorm.meta.php</span>:            </p>            <div class="code-block" data-lang="php">
                expectedArguments(
                        \Symfony\Component\Console\Command\Command::addArgument(),
                        1,
                        \Symfony\Component\Console\Input\InputArgument::OPTIONAL,
                        \Symfony\Component\Console\Input\InputArgument::REQUIRED,
                        \Symfony\Component\Console\Input\InputArgument::IS_ARRAY
                );
            </div>            <p id="9a14ab48">Now, when you invoke code completion <kbd data-primary_default_for_windows="Ctrl+Space" data-primary_default_for_macos="Ctrl+Space" data-primary_intellij_idea_classic_macos="Ctrl+Space" data-primary_emacs="Alt+/" data-primary_visual_studio="Ctrl+Space" data-primary_default_for_xwin="Ctrl+Space" data-primary_default_for_gnome="Ctrl+Space" data-primary_default_for_kde="Ctrl+Space" data-primary_eclipse="Ctrl+Space" data-primary_eclipse_macos="Ctrl+Space" data-primary_netbeans="Ctrl+Space" data-primary_sublime_text="Ctrl+Space" data-primary_sublime_text_macos="Ctrl+Space" data-secondary_default_for_windows="⌃Space" data-secondary_default_for_macos="⌃Space" data-secondary_intellij_idea_classic="⌃Space" data-secondary_emacs="⌥/" data-secondary_visual_studio="⌃Space" data-secondary_default_for_xwin="⌃Space" data-secondary_default_for_gnome="⌃Space" data-secondary_default_for_kde="⌃Space" data-secondary_eclipse="⌃Space" data-secondary_eclipse_macos="⌃Space" data-secondary_netbeans="⌃Space" data-secondary_sublime_text="⌃Space" data-secondary_sublime_text_macos="⌃Space">Ctrl+Space</kbd>, the added constants are displayed in the suggestions list:</p>            <figure><img alt="Code completion before Expected Arguments is set" title="Code completion before Expected Arguments is set" src="/help/img/idea/2019.3/ps_symfony-console-after-expected.png" id="2eaa8bdd" width="706" height="550"></figure>        </div>    </div>    <div class="chapter"><h2 id="arguments-set" data-toc="IDE_advanced_metadata#arguments-set">Arguments set</h2>        <p id="2f05e116">            For some functions, the list of possible arguments’ values can be quite large. What’s more, different functions can accept the same sets of values.        If you provide the list of <a href="#expected-arguments">expected arguments</a> for such functions, the <span class="filepath">.phpstorm.meta.php</span> file will both grow excessively large. It will also contain duplicate data, and the amount of work required to maintain it will also double.        </p>        <p id="59585c2b">To handle this, inside a <span class="filepath">.phpstorm.meta.php</span> file, you can use two directives, <code class="code">registerArgumentsSet</code> and <code class="code">argumentsSet</code>.            We'll use the <code class="code">ini_get</code> and <code class="code">ini_set</code> functions accepting the <a href="http://php.net/manual/en/ini.list.php" data-external="true" target="_blank" rel="noopener noreferrer">php.ini directives</a> as an example.        </p>        <ul class="list _ul"><li class="list__item" id="217d931d">                <p id="08faa65e">                    <code class="code">registerArgumentsSet</code> accepts two arguments: the arbitrary name of the set of arguments and the list of actual values contained in this set. Values are specified the same way as the list of <a href="#expected-arguments">expected arguments</a>: depending on the function or method you are working with, you can enumerate them via the comma <code class="code">,</code> or the pipe <code class="code">|</code> <a href="http://php.net/manual/en/language.operators.bitwise.php" data-external="true" target="_blank" rel="noopener noreferrer">bitwise operator</a>.                </p>                <p id="0649d3b3">                    To register the set of arguments for the above case, specify the directive like this:                </p>            <div class="code-block" data-lang="php">
                registerArgumentsSet('ini_values', ...argumentsList);
            </div>            </li><li class="list__item" id="90841f56">                <p id="d349c22d">Having registered the single set of arguments, you can reference it from within <code class="code">expectedArguments</code> for both functions by using the <code class="code">argumentsSet</code> directive:</p>            <div class="code-block" data-lang="php">
                expectedArguments(\ini_get(), 0, argumentsSet("ini_values"));
                expectedArguments(\ini_set(), 0, argumentsSet("ini_values"));
            </div>            </li></ul>    </div>        <div class="chapter"><h2 id="factory-methods" data-toc="IDE_advanced_metadata#factory-methods">Factory methods</h2>        <p id="50839502">            The <a href="http://en.wikipedia.org/wiki/Factory_method_pattern" data-external="true" target="_blank" rel="noopener noreferrer">factory design pattern</a> is commonly            used in PHP frameworks (such as Magento, Doctrine, Kohana, ZF2, and so on).                        PhpStorm provides generic support for the factory pattern via <span class="emphasis">advanced metadata files</span>.        </p>        <p id="1133614b">            Suppose you have something like the following "service" or "helper" provider interfaces/objects.        </p>        <div class="code-block" data-lang="php">
interface ServiceLocatorInterface {
    function get($name); //You call this to get your helper depending on argument

    function getByPattern($name);
}

class ServiceManager implements ServiceLocatorInterface {
    function get($name) {
        return new $name; //simplest test example implementation&nbsp;&nbsp;
    }

    function getByPattern($name) {
        return new $name;
    }
}

$serviceManager = (new ServiceManager());


function globalFactoryFunction($param) {
    return new $param;
}
        </div>        <p id="cde35179">            You can make the following cases work by using the additional metadata file.        </p>        <div class="code-block" data-lang="php">
//(1) static factory call
$getStatic = ServiceManager::get("special");
//(2) non-static factory
$getDynamic = $serviceManager-&gt;get("special");
//(3) ArrayAccess style factory
$getFromArray = $serviceManager["special"];
//class name constant
$getByClassNameConst = $serviceManager-&gt;get(Exception::class);
$getByClassNameConstFromArray = $serviceManager["Exception"];
//"fallback" to direct class name
$getWithFallback = $serviceManager-&gt;get("Exception");
$getWithFallbackArray = $serviceManager["Exception"];
//look up by expressions
$byPattern = $serviceManager-&gt;getByPattern("Seekable" /*Iterator*/);
//(4)
$getFromStaticFunction = globalFactoryFunction("Exception");
//this is all resolved and green!
$getByClassNameConst-&gt;getCode();
$getWithFallback-&gt;getCode();
$getByClassNameConstFromArray-&gt;getCode();
$getFromArray-&gt;getCode();
$getDynamic-&gt;getCode();
$byPattern-&gt;seek(1);

class Foo {
    /**
     * @var ServiceManager
     **/
    protected $serviceManager;

    function test() {
        $worksThroughProperties = $this-&gt;serviceManager-&gt;get(Exception::class);
        $worksThroughProperties-&gt;getCode(); // same in class
    }
}
        
        </div>        <p id="34861c1c">            It is recommended to store it in a <span class="filepath">.meta.php</span> file under the project             root.            In PhpStorm version 2016.2 and later, you can have multiple separate files stored in a folder named            <span class="filepath">.phpstorm.meta.php</span>.        </p>        <p id="1f02cc9d">.phpstorm.meta.php\sample.meta.php        </p>        <div class="code-block" data-lang="php">

namespace PHPSTORM_META { // we want to avoid the pollution

// this is a saner and self-documented format for PhpStorm 2016.2 and later
//Try QuickDoc on these "magic" functions, or even Go to definition!

    override(\ServiceLocatorInterface::get(0), // method signature //argument number is ALWAYS 0 now.
        map([ //map of argument value -&gt; return type
            "special" =&gt; \Exception::class, //Reference target classes by ::class constant
            \ExampleFactory::EXAMPLE_B =&gt; ExampleB::class, // FYI, we can now support class constant argument values
            \EXAMPLE_B =&gt; \ExampleB::class, // and global constants too
//non-mapped value, e.g. $getByClassNameConst case above will be returned automatically
        ]));


//pattern example. `@` is replaced by argument literal value.
    override(\ServiceLocatorInterface::getByPattern(0),
        map([
            '' =&gt; '@Iterator|\Iterator',
        ]));

//basicaly the same as get, just for array["arg"] lookups
    override(new \ServiceLocatorInterface,
        map([
            "special" =&gt; \Exception::class,
        ]));
}
        </div>        <p id="49f14b28">            PHP code is used as a config, so that we can use the existing API to analyse it. The specific format is            chosen also to facilitate the existing editor features to help as much as possible: code completion works,            references are resolved, usage search and refactoring work too.        </p>    </div>    <div class="chapter"><h2 id="more-dynamic-return-type-possibilities" data-toc="IDE_advanced_metadata#more-dynamic-return-type-possibilities">More dynamic return type possibilities</h2>        <div class="code-block" data-lang="php">
//below is the example of couple more meta expressions bundled into PhpStorm for better standard library support&nbsp;
override(\array_filter(0), type(0));
override(\array_reduce(0), elementType(0));
        </div>    </div>    <div class="chapter"><h2 id="packaging-metadata-stub-files-into-plugin" data-toc="IDE_advanced_metadata#packaging-metadata-stub-files-into-plugin">Packaging metadata/stub files into plugin</h2>        <p id="9bc46a5f">            You can now package these into public plugins by adding XML descriptor and uploading the <span class="filepath">ZIP</span> file to            the plugins repository, see example at <a href="https://github.com/JetBrains/phpstorm-library-plugin" data-external="true" target="_blank" rel="noopener noreferrer">https://github.com/JetBrains/phpstorm-library-plugin</a>.        </p>    </div>    <div class="chapter"><div class="collapse"><div class="collapse__title"><h2 id="legacy-metadata-format-deprecated" data-toc="IDE_advanced_metadata#legacy-metadata-format-deprecated">Legacy metadata format (deprecated)</h2></div><div class="collapse__content">        <p id="b776116e">            PhpStorm version 2016.1 and earlier use a different metadata format (now deprecated).        </p>        <div class="code-block" data-lang="php">

namespace PHPSTORM_META {
// we want to avoid the pollution
// this is legacy format for 2016.1 and EARLIER
// This file is not a CODE, it makes no sense and won't run or validate
// Its AST serves IDE as DATA source to make advanced type inference decisions.

    $STATIC_METHOD_TYPES = [         // we make sections for scopes
        \ServiceLocatorInterface::get('') =&gt; [   // STATIC call key to make static (1) &amp; dynamic (2) calls work
            "special" instanceof \Exception,   // "KEY" instanceof Class maps KEY to Class
        ],
        new \ServiceLocatorInterface =&gt; [ // NEW INSTANCE is to make ArrayAccess (3) style factory work
            "special" instanceof \Exception,
        ],
        \ServiceLocatorInterface::getByPattern('') =&gt; [
            "" == "@Iterator",    // "ignored" == "PatternWith@" substitutes @ with arg value
        ],
        \globalFactoryFunction('') =&gt; [   // (4) works also with functions
        ],              // if key is not found its used as type name in all cases
    ];
}
        </div>    </div></div></div><div class="last-modified" data-skip-index="skip">Last modified: 29 November 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="tuning-the-ide.html">Advanced configuration</a><a class="navigation-links__next" href="ps-code-inspection-index.html">Code Inspection Index</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>