<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>刷新令牌-帮助|毂</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Refresh-Token"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索中心帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Hub 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Refresh-Token.xml" data-toc="Refresh-Token">刷新令牌</h1>    <div class="chapter"><h2 id="AuthorizationCodewithaRefreshTokenFlow" data-toc="Refresh-Token#AuthorizationCodewithaRefreshTokenFlow">参考标准</h2>        <p id="96a871ca"><a href="https://tools.ietf.org/html/rfc6749#section-4.1" rel="noopener noreferrer" data-external="true" target="_blank">具有刷新令牌流的授权代码规范（RFC 6749）</a></p>    </div>    <div class="chapter"><h2 id="Prerequisites" data-toc="Refresh-Token#Prerequisites">先决条件</h2>        <p id="cd99985c"><b id="422159da">客户端是桌面或移动应用程序</b> 。</p>        <p id="9b1deddd">客户端在集线器中注册为服务。也就是说，客户端“知道”其<code class="code">serviceId</code>和<code class="code">serviceSecret</code> 。它应该能够存储<code class="code">refreshToken</code> 。使用刷新令牌，即使最终用户不在线，它也可以访问资源服务器。</p>        <p id="a14d003b">客户端应用程序获得了<code class="code">refresh_token</code>来自Hub。集线器支持为<a href="Authorization-Code.html">授权代码</a>和<a href="Resource-Owner-Password-Credentials.html">资源所有者密码凭据</a>授权流程发布刷新令牌。</p>    </div>    <div class="chapter"><h2 id="40a56861" data-toc="Refresh-Token#40a56861">刷新访问令牌</h2>        <p id="27962b57">如果集线器向客户端发布了刷新令牌，则客户端通过使用以下命令添加以下参数来向令牌端点发出刷新请求： <code class="code">"application/x-www-form-urlencoded"</code> HTTP请求实体正文中使用UTF-8字符编码的格式：</p>        <dl><dt id="86c535df">grant_type</dt><dd>需要。值必须设置为“ refresh_token”。</dd><dt id="b0fbb819">refresh_token</dt><dd>需要。颁发给客户端的刷新令牌。</dd><dt id="914da782">范围</dt><dd>                <p id="a1cd4104">需要。访问请求的范围：与资源服务器关联的中心服务中注册的ID的空格分隔列表。例如，如果客户端要访问YouTrack中的问题，则应在Hub中找出YouTrack服务的ID。客户端可以使用单个访问令牌访问超过一个资源服务器。</p>                <p id="789f7901"><b id="4132b000">注意：</b>所请求的范围不得包括资源所有者最初未授予的任何范围，如果省略，则被视为等同于资源所有者最初授予的范围。</p>            </dd></dl>        <p id="d5254a74">因为刷新令牌通常是用于请求其他访问令牌的持久凭证，所以刷新令牌将绑定到发出该令牌的客户端。如果客户端类型为机密，或者向客户端颁发了客户端凭据（或分配了其他身份验证要求），则客户端必须<a href="https://tools.ietf.org/html/rfc6749#section-3.2.1" rel="noopener noreferrer" data-external="true" target="_blank">按照RFC 6749中的说明</a> ，通过集线器服务器进行身份验证。</p>        <p id="589a5900">例如，客户端使用传输层安全性发出以下HTTP请求（带有额外的换行符仅用于显示目的）：</p>        <div class="code-block" data-lang="none">POST / api / rest / oauth2 / token主机：hub.company.com授权：基本czZCaGRSa3F0MzpnWDFmQmF0M2JW内容类型：application / x-www-form-urlencoded grant_type = refresh_token＆refresh_token = tGzv3JOkF0XG5Qx2T</div>        <p id="b175af6b">授权服务器（Hub）将：</p>        <ol class="list _decimal"><li class="list__item" id="dc977031"><p>需要对机密客户端或已颁发客户端凭据的任何客户端进行客户端身份验证（或具有其他身份验证要求）</p></li><li class="list__item" id="f6b678db"><p>如果包括客户端身份验证，则对客户端进行身份验证，并确保将刷新令牌发布给已身份验证的客户端。</p></li><li class="list__item" id="ce305937"><p>验证刷新令牌。</p></li></ol>        <p id="ed9d0eb8">如果刷新令牌有效且已授权，则集线器将发出访问令牌。</p>        <p id="8fc6a021">如果请求验证失败或无效，则集线器将返回<a href="#AccessTokenRequestError">错误响应。</a>        </p>        <p id="ce94d4be">集线器可能会与新的访问令牌一起发布新的刷新令牌，在这种情况下，客户端必须丢弃旧的刷新令牌，并用新的替换。授权服务器（Hub）可能会在向客户端发布新的刷新令牌后撤销旧的刷新令牌。如果发出了新的刷新令牌，则刷新令牌范围必须与客户端在请求中包括的刷新令牌的范围相同。</p>    </div>    <div class="chapter"><h2 id="AccessTokenRequestError" data-toc="Refresh-Token#AccessTokenRequestError">集线器对访问令牌请求的错误响应</h2>        <dl><dt id="ae28c06d">错误</dt><dd>                <p id="42315fc0">来自以下位置的单个ASCII [USASCII]错误代码：</p>                <ul class="list _bullet"><li class="list__item" id="b05a2e5e"><p>                        <code class="code">invalid_request</code> -请求缺少必需的参数，包括不受支持的参数值（授权类型除外），重复参数，包括多个凭据，利用多个以上的机制来认证客户端或格式错误。</p></li><li class="list__item" id="cc20f3e6"><p>                        <code class="code">invalid_client</code> -客户端身份验证失败（例如，未知客户端，不包括客户端身份验证或不支持的身份验证方法）。授权服务器可以返回HTTP 401（未授权）状态代码，以指示支持哪些HTTP身份验证方案。如果客户端尝试通过“授权”请求标头字段进行身份验证，则集线器服务器将使用HTTP 401（未授权）状态代码进行响应，并包括与客户端使用的身份验证方案匹配的“ WWW-Authenticate”响应标头字段。</p></li><li class="list__item" id="9ed688c4"><p>                        <code class="code">invalid_grant</code> -所提供的授权授权（例如，授权代码，资源所有者凭证）或刷新令牌无效，已过期，已吊销，与授权请求中使用的重定向URI不匹配或已发行给另一个客户端。</p></li><li class="list__item" id="5a3ef715"><p>                        <code class="code">unauthorized_client</code> -未授权已认证的客户端使用此授权授予类型。</p></li><li class="list__item" id="09e38d32"><p>                        <code class="code">unsupported_grant_type</code> -集线器不支持授权授予类型。</p></li><li class="list__item" id="4443d56b"><p>                        <code class="code">invalid_scope</code> -请求的范围无效，未知，格式错误或超出了资源所有者授予的范围。</p></li></ul>            </dd><dt id="889bf77b">error_description</dt><dd>人类可读的ASCII [USASCII]文本，提供了其他信息，用于帮助客户端开发人员了解所发生的错误。</dd><dt id="fdb2754b">error_uri</dt><dd>一个URI，用于标识人类可读的网页以及有关错误的信息，用于向客户端开发人员提供有关该错误的其他信息。</dd></dl>        <p id="237d7e90">这些参数使用“ application / json”媒体类型包含在HTTP响应的实体主体中。通过在最高结构级别添加每个参数，将参数序列化为JSON结构。参数名称和字符串值作为JSON字符串包含在内。数值包含为JSON数字。参数的顺序无关紧要，并且可以变化。</p>        <p id="0d4e43a4">例如：</p>        <div class="code-block" data-lang="markup">HTTP / 1.1 400错误的请求内容类型：application / json; charset = UTF-8缓存控制：无存储语法：无缓存{“ error”：“ invalid_request”}</div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年9月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Authorization-Code.html">授权代码</a> <a class="navigation-links__next" href="Resource-Owner-Password-Credentials.html">资源所有者密码凭证</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>