<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>授权码-帮助|毂</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="Authorization-Code"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索中心帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Hub 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="Authorization-Code.xml" data-toc="Authorization-Code">授权码</h1>    <a name="Authorization code flow"></a>    <div class="chapter"><h2 id="StandardReference" data-toc="Authorization-Code#StandardReference">参考标准</h2>        <p id="e77ad64a">有关更多信息，请参见<a href="https://tools.ietf.org/html/rfc6749#section-4.1" rel="noopener noreferrer" data-external="true" target="_blank">授权代码流规范</a> 。</p>    </div>    <a name="Prerequisites"></a>    <div class="chapter"><h2 id="PreRequisites" data-toc="Authorization-Code#PreRequisites">先决条件</h2>        <p id="e29c131c"><b id="dd84f67a">客户端是一个Web应用程序</b> 。</p>        <p id="1db8a245">Web应用程序是在Web服务器上运行的机密客户端。资源所有者通过在资源所有者使用的设备上的用户代理中呈现的HTML用户界面访问客户端。客户端凭据以及颁发给客户端的任何访问令牌都存储在Web服务器上，并且资源所有者无法访问或访问。</p>        <dl><dt id="9827c904">客户端service_ID</dt><dd>与集线器中的客户端关联的服务的ID。</dd><dt id="48aae6b7">客户端service_secret</dt><dd>与集线器中的客户端关联的服务的秘密。</dd><dt id="2717c972">范围</dt><dd>与资源服务器关联的集线器服务中已注册ID的空格分隔列表。例如，如果客户端要访问YouTrack中的问题，则应在Hub中找出YouTrack服务的ID。客户端可以使用单个访问令牌访问超过一个资源服务器。</dd><dt id="ae7418bc">客户端的redirect_URI</dt><dd>客户端应用程序上的URI，可以处理来自授权服务器的响应。</dd><dt id="2c5ebd4b">中心网址</dt><dd>集线器服务器的URL。</dd><dt id="83b06f2e">州</dt><dd>当前应用程序状态的标识符。例如，它可以是包含有关客户端服务中当前用户位置信息的本地存储对象的键。</dd><dt id="36d8b564">request_credentials</dt><dd>一个参数，用于控制是否应向用户显示登录表单。以下值是有效的：<ul class="list _bullet"><li class="list__item" id="aba5bc71">                        <p id="0bbbc19a">                            <code class="code">skip</code> —如果客户端服务通常允许匿名访问，请使用此选项。它的工作方式如下：</p>                        <ul class="list _bullet"><li class="list__item" id="43c4de86"><p>如果用户已经登录到Hub，则授权她使用客户端服务，</p></li><li class="list__item" id="883680b7"><p>如果用户未登录集线器且访客帐户未被禁止，则授权访客使用客户端服务，</p></li><li class="list__item" id="6d2c4b53"><p>如果用户未登录集线器并且访客帐户被禁止，则导航至登录表单。</p></li></ul>                    </li><li class="list__item" id="dc246ee1"><p>                        <code class="code">silent</code> - 和...一样<code class="code">skip</code> ，但无论如何都会返回。如果禁止来宾帐户，则此选项将返回到带有身份验证错误的客户端服务。</p></li><li class="list__item" id="5366b506"><p>                        <code class="code">required</code> —注销用户并显示登录表单。使用此选项作为注销客户端服务的响应。</p></li><li class="list__item" id="ebfe1060">                        <p id="41ea2df9">                            <code class="code">default</code> —如果客户端服务不允许匿名访问，请使用此选项。它的工作方式如下：</p>                        <ul class="list _bullet"><li class="list__item" id="02c5cc9d"><p>如果用户已经登录到Hub，则授权她使用客户端服务，</p></li><li class="list__item" id="26b4a253"><p>如果用户未登录集线器，则导航她以登录表单。</p></li></ul>                    </li></ul>            </dd><dt id="7985a933">access_type</dt><dd>指示当用户不在线时应用程序是否需要访问集线器。允许值： <code class="code">online</code> （默认使用）和<code class="code">offline</code> 。如果应用程序在用户不在线时需要刷新访问令牌，请使用<code class="code">offline</code>值。在这种情况下，集线器在第一次为用户交换授权代码时为应用程序发出<a href="Refresh-Token.html">刷新令牌</a> 。有关更多信息，请参考<a href="Refresh-Token.html">刷新令牌</a>页面。</dd></dl>    </div>    <a name="Send User to the Authorization Server (Hub)"></a>    <div class="chapter"><h2 id="SendUserToHub" data-toc="Authorization-Code#SendUserToHub">将用户发送到授权服务器（Hub）</h2>        <p id="46f8e589">要启动身份验证代码，应以以下格式向浏览器发送重定向响应到URL：</p>        <div class="code-block" data-lang="markup">$ {Hub服务网址} / api / rest / oauth2 / auth？response_type = code＆state = $ {State}＆redirect_uri = $ {客户端重定向URI}＆request_credentials = $ {请求凭据模式}＆client_id = $ {客户端服务ID}＆scope = $ {Scope}＆access_type = {online | offline}</div>。<p id="0b3d4d58">例：</p>        <div class="code-block" data-lang="markup">https://hub.company.com/api/rest/oauth2/auth?response_type=code&state=9b8fdea0-fc3a-410c-9577-5dee1ae028da&redirect_uri=https%3A%2F%2Fmyservice.company.com%2Fauthorized&request_credentials=skip&client-id=980167 004c-4ddf-ba37-5d4599fdf319＆scope = 0-0-0-0-0％2098071167-004c-4ddf-ba37-5d4599fdf319</div>        <p id="74f89fa5">要指示集线器发出刷新令牌，请添加<code class="code">access_type=offline</code>您请求的参数：</p>        <div class="code-block" data-lang="markup">$ {Hub服务网址} / api / rest / oauth2 / auth？response_type = code＆state = $ {State}＆redirect_uri = $ {客户端重定向URI}＆request_credentials = $ {请求凭据模式}＆client_id = $ {客户端服务ID}＆scope = $ {Scope}＆access_type = offline</div>。</div>    <a name="Handle Redirect Back from the Authorization Server"></a>    <div class="chapter"><h2 id="HandleRedirectFromHub" data-toc="Authorization-Code#HandleRedirectFromHub">处理从授权服务器（Hub）重定向回</h2>        <p id="692ff398">如果资源所有者批准了访问请求，则集线器通过使用以下命令将以下参数添加到重定向URI的查询组件中，来发布授权代码并将其传递给客户端。 <code class="code">"application/x-www-form-urlencoded"</code>格式：</p>        <dl><dt id="eaec15b0">码</dt><dd>授权服务器生成的授权代码。授权码将在发出后不久过期，以减少泄漏的风险。客户端不得多次使用授权码。如果多次使用授权码，则Hub将拒绝该请求。授权代码绑定到客户端标识符和重定向URI。</dd><dt id="ce187d89">州</dt><dd>授权请求中从客户端收到的确切值。</dd></dl>        <p id="da81cc5e">例如，授权服务器（Hub）通过发送以下HTTP响应来重定向用户代理：</p>        <div class="code-block" data-lang="markup">HTTP / 1.1 302找到位置：https://myservice.company.com/authorized?code=SplxlOBeZQQYbYS6WxSbIA&state=xyz</div>        <p id="f7089280">客户端必须忽略无法识别的响应参数。</p>    </div>    <div class="chapter"><h2 id="ErrorRedirectFromHub" data-toc="Authorization-Code#ErrorRedirectFromHub">从集线器处理错误重定向回</h2>        <p id="4b4eb7f8">如果资源所有者拒绝访问请求，或者请求由于丢失或无效的重定向URI以外的原因而失败，则集线器通过使用以下参数将以下参数添加到重定向URI的查询组件中来通知客户端<code class="code">application/x-www-form-urlencoded</code>格式：</p>        <dl><dt id="272bd898">错误</dt><dd>                <p id="1ccd8b69">来自以下位置的单个ASCII [USASCII]错误代码：</p>                <ul class="list _bullet"><li class="list__item" id="3f6995d0"><p>                        <code class="code">invalid_request</code> -请求缺少必需的参数，包含无效的参数值，多次包含参数或格式错误。</p></li><li class="list__item" id="7a9fd054"><p>                        <code class="code">unauthorized_client</code> -客户端无权使用此方法请求授权码。</p></li><li class="list__item" id="8ef6966f"><p>                        <code class="code">access_denied</code> -资源所有者或集线器拒绝了该请求。</p></li><li class="list__item" id="30a8a90c"><p>                        <code class="code">unsupported_response_type</code>集线器不支持使用此方法获取授权码。</p></li><li class="list__item" id="9b13e88a"><p>                        <code class="code">invalid_scope</code>请求的范围无效，未知或格式错误。</p></li><li class="list__item" id="53e83c95"><p>                        <code class="code">server_error</code>集线器服务器遇到意外情况，阻止其满足请求。（因为无法通过HTTP重定向将500内部服务器错误HTTP状态代码返回给客户端，所以需要此错误代码。）</p></li><li class="list__item" id="955bdfdb"><p>                        <code class="code">temporarily_unavailable</code>由于服务器的暂时超载或维护，授权服务器当前无法处理该请求。（需要此错误代码，因为无法通过HTTP重定向将503服务不可用HTTP状态代码返回给客户端。）</p></li></ul>            </dd><dt id="278293ef">error_description</dt><dd>人类可读的ASCII [USASCII]文本，提供了其他信息，用于帮助客户端开发人员了解所发生的错误。</dd><dt id="00655b4b">error_uri</dt><dd>一个URI，用于标识人类可读的网页以及有关错误的信息，用于向客户端开发人员提供有关该错误的其他信息。</dd><dt id="c9471af6">州</dt><dd>如果客户端授权请求中存在“状态”参数，则为必需。从客户端收到的确切值。</dd></dl>    </div>    <div class="chapter"><h2 id="ExchangingCodeForToken" data-toc="Authorization-Code#ExchangingCodeForToken">交换代码以访问令牌</h2>        <p id="f94ec8e7">客户端收到代码后，可以将其交换为访问令牌。</p>        <p id="d09fa07b">客户端通过以下命令向集线器令牌端点发送请求： <code class="code">application/x-www-form-urlencoded</code> HTTP请求实体正文中的字符编码为UTF-8的“”格式：</p>        <div class="code-block" data-lang="markup">POST / api / rest / oauth2 / token主机：$ {Hub Service URL}接受：application / json授权：基本$ {base64（$ {Client Service ID} +“：” + $ {Client Service Secret}）}内容-类型：application / x-www-form-urlencoded grant_type = authorization_code＆code = $ {上一步收到的代码}＆redirect_uri = $ {客户端重定向URI}</div>        <p id="6766e149">例：</p>        <div class="code-block" data-lang="markup">POST / api / rest / oauth2 / token主机：hub.company.com接受：application / json授权：基本OTgwNzExNjctMDA0Yy00ZGRmLWJhMzctNWQ0NTk5ZmFmMzE5OmVBVXlLZ1ZmaFNiVg0KContent-Type：Application_x_www_form1％_x_WWW_L-WJV =％_ x_x_a_Lys = P_X_WWW_LJWZW =％_ CyT = S_L1W3D = W3DWZT = S3DW1D = W1D1D＆T_L1D＆T_L1C 2Fmyservice.company.com％2F授权</div>    </div>    <div class="chapter"><h2 id="HandlingTokenResponse" data-toc="Authorization-Code#HandlingTokenResponse">处理访问令牌响应</h2>        <p id="4f50ef5e">如果访问令牌请求有效且得到授权，则集线器将发出访问令牌。如果请求客户端身份验证失败或无效，则集线器服务器将返回错误响应。</p>        <p id="ba85d868">成功响应的示例：</p>        <div class="code-block" data-lang="markup">HTTP / 1.1 200 OK内容类型：application / json; charset = UTF-8 {“ access_token”：“ 1443459450185.0-0-0-0-0-0.98071167-004c-4ddf-ba37-5d4599fdf319.0-0-0-0- 0％3B1。MCwCFC％2FYWvLjHdzOdpLleDLITJn4Mz9rAhRklCoZ2dlMkh2aCd1K5QQ89ibsxg％3D％3D“ expires_in”：3600，}</div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年9月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="Implicit.html">隐式</a> <a class="navigation-links__next" href="Refresh-Token.html">刷新令牌</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>