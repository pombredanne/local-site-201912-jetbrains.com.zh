<html lang="en-US" ><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="/resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>从命令行配置内置TLS-帮助|帮助毂</title><link rel="stylesheet" href="/resources.jetbrains.com/storage/help-app/v3/app.css"></head><body  data-id="server-tls-from-command-line"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label class="search-box__label" for="search-box__input"><input type="text" class="search-box__input" id="search-box__input" placeholder="搜索中心帮助"></label><div class="search-box__clear" title="明确"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">发送反馈</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Hub 2019.1帮助</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">按键图：</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 id="configure-server-tls-from-command-line.xml" data-toc="server-tls-from-command-line">从命令行配置内置TLS</h1>    <p id="0da3ae16">本页上的说明向您显示如何使用命令行参数为现有安装配置内置TLS。</p>    <p id="d32fffa6">使用命令行，可以在以下连接模式之间切换：</p>    <div class="table-wrapper"><table width="100%" id="e86b40ac"><thead><tr id="8aec062a" class="ijRowHead"><th id="1982db66" width="20%"><p>模式</p></th><th id="63ba4e2c"><p>描述</p></th></tr></thead><tbody><tr id="032d6178" class="ijRowOdd"><td id="bd430abc"><p>HTTP</p></td><td id="28518575"><p id="9edfa988">默认的HTTP模式。TLS已禁用。</p>            <p id="0e23d074">HTTP模式仅适用于测试安装或通过SSL终止的反向代理服务器路由到集线器的连接时。</p></td></tr><tr id="f9c2bef6" class="ijRowEven"><td id="743ed297"><p>HTTPS</p></td><td id="afe3dbc9"><p id="c7ed9851">安全的HTTPS模式。启用了TLS。</p>                <p id="4d1eb06f">配置参数使您可以使用以下文件格式保护服务器连接：</p>                <ul class="list _ul"><li class="list__item" id="d2e7cea4"><p>包含<a href="https://en.wikipedia.org/wiki/Keystore" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式的私钥/证书数据的密钥库。</p></li><li class="list__item" id="32221ef8"><p>私钥，证书和（可选）证书链作为<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式的单独文件。</p></li></ul>            </td></tr></tbody></table></div>    <p id="20b189b5">要切换模式，请停止集线器并运行<code class="code">configure</code>命令。您为命令中的每个参数指定的值定义了您选择的配置。有关详细说明以及每种配置的属性的完整列表，请参见下文。</p>    <div class="chapter"><h2 id="switch-to-http-mode" data-toc="server-tls-from-command-line#switch-to-http-mode">切换到HTTP模式</h2>        <p id="bc114b02">当您以纯HTTP模式运行集线器时，Web浏览器与服务器之间的连接无法通过SSL / TLS进行保护。为了安全起见，强烈建议您不要使用纯HTTP。</p>        <p id="c97227c1">从HTTPS模式安全切换到HTTP的一种情况是修改服务器环境以使用SSL终止反向代理。在这种情况下，您将集线器切换为以HTTP模式运行。您可以配置反向代理来保护服务器流量，而不使用内置的TLS。</p>        <section class="procedure-steps"><h3 id="HTTP">要切换到HTTP模式：</h3><ol class="list _decimal"><li class="list__item" id="df3f1ef8"><p><a href="Starting-and-Stopping-Hub.html">停止集线器服务</a> 。</p></li><li class="list__item" id="4005964a">                <p id="d72291a3">输入以下命令：</p>                <div class="code-block" data-lang="none"><code class="code-block__wrapper"><hub_home>/bin/hub.sh configure \ --listen-port=8080 \ [--base-url=<new base URL>] \ --secure-mode=disable</code></div>                <p id="bcf97ffb">如果由于切换到HTTP模式而导致服务器基本URL更改，请使用<code class="code">--base-url=<new base URL></code>参数以设置此值。</p>                <aside class="note " rel="bcf97ffb" id="7c143016" data-title="">                    <p id="abb7d248">更改集线器安装的基本URL时，必须更新集成和连接服务的设置以使用新URL。这包括存储在Upsource和YouTrack中的设置。如果您启用了支持OAuth 2.0的身份验证模块，则需要为每个第三方授权服务生成新的客户端ID和密码。</p>                </aside>                <p id="46690c6b">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters-new">配置参数”</a> 。</p>            </li><li class="list__item" id="4e2d1731"><p><a href="Starting-and-Stopping-Hub.html">启动集线器服务</a> 。</p></li></ol></section>    </div>    <div class="chapter"><h2 id="switch-to-https-mode" data-toc="server-tls-from-command-line#switch-to-https-mode">切换到HTTPS模式</h2>        <p id="8623c033">的<code class="code">configure</code>命令可让您从HTTP切换到HTTPS模式。要启用安全的HTTPS模式，您需要为集线器提供私钥和证书。您可以提供私钥和证书，如下所示：</p>        <ul class="list _ul"><li class="list__item" id="453ce52e"><p>包含<a href="https://en.wikipedia.org/wiki/Keystore" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式的私钥/证书数据的密钥库。</p></li><li class="list__item" id="48d470fb"><p>私钥，证书和（可选）证书链作为<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式的单独文件。</p></li></ul>        <p id="d428596f">在开始之前，请将安全文件复制到集线器服务器可用的位置。</p>        <p id="958b4441">的<code class="code">configure</code>该命令支持特定于这些文件类型的不同属性。请按照适用于您可用文件类型的过程进行操作。</p>        <p id="2e3f372b">如果您已经配置了HTTPS，并且只想将新证书和私钥应用于集线器服务器，则也可以按照以下过程进行操作。</p>        <section class="procedure-steps"><h3 id="HTTPS-keystore">要使用SSL密钥库文件切换到HTTPS模式，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="e3c6a23f"><p><a href="Starting-and-Stopping-Hub.html">停止集线器服务</a> 。</p></li><li class="list__item" id="45e79771">                <p id="155cb0e5">运行以下命令：</p>                <div class="code-block" data-lang="none"><code class="code-block__wrapper"><hub_home>/bin/hub.sh configure \ --listen-port=443 \ [--base-url=<new base URL>] \ --secure-mode=tls \ --tls-server-cert-keystore-file=<path-to-keystore> \ --tls-server-cert-keystore-password=<keystore password> \ --tls-server-cert-keystore-key-alias=<private key entry alias> \ [--tls-server-cert-keystore-key-password=<private key entry password>] \ --tls-redirect-from-http=<[true|false]> \ [--tls-redirect-from-http-listen-port=8080]</code></div>                <ul class="list _ul"><li class="list__item" id="6017faee"><p id="1248ca1b">如果由于切换到HTTPS模式而导致服务器基本URL更改，请使用<code class="code">--base-url=<new base URL></code>参数以设置此值。</p>                        <aside class="note " rel="1248ca1b" id="b6481cdd" data-title="">                            <p id="9365f887">更改集线器安装的基本URL时，必须更新集成和连接服务的设置以使用新URL。这包括存储在Upsource和YouTrack中的设置。如果您启用了支持OAuth 2.0的身份验证模块，则需要为每个第三方授权服务生成新的客户端ID和密码。</p>                        </aside>                    </li><li class="list__item" id="59c25a1a"><p>如果从HTTP模式切换到HTTPS模式，则可以指定重定向侦听端口。此非安全端口接收所有HTTP请求，并将它们重定向到安全监听端口。为此，请使用<code class="code">tls-redirect-from-http=true</code>并为<code class="code">tls-redirect-from-http-listen-port=<your redirect port number></code>属性。</p></li></ul>                <p id="14986228">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters-new">配置参数”</a> 。</p>            </li><li class="list__item" id="5425b04c"><p><a href="Starting-and-Stopping-Hub.html">启动集线器服务</a> 。</p></li></ol></section>        <section class="procedure-steps"><h3 id="HTTPS-privateKeyAndCert">要使用私钥和证书切换到HTTPS模式，请执行以下操作：</h3><ol class="list _decimal"><li class="list__item" id="260fe494"><p><a href="Starting-and-Stopping-Hub.html">停止集线器服务</a> 。</p></li><li class="list__item" id="74e6aaa0"><p id="11e2e2da">运行以下命令：</p>                <div class="code-block" data-lang="none"><code class="code-block__wrapper"><hub_home>bin/hub.sh configure \ --listen-port=443 \ [--base-url=<new base URL>] \ --secure-mode=tls \ --tls-server-cert-key-file=<path-to-private-key-file> \ --tls-server-cert-file=<path-to-certificate-file> \ [--tls-server-cert-chain-file=<path-to-certificate-chain-file>] \ --tls-redirect-from-http=<[true|false]> \ [--tls-redirect-from-http-listen-port=8080]</code></div>                <ul class="list _ul"><li class="list__item" id="df0ce930"><p>如果私钥已加密，请添加<code class="code">tls-server-cert-private-key-passphrase</code>属性以提供密钥的密码短语。</p></li><li class="list__item" id="3f981a2f"><p>如果要定义证书文件的相对路径，请使用<code class="code">tls-server-cert-key-file</code> ， <code class="code">tls-server-cert-file</code>和<code class="code">tls-server-cert-chain-file</code> 。设置附加值<code class="code">tls-server-cert-folder</code>属性以及目录的绝对路径。相对路径针对指定的绝对路径进行解析。</p></li><li class="list__item" id="a6d80aa7"><p id="b58eced2">如果由于切换到HTTPS模式而导致服务器基本URL更改，请使用<code class="code">--base-url=<new base URL></code>参数以设置此值。</p>                        <aside class="note " rel="b58eced2" id="efde0bce" data-title="">                            <p id="07ed1b7d">更改集线器安装的基本URL时，必须更新集成和连接服务的设置以使用新URL。这包括存储在Upsource和YouTrack中的设置。如果您启用了支持OAuth 2.0的身份验证模块，则需要为每个第三方授权服务生成新的客户端ID和密码。</p>                        </aside>                    </li><li class="list__item" id="f61c9ed8"><p>如果从HTTP模式切换到HTTPS模式，则可以指定重定向侦听端口。此非安全端口接收所有HTTP请求，并将它们重定向到安全监听端口。为此，请使用<code class="code">tls-redirect-from-http=true</code>并为<code class="code">tls-redirect-from-http-listen-port=<your redirect port number></code>属性。</p></li></ul>                <p id="622bc121">有关此命令中使用的参数的更多信息，请参阅“ <a href="#configuration-parameters-new">配置参数”</a> 。</p>            </li><li class="list__item" id="90356969"><p><a href="Starting-and-Stopping-Hub.html">启动集线器服务</a> 。</p></li></ol></section>    </div>    <div class="chapter"><h2 id="configuration-parameters-new" data-toc="server-tls-from-command-line#configuration-parameters-new">配置参数</h2>        <p id="33c095da">下表提供了可用于配置内置TLS的参数列表。</p>        <div class="table-wrapper"><table class=" wide" width="100%" id="f659d250"><thead><tr id="6cc44e9d" class="ijRowHead"><th id="0f69900d" width="20%"><p>属性</p></th><th id="dea0e0e8" width="20%"><p>值</p></th><th id="10d3b45e"><p>描述</p></th></tr></thead><tbody><tr id="7f6d48c9" class="ijRowOdd"><td id="fe6416e1"><p>安全模式</p></td><td id="2e2576a2"><p><code class="code">disable</code> |<code class="code">tls</code></p></td><td id="e35078fb"><p id="85964a12">应用于集线器服务器的连接模式。此属性支持以下值：</p>                    <ul class="list _ul"><li class="list__item" id="5e82d4ff"><p><code class="code">disable</code> — TLS被禁用。这是此属性的默认值。</p></li><li class="list__item" id="5389d025"><p><code class="code">tls</code> —启用了TLS。</p></li></ul>                </td></tr><tr id="52ef190d" class="ijRowEven"><td id="c7a7c597"><p>监听端口</p></td><td id="a89ac1f4"></td><td id="d1fa37f2"><p>集线器侦听HTTP流量的端口。</p></td></tr><tr id="898e82f2" class="ijRowOdd"><td id="a021964a"><p>基本网址</p></td><td id="b3bfe523"></td><td id="4d93cef0"><p id="991e360a">最终用户请求访问您的集线器安装的URL。例如， <code class="code">https://hub.mydomain.com</code> 。</p>                    <ul class="list _ul"><li class="list__item" id="63e7e52b"><p>当值为<code class="code">secure-mode</code>财产是<code class="code">tls</code>或者您的集线器安装在SSL终止的反向代理服务器之后得到保护，则URL应当以<code class="code">https</code> 。</p></li><li class="list__item" id="e619cff6"><p>否则（当使用纯HTTP运行Hub时），URL开头为<code class="code">http</code> 。</p></li></ul>                </td></tr><tr id="03661389" class="ijRowEven"><td id="b2abace1"><p>tls-redirect-from-http</p></td><td id="54ecb3b1"><p><code class="code">true</code> |<code class="code">false</code></p></td><td id="350dcb50"><p id="13efc932">设置为true，以启用其他端口（由属性定义） <code class="code">tls-redirect-from-http-listen-port</code> ）接受未加密的HTTP流量并将其重定向到该属性定义的安全端口<code class="code">listen-port</code> 。</p>                    <p id="47850707">默认值为<code class="code">false</code> 。</p></td></tr><tr id="2ddac2db" class="ijRowOdd"><td id="9527c10b"><p>tls-redirect-from-http-listen-port</p></td><td id="4045abd6"></td><td id="ce8356aa"><p>指定其他端口以接受未加密的HTTP流量，并将其重定向到该属性定义的安全端口<code class="code">listen-port</code> （要启用此端口，请设置属性<code class="code">tls-redirect-from-http</code>至<code class="code">true</code> ）。</p></td></tr><tr id="4a696617" class="ijRowEven"><td id="34566bf8"><p>tls-server-cert-folder</p></td><td id="67b3755c"></td><td id="95ce6bfd"><p id="9346b374">一个（可选）绝对路径，用于解析其他命令行参数定义的相对路径（如果存在）。根据该目录解析在其他属性中指定的服务器证书文件的相对路径。可以引用相对路径的属性是：</p>                    <ul class="list _ul"><li class="list__item" id="01ddc45c"><code class="code">tls-server-cert-key-file</code></li><li class="list__item" id="ec780365"><code class="code">tls-server-cert-file</code></li><li class="list__item" id="8cbdd250"><code class="code">tls-server-cert-chain-file</code></li><li class="list__item" id="35e22d6d"><code class="code">tls-server-cert-keystore-file</code></li></ul>                </td></tr><tr id="28283d72" class="ijRowOdd"><td id="02a55501"><p>tls-server-cert-keystore-file</p></td><td id="541fd227"></td><td id="e09153c0"><p><a href="https://en.wikipedia.org/wiki/Keystore" rel="noopener noreferrer" data-external="true" target="_blank">JKS</a>或<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式的密钥库文件的位置。</p></td></tr><tr id="3d5974f4" class="ijRowEven"><td id="19915188"><p>tls-server-cert-keystore-password</p></td><td id="941bf7d3"></td><td id="caf647db"><p>密钥库完整性密码</p></td></tr><tr id="28558cd6" class="ijRowOdd"><td id="e9c5788d"><p>tls-服务器-证书-密钥库-密钥别名</p></td><td id="401c4e6c"></td><td id="4b95a2a5"><p id="102f80b0">密钥库中包含服务器证书和私钥的条目的别名。如果您的密钥库使用<a href="https://en.wikipedia.org/wiki/PKCS_12" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃12</a>格式，请遵循以下准则：</p>                    <ul class="list _ul"><li class="list__item" id="821e8dc0"><p>使用存储为<code class="code">friendlyName</code>在密钥库中。</p></li><li class="list__item" id="38750466"><p>如果私钥和证书对未标记为<code class="code">friendlyName</code>在生成期间，请使用此参数在密钥库中提供此对的序号。对于仅包含一个证书和私钥对的密钥库，请将值设置为<code class="code">1</code> 。</p></li></ul>                </td></tr><tr id="f2de295f" class="ijRowEven"><td id="17d3e175"><p>tls-server-cert-keystore-key-password</p></td><td id="0cbe35b4"></td><td id="0c3f73d1"><p>用于保护服务器在密钥库中的私钥条目的密码。</p></td></tr><tr id="d22c98c4" class="ijRowOdd"><td id="fcfeef7b"><p>tls服务器证书密钥文件</p></td><td id="334b718e"></td><td id="af004e21"><p>以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储的私钥（ <a href="https://en.wikipedia.org/wiki/PKCS_1" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃1</a>或<a href="https://en.wikipedia.org/wiki/PKCS_8" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃8</a> ）文件的位置。</p></td></tr><tr id="5e207160" class="ijRowEven"><td id="12b90ef4"><p>tls-server-cert-file</p></td><td id="b9afce6e"></td><td id="d2da2ddb"><p>证书文件的位置，以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储。</p></td></tr><tr id="6fbc5873" class="ijRowOdd"><td id="c92c392c"><p>tls服务器证书链文件</p></td><td id="6ccd333c"></td><td id="5ac770ca"><p>包含证书链的文件的（可选）位置，以<a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" rel="noopener noreferrer" data-external="true" target="_blank">PEM</a>格式存储。</p></td></tr><tr id="0fba0da4" class="ijRowEven"><td id="79dfa193"><p>tls-server-cert-private-key-passphrase</p></td><td id="e7943689"><p>串</p></td><td id="acd76025"><p>如果您使用加密的私钥，则使用此属性提供用于加密的密码短语。同时支持<a href="https://en.wikipedia.org/wiki/PKCS_1" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃1</a>和<a href="https://en.wikipedia.org/wiki/PKCS_8" rel="noopener noreferrer" data-external="true" target="_blank">PKCS＃8</a>格式。</p></td></tr></tbody></table></div>    </div><div class="last-modified" data-skip-index="skip">上次修改时间：2019年9月9日</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="configure-server-tls-configuration-wizard.html">在基于Web的配置向导中配置内置TLS</a> <a class="navigation-links__next" href="tls-keystores-and-certificates-for-server.html">TLS服务器证书和密钥库</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="/resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>