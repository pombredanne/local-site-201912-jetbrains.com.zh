<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-US"><head><meta charset="UTF-8"><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                        })(window,document,'script','dataLayer','GTM-5P98');
                    </script><script src="//resources.jetbrains.com/storage/help-app/v3/analytics.js"></script><title>Restore a Docker Installation - Help | Hub</title><link rel="stylesheet" href="//resources.jetbrains.com/storage/help-app/v3/app.css"></head><body data-id="restore-docker-installation"><noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P98" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div class="wrapper"><section class="panel _nav" data-skip-index="skip"><header class="panel__header"><div class="container"><form class="search-box"><label for="search-box__input" class="search-box__label"><input type="text" class="search-box__input" id="search-box__input" placeholder="Search Hub Help"></label><div class="search-box__clear" title="Clear"></div></form></div></header><nav class="panel__content"><div class="container _nav"><menu class="nav-tree"></menu></div><div class="container _footer panel__footer"><p><a href="#">Send feedback</a></p></div></nav></section><main class="panel _main"><header class="panel__header" data-skip-index="skip"><div class="container"><h3>Hub 2019.1 Help</h3><div class="shortcuts-switcher" data-skip-index="skip"><label for="switch-shortcuts">Keymap:</label><select id="switch-shortcuts" class="select _shortcuts" height="1"></select></div><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="restore-docker-installation" id="restore-docker-installation.xml">Restore a Docker Installation</h1>    <a name="intro"></a>    <p id="c0efcf3d">If you experience problems with your Hub installation, you may need to restore to the most recent working version.    Common scenarios that require that you restore an installation include:</p>    <ul class="list _ul"><li class="list__item" id="f57a182e"><p>You are unable to upgrade your installation successfully and need to restore the previously-installed version.</p></li><li class="list__item" id="b5b837d8"><p>The database of your installation breaks and you need to restore the current version from a backup copy of your database. </p></li></ul>    <p id="bfc557ea">In both cases, you can restore your installation using a valid backup of your Hub database.        If your backups are out of date, you can attempt to restore your installation using valid copies of your configuration and data files.        Restoration is only possible if you have either a valid backup or a copy of your database that is not corrupted.</p>    <p id="87d3745a">You should test this procedure on a regular basis to make sure you can use your backup files to restore your installation after an outage or attack.</p>        <div class="chapter"><h2 id="prerequisites" data-toc="restore-docker-installation#prerequisites">Prerequisites</h2>    <aside class="note " data-title="Note" rel="prerequisites" id="3e5a23f6">        <p id="4561bffb">To restore your database from a backup successfully, the version of the backup file should be the same or earlier than the version of Hub to which you restore this database.</p>    </aside>    <p id="0c7ccbdd">Before you begin, make sure you have a backup copy of the database that you want to restore.        Note the location of the backup copy so you are sure to select the correct file during this procedure.</p>    <ul class="list _ul"><li class="list__item" id="d503bb12"><p>If you're rolling back to the previous installation version after an unsuccessful upgrade, use the backup that you created prior to installation.            If you ignored this prerequisite, locate a backup file that corresponds with the version of your previous installation.</p></li><li class="list__item" id="a2e53b38"><p>If you're attempting to restore the current installation, locate&nbsp;an archived&nbsp;backup file in the directory that is set as the <span class="control">Backup location</span> that corresponds with the current version of your installation.        </p></li></ul>    </div>    <div class="chapter"><h2 id="restore-from-database-backup" data-toc="restore-docker-installation#restore-from-database-backup">Restore an Installation from a Backup Copy of Your Database</h2>        <p id="998c9548">To restore your database to the current or previous version, you need to reinstall Hub and use the backup as the <span class="control">Upgrade Source</span> during installation.</p>        <p id="b684722d">When you restore to a previous version of Hub, use a backup that corresponds to the version of the product that you want to restore.</p>        <section class="procedure-steps"><h3 id="4cf0077f">To restore your database from a backup:</h3><aside class="tip sideblock" data-title="" rel="4cf0077f" id="328f7857"><p>Requires permissions: Low-level Admin Write</p></aside><ol class="list _decimal"><li class="list__item" id="c726e7d9"><p>Stop the Hub service.                For details, see <a href="start-stop-hub-docker.html">Start and Stop Docker Container</a>.</p></li><li class="list__item" id="fa07125b"><p>Clean the contents of the&nbsp;<code class="code">data</code> and <code class="code">conf</code> directories. You need to clean the content of these two Hub-specific directories <span class="emphasis">on the host machine</span>.                For more details, see <a href="docker-installation.html#create-and-configure-directories">Create and Configure Directories</a> chapter of the installation instructions.</p></li><li class="list__item" id="d738ae08"><p id="f2cbaccb">Make sure that the backup file that you wish to restore is located in the <code class="code">backups</code> Hub directory <span class="emphasis">on the host machine</span>. The backup file must also be accessible to the user <code class="code">13001:13001</code> that runs Hub service inside the container.                For instance, on a Linux host machine, you can use the following commands to ensure the access:</p>                <div class="code-block" data-lang="bash">
                    chmod 750 &lt;path to the backup file on the host machine&gt;
                    chown 13001:13001 &lt;path to the backup file on the host machine&gt;
    </div>                <p id="26adf8c5">When you run the docker image, you need to map this directory to the corresponding directory inside the container - <code class="code">/opt/hub/backups</code></p>            </li><li class="list__item" id="99dc5226"><p id="66e1ceb8">Execute the following command to run a container with Hub server:</p>            <div class="code-block" data-lang="bash">
                docker run -it --name &lt;hub-server-instance&gt; \
                -v &lt;path to data directory&gt;:/opt/hub/data \
                -v &lt;path to conf directory&gt;:/opt/hub/conf \
                -v &lt;path to logs directory&gt;:/opt/hub/logs \
                -v &lt;path to backups directory&gt;:/opt/hub/backups \
                -p &lt;port on host&gt;:8080 \
                jetbrains/hub:&lt;version&gt;
    </div>                <p id="a17f91b0">For more details about running Hub container and command parameters, see <a href="docker-installation.html#run-hub-service">Run Hub Docker Container</a>.</p>                <ul class="list _ul"><li class="list__item" id="a3734bd6"><p>Hub image starts the web-based Configuration Wizard. In a browser, open the URL of the Configuration Wizard displayed in the console output.</p></li></ul>            </li><li class="list__item" id="7c20ef39"><p>In the <span class="control">Configuration Wizard</span>, select the&nbsp;<span class="control">Upgrade</span> option.                <figure><a class="lightbox" href="/help/img/hub/2019.1/upgrade-config-wizard-start.zoomed.png"><img alt="Restore Docker: Config wizard" title="Restore Docker: Config wizard" src="/help/img/hub/2019.1/upgrade-config-wizard-start.png" id="af5d2176" width="600" height="263"></a></figure>            </p></li><li class="list__item" id="889080d7"><p>On the <span class="control">Select Upgrade Source</span> page, select your backup as the <span class="control">Upgrade Source</span> and click the <span class="control">Next</span> button.            <figure><a class="lightbox" href="/help/img/hub/2019.1/docker-upgrade-source.zoomed.png"><img alt="Docker upgrade: Select backup " title="Docker upgrade: Select backup " src="/help/img/hub/2019.1/docker-upgrade-source.png" id="ddf41700" width="600" height="505"></a></figure>            </p></li><li class="list__item" id="b1245d90"><p id="78f0a495">Review Hub server settings, then click the <span class="control">Upgrade</span> button.</p>                <figure><a class="lightbox" href="/help/img/hub/2019.1/docker-upgrade-http-confirm.zoomed.png"><img alt="Docker upgrade backup confirm" title="Docker upgrade backup confirm" src="/help/img/hub/2019.1/docker-upgrade-http-confirm.png" id="16f3089c" width="600" height="696"></a></figure>                <ul class="list _ul"><li class="list__item" id="aa438075"><p>Hub service starts with the data from the backup file.</p></li></ul>            </li></ol></section>    </div><div class="last-modified" data-skip-index="skip">Last modified: 9 September 2019 </div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom" data-skip-index="skip"><a class="navigation-links__prev" href="upgrade-with-docker.html">Upgrade with Docker</a><a class="navigation-links__next" href="start-stop-hub-docker.html">Start and Stop Docker Container</a></div></article><div id="disqus_thread" data-skip-index="skip"></div></div></section></main></div><script src="//resources.jetbrains.com/storage/help-app/v3/app.js"></script></body></html>